"use strict";(self.webpackChunkberlin_equal_street_names=self.webpackChunkberlin_equal_street_names||[]).push([[2121],{51027:(e,t,i)=>{i.d(t,{M:()=>d,b:()=>h});var s=i(84614),n=i(63371),r=i(24603),o=i(23410),a=i(3961),l=i(21414);function h(e){const t=new a.kG;(0,s.S)(t,e),t.vertex.uniforms.add(new r.p("width",(e=>e.width))),t.attributes.add(l.T.POSITION,"vec3"),t.attributes.add(l.T.NORMAL,"vec3"),t.attributes.add(l.T.UV0,"vec2"),t.attributes.add(l.T.AUXPOS1,"float"),t.varyings.add("vtc","vec2"),t.varyings.add("vlength","float"),t.varyings.add("vradius","float"),t.vertex.code.add(o.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),t.fragment.uniforms.add([new r.p("outlineSize",(e=>e.outlineSize)),new n.N("outlineColor",(e=>e.outlineColor)),new r.p("stripeLength",(e=>e.stripeLength)),new n.N("stripeEvenColor",(e=>e.stripeEvenColor)),new n.N("stripeOddColor",(e=>e.stripeOddColor))]);const i=1/Math.sqrt(2);return t.fragment.code.add(o.H`
    const float INV_SQRT2 = ${o.H.float(i)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),t}const d=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},39405:(e,t,i)=>{i.d(t,{EV:()=>n,ne:()=>o,nn:()=>a,yG:()=>r});var s=i(17321);function n(e,t){return{type:(0,s.UF)(t),value:e,unit:t}}function r(e,t){return{type:(0,s.UF)(t),value:e,unit:t}}function o(e,t){return{type:(0,s.UF)(t),value:e,unit:t}}function a(e,t){return n((0,s.En)(e.value,e.unit,t),t)}r(0,"meters")},92121:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ne});var s=i(36663),n=i(53443),r=i(61681),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(71197),h=i(60573),d=i(76545),c=i(44584),u=i(13802),p=i(39405),_=i(76868),g=i(6766),m=i(8909),v=i(17700),y=i(90819),b=i(90472),w=i(25726),f=i(85130),C=i(28376),S=i(56331);const x=u.Z.getLogger("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController");let P=class extends n.Z{constructor(e){super(e),this._unitNormalizer=new S.D,this._handles=new c.Z,this._tempStartPosition=(0,m.c)(),this._tempEndPosition=(0,m.c)(),this._tempCornerPosition=(0,m.c)()}initialize(){this._handles.add((0,_.gx)((()=>this.view?.ready),(()=>this._initialize()),{once:!0,sync:!0,initial:!0}))}destroy(){this._handles=(0,r.SC)(this._handles)}_initialize(){const e=this.view.spatialReference,t=(0,w.rS)(e),i=t===w.GG?w.wY:t;this._sphericalPCPF=i;const s=(0,b.Up)(e,i);this._unitNormalizer.spatialReference=s?i:e,this._handles.add([(0,_.YP)((()=>({viewData:this.viewData,startPoint:this.analysis.startPoint})),(({viewData:e,startPoint:t})=>{e.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(t)}),_.tX),(0,_.YP)((()=>({viewData:this.viewData,endPoint:this.analysis.endPoint})),(({viewData:e,endPoint:t})=>{e.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(t)}),_.tX),(0,_.YP)((()=>({result:this._computedResult,viewData:this.viewData})),(({result:e,viewData:t})=>{t.result=e}),_.tX)])}_applyProjectionAndElevationAlignment(e){if((0,r.Wi)(e))return e;const t=(0,C.G)(e,this.view.spatialReference,this.view.elevationProvider);return(0,r.Wi)(t)?((0,C.e)(this.analysis,e.spatialReference,x),null):t}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:i}=this.viewData;if((0,r.Wi)(e)||(0,r.Wi)(t))return null;const s=this._euclideanDistances(e,t),n=this._geodesicDistance(e,t,s.horizontal.value),o=i===d.e.Geodesic||i===d.e.Auto&&s.horizontal.value>1e5?"geodesic":"euclidean";return{mode:o,distance:"euclidean"===o?s.direct:n,directDistance:s.direct,horizontalDistance:s.horizontal,verticalDistance:s.vertical,geodesicDistance:n}}_euclideanDistances(e,t){const i=e.clone();i.z=t.z;const s=this._tempStartPosition,n=this._tempEndPosition,r=this._tempCornerPosition,o=this.view.spatialReference,a=this._sphericalPCPF,l=(0,b.Up)(o,a)?a:o;(0,b.KC)(e,s,l),(0,b.KC)(t,n,l),(0,b.KC)(i,r,l);const h=(0,g.i)(s,n),d=(0,g.i)(r,n),c=Math.abs(t.z-e.z),u=e=>this._unitNormalizer.normalizeDistance(e),_=u(h),m=u(d),v=u(c);return{direct:(0,p.EV)(_,"meters"),horizontal:(0,p.EV)(m,"meters"),vertical:(0,p.EV)(v,"meters")}}_geodesicDistance(e,t,i){const s=e.spatialReference,n=new y.Z({spatialReference:s});n.addPath([e,t]);const o=s.isGeographic&&(0,f.Gb)(s)?(0,f.Jf)([n],"meters")[0]:s.isWebMercator?(0,v.geodesicLength)(n,"meters"):null,a=(0,r.pC)(o)?o:this._fallbackGeodesicDistance(e,t,i);return(0,p.EV)(a,"meters")}_fallbackGeodesicDistance(e,t,i){if((0,b.UY)(e,L)&&(0,b.UY)(t,O)){const e={distance:0};return(0,f.cA)(e,L,O),e.distance}return i}};(0,s._)([(0,o.Cb)()],P.prototype,"view",void 0),(0,s._)([(0,o.Cb)()],P.prototype,"analysis",void 0),(0,s._)([(0,o.Cb)()],P.prototype,"viewData",void 0),(0,s._)([(0,o.Cb)()],P.prototype,"_computedResult",null),P=(0,s._)([(0,a.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],P);const L=(0,m.c)(),O=(0,m.c)();i(87090);var z,M,A,T=i(19431),E=i(10145),R=i(95550),V=i(17321),D=i(55709),G=i(18916);(A=z||(z={}))[A.None=0]="None",A[A.Direct=1]="Direct",A[A.Triangle=2]="Triangle",A[A.ProjectedGeodesic=3]="ProjectedGeodesic",function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(M||(M={}));var I=i(19570),j=i(6941),W=i(37926),k=i(39100),N=i(1983),H=i(68817),X=i(10449),$=i(6087),Y=i(7358),q=i(44685),U=i(25714),B=i(70984),F=i(5079),Z=i(46378),Q=i(21414),J=i(9969),K=i(52756),ee=i(67197),te=i(5474),ie=i(12045),se=i(95194),ne=i(86942),re=i(51027),oe=i(91907),ae=i(17346);class le extends K.A{constructor(e,t,i){super(e,t,i)}initializeProgram(e){const t=le.shader.get().build(this.configuration);return new se.$(e.rctx,t,te.i)}_setPipelineState(e){const t=e===B.Am.NONE,i=this.configuration;return(0,ae.sm)({blending:i.transparent?t?ie.wu:(0,ie.j7)(e):null,polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:oe.wb.LESS},depthWrite:ae.LZ,colorWrite:ae.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return oe.MX.TRIANGLE_STRIP}}le.shader=new J.J(re.M,(()=>i.e(827).then(i.bind(i,20827))));class he extends ne.W{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=B.Am.NONE}}(0,s._)([(0,ee.o)()],he.prototype,"polygonOffsetEnabled",void 0),(0,s._)([(0,ee.o)()],he.prototype,"transparent",void 0),(0,s._)([(0,ee.o)({count:B.Am.COUNT})],he.prototype,"transparencyPassType",void 0);class de extends Y.F5{constructor(e){super(e,new ue),this.techniqueConfig=new he}getConfiguration(e,t){return this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this.techniqueConfig.transparencyPassType=t?.transparencyPassType??B.Am.NONE,this.techniqueConfig}dispose(){}intersect(){}requiresSlot(e){return e===Z.r.OPAQUE_MATERIAL}createGLMaterial(e){return e.output===U.H.Color?new ce(e):null}createBufferWriter(){return new be}}class ce extends F.Z{beginSlot(e){return this.ensureTechnique(le,e)}}class ue extends Y.Mt{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=[1,.5,0,1],this.stripeLength=1,this.stripeEvenColor=[1,1,1,1],this.stripeOddColor=[1,.5,0,1],this.polygonOffset=!1}}const pe=(0,q.U$)().vec3f(Q.T.POSITION).vec3f(Q.T.NORMAL).vec2f(Q.T.UV0).f32(Q.T.AUXPOS1),_e=(0,m.c)(),ge=(0,m.c)(),me=(0,m.c)(),ve=(0,m.c)(),ye=(0,m.c)();class be{constructor(){this.vertexBufferLayout=pe}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices.get(Q.T.POSITION).length/2+1)}write(e,t,i,s){const n=t.vertexAttributes.get(Q.T.POSITION).data,r=t.vertexAttributes.get(Q.T.NORMAL).data,o=n.length/3,a=t&&t.indices&&t.indices.get(Q.T.POSITION);a&&a.length!==2*(o-1)&&console.warn("MeasurementArrowMaterial does not support indices");const l=_e,h=ge,d=me,c=ve,u=ye,p=e.transformation,_=e.invTranspTransformation,m=i.position,v=i.normal,y=i.uv0;let b=0;for(let e=0;e<o;++e){const t=3*e;if((0,g.s)(l,n[t],n[t+1],n[t+2]),e<o-1){const t=3*(e+1);(0,g.s)(h,n[t],n[t+1],n[t+2]),(0,g.s)(u,r[t],r[t+1],r[t+2]),(0,g.n)(u,u),(0,g.b)(d,h,l),(0,g.n)(d,d),(0,g.f)(c,u,d),(0,g.n)(c,c)}const i=(0,g.i)(l,h);p&&_&&((0,g.m)(l,l,p),(0,g.m)(h,h,p),(0,g.m)(c,c,_));const a=s+2*e,w=a+1;m.setVec(a,l),m.setVec(w,l),v.setVec(a,c),v.setVec(w,c),y.set(a,0,b),y.set(a,1,-1),y.set(w,0,b),y.set(w,1,1),e<o-1&&(b+=i)}const w=i.auxpos1;for(let e=0;e<2*o;++e)w.set(s+e,b)}}class we extends X._{constructor(e){super(e),this._parameters=fe,this._handles=null,this._origin=(0,m.c)(),this._originTransform=(0,k.c)(),this._arrowCenter=(0,m.c)(),this._renderOccluded=Y.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this.opacity,{arrowStripeEvenColor:t,arrowStripeOddColor:i}=this._parameters,s=(0,T.H)(Ce,this._stripesEnabled?t:i,e);this._arrowMaterial.setParameters({stripeEvenColor:s})}}get opacity(){return this._opacity}set opacity(e){e!==this._opacity&&(this._opacity=e,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:e,arrowStripeOddColor:t,arrowOutlineColor:i}=this._parameters,s=this._stripesEnabled?e:t;this._arrowMaterial=new de({outlineColor:i,stripeEvenColor:s,stripeOddColor:t,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new c.Z,this._handles.add((0,_.YP)((()=>this.view.state.camera),(()=>{this._viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if((0,r.Wi)(this._geometry)||(0,r.Wi)(this._geometry.startRenderSpace)||(0,r.Wi)(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this._viewChanged()}_createArrowGeometry(e,t,i,s){const n=this.view.renderCoordsHelper,r=[],o=[],a=(e,t)=>{const s=H.WM.get();(0,g.b)(s,e,i),r.push(s),o.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const i=H.WM.get();n.worldUpAtPosition(this._arrowCenter,i),a(e,i),a(t,i)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const i=t/(e-1),r=H.WM.get(),o=H.WM.get();s.eval(i,r),n.worldUpAtPosition(r,o),a(r,o)}}return $.Z.createPolylineGeometry(r,o)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&(0,r.pC)(this._geometry)){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*e})}}_updateArrowOpacity(){const e=this.opacity,{arrowStripeEvenColor:t,arrowStripeOddColor:i,arrowOutlineColor:s}=this._parameters,n=(0,T.H)(Ce,this._stripesEnabled?t:i,e),r=(0,T.H)(Se,s,e),o=(0,T.H)(xe,i,e);this._arrowMaterial.setParameters({stripeEvenColor:n,outlineColor:r,stripeOddColor:o})}}const fe={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},Ce=(0,N.c)(),Se=(0,N.c)(),xe=(0,N.c)();var Pe,Le=i(83061),Oe=i(60033),ze=i(66962),Me=i(8108),Ae=i(60720);!function(e){e[e.Pending=0]="Pending",e[e.Ready=1]="Ready",e[e.Destroyed=2]="Destroyed"}(Pe||(Pe={}));let Te=class extends n.Z{constructor(e){super(e),this._params={...Re},this._handles=new c.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,m.c)(),this._endPosition=(0,m.c)(),this._cornerPosition=(0,m.c)(),this._startPositionAtSeaLevel=(0,m.c)(),this._endPositionAtSeaLevel=(0,m.c)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=M.Auto,this.triangleCollapseRatioThreshold=.03}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if((0,r.Wi)(e)||(0,r.Wi)(t)||e.equals(t))return z.None;const i=this.analysisView.result;if((0,r.Wi)(i))return z.Direct;if("geodesic"===i.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?z.ProjectedGeodesic:z.Direct;const{verticalDistance:s,horizontalDistance:n}=i,o=s.value,a=n.value;return Math.min(o/a,a/o)<this.triangleCollapseRatioThreshold?z.Direct:z.Triangle}get actualVisualizedMeasurement(){if((0,r.Wi)(this.analysisView.result))switch(this.analysisView.measurementMode){case d.e.Auto:case d.e.Euclidean:default:return"euclidean";case d.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return(0,r.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,r.Wi)(this._triangleOrientationOverride)!==e&&((0,r.Wi)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){const e="geodesic"===this.actualVisualizedMeasurement;return{direct:this._segmentLabel,horizontal:e?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}initialize(){const e=this._params,t={attached:!0,view:this.view};this._segmentVisualElement=new we({...t,geometry:null,renderOccluded:Y.yD.OccludeAndTransparent}),this._triangleVisualElement=new W.r({...t,width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:Y.yD.OccludeAndTransparent}),this._rightAngleQuad=new Le.R({...t,color:Ee,renderOccluded:Y.yD.OccludeAndTransparent});const i={...t,polygonOffset:!0,renderOccluded:Y.yD.OccludeAndTransparent};this._projectedGeodesicLine=new W.r({...i,width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,ze.z5)(e.guideStippleLengthPixels)}),this._geodesicStartHint=new W.r({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,ze.z5)(e.guideStippleLengthPixels)}),this._geodesicEndHint=new W.r({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,ze.z5)(e.guideStippleLengthPixels)}),this._segmentLabel=new j.Kc({...t,fontSize:e.direcLabelFontSize}),this._verticalLabel=new j.Kc({...t,fontSize:e.verticalLabelFontSize}),this._horizontalLabel=new j.Kc({...t,fontSize:e.horizontalLabelFontSize}),this._handles.add([(0,_.YP)((()=>{const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView,i=this.view;return{view:i,camera:i.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}}),(e=>this._updateGeometryAndViewMode(e)),_.tX),(0,_.YP)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateVisualElementVisibility(e)),_.tX),(0,_.YP)((()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement})),(e=>this._updateLabelText(e)),_.tX),(0,_.YP)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateLabelVisibility(e)),_.tX),(0,_.YP)((()=>this._measurementArrowStripeLength),(e=>this._updateSegmentStripeLength(e)),_.tX),(0,Me.qe)((async()=>this._updateMessageBundle()))]),this._updateMessageBundle()}destroy(){this._handles=(0,r.SC)(this._handles),this._segmentVisualElement=(0,r.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,r.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,r.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,r.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,r.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,r.SC)(this._geodesicEndHint),this._segmentLabel=(0,r.SC)(this._segmentLabel),this._verticalLabel=(0,r.SC)(this._verticalLabel),this._horizontalLabel=(0,r.SC)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case z.None:break;case z.Direct:this._segmentVisualElement.visible=!0;break;case z.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case z.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:n,orientation:o,visualizedMeasurement:a,stripeLength:l}){const h=e.renderCoordsHelper;if((0,r.Wi)(h)||(0,r.Wi)(s)||(0,r.Wi)(n)||s.equals(n))return;let d=this._startPosition,c=this._endPosition;h.toRenderCoords(s,d),h.toRenderCoords(n,c);const u=o===M.AboveSegment?1:-1,p=u*(h.getAltitude(c)-h.getAltitude(d));p<0&&(d=this._endPosition,c=this._startPosition);const _="geodesic"===a?new Oe.u4(this._startPosition,this._endPosition,h.spatialReference):new Oe.y$(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=_,this._updateSegmentStripeLength(l),i){case z.Direct:this._updateSegment(_,o);break;case z.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:_,orientation:o,startPosition:d,endPosition:c,deltaSign:u,altitudeDelta:p});break;case z.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:o,startPosition:d,endPosition:c})}}_updateSegment(e,t){this._segmentLabel.anchor=t===M.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:i,orientation:s,startPosition:n,endPosition:r,deltaSign:o,altitudeDelta:a}){const l=this._cornerPosition;e.worldUpAtPosition(n,l),(0,g.g)(l,l,o*Math.abs(a)),(0,g.a)(l,l,n),this._triangleVisualElement.geometry=[[[n[0],n[1],n[2]],[l[0],l[1],l[2]],[r[0],r[1],r[2]]]],this._rightAngleQuad.geometry={previous:n,center:l,next:r};const h=new Oe.y$(n,l),d=new Oe.y$(l,r),c=function(e,t,i,s,n){const r=De,o=Ge;n.projectToRenderScreen(i,r),n.projectToRenderScreen(t,o);const a={segment:"bottom",horizontal:"top",vertical:r[0]<o[0]?"left":"right"};{const s=Ie,r=je;if((0,I.c)(e,i,s,n),(0,I.c)(e,t,r,n),(0,D.h)(s,r)>=Ve){const e=Math.sign(s[1])===Math.sign(r[1]);a.segment=e?(0,j.jB)(a.vertical):a.vertical}else{const e=We;(0,I.c)(i,t,e,n),(0,D.h)(e,r)>=Ve&&(a.segment=Math.sign(e[0])===Math.sign(r[0])?(0,j.jB)(a.horizontal):a.horizontal)}}if(s===M.BelowSegment){const e=e=>"top"===e?"bottom":"top";a.segment=e(a.segment),a.horizontal=e(a.horizontal),a.vertical=e(a.vertical)}return a}(n,r,l,s,t);this._segmentLabel.anchor=c.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._verticalLabel.anchor=c.vertical,this._horizontalLabel.geometry={type:"segment",segment:d,sampleLocation:"center"},this._horizontalLabel.anchor=c.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:i,endPosition:s}){e.setAltitude(this._startPositionAtSeaLevel,0,i),e.setAltitude(this._endPositionAtSeaLevel,0,s);const n=new Oe.u4(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(n),this._geodesicStartHint.setGeometryFromSegment(new Oe.y$(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new Oe.y$(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:n,sampleLocation:"center"},this._segmentLabel.anchor=t===M.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){(0,r.pC)(e)?(this._segmentLabel.text="euclidean"===t?e.euclideanDistance:e.geodesicDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:e,viewMode:t}){const i=this._segmentLabel,s=this._horizontalLabel,n=this._verticalLabel;if(i.visible=!1,s.visible=!1,n.visible=!1,e)switch(t){case z.Direct:i.visible=!0;break;case z.Triangle:i.visible=!0,s.visible=!0,n.visible=!0;break;case z.ProjectedGeodesic:i.visible=!0;case z.None:}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,t=this.analysisView.result;if((0,r.Wi)(t)||(0,r.Wi)(e))return null;const{directDistance:i,horizontalDistance:s,verticalDistance:n,geodesicDistance:o}=t,a=this.analysisView.unit,l=e=>({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:"",...e});switch(a){case"metric":return l({euclideanDistance:i&&(0,E.Rd)(e,i),geodesicDistance:o&&(0,E.Rd)(e,o),horizontalDistance:s&&(0,E.Rd)(e,s),verticalDistance:n&&(0,E.Wv)(e,n)});case"imperial":return l({euclideanDistance:i&&(0,E.Ud)(e,i),geodesicDistance:o&&(0,E.Ud)(e,o),horizontalDistance:s&&(0,E.Ud)(e,s),verticalDistance:n&&(0,E.Zv)(e,n)});default:return l({euclideanDistance:i&&(0,E.VG)(e,i,a),geodesicDistance:o&&(0,E.VG)(e,o,a),horizontalDistance:s&&(0,E.VG)(e,s,a),verticalDistance:n&&(0,E.VG)(e,n,a)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;(0,r.pC)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if((0,r.pC)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===M.Auto?this.view.state.camera.aboveGround?M.AboveSegment:M.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(!t?.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper,n=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/n>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if((0,r.Wi)(e))return null;let i=null;const s=e.directDistance;switch(t){case"metric":i=s&&(0,p.nn)(s,"meters");break;case"imperial":i=s&&(0,p.nn)(s,(0,V.FN)(s.value,s.unit));break;default:i=s&&(0,p.nn)(s,t)}return(0,r.Wi)(i)?null:(0,T.sk)(i.value/30)*(0,V.En)(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,Ae.ME)("esri/core/t9n/Units").then((e=>{this.messages=e})).finally((()=>{this.loadingMessages=!1}))}get testData(){return{labels:this.labels,stripeLength:this._segmentVisualElement?.stripeLength}}};(0,s._)([(0,o.Cb)()],Te.prototype,"_triangleOrientationOverride",void 0),(0,s._)([(0,o.Cb)()],Te.prototype,"messages",void 0),(0,s._)([(0,o.Cb)()],Te.prototype,"view",void 0),(0,s._)([(0,o.Cb)()],Te.prototype,"analysis",void 0),(0,s._)([(0,o.Cb)()],Te.prototype,"analysisView",void 0),(0,s._)([(0,o.Cb)()],Te.prototype,"loadingMessages",void 0),(0,s._)([(0,o.Cb)()],Te.prototype,"visible",null),(0,s._)([(0,o.Cb)()],Te.prototype,"viewMode",null),(0,s._)([(0,o.Cb)()],Te.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,o.Cb)()],Te.prototype,"visualElementOrientation",void 0),(0,s._)([(0,o.Cb)()],Te.prototype,"triangleCollapseRatioThreshold",void 0),(0,s._)([(0,o.Cb)()],Te.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,o.Cb)()],Te.prototype,"labels",null),(0,s._)([(0,o.Cb)()],Te.prototype,"_labelsText",null),(0,s._)([(0,o.Cb)()],Te.prototype,"_actualVisualElementsOrientation",null),(0,s._)([(0,o.Cb)()],Te.prototype,"_measurementArrowStripeLength",null),Te=(0,s._)([(0,a.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],Te);const Ee=(0,G.f)(1,.5,0,.75),Re={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:Ee,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:Ee,guideLineWidth:2,guideLineColor:Ee,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},Ve=Math.cos((0,T.Vl)(12)),De=(0,R.J$)(),Ge=(0,R.J$)(),Ie=(0,R.gX)(),je=(0,R.gX)(),We=(0,R.gX)();let ke=class extends((0,h.p)(n.Z)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=d.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new Te({view:e,analysis:t,analysisView:this}),this._analysisController=new P({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=(0,r.SC)(this._analysisController),this._analysisVisualization=(0,r.SC)(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct.text}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal.text}get verticalLabelText(){return this._analysisVisualization.labels.vertical.text}get unit(){return(0,r.Pt)(this.analysis.unit,this._defaultUnit)}get testData(){return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:{...this._analysisVisualization?.testData,visualization:this._analysisVisualization,controller:this._analysisController}}};(0,s._)([(0,o.Cb)()],ke.prototype,"updating",null),(0,s._)([(0,o.Cb)({readOnly:!0})],ke.prototype,"type",void 0),(0,s._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],ke.prototype,"analysis",void 0),(0,s._)([(0,o.Cb)()],ke.prototype,"result",void 0),(0,s._)([(0,o.Cb)()],ke.prototype,"measurementMode",void 0),(0,s._)([(0,o.Cb)()],ke.prototype,"elevationAlignedStartPoint",void 0),(0,s._)([(0,o.Cb)()],ke.prototype,"elevationAlignedEndPoint",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],ke.prototype,"viewMode",null),(0,s._)([(0,o.Cb)({readOnly:!0})],ke.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,o.Cb)()],ke.prototype,"visualElementOrientation",null),(0,s._)([(0,o.Cb)()],ke.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,o.Cb)()],ke.prototype,"triangleCollapseRatioThreshold",null),(0,s._)([(0,o.Cb)({readOnly:!0})],ke.prototype,"directLabelText",null),(0,s._)([(0,o.Cb)({readOnly:!0})],ke.prototype,"horizontalLabelText",null),(0,s._)([(0,o.Cb)({readOnly:!0})],ke.prototype,"verticalLabelText",null),(0,s._)([(0,o.Cb)()],ke.prototype,"_analysisVisualization",void 0),(0,s._)([(0,o.Cb)()],ke.prototype,"_analysisController",void 0),(0,s._)([(0,o.Cb)()],ke.prototype,"unit",null),(0,s._)([(0,o.Cb)(l.Y)],ke.prototype,"_defaultUnit",void 0),ke=(0,s._)([(0,a.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],ke);const Ne=ke},6941:(e,t,i)=>{i.d(t,{Kc:()=>O,jB:()=>M});var s=i(44584),n=i(61681),r=i(76868),o=i(95550),a=i(55709),l=i(6766),h=i(8909),d=i(76169),c=i(86),u=i(36663),p=i(53443),_=i(81977),g=(i(7753),i(39994),i(7283),i(40266));i(56803);let m=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),v=(e,t,i)=>{for(let s=0,n=t.length;s<n;s++){let n=t[s];Array.isArray(n)?v(e,n,i):null!=n&&!1!==n&&("string"==typeof n&&(n=m(n)),i.push(n))}};function y(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let s,n;return i&&1===i.length&&"string"==typeof i[0]?s=i[0]:i&&(n=[],v(e,i,n),0===n.length&&(n=void 0)),{vnodeSelector:e,properties:t,children:n,text:""===s?void 0:s,domNode:null}}i(22591);let b=class extends p.Z{constructor(e){super(e),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0}get startPosition(){return[this.startX,this.startY]}set startPosition(e){this._set("startX",e[0]),this._set("startY",e[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(e){this._set("endX",e[0]),this._set("endY",e[1])}get strokeStyle(){const e=this.color;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get lineCap(){return"round"}render(){const{height:e,left:t,top:i,width:s,x1:n,x2:r,y1:o,y2:a}=this._calculateCoordinates(w),l=`stroke: ${this.strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this.lineCap};`;return y("div",{classes:{"esri-line-overlay-item":!0},styles:{left:t+"px",top:i+"px",width:s+"px",height:e+"px",visibility:this.visible?"visible":"hidden"}},[y("svg",{width:s,height:e},[y("line",{x1:n,y1:o,x2:r,y2:a,style:l})])])}renderCanvas(e){if(!this.visible)return;e.strokeStyle=this.strokeStyle,e.lineWidth=this.width,e.lineCap=this.lineCap;const t=this._calculateCoordinates(w);e.beginPath(),e.moveTo(t.left+t.x1,t.top+t.y1),e.lineTo(t.left+t.x2,t.top+t.y2),e.stroke()}_calculateCoordinates(e){const t=Math.min(this.startX,this.endX),i=Math.max(this.startX,this.endX),s=Math.min(this.startY,this.endY),n=Math.max(this.startY,this.endY),r=this.width;return e.left=t-r,e.top=s-r,e.width=i-t+2*r,e.height=Math.max(20,n-s+2*r),e.x1=this.startX-t+r,e.y1=this.startY-s+r,e.x2=this.endX-t+r,e.y2=this.endY-s+r,e}};(0,u._)([(0,_.Cb)()],b.prototype,"startX",void 0),(0,u._)([(0,_.Cb)()],b.prototype,"startY",void 0),(0,u._)([(0,_.Cb)()],b.prototype,"endX",void 0),(0,u._)([(0,_.Cb)()],b.prototype,"endY",void 0),(0,u._)([(0,_.Cb)()],b.prototype,"startPosition",null),(0,u._)([(0,_.Cb)()],b.prototype,"endPosition",null),(0,u._)([(0,_.Cb)()],b.prototype,"width",void 0),(0,u._)([(0,_.Cb)()],b.prototype,"color",void 0),(0,u._)([(0,_.Cb)()],b.prototype,"visible",void 0),(0,u._)([(0,_.Cb)({readOnly:!0})],b.prototype,"strokeStyle",null),b=(0,u._)([(0,g.j)("esri.views.overlay.LineOverlayItem")],b);const w={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0},f=b,C={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let S=class extends p.Z{constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this._backgroundColor="rgba(0, 0, 0, 0.6)",this._textColor="white",this._textShadowColor=[0,0,0],this._textShadowSize=1}get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadow(){const[e,t,i]=this._textColor;return`0 0 ${this._textShadowSize}px rgb(${e}, ${t}, ${i})`}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}render(){return y("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this._backgroundColor,color:this._textColor,padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const i=this._padding,s=this._borderRadius,n=e.measureText(this.text).width,r=this.fontSize,o=x[this.anchor];e.textAlign="center",e.textBaseline="middle";const a=n+2*i,l=r+2*i,h=this.x+o.x*a,d=this.y+o.y*l;this._roundedRect(e,h,d,a,l,s),e.fillStyle=this._backgroundColor,e.fill();const c=this.x+(o.x+.5)*a,u=this.y+(o.y+.5)*l;this._renderTextShadow(e,this.text,c,u),e.fillStyle=this._textColor,e.fillText(this.text,c,u)}_renderTextShadow(e,t,i,s){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor[0]}, ${this._textShadowColor[1]}, ${this._textShadowColor[2]}, ${1/P.length})`;const n=this._textShadowSize;for(const[r,o]of P)e.fillText(t,i+n*r,s+n*o)}_roundedRect(e,t,i,s,n,r){e.beginPath(),e.moveTo(t,i+r),e.arcTo(t,i,t+r,i,r),e.lineTo(t+s-r,i),e.arcTo(t+s,i,t+s,i+r,r),e.lineTo(t+s,i+n-r),e.arcTo(t+s,i+n,t+s-r,i+n,r),e.lineTo(t+r,i+n),e.arcTo(t,i+n,t,i+n-r,r),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};for(const t in C)e[C[t]]=this.anchor===t;return e}};(0,u._)([(0,_.Cb)()],S.prototype,"x",void 0),(0,u._)([(0,_.Cb)()],S.prototype,"y",void 0),(0,u._)([(0,_.Cb)()],S.prototype,"position",null),(0,u._)([(0,_.Cb)()],S.prototype,"text",void 0),(0,u._)([(0,_.Cb)()],S.prototype,"fontSize",void 0),(0,u._)([(0,_.Cb)()],S.prototype,"anchor",void 0),(0,u._)([(0,_.Cb)()],S.prototype,"visible",void 0),(0,u._)([(0,_.Cb)()],S.prototype,"_backgroundColor",void 0),(0,u._)([(0,_.Cb)()],S.prototype,"_textColor",void 0),(0,u._)([(0,_.Cb)()],S.prototype,"_textShadowColor",void 0),(0,u._)([(0,_.Cb)()],S.prototype,"_textShadowSize",void 0),(0,u._)([(0,_.Cb)()],S.prototype,"_textShadow",null),(0,u._)([(0,_.Cb)()],S.prototype,"_padding",null),(0,u._)([(0,_.Cb)()],S.prototype,"_borderRadius",null),S=(0,u._)([(0,g.j)("esri.views.overlay.TextOverlayItem")],S);const x={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},P=[];{const e=16;for(let t=0;t<360;t+=360/e)P.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const L=S;class O extends d.l{constructor(e){super(e.view),this._handles=new s.Z,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text="-",this._fontSize=14,this._distance=25,this._anchor="right",this.applyProps(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._updateLabelPosition()}get textItem(){return this._textItem}get text(){return this._text}set text(e){this._text=e,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e,this.attached&&(this._textItem.fontSize=this._fontSize)}get distance(){return this._distance}set distance(e){this._distance!==e&&(this._distance=e,this._updateLabelPosition())}get anchor(){return this._anchor}set anchor(e){this._anchor!==e&&(this._anchor=e,this._updateLabelPosition())}overlaps(e){return!!this.attached&&this.textItem.visible&&e.textItem.visible&&this.view.overlay.overlaps(this._textItem,e.textItem)}_updateLabelPosition(){if(!this.attached)return;this._showText=!1,this._showCallout=!1;const{geometry:e,view:t,visible:i}=this;if((0,n.pC)(e)&&t._stage)switch(e.type){case"point":if(!this._computeLabelPositionFromPoint(e.point,j))break;if(e.callout){const i=t.state.camera,s=e.callout.distance;(0,a.b)(I,I,[0,e.callout.offset]),i.renderToScreen(I,j),(0,a.a)(D,0,1),(0,a.f)(D,D,s*i.pixelRatio),(0,a.b)(D,D,I),i.renderToScreen(D,W),this._showCallout=this._updatePosition(j,W)}else this._textItem.position=[j[0],j[1]],this._textItem.anchor="center";this._showText=!0;break;case"corner":if(!this._computeLabelPositionFromCorner(e,this._distance,j,W))break;this._showCallout=this._updatePosition(j,W),this._showText=!0;break;case"segment":{if(!this._computeLabelPositionFromSegment(e,this._distance,this._anchor,j,W))break;this._showText=!0;const t=this._updatePosition(j,W);this._showCallout=!1!==e.callout&&t,this._showCallout||(this._textItem.anchor="center")}}this.updateVisibility(i)}_computeLabelPositionFromPoint(e,t){const i=this.view.state.camera;return i.projectToRenderScreen(e,I),!(I[2]<0||I[2]>1||(i.renderToScreen(I,t),0))}_computeLabelPositionFromCorner(e,t,i,s){if(!e)return!1;const n=this.view.state.camera;return z(e.left,1,n,R),(0,a.n)(R,R),z(e.right,0,n,V),(0,a.b)(D,R,V),(0,a.n)(D,D),(0,a.i)(D,D),n.projectToRenderScreen(e.left.endRenderSpace,I),!(I[2]<0||I[2]>1||(n.renderToScreen(I,i),(0,a.f)(D,D,t*n.pixelRatio),(0,a.b)(D,D,I),n.renderToScreen(D,s),0))}_computeLabelPositionFromSegment(e,t,i,s,n){if(!e)return!1;const r=e.segment,o=this.view.state.camera;(0,c.CM)(r.startRenderSpace,r.endRenderSpace,o,R),(0,a.a)(D,-R[1],R[0]);let l=!1;switch(i){case"top":l=D[1]<0;break;case"bottom":l=D[1]>0;break;case"left":l=D[0]>0;break;case"right":l=D[0]<0}if(l&&(0,a.n)(D,D),0===(0,a.o)(D))switch(i){case"top":D[1]=1;break;case"bottom":D[1]=-1;break;case"left":D[0]=-1;break;case"right":D[0]=1}return r.eval($[e.sampleLocation],G),o.projectToRenderScreen(G,I),!(I[2]<0||I[2]>1||(o.renderToScreen(I,s),(0,a.f)(D,D,t*o.pixelRatio),(0,a.b)(D,D,I),o.renderToScreen(D,n),0))}_updatePosition(e,t){if(t){const i=t[0]-e[0],s=t[1]-e[1];return this._textItem.position=[t[0],t[1]],this._textItem.anchor=Math.abs(i)>Math.abs(s)?i>0?"left":"right":s>0?"top":"bottom",this._calloutItem.startPosition=[e[0],e[1]],this._calloutItem.endPosition=[t[0],t[1]],!0}return this._textItem.position=[e[0],e[1]],this._textItem.anchor="center",!1}createResources(){this._textItem=new L({visible:!0,text:this._text,fontSize:this._fontSize}),this._calloutItem=new f({visible:!0,width:2}),this._updateLabelPosition(),this.view.overlay.items.addMany([this._textItem,this._calloutItem]),this._handles.add((0,r.YP)((()=>this.view.state.camera),(()=>this._updateLabelPosition())))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(e){this._textItem.visible=this._showText&&e,this._calloutItem.visible=this._showCallout&&e}}function z(e,t,i,s){e.eval(t,A,E),(0,l.a)(T,A,E),i.projectToRenderScreen(A,k),i.projectToRenderScreen(T,H),(0,a.g)(s,X,N),(0,a.i)(s,s)}function M(e){switch(e){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}const A=(0,h.c)(),T=(0,h.c)(),E=(0,h.c)(),R=(0,o.gX)(),V=(0,o.gX)(),D=(0,o.gX)(),G=(0,h.c)(),I=(0,o.J$)(),j=(0,o.s1)(),W=(0,o.s1)(),k=(0,o.J$)(),N=k,H=(0,o.J$)(),X=H,$={start:0,center:.5,end:1}},83061:(e,t,i)=>{i.d(t,{R:()=>w});var s=i(44584),n=i(61681),r=i(76868),o=i(24455),a=i(39100),l=i(6766),h=i(8909),d=i(88589),c=i(18916),u=i(68817),p=i(10449),_=i(47562),g=i(6087),m=i(7358),v=i(21414),y=i(84891),b=i(65392);class w extends p._{constructor(e){super(e),this._handles=new s.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,h.c)(),this._up=(0,h.c)(),this._right=(0,h.c)(),this._renderOccluded=m.yD.OccludeAndTransparent,this._color=(0,c.f)(1,0,0,1),this._outlineColor=(0,c.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=m.yD.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,d.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,d.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,l.i)(t,e),(0,l.i)(t,i))/3,(0,l.n)(this._up,(0,l.b)(this._up,e,t)),(0,l.n)(this._right,(0,l.b)(this._right,i,t)),(0,l.c)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new y.E(this.quadMaterialParameters),this._outlineMaterial=new b.U(this.outlineMaterialParameters),this._handles.add((0,r.YP)((()=>this.view.state.camera),(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,l.a)(u.WM.get(),this._up,this._right),i=g.Z.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,i);(0,o.f)(f,this._position),(0,o.h)(f,f,[s,s,s]),(0,n.pC)(e)&&(e.transformation=f)}_quadGeometryData(e,t){const i=(0,l.a)(u.WM.get(),e,t);return new _.Z([[v.T.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[v.T.POSITION,new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}const f=(0,a.c)()},60033:(e,t,i)=>{i.d(t,{u4:()=>d,y$:()=>h});var s=i(6766),n=i(8909),r=i(90472),o=i(25726),a=i(68817),l=i(35369);class h{constructor(e=(0,n.c)(),t=(0,n.c)()){this.startRenderSpace=e,this.endRenderSpace=t,this.type="euclidean"}eval(e,t,i){return(0,s.h)(t,this.startRenderSpace,this.endRenderSpace,e),i&&((0,s.b)(i,this.endRenderSpace,this.startRenderSpace),(0,s.n)(i,i)),t}createRenderGeometry(e,t){const i=[],n=[],r=(t,r)=>{const o=u;(0,s.b)(o,t,e),i.push([o[0],o[1],o[2]]),n.push([r[0],r[1],r[2]])},o=t.worldUpAtPosition(this.eval(.5,c),a.WM.get());return r(this.startRenderSpace,o),r(this.endRenderSpace,o),{points:i,normals:n}}static fromPositionAndVector(e,t,i=1){return(0,s.g)(c,t,i),(0,s.a)(c,e,c),new h((0,n.a)(e),(0,n.a)(c))}}class d{constructor(e,t,i){this.startRenderSpace=e,this.endRenderSpace=t,this.renderSpatialReference=i,this.type="geodesic",this._start=(0,n.c)(),this._end=(0,n.c)(),this._pcpf=(0,o.rS)(i),this._project=(0,r.Up)(i,this._pcpf),this._projectIn(e,this._start),this._projectIn(t,this._end)}_projectIn(e,t){this._project?(0,r.SH)(e,this.renderSpatialReference,t,this._pcpf):(0,s.c)(t,e)}eval(e,t,i){if(this._project)if(i){const n=u;(0,l.ek)(this._start,this._end,e,t,n),(0,s.a)(p,t,n),(0,r.SH)(t,this._pcpf,t,this.renderSpatialReference),(0,r.SH)(p,this._pcpf,p,this.renderSpatialReference),(0,s.b)(i,p,t),(0,s.n)(i,i)}else(0,l.ZA)(this._start,this._end,e,t),(0,r.SH)(t,this._pcpf,t,this.renderSpatialReference);else(0,s.h)(t,this._start,this._end,e),i&&((0,s.b)(i,this._end,this._start),(0,s.n)(i,i));return t}createRenderGeometry(e,t){const i=[],n=[],r=(t,r)=>{const o=p;(0,s.b)(o,t,e),i.push([o[0],o[1],o[2]]),n.push([r[0],r[1],r[2]])};for(let e=0;e<128;++e){const i=e/127,s=c,n=u;this.eval(i,s),t.worldUpAtPosition(s,n),r(s,n)}return{points:i,normals:n}}}const c=(0,n.c)(),u=(0,n.c)(),p=(0,n.c)()},86:(e,t,i)=>{i.d(t,{$r:()=>h,By:()=>c,CM:()=>l,a7:()=>d});var s=i(95550),n=i(55709),r=(i(6766),i(8909)),o=i(53446),a=i(83772);function l(e,t,i,s){i.projectToRenderScreen(e,_),i.projectToRenderScreen(t,g),(0,n.g)(s,g,_),(0,n.i)(s,s)}function h(e,t,i,s,n=(0,r.c)()){const o=t.toXYZ(e);return o[2]=(0,a.zx)(s,o,t.spatialReference,i)||0,s.renderCoordsHelper.toRenderCoords(o,t.spatialReference,n),n}function d(e,t,i,n){return"2d"===n.type?n.toScreen(t.vectorToPoint(e,u)):(h(e,t,i,n,p),n.state.camera.projectToScreen(p,m),(0,s.vW)(m[0],m[1]))}function c(e,t,i,s,n,r,o){const l=i.toXYZ(e),h=i.toXYZ(t);if("absolute-height"!==s.mode){const e=(0,a.zx)(n,l,i.spatialReference,s),t=(0,a.zx)(n,h,i.spatialReference,s),r=(null==e?t:null==t?e:Math.min(e,t))||0;l[2]=r,h[2]=r}n.renderCoordsHelper.toRenderCoords(l,i.spatialReference,r),n.renderCoordsHelper.toRenderCoords(h,i.spatialReference,o)}const u=new o.Z,p=(0,r.c)(),_=(0,s.J$)(),g=(0,s.J$)(),m=(0,s.s1)();(0,s.s1)()}}]);