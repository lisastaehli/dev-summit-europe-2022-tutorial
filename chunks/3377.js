"use strict";(self.webpackChunkberlin_equal_street_names=self.webpackChunkberlin_equal_street_names||[]).push([[3377,7710,2084],{24065:(e,t,s)=>{s.d(t,{R:()=>p});var i=s(36663),r=s(53443),n=s(53280),l=s(61681),a=s(84684),o=s(81977),c=(s(7753),s(39994),s(7283),s(40266)),d=s(51599),u=s(21586),h=s(93698);const y={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let p=class extends((0,n.p)(r.Z)){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const t=(0,u.f)(this.floors,e);return e.toExportImageJSON(t)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,h.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(y[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,t=this.visibleSublayers.filter((t=>null!=t.definitionExpression||e&&null!=t.floorInfo));return t.length?JSON.stringify(t.reduce(((e,t)=>{const s=(0,u.f)(this.floors,t),i=(0,a._)(s,t.definitionExpression);return(0,l.pC)(i)&&(e[t.id]=i),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,s=t=>{const i=this.scale,r=0===i,n=0===t.minScale||i<=t.minScale,l=0===t.maxScale||i>=t.maxScale;t.visible&&(r||n&&l)&&(t.sublayers?t.sublayers.forEach(s):e.unshift(t))};t&&t.forEach(s);const i=this._get("visibleSublayers");return!i||i.length!==e.length||i.some(((t,s)=>e[s]!==t))?e:i}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};(0,i._)([(0,o.Cb)({readOnly:!0})],p.prototype,"dynamicLayers",null),(0,i._)([(0,o.Cb)()],p.prototype,"floors",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],p.prototype,"hasDynamicLayers",null),(0,i._)([(0,o.Cb)()],p.prototype,"layer",null),(0,i._)([(0,o.Cb)({readOnly:!0})],p.prototype,"layers",null),(0,i._)([(0,o.Cb)({readOnly:!0})],p.prototype,"layerDefs",null),(0,i._)([(0,o.Cb)({type:Number})],p.prototype,"scale",void 0),(0,i._)([(0,o.Cb)(d.qG)],p.prototype,"timeExtent",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],p.prototype,"version",null),(0,i._)([(0,o.Cb)({readOnly:!0})],p.prototype,"visibleSublayers",null),p=(0,i._)([(0,c.j)("esri.layers.mixins.ExportImageParameters")],p)},21586:(e,t,s)=>{function i(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?n(e.view.floors,t.floorInfo.floorField):null}function r(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?n(e,t.floorInfo.floorField):null}function n(e,t){if(!e?.length)return null;const s=e.filter((e=>""!==e)).map((e=>`'${e}'`));return s.push("''"),`${t} IN (${s.join(",")}) OR ${t} IS NULL`}s.d(t,{c:()=>i,f:()=>r})},93698:(e,t,s)=>{s.d(t,{FN:()=>l,QV:()=>n,ac:()=>o});var i=s(61681),r=s(65943);function n(e,t,s){const i=t.flatten((({sublayers:e})=>e)).length;return i!==e.length||!!e.some((e=>e.originIdOf("minScale")>s||e.originIdOf("maxScale")>s||e.originIdOf("renderer")>s||e.originIdOf("labelingInfo")>s||e.originIdOf("opacity")>s||e.originIdOf("labelsVisible")>s||e.originIdOf("source")>s))||!a(e,t)}function l(e,t,s){return!!e.some((e=>{const t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&((0,i.Wi)(t.gdbVersion)||t.gdbVersion===s))||e.originIdOf("renderer")>r.s3.SERVICE||e.originIdOf("labelingInfo")>r.s3.SERVICE||e.originIdOf("opacity")>r.s3.SERVICE||e.originIdOf("labelsVisible")>r.s3.SERVICE}))||!a(e,t)}function a(e,t){if(!e||!e.length||(0,i.Wi)(t))return!0;const s=t.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>s.length)return!1;let r=0;const n=s.length;for(const{id:t}of e){for(;r<n&&s[r]!==t;)r++;if(r>=n)return!1}return!0}function o(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}},73572:(e,t,s)=>{s.d(t,{e:()=>l,s:()=>a}),s(39994);var i=s(70375),r=s(61681),n=s(37193);function l(e){return(0,r.Wi)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function a(e){if((0,r.Wi)(e))return null;if(!l(e))return new i.Z("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return o(t=e,(0,n.q)(t.symbol).error);case"unique-value":return function(e){const t=e.uniqueValueInfos.map((e=>(0,n.q)(e.symbol).error)).filter((e=>!!e)),s=(0,n.q)(e.defaultSymbol);return s.error&&t.unshift(s.error),o(e,t)}(e);case"class-breaks":return function(e){const t=e.classBreakInfos.map((e=>(0,n.q)(e.symbol).error)).filter((e=>!!e)),s=(0,n.q)(e.defaultSymbol);return s.error&&t.unshift(s.error),o(e,t)}(e);case"dictionary":case"heatmap":return null}var t;return null}function o(e,t){if(!t)return null;let s;if(s=Array.isArray(t)?t:[t],s.length>0){const t=s.map((e=>e.details.symbol.type||e.details.symbol.declaredClass)).filter((e=>!!e));t.sort();const r=[];return t.forEach(((e,s)=>{0!==s&&e===t[s-1]||r.push(e)})),new i.Z("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${r.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:s})}return null}},52084:(e,t,s)=>{s.r(t),s.d(t,{getPatternDescriptor:()=>V,getSizeFromOptions:()=>z,getSymbolLayerFill:()=>E,previewSymbol3D:()=>M});var i=s(36567),r=s(39043),n=(s(39994),s(70375)),l=s(13802),a=s(61681),o=s(78668),c=s(95550),d=s(89298),u=s(52285),h=s(4125),y=s(83773),p=s(5840),f=s(59672),m=s(77710);const g=y.b_.size,b=y.b_.maxSize,_=y.b_.maxOutlineSize,v=y.b_.lineWidth,L=y.b_.tallSymbolWidth,w=l.Z.getLogger("esri.symbols.support.previewSymbol3D");function S(e){const t=e.outline,s=(0,a.pC)(e.material)?e.material.color:null,i=(0,a.pC)(s)?s.toHex():null;if((0,a.Wi)(t)||"pattern"in t&&(0,a.pC)(t.pattern)&&"style"===t.pattern.type&&"none"===t.pattern.style)return"fill"===e.type&&"#ffffff"===i?{color:"#bdc3c7",width:.75}:null;const r=(0,c.F2)(t.size)||0;return{color:"rgba("+((0,a.pC)(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(r,_),style:"pattern"in t&&(0,a.pC)(t.pattern)&&"style"===t.pattern.type?(0,d.Sp)(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function I(e,t=1){const s=e.a,i=(0,r._Y)(e),n=i.h,l=i.s/t,a=100-(100-i.v)/t,{r:o,g:c,b:d}=(0,r.xr)({h:n,s:l,v:a});return[o,c,d,s]}function C(e){return"water"===e.type?(0,a.Wi)(e.color)?null:e.color:(0,a.Wi)(e.material)||(0,a.Wi)(e.material.color)?null:e.material.color}function E(e,t=0){const s=C(e);if(!s){if("fill"===e.type)return null;const s=d.Ne.r,i=(0,y.uH)(s,t);return[i,i,i,100]}const i=s.toRgba();for(let e=0;e<3;e++)i[e]=(0,y.uH)(i[e],t);return i}async function V(e,t){const s=e.style;return"none"===s?null:{type:"pattern",x:0,y:0,src:await(0,d.Od)((0,i.V)(`esri/symbols/patterns/${s}.png`),t.toCss(!0)),width:5,height:5}}function x(e){return e.outline?S(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function k(e,t){const s=C(e);if(!s)return null;let i="rgba(";return i+=(0,y.uH)(s.r,t)+",",i+=(0,y.uH)(s.g,t)+",",i+=(0,y.uH)(s.b,t)+",",i+s.a+");"}function F(e,t){const s=k(e,t);return s?"pattern"in e&&(0,a.pC)(e.pattern)&&"style"===e.pattern.type&&"none"===e.pattern.style?null:{color:s,width:Math.min(e.size?(0,c.F2)(e.size):.75,_),style:"pattern"in e&&(0,a.pC)(e.pattern)&&"style"===e.pattern.type?(0,d.Sp)(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?"miter"===e.join?(0,c.F2)(2):e.join:null}:{}}function R(e,t,s){const i=.75*s;return{type:"linear",x1:i?.25*i:0,y1:i?.5*i:0,x2:i||4,y2:i?.5*i:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function z(e){const t="number"==typeof e?.size?e?.size:null;return t?(0,c.F2)(t):null}function M(e,t){if(0===e.symbolLayers.length)return Promise.reject(new n.Z("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return function(e,t){const s=z(t),r=t&&t.maxSize?(0,c.F2)(t.maxSize):null,n=t&&t.disableUpsampling,l=e.symbolLayers,a=[];let d=0,_=0;const v=l.getItemAt(l.length-1);let I;return v&&"icon"===v.type&&(I=v.size&&(0,c.F2)(v.size)),l.forEach((l=>{if("icon"!==l.type&&"object"!==l.type)return;const o="icon"===l.type?l.size&&(0,c.F2)(l.size):0,v=s||o?Math.ceil(Math.min(s||o,r||b)):g;if(l&&l.resource&&l.resource.href){const t=function(e,t){const s=t&&t.resource,r=s&&s.href;if(e.thumbnail&&e.thumbnail.url)return Promise.resolve(e.thumbnail.url);if(r&&"object"!==t.type)return Promise.resolve((0,f.nf)(e,t));const n=(0,i.V)("esri/images/Legend/legend3dsymboldefault.png");return e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?(0,m.resolveWebStyleSymbol)(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch((e=>e)).then((e=>e?.thumbnail?.url||n)):Promise.resolve(n)}(e,l).then((e=>{const t=l.get("material.color"),s=function(e){return"icon"===e.type?"multiply":"tint"}(l);return(0,p.r)(e,v,t,s,n)})).then((e=>{const t=e.width,s=e.height;return d=Math.max(d,t),_=Math.max(_,s),[{shape:{type:"image",x:0,y:0,width:t,height:s,src:e.url},fill:null,stroke:null}]}));a.push(t)}else{let e=v;"icon"===l.type&&I&&s&&(e=v*(o/I));const i="tall"===t?.symbolConfig||t?.symbolConfig?.isTall||"object"===l.type&&function(e){const t=e.depth,s=e.height,i=e.width;return i&&t&&s&&i===t&&i<s}(l);d=Math.max(d,i?L:e),_=Math.max(_,e),a.push(Promise.resolve(function(e,t,s){const i=[];if(!e)return i;switch(e.type){case"icon":{const s=0,r=0,n=t,l=t;switch(e.resource&&e.resource.primitive||u.S){case"circle":i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:E(e,0),stroke:S(e)});break;case"square":i.push({shape:{type:"path",path:[{command:"M",values:[s,l]},{command:"L",values:[s,r]},{command:"L",values:[n,r]},{command:"L",values:[n,l]},{command:"Z",values:[]}]},fill:E(e,0),stroke:S(e)});break;case"triangle":i.push({shape:{type:"path",path:[{command:"M",values:[s,l]},{command:"L",values:[.5*n,r]},{command:"L",values:[n,l]},{command:"Z",values:[]}]},fill:E(e,0),stroke:S(e)});break;case"cross":i.push({shape:{type:"path",path:[{command:"M",values:[.5*n,r]},{command:"L",values:[.5*n,l]},{command:"M",values:[s,.5*l]},{command:"L",values:[n,.5*l]}]},stroke:x(e)});break;case"x":i.push({shape:{type:"path",path:[{command:"M",values:[s,r]},{command:"L",values:[n,l]},{command:"M",values:[n,r]},{command:"L",values:[s,l]}]},stroke:x(e)});break;case"kite":i.push({shape:{type:"path",path:[{command:"M",values:[s,.5*l]},{command:"L",values:[.5*n,r]},{command:"L",values:[n,.5*l]},{command:"L",values:[.5*n,l]},{command:"Z",values:[]}]},fill:E(e,0),stroke:S(e)})}break}case"object":switch(e.resource&&e.resource.primitive||h.S){case"cone":{const r=R(E(e,0),E(e,-.6),s?L:t),n=(0,y.TE)(t,s);i.push({shape:n[0],fill:r}),i.push({shape:n[1],fill:r});break}case"inverted-cone":{const s=E(e,0),r=R(s,E(e,-.6),t),n=(0,y.DY)(t);i.push({shape:n[0],fill:r}),i.push({shape:n[1],fill:s});break}case"cube":{const r=(0,y.Pc)(t,s);i.push({shape:r[0],fill:E(e,0)}),i.push({shape:r[1],fill:E(e,-.3)}),i.push({shape:r[2],fill:E(e,-.5)});break}case"cylinder":{const r=R(E(e,0),E(e,-.6),s?L:t),n=(0,y.EB)(t,s);i.push({shape:n[0],fill:r}),i.push({shape:n[1],fill:r}),i.push({shape:n[2],fill:E(e,0)});break}case"diamond":{const s=(0,y.XX)(t);i.push({shape:s[0],fill:E(e,-.3)}),i.push({shape:s[1],fill:E(e,0)}),i.push({shape:s[2],fill:E(e,-.3)}),i.push({shape:s[3],fill:E(e,-.7)});break}case"sphere":{const s=R(E(e,0),E(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{const s=(0,y.tp)(t);i.push({shape:s[0],fill:E(e,-.3)}),i.push({shape:s[1],fill:E(e,0)}),i.push({shape:s[2],fill:E(e,-.6)});break}}}return i}(l,e,i)))}})),(0,o.as)(a).then((e=>{const s=[];return e.forEach((e=>{e.value?s.push(e.value):e.error&&w.warn("error while building swatchInfo!",e.error)})),(0,p.w)(s,[d,_],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})}))}(e,t);case"line-3d":return function(e,t){const s=e.symbolLayers,i=[],r=(0,f.YW)(e),n=z(t),l=(t&&t.maxSize?(0,c.F2)(t.maxSize):null)||_;let o,d=0,u=0;return s.forEach(((e,t)=>{if(!e)return;if("line"!==e.type&&"path"!==e.type)return;const s=[];switch(e.type){case"line":{const i=F(e,0);if((0,a.Wi)(i))break;const r=i&&i.width||0;0===t&&(o=r);const c=Math.min(n||r,l),h=0===t?c:n?c*(r/o):c,y=h>v/2?2*h:v;u=Math.max(u,h),d=Math.max(d,y),i.width=h,s.push({shape:{type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[d,.5*u]}]},stroke:i});break}case"path":{const t=Math.min(n||g,l),i=E(e,0),r=E(e,-.2),a=k(e,-.4),o=a?{color:a,width:1}:{};if("quad"===e.profile){const t=e.width,n=e.height,l=(0,y.eb)(t&&n?t/n:1,0===n,0===t),a={...o,join:"bevel"};s.push({shape:l[0],fill:r,stroke:a}),s.push({shape:l[1],fill:r,stroke:a}),s.push({shape:l[2],fill:i,stroke:a})}else s.push({shape:y.JZ.pathSymbol3DLayer[0],fill:r,stroke:o}),s.push({shape:y.JZ.pathSymbol3DLayer[1],fill:i,stroke:o});u=Math.max(u,t),d=u}}i.push(s)})),Promise.resolve((0,p.w)(i,[d,u],{node:t&&t.node,scale:r,opacity:t&&t.opacity}))}(e,t);case"polygon-3d":case"mesh-3d":return async function(e,t){const s="mesh-3d"===e.type,i=e.symbolLayers,r=z(t),n=t&&t.maxSize?(0,c.F2)(t.maxSize):null,l=r||g,o=[];let d=0,u=0,h=!1;for(let e=0;e<i.length;e++){const t=i.getItemAt(e),r=[];if(s&&"fill"!==t.type)continue;const c=y.JZ.fill[0];switch(t.type){case"fill":{const e=S(t),i=Math.min(l,n||b);d=Math.max(d,i),u=Math.max(u,i),h=!0;let o=E(t,0);const y="pattern"in t&&t.pattern,p=C(t);!s&&(0,a.pC)(y)&&"style"===y.type&&"solid"!==y.style&&p&&(o=await V(y,p)),r.push({shape:c,fill:o,stroke:e});break}case"line":{const e=F(t,0);if((0,a.Wi)(e))break;const s={stroke:e,shape:c};d=Math.max(d,g),u=Math.max(u,g),r.push(s);break}case"extrude":{const e={join:"round",width:1,...F(t,-.4)},s=E(t,0),i=E(t,-.2),a=Math.min(l,n||b),o=(0,y.EV)(a);e.width=1,r.push({shape:o[0],fill:i,stroke:e}),r.push({shape:o[1],fill:i,stroke:e}),r.push({shape:o[2],fill:s,stroke:e});const c=g,h=.7*g+.5*a;d=Math.max(d,c),u=Math.max(u,h);break}case"water":{const e=C(t),s=I(e),i=I(e,2),a=I(e,3),o=(0,y.ht)();h=!0,r.push({shape:o[0],fill:s}),r.push({shape:o[1],fill:i}),r.push({shape:o[2],fill:a});const c=Math.min(l,n||b);d=Math.max(d,c),u=Math.max(u,c);break}}o.push(r)}return(0,p.w)(o,[d,u],{node:t&&t.node,scale:h,opacity:t&&t.opacity})}(e,t)}return Promise.reject(new n.Z("symbolPreview: swatchInfo3D","symbol not supported."))}},77710:(e,t,s)=>{s.r(t),s.d(t,{fetchSymbolFromStyle:()=>f,resolveWebStyleSymbol:()=>p});var i=s(4905),r=s(57989),n=s(70375),l=s(61681),a=s(3466),o=s(26869),c=s(16641),d=s(83313),u=s(85068),h=s(11644),y=s(3032);function p(e,t,s,i){return e.name?e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,s){const i=h.wm.replace(/\{SymbolName\}/gi,e.name),r=(0,l.pC)(t.portal)?t.portal:o.Z.getDefault();return(0,h.EJ)(i,s).then((e=>{const t=(0,h.KV)(e.data);return(0,d.im)(t,{portal:r,url:(0,a.mN)((0,a.Yd)(i)),origin:"portal-item"})}))}(e,t,i):(0,h.n2)(e,t,i).then((r=>f(r,e.name,t,s,i))):Promise.reject(new n.Z("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function f(e,t,s,p,f){const m=e.data,g=s&&(0,l.pC)(s.portal)?s.portal:o.Z.getDefault(),b={portal:g,url:(0,a.mN)(e.baseUrl),origin:"portal-item"},_=m.items.find((e=>e.name===t));if(!_){const e=`The symbol name '${t}' could not be found`;return Promise.reject(new n.Z("symbolstyleutils:symbol-name-not-found",e,{symbolName:t}))}let v=(0,c.f)((0,h.v9)(_,p),b),L=_.thumbnail&&_.thumbnail.href;const w=_.thumbnail&&_.thumbnail.imageData;(0,r.XO)()&&(v=(0,r.pJ)(v),L=(0,r.pJ)(L));const S={portal:g,url:(0,a.mN)((0,a.Yd)(v)),origin:"portal-item"};return(0,h.EJ)(v,f).then((r=>{const n="cimRef"===p?(0,h.KV)(r.data):r.data,l=(0,d.im)(n,S);if(l&&(0,i.dU)(l)){if(L){const e=(0,c.f)(L,b);l.thumbnail=new y.p({url:e})}else w&&(l.thumbnail=new y.p({url:`data:image/png;base64,${w}`}));e.styleUrl?l.styleOrigin=new u.Z({portal:s.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(l.styleOrigin=new u.Z({portal:s.portal,styleName:e.styleName,name:t}))}return l}))}},23377:(e,t,s)=>{s.r(t),s.d(t,{default:()=>fs});var i=s(36663),r=s(44584),n=s(61681),l=s(76868),a=s(42730),o=(s(7753),s(39994)),c=s(69236),d=s(81977),u=s(40266),h=s(47035),y=(s(87090),s(53443)),p=s(41831),f=(s(7283),s(30936)),m=s(88256),g=s(66341),b=s(4905),_=s(25709),v=s(13802),L=s(78668),w=s(95550),S=s(3466),I=s(65943),C=s(67134),E=s(13045),V=s(60278);let x=class extends y.Z{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,o.Z)("mapview-transitions-duration"),this.effects=[]}set effect(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(k(e))}catch(t){this._transitionTo([]),v.Z.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return null!==this._to}canTransitionTo(e){try{return this.scale>0&&F(this._current,k(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}end(){this._applyTimeTransition(this.duration)}_transitionTo(e){this.scale>0&&F(this._current,e,this.scale)?(this._final=e,this._to=(0,C.d9)(e),function(e,t,s){const i=e.length>t.length?e:t,r=e.length>t.length?t:e,n=r[r.length-1],l=n?.scale??s,a=n?.effects??[];for(let e=r.length;e<i.length;e++)r.push({scale:l,effects:[...a]});for(let e=0;e<i.length;e++)r[e].scale=-1===r[e].scale?s:r[e].scale,i[e].scale=-1===i[e].scale?s:i[e].scale,(0,V.uF)(r[e].effects,i[e].effects)}(this._current,this._to,this.scale),this._from=(0,C.d9)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?(0,C.d9)(this._current[0].effects):[])}_applyTimeTransition(e){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let e=0;e<this._current.length;e++){const s=this._current[e],i=this._from[e],r=this._to[e];s.scale=R(i.scale,r.scale,t);for(let e=0;e<s.effects.length;e++){const n=s.effects[e],l=i.effects[e],a=r.effects[e];n.interpolate(l,a,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?(0,C.d9)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set("scale",e),0===this._current.length)return;const t=this._current,s=this._current.length-1;let i,r,n=1;if(1===t.length||e>=t[0].scale)r=i=t[0].effects;else if(e<=t[s].scale)r=i=t[s].effects;else for(let l=0;l<s;l++){const s=t[l],a=t[l+1];if(s.scale>=e&&a.scale<=e){n=(e-s.scale)/(a.scale-s.scale),i=s.effects,r=a.effects;break}}for(let e=0;e<this.effects.length;e++)this.effects[e].interpolate(i[e],r[e],n)}};function k(e){const t=(0,E.Q)(e)||[];return function(e){const t=e[0];return!!t&&"type"in t}(t)?[{scale:-1,effects:t}]:t}function F(e,t,s){return!e[0]?.effects||!t[0]?.effects||!((-1===e[0]?.scale||-1===t[0]?.scale)&&(e.length>1||t.length>1)&&s<=0)&&(0,V.AS)(e[0].effects,t[0].effects)}function R(e,t,s){return e+(t-e)*s}(0,i._)([(0,d.Cb)()],x.prototype,"_to",void 0),(0,i._)([(0,d.Cb)()],x.prototype,"duration",void 0),(0,i._)([(0,d.Cb)({value:""})],x.prototype,"effect",null),(0,i._)([(0,d.Cb)({readOnly:!0})],x.prototype,"effects",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],x.prototype,"hasEffects",null),(0,i._)([(0,d.Cb)({value:0})],x.prototype,"scale",null),(0,i._)([(0,d.Cb)({readOnly:!0})],x.prototype,"transitioning",null),x=(0,i._)([(0,u.j)("esri.layers.effects.EffectView")],x);var z=s(50913),M=s(24065),A=s(17095),T=s(72506),P=s(73572),N=s(76204),D=s(97500),O=s(83773),$=s(5840),B=s(43198),H=s(59672),Z=s(96243);var W=s(31129),q=s(25803),j=s(89298),U=s(52084);const Y={HH:315,HL:45,LL:135,LH:225},J={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function G(e){if(!e)return;const{type:t}=e;if(t.includes("3d"))return(0,U.getSymbolLayerFill)(e.symbolLayers.getItemAt(0));if("simple-line"===t){const t=(0,j.mx)(e);return t&&t.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){const t=(0,j.mx)(e);return t&&t.color}return(0,j._M)(e)}function X(e,t){const s=t.HH.label,i=t.LL.label,r=t.HL.label,n=t.LH.label;switch(e){case"HH":default:return{top:s,bottom:i,left:r,right:n};case"HL":return{top:r,bottom:n,left:i,right:s};case"LL":return{top:i,bottom:s,left:n,right:r};case"LH":return{top:n,bottom:r,left:s,right:i}}}function Q(e){let t=Y[e];return e&&null==t&&(t=Y.HH),t||0}var K=s(21758),ee=s(17075),te=s(54956),se=s(3368),ie=s(1759),re=s(15498);const ne=[255,255,255],le=[200,200,200],ae=[128,128,128];async function oe(e,t,i,r,n,l){const a=t.legendOptions,o=a&&a.customValues,c=await de(e,i),d=!!c,u=!!o,h=null!=t.minSize&&null!=t.maxSize,y=t.stops&&t.stops.length>1,p=!!t.target;if(!d||!u&&!(h||y&&!p))return;const f=(0,H.YW)(c);let m=null,g=null,b=null;g=f&&!y?(0,K.NM)([t.minDataValue,t.maxDataValue]):o||await async function(e,t,i,r){const n=(await Promise.resolve().then(s.bind(s,36496))).getSizeRangeAtScale(e,i,r),l=n&&ye(n);if(!n&&!l)return;let a=l.map((t=>function(e,t,s){const i=s.minSize,r=s.maxSize,n=t.minDataValue,l=t.maxDataValue;let a=null;return a=e<=i?n:e>=r?l:(e-i)/(r-i)*(l-n)+n,a}(t,e,n)));a=(0,K.NM)(a);for(let s=1;s<a.length-1;s++){const n=await pe(e,t,a[s],a[s-1],i,r);n&&(a[s]=n[0],l[s]=n[1])}return a}(t,c,r,n);const _=e?.authoringInfo,v="univariate-color-size"===_?.type,L=v&&"above-and-below"===_?.univariateTheme;if(!g&&y&&(g=t.stops.map((e=>e.value)),m=t.stops.some((e=>!!e.label)),"flow"===e.type&&(g=(0,K.NM)(g)),m&&(b=t.stops.map((e=>e.label)))),f&&g?.length>2&&!L&&(g=[g[0],g[g.length-1]]),!g)return null;v&&5!==g?.length&&(g=ye({minSize:g[0],maxSize:g[g.length-1]}));const w=f?function(e,t){const s=e?.authoringInfo,i="univariate-color-size"===s?.type;let r=[12,30];if(i){const e=t[0],s=t[t.length-1],i=12,n=30;r=t.map((t=>i+(t-e)/(s-e)*(n-i)))}return i&&"below"===s?.univariateTheme&&r.reverse(),r}(e,g):null,S=(0,H.Y6)(c),I=m?null:function(e,t){const s=e.length-1;return e.map(((e,i)=>(0,ee.MN)(e,i,s,t)))}(g,l);return(await Promise.all(g.map((async(s,i)=>{const l=f?w[i]:await fe(t,c,s,r,n);return{value:s,symbol:me(L&&"class-breaks"===e.type?ce(e,i):c,l),label:m?b[i]:I[i],size:l,outlineSize:S}})))).reverse()}function ce(e,t){const s=e.classBreakInfos,i=s.length,r=i<2||!(t>=2)?s[0].symbol.clone():s[i-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(r.type.includes("3d")?ue(r):he(r)),r}async function de(e,t){if("flow"===e.type)return(0,ee.y$)(e,t);if("pie-chart"===e.type)return new ie.Z({color:null,outline:e.outline?.width?e.outline:new re.Z});let s=null,i=null;if("simple"===e.type)s=e.symbol;else if("class-breaks"===e.type){const t=e.classBreakInfos;s=t&&t[0]&&t[0].symbol,i=t.length>1}else if("unique-value"===e.type){const t=e.uniqueValueInfos;s=t&&t[0]&&t[0].symbol,i=t.length>1}return!s||function(e){return!!e&&((0,b.dU)(e)?!!e.symbolLayers&&e.symbolLayers.some((e=>e&&"fill"===e.type)):e.type.includes("fill"))}(s)?null:(s=s.clone(),(t||i)&&(s.type.includes("3d")?ue(s):he(s)),s)}function ue(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:ae}})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource&&e.resource.href?e.material={color:le}:(e.material={color:ne},e.outline={color:ae,size:1.5})}))}function he(e){const t=(0,se.$o)();if("cim"===e.type)(0,D.ZB)(e,new f.Z(le));else if(e.type.includes("line"))e.color=ae;else if(e.color=t?ae:ne,"simple-marker"===e.type)if(e.outline){const t=e.outline?.color?.toHex();"#ffffff"===t&&(e.outline.color=ae)}else e.outline={color:ae,width:1.5}}function ye(e){const t=e.minSize,s=(e.maxSize-t)/4,i=[];for(let e=0;e<5;e++)i.push(t+s*e);return i}async function pe(e,t,s,i,r,n){const l=await fe(e,t,s,r,n),a=await fe(e,t,i,r,n),o=(0,K.D2)(s),c=o.fractional;let d=o.integer,u=null,h=null;s>0&&s<1&&(u=10**c,d=(0,K.D2)(s*=u).integer);for(let i=d-1;i>=0;i--){const o=10**i;let c=Math.floor(s/o)*o,d=Math.ceil(s/o)*o;null!=u&&(c/=u,d/=u);let y=(c+d)/2;[,y]=(0,K.NM)([c,y,d],{indexes:[1]});const p=await fe(e,t,c,r,n),f=await fe(e,t,d,r,n),m=await fe(e,t,y,r,n),g=(0,K.f1)(l,p,a,null),b=(0,K.f1)(l,f,a,null),_=(0,K.f1)(l,m,a,null);let v=g.previous<=20,L=b.previous<=20;if(v&&L&&(g.previous<=b.previous?(v=!0,L=!1):(L=!0,v=!1)),v?h=[c,p]:L?h=[d,f]:_.previous<=20&&(h=[y,m]),h)break}return h}async function fe(e,t,i,r,n){const{getSize:l}=await Promise.resolve().then(s.bind(s,36496));return l(e,i,{scale:r,view:n,shape:"simple-marker"===t.type?t.style:null})}function me(e,t){const s=e.clone();if((0,b.dU)(s))(0,H.YW)(s)||s.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(s))s.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(s)){const e=s.width,i=s.height;s.height=t,s.width=t*(e/i)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(s)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(s)&&s.font&&(s.font.size=t):s.width=t;return s}s(72057);var ge=s(25741);s(77669);var be=s(43411);const _e=v.Z.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),ve=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Le=new _.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),we={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Se=new ie.Z({size:6,outline:{color:[128,128,128,.5],width:.5}}),Ie=new be.Z({style:"solid"});function Ce(e){return"flow"===e.type}function Ee(e){return"vector-field"===e.type}function Ve(e){return"raster-colormap"===e.type}function xe(e){return"raster-stretch"===e.type}function ke(e){return"raster-shaded-relief"===e.type}function Fe(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function Re(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function ze(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function Me(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function Ae(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function Te(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function Pe(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Ne(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function De(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function Oe(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function $e(e){return"esri.layers.MapImageLayer"===e.declaredClass}function Be(e){return"esri.layers.ImageryLayer"===e.declaredClass}function He(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}const Ze=new ie.Z({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let We={},qe=class extends y.Z{constructor(e){super(e),this._handles=new r.Z,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new p.Z,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([(0,l.on)((()=>this.children),"change",(t=>{const{added:s,removed:i}=t,r=this._handles;s.forEach((t=>{const s=`activeLayerInfo-ready-watcher-${t.layer.uid}`;r.add((0,l.YP)((()=>t.ready),e,l.nn),s)})),i.forEach((e=>r.remove(e.layer.uid))),e()}))]),this.keepCacheOnDestroy||(We={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(We=null)}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new x,t.effect=e.effect,t.end(),t.scale=this.scale),t}get opacity(){const e=this.layer.opacity,t=this.parent?.opacity,s=this.layer.parent,i=s&&"uid"in s?this._getParentLayerOpacity(s):null;return null!=t?t*e:null!=i?i*e:e}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(this.hideLayersNotInCurrentView&&!await this._isLayerInCurrentView())return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,(e=>{if(function(e){return"esri.layers.FeatureLayer"===e.declaredClass}(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){const t=e.layerDefinition,s=t&&t.drawingInfo,i=s&&(0,T.i)(s.renderer),r=Le.read(t.geometryType);return i?this._getRendererLegendElements(i,{title:e.name,geometryType:r}):(_e.warn("drawingInfo not available!"),null)}return null}));try{const e=[];await(0,L.as)(t).then((t=>{t.forEach((({value:t})=>t&&e.push(...t)))})),this.legendElements=e,this.notifyChange("ready")}catch(e){_e.warn("error while building legend for layer!",e)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(e){_e.warn("error while building legend for layer!",e)}}async buildLegendElementsForTools(){const e=this.layer;if(function(e){return"esri.layers.VoxelLayer"===e.declaredClass}(e))this._constructLegendElementsForVoxellayer();else if(function(e){return"esri.layers.WMTSLayer"===e.declaredClass}(e))this._constructLegendElementsForWMTSlayer();else if(function(e){return"esri.layers.WMSLayer"===e.declaredClass}(e))await this._constructLegendElementsForWMSSublayers();else if(Oe(e))await this._constructLegendElementsForBuildingSceneLayer();else if($e(e)||function(e){return"esri.layers.TileLayer"===e.declaredClass}(e)||Oe(e))await this._constructLegendElementsForSublayers();else{this._handles.remove("imageryLayers-watcher");let t="default";Be(e)&&(t=(e?.renderingRule?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###")),await this._getLegendLayers(`${e.uid}-${t}`).then((async t=>{this.legendElements=[],this.notifyChange("ready");const s=t.map((async t=>{if(Be(e)||He(e)){const t=(0,l.YP)((()=>["renderingRule"in e&&e.renderingRule,e.bandIds]),(()=>(0,L.Ds)((async()=>{We.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()}))()));this._handles.add(t,"imageryLayers-watcher")}const s=this._generateSymbolTableElementForLegendLayer(t);s&&s.infos.length&&(Be(e)&&(s.title=e.title),this.legendElements.push(s)),this.notifyChange("ready")}));await(0,L.as)(s)})).catch((e=>{_e.warn("Request to server for legend has failed!",e)}))}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,s=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!(s||t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await(0,l.N1)((()=>!t.updating));const i=s?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return i.geometry=this.view.extent,0!==(s?"queryFeatureCount"in t&&await t.queryFeatureCount(i):"queryFeatureCount"in e&&await e.queryFeatureCount(i))}_getParentLayerOpacity(e){let t=1;const s=e.parent;return s&&"uid"in s&&(t=this._getParentLayerOpacity(s)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some((e=>e.ready))}_isRendererScaleDriven(e){if("dot-density"===e.type)return!0;const t="valueExpression"in e&&e.valueExpression;if(ve.test(t))return!0;const s="visualVariables"in e&&e.visualVariables;return!!s&&s.some((e=>this._isScaleDrivenSizeVariable(e)))}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return!1;const t=e,s=t.minSize,i=t.maxSize;return"object"==typeof s&&s?this._isScaleDrivenSizeVariable(s):"object"==typeof i&&i?this._isScaleDrivenSizeVariable(i):!!t.expression||ve.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&$e(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const s of t.sourceJSON.layers)if(s.id===e.source.mapLayerId&&(s.minScale>0||s.maxScale>0))return!0;return!1}async _constructLegendElementsForVoxellayer(){this.legendElements=[],this._handles.remove("voxel-style-watcher");const e=this.layer;this._handles.add((0,l.YP)((()=>e.currentVariableId),(()=>this._constructLegendElementsForVoxellayer())),"voxel-style-watcher");const t=(0,n.Wg)(e.getVariableStyle(null)),s=[];if(t)if(t.uniqueValues?.length){const e=[];t.uniqueValues.forEach((t=>{t.enabled&&e.push({label:t.label||`${t.value}`,value:t.value,symbol:new be.Z({color:t.color,outline:null})})})),e.length&&s.push({type:"symbol-table",title:t.label,infos:e})}else if(t.transferFunction){const{colorStops:e,stretchRange:i}=t.transferFunction,r=e.toArray().reverse(),n=i.map(((e,t)=>`${0===t?ee.zZ:ee.Eh} ${function(e){const t=Math.floor(Math.log10(Math.abs(e)))+1,s=t<4||t>6?4:t,i=Math.abs(e)>=1e6?"compact":"standard";return(0,ge.uf)(e,{notation:i,minimumSignificantDigits:2,maximumSignificantDigits:s})}(e)}`)).reverse(),l=r.map((e=>({color:e.color,value:null,label:null})));l[0].label=n[0],l[l.length-1].label=n[1],s.push({type:"color-ramp",title:t.label,infos:l,preview:(0,B.jT)(r.map((e=>e.color)))})}const i=e.opacity,r=s.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol)).map((e=>this._getSymbolPreview(e,i)));await(0,L.as)(r),this.legendElements=s,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add((0,l.YP)((()=>{const{layer:e}=this;return e&&"activeLayer"in e&&e.activeLayer}),(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some((s=>e.styleId===s.id&&(t=s.legendUrl,!0))),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this._handles.add((0,l.YP)((()=>{const{layer:e}=this;return e&&"sublayers"in e&&e.sublayers}),(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const i=e.toArray();for(const e of i){const i=(0,l.YP)((()=>[e.title,e.visible,e.legendEnabled]),(()=>this._constructLegendElementsForWMSSublayers()));if(this._handles.add(i,"wms-sublayers-watcher"),!this.respectLayerVisibility||e.visible&&e.legendEnabled){const i=await this._generateSymbolTableElementForWMSSublayer(e,t);i&&i.infos.length&&s.unshift(i)}}return s}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const s=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return{type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){let s=e.legendUrl;if(!s)return;const i={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(s=(0,S.fl)(s,t));let r=null;const n=e.layer?.opacity;try{r=(await(0,g.default)(s,{responseType:"image"})).data,r&&(r.style.opacity=n)}catch{}return i.infos.push({src:s,preview:r,opacity:n}),i}_getLegendLayers(e,t){const s=We&&We[e];return s?Promise.resolve(s):this._legendRequest(t).then((t=>{const s=t.layers;return We[e]=s,s}))}_legendRequest(e){const t=this.layer;let s={f:"json",dynamicLayers:e};if(Be(t)){const e=t.exportImageServiceParameters.renderingRule;if(e&&(s.renderingRule=JSON.stringify(e.rasterFunctionDefinition||e.toJSON())),t.bandIds&&(s.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:e,viewId:i,customParameters:r}=t;s={raster:e,viewId:i,...s,...r}}}let i=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const e=i.indexOf("?");e>-1?i=i.substring(0,e)+"/legend"+i.substring(e):i+="/legend"}else{const e=i.toLowerCase().indexOf("/rest/"),t=i.substring(0,e)+i.substring(e+5,i.length);i="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(t)+"&returnbytes=true"}return(0,g.default)(i,{query:s}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add((0,l.YP)((()=>e.sublayers),(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(e){_e.warn("Request to server for legend has failed!",e)}}async _generateLegendElementsForBuildingSublayers(e,t){let s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const i=e.toArray();for(const e of i){const i=(0,l.YP)((()=>["renderer"in e&&e.renderer,e.opacity,e.title,e.visible]),(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this._handles.add(i,"sublayers-watcher"),!this.respectLayerVisibility||e.visible){const i=e&&null!=e.opacity?e.opacity:null,r=null!=i?i*t:t;if("building-group"===e.type){const t={type:"symbol-table",title:e.title,infos:[]},i=await this._generateLegendElementsForBuildingSublayers(e.sublayers,r);t.infos.push(...i),s=[t,...s]}else e.renderer&&(s=[...await this._getRendererLegendElements(e.renderer,{title:e.title,opacity:r,sublayer:e}),...s])}}return s.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add((0,l.YP)((()=>e.sublayers),(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(e){_e.warn("Request to server for legend has failed!",e)}}async _generateLegendElementsForSublayers(e,t,s){const i=this.layer;let r=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let n=e.toArray();!s&&this.sublayerIds&&this.sublayerIds.length&&(n=this.sublayerIds.map((e=>i.findSublayerById(e))).filter(Boolean));for(const e of n){const i=(0,l.YP)((()=>[e.renderer,e.opacity,e.title,e.visible,e.legendEnabled]),(()=>this._constructLegendElementsForSublayers()));if(this._handles.add(i,"sublayers-watcher"),!this.respectLayerVisibility||e.visible&&e.legendEnabled&&this._isSublayerInScale(e)){const i=e&&null!=e.opacity?e.opacity:null,n=null!=i?i*t:t;if(e.renderer&&!e.sublayers&&e.originIdOf("renderer")>I.s3.SERVICE)await e.load(),r=[...await this._getRendererLegendElements(e.renderer,{title:e.title,opacity:n,sublayer:e}),...r];else{const t=await this._generateSymbolTableElementForSublayer(e,n,s);t&&r.unshift(t)}}}return r.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,s){if(!s){s=new Map;const t=this.layer,i=e.source;let r=null;if(i&&("map-layer"!==i.type||i.mapLayerId!==e.id||i.gdbVersion&&i.gdbVersion!==("gdbVersion"in t&&t.gdbVersion))||e.originIdOf("renderer")>I.s3.SERVICE||e.originIdOf("labelingInfo")>I.s3.SERVICE||e.originIdOf("labelsVisible")>I.s3.SERVICE){const e=new M.R({layer:this.layer});r=e.hasDynamicLayers?e.dynamicLayers:null,e.destroy()}const n=r||`${t.uid}-default`;(await this._getLegendLayers(n,r)).forEach((e=>s.set(e.layerId,e)))}const i=s.get(e.id);if((!i||i?.subLayerIds&&i.defaultVisibility)&&e.sublayers){const i=await this._generateLegendElementsForSublayers(e.sublayers,t,s);return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendLayer(i,e,t)}_generateSymbolTableElementForLegendLayer(e,t,s){if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const i=t?.renderer;let r=t?.title||e.layerName;if(i&&(!t||t?.originIdOf("renderer")>I.s3.SERVICE)){const e=t?.title||this._getRendererTitle(i,t);e&&(r&&"string"!=typeof e&&"title"in e&&(e.title=r),r=e)}const n={type:"symbol-table",title:r,legendType:e.legendType?e.legendType:null,infos:[]},l=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups?.length>0?e.legendGroups.forEach((t=>{const i={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(l.filter((e=>e.groupId===t.id)),e.layerId,s)};i.infos?.length>0&&n.infos.push(i)})):n.infos=this._generateSymbolTableElementInfosForLegendLayer(l,e.layerId,s),n.infos.length>0?n:null}_generateSymbolTableElementInfosForLegendLayer(e,t,s){return e.map((e=>{let i=e.url;if(e.imageData&&e.imageData.length>0)i=`data:image/png;base64,${e.imageData}`;else{if(0===i.indexOf("http"))return null;i=(0,m.Dp)(`${this.layer.url}/${t}/images/${i}`)}return{label:e.label,src:i,opacity:null==s?this.opacity:s,width:e.width,height:e.height}})).filter((e=>!!e))}_isSublayerInScale(e){const t=e.minScale||0,s=e.maxScale||0;return!(t>0&&t<this.scale||s>this.scale)}_isLegendLayerInScale(e,t){const s=t||this.layer;let i=null,r=null,n=!0;return!s.minScale&&0!==s.minScale||!s.maxScale&&0!==s.maxScale?(0===e.minScale&&s.tileInfo&&(i=s.tileInfo.lods[0].scale),0===e.maxScale&&s.tileInfo&&(r=s.tileInfo.lods[s.tileInfo.lods.length-1].scale)):(i=Math.min(s.minScale,e.minScale)||s.minScale||e.minScale,r=Math.max(s.maxScale,e.maxScale)),(i>0&&i<this.scale||r>this.scale)&&(n=!1),n}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;const s=t.renderer,i=e.some((e=>e.values));let r=null,n=null;return i&&e.some(((e,t)=>(e.values||(r=t,n=e,n.label||(n.label="others")),null!=n))),s?"unique-value"===s.type?n&&(e.splice(r,1),e.push(n)):"class-breaks"===s.type&&(n&&e.splice(r,1),e.reverse(),n&&e.push(n)):n&&(e.splice(r,1),e.push(n)),e}async _getRendererLegendElements(e,t={}){return function(e,t){return Fe(e)||Re(e)||ze(e)||Me(e)||Ne(e)||De(e)?"2d"===t.type||(0,P.e)(e):xe(e)||Ve(e)||ke(e)||Ae(e)||Te(e)||Pe(e)||Ee(e)||Ce(e)}(e,this.view)?function(e){return Ae(e)||Te(e)||Pe(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}(e)?this._constructPointCloudRendererLegendElements(e,t):Ne(e)?this._constructDotDensityRendererLegendElements(e):De(e)?this._constructPieChartRendererLegendElements(e):this._constructRendererLegendElements(e,t):(_e.warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const s=t.title,i=[];let r=null,n=null;if(Ae(e))r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{r.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(Se,e.color)})}));else if(Te(e)){const t=e.stops;let i=null;if(t.length&&(1===t.length&&(i=t[0].color),!i)){const e=t[0].value,s=t[t.length-1].value;null!=e&&null!=s&&(i=(0,W.QQ)(e+(s-e)/2,t))}r={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Se,i||Se.color)}]};const l=(0,W.NA)(e.stops);n={type:"color-ramp",title:s||this._getPointCloudRendererTitle(e),infos:l,preview:(0,B.jT)(l.map((e=>e.color)))}}else Pe(e)&&(r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((e=>{r.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(Se,e.color)})})));r&&r.infos.length&&i.push(r),n&&n.infos.length&&i.push(n);const l=i.reduce(((e,t)=>e.concat(t.infos)),[]).filter((e=>!!e.symbol)).map((t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})));return(0,L.as)(l).then((()=>i))}_getElementInfoForDotDensity(e,t){const{backgroundColor:s,outline:i,dotSize:r}=e,n=this.effectList?.effects.map((e=>e.toJSON())),l=(0,z.rM)(n),a=r+"-"+t+"-"+s+"-"+(i&&JSON.stringify(i.toJSON()))+"-"+l,o=this._dotDensityUrlCache,c=o.has(a)?o.get(a):(0,B.k)(e,t);o.set(a,c);const d={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},u=(0,$.w)([[d]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:u,width:c.width,height:c.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),s=e.legendOptions&&e.legendOptions.unit,i={type:"symbol-table",title:{value:t&&Math.round(t),unit:s||""},infos:[]};return e.attributes.forEach((t=>{const s=this._getElementInfoForDotDensity(e,t.color);s.label=t.label||t.valueExpressionTitle||t.field,i.infos.push(s)})),Promise.resolve([i])}async _constructPieChartRendererLegendElements(e){const t=this.layer.opacity,s=[],i="Others",r=e.outline;e.attributes.forEach((e=>{const t=new ie.Z({color:e.color,outline:r}),i=e.label||e.valueExpressionTitle||e.field;s.push({label:i,symbol:t})}));const n=s.length?[...s]:[];if(e.othersCategory?.color&&0!==e.othersCategory?.threshold){const t=new ie.Z({color:e.othersCategory.color,outline:r});s.push({label:e.othersCategory.label||i,symbol:t})}if(e.defaultColor?.a){const t=new ie.Z({color:e.defaultColor,outline:r});s.push({label:e.defaultLabel,symbol:t})}const l=await this._getVisualVariableLegendElements(e,this.layer)||[];if(s.length){l.unshift({type:"symbol-table",title:null,infos:s});const t=n.filter((e=>e.label!==i)).map((e=>e.symbol.color)).filter(Boolean),a=(0,B.LC)(t,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:r});l.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:s,preview:a})}const a=l.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol&&!e?.preview)).map((e=>this._getSymbolPreview(e,t,{effectList:this.effectList})));return await(0,L.as)(a),l}async _constructRendererLegendElements(e,t={}){const{title:s,sublayer:i}=t,r=i||this.layer;let l=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const a=await this._getVisualVariableLegendElements(l,r)||[],o={type:"symbol-table",title:s||this._getRendererTitle(l,r),infos:[]};let c=null,d=!1;const u=new Set;if(Ce(l)&&!this._hasSizeRamp){const e=await(0,ee.y$)(l);o.infos.push({label:null,symbol:e})}else if(function(e){return"univariate-color-size"===("authoringInfo"in e&&e?.authoringInfo)?.type}(l)){let e=s;const t=function(e){const t="authoringInfo"in e&&e?.authoringInfo;return"univariate-color-size"===t?.type&&"above-and-below"===t?.univariateTheme}(l)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",i=a.findIndex((e=>"color-ramp"===e.type)),r=-1!==i?a.splice(i,1)[0]:null,n=a.findIndex((e=>"size-ramp"===e.type)),o=-1!==n?a.splice(n,1)[0]:null,c=[];r&&(e=r.title,c.push(r)),o&&(e=o.title,c.push(o)),c.length>0&&a.push({type:t,title:e,infos:c})}else if(Me(l)){const e=(0,q.h)(l);a.push({type:"heatmap-ramp",title:s||l.legendOptions?.title,infos:e,preview:(0,B.jT)(e.map((e=>e.color)),{effectList:this.effectList})})}else if(ze(l)){const e=l&&l.authoringInfo;if(e&&"relationship"===e.type){const{focus:t,numClasses:s,field1:i,field2:n}=e;if(s&&i&&n){const e=[i,n];let c=Q(t)||0;for(const t of e){const{field:e,normalizationField:s,label:i}=t,n=i||{field:this._getFieldAlias(e,r),normField:s&&this._getFieldAlias(s,r)},l=Ze.clone();l.angle=c,o.infos.push({label:n,symbol:l}),u.add(l),c+=90}const d=function(e){const{focus:t,infos:s,numClasses:i}=e,r=J[i],n={};s.forEach((e=>{n[e.value]={label:e.label,fill:G(e.symbol)}}));const l=[];for(let e=0;e<i;e++){const t=[];for(let s=0;s<i;s++){const i=n[r[e][s]];t.push(i.fill)}l.push(t)}return{type:"relationship-ramp",numClasses:i,focus:t,colors:l,labels:X(t,n),rotation:Q(t)}}({focus:t,numClasses:s,infos:l.uniqueValueInfos});a.unshift(d)}}else{const e=l.field;l.uniqueValueInfos.forEach((t=>{t.symbol&&o.infos.push({label:t.label||this._getDomainName(e,t.value,r)||t.value,value:t.value,symbol:t.symbol})}))}l.defaultSymbol&&(o.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),d=!0)}else if(Re(l))c=this._isUnclassedRenderer(l),(!c||!this._hasSizeRamp)&&(l.classBreakInfos.forEach((e=>{e.symbol&&o.infos.unshift({label:e.label||(c?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),c&&(o.title=null),this._updateInfosforClassedSizeRenderer(l,o.infos)),l.defaultSymbol&&!c&&(o.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),d=!0);else if(xe(l))if(He(this.layer)||function(e){return"esri.layers.WCSLayer"===e.declaredClass}(this.layer)){const e=this._constructTileImageryStretchRendererElements(l);!function(e){return"stretch-ramp"===e.type}(e)?o.infos=e:a.push(e)}else{const e=this.layer;let t,s;l.statistics&&l.statistics.length&&(t=null!=l.statistics[0].min?l.statistics[0].min:l.statistics[0][0],s=null!=l.statistics[0].max?l.statistics[0].max:l.statistics[0][1]);let i=[];const r=(0,n.Wg)(e.renderingRule?await e.generateRasterInfo(e.renderingRule):e.serviceRasterInfo),c=r.keyProperties.BandProperties,d=we[e.rasterInfo.pixelType.toLowerCase()];1===r.bandCount||e.bandIds&&1===e.bandIds.length?(t=null!=t?t:r.statistics?r.statistics[e.bandIds[0]].min:d[0],s=null!=s?s:r.statistics?r.statistics[e.bandIds[0]].max:d[1],t||s?a.push(this._getStretchLegendElements(l,{min:t,max:s})):this._getServerSideLegend()):r.bandCount>=3?c&&c.length>=r.bandCount?e.bandIds&&3===e.bandIds.length?(i=e.bandIds.map((e=>c[e].BandName)),o.infos=this._createSymbolTableElementMultiBand(i)):"lerc"===e.format?(i=[0,1,2].map((e=>c[e].BandName)),o.infos=this._createSymbolTableElementMultiBand(i)):this._getServerSideLegend():"lerc"===e.format?(i=["band1","band2","band3"],o.infos=this._createSymbolTableElementMultiBand(i)):this._getServerSideLegend():this._getServerSideLegend()}else if(Ve(l))l.colormapInfos.forEach((e=>{o.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(Ie,e.color)})}));else if(Fe(l)){let e=l.symbol;switch(t.geometryType){case"point":e="pointSymbol"in r&&r.pointSymbol;break;case"polyline":e="lineSymbol"in r&&r.lineSymbol;break;case"polygon":e="polygonSymbol"in r&&r.polygonSymbol}l.symbol&&!this._hasSizeRamp&&o.infos.push({label:l.label,symbol:e})}else if(Ee(l)){l.outputUnit&&(this.title="("+l.toJSON().outputUnit+")"),o.title=l.attributeField;const e=l.getClassBreakInfos();e?.length?e.forEach((e=>{o.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):o.infos.push({label:l.attributeField,symbol:l.getDefaultSymbol()})}else ke(l)&&a.push(this._getStretchLegendElements(l,{min:0,max:255}));const h=l.defaultSymbol;!h||d||Fe(l)||c&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||a.push({type:"symbol-table",infos:[{label:l.defaultLabel||"others",symbol:h}]}),o.infos.length&&a.unshift(o);const y=null==t.opacity?this.opacity:t.opacity,p=this._isTallSymbol("visualVariables"in l&&l.visualVariables),f=Be(this.layer)||He(this.layer),m=a.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol)).map((e=>this._getSymbolPreview(e,y,{isDefault:e.symbol===h,applyScaleDrivenSize:!u.has(e.symbol),symbolConfig:{isTall:p,isSquareFill:f},effectList:u.has(e.symbol)?null:this.effectList})));return l=null,await(0,L.as)(m),a}_getServerSideLegend(){setTimeout((()=>this.buildLegendElementsForTools()),0)}_getAllInfos(e){const t=e?.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}_constructTileImageryStretchRendererElements(e){const t=this.layer,s=t.rasterInfo,i=s.bandCount||e.statistics.length;let r,n,l=[];const a=s.keyProperties&&s.keyProperties.BandProperties,o=e?.statistics?.length?e.statistics:s?.statistics;if(o)r=void 0!==o[0].min?o[0].min:o[0][0],n=o[0].max||o[0][1];else{const e=we[t.rasterInfo.pixelType.toLowerCase()];r=e[0],n=e[1]}if(t.hasStandardTime()&&(r=t.getStandardTimeValue(r),n=t.getStandardTimeValue(n)),1===s.bandCount||1===t.bandIds?.length)return this._getStretchLegendElements(e,{min:r,max:n});function c(e){const i=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((t=>e&&e[t]&&e[t].BandName||"band"+(t+1)));return i.length<3?i.push(i[1]):i.length>3&&i.splice(3),i}return l=a&&a.length>=i?c(a):c(),this._createSymbolTableElementMultiBand(l)}_getStretchLegendElements(e,t){const s=e.colorRamp,i=(0,W.fD)(s,t);return{type:"stretch-ramp",title:"",infos:i,preview:(0,B.jT)(i.map((e=>e.color)))}}async _getSizeLegendElement(e,t,s,i){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await oe(s,t,await(0,ee.jb)(s),this.scale,this.view.type,i)}}_createSymbolTableElementMultiBand(e){const t=[],s=["red","green","blue"];return e.forEach(((e,i)=>{t.push({label:{colorName:s[i],bandName:e},src:ee.uY[i],opacity:this.opacity??1})})),t}_updateInfosforClassedSizeRenderer(e,t){const s=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,i=e.classBreakInfos.some((e=>(0,H.YW)(e.symbol)));if(s&&i){const s=30,i=12,r=e.classBreakInfos.length,n=(s-i)/(r>1?r-1:r);t.forEach(((e,t)=>{e.size=s-n*t}))}}_isTallSymbol(e){let t=!1,s=!1;if(e)for(let i=0;i<e.length&&(!t||!s);i++){const r=e[i];"size"===r.type&&("height"===r.axis&&(t=!0),"width-and-depth"===r.axis&&(s=!0))}return t&&s}async _getSymbolPreview(e,t,i){let r=!i?.isDefault&&null==e.size&&this._hasSizeRamp?(0,w.Wz)(O.b_.size):e.size;if(this._scaleDrivenSizeVariable&&i?.applyScaleDrivenSize){const{getSize:t}=await Promise.resolve().then(s.bind(s,36496));r=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null})}return(0,B.l3)(e.symbol,{size:r,opacity:t,scale:!1,symbolConfig:i?.symbolConfig,effectView:i?.effectList}).then((t=>(e.preview=t,e))).catch((()=>(e.preview=null,e)))}async _loadRenderer(e){const t=[],s=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const i="visualVariables"in e&&e.visualVariables?.some((e=>"size"===e.type&&"outline"!==e.target&&!ve.test(e.valueExpression)));if(e&&"visualVariables"in e&&!i&&"featureReduction"in s&&"cluster"===s.featureReduction?.type){const t=this.layerView._effectiveRenderer,i=(0,n.Wg)(function(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;const s=e.visualVariables.find((e=>"size"===e.type)),i=((e,t)=>{const s=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return t?.levels?t.levels[s]:null})(t,s);return i?new Z.Z({field:s.field,minSize:i[2].size,minDataValue:i[2].value,maxSize:i[3].size,maxDataValue:i[3].value}):null}(t,this.view));if(i){const t=s.featureReduction;if("clusterMinSize"in t&&"clusterMaxSize"in t){const{clusterMinSize:e,clusterMaxSize:s}=t;i.legendOptions=new N.Z({showLegend:e!==s})}const r=e.visualVariables||[];e.visualVariables=r.concat([i]),this._hasClusterSizeVariable=!0}}const r=await(0,ee.jb)(e);if(Re(e)||ze(e)){const s=(e.classBreakInfos||e.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,r).then((t=>{e.symbol=t})).catch((()=>{e.symbol=null}))));Array.prototype.push.apply(t,s)}return t.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:r).then((t=>{this._applySymbolToRenderer(e,t,Fe(e))})).catch((()=>{this._applySymbolToRenderer(e,null,Fe(e))}))),(0,L.as)(t).then((()=>e))}_applySymbolToRenderer(e,t,s){s?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if("web-style"===e.type){const s=this._webStyleSymbolCache;try{const i=await("2d"===this.view.type?e.fetchCIMSymbol({cache:s}):e.fetchSymbol({cache:s}));return this._getAppliedCloneSymbol(i,t)}catch{throw _e.warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const s=e.clone(),i=t&&t.toRgba();return s.type.includes("3d")?this._applyColorTo3dSymbol(s,i):"cim"===s.type?(0,D.ZB)(s,t):s.color&&(s.color=new f.Z(i||s.color)),s}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new f.Z(t))}))}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const s=e.visualVariables,i=[],r=[],l=[];for(const e of s)"color"===e.type?i.push(e):"size"===e.type?r.push(e):"opacity"===e.type&&l.push(e);const a=[...i,...r,...l];let o,c;if(0===i.length&&Re(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];o=t&&t.symbol}if(0===i.length&&Fe(e)&&(o=e.symbol),o)if(o.type.includes("3d")){const e=o.symbolLayers.getItemAt(0);"water"===e.type?(0,n.pC)(e.color)&&(c=e.color):(0,n.pC)(e.material)&&(0,n.pC)(e.material.color)&&(c=e.material.color)}else o.url||(c=o.color);const d=this.effectList;return(await Promise.all(a.map((async s=>{if(!s.legendOptions||!1!==s.legendOptions.showLegend){const i=Ce(e)?s.field:this._getRampTitle(s,t);let r=null;const n="getField"in t&&t.getField&&t.getField(s.field),l=n&&(0,A.y2)(n);if("color"===s.type){const e=await(0,W.pO)(s,null,l);r={type:"color-ramp",title:i,infos:e,preview:(0,B.jT)(e.map((e=>e.color)),{effectList:d})},this._hasColorRamp||(this._hasColorRamp=!(null==r.infos||!r.infos.length))}else if("size"===s.type&&"outline"!==s.target)ve.test(s.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=s):(r=await this._getSizeLegendElement(i,s,e,l),this._hasSizeRamp||(this._hasSizeRamp=!(null==r.infos||!r.infos.length)));else if("opacity"===s.type){const e=await(0,W.pO)(s,c,l);r={type:"opacity-ramp",title:i,infos:e,preview:(0,B.jT)(e.map((e=>e.color)),{effectList:d})},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==r.infos||!r.infos.length))}return r&&r.infos?r:null}})))).filter((e=>!!e))}_getDomainName(e,t,s){if(e&&"function"!=typeof e){const i="getField"in s&&s.getField&&s.getField(e),r=i&&"getFieldDomain"in s&&s.getFieldDomain?s.getFieldDomain(i.name):null;return r&&"coded-value"===r.type?r.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,s=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,i="popupTemplate"in e&&e.popupTemplate,r=i&&i.fieldInfos;if(r)for(const e of r)if(e.fieldName===s)return"cluster_count"===s?e.label||{showCount:!0}:e.label}return{showCount:!0}}_getRampTitle(e,t){let s=e.field,i=e.normalizationField,r=!1,n=!1,l=!1,a=null;s="function"==typeof s?null:s,i="function"==typeof i?null:i;const o=e.legendOptions&&e.legendOptions.title;if(null!=o)a=o;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const s=e[t];if("color"===s.type){if("ratio"===s.style){r=!0;break}if("percent"===s.style){n=!0;break}if("percent-of-total"===s.style){l=!0;break}}}}a={field:s&&this._getFieldAlias(s,t),normField:i&&this._getFieldAlias(i,t),ratio:r,ratioPercent:n,ratioPercentTotal:l}}return a}_getRendererTitle(e,t){const s=e;if(s.legendOptions&&s.legendOptions.title)return s.legendOptions.title;if(s.valueExpressionTitle)return s.valueExpressionTitle;let i=s.field,r=null,n=null;Re(s)&&(r=s.normalizationField,n="percent-of-total"===s.normalizationType),i="function"==typeof i?null:i,r="function"==typeof r?null:r;let l=null;return(i||r)&&(l={field:i&&this._getFieldAlias(i,t),normField:r&&this._getFieldAlias(r,t),normByPct:n}),l}_getFieldAlias(e,t){const s="popupTemplate"in t&&t.popupTemplate,i=s&&s.fieldInfos;let r=null;i&&i.some((t=>e===t.fieldName&&(r=t,!0)));let n=null;"getField"in t&&t.getField?n=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(n=t.fieldsIndex.get(e));const l=r||n;let a=null;return l&&(a=r&&r.label||n&&n.alias||"name"in l&&l.name||"fieldName"in l&&l.fieldName),a}_isUnclassedRenderer(e){const t=e.visualVariables;let s=!1;return Re(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(s=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),s}};(0,i._)([(0,d.Cb)()],qe.prototype,"children",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],qe.prototype,"effectList",null),(0,i._)([(0,d.Cb)()],qe.prototype,"layerView",void 0),(0,i._)([(0,d.Cb)()],qe.prototype,"layer",void 0),(0,i._)([(0,d.Cb)()],qe.prototype,"legendElements",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],qe.prototype,"opacity",null),(0,i._)([(0,d.Cb)()],qe.prototype,"parent",void 0),(0,i._)([(0,d.Cb)({readOnly:!0,dependsOn:[]})],qe.prototype,"ready",null),(0,i._)([(0,d.Cb)()],qe.prototype,"hideLayersNotInCurrentView",void 0),(0,i._)([(0,d.Cb)()],qe.prototype,"keepCacheOnDestroy",void 0),(0,i._)([(0,d.Cb)()],qe.prototype,"respectLayerVisibility",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],qe.prototype,"scale",null),(0,i._)([(0,d.Cb)()],qe.prototype,"sublayerIds",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],qe.prototype,"isScaleDriven",null),(0,i._)([(0,d.Cb)()],qe.prototype,"title",void 0),(0,i._)([(0,d.Cb)({readOnly:!0,dependsOn:["ready"],value:0})],qe.prototype,"version",null),(0,i._)([(0,d.Cb)()],qe.prototype,"view",void 0),qe=(0,i._)([(0,u.j)("esri.widgets.Legend.support.ActiveLayerInfo")],qe);const je=qe;var Ue=s(8108);const Ye="state",Je="all-layer-views",Ge="legend-properties",Xe=p.Z.ofType(je),Qe=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],Ke="view.basemapView.baseLayerViews",et="view.groundView.layerViews",tt="view.basemapView.referenceLayerViews",st=[Ke,et,"view.layerViews",tt];let it=class extends y.Z{constructor(e){super(e),this._handles=new r.Z,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new p.Z,this.activeLayerInfos=new Xe,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add((0,l.YP)((()=>this.view),(()=>this._viewHandles()),l.nn),"view"),this._handles.add((0,Ue.qe)((()=>this._refresh())))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(Ye),this.view&&this._handles.add((0,l.YP)((()=>this.state),(()=>this._stateHandles()),l.nn),Ye)}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove([Je,Ge]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",(e=>this._allLayerViewsChangeHandle(e))),Je),this._handles.add((0,l.YP)((()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible]),(()=>this._propertiesChangeHandle())),Ge)}_allLayerViewsChangeHandle(e){e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){if(e.length<2)return;const t=[];e.forEach((s=>{if(!s.parent){const i=s.layer.parent,r=i&&"uid"in i&&this._layerViewByLayerId[i.uid],n=r&&this._activeLayerInfosByLayerViewId[r.uid];n&&e.includes(n)&&(t.push(s),s.parent=n,n.children.add(s),this._sortActiveLayerInfos(n.children))}})),e.removeMany(t);const s={};this.view.allLayerViews.forEach(((e,t)=>s[e.layer.uid]=t)),e.sort(((e,t)=>{const i=s[e.layer.uid]||0;return(s[t.layer.uid]||0)-i}))}_generateLayerViews(){const e=[];return st.filter(this._filterLayerViews,this).map(this.get,this).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===Ke||e===tt),s=!this.groundLegendVisible&&e===et;return!t&&!s}_collectLayerViews(e,t){const s=i=>(i&&i.forEach((i=>{t.push(i),s(i[e])})),t);return s}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some((t=>this._hasLayerInfo(t,e)))}_hasLayerInfo(e,t){const s=this._isLayerUIDMatching(e.layer,t.layer.uid);return s&&(this._layerInfosByLayerViewId[t.uid]=e),s}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some((e=>this._isLayerUIDMatching(e,t)))}_isLayerViewSupported(e){return!!Qe.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add((0,l.YP)((()=>[e.legendEnabled,e.layer?.legendEnabled]),(()=>this._layerActiveHandle(e))),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){const t=e.layer,s=e.uid,i=this._layerInfosByLayerViewId[s];let r=this._activeLayerInfosByLayerViewId[s];if(!r){const n=i&&void 0!==i.title&&i.layer.uid===t.uid;r=new je({layer:t,layerView:e,title:n?i.title:t.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:i&&i.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[s]=r}const n=t.parent&&"uid"in t.parent&&this._layerViewByLayerId[t.parent?.uid];if(r.parent=this._activeLayerInfosByLayerViewId[n?.uid],!this._handles.has(s)){const i=[(0,l.YP)((()=>t.title),(e=>this._titleHandle(e,r))),(0,l.YP)((()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol]),(()=>this._constructLegendElements(r))),(0,l.gx)((()=>!0===this.view?.stationary),(()=>this._scaleHandle(r)),l.nn),(0,l.YP)((()=>e._effectiveRenderer),(()=>this._constructLegendElements(r))),(0,l.YP)((()=>"effect"in t&&t.effect),(()=>this._constructLegendElements(r)))];if(this.respectLayerVisibility){const s=(0,l.YP)((()=>e.legendEnabled),(e=>this._legendEnabledHandle(e,r))),n=(0,l.YP)((()=>t.legendEnabled),(e=>this._legendEnabledHandle(e,r)));i.push(s,n)}this._handles.add(i,s)}r.isScaleDriven||this._constructLegendElements(r),this._addActiveLayerInfo(r)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){const{layerView:t,layer:s}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){const t=e.parent;if(t)t.children.includes(e)||t.children.push(e),this._sortActiveLayerInfos(t.children);else{const t=this.layerInfos?.some((e=>e.layer.uid===s.uid));s.parent&&"uid"in s.parent&&!t?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((t=>{const s=t.layer.parent,i=s&&"uid"in s&&this._layerViewByLayerId[s?.uid],r=this._activeLayerInfosByLayerViewId[i?.uid];r&&(e.push(t),t.parent=r)})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&"binning"===t.featureReduction?.type&&"renderer"in t.featureReduction?e.buildLegendElementsForRenderer(t.featureReduction.renderer):"renderer"in t&&t.renderer?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)))}};(0,i._)([(0,d.Cb)({type:Xe})],it.prototype,"activeLayerInfos",void 0),(0,i._)([(0,d.Cb)()],it.prototype,"basemapLegendVisible",void 0),(0,i._)([(0,d.Cb)()],it.prototype,"groundLegendVisible",void 0),(0,i._)([(0,d.Cb)()],it.prototype,"hideLayersNotInCurrentView",void 0),(0,i._)([(0,d.Cb)()],it.prototype,"keepCacheOnDestroy",void 0),(0,i._)([(0,d.Cb)()],it.prototype,"respectLayerVisibility",void 0),(0,i._)([(0,d.Cb)()],it.prototype,"layerInfos",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],it.prototype,"state",null),(0,i._)([(0,d.Cb)()],it.prototype,"view",void 0),it=(0,i._)([(0,u.j)("esri.widgets.Legend.LegendViewModel")],it);const rt=it;var nt=s(13266),lt=s(26451);const at="esri-relationship-ramp--diamond__middle-column--label",ot="esri-relationship-ramp--square__table-row",ct="esri-relationship-ramp--square__table-cell",dt="esri-relationship-ramp--square__table-label";function ut(e,t,s,i){const{focus:r,labels:n}=e,l=!!r,a=function(e,t,s,i,r=60){const{focus:n,numClasses:l,colors:a,rotation:o}=e,c=!!n,d=Math.sqrt(r**2+r**2)+(c?0:5),u=[],h=[],y=[],p=(r||75)/l;for(let e=0;e<l;e++){const t=e*p;for(let s=0;s<l;s++){const i=s*p,r=(0,nt.jA)(a[e][s]),n=(0,nt.kQ)(null),l={type:"rect",x:i,y:t,width:p,height:p};u.push((0,nt.ch)(r)),h.push((0,nt.vq)(l,r.fill,n,null)),y.push((0,nt.A5)(l))}}let f=null;c||(f="margin: -15px -15px -18px -15px");const m=ht("left",n,t),g=ht("right",n,t),b=(0,nt.al)(y),_=(0,nt.iL)(b,d,d,0,!1,o,!1),v=(0,nt.iL)(b,d,d,0,!1,c?-45:null,!1),L={filter:(0,H.wJ)(i),opacity:null==s?null:`${s}`};return(0,lt.u)("div",{styles:L,class:c?"esri-relationship-ramp--diamond__middle-column--ramp":ct},(0,lt.u)("svg",{xmlns:"http://www.w3.org/2000/svg",width:d,height:d,style:f},(0,lt.u)("defs",null,(0,lt.u)("marker",{id:`${t}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,lt.u)("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),(0,lt.u)("marker",{id:`${t}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,lt.u)("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),u),(0,lt.u)("g",{transform:_},h),(0,lt.u)("g",{transform:v},(0,lt.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":m.markerStart,"marker-end":m.markerEnd,x1:-10,y1:r-15,x2:-10,y2:15}),(0,lt.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":g.markerStart,"marker-end":g.markerEnd,x1:15,y1:r+10,x2:r-15,y2:r+10}))))}(e,t,s,i),o=(0,te.dZ)();return l?(0,lt.u)("div",{class:"esri-relationship-ramp--diamond__container",styles:{justifyContent:"center"}},(0,lt.u)("div",{class:"esri-relationship-ramp--diamond__left-column"},o?n.right:n.left),(0,lt.u)("div",{class:"esri-relationship-ramp--diamond__middle-column"},(0,lt.u)("div",{class:at},n.top),a,(0,lt.u)("div",{class:at},n.bottom)),(0,lt.u)("div",{class:"esri-relationship-ramp--diamond__right-column"},o?n.left:n.right)):(0,lt.u)("div",{class:"esri-relationship-ramp--square__table"},(0,lt.u)("div",{class:ot},(0,lt.u)("div",{class:(0,te.Sh)(ct,dt,"esri-relationship-ramp--square__table-label--right-bottom")},o?n.top:n.left),(0,lt.u)("div",{class:ct}),(0,lt.u)("div",{class:(0,te.Sh)(ct,dt,"esri-relationship-ramp--square__table-label--left-bottom")},o?n.left:n.top)),(0,lt.u)("div",{class:ot},(0,lt.u)("div",{class:ct}),a,(0,lt.u)("div",{class:ct})),(0,lt.u)("div",{class:ot},(0,lt.u)("div",{class:(0,te.Sh)(ct,dt,"esri-relationship-ramp--square__table-label--right-top")},o?n.right:n.bottom),(0,lt.u)("div",{class:ct}),(0,lt.u)("div",{class:(0,te.Sh)(ct,dt,"esri-relationship-ramp--square__table-label--left-top")},o?n.bottom:n.right)))}function ht(e,t,s){const i=`${s}_arrowStart`,r=`${s}_arrowEnd`,n="left"===e,l={markerStart:null,markerEnd:null};switch(t){case"HL":n?l.markerStart=`url(#${r})`:l.markerEnd=`url(#${i})`;break;case"LL":l.markerStart=`url(#${r})`;break;case"LH":n?l.markerEnd=`url(#${i})`:l.markerStart=`url(#${r})`;break;default:l.markerEnd=`url(#${i})`}return l}s(56803);const yt=(0,s(22591).E)(),pt="esri-univariate-above-and-below-ramp__symbol";function ft(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,lt.u)("svg",{height:"4",width:"10"},(0,lt.u)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):(0,lt.u)("svg",{height:"10",width:"10"},(0,lt.u)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function mt(e,t="vertical"){const s=document.createElement("div");return s.style.height="20px",s.className=pt,null!=e&&(s.style.opacity=e.toString()),yt.append(s,ft.bind(null,t)),s}function gt(e,t,s="vertical",i){e.infos.forEach(((e,r)=>{if(i&&2===r)e.preview=mt(t,s);else{const t=(0,w.F2)(e.size)+("horizontal"===s?20:10),i="div"===e.preview.tagName.toLowerCase(),r=i?e.preview:document.createElement("div");r.className=pt,"horizontal"===s?r.style.width=`${t}px`:r.style.height=`${t}px`,i||r.appendChild(e.preview),e.preview=r}}))}function bt(e,t="classic"){const s=e.infos;return"classic"===t?((0,w.F2)(s[0].size)+10)/2:((0,w.F2)(s[0].size)-(0,w.F2)(s[s.length-1].size))/2}function _t(e,t){if(!e)return null;const s=e.infos.map((e=>e.color)),i=(0,B.jT)("full"===t.type?s:"above"===t.type?s.slice(0,3):s.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return i.className="esri-legend__color-ramp",null!=t.opacity&&(i.style.opacity=t.opacity.toString()),i}function vt(e,t,s,i="vertical"){let r=0;const n=e.infos,l=Math.floor(n.length/2),a="full"===t||"above"===t?0:l,o="full"===t||"below"===t?n.length-1:l;for(let e=a;e<=o;e++)r+=s&&e===l?"horizontal"===i?10:20:(0,w.F2)(n[e].size)+("horizontal"===i?20:10);return Math.round(r)}function Lt(e,t,s,i="vertical"){const r=vt(e,t,s,i),n=e.infos,l=Math.floor(n.length/2),a="full"===t||"above"===t?0:l,o="full"===t||"below"===t?n.length-1:l,c="full"===t?n[a].size+n[o].size:"above"===t?n[a].size:n[o].size,d=s?"vertical"===i?20:10:0,u="vertical"===i?10*("full"===t?2:1):20*("full"===t?2:1);return Math.round(r-((0,w.F2)(c)/2+d/2+u/2))}function wt(e,t,s="vertical"){const i=e.infos;let r=i.find((({type:e})=>"size-ramp"===e)),n=i.find((({type:e})=>"color-ramp"===e));return r&&(r={...r},r.infos=[...r.infos],gt(r,t,s,!0)),n&&(n={...n},n.infos=[...n.infos]),"horizontal"===s&&(r?.infos.reverse(),n?.infos.reverse()),{sizeRampElement:r,colorRampElement:n}}function St(e,t="vertical"){const s=e.infos;let i=s.find((({type:e})=>"size-ramp"===e)),r=s.find((({type:e})=>"color-ramp"===e));return i&&(i={...i},i.infos=[...i.infos],gt(i,null,t,!1)),r&&(r={...r},r.infos=[...r.infos]),"horizontal"===t&&(i?.infos.reverse(),r?.infos.reverse()),{sizeRampElement:i,colorRampElement:r}}var It=s(61547);function Ct(e){e.appendChild(this)}function Et(e,t,s){if(!t)return;if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return(0,It.n)(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;let i=null;return s?i=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:Vt(0,s)&&(i=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),i?(0,It.n)("showField"===i?"{field}":e[i],{field:t.field,normField:t.normField}):null}function Vt(e,t){return!t}function xt(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}var kt=s(62199),Ft=s(92165),Rt=s(34236);const zt="esri-legend--card__image-label",Mt="esri-legend--card__layer-caption",At="esri-legend--card__layer-row",Tt="esri-legend--card__ramp-label",Pt="esri-legend--card__service",Nt="esri-legend--card__symbol",Dt="esri-legend--card__symbol-row",Ot="esri-legend--card__service-caption-container",$t="esri-legend--card__symbol-container",Bt="esri-legend--card__size-ramp-container",Ht="esri-legend__size-ramp--horizontal",Zt="esri-legend__ramp-labels",Wt="esri-legend__layer-cell esri-legend__layer-cell--info",qt="esri-univariate-above-and-below-ramp__color--card";var jt,Ut;(Ut=jt||(jt={})).Auto="auto",Ut.Stack="stack",Ut.SideBySide="side-by-side";const Yt=window.devicePixelRatio;let Jt=class extends h.Z{constructor(e,t){super(e,t),this._handles=new r.Z,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=jt.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own((0,l.YP)((()=>this.activeLayerInfos),(e=>{this._handles.removeAll(),this._watchForSectionChanges(e)})))}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===jt.Auto&&this.view.container.clientWidth<=768||this.layout===jt.Stack;const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const s=this._sectionNames.length,i=this._sectionNames.map(((e,t)=>{const i=(0,It.n)(this.messagesCommon.pagination.pageText,{index:t+1,total:s});return(0,lt.u)("div",{key:e,role:"tab",id:e,"aria-label":i,"aria-controls":`${e}-panel`,"aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:i,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes("esri-legend--card__carousel-indicator",{"esri-legend--card__carousel-indicator--activated":this._selectedSectionName===e}),"data-section-name":e})})),r=this._hasIndicators&&s>1?(0,lt.u)("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation",role:"tablist"},i):null,n=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,l={"esri-legend--stacked":this._hasIndicators};return(0,lt.u)("div",{class:this.classes("esri-legend--card",l)},n||(0,lt.u)("div",{class:"esri-legend--card__message"},this.messages.noLegend),r)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,s="ArrowLeft"===t?-1:1,i=e.target.getAttribute("data-section-name"),r=this._sectionNames.indexOf(i),n=this._sectionNames;let l=null;-1!==r&&(n[r+s]?l=document.getElementById(n[r+s]):"ArrowLeft"===t?l=document.getElementById(n[n.length-1]):"ArrowRight"===t&&(l=document.getElementById(n[0])),l&&l.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const t=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(t),this._watchForSectionChanges(e.children),this._handles.add((0,l.YP)((()=>e.version),(()=>this._generateSectionNames())),t)}));const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,s){return`${this.id}${e.uid}-type-${t.type}-${s}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,s)=>{this._sectionNames.push(this._getSectionName(e.layer,t,s))}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return(0,lt.u)("div",{key:e.layer.uid,class:this.classes(Pt,"esri-legend--card__group-layer")},(0,lt.u)("div",{class:Ot},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.some((e=>"relationship-ramp"===e.type)),i=t.map(((t,i)=>this._renderLegendForElement(t,e,i,s))).filter((e=>!!e));if(!i.length)return null;const r={"esri-legend--card__group-layer-child":!!e.parent};return(0,lt.u)("div",{key:e.layer.uid,class:this.classes(Pt,r)},(0,lt.u)("div",{class:Ot},(0,lt.u)("div",{class:"esri-legend--card__service-caption-text"},e.title)),(0,lt.u)("div",{class:"esri-legend--card__service-content"},i))}}_renderLegendForElement(e,t,s,i=!1){const r="color-ramp"===e.type,n="opacity-ramp"===e.type,l="size-ramp"===e.type,a=t.layer;let o=null;if("string"==typeof e.title)o=e.title;else if(e.title){const t=e.title,s=Et(this.messages,t,r||n);o=t.title?`${t.title} (${s})`:s}const c=this._getSectionName(a,e,s),d=this._hasIndicators?(0,lt.u)("div",null,(0,lt.u)(kt.X6,{level:this.headingLevel,class:"esri-legend--card__carousel-title"},t.title),(0,lt.u)(kt.X6,{level:(0,kt.MJ)(this.headingLevel),class:Mt},o)):o?(0,lt.u)(kt.X6,{level:this.headingLevel,class:Mt},o):null,u=t.effectList;let h=null;if("symbol-table"===e.type){const s=e.infos.map(((s,i)=>this._renderLegendForElementInfo(s,t,e.legendType,i))).filter((e=>!!e));if(s.length){const e={"esri-legend--card__label-container":!(s[0].properties.classes&&s[0].properties.classes[Dt])&&!i,"esri-legend--card__relationship-label-container":i};h=(0,lt.u)("div",{class:this.classes(e)},s)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?h=this._renderLegendForRamp(e,a.opacity,u):l?h=this._renderSizeRamp(e,a.opacity):"pie-chart-ramp"===e.type?h=this._renderPieChartRamp(e):"relationship-ramp"===e.type?h=ut(e,this.id,a.opacity,u):"univariate-above-and-below-ramp"===e.type?h=this._renderUnivariateAboveAndBelowRamp(e,a.opacity,u):"univariate-color-size-ramp"===e.type&&(h=this._renderUnivariateColorSizeRamp(e,a.opacity,u));if(!h)return null;const y=(0,lt.u)("div",{key:c,class:"esri-legend--card__section",id:`${c}-panel`,role:"tabpanel","aria-labelledby":c,tabIndex:0},[d,h]);return this._sectionMap.set(c,y),y}_renderPieChartRamp(e){return(0,lt.u)("div",{class:"esri-legend--card__pie-chart-ramp-preview",bind:e.preview,afterCreate:Ct})}_renderUnivariateAboveAndBelowRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=wt(e,t,"horizontal");if(!i)return null;const n=vt(i,"full",!0,"horizontal"),l=Lt(i,"above",!0,"horizontal"),a=Lt(i,"below",!0,"horizontal"),o=_t(r,{width:l,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:s}),c=_t(r,{width:a,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:s}),d=bt(i,"card"),u=i.infos.map((e=>e.label)),h=u.length-1,y=u.map(((e,t)=>0===t||t===h?(0,lt.u)("div",{key:t},e):null)),p={marginTop:"3px",display:"flex"};(0,te.dZ)(this.container)?p.marginRight=`${d}px`:p.marginLeft=`${d}px`;const f={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,lt.u)("div",{class:At,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,lt.u)("div",{class:this.classes($t,Ht),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>(0,lt.u)("div",{key:t,class:Nt,bind:e.preview,afterCreate:Ct})))),o?(0,lt.u)("div",{class:qt,styles:p,key:"color-ramp-preview"},(0,lt.u)("div",{bind:o,afterCreate:Ct}),(0,lt.u)("div",{bind:c,afterCreate:Ct})):null,(0,lt.u)("div",{class:Wt},(0,lt.u)("div",{class:Zt,styles:f},y)))}_renderUnivariateColorSizeRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=St(e,"horizontal");if(!i)return null;const n=vt(i,"full",!1,"horizontal"),l=_t(r,{width:Lt(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:s}),a=bt(i,"card"),o=i.infos.length-1,c=i.infos.map(((e,t)=>0===t||t===o?(0,lt.u)("div",{key:t},e.label):null)),d={marginTop:"3px",display:"flex"};(0,te.dZ)(this.container)?d.marginRight=`${a}px`:d.marginLeft=`${a}px`;const u={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,lt.u)("div",{class:At,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,lt.u)("div",{class:this.classes($t,Ht),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>(0,lt.u)("div",{key:t,class:Nt,bind:e.preview,afterCreate:Ct})))),(0,lt.u)("div",{class:qt,styles:d,key:"color-ramp-preview"},(0,lt.u)("div",{bind:l,afterCreate:Ct})),(0,lt.u)("div",{class:Wt},(0,lt.u)("div",{class:Zt,styles:u},c)))}_renderLegendForElementInfo(e,t,s,i){const r=t.layer;if(e.type)return this._renderLegendForElement(e,t,i);const n=xt(r,s);if(e.preview){if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return(0,lt.u)("div",{key:i,bind:e.preview,afterCreate:Ct});const t={"esri-legend--card__symbol-cell":this._hasIndicators};return(0,lt.u)("div",{key:i,class:this.classes(At,{[Dt]:this._hasIndicators})},(0,lt.u)("div",{class:this.classes(t),bind:e.preview,afterCreate:Ct}),(0,lt.u)("div",{class:this.classes(zt,{"esri-legend--card__label-cell":this._hasIndicators})},Et(this.messages,e.label,!1)||""))}let s=255,n=255,l=255,a=0,o=255,c=255,d=255,u=0;const h=e.symbol.color&&e.symbol.color.a,y=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;h&&(s=e.symbol.color.r,n=e.symbol.color.g,l=e.symbol.color.b,a=e.symbol.color.a*r.opacity),y&&(o=e.symbol.outline.color.r,c=e.symbol.outline.color.g,d=e.symbol.outline.color.b,u=e.symbol.outline.color.a*r.opacity);const p=e.symbol.color?.isBright??!0,f=p?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",m={background:h?`rgba(${s}, ${n}, ${l}, ${a})`:"none",color:p?"black":"white",textShadow:`-1px -1px 0 ${f},\n                                              1px -1px 0 ${f},\n                                              -1px 1px 0 ${f},\n                                              1px 1px 0 ${f}`,border:y?`1px solid rgba(${o}, ${c}, ${d}, ${u})`:"none",filter:(0,H.wJ)(t.effectList)};return(0,lt.u)("div",{key:i,class:At},(0,lt.u)("div",{class:"esri-legend--card__label-element",styles:m}," ",e.label," "))}if(e.src){const t=this._renderImage(e,r,n);return(0,lt.u)("div",{key:i,class:At},t,(0,lt.u)("div",{class:zt},e.label||""))}}_renderImage(e,t,s){const{label:i,src:r,opacity:n}=e,l={"esri-legend--card__imagery-layer-image--stretched":s,[Nt]:!s},a={opacity:`${null!=n?n:t.opacity}`};return(0,lt.u)("img",{alt:Et(this.messages,i,!1),src:r,border:0,width:e.width,height:e.height,class:this.classes(l),styles:a})}_renderSizeRampLines(e){const t=e.infos,s=t[0],i=t[t.length-1],r=s.symbol,n=this._hasIndicators,l=(0,w.F2)(s.size+s.outlineSize)*Yt,a=(0,w.F2)(i.size+i.outlineSize)*Yt,o=n?l:l+50*Yt,c=n?l/2+50*Yt:l,d=function(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const s=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===s||"cone"===s||"tetrahedron"===s}return"triangle"===e.style}}(r),u=function(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const s=e.symbolLayers.getItemAt(t-1),i=s.resource&&s.resource.primitive;return"circle"===i||"cross"===i||"kite"===i||"sphere"===i||"cube"===i||"diamond"===i}{const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}}}(r),h=document.createElement("canvas");h.width=o,h.height=c,h.style.width=h.width/Yt+"px",h.style.height=h.height/Yt+"px";const y=h.getContext("2d");if(n){y.beginPath();const e=0,t=0,s=o/2-a/2,i=c;y.moveTo(e,t),y.lineTo(s,i);const r=o,n=0,l=o/2+a/2,d=c;y.moveTo(r,n),y.lineTo(l,d)}else{y.beginPath();const e=0,t=c/2-a/2,s=o,i=0;y.moveTo(e,t),y.lineTo(s,i);const r=0,n=c/2+a/2,l=o,d=c;y.moveTo(r,n),y.lineTo(l,d)}return y.strokeStyle="#ddd",y.stroke(),(0,lt.u)("div",{bind:h,afterCreate:Ct,styles:n?{display:"flex",marginTop:`-${d?0:u?l/2:0}px`,marginBottom:`-${d?a:u?a/2:0}px`}:{display:"flex",marginRight:`-${d?0:u?l/2:0}px`,marginLeft:`-${d?0:u?a/2:0}px`}})}_renderSizeRamp(e,t){const s=e.infos,i=s[0].label,r=s[s.length-1].label;let n=s[0].preview,l=s[s.length-1].preview;const a=this._hasIndicators,o={"flex-direction":a?"column":"row-reverse"};n&&(n=n.cloneNode(!0),n.style.display="flex"),l&&(l=l.cloneNode(!0),l.style.display="flex");const c={opacity:null!=t?`${t}`:""};return(0,lt.u)("div",{class:this.classes(At,{"esri-legend--card__size-ramp-row":a})},(0,lt.u)("div",{class:Tt},a?i:r),(0,lt.u)("div",{class:Bt,styles:o},(0,lt.u)("div",{bind:n,afterCreate:Ct,class:"esri-legend--card__size-ramp-preview",styles:c}),this._renderSizeRampLines(e),(0,lt.u)("div",{bind:l,afterCreate:Ct,class:Bt,styles:c})),(0,lt.u)("div",{class:Tt},a?r:i))}_renderLegendForRamp(e,t,s){const i=e.infos,r="heatmap-ramp"===e.type,n=i.length-1,l=n>2&&!r?25*n:100,a=l+20,o=i.slice(0).reverse();o.forEach(((e,t)=>{e.offset=r?e.ratio:t/n}));const c=o.length-1,d=o.length%2!=0&&o[o.length/2|0],u=d&&(0,lt.u)("div",{class:"esri-legend--card__interval-separators-container"},(0,lt.u)("div",{class:"esri-legend--card__interval-separator"},"|"),(0,lt.u)("div",{class:Tt},d.label)),h=i[i.length-1].label,y=i[0].label,p=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:o[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:l,height:25},fill:{type:"linear",x1:10,y1:0,x2:l+10,y2:0,colors:o},stroke:{width:0}},{shape:{type:"path",path:`M${l+10} 0 L${a} 12.5 L${l+10} 25 Z`},fill:o[c].color,stroke:{width:0}}]],f=(0,nt.KB)(p,a,25),{messages:m}=this,g={filter:(0,H.wJ)(s),opacity:null==t?null:`${t}`};return(0,lt.u)("div",{class:At,styles:{justifyContent:"center"}},(0,lt.u)("div",{class:Tt},r?m[h]:h),(0,lt.u)("div",{class:$t},(0,lt.u)("div",{styles:g},f),u),(0,lt.u)("div",{class:Tt},r?m[y]:y))}};(0,i._)([(0,d.Cb)()],Jt.prototype,"activeLayerInfos",void 0),(0,i._)([(0,d.Cb)()],Jt.prototype,"headingLevel",void 0),(0,i._)([(0,d.Cb)()],Jt.prototype,"layout",void 0),(0,i._)([(0,d.Cb)(),(0,Rt.H)("esri/widgets/Legend/t9n/Legend")],Jt.prototype,"messages",void 0),(0,i._)([(0,d.Cb)(),(0,Rt.H)("esri/t9n/common")],Jt.prototype,"messagesCommon",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],Jt.prototype,"type",void 0),(0,i._)([(0,d.Cb)()],Jt.prototype,"view",void 0),(0,i._)([(0,Ft.h)()],Jt.prototype,"_selectSection",null),Jt=(0,i._)([(0,u.j)("esri.widgets.Legend.styles.Card")],Jt);const Gt=Jt,Xt="esri-legend__service",Qt="esri-legend__layer-body",Kt="esri-legend__layer-row",es="esri-legend__layer-cell esri-legend__layer-cell--info",ts="esri-legend__imagery-layer-info--stretched",ss="esri-legend__layer-cell esri-legend__layer-cell--symbols",is="esri-legend__symbol",rs="esri-legend__ramps",ns="esri-legend__size-ramp",ls="esri-legend__ramp-labels",as="esri-legend__ramp-label",os="esri-univariate-above-and-below-ramp__label",cs={display:"flex",alignItems:"flex-start"},ds={marginLeft:"3px"},us={display:"table-cell",verticalAlign:"middle"};let hs=class extends h.Z{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return(0,lt.u)("div",null,t&&t.length?t:(0,lt.u)("div",{class:"esri-legend__message"},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,s=`esri-legend__${e.layer.uid}-version-${e.version}`,i=e.title?(0,kt.X6)({level:this.headingLevel,class:this.classes("esri-widget__heading","esri-legend__service-label")},e.title):null;if(t){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return(0,lt.u)("div",{key:s,class:this.classes(Xt,"esri-legend__group-layer")},i,t)}{const t=e.legendElements;if(t&&!t.length)return null;const r=t.map((t=>this._renderLegendForElement(t,e.layer,e.effectList))).filter((e=>!!e));if(!r.length)return null;const n={"esri-legend__group-layer-child":!!e.parent};return(0,lt.u)("div",{key:s,class:this.classes(Xt,n),tabIndex:0},i,(0,lt.u)("div",{class:"esri-legend__layer"},r))}}_renderLegendForElement(e,t,s,i){const r="color-ramp"===e.type,n="opacity-ramp"===e.type,l="size-ramp"===e.type;let a=null;if("symbol-table"===e.type||l){const i=e.infos.map((i=>this._renderLegendForElementInfo(i,t,s,l,e.legendType))).filter((e=>!!e));i.length&&(a=(0,lt.u)("div",{class:Qt},i))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?a=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?a=ut(e,this.id,t.opacity,s):"pie-chart-ramp"===e.type?a=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?a=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,s):"univariate-color-size-ramp"===e.type&&(a=this._renderUnivariateColorSizeRamp(e,t.opacity,s));if(!a)return null;const o=e.title;let c=null;if("string"==typeof o)c=o;else if(o){const e=Et(this.messages,o,r||n);c=Vt(0,r||n)&&o.title?`${o.title} (${e})`:e}const d=i?"esri-legend__layer-child-table":"esri-legend__layer-table",u=c?(0,lt.u)("div",{class:"esri-legend__layer-caption"},c):null,h={"esri-legend__layer-table--size-ramp":l||!i};return(0,lt.u)("div",{class:this.classes(d,h)},u,a)}_renderPieChartRamp(e){return(0,lt.u)("div",{bind:e.preview,afterCreate:Ct})}_renderUnivariateAboveAndBelowRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=wt(e,t);if(!i)return null;const n=Lt(i,"above",!0),l=Lt(i,"below",!0),a=_t(r,{width:12,height:n,rampAlignment:"vertical",opacity:t,type:"above",effectList:s}),o=_t(r,{width:12,height:l,rampAlignment:"vertical",opacity:t,type:"below",effectList:s}),c=bt(i),d=i.infos.map((e=>e.label)),u=d.map(((e,t)=>{const s=2===t;return 0===t?(0,lt.u)("div",{key:t,class:e?a?os:as:null},e):s?(0,lt.u)("div",null):null})),h=d.length-1,y=Math.floor(d.length/2),p=d.map(((e,t)=>t===y||t===h?(0,lt.u)("div",{key:t,class:e?a?os:as:null},e):null)),f={display:"table-cell",verticalAlign:"middle"},m={marginTop:`${c}px`},g={height:`${n}px`},b={height:`${l}px`};return(0,lt.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:cs},(0,lt.u)("div",{class:Qt},i.infos.map(((e,t)=>(0,lt.u)("div",{class:this.classes(Kt,ns)},(0,lt.u)("div",{class:is,styles:f,bind:e.preview,afterCreate:Ct}),a||t%2!=0?null:(0,lt.u)("div",{class:es},d[t]))))),a?(0,lt.u)("div",{styles:m,key:"color-ramp-preview"},(0,lt.u)("div",{styles:ds},(0,lt.u)("div",{styles:us},(0,lt.u)("div",{class:rs,bind:a,afterCreate:Ct})),(0,lt.u)("div",{styles:us},(0,lt.u)("div",{class:ls,styles:g},u))),(0,lt.u)("div",{styles:ds},(0,lt.u)("div",{styles:us},(0,lt.u)("div",{class:rs,bind:o,afterCreate:Ct})),(0,lt.u)("div",{styles:us},(0,lt.u)("div",{class:ls,styles:b},p)))):null)}_renderUnivariateColorSizeRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=St(e);if(!i)return null;const n=bt(i),l=Lt(i,"full",!1),a=_t(r,{width:12,height:l,rampAlignment:"vertical",opacity:t,type:"full",effectList:s}),o=i.infos.length-1,c=i.infos.map(((e,t)=>0===t||t===o?(0,lt.u)("div",{key:t,class:e.label?r?os:as:null},e.label):null)),d={display:"table-cell",verticalAlign:"middle"},u={marginTop:`${n}px`},h={height:`${l}px`};return(0,lt.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:cs},(0,lt.u)("div",{class:Qt},i.infos.map((e=>(0,lt.u)("div",{class:this.classes(Kt,ns)},(0,lt.u)("div",{class:is,styles:d,bind:e.preview,afterCreate:Ct}))))),(0,lt.u)("div",{styles:u,key:"color-ramp-preview"},(0,lt.u)("div",{styles:ds},(0,lt.u)("div",{styles:us},(0,lt.u)("div",{class:rs,bind:a,afterCreate:Ct})),(0,lt.u)("div",{styles:us},(0,lt.u)("div",{class:ls,styles:h},c)))))}_renderLegendForRamp(e,t){const s=e.infos,i="opacity-ramp"===e.type,r="heatmap-ramp"===e.type,n="stretch-ramp"===e.type,l=e.preview,a=i?"esri-legend__opacity-ramp":"";l.className=`esri-legend__color-ramp ${a}`,null!=t&&(l.style.opacity=t.toString());const o=s.map((e=>(0,lt.u)("div",{class:e.label?as:null},r?this.messages[e.label]||e.label:n?this._getStretchStopLabel(e):e.label))),c={height:l.style.height};return(0,lt.u)("div",{class:Kt},(0,lt.u)("div",{class:ss,styles:{width:"24px"}},(0,lt.u)("div",{class:rs,bind:l,afterCreate:Ct})),(0,lt.u)("div",{class:es},(0,lt.u)("div",{class:ls,styles:c},o)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:(0,ge.uf)(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(e,t,s,i,r){if(e.type)return this._renderLegendForElement(e,t,s,!0);let n=null;const l=xt(t,r);if(e.preview?n=(0,lt.u)("div",{class:is,bind:e.preview,afterCreate:Ct}):e.src&&(n=this._renderImage(e,t,l)),!n)return null;const a={[ts]:l},o={[ts]:l,[ns]:!l&&i};return(0,lt.u)("div",{class:Kt},(0,lt.u)("div",{class:this.classes(ss,o)},n),(0,lt.u)("div",{class:this.classes(es,a)},Et(this.messages,e.label,!1)||""))}_renderImage(e,t,s){const{label:i,src:r,opacity:n}=e,l={"esri-legend__imagery-layer-image--stretched":s,[is]:!s},a={opacity:`${null!=n?n:t.opacity}`};return(0,lt.u)("img",{alt:Et(this.messages,i,!1),src:r,border:0,width:e.width,height:e.height,class:this.classes(l),styles:a})}};(0,i._)([(0,d.Cb)()],hs.prototype,"activeLayerInfos",void 0),(0,i._)([(0,d.Cb)()],hs.prototype,"headingLevel",void 0),(0,i._)([(0,d.Cb)(),(0,Rt.H)("esri/widgets/Legend/t9n/Legend")],hs.prototype,"messages",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],hs.prototype,"type",void 0),hs=(0,i._)([(0,u.j)("esri.widgets.Legend.styles.Classic")],hs);const ys=hs;let ps=class extends h.Z{constructor(e,t){super(e,t),this._handles=new r.Z,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass="esri-icon-layer-list",this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new ys,this.view=null,this.viewModel=new rt}initialize(){this.own([(0,l.on)((()=>this.view),"resize",(()=>this.scheduleRender())),(0,l.on)((()=>this.activeLayerInfos),"change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),(0,l.YP)((()=>this.headingLevel),(e=>{const{style:t}=this;t&&(t.headingLevel=e)})),(0,l.YP)((()=>this.style),((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)}),l.nn)])}destroy(){this._handles=(0,n.SC)(this._handles)}castStyle(e){if(e instanceof Gt||e instanceof ys)return e;if("string"==typeof e)return"card"===e?new Gt:new ys;if(e&&"string"==typeof e.type){const t={...e};return delete t.type,new("card"===e.type?Gt:ys)(t)}return new ys}render(){return(0,lt.u)("div",{class:this.classes("esri-legend","esri-widget",this.style instanceof ys?"esri-widget--panel":null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=(0,l.YP)((()=>e.version),(()=>this.scheduleRender()));this._handles.add(t,`version_${e.layer.uid}`);const s=(0,l.on)((()=>e.children),"change",(()=>e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))),l.nn);this._handles.add(s,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};(0,i._)([(0,a.B)("viewModel.activeLayerInfos")],ps.prototype,"activeLayerInfos",void 0),(0,i._)([(0,a.B)("viewModel.basemapLegendVisible")],ps.prototype,"basemapLegendVisible",void 0),(0,i._)([(0,a.B)("viewModel.groundLegendVisible")],ps.prototype,"groundLegendVisible",void 0),(0,i._)([(0,d.Cb)()],ps.prototype,"headingLevel",void 0),(0,i._)([(0,a.B)("viewModel.hideLayersNotInCurrentView")],ps.prototype,"hideLayersNotInCurrentView",void 0),(0,i._)([(0,a.B)("viewModel.keepCacheOnDestroy")],ps.prototype,"keepCacheOnDestroy",void 0),(0,i._)([(0,a.B)("viewModel.respectLayerVisibility")],ps.prototype,"respectLayerVisibility",void 0),(0,i._)([(0,d.Cb)()],ps.prototype,"iconClass",void 0),(0,i._)([(0,d.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ps.prototype,"label",void 0),(0,i._)([(0,a.B)("viewModel.layerInfos")],ps.prototype,"layerInfos",void 0),(0,i._)([(0,d.Cb)(),(0,Rt.H)("esri/widgets/Legend/t9n/Legend")],ps.prototype,"messages",void 0),(0,i._)([(0,d.Cb)()],ps.prototype,"style",void 0),(0,i._)([(0,c.p)("style")],ps.prototype,"castStyle",null),(0,i._)([(0,a.B)("viewModel.view")],ps.prototype,"view",void 0),(0,i._)([(0,d.Cb)()],ps.prototype,"viewModel",void 0),ps=(0,i._)([(0,u.j)("esri.widgets.Legend")],ps);const fs=ps}}]);