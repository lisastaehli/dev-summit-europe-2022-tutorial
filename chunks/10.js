"use strict";(self.webpackChunkberlin_equal_street_names=self.webpackChunkberlin_equal_street_names||[]).push([[10],{18486:(e,t,i)=>{i.d(t,{Hq:()=>F,Mk:()=>m,P_:()=>W,Qp:()=>z,VO:()=>R,_D:()=>v,kZ:()=>V,kr:()=>q,nF:()=>S,tB:()=>N,ut:()=>O,zD:()=>w}),i(91957);var n,r,s=i(70375),a=i(61681),l=i(17321),o=i(96926),c=i(90472),u=i(91772),p=i(53446),h=i(89542),f=i(14685);function m(e,t,i){return!(0,c.Up)(e,t,i)}function d(e,t,i){const n=m(e,t,i);if(n&&!(0,c.kR)())throw new s.Z("rasterprojectionhelper-project","projection engine is not loaded");return n}(r=n||(n={}))[r.None=0]="None",r[r.North=1]="North",r[r.South=2]="South",r[r.Both=3]="Both";const g=(e,t,i,n=0)=>{if(1===i[0])return[0,0];let r=1,s=-1,a=1,l=-1;for(let t=0;t<e.length;t+=2)isNaN(e[t])||(r=r>e[t]?e[t]:r,s=s>e[t]?s:e[t],a=a>e[t+1]?e[t+1]:a,l=l>e[t+1]?l:e[t+1]);const{cols:o,rows:c}=t,u=(s-r)/o/i[0],p=(l-a)/c/i[1],h=2*n;let f=0,m=!1,d=[0,0];for(let t=0;t<o-3;t++){for(let i=0;i<c-3;i++){const n=t*c*2+2*i,r=(e[n]+e[n+4]+e[n+4*c]+e[n+4*c+4])/4,s=(e[n+1]+e[n+5]+e[n+4*c+1]+e[n+4*c+5])/4,a=Math.abs((r-e[n+2*c+2])/u),l=Math.abs((s-e[n+2*c+3])/p);if(a+l>f&&(f=a+l,d=[a,l]),h&&f>h){m=!0;break}}if(m)break}return d},y={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},x=new Map,b=new Map;async function w(){if((0,c.kR)())return null;await(0,c.zD)()}function v(e,t,i){return d(e.spatialReference,t)?i?(0,c.rS)(t,e.spatialReference,e):(0,c.rS)(e.spatialReference,t,e):null}function R(e,t,i,n=null){const r=e.spatialReference;if(r.equals(t))return e;d(r,t,n);const s=i.center,o=new u.Z({xmin:s.x-e.x/2,xmax:s.x+e.x/2,ymin:s.y-e.y/2,ymax:s.y+e.y/2,spatialReference:r}),p=(0,c.iV)(o,t,n),h=O(t);let f;if((0,a.Wi)(p)||(0,a.pC)(h)&&p.width>=h){const i=(0,l.c9)(r)/(0,l.c9)(t);f={x:e.x*i,y:e.y*i}}else f={x:p.width,y:p.height};return f}function _(e,t=.01){return(0,l.c9)(e)?t/(0,l.c9)(e):0}function S(e,t,i=null,n=!0){const r=e.spatialReference;if(r.equals(t))return e;d(r,t,i);const s=(0,c.iV)(e,t,i);if(!n||!s)return s;const l=L(r,!0),o=L(t,!0),u=_(r);return u&&(0,a.pC)(l)&&(0,a.pC)(o)&&(s.x>0&&Math.abs(e.x-l[0])<u?s.x-=o[1]-o[0]:s.x<0&&Math.abs(e.x-l[1])<u&&(s.x+=o[1]-o[0])),s}function C(e){const{inSR:t,outSR:i,datumTransformation:n,preferPE:r}=e;if(t.equals(i)){const{points:t}=I(e,null);return t}if(t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator)return function(e){const{cols:t,rows:i,xres:n,yres:r,usePixelCenter:s,inSR:a,outSR:l}=e;let{xmin:o,ymax:u}=e;s&&(o+=n/2,u-=r/2);const h=[],f=[],m=Math.max(t,i);for(let e=0;e<m;e++){const s=o+n*Math.min(t,e),m=u-r*Math.min(i,e),d=(0,c.iV)(new p.Z({x:s,y:m,spatialReference:a}),l);e<=t&&h.push(d.x),e<=i&&f.push(d.y)}const d=[];for(let e=0;e<t;e++)for(let t=0;t<i;t++)d.push([h[e],f[t]]);return d}(e);if(d(t,i,n)&&r){if(t.isGeographic)return M(e);const i=T(t);if((0,a.pC)(i))return M(e)}return function(e){const{points:t}=I(e,null),i=t.map((t=>new p.Z(t[0],t[1],e.inSR)));return(0,c.iV)(i,e.outSR,e.datumTransformation).map((e=>e?[e.x,e.y]:[NaN,NaN]))}(e)}function M(e){const{inSR:t,outSR:i,datumTransformation:n}=e,r=T(t),{points:s,mask:l}=I(e,r);if(!t.isGeographic){const e=t.wkid?o.e.coordsys(t.wkid):o.e.fromString(t.isGeographic?o.f.PE_TYPE_GEOGCS:o.f.PE_TYPE_PROJCS,t.wkt);o.g.projToGeog(e,s.length,s)}if((0,a.pC)(n)&&n.steps.length&&n.steps.forEach((e=>{const t=e.wkid?o.e.geogtran(e.wkid):o.e.fromString(o.f.PE_TYPE_GEOGTRAN,e.wkt);o.h.geogToGeog(t,s.length,s,null,e.isInverse?o.f.PE_TRANSFORM_2_TO_1:o.f.PE_TRANSFORM_1_TO_2)})),!i.isGeographic){const e=T(i,!0),t=(0,a.pC)(e)&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];!function(e,t){const[i,n]=t;for(let t=0;t<e.length;t++){const r=e[t][1];(r<i||r>n)&&(e[t]=[NaN,NaN])}}(s,t);const n=i.wkid?o.e.coordsys(i.wkid):o.e.fromString(i.isGeographic?o.f.PE_TYPE_GEOGCS:o.f.PE_TYPE_PROJCS,i.wkt);o.g.geogToProj(n,s.length,s)}let c=s;if(l&&s.length!==l.length){c=[];for(let e=0,t=0;e<l.length;e++)l[e]?c.push(s[t++]):c.push([NaN,NaN])}return c}function T(e,t=!1){let i=e.wkid||e.wkt;if(!i||e.isGeographic)return null;if(i=String(i),x.has(i)){const e=x.get(i);return t?e?.gcs:e?.pcs}const n=e.wkid?o.e.coordsys(e.wkid):o.e.fromString(e.isGeographic?o.f.PE_TYPE_GEOGCS:o.f.PE_TYPE_PROJCS,e.wkt),r=E(n,_(e,1e-4)),s=E(n,0,!0);return x.set(i,{pcs:r,gcs:s}),t?s:r}function E(e,t=0,i=!1){const n=o.j.generate(e),r=i?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!r?.length)return null;let s=!1,a=r.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!a){if(a=r.find((e=>1===e.getInclusive()&&0===e.getKind())),!a)return null;s=!0}const l=i?0:(2===n.getNorthPoleLocation()?1:0)|(2===n.getSouthPoleLocation()?2:0),c=n.isPannableRectangle(),u=a.getCoord();if(s)return{isEnvelope:s,isPannable:c,vertices:u,coef:null,bbox:[u[0][0]-t,u[0][1]-t,u[1][0]+t,u[1][1]+t],poleLocation:l};let p=0;const h=[];let[f,m]=u[0],[d,g]=u[0];for(let e=0,t=u.length;e<t;e++){p++,p===t&&(p=0);const[i,n]=u[e],[r,s]=u[p];if(s===n)h.push([i,r,n,s,2]);else{const e=(r-i)/(s-n||1e-4),t=i-e*n;n<s?h.push([e,t,n,s,0]):h.push([e,t,s,n,1])}f=f<i?f:i,m=m<n?m:n,d=d>i?d:i,g=g>n?g:n}return{isEnvelope:!1,isPannable:c,vertices:u,coef:h,bbox:[f,m,d,g],poleLocation:l}}function I(e,t){const i=[],{cols:n,rows:r,xres:s,yres:l,usePixelCenter:o}=e;let{xmin:c,ymax:u}=e;if(o&&(c+=s/2,u-=l/2),(0,a.Wi)(t)){for(let e=0;e<n;e++)for(let t=0;t<r;t++)i.push([c+s*e,u-l*t]);return{points:i}}const p=new Uint8Array(n*r);if(t.isEnvelope){const{bbox:[e,a,o,h]}=t;for(let f=0,m=0;f<n;f++){const n=c+s*f,d=t.isPannable||n>=e&&n<=o;for(let e=0;e<r;e++,m++){const t=u-l*e;d&&t>=a&&t<=h&&(i.push([n,t]),p[m]=1)}}return{points:i,mask:p}}const{coef:h}=t,f=[];for(let e=0;e<r;e++){const t=u-l*e,i=[],n=[];for(let e=0;e<h.length;e++){const[r,s,a,l,o]=h[e];if(t===a&&a===l)i.push(r),i.push(s),n.push(2),n.push(2);else if(t>=a&&t<=l){const e=r*t+s;i.push(e),n.push(o)}}let r=i;if(i.length>2){let e=2===n[0]?0:n[0],t=i[0];r=[];for(let s=1;s<n.length;s++)2===n[s]&&s!==n.length-1||(n[s]!==e&&(r.push(0===e?Math.min(t,i[s-1]):Math.max(t,i[s-1])),e=n[s],t=i[s]),s===n.length-1&&r.push(0===n[s]?Math.min(t,i[s]):Math.max(t,i[s])));r.sort(((e,t)=>e-t))}else i[0]>i[1]&&(r=[i[1],i[0]]);f.push(r)}for(let e=0,t=0;e<n;e++){const n=c+s*e;for(let e=0;e<r;e++,t++){const r=u-l*e,s=f[e];if(2===s.length)n>=s[0]&&n<=s[1]&&(i.push([n,r]),p[t]=1);else if(s.length>2){let e=!1;for(let t=0;t<s.length;t+=2)if(n>=s[t]&&n<=s[t+1]){e=!0;break}e&&(i.push([n,r]),p[t]=1)}}}return{points:i,mask:p}}function P(e){const t=O(e[0].spatialReference);if(e.length<2||(0,a.Wi)(t))return e[0];let{xmin:i,xmax:n,ymin:r,ymax:s}=e[0];for(let i=1;i<e.length;i++){const a=e[i];n=a.xmax+t*i,r=Math.min(r,a.ymin),s=Math.max(s,a.ymax)}return new u.Z({xmin:i,xmax:n,ymin:r,ymax:s,spatialReference:e[0].spatialReference})}function N(e,t,i=null,r=!0){const s=e.spatialReference;if(s.equals(t))return e;const l=F(e),o=O(s,!0),p=O(t);if(0===l||(0,a.Wi)(o)||(0,a.Wi)(p)){const l=k(e,t,i,r);if((0,a.Wi)(o)&&(0,a.pC)(p)&&Math.abs(l.width-p)<_(t)&&(0,c.kR)()){const i=T(s);if((0,a.pC)(i)&&i.poleLocation===n.None&&e.width<(i.bbox[2]-i.bbox[0])/2)return function(e,t){const i=O(t);if((0,a.Wi)(i))return null;let{xmin:n,ymin:r,xmax:s,ymax:l}=e;const o=e.spatialReference,p=new h.Z({spatialReference:o,rings:[[[n,r],[s,r],[s,l],[n,l],[n,r]]]}),f=(0,c.iV)(p,t);if(2!==f.rings.length||!f.rings[0].length||!f.rings[1].length)return null;const{rings:m}=f,d=_(o),g=new u.Z({spatialReference:t});for(let e=0;e<2;e++){n=s=m[e][0][0],r=l=m[e][0][1];for(let t=0;t<m[e].length;t++)n=n>m[e][t][0]?m[e][t][0]:n,s=s<m[e][t][0]?m[e][t][0]:s,r=r>m[e][t][1]?m[e][t][1]:r,l=l<m[e][t][1]?m[e][t][1]:l;if(0===e)g.ymin=r,g.ymax=l,g.xmin=n,g.xmax=s;else if(g.ymin=Math.min(g.ymin,r),g.ymax=Math.max(g.ymax,l),Math.abs(s-i/2)<d)g.xmin=n,g.xmax=g.xmax+i;else{if(!(Math.abs(n+i/2)<d))return null;g.xmax=s+i}}return g}(e,t)||l}return l}const f=e.clone().normalize();if(1===f.length&&e.xmax<o&&e.xmax-o/2>_(s)){const{xmin:t,xmax:i}=e;for(let n=0;n<=l;n++){const r=0===n?t:-o/2,a=n===l?i-o*n:o/2;f[n]=new u.Z({xmin:r,xmax:a,ymin:e.ymin,ymax:e.ymax,spatialReference:s})}}return P(f.map((e=>k(e,t,i,r))).filter((e=>!!e)))}function k(e,t,i=null,n=!0,r=!0){const s=e.spatialReference;if(s.equals(t))return e;d(s,t,i);const l=(0,c.iV)(e,t,i);if(r&&t.isWebMercator&&l&&(l.ymax=Math.min(20037508.342787,l.ymax),l.ymin=Math.max(-20037508.342787,l.ymin),l.ymin>=l.ymax))return null;if(!n||!l)return l;const o=L(s,!0),u=L(t,!0);if((0,a.Wi)(o)||(0,a.Wi)(u))return l;const h=_(s,.001),f=_(s,500),m=_(t,.001);if(Math.abs(l.xmin-u[0])<m&&Math.abs(l.xmax-u[1])<m){const n=Math.abs(e.xmin-o[0]),r=Math.abs(o[1]-e.xmax);if(n<h&&r>f){l.xmin=u[0];const n=[];n.push(new p.Z(e.xmax,e.ymin,s)),n.push(new p.Z(e.xmax,(e.ymin+e.ymax)/2,s)),n.push(new p.Z(e.xmax,e.ymax,s));const r=n.map((e=>S(e,t,i))).filter((e=>!isNaN(e?.x))).map((e=>e.x));l.xmax=Math.max.apply(null,r)}if(r<h&&n>f){l.xmax=u[1];const n=[];n.push(new p.Z(e.xmin,e.ymin,s)),n.push(new p.Z(e.xmin,(e.ymin+e.ymax)/2,s)),n.push(new p.Z(e.xmin,e.ymax,s));const r=n.map((e=>S(e,t,i))).filter((e=>!isNaN(e?.x))).map((e=>e.x));l.xmin=Math.min.apply(null,r)}}else{const e=_(t,.001);Math.abs(l.xmin-u[0])<e&&(l.xmin=u[0]),Math.abs(l.xmax-u[1])<e&&(l.xmax=u[1])}return l}function O(e,t=!1){const i=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*i:e.wkid&&e.isGeographic?360:2*y[e.wkid]||null}function L(e,t=!1){if(e.isGeographic)return[-180,180];const i=O(e,t);return(0,a.pC)(i)?[-i/2,i/2]:null}function G(e,t,i,n){let r=(e-t)/i;return r-Math.floor(r)!=0?r=Math.floor(r):n&&(r-=1),r}function F(e,t=!1){const i=O(e.spatialReference);if((0,a.Wi)(i))return 0;const n=t?0:-i/2,r=_(e.spatialReference),s=!t&&Math.abs(e.xmax-i/2)<r?i/2:e.xmax,l=!t&&Math.abs(e.xmin+i/2)<r?-i/2:e.xmin;return G(s,n,i,!0)-G(l,n,i,!1)}function W(e){const t=e.storageInfo.origin.x,i=O(e.spatialReference,!0);if((0,a.Wi)(i))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const n=i/2,{nativePixelSize:r,storageInfo:s,extent:l}=e,{maximumPyramidLevel:o,blockWidth:c,pyramidScalingFactor:u}=s;let p=r.x;const h=[],f=(0,a.pC)(e.transform)&&"gcs-shift"===e.transform.type,m=t+(f?0:n),d=f?i-t:n-t;for(let e=0;e<=o;e++){const e=(l.xmax-t)/p/c,i=e-Math.floor(e)==0?e:Math.ceil(e),n=d/p/c,r=n-Math.floor(n)==0?n:Math.ceil(n),s=Math.floor(m/p/c),a=Math.round(m/p)%c,o=(c-Math.round(d/p)%c)%c;h.push({resolutionX:p,blockWidth:c,datsetColumnCount:i,worldColumnCountFromOrigin:r,leftMargin:a,rightPadding:o,originColumnOffset:s}),p*=u}return{originX:t,halfWorldWidth:n,pyramidsInfo:h,hasGCSSShiftTransform:f}}function z(e){const t=e.isAdaptive&&null==e.spacing;let i=e.spacing||[32,32],n=Z(e),r={cols:n.size[0]+1,rows:n.size[1]+1};const s=n.outofBoundPointCount>0&&n.outofBoundPointCount<n.offsets.length/2;let l=n.outofBoundPointCount===n.offsets.length/2||t&&s?[0,0]:g(n.offsets,r,i,4);const c=(l[0]+l[1])/2,u=e.projectedExtent.spatialReference,p=e.srcBufferExtent.spatialReference;if(t&&(s||c>4)&&(m(u,p,e.datumTransformation)&&(u.isGeographic||(0,a.pC)(T(u))),i=[4,4],n=Z({...e,spacing:i}),r={cols:n.size[0]+1,rows:n.size[1]+1},l=g(n.offsets,r,i,4)),n.error=l,i[0]>1&&(n.coefficients=j(n.offsets,r,s)),e.includeGCSGrid&&!u.isGeographic&&!u.isWebMercator)if(p.isGeographic)n.gcsGrid={offsets:n.offsets,coefficients:n.coefficients,spacing:i};else{const t=T(u);if((0,a.pC)(t)&&!t.isEnvelope){const t=function(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt);let i;return b.has(t)?i=b.get(t):(i=(e.wkid?o.e.coordsys(e.wkid):o.e.fromString(o.f.PE_TYPE_PROJCS,e.wkt)).getGeogcs().getCode(),b.set(t,i)),new f.Z({wkid:i})}(u),a=N(e.projectedExtent,t),{offsets:l}=Z({...e,srcBufferExtent:a,spacing:i}),c=j(l,r,s);n.gcsGrid={offsets:l,coefficients:c,spacing:i}}}return n}function Z(e){const{projectedExtent:t,srcBufferExtent:i,pixelSize:n,datumTransformation:r,rasterTransform:s}=e,l=t.spatialReference,o=i.spatialReference,c=d(l,o),{xmin:u,ymin:h,xmax:f,ymax:m}=t,g=O(o),y=(0,a.pC)(g)&&(e.hasWrapAround||"gcs-shift"===s?.type),x=e.spacing||[32,32],b=x[0]*n.x,w=x[1]*n.y,v=1===x[0],R=Math.ceil((f-u)/b-.1/x[0])+(v?0:1),S=Math.ceil((m-h)/w-.1/x[1])+(v?0:1),M=C({cols:R,rows:S,xmin:u,ymax:m,xres:b,yres:w,inSR:l,outSR:o,datumTransformation:r,preferPE:x[0]<=4,usePixelCenter:v}),E=[];let I,P=0;const N=v?-1:NaN,{xmin:k,xmax:L,ymax:G,width:F,height:W}=i,z=_(o,500),Z=(0,a.pC)(g)&&k>0&&L>g/2;let j=!1;if(c){const e=T(l);j=(0,a.pC)(e)&&e.poleLocation>0}for(let e=0;e<R;e++){const t=[];for(let i=0;i<S;i++){let n=M[e*S+i];if(y&&n[0]>L&&n[0]>g/2-z?n[0]-=g:y&&0===e&&n[0]<0&&Z&&!s&&(n[0]+=g),!n||isNaN(n[0])||isNaN(n[1]))E.push(N),E.push(N),t.push(null),P++;else{if(s){const e=s.inverseTransform(new p.Z({x:n[0],y:n[1],spatialReference:o}));n=[e.x,e.y]}t.push(n),e>0&&y&&I[i]&&n[0]<I[i][0]&&(n[0]+=g,j&&n[0]>L&&n[0]>g&&(n[0]-=g)),E.push((n[0]-k)/F),E.push((G-n[1])/W)}}I=t}return{offsets:E,error:null,coefficients:null,outofBoundPointCount:P,spacing:x,size:v?[R,S]:[R-1,S-1]}}function j(e,t,i){const{cols:n,rows:r}=t,s=new Float32Array((n-1)*(r-1)*2*6),a=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),l=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let t=0;t<n-1;t++){for(let i=0;i<r-1;i++){let o=t*r*2+2*i;const c=e[o],u=e[o+1],p=e[o+2],h=e[o+3];o+=2*r;const f=e[o],m=e[o+1],d=e[o+2],g=e[o+3];let y=0,x=12*(i*(n-1)+t);for(let e=0;e<3;e++)s[x++]=a[y++]*c+a[y++]*p+a[y++]*d;y=0;for(let e=0;e<3;e++)s[x++]=a[y++]*u+a[y++]*h+a[y++]*g;y=0;for(let e=0;e<3;e++)s[x++]=l[y++]*c+l[y++]*f+l[y++]*d;y=0;for(let e=0;e<3;e++)s[x++]=l[y++]*u+l[y++]*m+l[y++]*g}if(i)for(let e=0;e<s.length;e++)isNaN(s[e])&&(s[e]=-1)}return s}function V(e){const t=e.clone().normalize();return 1===t.length?t[0]:P(t)}function q(e,t,i){const{storageInfo:n,pixelSize:r}=t;let s,o=!1;const{pyramidResolutions:c}=n;if((0,a.pC)(c)&&c.length){const n=(e.x+e.y)/2,a=c[c.length-1],u=(a.x+a.y)/2,h=(r.x+r.y)/2;if(n<=h)s=0;else if(n>=u)s=c.length,o=n/u>8;else{let e,t=h;for(let r=1;r<=c.length;r++){if(e=(c[r-1].x+c[r-1].y)/2,n<=e){n===e?s=r:"down"===i?(s=r-1,o=n/t>8):s="up"===i||n-t>e-n||n/t>2?r:r-1;break}t=e}}const f=0===s?r:c[s-1];return o&&Math.min(f.x,f.y)*(0,l.c9)(t.spatialReference)>19567&&(o=!1),{pyramidLevel:s,pyramidResolution:new p.Z({x:f.x,y:f.y,spatialReference:t.spatialReference}),excessiveReading:o}}const u=Math.log(e.x/r.x)/Math.LN2,h=Math.log(e.y/r.y)/Math.LN2,f=t.storageInfo.maximumPyramidLevel||0;s="down"===i?Math.floor(Math.min(u,h)):"up"===i?Math.ceil(Math.max(u,h)):Math.round((u+h)/2),s<0?s=0:s>f&&(o=s>f+3,s=f);const m=2**s;return{pyramidLevel:s,pyramidResolution:new p.Z({x:m*t.nativePixelSize.x,y:m*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}},10:(e,t,i)=>{i.r(t),i.d(t,{default:()=>R});var n=i(36663),r=i(70375),s=i(61681),a=i(76868),l=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),c=i(19654),u=i(8712),p=i(52003),h=i(80085),f=i(51599),m=i(18486),d=i(59439);const g=e=>{let t=class extends e{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return this.projectFullExtent(this.view.spatialReference)}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}get datumTransformation(){return(0,m._D)((0,s.Wg)(this.layer.fullExtent),this.view.spatialReference,!0)}supportsSpatialReference(e){return!!this.projectFullExtent(e)}projectFullExtent(e){const t=(0,s.Wg)(this.layer.fullExtent),i=(0,m._D)(t,e,!1);return(0,m.tB)(t,e,i)}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)throw new r.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:n}=i,a=(0,d.V)(i,t);if(!n||(0,s.Wi)(a))throw new r.Z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:n,popupTemplate:a});const l=[],{value:o,magdirValue:c}=await i.identify(e,{timeExtent:this.timeExtent});let u="";if(o&&o.length){u="imagery-tile"===i.type&&i.hasStandardTime()&&null!=o[0]?o.map((e=>i.getStandardTimeValue(e))).join(", "):o.join(", ");const e={ObjectId:0},t="Raster.ServicePixelValue";e[t]=this._formatAttributeValue(u,t);const n=i.rasterInfo?.attributeTable?.features;if(n&&n.length>0){const t=n.filter((e=>{const t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===u}));if(t.length>0){const i=t[0];if(i)for(const t in i.attributes)if(i.attributes.hasOwnProperty(t)){const n=this._rasterFieldPrefix+t;e[n]=this._formatAttributeValue(i.attributes[t],n)}}}const r=i.rasterInfo.dataType;"vector-magdir"!==r&&"vector-uv"!==r||(e["Raster.Magnitude"]=c?.[0],e["Raster.Direction"]=c?.[1]);const s=new h.Z(this.fullExtent.clone(),null,e);s.layer=i,s.sourceLayer=s.layer,l.push(s)}return l}_formatAttributeValue(e,t){if("string"==typeof e){const i=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,n=this._getFieldInfo(i,t),r=n&&n.format;if(r){let t,i;return e.trim().includes(",")?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,r)):e.trim().includes(" ")?(t=i=" ",this._formatDelimitedString(e,t,i,r)):this._formatNumberFromString(e,r)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let n;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i&&e.fieldName.toLowerCase()!==i.replace(/ /g,"_")||(n=e,0)))),n}_formatDelimitedString(e,t,i,n){return e&&t&&i&&n?e.trim().split(t).map((e=>this._formatNumberFromString(e,n))).join(i):e}_formatNumberFromString(e,t){if(!e||!t)return e;const i=Number(e);return isNaN(i)?e:t.format(i)}};return(0,n._)([(0,l.Cb)()],t.prototype,"layer",void 0),(0,n._)([(0,l.Cb)(f.qG)],t.prototype,"timeExtent",void 0),(0,n._)([(0,l.Cb)()],t.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],t.prototype,"fullExtent",null),(0,n._)([(0,l.Cb)()],t.prototype,"tileInfo",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=(0,n._)([(0,o.j)("esri.views.layers.ImageryTileLayerView")],t),t};var y=i(26216),x=i(55068),b=i(99621),w=i(35119);let v=class extends(g((0,x.Z)((0,u.r)((0,c.A)(y.Z))))){constructor(){super(...arguments),this.type="imagery-tile-3d",this.isAlignedMapTile=!0}initialize(){this.layer.increaseRasterJobHandlerUsage(),null==this.fullExtent&&this.addResolvingPromise(Promise.reject(new r.Z("layerview:spatial-reference-incompatible","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})));const e=(0,a.N1)((()=>this.view?.basemapTerrain?.tilingSchemeLocked)).then((()=>{const e=this.view.basemapTerrain.tilingScheme,{tileInfo:t}=this.layer,i=["png","png24","png32","jpg","mixed"].includes(t.format)&&e.compatibleWith(t);this.isAlignedMapTile=i;const n=i?t:e.toTileInfo();this.tileInfo=n,this.updatingHandles.add((()=>[this.layer.renderer,this.layer.interpolation,this.layer.bandIds,this.layer.multidimensionalDefinition]),(()=>this.refresh()))}));this.addResolvingPromise(e)}destroy(){this.layer.decreaseRasterJobHandlerUsage(),this.view=null}get _blankTile(){const e=document.createElement("canvas"),t=e.getContext("2d"),[i,n]=this.tileInfo.size;return e.width=i,e.height=n,t.clearRect(0,0,i,n),t.getImageData(0,0,i,n)}get imageFormatIsOpaque(){return"jpg"===this.layer.tileInfo.format}get hasMixedImageFormats(){return"mixed"===this.layer.tileInfo.format}get dataLevelRange(){const e=this.tileInfo.lods,t=this.layer.tileInfo.lods,i=e[0].scale,n=t[t.length-1].scale;return this.levelRangeFromScaleRange(i,n)}_getfullExtent(){return this.projectFullExtent(this.view.basemapTerrain&&null!==this.view.basemapTerrain.spatialReference?this.view.basemapTerrain.spatialReference:this.view.spatialReference)}async fetchTile(e,t,i,n){const r=this.tileInfo,a=this._canSymbolizeInWebGL(),l={tileInfo:r,requestRawData:a,signal:(0,s.Wg)(n.signal),requestAsImageElement:this.isAlignedMapTile},o=await this.layer.fetchTile(e,t,i,l);if(o instanceof HTMLImageElement)return o;let c=o&&o.pixelBlock;if((0,s.Wi)(c))return this._blankTile;if(!a&&(c=await this.layer.applyRenderer(o),(0,s.Wi)(c)))return this._blankTile;const u=new p.H([e,t,i],c,r.size[0],r.size[1]);return a?(u.symbolizerRenderer=this.layer.symbolizer.rendererJSON,u.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e)),u.transformGrid=o.transformGrid):u.isRendereredSource=!0,u.interpolation=this.layer.interpolation,u.bandIds=this.layer.bandIds,u}_getSymbolizerOptions(e){const t=this.tileInfo.lodAt(e).resolution;return{pixelBlock:null,isGCS:this.view.basemapTerrain?this.view.basemapTerrain.spatialReference.isGeographic:this.view.spatialReference.isGeographic,resolution:{x:t,y:t},bandIds:this.layer.bandIds}}ensureSymbolizerParameters(e){this._canSymbolizeInWebGL()&&JSON.stringify(e.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(e.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e.lij[0])))}createFetchPopupFeaturesQueryGeometry(e,t){return(0,b.K)(e,t,this.view)}refresh(){this.emit("data-changed")}async doRefresh(){this.suspended||this.emit("data-changed")}_canSymbolizeInWebGL(){return(0,w.hc)("3d").supportsTextureFloat&&this.layer.symbolizer.canRenderInWebGL}};(0,n._)([(0,l.Cb)({readOnly:!0})],v.prototype,"_blankTile",null),(0,n._)([(0,l.Cb)({readOnly:!0})],v.prototype,"imageFormatIsOpaque",null),(0,n._)([(0,l.Cb)({readOnly:!0})],v.prototype,"hasMixedImageFormats",null),(0,n._)([(0,l.Cb)({readOnly:!0})],v.prototype,"dataLevelRange",null),v=(0,n._)([(0,o.j)("esri.views.3d.layers.ImageryTileLayerView3D")],v);const R=v},19654:(e,t,i)=>{i.d(t,{A:()=>u});var n=i(36663),r=i(23148),s=i(78668),a=i(76868),l=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),c=i(64862);const u=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),(0,c.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.handles.add((0,r.kB)((()=>e.abort()))),await(0,a.N1)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,s.k_)(t);const i=(0,c.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!e||!e.minScale||!e.maxScale||e.minScale>=e.maxScale)}getSuspendInfo(){const e=super.getSuspendInfo(),t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return t&&t.minScale&&t.maxScale&&t.minScale<t.maxScale&&(e.outsideScaleRange=!0),e}};return(0,n._)([(0,l.Cb)()],t.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,n._)([(0,o.j)("esri.views.3d.layers.LayerView3D")],t),t}},8712:(e,t,i)=>{i.d(t,{r:()=>p});var n=i(36663),r=i(70375),s=i(61681),a=i(76868),l=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),c=i(57686),u=i(13809);const p=e=>{let t=class extends e{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataLevelRange(){const e=this.tileInfo.lods,t=e[0].scale,i=e[e.length-1].scale;return this.levelRangeFromScaleRange(t,i)}get displayLevelRange(){const e=this.tileInfo.lods,t=this.layer.minScale||e[0].scale,i=this.layer.maxScale||e[e.length-1].scale,n=this.levelRangeFromScaleRange(t,i);return this.layer.maxScale&&n.maxLevel++,n}getTileUrl(e,t,i){return this.layer.getTileUrl(e,t,i)}_addTilingSchemeMatchPromise(){if((0,s.Wi)(this.fullExtent))return this.addResolvingPromise(Promise.reject(new r.Z("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if((0,s.pC)(e))return this.addResolvingPromise(Promise.reject(e));const t=(0,a.N1)((()=>this.view?.basemapTerrain?.tilingSchemeLocked)).then((()=>{const e=this.view.basemapTerrain.tilingScheme,t=this._getTileInfoCompatibilityError(this.tileInfo,e);if(t)throw t}));this.addResolvingPromise(t)}_getTileInfoSupportError(e,t){const i=(0,u.er)(e,t,this.view.spatialReference,this.view.state.viewingMode);if(i){const e={layer:this.layer,error:i};let t;switch(i.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":t=new r.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",e);break;default:t=new r.Z("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",e)}return t}return null}_getTileInfoCompatibilityError(e,t){return t.compatibleWith(e)?null:new r.Z("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,t){const i={minLevel:0,maxLevel:1/0},n=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!n)return i;const r=n.levels[0],s=e=>{const t=Math.log(r.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(i.minLevel=Math.max(0,s(e))),null!=t&&t>0&&(i.maxLevel=Math.max(0,s(t))),i}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return(0,n._)([(0,l.Cb)({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),(0,n._)([(0,l.Cb)({readOnly:!0})],t.prototype,"updating",void 0),(0,n._)([(0,l.Cb)(c.q)],t.prototype,"updatingProgress",void 0),(0,n._)([(0,l.Cb)(c.V)],t.prototype,"updatingProgressValue",void 0),(0,n._)([(0,l.Cb)()],t.prototype,"fullExtent",null),(0,n._)([(0,l.Cb)({readOnly:!0})],t.prototype,"isOpaque",null),(0,n._)([(0,l.Cb)({readOnly:!0})],t.prototype,"dataLevelRange",null),(0,n._)([(0,l.Cb)({readOnly:!0})],t.prototype,"displayLevelRange",null),(0,n._)([(0,l.Cb)()],t.prototype,"layer",void 0),(0,n._)([(0,l.Cb)()],t.prototype,"tileInfo",void 0),t=(0,n._)([(0,o.j)("esri.views.3d.layers.TiledLayerView3D")],t),t}},26216:(e,t,i)=>{i.d(t,{Z:()=>m});var n=i(36663),r=i(53443),s=i(31355),a=i(53280),l=i(86618),o=i(13802),c=i(61681),u=i(64189),p=i(81977),h=(i(7753),i(39994),i(7283),i(40266));let f=class extends((0,a.p)((0,l.IG)((0,u.v)(s.Z.EventedMixin(r.Z))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";o.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e)}}))}get fullOpacity(){return(0,c.Pt)(this.get("layer.opacity"),1)*(0,c.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this.updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.layer?.visible}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,n._)([(0,p.Cb)()],f.prototype,"fullOpacity",null),(0,n._)([(0,p.Cb)()],f.prototype,"layer",void 0),(0,n._)([(0,p.Cb)()],f.prototype,"parent",void 0),(0,n._)([(0,p.Cb)({readOnly:!0})],f.prototype,"suspended",null),(0,n._)([(0,p.Cb)({readOnly:!0})],f.prototype,"suspendInfo",null),(0,n._)([(0,p.Cb)({readOnly:!0})],f.prototype,"legendEnabled",null),(0,n._)([(0,p.Cb)({type:Boolean,readOnly:!0})],f.prototype,"updating",null),(0,n._)([(0,p.Cb)({readOnly:!0})],f.prototype,"updatingProgress",null),(0,n._)([(0,p.Cb)()],f.prototype,"visible",null),(0,n._)([(0,p.Cb)()],f.prototype,"view",void 0),f=(0,n._)([(0,h.j)("esri.views.layers.LayerView")],f);const m=f},55068:(e,t,i)=>{i.d(t,{Z:()=>c});var n=i(36663),r=i(13802),s=i(78668),a=i(76868),l=i(81977),o=(i(7753),i(39994),i(7283),i(40266));const c=e=>{let t=class extends e{initialize(){this.handles.add((0,a.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,s.D_)(e)||r.Z.getLogger(this.declaredClass).error(e)}))})),"RefreshableLayerView")}};return(0,n._)([(0,l.Cb)()],t.prototype,"layer",void 0),t=(0,n._)([(0,o.j)("esri.layers.mixins.RefreshableLayerView")],t),t}},59439:(e,t,i)=>{i.d(t,{V:()=>a,e:()=>s});var n=i(61681),r=i(17095);async function s(e,t=e.popupTemplate){if((0,n.Wi)(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:s}=t,{objectIdField:a,typeIdField:l,globalIdField:o,relationships:c}=e;if(i.includes("*"))return["*"];const u=s?await(0,r.CH)(e):[],p=(0,r.Q0)(e.fieldsIndex,[...i,...u]);return l&&p.push(l),p&&a&&e.fieldsIndex.has(a)&&!p.includes(a)&&p.push(a),p&&o&&e.fieldsIndex.has(o)&&!p.includes(o)&&p.push(o),c&&c.forEach((t=>{const{keyField:i}=t;p&&i&&e.fieldsIndex.has(i)&&!p.includes(i)&&p.push(i)})),p}function a(e,t){return e.popupTemplate?e.popupTemplate:(0,n.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,n.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},99621:(e,t,i)=>{i.d(t,{K:()=>a}),i(91957);var n=i(61681),r=i(17321),s=i(91772);function a(e,t,i,a=new s.Z){let l;if("2d"===i.type)l=t*i.resolution;else if("3d"===i.type){const s=i.overlayPixelSizeInMapUnits(e),a=i.basemapSpatialReference;l=(0,n.pC)(a)&&!a.equals(i.spatialReference)?(0,r.c9)(a)/(0,r.c9)(i.spatialReference):t*s}const o=e.x-l,c=e.y-l,u=e.x+l,p=e.y+l,{spatialReference:h}=i;return a.xmin=Math.min(o,u),a.ymin=Math.min(c,p),a.xmax=Math.max(o,u),a.ymax=Math.max(c,p),a.spatialReference=h,a}new s.Z}}]);