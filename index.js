/*! For license information please see index.js.LICENSE.txt */
(()=>{var e,t,i={77210:(e,t,i)=>{"use strict";i.d(t,{Z5:()=>Pe,mv:()=>f,AA:()=>R,yM:()=>Q,xE:()=>oe,K3:()=>me,h:()=>M,GH:()=>fe,YY:()=>ge});let r,s,n,o=!1,a=!1,l=!1,c=!1,u=null,h=!1;const d="undefined"!=typeof window?window:{},p=d.document||{head:{}},f=d.HTMLElement||class{},m={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},g=(()=>{let e=!1;try{p.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch(e){}return e})(),y=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replace}catch(e){}return!1})(),_=(e,t,i,r)=>{i&&i.map((([i,r,s])=>{const n=b(e,i),o=v(t,s),a=w(i);m.ael(n,r,o,a),(t.$rmListeners$=t.$rmListeners$||[]).push((()=>m.rel(n,r,o,a)))}))},v=(e,t)=>i=>{try{e.$hostElement$[t](i)}catch(e){we(e)}},b=(e,t)=>4&t?p:8&t?d:16&t?p.body:e,w=e=>g?{passive:0!=(1&e),capture:0!=(2&e)}:0!=(2&e),x="http://www.w3.org/1999/xlink",C=new WeakMap,T=(e,t,i,r)=>{let s=S(t,i),n=xe.get(s);if(e=11===e.nodeType?e:p,n)if("string"==typeof n){e=e.head||e;let t,i=C.get(e);i||C.set(e,i=new Set),i.has(s)||(t=p.createElement("style"),t.innerHTML=n,e.insertBefore(t,e.querySelector("link")),i&&i.add(s))}else!e.adoptedStyleSheets.includes(n)&&(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},S=(e,t)=>"sc-"+(t&&32&e.$flags$?e.$tagName$+"-"+t:e.$tagName$),E={},A=e=>"object"==(e=typeof e)||"function"===e,M=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1,l=[];const c=t=>{for(let i=0;i<t.length;i++)r=t[i],Array.isArray(r)?c(r):null!=r&&"boolean"!=typeof r&&((o="function"!=typeof e&&!A(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?O(null,r):r),a=o)};if(c(i),t&&(t.key&&(s=t.key),t.name&&(n=t.name),true)){const e=t.className||t.class;e&&(t.class="object"!=typeof e?e:Object.keys(e).filter((t=>e[t])).join(" "))}if("function"==typeof e)return e(null===t?{}:t,l,I);const u=O(e,null);return u.$attrs$=t,l.length>0&&(u.$children$=l),u.$key$=s,u.$name$=n,u},O=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null};return i},R={},P=e=>e&&e.$tag$===R,I={forEach:(e,t)=>e.map(L).forEach(t),map:(e,t)=>e.map(L).map(t).map(D)},L=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),D=e=>{if("function"==typeof e.vtag){const t=Object.assign({},e.vattrs);return e.vkey&&(t.key=e.vkey),e.vname&&(t.name=e.vname),M(e.vtag,t,...e.vchildren||[])}const t=O(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},N=(e,t,i,r,s,n)=>{if(i!==r){let o=be(e,t),a=t.toLowerCase();if("class"===t){const t=e.classList,s=k(i),n=k(r);t.remove(...s.filter((e=>e&&!n.includes(e)))),t.add(...n.filter((e=>e&&!s.includes(e))))}else if("style"===t){for(const t in i)r&&null!=r[t]||(t.includes("-")?e.style.removeProperty(t):e.style[t]="");for(const t in r)i&&r[t]===i[t]||(t.includes("-")?e.style.setProperty(t,r[t]):e.style[t]=r[t])}else if("key"===t);else if("ref"===t)r&&r(e);else if(e.__lookupSetter__(t)||"o"!==t[0]||"n"!==t[1]){{const l=A(r);if((o||l&&null!==r)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let s=null==r?"":r;"list"===t?o=!1:null!=i&&e[t]==s||(e[t]=s)}}catch(e){}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),null==r||!1===r?!1===r&&""!==e.getAttribute(t)||(c?e.removeAttributeNS(x,t):e.removeAttribute(t)):(!o||4&n||s)&&!l&&(r=!0===r?"":r,c?e.setAttributeNS(x,t,r):e.setAttribute(t,r))}}else t="-"===t[2]?t.slice(3):be(d,a)?a.slice(2):a[2]+t.slice(3),i&&m.rel(e,t,i,!1),r&&m.ael(e,t,r,!1)}},F=/\s/,k=e=>e?e.split(F):[],U=(e,t,i,r)=>{const s=11===t.$elm$.nodeType&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||E,o=t.$attrs$||E;for(r in n)r in o||N(s,r,n[r],void 0,i,t.$flags$);for(r in o)N(s,r,n[r],o[r],i,t.$flags$)},V=(e,t,i,a)=>{let u,h,d,f=t.$children$[i],m=0;if(!o&&(l=!0,"slot"===f.$tag$&&(r&&a.classList.add(r+"-s"),f.$flags$|=f.$children$?2:1)),null!==f.$text$)u=f.$elm$=p.createTextNode(f.$text$);else if(1&f.$flags$)u=f.$elm$=p.createTextNode("");else{if(!c&&(c="svg"===f.$tag$),u=f.$elm$=p.createElementNS(c?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&f.$flags$?"slot-fb":f.$tag$),c&&"foreignObject"===f.$tag$&&(c=!1),U(null,f,c),null!=r&&u["s-si"]!==r&&u.classList.add(u["s-si"]=r),f.$children$)for(m=0;m<f.$children$.length;++m)h=V(e,f,m,u),h&&u.appendChild(h);"svg"===f.$tag$?c=!1:"foreignObject"===u.tagName&&(c=!0)}return u["s-hn"]=n,3&f.$flags$&&(u["s-sr"]=!0,u["s-cr"]=s,u["s-sn"]=f.$name$||"",d=e&&e.$children$&&e.$children$[i],d&&d.$tag$===f.$tag$&&e.$elm$&&z(e.$elm$,!1)),u},z=(e,t)=>{m.$flags$|=1;const i=e.childNodes;for(let e=i.length-1;e>=0;e--){const r=i[e];r["s-hn"]!==n&&r["s-ol"]&&(W(r).insertBefore(r,G(r)),r["s-ol"].remove(),r["s-ol"]=void 0,l=!0),t&&z(r,t)}m.$flags$&=-2},B=(e,t,i,r,s,o)=>{let a,l=e["s-cr"]&&e["s-cr"].parentNode||e;for(l.shadowRoot&&l.tagName===n&&(l=l.shadowRoot);s<=o;++s)r[s]&&(a=V(null,i,s,e),a&&(r[s].$elm$=a,l.insertBefore(a,G(t))))},H=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,J(r),a=!0,s["s-ol"]?s["s-ol"].remove():z(s,!0),s.remove())},j=(e,t)=>e.$tag$===t.$tag$&&("slot"===e.$tag$?e.$name$===t.$name$:e.$key$===t.$key$),G=e=>e&&e["s-ol"]||e,W=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,Z=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;null!==o?(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o):(c="svg"===n||"foreignObject"!==n&&c,"slot"===n||U(e,t,c),null!==r&&null!==s?((e,t,i,r)=>{let s,n,o=0,a=0,l=0,c=0,u=t.length-1,h=t[0],d=t[u],p=r.length-1,f=r[0],m=r[p];for(;o<=u&&a<=p;)if(null==h)h=t[++o];else if(null==d)d=t[--u];else if(null==f)f=r[++a];else if(null==m)m=r[--p];else if(j(h,f))Z(h,f),h=t[++o],f=r[++a];else if(j(d,m))Z(d,m),d=t[--u],m=r[--p];else if(j(h,m))"slot"!==h.$tag$&&"slot"!==m.$tag$||z(h.$elm$.parentNode,!1),Z(h,m),e.insertBefore(h.$elm$,d.$elm$.nextSibling),h=t[++o],m=r[--p];else if(j(d,f))"slot"!==h.$tag$&&"slot"!==m.$tag$||z(d.$elm$.parentNode,!1),Z(d,f),e.insertBefore(d.$elm$,h.$elm$),d=t[--u],f=r[++a];else{for(l=-1,c=o;c<=u;++c)if(t[c]&&null!==t[c].$key$&&t[c].$key$===f.$key$){l=c;break}l>=0?(n=t[l],n.$tag$!==f.$tag$?s=V(t&&t[a],i,l,e):(Z(n,f),t[l]=void 0,s=n.$elm$),f=r[++a]):(s=V(t&&t[a],i,a,e),f=r[++a]),s&&W(h.$elm$).insertBefore(s,G(h.$elm$))}o>u?B(e,null==r[p+1]?null:r[p+1].$elm$,i,r,a,p):a>p&&H(t,o,u)})(i,r,t,s):null!==s?(null!==e.$text$&&(i.textContent=""),B(i,null,t,s,0,s.length-1)):null!==r&&H(r,0,r.length-1),c&&"svg"===n&&(c=!1))},q=e=>{let t,i,r,s,n,o,a=e.childNodes;for(i=0,r=a.length;i<r;i++)if(t=a[i],1===t.nodeType){if(t["s-sr"])for(n=t["s-sn"],t.hidden=!1,s=0;s<r;s++)if(o=a[s].nodeType,a[s]["s-hn"]!==t["s-hn"]||""!==n){if(1===o&&n===a[s].getAttribute("slot")){t.hidden=!0;break}}else if(1===o||3===o&&""!==a[s].textContent.trim()){t.hidden=!0;break}q(t)}},$=[],Y=e=>{let t,i,r,s,n,o,l=0,c=e.childNodes,u=c.length;for(;l<u;l++){if(t=c[l],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],i["s-cn"]||i["s-nr"]||i["s-hn"]===t["s-hn"]||(X(i,s)?(n=$.find((e=>e.$nodeToRelocate$===i)),a=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:$.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&$.map((e=>{X(e.$nodeToRelocate$,i["s-sn"])&&(n=$.find((e=>e.$nodeToRelocate$===i)),n&&!e.$slotRefNode$&&(e.$slotRefNode$=n.$slotRefNode$))}))):$.some((e=>e.$nodeToRelocate$===i))||$.push({$nodeToRelocate$:i}));1===t.nodeType&&Y(t)}},X=(e,t)=>1===e.nodeType?null===e.getAttribute("slot")&&""===t||e.getAttribute("slot")===t:e["s-sn"]===t||""===t,J=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(J)},K=(e,t)=>{const i=e.$hostElement$,c=e.$cmpMeta$,u=e.$vnode$||O(null,null),h=P(t)?t:M(null,null,t);if(n=i.tagName,c.$attrsToReflect$&&(h.$attrs$=h.$attrs$||{},c.$attrsToReflect$.map((([e,t])=>h.$attrs$[t]=i[e]))),h.$tag$=null,h.$flags$|=4,e.$vnode$=h,h.$elm$=u.$elm$=i.shadowRoot||i,r=i["s-sc"],s=i["s-cr"],o=0!=(1&c.$flags$),a=!1,Z(u,h),m.$flags$|=1,l){let e,t,i,r,s,n;Y(h.$elm$);let o=0;for(;o<$.length;o++)e=$[o],t=e.$nodeToRelocate$,t["s-ol"]||(i=p.createTextNode(""),i["s-nr"]=t,t.parentNode.insertBefore(t["s-ol"]=i,t));for(o=0;o<$.length;o++)if(e=$[o],t=e.$nodeToRelocate$,e.$slotRefNode$){for(r=e.$slotRefNode$.parentNode,s=e.$slotRefNode$.nextSibling,i=t["s-ol"];i=i.previousSibling;)if(n=i["s-nr"],n&&n["s-sn"]===t["s-sn"]&&r===n.parentNode&&(n=n.nextSibling,!n||!n["s-nr"])){s=n;break}(!s&&r!==t.parentNode||t.nextSibling!==s)&&t!==s&&(!t["s-hn"]&&t["s-ol"]&&(t["s-hn"]=t["s-ol"].parentNode.nodeName),r.insertBefore(t,s))}else 1===t.nodeType&&(t.hidden=!0)}a&&q(h.$elm$),m.$flags$&=-2,$.length=0},Q=(e,t,i)=>{const r=e;return{emit:e=>ee(r,t,{bubbles:!!(4&i),composed:!!(2&i),cancelable:!!(1&i),detail:e})}},ee=(e,t,i)=>{const r=m.ce(t,i);return e.dispatchEvent(r),r},te=(e,t)=>{e.$flags$|=16,e.$ancestorComponent$;const i=()=>ie(e,t);return Re(i)},ie=(e,t)=>{const i=e.$hostElement$,r=(e.$cmpMeta$.$tagName$,()=>{}),s=i;let n;return t?(ce(i,"componentWillLoad"),n=ae(s,"componentWillLoad")):(ce(i,"componentWillUpdate"),n=ae(s,"componentWillUpdate")),ce(i,"componentWillRender"),n=le(n,(()=>ae(s,"componentWillRender"))),r(),le(n,(()=>re(e,s,t)))},re=async(e,t,i)=>{const r=e.$hostElement$,s=(e.$cmpMeta$.$tagName$,()=>{});r["s-rc"];i&&(e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=(t.$tagName$,()=>{}),n=T(i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);10&r&&(i["s-sc"]=n,i.classList.add(n+"-h"),2&r&&i.classList.add(n+"-s")),s()})(e);const n=(e.$cmpMeta$.$tagName$,()=>{});se(e,t,r),n(),s(),ne(e)},se=(e,t,i)=>{try{u=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,K(e,t)}catch(t){we(t,e.$hostElement$)}return u=null,null},ne=e=>{e.$cmpMeta$.$tagName$;const t=e.$hostElement$,i=()=>{},r=t;e.$ancestorComponent$;ae(r,"componentDidRender"),ce(t,"componentDidRender"),64&e.$flags$?(ae(r,"componentDidUpdate"),ce(t,"componentDidUpdate"),i()):(e.$flags$|=64,ae(r,"componentDidLoad"),ce(t,"componentDidLoad"),i())},oe=e=>{{const t=_e(e),i=t.$hostElement$.isConnected;return i&&2==(18&t.$flags$)&&te(t,!1),i}},ae=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(e){we(e)}},le=(e,t)=>e&&e.then?e.then(t):t(),ce=(e,t)=>{},ue=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const i=Object.entries(t.$members$),r=e.prototype;i.map((([e,[i]])=>{(31&i||32&i)&&Object.defineProperty(r,e,{get(){return t=e,_e(this).$instanceValues$.get(t);var t},set(i){((e,t,i,r)=>{const s=_e(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;var c,u;c=i,u=r.$members$[t][0],i=null==c||A(c)?c:4&u?"false"!==c&&(""===c||!!c):2&u?parseFloat(c):1&u?String(c):c;const h=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!h&&(s.$instanceValues$.set(t,i),1)){if(r.$watchers$&&128&a){const e=r.$watchers$[t];e&&e.map((e=>{try{l[e](i,o,t)}catch(e){we(e,n)}}))}if(2==(18&a)){if(l.componentShouldUpdate&&!1===l.componentShouldUpdate(i,o,t))return;te(s,!1)}}})(this,e,i,t)},configurable:!0,enumerable:!0})}));{const s=new Map;r.attributeChangedCallback=function(e,t,i){m.jmp((()=>{const t=s.get(e);if(this.hasOwnProperty(t))i=this[t],delete this[t];else if(r.hasOwnProperty(t)&&"number"==typeof this[t]&&this[t]==i)return;this[t]=(null!==i||"boolean"!=typeof this[t])&&i}))},e.observedAttributes=i.filter((([e,t])=>15&t[0])).map((([e,i])=>{const r=i[1]||e;return s.set(r,e),512&i[0]&&t.$attrsToReflect$.push([e,r]),r}))}}return e},he=async(e,t,i,r,s)=>{if(0==(32&t.$flags$)&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then((()=>t.$flags$|=128)),s.style)){let r=s.style;"string"!=typeof r&&(r=r[t.$modeName$=(e=>Ce.map((t=>t(e))).find((e=>!!e)))(e)]);const n=S(i,t.$modeName$);if(!xe.has(n)){const e=(i.$tagName$,()=>{});((e,t,i)=>{let r=xe.get(e);y&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,xe.set(e,r)})(n,r,!!(1&i.$flags$)),e()}}t.$ancestorComponent$;const n=()=>te(t,!0);n()},de=e=>{},pe=e=>{const t=e["s-cr"]=p.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},fe=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};i.$members$=t[2],i.$listeners$=t[3],i.$watchers$=e.$watchers$,i.$attrsToReflect$=[];const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){ve(this,i)},connectedCallback(){(e=>{if(0==(1&m.$flags$)){const t=_e(e),i=t.$cmpMeta$,r=(i.$tagName$,()=>{});if(1&t.$flags$)_(e,t,i.$listeners$),de(t.$lazyInstance$);else{let r;t.$flags$|=1,!r&&12&i.$flags$&&pe(e),i.$members$&&Object.entries(i.$members$).map((([t,[i]])=>{if(31&i&&e.hasOwnProperty(t)){const i=e[t];delete e[t],e[t]=i}})),he(e,t,i)}r()}})(this),r&&r.call(this)},disconnectedCallback(){(e=>{if(0==(1&m.$flags$)){const t=_e(e);t.$rmListeners$&&(t.$rmListeners$.map((e=>e())),t.$rmListeners$=void 0)}})(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(16&i.$flags$)})}}),e.is=i.$tagName$,ue(e,i)},me=e=>{const t=new URL(e,m.$resourcesUrl$);return t.origin!==d.location.origin?t.href:t.pathname},ge=e=>m.$resourcesUrl$=e,ye=new WeakMap,_e=e=>ye.get(e),ve=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return _(e,i,t.$listeners$),ye.set(e,i)},be=(e,t)=>t in e,we=(e,t)=>(0,console.error)(e,t),xe=new Map,Ce=[],Te=[],Se=[],Ee=(e,t)=>i=>{e.push(i),h||(h=!0,t&&4&m.$flags$?Oe(Me):m.raf(Me))},Ae=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(e){we(e)}e.length=0},Me=()=>{Ae(Te),Ae(Se),(h=Te.length>0)&&m.raf(Me)},Oe=e=>Promise.resolve(undefined).then(e),Re=Ee(Se,!0),Pe={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1}},41993:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=41993,e.exports=t},99490:(e,t)=>{"use strict";function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function s(){return s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},s.apply(this,arguments)}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,a(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t,i){return c=l()?Reflect.construct:function(e,t,i){var r=[null];r.push.apply(r,t);var s=new(Function.bind.apply(e,r));return i&&a(s,i.prototype),s},c.apply(null,arguments)}function u(e){var t="function"==typeof Map?new Map:void 0;return u=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return c(e,arguments,o(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,e)},u(e)}function h(e,t){if(null==e)return{};var i,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||(s[i]=e[i]);return s}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function p(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return d(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f=function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(u(Error)),m=function(e){function t(t){return e.call(this,"Invalid DateTime: "+t.toMessage())||this}return n(t,e),t}(f),g=function(e){function t(t){return e.call(this,"Invalid Interval: "+t.toMessage())||this}return n(t,e),t}(f),y=function(e){function t(t){return e.call(this,"Invalid Duration: "+t.toMessage())||this}return n(t,e),t}(f),_=function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(f),v=function(e){function t(t){return e.call(this,"Invalid unit "+t)||this}return n(t,e),t}(f),b=function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(f),w=function(e){function t(){return e.call(this,"Zone is an abstract class")||this}return n(t,e),t}(f),x="numeric",C="short",T="long",S={year:x,month:x,day:x},E={year:x,month:C,day:x},A={year:x,month:C,day:x,weekday:C},M={year:x,month:T,day:x},O={year:x,month:T,day:x,weekday:T},R={hour:x,minute:x},P={hour:x,minute:x,second:x},I={hour:x,minute:x,second:x,timeZoneName:C},L={hour:x,minute:x,second:x,timeZoneName:T},D={hour:x,minute:x,hourCycle:"h23"},N={hour:x,minute:x,second:x,hourCycle:"h23"},F={hour:x,minute:x,second:x,hourCycle:"h23",timeZoneName:C},k={hour:x,minute:x,second:x,hourCycle:"h23",timeZoneName:T},U={year:x,month:x,day:x,hour:x,minute:x},V={year:x,month:x,day:x,hour:x,minute:x,second:x},z={year:x,month:C,day:x,hour:x,minute:x},B={year:x,month:C,day:x,hour:x,minute:x,second:x},H={year:x,month:C,day:x,weekday:C,hour:x,minute:x},j={year:x,month:T,day:x,hour:x,minute:x,timeZoneName:C},G={year:x,month:T,day:x,hour:x,minute:x,second:x,timeZoneName:C},W={year:x,month:T,day:x,weekday:T,hour:x,minute:x,timeZoneName:T},Z={year:x,month:T,day:x,weekday:T,hour:x,minute:x,second:x,timeZoneName:T};function q(e){return void 0===e}function $(e){return"number"==typeof e}function Y(e){return"number"==typeof e&&e%1==0}function X(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function J(e,t,i){if(0!==e.length)return e.reduce((function(e,r){var s=[t(r),r];return e&&i(e[0],s[0])===e[0]?e:s}),null)[1]}function K(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Q(e,t,i){return Y(e)&&e>=t&&e<=i}function ee(e,t){return void 0===t&&(t=2),e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0")}function te(e){return q(e)||null===e||""===e?void 0:parseInt(e,10)}function ie(e){return q(e)||null===e||""===e?void 0:parseFloat(e)}function re(e){if(!q(e)&&null!==e&&""!==e){var t=1e3*parseFloat("0."+e);return Math.floor(t)}}function se(e,t,i){void 0===i&&(i=!1);var r=Math.pow(10,t);return(i?Math.trunc:Math.round)(e*r)/r}function ne(e){return e%4==0&&(e%100!=0||e%400==0)}function oe(e){return ne(e)?366:365}function ae(e,t){var i,r=(i=t-1)-12*Math.floor(i/12)+1;return 2===r?ne(e+(t-r)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function le(e){var t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t)).setUTCFullYear(t.getUTCFullYear()-1900),+t}function ce(e){var t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return 4===t||3===r?53:52}function ue(e){return e>99?e:e>60?1900+e:2e3+e}function he(e,t,i,r){void 0===r&&(r=null);var n=new Date(e),o={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(o.timeZone=r);var a=s({timeZoneName:t},o),l=new Intl.DateTimeFormat(i,a).formatToParts(n).find((function(e){return"timezonename"===e.type.toLowerCase()}));return l?l.value:null}function de(e,t){var i=parseInt(e,10);Number.isNaN(i)&&(i=0);var r=parseInt(t,10)||0;return 60*i+(i<0||Object.is(i,-0)?-r:r)}function pe(e){var t=Number(e);if("boolean"==typeof e||""===e||Number.isNaN(t))throw new b("Invalid unit value "+e);return t}function fe(e,t){var i={};for(var r in e)if(K(e,r)){var s=e[r];if(null==s)continue;i[t(r)]=pe(s)}return i}function me(e,t){var i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return""+s+ee(i,2)+":"+ee(r,2);case"narrow":return""+s+i+(r>0?":"+r:"");case"techie":return""+s+ee(i,2)+ee(r,2);default:throw new RangeError("Value format "+t+" is out of range for property format")}}function ge(e){return function(e,t){return["hour","minute","second","millisecond"].reduce((function(t,i){return t[i]=e[i],t}),{})}(e)}var ye=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,_e=["January","February","March","April","May","June","July","August","September","October","November","December"],ve=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],be=["J","F","M","A","M","J","J","A","S","O","N","D"];function we(e){switch(e){case"narrow":return[].concat(be);case"short":return[].concat(ve);case"long":return[].concat(_e);case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var xe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ce=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Te=["M","T","W","T","F","S","S"];function Se(e){switch(e){case"narrow":return[].concat(Te);case"short":return[].concat(Ce);case"long":return[].concat(xe);case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var Ee=["AM","PM"],Ae=["Before Christ","Anno Domini"],Me=["BC","AD"],Oe=["B","A"];function Re(e){switch(e){case"narrow":return[].concat(Oe);case"short":return[].concat(Me);case"long":return[].concat(Ae);default:return null}}function Pe(e,t){for(var i,r="",s=p(e);!(i=s()).done;){var n=i.value;n.literal?r+=n.val:r+=t(n.val)}return r}var Ie={D:S,DD:E,DDD:M,DDDD:O,t:R,tt:P,ttt:I,tttt:L,T:D,TT:N,TTT:F,TTTT:k,f:U,ff:z,fff:j,ffff:W,F:V,FF:B,FFF:G,FFFF:Z},Le=function(){function e(e,t){this.opts=t,this.loc=e,this.systemLoc=null}e.create=function(t,i){return void 0===i&&(i={}),new e(t,i)},e.parseFormat=function(e){for(var t=null,i="",r=!1,s=[],n=0;n<e.length;n++){var o=e.charAt(n);"'"===o?(i.length>0&&s.push({literal:r,val:i}),t=null,i="",r=!r):r||o===t?i+=o:(i.length>0&&s.push({literal:!1,val:i}),i=o,t=o)}return i.length>0&&s.push({literal:r,val:i}),s},e.macroTokenToFormatOpts=function(e){return Ie[e]};var t=e.prototype;return t.formatWithSystemDefault=function(e,t){return null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,s({},this.opts,t)).format()},t.formatDateTime=function(e,t){return void 0===t&&(t={}),this.loc.dtFormatter(e,s({},this.opts,t)).format()},t.formatDateTimeParts=function(e,t){return void 0===t&&(t={}),this.loc.dtFormatter(e,s({},this.opts,t)).formatToParts()},t.resolvedOptions=function(e,t){return void 0===t&&(t={}),this.loc.dtFormatter(e,s({},this.opts,t)).resolvedOptions()},t.num=function(e,t){if(void 0===t&&(t=0),this.opts.forceSimple)return ee(e,t);var i=s({},this.opts);return t>0&&(i.padTo=t),this.loc.numberFormatter(i).format(e)},t.formatDateTimeFromString=function(t,i){var r=this,s="en"===this.loc.listingMode(),n=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,o=function(e,i){return r.loc.extract(t,e,i)},a=function(e){return t.isOffsetFixed&&0===t.offset&&e.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,e.format):""},l=function(e,i){return s?function(e,t){return we(t)[e.month-1]}(t,e):o(i?{month:e}:{month:e,day:"numeric"},"month")},c=function(e,i){return s?function(e,t){return Se(t)[e.weekday-1]}(t,e):o(i?{weekday:e}:{weekday:e,month:"long",day:"numeric"},"weekday")},u=function(e){return s?function(e,t){return Re(t)[e.year<0?0:1]}(t,e):o({era:e},"era")};return Pe(e.parseFormat(i),(function(i){switch(i){case"S":return r.num(t.millisecond);case"u":case"SSS":return r.num(t.millisecond,3);case"s":return r.num(t.second);case"ss":return r.num(t.second,2);case"uu":return r.num(Math.floor(t.millisecond/10),2);case"uuu":return r.num(Math.floor(t.millisecond/100));case"m":return r.num(t.minute);case"mm":return r.num(t.minute,2);case"h":return r.num(t.hour%12==0?12:t.hour%12);case"hh":return r.num(t.hour%12==0?12:t.hour%12,2);case"H":return r.num(t.hour);case"HH":return r.num(t.hour,2);case"Z":return a({format:"narrow",allowZ:r.opts.allowZ});case"ZZ":return a({format:"short",allowZ:r.opts.allowZ});case"ZZZ":return a({format:"techie",allowZ:r.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:r.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:r.loc.locale});case"z":return t.zoneName;case"a":return s?function(e){return Ee[e.hour<12?0:1]}(t):o({hour:"numeric",hourCycle:"h12"},"dayperiod");case"d":return n?o({day:"numeric"},"day"):r.num(t.day);case"dd":return n?o({day:"2-digit"},"day"):r.num(t.day,2);case"c":case"E":return r.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?o({month:"numeric",day:"numeric"},"month"):r.num(t.month);case"LL":return n?o({month:"2-digit",day:"numeric"},"month"):r.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?o({month:"numeric"},"month"):r.num(t.month);case"MM":return n?o({month:"2-digit"},"month"):r.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?o({year:"numeric"},"year"):r.num(t.year);case"yy":return n?o({year:"2-digit"},"year"):r.num(t.year.toString().slice(-2),2);case"yyyy":return n?o({year:"numeric"},"year"):r.num(t.year,4);case"yyyyyy":return n?o({year:"numeric"},"year"):r.num(t.year,6);case"G":return u("short");case"GG":return u("long");case"GGGGG":return u("narrow");case"kk":return r.num(t.weekYear.toString().slice(-2),2);case"kkkk":return r.num(t.weekYear,4);case"W":return r.num(t.weekNumber);case"WW":return r.num(t.weekNumber,2);case"o":return r.num(t.ordinal);case"ooo":return r.num(t.ordinal,3);case"q":return r.num(t.quarter);case"qq":return r.num(t.quarter,2);case"X":return r.num(Math.floor(t.ts/1e3));case"x":return r.num(t.ts);default:return function(i){var s=e.macroTokenToFormatOpts(i);return s?r.formatWithSystemDefault(t,s):i}(i)}}))},t.formatDurationFromString=function(t,i){var r,s=this,n=function(e){switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},o=e.parseFormat(i),a=o.reduce((function(e,t){var i=t.literal,r=t.val;return i?e:e.concat(r)}),[]),l=t.shiftTo.apply(t,a.map(n).filter((function(e){return e})));return Pe(o,(r=l,function(e){var t=n(e);return t?s.num(r.get(t),e.length):e}))},e}(),De=function(){function e(e,t){this.reason=e,this.explanation=t}return e.prototype.toMessage=function(){return this.explanation?this.reason+": "+this.explanation:this.reason},e}(),Ne=function(){function e(){}var t=e.prototype;return t.offsetName=function(e,t){throw new w},t.formatOffset=function(e,t){throw new w},t.offset=function(e){throw new w},t.equals=function(e){throw new w},r(e,[{key:"type",get:function(){throw new w}},{key:"name",get:function(){throw new w}},{key:"ianaName",get:function(){return this.name}},{key:"isUniversal",get:function(){throw new w}},{key:"isValid",get:function(){throw new w}}]),e}(),Fe=null,ke=function(e){function t(){return e.apply(this,arguments)||this}n(t,e);var i=t.prototype;return i.offsetName=function(e,t){return he(e,t.format,t.locale)},i.formatOffset=function(e,t){return me(this.offset(e),t)},i.offset=function(e){return-new Date(e).getTimezoneOffset()},i.equals=function(e){return"system"===e.type},r(t,[{key:"type",get:function(){return"system"}},{key:"name",get:function(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}},{key:"isUniversal",get:function(){return!1}},{key:"isValid",get:function(){return!0}}],[{key:"instance",get:function(){return null===Fe&&(Fe=new t),Fe}}]),t}(Ne),Ue={},Ve={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6},ze={},Be=function(e){function t(i){var r;return(r=e.call(this)||this).zoneName=i,r.valid=t.isValidZone(i),r}n(t,e),t.create=function(e){return ze[e]||(ze[e]=new t(e)),ze[e]},t.resetCache=function(){ze={},Ue={}},t.isValidSpecifier=function(e){return this.isValidZone(e)},t.isValidZone=function(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(e){return!1}};var i=t.prototype;return i.offsetName=function(e,t){return he(e,t.format,t.locale,this.name)},i.formatOffset=function(e,t){return me(this.offset(e),t)},i.offset=function(e){var t=new Date(e);if(isNaN(t))return NaN;var i,r=(i=this.name,Ue[i]||(Ue[i]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:i,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Ue[i]),s=r.formatToParts?function(e,t){for(var i=e.formatToParts(t),r=[],s=0;s<i.length;s++){var n=i[s],o=n.type,a=n.value,l=Ve[o];"era"===o?r[l]=a:q(l)||(r[l]=parseInt(a,10))}return r}(r,t):function(e,t){var i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),s=r[1],n=r[2];return[r[3],s,n,r[4],r[5],r[6],r[7]]}(r,t),n=s[0],o=s[1],a=s[2],l=s[3],c=s[4],u=s[5],h=s[6];"BC"===l&&(n=1-Math.abs(n));var d=+t,p=d%1e3;return(le({year:n,month:o,day:a,hour:24===c?0:c,minute:u,second:h,millisecond:0})-(d-=p>=0?p:1e3+p))/6e4},i.equals=function(e){return"iana"===e.type&&e.name===this.name},r(t,[{key:"type",get:function(){return"iana"}},{key:"name",get:function(){return this.zoneName}},{key:"isUniversal",get:function(){return!1}},{key:"isValid",get:function(){return this.valid}}]),t}(Ne),He=null,je=function(e){function t(t){var i;return(i=e.call(this)||this).fixed=t,i}n(t,e),t.instance=function(e){return 0===e?t.utcInstance:new t(e)},t.parseSpecifier=function(e){if(e){var i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new t(de(i[1],i[2]))}return null};var i=t.prototype;return i.offsetName=function(){return this.name},i.formatOffset=function(e,t){return me(this.fixed,t)},i.offset=function(){return this.fixed},i.equals=function(e){return"fixed"===e.type&&e.fixed===this.fixed},r(t,[{key:"type",get:function(){return"fixed"}},{key:"name",get:function(){return 0===this.fixed?"UTC":"UTC"+me(this.fixed,"narrow")}},{key:"ianaName",get:function(){return 0===this.fixed?"Etc/UTC":"Etc/GMT"+me(-this.fixed,"narrow")}},{key:"isUniversal",get:function(){return!0}},{key:"isValid",get:function(){return!0}}],[{key:"utcInstance",get:function(){return null===He&&(He=new t(0)),He}}]),t}(Ne),Ge=function(e){function t(t){var i;return(i=e.call(this)||this).zoneName=t,i}n(t,e);var i=t.prototype;return i.offsetName=function(){return null},i.formatOffset=function(){return""},i.offset=function(){return NaN},i.equals=function(){return!1},r(t,[{key:"type",get:function(){return"invalid"}},{key:"name",get:function(){return this.zoneName}},{key:"isUniversal",get:function(){return!1}},{key:"isValid",get:function(){return!1}}]),t}(Ne);function We(e,t){if(q(e)||null===e)return t;if(e instanceof Ne)return e;if("string"==typeof e){var i=e.toLowerCase();return"local"===i||"system"===i?t:"utc"===i||"gmt"===i?je.utcInstance:je.parseSpecifier(i)||Be.create(e)}return $(e)?je.instance(e):"object"==typeof e&&e.offset&&"number"==typeof e.offset?e:new Ge(e)}var Ze,qe=function(){return Date.now()},$e="system",Ye=null,Xe=null,Je=null,Ke=function(){function e(){}return e.resetCaches=function(){ht.resetCache(),Be.resetCache()},r(e,null,[{key:"now",get:function(){return qe},set:function(e){qe=e}},{key:"defaultZone",get:function(){return We($e,ke.instance)},set:function(e){$e=e}},{key:"defaultLocale",get:function(){return Ye},set:function(e){Ye=e}},{key:"defaultNumberingSystem",get:function(){return Xe},set:function(e){Xe=e}},{key:"defaultOutputCalendar",get:function(){return Je},set:function(e){Je=e}},{key:"throwOnInvalid",get:function(){return Ze},set:function(e){Ze=e}}]),e}(),Qe=["base"],et=["padTo","floor"],tt={},it={};function rt(e,t){void 0===t&&(t={});var i=JSON.stringify([e,t]),r=it[i];return r||(r=new Intl.DateTimeFormat(e,t),it[i]=r),r}var st={},nt={},ot=null;function at(e,t,i,r,s){var n=e.listingMode(i);return"error"===n?null:"en"===n?r(t):s(t)}var lt=function(){function e(e,t,i){this.padTo=i.padTo||0,this.floor=i.floor||!1,i.padTo,i.floor;var r=h(i,et);if(!t||Object.keys(r).length>0){var n=s({useGrouping:!1},i);i.padTo>0&&(n.minimumIntegerDigits=i.padTo),this.inf=function(e,t){void 0===t&&(t={});var i=JSON.stringify([e,t]),r=st[i];return r||(r=new Intl.NumberFormat(e,t),st[i]=r),r}(e,n)}}return e.prototype.format=function(e){if(this.inf){var t=this.floor?Math.floor(e):e;return this.inf.format(t)}return ee(this.floor?Math.floor(e):se(e,3),this.padTo)},e}(),ct=function(){function e(e,t,i){var r;if(this.opts=i,e.zone.isUniversal){var n=e.offset/60*-1,o=n>=0?"Etc/GMT+"+n:"Etc/GMT"+n;0!==e.offset&&Be.create(o).valid?(r=o,this.dt=e):(r="UTC",i.timeZoneName?this.dt=e:this.dt=0===e.offset?e:ar.fromMillis(e.ts+60*e.offset*1e3))}else"system"===e.zone.type?this.dt=e:(this.dt=e,r=e.zone.name);var a=s({},this.opts);r&&(a.timeZone=r),this.dtf=rt(t,a)}var t=e.prototype;return t.format=function(){return this.dtf.format(this.dt.toJSDate())},t.formatToParts=function(){return this.dtf.formatToParts(this.dt.toJSDate())},t.resolvedOptions=function(){return this.dtf.resolvedOptions()},e}(),ut=function(){function e(e,t,i){this.opts=s({style:"long"},i),!t&&X()&&(this.rtf=function(e,t){void 0===t&&(t={});var i=t;i.base;var r=h(i,Qe),s=JSON.stringify([e,r]),n=nt[s];return n||(n=new Intl.RelativeTimeFormat(e,t),nt[s]=n),n}(e,i))}var t=e.prototype;return t.format=function(e,t){return this.rtf?this.rtf.format(e,t):function(e,t,i,r){void 0===i&&(i="always"),void 0===r&&(r=!1);var s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===i&&n){var o="days"===e;switch(t){case 1:return o?"tomorrow":"next "+s[e][0];case-1:return o?"yesterday":"last "+s[e][0];case 0:return o?"today":"this "+s[e][0]}}var a=Object.is(t,-0)||t<0,l=Math.abs(t),c=1===l,u=s[e],h=r?c?u[1]:u[2]||u[1]:c?s[e][0]:e;return a?l+" "+h+" ago":"in "+l+" "+h}(t,e,this.opts.numeric,"long"!==this.opts.style)},t.formatToParts=function(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]},e}(),ht=function(){function e(e,t,i,r){var s=function(e){var t=e.indexOf("-u-");if(-1===t)return[e];var i,r=e.substring(0,t);try{i=rt(e).resolvedOptions()}catch(e){i=rt(r).resolvedOptions()}var s=i;return[r,s.numberingSystem,s.calendar]}(e),n=s[0],o=s[1],a=s[2];this.locale=n,this.numberingSystem=t||o||null,this.outputCalendar=i||a||null,this.intl=function(e,t,i){return i||t?(e+="-u",i&&(e+="-ca-"+i),t&&(e+="-nu-"+t),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}e.fromOpts=function(t){return e.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)},e.create=function(t,i,r,s){void 0===s&&(s=!1);var n=t||Ke.defaultLocale;return new e(n||(s?"en-US":ot||(ot=(new Intl.DateTimeFormat).resolvedOptions().locale)),i||Ke.defaultNumberingSystem,r||Ke.defaultOutputCalendar,n)},e.resetCache=function(){ot=null,it={},st={},nt={}},e.fromObject=function(t){var i=void 0===t?{}:t,r=i.locale,s=i.numberingSystem,n=i.outputCalendar;return e.create(r,s,n)};var t=e.prototype;return t.listingMode=function(){var e=this.isEnglish(),t=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e&&t?"en":"intl"},t.clone=function(t){return t&&0!==Object.getOwnPropertyNames(t).length?e.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1):this},t.redefaultToEN=function(e){return void 0===e&&(e={}),this.clone(s({},e,{defaultToEN:!0}))},t.redefaultToSystem=function(e){return void 0===e&&(e={}),this.clone(s({},e,{defaultToEN:!1}))},t.months=function(e,t,i){var r=this;return void 0===t&&(t=!1),void 0===i&&(i=!0),at(this,e,i,we,(function(){var i=t?{month:e,day:"numeric"}:{month:e},s=t?"format":"standalone";return r.monthsCache[s][e]||(r.monthsCache[s][e]=function(e){for(var t=[],i=1;i<=12;i++){var r=ar.utc(2016,i,1);t.push(e(r))}return t}((function(e){return r.extract(e,i,"month")}))),r.monthsCache[s][e]}))},t.weekdays=function(e,t,i){var r=this;return void 0===t&&(t=!1),void 0===i&&(i=!0),at(this,e,i,Se,(function(){var i=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=t?"format":"standalone";return r.weekdaysCache[s][e]||(r.weekdaysCache[s][e]=function(e){for(var t=[],i=1;i<=7;i++){var r=ar.utc(2016,11,13+i);t.push(e(r))}return t}((function(e){return r.extract(e,i,"weekday")}))),r.weekdaysCache[s][e]}))},t.meridiems=function(e){var t=this;return void 0===e&&(e=!0),at(this,void 0,e,(function(){return Ee}),(function(){if(!t.meridiemCache){var e={hour:"numeric",hourCycle:"h12"};t.meridiemCache=[ar.utc(2016,11,13,9),ar.utc(2016,11,13,19)].map((function(i){return t.extract(i,e,"dayperiod")}))}return t.meridiemCache}))},t.eras=function(e,t){var i=this;return void 0===t&&(t=!0),at(this,e,t,Re,(function(){var t={era:e};return i.eraCache[e]||(i.eraCache[e]=[ar.utc(-40,1,1),ar.utc(2017,1,1)].map((function(e){return i.extract(e,t,"era")}))),i.eraCache[e]}))},t.extract=function(e,t,i){var r=this.dtFormatter(e,t).formatToParts().find((function(e){return e.type.toLowerCase()===i}));return r?r.value:null},t.numberFormatter=function(e){return void 0===e&&(e={}),new lt(this.intl,e.forceSimple||this.fastNumbers,e)},t.dtFormatter=function(e,t){return void 0===t&&(t={}),new ct(e,this.intl,t)},t.relFormatter=function(e){return void 0===e&&(e={}),new ut(this.intl,this.isEnglish(),e)},t.listFormatter=function(e){return void 0===e&&(e={}),function(e,t){void 0===t&&(t={});var i=JSON.stringify([e,t]),r=tt[i];return r||(r=new Intl.ListFormat(e,t),tt[i]=r),r}(this.intl,e)},t.isEnglish=function(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")},t.equals=function(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar},r(e,[{key:"fastNumbers",get:function(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}}]),e}();function dt(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var r=t.reduce((function(e,t){return e+t.source}),"");return RegExp("^"+r+"$")}function pt(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return t.reduce((function(t,i){var r=t[0],n=t[1],o=t[2],a=i(e,o),l=a[0],c=a[1],u=a[2];return[s({},r,l),c||n,u]}),[{},null,1]).slice(0,2)}}function ft(e){if(null==e)return[null,null];for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];for(var s=0,n=i;s<n.length;s++){var o=n[s],a=o[0],l=o[1],c=a.exec(e);if(c)return l(c)}return[null,null]}function mt(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e,i){var r,s={};for(r=0;r<t.length;r++)s[t[r]]=te(e[i+r]);return[s,null,i+r]}}var gt=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,yt=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,_t=RegExp(yt.source+("(?:"+gt.source+"?(?:\\[("+ye.source+")\\])?)?")),vt=RegExp("(?:T"+_t.source+")?"),bt=mt("weekYear","weekNumber","weekDay"),wt=mt("year","ordinal"),xt=RegExp(yt.source+" ?(?:"+gt.source+"|("+ye.source+"))?"),Ct=RegExp("(?: "+xt.source+")?");function Tt(e,t,i){var r=e[t];return q(r)?i:te(r)}function St(e,t){return[{hours:Tt(e,t,0),minutes:Tt(e,t+1,0),seconds:Tt(e,t+2,0),milliseconds:re(e[t+3])},null,t+4]}function Et(e,t){var i=!e[t]&&!e[t+1],r=de(e[t+1],e[t+2]);return[{},i?null:je.instance(r),t+3]}function At(e,t){return[{},e[t]?Be.create(e[t]):null,t+1]}var Mt=RegExp("^T?"+yt.source+"$"),Ot=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function Rt(e){var t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u="-"===t[0],h=l&&"-"===l[0],d=function(e,t){return void 0===t&&(t=!1),void 0!==e&&(t||e&&u)?-e:e};return[{years:d(ie(i)),months:d(ie(r)),weeks:d(ie(s)),days:d(ie(n)),hours:d(ie(o)),minutes:d(ie(a)),seconds:d(ie(l),"-0"===l),milliseconds:d(re(c),h)}]}var Pt={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function It(e,t,i,r,s,n,o){var a={year:2===t.length?ue(te(t)):te(t),month:ve.indexOf(i)+1,day:te(r),hour:te(s),minute:te(n)};return o&&(a.second=te(o)),e&&(a.weekday=e.length>3?xe.indexOf(e)+1:Ce.indexOf(e)+1),a}var Lt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Dt(e){var t,i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=It(i,n,s,r,o,a,l);return t=c?Pt[c]:u?0:de(h,d),[p,new je(t)]}var Nt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Ft=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,kt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Ut(e){var t=e[1],i=e[2],r=e[3];return[It(t,e[4],r,i,e[5],e[6],e[7]),je.utcInstance]}function Vt(e){var t=e[1],i=e[2],r=e[3],s=e[4],n=e[5],o=e[6];return[It(t,e[7],i,r,s,n,o),je.utcInstance]}var zt=dt(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,vt),Bt=dt(/(\d{4})-?W(\d\d)(?:-?(\d))?/,vt),Ht=dt(/(\d{4})-?(\d{3})/,vt),jt=dt(_t),Gt=pt((function(e,t){return[{year:Tt(e,t),month:Tt(e,t+1,1),day:Tt(e,t+2,1)},null,t+3]}),St,Et,At),Wt=pt(bt,St,Et,At),Zt=pt(wt,St,Et,At),qt=pt(St,Et,At),$t=pt(St),Yt=dt(/(\d{4})-(\d\d)-(\d\d)/,Ct),Xt=dt(xt),Jt=pt(St,Et,At),Kt={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},Qt=s({years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6}},Kt),ei=s({years:{quarters:4,months:12,weeks:52.1775,days:365.2425,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3}},Kt),ti=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],ii=ti.slice(0).reverse();function ri(e,t,i){void 0===i&&(i=!1);var r={values:i?t.values:s({},e.values,t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new ni(r)}function si(e,t,i,r,s){var n=e[s][i],o=t[i]/n,a=Math.sign(o)!==Math.sign(r[s])&&0!==r[s]&&Math.abs(o)<=1?function(e){return e<0?Math.floor(e):Math.ceil(e)}(o):Math.trunc(o);r[s]+=a,t[i]-=a*n}var ni=function(){function e(e){var t="longterm"===e.conversionAccuracy||!1;this.values=e.values,this.loc=e.loc||ht.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=t?ei:Qt,this.isLuxonDuration=!0}e.fromMillis=function(t,i){return e.fromObject({milliseconds:t},i)},e.fromObject=function(t,i){if(void 0===i&&(i={}),null==t||"object"!=typeof t)throw new b("Duration.fromObject: argument expected to be an object, got "+(null===t?"null":typeof t));return new e({values:fe(t,e.normalizeUnit),loc:ht.fromObject(i),conversionAccuracy:i.conversionAccuracy})},e.fromDurationLike=function(t){if($(t))return e.fromMillis(t);if(e.isDuration(t))return t;if("object"==typeof t)return e.fromObject(t);throw new b("Unknown duration argument "+t+" of type "+typeof t)},e.fromISO=function(t,i){var r=function(e){return ft(e,[Ot,Rt])}(t),s=r[0];return s?e.fromObject(s,i):e.invalid("unparsable",'the input "'+t+"\" can't be parsed as ISO 8601")},e.fromISOTime=function(t,i){var r=function(e){return ft(e,[Mt,$t])}(t),s=r[0];return s?e.fromObject(s,i):e.invalid("unparsable",'the input "'+t+"\" can't be parsed as ISO 8601")},e.invalid=function(t,i){if(void 0===i&&(i=null),!t)throw new b("need to specify a reason the Duration is invalid");var r=t instanceof De?t:new De(t,i);if(Ke.throwOnInvalid)throw new y(r);return new e({invalid:r})},e.normalizeUnit=function(e){var t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new v(e);return t},e.isDuration=function(e){return e&&e.isLuxonDuration||!1};var t=e.prototype;return t.toFormat=function(e,t){void 0===t&&(t={});var i=s({},t,{floor:!1!==t.round&&!1!==t.floor});return this.isValid?Le.create(this.loc,i).formatDurationFromString(this,e):"Invalid Duration"},t.toHuman=function(e){var t=this;void 0===e&&(e={});var i=ti.map((function(i){var r=t.values[i];return q(r)?null:t.loc.numberFormatter(s({style:"unit",unitDisplay:"long"},e,{unit:i.slice(0,-1)})).format(r)})).filter((function(e){return e}));return this.loc.listFormatter(s({type:"conjunction",style:e.listStyle||"narrow"},e)).format(i)},t.toObject=function(){return this.isValid?s({},this.values):{}},t.toISO=function(){if(!this.isValid)return null;var e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=se(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e},t.toISOTime=function(e){if(void 0===e&&(e={}),!this.isValid)return null;var t=this.toMillis();if(t<0||t>=864e5)return null;e=s({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},e);var i=this.shiftTo("hours","minutes","seconds","milliseconds"),r="basic"===e.format?"hhmm":"hh:mm";e.suppressSeconds&&0===i.seconds&&0===i.milliseconds||(r+="basic"===e.format?"ss":":ss",e.suppressMilliseconds&&0===i.milliseconds||(r+=".SSS"));var n=i.toFormat(r);return e.includePrefix&&(n="T"+n),n},t.toJSON=function(){return this.toISO()},t.toString=function(){return this.toISO()},t.toMillis=function(){return this.as("milliseconds")},t.valueOf=function(){return this.toMillis()},t.plus=function(t){if(!this.isValid)return this;for(var i,r=e.fromDurationLike(t),s={},n=p(ti);!(i=n()).done;){var o=i.value;(K(r.values,o)||K(this.values,o))&&(s[o]=r.get(o)+this.get(o))}return ri(this,{values:s},!0)},t.minus=function(t){if(!this.isValid)return this;var i=e.fromDurationLike(t);return this.plus(i.negate())},t.mapUnits=function(e){if(!this.isValid)return this;for(var t={},i=0,r=Object.keys(this.values);i<r.length;i++){var s=r[i];t[s]=pe(e(this.values[s],s))}return ri(this,{values:t},!0)},t.get=function(t){return this[e.normalizeUnit(t)]},t.set=function(t){return this.isValid?ri(this,{values:s({},this.values,fe(t,e.normalizeUnit))}):this},t.reconfigure=function(e){var t=void 0===e?{}:e,i=t.locale,r=t.numberingSystem,s=t.conversionAccuracy,n={loc:this.loc.clone({locale:i,numberingSystem:r})};return s&&(n.conversionAccuracy=s),ri(this,n)},t.as=function(e){return this.isValid?this.shiftTo(e).get(e):NaN},t.normalize=function(){if(!this.isValid)return this;var e=this.toObject();return function(e,t){ii.reduce((function(i,r){return q(t[r])?i:(i&&si(e,t,i,t,r),r)}),null)}(this.matrix,e),ri(this,{values:e},!0)},t.shiftTo=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];if(!this.isValid)return this;if(0===i.length)return this;i=i.map((function(t){return e.normalizeUnit(t)}));for(var s,n,o={},a={},l=this.toObject(),c=p(ti);!(n=c()).done;){var u=n.value;if(i.indexOf(u)>=0){s=u;var h=0;for(var d in a)h+=this.matrix[d][u]*a[d],a[d]=0;$(l[u])&&(h+=l[u]);var f=Math.trunc(h);for(var m in o[u]=f,a[u]=(1e3*h-1e3*f)/1e3,l)ti.indexOf(m)>ti.indexOf(u)&&si(this.matrix,l,m,o,u)}else $(l[u])&&(a[u]=l[u])}for(var g in a)0!==a[g]&&(o[s]+=g===s?a[g]:a[g]/this.matrix[s][g]);return ri(this,{values:o},!0).normalize()},t.negate=function(){if(!this.isValid)return this;for(var e={},t=0,i=Object.keys(this.values);t<i.length;t++){var r=i[t];e[r]=0===this.values[r]?0:-this.values[r]}return ri(this,{values:e},!0)},t.equals=function(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;for(var t,i=p(ti);!(t=i()).done;){var r=t.value;if(s=this.values[r],n=e.values[r],!(void 0===s||0===s?void 0===n||0===n:s===n))return!1}var s,n;return!0},r(e,[{key:"locale",get:function(){return this.isValid?this.loc.locale:null}},{key:"numberingSystem",get:function(){return this.isValid?this.loc.numberingSystem:null}},{key:"years",get:function(){return this.isValid?this.values.years||0:NaN}},{key:"quarters",get:function(){return this.isValid?this.values.quarters||0:NaN}},{key:"months",get:function(){return this.isValid?this.values.months||0:NaN}},{key:"weeks",get:function(){return this.isValid?this.values.weeks||0:NaN}},{key:"days",get:function(){return this.isValid?this.values.days||0:NaN}},{key:"hours",get:function(){return this.isValid?this.values.hours||0:NaN}},{key:"minutes",get:function(){return this.isValid?this.values.minutes||0:NaN}},{key:"seconds",get:function(){return this.isValid?this.values.seconds||0:NaN}},{key:"milliseconds",get:function(){return this.isValid?this.values.milliseconds||0:NaN}},{key:"isValid",get:function(){return null===this.invalid}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}}]),e}(),oi="Invalid Interval";function ai(e,t){return e&&e.isValid?t&&t.isValid?t<e?li.invalid("end before start","The end of an interval must be after its start, but you had start="+e.toISO()+" and end="+t.toISO()):null:li.invalid("missing or invalid end"):li.invalid("missing or invalid start")}var li=function(){function e(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}e.invalid=function(t,i){if(void 0===i&&(i=null),!t)throw new b("need to specify a reason the Interval is invalid");var r=t instanceof De?t:new De(t,i);if(Ke.throwOnInvalid)throw new g(r);return new e({invalid:r})},e.fromDateTimes=function(t,i){var r=lr(t),s=lr(i),n=ai(r,s);return null==n?new e({start:r,end:s}):n},e.after=function(t,i){var r=ni.fromDurationLike(i),s=lr(t);return e.fromDateTimes(s,s.plus(r))},e.before=function(t,i){var r=ni.fromDurationLike(i),s=lr(t);return e.fromDateTimes(s.minus(r),s)},e.fromISO=function(t,i){var r=(t||"").split("/",2),s=r[0],n=r[1];if(s&&n){var o,a,l,c;try{a=(o=ar.fromISO(s,i)).isValid}catch(n){a=!1}try{c=(l=ar.fromISO(n,i)).isValid}catch(n){c=!1}if(a&&c)return e.fromDateTimes(o,l);if(a){var u=ni.fromISO(n,i);if(u.isValid)return e.after(o,u)}else if(c){var h=ni.fromISO(s,i);if(h.isValid)return e.before(l,h)}}return e.invalid("unparsable",'the input "'+t+"\" can't be parsed as ISO 8601")},e.isInterval=function(e){return e&&e.isLuxonInterval||!1};var t=e.prototype;return t.length=function(e){return void 0===e&&(e="milliseconds"),this.isValid?this.toDuration.apply(this,[e]).get(e):NaN},t.count=function(e){if(void 0===e&&(e="milliseconds"),!this.isValid)return NaN;var t=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(t,e).get(e))+1},t.hasSame=function(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))},t.isEmpty=function(){return this.s.valueOf()===this.e.valueOf()},t.isAfter=function(e){return!!this.isValid&&this.s>e},t.isBefore=function(e){return!!this.isValid&&this.e<=e},t.contains=function(e){return!!this.isValid&&this.s<=e&&this.e>e},t.set=function(t){var i=void 0===t?{}:t,r=i.start,s=i.end;return this.isValid?e.fromDateTimes(r||this.s,s||this.e):this},t.splitAt=function(){var t=this;if(!this.isValid)return[];for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];for(var n=r.map(lr).filter((function(e){return t.contains(e)})).sort(),o=[],a=this.s,l=0;a<this.e;){var c=n[l]||this.e,u=+c>+this.e?this.e:c;o.push(e.fromDateTimes(a,u)),a=u,l+=1}return o},t.splitBy=function(t){var i=ni.fromDurationLike(t);if(!this.isValid||!i.isValid||0===i.as("milliseconds"))return[];for(var r,s=this.s,n=1,o=[];s<this.e;){var a=this.start.plus(i.mapUnits((function(e){return e*n})));r=+a>+this.e?this.e:a,o.push(e.fromDateTimes(s,r)),s=r,n+=1}return o},t.divideEqually=function(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]},t.overlaps=function(e){return this.e>e.s&&this.s<e.e},t.abutsStart=function(e){return!!this.isValid&&+this.e==+e.s},t.abutsEnd=function(e){return!!this.isValid&&+e.e==+this.s},t.engulfs=function(e){return!!this.isValid&&this.s<=e.s&&this.e>=e.e},t.equals=function(e){return!(!this.isValid||!e.isValid)&&this.s.equals(e.s)&&this.e.equals(e.e)},t.intersection=function(t){if(!this.isValid)return this;var i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:e.fromDateTimes(i,r)},t.union=function(t){if(!this.isValid)return this;var i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return e.fromDateTimes(i,r)},e.merge=function(e){var t=e.sort((function(e,t){return e.s-t.s})).reduce((function(e,t){var i=e[0],r=e[1];return r?r.overlaps(t)||r.abutsStart(t)?[i,r.union(t)]:[i.concat([r]),t]:[i,t]}),[[],null]),i=t[0],r=t[1];return r&&i.push(r),i},e.xor=function(t){for(var i,r,s=null,n=0,o=[],a=t.map((function(e){return[{time:e.s,type:"s"},{time:e.e,type:"e"}]})),l=p((i=Array.prototype).concat.apply(i,a).sort((function(e,t){return e.time-t.time})));!(r=l()).done;){var c=r.value;1===(n+="s"===c.type?1:-1)?s=c.time:(s&&+s!=+c.time&&o.push(e.fromDateTimes(s,c.time)),s=null)}return e.merge(o)},t.difference=function(){for(var t=this,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e.xor([this].concat(r)).map((function(e){return t.intersection(e)})).filter((function(e){return e&&!e.isEmpty()}))},t.toString=function(){return this.isValid?"["+this.s.toISO()+"  "+this.e.toISO()+")":oi},t.toISO=function(e){return this.isValid?this.s.toISO(e)+"/"+this.e.toISO(e):oi},t.toISODate=function(){return this.isValid?this.s.toISODate()+"/"+this.e.toISODate():oi},t.toISOTime=function(e){return this.isValid?this.s.toISOTime(e)+"/"+this.e.toISOTime(e):oi},t.toFormat=function(e,t){var i=(void 0===t?{}:t).separator,r=void 0===i?"  ":i;return this.isValid?""+this.s.toFormat(e)+r+this.e.toFormat(e):oi},t.toDuration=function(e,t){return this.isValid?this.e.diff(this.s,e,t):ni.invalid(this.invalidReason)},t.mapEndpoints=function(t){return e.fromDateTimes(t(this.s),t(this.e))},r(e,[{key:"start",get:function(){return this.isValid?this.s:null}},{key:"end",get:function(){return this.isValid?this.e:null}},{key:"isValid",get:function(){return null===this.invalidReason}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}}]),e}(),ci=function(){function e(){}return e.hasDST=function(e){void 0===e&&(e=Ke.defaultZone);var t=ar.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset},e.isValidIANAZone=function(e){return Be.isValidZone(e)},e.normalizeZone=function(e){return We(e,Ke.defaultZone)},e.months=function(e,t){void 0===e&&(e="long");var i=void 0===t?{}:t,r=i.locale,s=void 0===r?null:r,n=i.numberingSystem,o=void 0===n?null:n,a=i.locObj,l=void 0===a?null:a,c=i.outputCalendar,u=void 0===c?"gregory":c;return(l||ht.create(s,o,u)).months(e)},e.monthsFormat=function(e,t){void 0===e&&(e="long");var i=void 0===t?{}:t,r=i.locale,s=void 0===r?null:r,n=i.numberingSystem,o=void 0===n?null:n,a=i.locObj,l=void 0===a?null:a,c=i.outputCalendar,u=void 0===c?"gregory":c;return(l||ht.create(s,o,u)).months(e,!0)},e.weekdays=function(e,t){void 0===e&&(e="long");var i=void 0===t?{}:t,r=i.locale,s=void 0===r?null:r,n=i.numberingSystem,o=void 0===n?null:n,a=i.locObj;return((void 0===a?null:a)||ht.create(s,o,null)).weekdays(e)},e.weekdaysFormat=function(e,t){void 0===e&&(e="long");var i=void 0===t?{}:t,r=i.locale,s=void 0===r?null:r,n=i.numberingSystem,o=void 0===n?null:n,a=i.locObj;return((void 0===a?null:a)||ht.create(s,o,null)).weekdays(e,!0)},e.meridiems=function(e){var t=(void 0===e?{}:e).locale,i=void 0===t?null:t;return ht.create(i).meridiems()},e.eras=function(e,t){void 0===e&&(e="short");var i=(void 0===t?{}:t).locale,r=void 0===i?null:i;return ht.create(r,null,"gregory").eras(e)},e.features=function(){return{relative:X()}},e}();function ui(e,t){var i=function(e){return e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf()},r=i(t)-i(e);return Math.floor(ni.fromMillis(r).as("days"))}var hi={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},di={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},pi=hi.hanidec.replace(/[\[|\]]/g,"").split("");function fi(e,t){var i=e.numberingSystem;return void 0===t&&(t=""),new RegExp(""+hi[i||"latn"]+t)}function mi(e,t){return void 0===t&&(t=function(e){return e}),{regex:e,deser:function(e){var i=e[0];return t(function(e){var t=parseInt(e,10);if(isNaN(t)){t="";for(var i=0;i<e.length;i++){var r=e.charCodeAt(i);if(-1!==e[i].search(hi.hanidec))t+=pi.indexOf(e[i]);else for(var s in di){var n=di[s],o=n[0],a=n[1];r>=o&&r<=a&&(t+=r-o)}}return parseInt(t,10)}return t}(i))}}}var gi="[ "+String.fromCharCode(160)+"]",yi=new RegExp(gi,"g");function _i(e){return e.replace(/\./g,"\\.?").replace(yi,gi)}function vi(e){return e.replace(/\./g,"").replace(yi," ").toLowerCase()}function bi(e,t){return null===e?null:{regex:RegExp(e.map(_i).join("|")),deser:function(i){var r=i[0];return e.findIndex((function(e){return vi(r)===vi(e)}))+t}}}function wi(e,t){return{regex:e,deser:function(e){return de(e[1],e[2])},groups:t}}function xi(e){return{regex:e,deser:function(e){return e[0]}}}var Ci={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}},Ti=null;function Si(e,t,i){var r=function(e,t){var i;return(i=Array.prototype).concat.apply(i,e.map((function(e){return function(e,t){if(e.literal)return e;var i=Le.macroTokenToFormatOpts(e.val);if(!i)return e;var r=Le.create(t,i).formatDateTimeParts((Ti||(Ti=ar.fromMillis(1555555555555)),Ti)).map((function(e){return function(e,t,i){var r=e.type,s=e.value;if("literal"===r)return{literal:!0,val:s};var n=i[r],o=Ci[r];return"object"==typeof o&&(o=o[n]),o?{literal:!1,val:o}:void 0}(e,0,i)}));return r.includes(void 0)?e:r}(e,t)})))}(Le.parseFormat(i),e),s=r.map((function(t){return i=t,s=fi(r=e),n=fi(r,"{2}"),o=fi(r,"{3}"),a=fi(r,"{4}"),l=fi(r,"{6}"),c=fi(r,"{1,2}"),u=fi(r,"{1,3}"),h=fi(r,"{1,6}"),d=fi(r,"{1,9}"),p=fi(r,"{2,4}"),f=fi(r,"{4,6}"),m=function(e){return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:function(e){return e[0]},literal:!0};var t},g=function(e){if(i.literal)return m(e);switch(e.val){case"G":return bi(r.eras("short",!1),0);case"GG":return bi(r.eras("long",!1),0);case"y":return mi(h);case"yy":case"kk":return mi(p,ue);case"yyyy":case"kkkk":return mi(a);case"yyyyy":return mi(f);case"yyyyyy":return mi(l);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return mi(c);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return mi(n);case"MMM":return bi(r.months("short",!0,!1),1);case"MMMM":return bi(r.months("long",!0,!1),1);case"LLL":return bi(r.months("short",!1,!1),1);case"LLLL":return bi(r.months("long",!1,!1),1);case"o":case"S":return mi(u);case"ooo":case"SSS":return mi(o);case"u":return xi(d);case"uu":return xi(c);case"uuu":case"E":case"c":return mi(s);case"a":return bi(r.meridiems(),0);case"EEE":return bi(r.weekdays("short",!1,!1),1);case"EEEE":return bi(r.weekdays("long",!1,!1),1);case"ccc":return bi(r.weekdays("short",!0,!1),1);case"cccc":return bi(r.weekdays("long",!0,!1),1);case"Z":case"ZZ":return wi(new RegExp("([+-]"+c.source+")(?::("+n.source+"))?"),2);case"ZZZ":return wi(new RegExp("([+-]"+c.source+")("+n.source+")?"),2);case"z":return xi(/[a-z_+-/]{1,256}?/i);default:return m(e)}}(i)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"},g.token=i,g;var i,r,s,n,o,a,l,c,u,h,d,p,f,m,g})),n=s.find((function(e){return e.invalidReason}));if(n)return{input:t,tokens:r,invalidReason:n.invalidReason};var o=function(e){return["^"+e.map((function(e){return e.regex})).reduce((function(e,t){return e+"("+t.source+")"}),"")+"$",e]}(s),a=o[0],l=o[1],c=RegExp(a,"i"),u=function(e,t,i){var r=e.match(t);if(r){var s={},n=1;for(var o in i)if(K(i,o)){var a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}return[r,{}]}(t,c,l),h=u[0],d=u[1],p=d?function(e){var t,i=null;return q(e.z)||(i=Be.create(e.z)),q(e.Z)||(i||(i=new je(e.Z)),t=e.Z),q(e.q)||(e.M=3*(e.q-1)+1),q(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),q(e.u)||(e.S=re(e.u)),[Object.keys(e).reduce((function(t,i){var r=function(e){switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}}(i);return r&&(t[r]=e[i]),t}),{}),i,t]}(d):[null,null,void 0],f=p[0],m=p[1],g=p[2];if(K(d,"a")&&K(d,"H"))throw new _("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:c,rawMatches:h,matches:d,result:f,zone:m,specificOffset:g}}var Ei=[0,31,59,90,120,151,181,212,243,273,304,334],Ai=[0,31,60,91,121,152,182,213,244,274,305,335];function Mi(e,t){return new De("unit out of range","you specified "+t+" (of type "+typeof t+") as a "+e+", which is invalid")}function Oi(e,t,i){var r=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);var s=r.getUTCDay();return 0===s?7:s}function Ri(e,t,i){return i+(ne(e)?Ai:Ei)[t-1]}function Pi(e,t){var i=ne(e)?Ai:Ei,r=i.findIndex((function(e){return e<t}));return{month:r+1,day:t-i[r]}}function Ii(e){var t,i=e.year,r=e.month,n=e.day,o=Ri(i,r,n),a=Oi(i,r,n),l=Math.floor((o-a+10)/7);return l<1?l=ce(t=i-1):l>ce(i)?(t=i+1,l=1):t=i,s({weekYear:t,weekNumber:l,weekday:a},ge(e))}function Li(e){var t,i=e.weekYear,r=e.weekNumber,n=e.weekday,o=Oi(i,1,4),a=oe(i),l=7*r+n-o-3;l<1?l+=oe(t=i-1):l>a?(t=i+1,l-=oe(i)):t=i;var c=Pi(t,l);return s({year:t,month:c.month,day:c.day},ge(e))}function Di(e){var t=e.year;return s({year:t,ordinal:Ri(t,e.month,e.day)},ge(e))}function Ni(e){var t=e.year,i=Pi(t,e.ordinal);return s({year:t,month:i.month,day:i.day},ge(e))}function Fi(e){var t=Y(e.year),i=Q(e.month,1,12),r=Q(e.day,1,ae(e.year,e.month));return t?i?!r&&Mi("day",e.day):Mi("month",e.month):Mi("year",e.year)}function ki(e){var t=e.hour,i=e.minute,r=e.second,s=e.millisecond,n=Q(t,0,23)||24===t&&0===i&&0===r&&0===s,o=Q(i,0,59),a=Q(r,0,59),l=Q(s,0,999);return n?o?a?!l&&Mi("millisecond",s):Mi("second",r):Mi("minute",i):Mi("hour",t)}var Ui="Invalid DateTime",Vi=864e13;function zi(e){return new De("unsupported zone",'the zone "'+e.name+'" is not supported')}function Bi(e){return null===e.weekData&&(e.weekData=Ii(e.c)),e.weekData}function Hi(e,t){var i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new ar(s({},i,t,{old:i}))}function ji(e,t,i){var r=e-60*t*1e3,s=i.offset(r);if(t===s)return[r,t];r-=60*(s-t)*1e3;var n=i.offset(r);return s===n?[r,s]:[e-60*Math.min(s,n)*1e3,Math.max(s,n)]}function Gi(e,t){var i=new Date(e+=60*t*1e3);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function Wi(e,t,i){return ji(le(e),t,i)}function Zi(e,t){var i=e.o,r=e.c.year+Math.trunc(t.years),n=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),o=s({},e.c,{year:r,month:n,day:Math.min(e.c.day,ae(r,n))+Math.trunc(t.days)+7*Math.trunc(t.weeks)}),a=ni.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),l=ji(le(o),i,e.zone),c=l[0],u=l[1];return 0!==a&&(c+=a,u=e.zone.offset(c)),{ts:c,o:u}}function qi(e,t,i,r,n,o){var a=i.setZone,l=i.zone;if(e&&0!==Object.keys(e).length){var c=t||l,u=ar.fromObject(e,s({},i,{zone:c,specificOffset:o}));return a?u:u.setZone(l)}return ar.invalid(new De("unparsable",'the input "'+n+"\" can't be parsed as "+r))}function $i(e,t,i){return void 0===i&&(i=!0),e.isValid?Le.create(ht.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function Yi(e,t){var i=e.c.year>9999||e.c.year<0,r="";return i&&e.c.year>=0&&(r+="+"),r+=ee(e.c.year,i?6:4),t?(r+="-",r+=ee(e.c.month),r+="-",r+=ee(e.c.day)):(r+=ee(e.c.month),r+=ee(e.c.day)),r}function Xi(e,t,i,r,s,n){var o=ee(e.c.hour);return t?(o+=":",o+=ee(e.c.minute),0===e.c.second&&i||(o+=":")):o+=ee(e.c.minute),0===e.c.second&&i||(o+=ee(e.c.second),0===e.c.millisecond&&r||(o+=".",o+=ee(e.c.millisecond,3))),s&&(e.isOffsetFixed&&0===e.offset&&!n?o+="Z":e.o<0?(o+="-",o+=ee(Math.trunc(-e.o/60)),o+=":",o+=ee(Math.trunc(-e.o%60))):(o+="+",o+=ee(Math.trunc(e.o/60)),o+=":",o+=ee(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}var Ji={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Ki={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Qi={ordinal:1,hour:0,minute:0,second:0,millisecond:0},er=["year","month","day","hour","minute","second","millisecond"],tr=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],ir=["year","ordinal","hour","minute","second","millisecond"];function rr(e){var t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new v(e);return t}function sr(e,t){var i,r,s=We(t.zone,Ke.defaultZone),n=ht.fromObject(t),o=Ke.now();if(q(e.year))i=o;else{for(var a,l=p(er);!(a=l()).done;){var c=a.value;q(e[c])&&(e[c]=Ji[c])}var u=Fi(e)||ki(e);if(u)return ar.invalid(u);var h=Wi(e,s.offset(o),s);i=h[0],r=h[1]}return new ar({ts:i,zone:s,loc:n,o:r})}function nr(e,t,i){var r=!!q(i.round)||i.round,s=function(e,s){return e=se(e,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(e,s)},n=function(r){return i.calendary?t.hasSame(e,r)?0:t.startOf(r).diff(e.startOf(r),r).get(r):t.diff(e,r).get(r)};if(i.unit)return s(n(i.unit),i.unit);for(var o,a=p(i.units);!(o=a()).done;){var l=o.value,c=n(l);if(Math.abs(c)>=1)return s(c,l)}return s(e>t?-0:0,i.units[i.units.length-1])}function or(e){var t,i={};return e.length>0&&"object"==typeof e[e.length-1]?(i=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[i,t]}var ar=function(){function e(e){var t=e.zone||Ke.defaultZone,i=e.invalid||(Number.isNaN(e.ts)?new De("invalid input"):null)||(t.isValid?null:zi(t));this.ts=q(e.ts)?Ke.now():e.ts;var r=null,s=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t)){var n=[e.old.c,e.old.o];r=n[0],s=n[1]}else{var o=t.offset(this.ts);r=Gi(this.ts,o),r=(i=Number.isNaN(r.year)?new De("invalid input"):null)?null:r,s=i?null:o}this._zone=t,this.loc=e.loc||ht.create(),this.invalid=i,this.weekData=null,this.c=r,this.o=s,this.isLuxonDateTime=!0}e.now=function(){return new e({})},e.local=function(){var e=or(arguments),t=e[0],i=e[1],r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5],c=i[6];return sr({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)},e.utc=function(){var e=or(arguments),t=e[0],i=e[1],r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5],c=i[6];return t.zone=je.utcInstance,sr({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)},e.fromJSDate=function(t,i){void 0===i&&(i={});var r,s=(r=t,"[object Date]"===Object.prototype.toString.call(r)?t.valueOf():NaN);if(Number.isNaN(s))return e.invalid("invalid input");var n=We(i.zone,Ke.defaultZone);return n.isValid?new e({ts:s,zone:n,loc:ht.fromObject(i)}):e.invalid(zi(n))},e.fromMillis=function(t,i){if(void 0===i&&(i={}),$(t))return t<-Vi||t>Vi?e.invalid("Timestamp out of range"):new e({ts:t,zone:We(i.zone,Ke.defaultZone),loc:ht.fromObject(i)});throw new b("fromMillis requires a numerical input, but received a "+typeof t+" with value "+t)},e.fromSeconds=function(t,i){if(void 0===i&&(i={}),$(t))return new e({ts:1e3*t,zone:We(i.zone,Ke.defaultZone),loc:ht.fromObject(i)});throw new b("fromSeconds requires a numerical input")},e.fromObject=function(t,i){void 0===i&&(i={}),t=t||{};var r=We(i.zone,Ke.defaultZone);if(!r.isValid)return e.invalid(zi(r));var s=Ke.now(),n=q(i.specificOffset)?r.offset(s):i.specificOffset,o=fe(t,rr),a=!q(o.ordinal),l=!q(o.year),c=!q(o.month)||!q(o.day),u=l||c,h=o.weekYear||o.weekNumber,d=ht.fromObject(i);if((u||a)&&h)throw new _("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new _("Can't mix ordinal dates with month/day");var f,m,g=h||o.weekday&&!u,y=Gi(s,n);g?(f=tr,m=Ki,y=Ii(y)):a?(f=ir,m=Qi,y=Di(y)):(f=er,m=Ji);for(var v,b=!1,w=p(f);!(v=w()).done;){var x=v.value;q(o[x])?o[x]=b?m[x]:y[x]:b=!0}var C=g?function(e){var t=Y(e.weekYear),i=Q(e.weekNumber,1,ce(e.weekYear)),r=Q(e.weekday,1,7);return t?i?!r&&Mi("weekday",e.weekday):Mi("week",e.week):Mi("weekYear",e.weekYear)}(o):a?function(e){var t=Y(e.year),i=Q(e.ordinal,1,oe(e.year));return t?!i&&Mi("ordinal",e.ordinal):Mi("year",e.year)}(o):Fi(o),T=C||ki(o);if(T)return e.invalid(T);var S=Wi(g?Li(o):a?Ni(o):o,n,r),E=new e({ts:S[0],zone:r,o:S[1],loc:d});return o.weekday&&u&&t.weekday!==E.weekday?e.invalid("mismatched weekday","you can't specify both a weekday of "+o.weekday+" and a date of "+E.toISO()):E},e.fromISO=function(e,t){void 0===t&&(t={});var i=function(e){return ft(e,[zt,Gt],[Bt,Wt],[Ht,Zt],[jt,qt])}(e);return qi(i[0],i[1],t,"ISO 8601",e)},e.fromRFC2822=function(e,t){void 0===t&&(t={});var i=function(e){return ft(function(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[Lt,Dt])}(e);return qi(i[0],i[1],t,"RFC 2822",e)},e.fromHTTP=function(e,t){void 0===t&&(t={});var i=function(e){return ft(e,[Nt,Ut],[Ft,Ut],[kt,Vt])}(e);return qi(i[0],i[1],t,"HTTP",t)},e.fromFormat=function(t,i,r){if(void 0===r&&(r={}),q(t)||q(i))throw new b("fromFormat requires an input string and a format");var s=r,n=s.locale,o=void 0===n?null:n,a=s.numberingSystem,l=void 0===a?null:a,c=function(e,t,i){var r=Si(e,t,i);return[r.result,r.zone,r.specificOffset,r.invalidReason]}(ht.fromOpts({locale:o,numberingSystem:l,defaultToEN:!0}),t,i),u=c[0],h=c[1],d=c[2],p=c[3];return p?e.invalid(p):qi(u,h,r,"format "+i,t,d)},e.fromString=function(t,i,r){return void 0===r&&(r={}),e.fromFormat(t,i,r)},e.fromSQL=function(e,t){void 0===t&&(t={});var i=function(e){return ft(e,[Yt,Gt],[Xt,Jt])}(e);return qi(i[0],i[1],t,"SQL",e)},e.invalid=function(t,i){if(void 0===i&&(i=null),!t)throw new b("need to specify a reason the DateTime is invalid");var r=t instanceof De?t:new De(t,i);if(Ke.throwOnInvalid)throw new m(r);return new e({invalid:r})},e.isDateTime=function(e){return e&&e.isLuxonDateTime||!1};var t=e.prototype;return t.get=function(e){return this[e]},t.resolvedLocaleOptions=function(e){void 0===e&&(e={});var t=Le.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t.locale,numberingSystem:t.numberingSystem,outputCalendar:t.calendar}},t.toUTC=function(e,t){return void 0===e&&(e=0),void 0===t&&(t={}),this.setZone(je.instance(e),t)},t.toLocal=function(){return this.setZone(Ke.defaultZone)},t.setZone=function(t,i){var r=void 0===i?{}:i,s=r.keepLocalTime,n=void 0!==s&&s,o=r.keepCalendarTime,a=void 0!==o&&o;if((t=We(t,Ke.defaultZone)).equals(this.zone))return this;if(t.isValid){var l=this.ts;if(n||a){var c=t.offset(this.ts);l=Wi(this.toObject(),c,t)[0]}return Hi(this,{ts:l,zone:t})}return e.invalid(zi(t))},t.reconfigure=function(e){var t=void 0===e?{}:e,i=t.locale,r=t.numberingSystem,s=t.outputCalendar;return Hi(this,{loc:this.loc.clone({locale:i,numberingSystem:r,outputCalendar:s})})},t.setLocale=function(e){return this.reconfigure({locale:e})},t.set=function(e){if(!this.isValid)return this;var t,i=fe(e,rr),r=!q(i.weekYear)||!q(i.weekNumber)||!q(i.weekday),n=!q(i.ordinal),o=!q(i.year),a=!q(i.month)||!q(i.day),l=o||a,c=i.weekYear||i.weekNumber;if((l||n)&&c)throw new _("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(a&&n)throw new _("Can't mix ordinal dates with month/day");r?t=Li(s({},Ii(this.c),i)):q(i.ordinal)?(t=s({},this.toObject(),i),q(i.day)&&(t.day=Math.min(ae(t.year,t.month),t.day))):t=Ni(s({},Di(this.c),i));var u=Wi(t,this.o,this.zone);return Hi(this,{ts:u[0],o:u[1]})},t.plus=function(e){return this.isValid?Hi(this,Zi(this,ni.fromDurationLike(e))):this},t.minus=function(e){return this.isValid?Hi(this,Zi(this,ni.fromDurationLike(e).negate())):this},t.startOf=function(e){if(!this.isValid)return this;var t={},i=ni.normalizeUnit(e);switch(i){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0}if("weeks"===i&&(t.weekday=1),"quarters"===i){var r=Math.ceil(this.month/3);t.month=3*(r-1)+1}return this.set(t)},t.endOf=function(e){var t;return this.isValid?this.plus((t={},t[e]=1,t)).startOf(e).minus(1):this},t.toFormat=function(e,t){return void 0===t&&(t={}),this.isValid?Le.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):Ui},t.toLocaleString=function(e,t){return void 0===e&&(e=S),void 0===t&&(t={}),this.isValid?Le.create(this.loc.clone(t),e).formatDateTime(this):Ui},t.toLocaleParts=function(e){return void 0===e&&(e={}),this.isValid?Le.create(this.loc.clone(e),e).formatDateTimeParts(this):[]},t.toISO=function(e){var t=void 0===e?{}:e,i=t.format,r=void 0===i?"extended":i,s=t.suppressSeconds,n=void 0!==s&&s,o=t.suppressMilliseconds,a=void 0!==o&&o,l=t.includeOffset,c=void 0===l||l,u=t.extendedZone,h=void 0!==u&&u;if(!this.isValid)return null;var d="extended"===r,p=Yi(this,d);return(p+="T")+Xi(this,d,n,a,c,h)},t.toISODate=function(e){var t=(void 0===e?{}:e).format,i=void 0===t?"extended":t;return this.isValid?Yi(this,"extended"===i):null},t.toISOWeekDate=function(){return $i(this,"kkkk-'W'WW-c")},t.toISOTime=function(e){var t=void 0===e?{}:e,i=t.suppressMilliseconds,r=void 0!==i&&i,s=t.suppressSeconds,n=void 0!==s&&s,o=t.includeOffset,a=void 0===o||o,l=t.includePrefix,c=void 0!==l&&l,u=t.extendedZone,h=void 0!==u&&u,d=t.format,p=void 0===d?"extended":d;return this.isValid?(c?"T":"")+Xi(this,"extended"===p,n,r,a,h):null},t.toRFC2822=function(){return $i(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)},t.toHTTP=function(){return $i(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")},t.toSQLDate=function(){return this.isValid?Yi(this,!0):null},t.toSQLTime=function(e){var t=void 0===e?{}:e,i=t.includeOffset,r=void 0===i||i,s=t.includeZone,n=void 0!==s&&s,o=t.includeOffsetSpace,a="HH:mm:ss.SSS";return(n||r)&&((void 0===o||o)&&(a+=" "),n?a+="z":r&&(a+="ZZ")),$i(this,a,!0)},t.toSQL=function(e){return void 0===e&&(e={}),this.isValid?this.toSQLDate()+" "+this.toSQLTime(e):null},t.toString=function(){return this.isValid?this.toISO():Ui},t.valueOf=function(){return this.toMillis()},t.toMillis=function(){return this.isValid?this.ts:NaN},t.toSeconds=function(){return this.isValid?this.ts/1e3:NaN},t.toUnixInteger=function(){return this.isValid?Math.floor(this.ts/1e3):NaN},t.toJSON=function(){return this.toISO()},t.toBSON=function(){return this.toJSDate()},t.toObject=function(e){if(void 0===e&&(e={}),!this.isValid)return{};var t=s({},this.c);return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t},t.toJSDate=function(){return new Date(this.isValid?this.ts:NaN)},t.diff=function(e,t,i){if(void 0===t&&(t="milliseconds"),void 0===i&&(i={}),!this.isValid||!e.isValid)return ni.invalid("created by diffing an invalid DateTime");var r,n=s({locale:this.locale,numberingSystem:this.numberingSystem},i),o=(r=t,Array.isArray(r)?r:[r]).map(ni.normalizeUnit),a=e.valueOf()>this.valueOf(),l=function(e,t,i,r){var s,n=function(e,t,i){for(var r,s,n={},o=0,a=[["years",function(e,t){return t.year-e.year}],["quarters",function(e,t){return t.quarter-e.quarter}],["months",function(e,t){return t.month-e.month+12*(t.year-e.year)}],["weeks",function(e,t){var i=ui(e,t);return(i-i%7)/7}],["days",ui]];o<a.length;o++){var l=a[o],c=l[0],u=l[1];if(i.indexOf(c)>=0){var h;r=c;var d,p=u(e,t);(s=e.plus(((h={})[c]=p,h)))>t?(e=e.plus(((d={})[c]=p-1,d)),p-=1):e=s,n[c]=p}}return[e,n,s,r]}(e,t,i),o=n[0],a=n[1],l=n[2],c=n[3],u=t-o,h=i.filter((function(e){return["hours","minutes","seconds","milliseconds"].indexOf(e)>=0}));0===h.length&&(l<t&&(l=o.plus(((s={})[c]=1,s))),l!==o&&(a[c]=(a[c]||0)+u/(l-o)));var d,p=ni.fromObject(a,r);return h.length>0?(d=ni.fromMillis(u,r)).shiftTo.apply(d,h).plus(p):p}(a?this:e,a?e:this,o,n);return a?l.negate():l},t.diffNow=function(t,i){return void 0===t&&(t="milliseconds"),void 0===i&&(i={}),this.diff(e.now(),t,i)},t.until=function(e){return this.isValid?li.fromDateTimes(this,e):this},t.hasSame=function(e,t){if(!this.isValid)return!1;var i=e.valueOf(),r=this.setZone(e.zone,{keepLocalTime:!0});return r.startOf(t)<=i&&i<=r.endOf(t)},t.equals=function(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)},t.toRelative=function(t){if(void 0===t&&(t={}),!this.isValid)return null;var i=t.base||e.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0,n=["years","months","days","hours","minutes","seconds"],o=t.unit;return Array.isArray(t.unit)&&(n=t.unit,o=void 0),nr(i,this.plus(r),s({},t,{numeric:"always",units:n,unit:o}))},t.toRelativeCalendar=function(t){return void 0===t&&(t={}),this.isValid?nr(t.base||e.fromObject({},{zone:this.zone}),this,s({},t,{numeric:"auto",units:["years","months","days"],calendary:!0})):null},e.min=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];if(!i.every(e.isDateTime))throw new b("min requires all arguments be DateTimes");return J(i,(function(e){return e.valueOf()}),Math.min)},e.max=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];if(!i.every(e.isDateTime))throw new b("max requires all arguments be DateTimes");return J(i,(function(e){return e.valueOf()}),Math.max)},e.fromFormatExplain=function(e,t,i){void 0===i&&(i={});var r=i,s=r.locale,n=void 0===s?null:s,o=r.numberingSystem,a=void 0===o?null:o;return Si(ht.fromOpts({locale:n,numberingSystem:a,defaultToEN:!0}),e,t)},e.fromStringExplain=function(t,i,r){return void 0===r&&(r={}),e.fromFormatExplain(t,i,r)},r(e,[{key:"isValid",get:function(){return null===this.invalid}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}},{key:"locale",get:function(){return this.isValid?this.loc.locale:null}},{key:"numberingSystem",get:function(){return this.isValid?this.loc.numberingSystem:null}},{key:"outputCalendar",get:function(){return this.isValid?this.loc.outputCalendar:null}},{key:"zone",get:function(){return this._zone}},{key:"zoneName",get:function(){return this.isValid?this.zone.name:null}},{key:"year",get:function(){return this.isValid?this.c.year:NaN}},{key:"quarter",get:function(){return this.isValid?Math.ceil(this.c.month/3):NaN}},{key:"month",get:function(){return this.isValid?this.c.month:NaN}},{key:"day",get:function(){return this.isValid?this.c.day:NaN}},{key:"hour",get:function(){return this.isValid?this.c.hour:NaN}},{key:"minute",get:function(){return this.isValid?this.c.minute:NaN}},{key:"second",get:function(){return this.isValid?this.c.second:NaN}},{key:"millisecond",get:function(){return this.isValid?this.c.millisecond:NaN}},{key:"weekYear",get:function(){return this.isValid?Bi(this).weekYear:NaN}},{key:"weekNumber",get:function(){return this.isValid?Bi(this).weekNumber:NaN}},{key:"weekday",get:function(){return this.isValid?Bi(this).weekday:NaN}},{key:"ordinal",get:function(){return this.isValid?Di(this.c).ordinal:NaN}},{key:"monthShort",get:function(){return this.isValid?ci.months("short",{locObj:this.loc})[this.month-1]:null}},{key:"monthLong",get:function(){return this.isValid?ci.months("long",{locObj:this.loc})[this.month-1]:null}},{key:"weekdayShort",get:function(){return this.isValid?ci.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}},{key:"weekdayLong",get:function(){return this.isValid?ci.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}},{key:"offset",get:function(){return this.isValid?+this.o:NaN}},{key:"offsetNameShort",get:function(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}},{key:"offsetNameLong",get:function(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}},{key:"isOffsetFixed",get:function(){return this.isValid?this.zone.isUniversal:null}},{key:"isInDST",get:function(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}},{key:"isInLeapYear",get:function(){return ne(this.year)}},{key:"daysInMonth",get:function(){return ae(this.year,this.month)}},{key:"daysInYear",get:function(){return this.isValid?oe(this.year):NaN}},{key:"weeksInWeekYear",get:function(){return this.isValid?ce(this.weekYear):NaN}}],[{key:"DATE_SHORT",get:function(){return S}},{key:"DATE_MED",get:function(){return E}},{key:"DATE_MED_WITH_WEEKDAY",get:function(){return A}},{key:"DATE_FULL",get:function(){return M}},{key:"DATE_HUGE",get:function(){return O}},{key:"TIME_SIMPLE",get:function(){return R}},{key:"TIME_WITH_SECONDS",get:function(){return P}},{key:"TIME_WITH_SHORT_OFFSET",get:function(){return I}},{key:"TIME_WITH_LONG_OFFSET",get:function(){return L}},{key:"TIME_24_SIMPLE",get:function(){return D}},{key:"TIME_24_WITH_SECONDS",get:function(){return N}},{key:"TIME_24_WITH_SHORT_OFFSET",get:function(){return F}},{key:"TIME_24_WITH_LONG_OFFSET",get:function(){return k}},{key:"DATETIME_SHORT",get:function(){return U}},{key:"DATETIME_SHORT_WITH_SECONDS",get:function(){return V}},{key:"DATETIME_MED",get:function(){return z}},{key:"DATETIME_MED_WITH_SECONDS",get:function(){return B}},{key:"DATETIME_MED_WITH_WEEKDAY",get:function(){return H}},{key:"DATETIME_FULL",get:function(){return j}},{key:"DATETIME_FULL_WITH_SECONDS",get:function(){return G}},{key:"DATETIME_HUGE",get:function(){return W}},{key:"DATETIME_HUGE_WITH_SECONDS",get:function(){return Z}}]),e}();function lr(e){if(ar.isDateTime(e))return e;if(e&&e.valueOf&&$(e.valueOf()))return ar.fromJSDate(e);if(e&&"object"==typeof e)return ar.fromObject(e);throw new b("Unknown datetime argument: "+e+", of type "+typeof e)}t.ou=ar},88355:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>A});var r,s=i(36663),n=i(41831),o=i(58811),a=i(59801),l=i(82064),c=i(67134),u=i(68309),h=i(63592),d=i(13802),p=i(61681),f=i(78668),m=i(3466),g=i(81977),y=(i(7283),i(40266)),_=i(39835),v=i(14685),b=i(26869),w=i(53110),x=i(2725),C=i(4e4);let T=0;const S=d.Z.getLogger("esri.Basemap");let E=r=class extends((0,l.eC)(u.Z)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+T++,this.baseLayers=new n.Z,this.referenceLayers=new n.Z;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&S.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=e=>{e.parent=null};this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>i(e.item))),this.referenceLayers.on("after-remove",(e=>i(e.item)))}initialize(){this.when().catch((e=>{S.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.removeAll();for(const t of e)t.destroy();const t=this.referenceLayers.removeAll();for(const e of t)e.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem?.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",(0,o.Z)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e?(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=(0,C.Nw)(e,i.webmap?i.webmap.getLayerJSONFromResourceInfo(e):null,i);(0,p.pC)(t)&&r.push(t)})),this.referenceLayers.forEach((e=>{const t=(0,C.Nw)(e,i.webmap?i.webmap.getLayerJSONFromResourceInfo(e):null,i);(0,p.pC)(t)&&(t.isReference=!0,r.push(t))})),t.baseMapLayers=r):t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",(0,o.Z)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,h.G)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new r({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=(0,c.d9)(e);return t.url&&(0,m.oC)(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&(0,m.oC)(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;(0,f.k_)(e);const r=[];if(t){const i=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,i,e)),t.data.id&&!t.data.title){const e=t.data.id;r.push((0,x.g)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,r){const s=this.resourceInfo&&this.resourceInfo.context,n=this.portalItem&&this.portalItem.portal||s&&s.portal||null,o=s&&"web-scene"===s.origin?"web-scene":"web-map",{populateOperationalLayers:a}=await i.e(5423).then(i.bind(i,45423)),l=[];if((0,f.k_)(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const i={context:{origin:o,url:t,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},r=a(this.baseLayers,e.baseMapLayers.filter((e=>!e.isReference)),i);l.push(r);const s=a(this.referenceLayers,e.baseMapLayers.filter((e=>e.isReference)),i);l.push(s)}await(0,f.as)(l)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=(0,m.mN)(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||b.Z.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||b.Z.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=x.s[e];if(t){if(t.deprecated){let t=null;"dark-gray"===e?t="dark-gray-vector":"gray"===e?t="gray-vector":"streets"===e?t="streets-vector":"topo"===e&&(t="topo-vector"),(0,a.x9)(S,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:t,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return r.fromJSON(t)}return null}};(0,s._)([(0,g.Cb)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:n.Z}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],E.prototype,"baseLayers",null),(0,s._)([(0,g.Cb)({type:String,json:{origins:{"web-scene":{write:!0}}}})],E.prototype,"id",void 0),(0,s._)([(0,g.Cb)({type:w.default})],E.prototype,"portalItem",void 0),(0,s._)([(0,g.Cb)()],E.prototype,"referenceLayers",null),(0,s._)([(0,g.Cb)({readOnly:!0})],E.prototype,"resourceInfo",void 0),(0,s._)([(0,g.Cb)({type:v.Z})],E.prototype,"spatialReference",void 0),(0,s._)([(0,g.Cb)()],E.prototype,"thumbnailUrl",void 0),(0,s._)([(0,g.Cb)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],E.prototype,"title",void 0),(0,s._)([(0,_.c)("title")],E.prototype,"writeTitle",null),E=r=(0,s._)([(0,y.j)("esri.Basemap")],E);const A=E},30936:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var r,s,n=i(86875),o=i(19431),a=i(61681),l=i(7283);function c(e){return(0,o.uZ)((0,l.vU)(e),0,255)}function u(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}class h{constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}static blendColors(e,t,i,r=new h){return r.r=Math.round(e.r+(t.r-e.r)*i),r.g=Math.round(e.g+(t.g-e.g)*i),r.b=Math.round(e.b+(t.b-e.b)*i),r.a=e.a+(t.a-e.a)*i,r._sanitize()}static fromRgb(e,t){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const e=i[2].split(/\s*,\s*/),r=i[1];if("rgb"===r&&3===e.length||"rgba"===r&&4===e.length){const i=e[0];if("%"===i.charAt(i.length-1)){const i=e.map((e=>2.56*parseFloat(e)));return 4===e.length&&(i[3]=parseFloat(e[3])),h.fromArray(i,t)}return h.fromArray(e.map((e=>parseFloat(e))),t)}if("hsl"===r&&3===e.length||"hsla"===r&&4===e.length)return h.fromArray((0,n.B7)(parseFloat(e[0]),parseFloat(e[1])/100,parseFloat(e[2])/100,parseFloat(e[3])),t)}return null}static fromHex(e,t=new h){if(4!==e.length&&7!==e.length||"#"!==e[0])return null;const i=4===e.length?4:8,r=(1<<i)-1;let s=Number("0x"+e.substr(1));return isNaN(s)?null:(["b","g","r"].forEach((e=>{const n=s&r;s>>=i,t[e]=4===i?17*n:n})),t.a=1,t)}static fromArray(e,t=new h){return t._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(t.a)&&(t.a=1),t._sanitize()}static fromString(e,t){const i=(0,n.St)(e)?(0,n.h$)(e):null;return i&&h.fromArray(i,t)||h.fromRgb(e,t)||h.fromHex(e,t)}static fromJSON(e){return e&&new h([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return(0,a.pC)(e)?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return(0,a.pC)(e)?[e.r/255,e.g/255,e.b/255,null!=e.a?e.a:1]:null}get isBright(){return.299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return"string"==typeof e?h.fromString(e,this):Array.isArray(e)?h.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof h||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),t=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}`}toCss(e=!1){const t=this.r+", "+this.g+", "+this.b;return e?`rgba(${t}, ${this.a})`:`rgb(${t})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=h.AlphaMode.ALWAYS){const t=c(this.r),i=c(this.g),r=c(this.b);return e===h.AlphaMode.ALWAYS||1!==this.a?[t,i,r,c(255*this.a)]:[t,i,r]}clone(){return new h(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return(0,a.pC)(e)&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(u(this.r,0,255)),this.g=Math.round(u(this.g,0,255)),this.b=Math.round(u(this.b,0,255)),this.a=u(this.a,0,1),this}_set(e,t,i,r){this.r=e,this.g=t,this.b=i,this.a=r}}h.prototype.declaredClass="esri.Color",r=h||(h={}),(s=r.AlphaMode||(r.AlphaMode={}))[s.ALWAYS=0]="ALWAYS",s[s.UNLESS_OPAQUE=1]="UNLESS_OPAQUE";const d=h},80085:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r=i(36663),s=i(91957),n=i(80020),o=i(4905),a=i(41151),l=i(82064),c=i(61681),u=i(7958),h=i(81977),d=(i(7753),i(39994),i(7283),i(40266)),p=i(53736);function f(e){if(!(0,c.pC)(e))return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return 0!==Object.keys(t).length?t:null}let m=class extends((0,a.J)(l.wq)){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:(0,u.D)(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&(0,c.pC)(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:f(this.aggregateGeometries),geometry:(0,c.pC)(this.geometry)?this.geometry.toJSON():null,symbol:(0,c.pC)(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){(0,c.pC)(this.geometry)&&"mesh"===this.geometry.type&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};"attributes"===e&&(s.attributeName=r),this.layer.graphicChanged(s)}};(0,r._)([(0,h.Cb)({value:null,json:{read:function(e){if(!e)return null;const t={};for(const i in e){const r=(0,p.im)(e[i]);r&&(t[i]=r)}return 0!==Object.keys(t).length?t:null}}})],m.prototype,"aggregateGeometries",null),(0,r._)([(0,h.Cb)({value:null})],m.prototype,"attributes",null),(0,r._)([(0,h.Cb)({value:null,types:s.qM,json:{read:p.im}})],m.prototype,"geometry",null),(0,r._)([(0,h.Cb)({type:Boolean})],m.prototype,"isAggregate",void 0),(0,r._)([(0,h.Cb)({clonable:"reference"})],m.prototype,"layer",void 0),(0,r._)([(0,h.Cb)({type:n.Z})],m.prototype,"popupTemplate",void 0),(0,r._)([(0,h.Cb)({clonable:"reference"})],m.prototype,"sourceLayer",void 0),(0,r._)([(0,h.Cb)({value:null,types:o.LB})],m.prototype,"symbol",null),(0,r._)([(0,h.Cb)({type:Boolean,value:!0})],m.prototype,"visible",null),m=(0,r._)([(0,d.j)("esri.Graphic")],m),(m||(m={})).generateUID=u.D;const g=m},80020:(e,t,i)=>{"use strict";i.d(t,{Z:()=>G});var r=i(36663),s=i(41831),n=i(82064),o=i(67134),a=i(13802),l=i(78668),c=i(81977),u=i(69236),h=i(34248),d=i(40266),p=i(39835),f=i(7283),m=i(17095),g=i(24834),y=i(17814),_=i(15902),v=i(32776),b=i(29893),w=i(21363),x=i(58106);const C={base:null,key:"type",typeMap:{attachment:g.Z,media:w.Z,text:x.Z,expression:v.Z,field:b.Z}};var T,S=i(18228),E=i(78213);i(7753),i(39994);let A=T=class extends n.wq{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new T({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};(0,r._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],A.prototype,"returnTopmostRaster",void 0),(0,r._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],A.prototype,"showNoDataRecords",void 0),A=T=(0,r._)([(0,d.j)("esri.popup.LayerOptions")],A);const M=A;var O,R=i(79163);let P=O=class extends n.wq{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new O({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?(0,o.d9)(this.orderByFields):null})}};(0,r._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],P.prototype,"showRelatedRecords",void 0),(0,r._)([(0,c.Cb)({type:[R.Z],json:{write:!0}})],P.prototype,"orderByFields",void 0),P=O=(0,r._)([(0,d.j)("esri.popup.RelatedRecordsInfo")],P);const I=P;var L,D=i(36598),N=i(83258),F=i(97837),k=i(15600);const U=s.Z.ofType({key:"type",defaultKeyValue:"button",base:N.Z,typeMap:{button:F.Z,toggle:k.Z}}),V={base:y.Z,key:"type",typeMap:{media:w.Z,custom:_.Z,text:x.Z,attachments:g.Z,fields:b.Z,expression:v.Z}},z="esri.PopupTemplate",B=a.Z.getLogger(z),H=["attachments","fields","media","text","expression"];let j=L=class extends n.wq{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map((e=>(0,f.N7)(V,e))):"string"==typeof e||"function"==typeof e||e instanceof HTMLElement||(0,l.y8)(e)?e:(B.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,i,r){"string"!=typeof e?Array.isArray(e)&&(t.popupElements=e.filter((e=>H.includes(e.type))).map((e=>e&&e.toJSON(r))),t.popupElements.forEach((e=>{"attachments"===e.type?this._writeAttachmentContent(t):"media"===e.type?this._writeMediaContent(e,t):"text"===e.type&&this._writeTextContent(e,t)}))):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const i=n?n.filter((e=>"fields"===e.type)):[],s=i.length&&i.every((e=>e.fieldInfos?.length));t.fieldInfos=e.filter(Boolean).map((e=>{const t=e.toJSON(r);return s&&(t.visible=!1),t}))}if(n)for(const e of n)"fields"===e.type&&this._writeFieldsContent(e,t)}writeLayerOptions(e,t,i,r){t[i]=!e||null===e.showNoDataRecords&&null===e.returnTopmostRaster?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?(0,o.d9)(e.toArray()):[];return new L({actions:t,content:Array.isArray(this.content)?(0,o.d9)(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?(0,o.d9)(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?(0,o.d9)(this.fieldInfos):null,layerOptions:this.layerOptions?(0,o.d9)(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?(0,o.d9)(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?(0,o.d9)(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),(0,m.gd)(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=(0,o.d9)(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach((e=>{const i=t.fieldInfos.find((t=>t.fieldName.toLowerCase()===e.fieldName.toLowerCase()));i?i.visible=!0:t.fieldInfos.push(e)})):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=(0,o.d9)(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:i}){const r={description:!1,mediaInfos:!1};return i.map((i=>"media"===i.type?(i.mediaInfos||!t||r.mediaInfos||(i.mediaInfos=t,r.mediaInfos=!0),w.Z.fromJSON(i)):"text"===i.type?(i.text||!e||r.description||(i.text=e,r.description=!0),x.Z.fromJSON(i)):"attachments"===i.type?g.Z.fromJSON(i):"fields"===i.type?b.Z.fromJSON(i):"expression"===i.type?v.Z.fromJSON(i):void 0)).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i}){const r=[];return e?r.push(new x.Z({text:e})):r.push(new b.Z),Array.isArray(t)&&t.length&&r.push(w.Z.fromJSON({mediaInfos:t})),i&&r.push(g.Z.fromJSON({displayType:"auto"})),r.length?r:e}_getContentElementFields(e){const t=e?.type;if("attachments"===t)return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if("custom"===t)return e.outFields||[];if("fields"===t)return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if("media"===t){const t=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...t.reduce(((e,t)=>[...e,...this._getMediaInfoFields(t)]),[])]}return"text"===t?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n=[],normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,u=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n];return o&&u.push(o),a&&u.push(a),u}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce(((e,t)=>[...e,..."expression"===t.type&&t.expressionInfo?[t.expressionInfo]:[]]),t):[]}_getContentFields(e){return"string"==typeof e?this._extractFieldNames(e):Array.isArray(e)?e.reduce(((e,t)=>[...e,...this._getContentElementFields(t)]),[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map((i=>(0,m.io)(e,t,i.expression))))}_getFieldInfoFields(e){return e?e.filter((e=>void 0===e.visible||!!e.visible)).map((e=>e.fieldName)).filter((e=>!e.includes("relationships/")&&!e.includes("expression/"))):[]}_getActionsFields(e){return e?e.toArray().reduce(((e,t)=>[...e,...this._getActionFields(t)]),[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s="button"===r||"toggle"===r?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return"string"==typeof e?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||"string"!=typeof e)return[];const t=e.match(/{[^}]*}/g);if(!t)return[];const i=/\{(\w+):.+\}/,r=t.filter((e=>!(0===e.indexOf("{relationships/")||0===e.indexOf("{expression/")))).map((e=>e.replace(i,"{$1}")));return r?r.map((e=>e.slice(1,-1))):[]}};(0,r._)([(0,c.Cb)({type:U})],j.prototype,"actions",void 0),(0,r._)([(0,c.Cb)()],j.prototype,"content",void 0),(0,r._)([(0,u.p)("content")],j.prototype,"castContent",null),(0,r._)([(0,h.r)("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],j.prototype,"readContent",null),(0,r._)([(0,p.c)("content",{popupElements:{type:s.Z.ofType(C)},showAttachments:{type:Boolean},mediaInfos:{type:s.Z.ofType(D.V)},description:{type:String}})],j.prototype,"writeContent",null),(0,r._)([(0,c.Cb)({type:[S.Z],json:{write:!0}})],j.prototype,"expressionInfos",void 0),(0,r._)([(0,c.Cb)({type:[E.Z]})],j.prototype,"fieldInfos",void 0),(0,r._)([(0,p.c)("fieldInfos")],j.prototype,"writeFieldInfos",null),(0,r._)([(0,c.Cb)({type:M})],j.prototype,"layerOptions",void 0),(0,r._)([(0,p.c)("layerOptions")],j.prototype,"writeLayerOptions",null),(0,r._)([(0,c.Cb)({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],j.prototype,"lastEditInfoEnabled",void 0),(0,r._)([(0,c.Cb)()],j.prototype,"outFields",void 0),(0,r._)([(0,c.Cb)()],j.prototype,"overwriteActions",void 0),(0,r._)([(0,c.Cb)()],j.prototype,"returnGeometry",void 0),(0,r._)([(0,c.Cb)({json:{type:String}})],j.prototype,"title",void 0),(0,r._)([(0,p.c)("title")],j.prototype,"writeTitle",null),(0,r._)([(0,c.Cb)({type:I,json:{write:!0}})],j.prototype,"relatedRecordsInfo",void 0),j=L=(0,r._)([(0,d.j)(z)],j);const G=j},37956:(e,t,i)=>{"use strict";i.d(t,{Z:()=>m});var r,s=i(36663),n=i(82064),o=i(61681),a=i(807),l=i(81977),c=(i(7753),i(39994),i(7283),i(34248)),u=i(40266),h=i(39835);let d=r=class extends n.wq{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return p}static get empty(){return f}readEnd(e,t){return null!=t.end?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(r.allTime)}get isEmpty(){return this.equals(r.empty)}readStart(e,t){return null!=t.start?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new r({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=(0,o.pC)(this.start)?this.start.getTime():this.start,i=(0,o.pC)(this.end)?this.end.getTime():this.end,r=(0,o.pC)(e.start)?e.start.getTime():e.start,s=(0,o.pC)(e.end)?e.end.getTime():e.end;return t===r&&i===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=(0,o.yw)(this.start,(t=>(0,a.JE)(t,e))),i=(0,o.yw)(this.end,(t=>(0,a.Nm)((0,a.JE)(t,e),1,e)));return new r({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return r.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=(0,o.R2)(this.start,-1/0,(e=>e.getTime())),i=(0,o.R2)(this.end,1/0,(e=>e.getTime())),s=(0,o.R2)(e.start,-1/0,(e=>e.getTime())),n=(0,o.R2)(e.end,1/0,(e=>e.getTime()));let a,l;if(s>=t&&s<=i?a=s:t>=s&&t<=n&&(a=t),i>=s&&i<=n?l=i:n>=t&&n<=i&&(l=n),!isNaN(a)&&!isNaN(l)){const e=new r;return e.start=a===-1/0?null:new Date(a),e.end=l===1/0?null:new Date(l),e}return r.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new r,{start:s,end:n}=this;return(0,o.pC)(s)&&(i.start=(0,a.Nm)(s,e,t)),(0,o.pC)(n)&&(i.end=(0,a.Nm)(n,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return p.clone();const t=(0,o.pC)(this.start)&&(0,o.pC)(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=(0,o.pC)(this.end)&&(0,o.pC)(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new r({start:t,end:i})}};(0,s._)([(0,l.Cb)({type:Date,json:{write:{allowNull:!0}}})],d.prototype,"end",void 0),(0,s._)([(0,c.r)("end")],d.prototype,"readEnd",null),(0,s._)([(0,h.c)("end")],d.prototype,"writeEnd",null),(0,s._)([(0,l.Cb)({readOnly:!0,json:{read:!1}})],d.prototype,"isAllTime",null),(0,s._)([(0,l.Cb)({readOnly:!0,json:{read:!1}})],d.prototype,"isEmpty",null),(0,s._)([(0,l.Cb)({type:Date,json:{write:{allowNull:!0}}})],d.prototype,"start",void 0),(0,s._)([(0,c.r)("start")],d.prototype,"readStart",null),(0,s._)([(0,h.c)("start")],d.prototype,"writeStart",null),d=r=(0,s._)([(0,u.j)("esri.TimeExtent")],d);const p=new d,f=new d({start:void 0,end:void 0}),m=d},74589:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r,s=i(36663),n=i(82064),o=i(807),a=i(81977),l=(i(7753),i(39994),i(7283),i(40266)),c=i(80680);let u=r=class extends n.wq{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return(0,o.rJ)(this.value,this.unit,"milliseconds")}clone(){return new r({value:this.value,unit:this.unit})}};(0,s._)([(0,a.Cb)({type:Number,json:{write:!0},nonNullable:!0})],u.prototype,"value",void 0),(0,s._)([(0,a.Cb)({type:c.v.apiValues,json:{type:c.v.jsonValues,read:c.v.read,write:c.v.write},nonNullable:!0})],u.prototype,"unit",void 0),u=r=(0,s._)([(0,l.j)("esri.TimeInterval")],u);const h=u},30359:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});class r{constructor(e,t){this.definition=null,this.context=null,this.definition=e,this.context=t}}},58830:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});class r{constructor(e=[]){this._elements=e}length(){return this._elements.length}get(e){return this._elements[e]}toArray(){const e=[];for(let t=0;t<this.length();t++)e.push(this.get(t));return e}}},46001:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var r=i(58830),s=i(8965);class n extends r.Z{constructor(e,t,i,r,s){super(e),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=i,this._hasM=r,this._spRef=t,this._cacheId=s}get(e){if(void 0===this._lazyPath[e]){const t=this._elements[e];if(void 0===t)return;this._lazyPath[e]=new s.Z(t,this._spRef,this._hasZ,this._hasM,this._cacheId,e)}return this._lazyPath[e]}equalityTest(e){return e===this||null!==e&&e instanceof n!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}},8965:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var r=i(58830),s=i(53446);class n extends r.Z{constructor(e,t,i,r,s,n){super(e),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=t,this._hasZ=i,this._hasM=r,this._cacheId=s,this._partId=n}get(e){if(void 0===this._lazyPt[e]){const t=this._elements[e];if(void 0===t)return;const i=this._hasZ,r=this._hasM;let n=null;n=i&&!r?new s.Z(t[0],t[1],t[2],void 0,this._spRef):r&&!i?new s.Z(t[0],t[1],void 0,t[2],this._spRef):i&&r?new s.Z(t[0],t[1],t[2],t[3],this._spRef):new s.Z(t[0],t[1],this._spRef),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+e.toString(),this._lazyPt[e]=n}return this._lazyPt[e]}equalityTest(e){return e===this||null!==e&&e instanceof n!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}},68673:(e,t,i)=>{"use strict";i.d(t,{Bj:()=>r,EI:()=>f,HD:()=>u,JW:()=>l,Lz:()=>g,Qk:()=>_,SV:()=>m,Sh:()=>c,US:()=>w,dj:()=>s,hd:()=>x,hj:()=>h,q2:()=>v,tI:()=>y,tt:()=>p,yE:()=>b});var r,s,n,o=i(91772),a=i(12512);function l(e){return a.Z.fromJSON(e.toJSON())}function c(e){return e.toJSON?e.toJSON():e}function u(e){return"string"==typeof e||e instanceof String}function h(e){return"number"==typeof e}function d(e){return e instanceof Date}function p(e,t){return e===t||!(!d(e)||!d(t))&&e.getTime()===t.getTime()}function f(e){if(void 0===e)return null;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function m(e){if(null===e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new o.Z({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function g(e){if(void 0===e)return null;if("number"==typeof e)return e;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(n=r||(r={}))[n.Standardised=0]="Standardised",n[n.StandardisedNoInterval=1]="StandardisedNoInterval",n[n.SqlServer=2]="SqlServer",n[n.Oracle=3]="Oracle",n[n.Postgres=4]="Postgres",n[n.PGDB=5]="PGDB",n[n.FILEGDB=6]="FILEGDB",n[n.NotEvaluated=7]="NotEvaluated",function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(s||(s={}));const y=1e3,_={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},v={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},b={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function w(e){return void 0===e?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function x(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const i="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(s=t.cmp,function(e){return function(t,i){const r={key:t,value:e[t]},n={key:i,value:e[i]};return s(r,n)}});var s;const n=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let s,o;if(Array.isArray(t)){for(o="[",s=0;s<t.length;s++)s&&(o+=","),o+=e(t[s])||"null";return o+"]"}if(null===t)return"null";if(n.includes(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const a=n.push(t)-1,l=Object.keys(t).sort(r&&r(t));for(o="",s=0;s<l.length;s++){const i=l[s],r=e(t[i]);r&&(o&&(o+=","),o+=JSON.stringify(i)+":"+r)}return n.splice(a,1),"{"+o+"}"}(e)}},36567:(e,t,i)=>{"use strict";i.d(t,{V:()=>u,b:()=>c});var r=i(51366),s=i(66341),n=i(70375),o=i(13802),a=i(3466);const l=o.Z.getLogger("esri.assets");function c(e,t){return(0,s.default)(u(e),t)}function u(e){if(!r.Z.assetsPath)throw l.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new n.Z("assets:path-not-set","config.assetsPath is not set");return(0,a.v_)(r.Z.assetsPath,e)}},33803:(e,t,i)=>{"use strict";i.d(t,{B:()=>r,a:()=>s,b:()=>y,c:()=>g});var r,s,n,o=i(61681),a=i(23998),l=i(61296),c=i(73721),u=i(78541),h=i(43036),d=i(24603),p=i(23410),f=i(3961),m=i(15176);function g(e){const t=new f.kG,i=e.output===r.GridOnly,n=e.output===r.GridComposite,g=n||i,y=e.output===r.ColorOnly,_=e.output===r.ColorComposite,v=_||y,b=n||_;if(t.include(c.T),v&&t.fragment.uniforms.add(new h.J("backgroundColor",(e=>e.backgroundColor))),e.baseOpacityMode!==s.One&&t.fragment.uniforms.add(new d.p("baseOpacity",(e=>e.baseOpacity))),g&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(l.H)),i||y)return t.fragment.code.add(p.H`
    void main() {
      gl_FragColor = ${y?p.H`vec4(backgroundColor, 1.0)`:p.H`gridColor(uv)`};
    }
  `),t;const w=e.blendMode!==a.iM.Normal,x=e.baseOpacityMode===s.OnBaseLayer,C=e.baseOpacityMode===s.OnBackground||e.baseOpacityMode===s.OnBaseLayer,T=e.premultipliedSource;return t.fragment.uniforms.add(new m.A("tex",(e=>e.texture))),t.fragment.uniforms.add(new d.p("opacity",(e=>e.opacity))),(w||x||T)&&(t.fragment.uniforms.add(new m.A("fboColor",(e=>e.fboTexture))),t.fragment.uniforms.add(new d.p("tileSize",(e=>(0,o.pC)(e.fboTexture)?e.fboTexture.descriptor.width:1)))),t.fragment.include(u.d,e),t.fragment.code.add(p.H`
    void main() {
      ${b||x||T?p.H`
      vec4 bgColor = ${_?p.H`vec4(backgroundColor, 1.0)`:n?p.H`gridColor(uv)`:p.H`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${C?p.H`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${w?p.H`
          vec4 fboTex = ${b?p.H`bgColor;`:p.H`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${x?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:p.H`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${T?p.H`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:b||x?p.H`mix(bgColor, pmColorLayer, composeAlpha);`:p.H`pmColorLayer * composeAlpha;`}`}
    }
  `),t}(n=r||(r={}))[n.Composite=0]="Composite",n[n.ColorOnly=1]="ColorOnly",n[n.GridOnly=2]="GridOnly",n[n.ColorComposite=3]="ColorComposite",n[n.GridComposite=4]="GridComposite",n[n.COUNT=5]="COUNT",function(e){e[e.One=0]="One",e[e.OnBackground=1]="OnBackground",e[e.OnBaseLayer=2]="OnBaseLayer",e[e.COUNT=3]="COUNT"}(s||(s={}));const y=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return r},get BaseOpacityMode(){return s},build:g},Symbol.toStringTag,{value:"Module"}))},53737:(e,t,i)=>{"use strict";i.d(t,{C:()=>w,b:()=>v});var r=i(24455),s=i(39100),n=i(82082),o=i(6665),a=i(76203),l=i(93072),c=i(74001),u=i(43036),h=i(96371),d=i(62869),p=i(39820),f=i(23410),m=i(87621),g=i(3961),y=i(57663),_=i(21414);function v(e){const t=new g.kG;t.attributes.add(_.T.POSITION,"vec2"),t.include(n.D,{textureCoordinateType:n.N.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:s}=t;return i.uniforms.add([new m.g("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new m.g("inverseViewMatrix",((e,t)=>(0,r.a)(b,t.camera.viewMatrix)))]),i.code.add(f.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),s.uniforms.add([new u.J("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection)),new c.e("radii"),new p.d("scaleHeight"),new h.K("cameraPosition"),new d.y("heightParameters"),new p.d("innerFadeDistance"),new p.d("altitudeFade"),new y.Q("depthTex"),new h.K("betaRayleigh"),new h.K("betaCombined"),new p.d("betaMie"),new p.d("hazeStrength")]),t.include(a.D),e.haze&&(s.include(o.S),s.uniforms.add(new l.A("nearFar",((e,t)=>t.camera.nearFar)))),s.code.add(f.H`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),s.code.add(f.H`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),s.code.add(f.H`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),s.code.add(f.H`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?f.H`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?f.H``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":f.H`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?f.H`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:f.H`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?f.H`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:f.H`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?f.H`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:f.H`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":f.H`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const b=(0,s.c)(),w=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},11547:(e,t,i)=>{"use strict";i.d(t,{C:()=>d,a:()=>f,b:()=>p});var r=i(34344),s=i(25853),n=i(43175),o=i(41383),a=i(39820),l=i(23410),c=i(55784),u=i(3961),h=i(57663);class d extends l.K{constructor(){super(...arguments),this.viewMatrix=(0,r.c)()}}function p(e){const t=new u.kG;return t.include(o.k,!1),t.fragment.uniforms.add(new a.d("cloudRadius")),t.fragment.uniforms.add(new a.d("halfCubeMapSize")),t.fragment.uniforms.add(new a.d("power")),t.fragment.uniforms.add(new a.d("sigmaE")),t.fragment.uniforms.add(new a.d("density")),t.fragment.uniforms.add(new a.d("cloudSize")),t.fragment.uniforms.add(new a.d("detailSize")),t.fragment.uniforms.add(new a.d("smoothness")),t.fragment.uniforms.add(new a.d("cloudHeight")),t.fragment.uniforms.add(new a.d("coverage")),t.fragment.uniforms.add(new c.j("view",(e=>e.viewMatrix))),t.fragment.uniforms.add(new h.Q("cloudShapeTexture")),t.fragment.code.add(l.H`
    const int STEPS = ${e.steps===s.p.SIXTEEN?l.H`16`:e.steps===s.p.HUNDRED?l.H`100`:l.H`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(l.H`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${l.H.float(n.IQ)};
      const float dataWidth = ${l.H.float(n.IQ)};
      const float tileRows = ${l.H.float(n.jy)};
      const vec3 atlasDimensions = vec3(${l.H.float(n.I_)}, ${l.H.float(n.I_)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${l.H.float(n.kR)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${l.H.float(n.QZ)} * p) / ${l.H.float(n.IQ)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),t.fragment.code.add(l.H`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(l.H`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add("\n    vec3 multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation = 1.0;\n      float contribution = 1.0;\n      float phaseAttenuation = 1.0;\n      vec3 luminance = vec3(0);\n\n      for (int i = 0; i < 4; i++) {\n        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *= 0.2;\n        contribution *= 0.6;\n        phaseAttenuation *= 0.5;\n      }\n\n      return luminance;\n    }"),t.fragment.code.add(l.H`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(l.H`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(l.H`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}const f=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:d,build:p},Symbol.toStringTag,{value:"Module"}))},35127:(e,t,i)=>{"use strict";i.d(t,{C:()=>b,b:()=>_});var r=i(24455),s=i(39100),n=i(77787),o=i(76203),a=i(58749),l=i(3864),c=i(95509),u=i(86589),h=i(32394),d=i(9794),p=i(43036),f=i(23410),m=i(87621),g=i(3961),y=i(21414);function _(){const e=new g.kG;e.attributes.add(y.T.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:i}=e;return t.uniforms.add([new m.g("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new m.g("inverseViewMatrix",((e,t)=>(0,r.a)(v,t.camera.viewMatrix)))]),t.code.add(f.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(h.Y),i.include(d.n),e.include(n._,{pbrMode:l.f7.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(c.e),e.include(o.D),e.include(a.k,{isGround:!1}),e.include(u.j,{instancedDoublePrecision:!1,isGround:!1}),i.uniforms.add([new p.J("cameraPosition",((e,t)=>t.camera.eye))]),i.code.add(f.H`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const v=(0,s.c)(),b=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},50152:(e,t,i)=>{"use strict";i.d(t,{C:()=>b,b:()=>v});var r=i(25714),s=i(5885),n=i(4731),o=i(6502),a=i(59004),l=i(55994),c=i(73393),u=i(44391),h=i(32394),d=i(84614),p=i(93072),f=i(63371),m=i(23410),g=i(3961),y=i(70984),_=i(21414);function v(e){const t=new g.kG,i=e.output===r.H.Depth,v=e.hasMultipassTerrain&&(e.output===r.H.Color||e.output===r.H.Alpha);(0,d.S)(t,e),t.include(n.w,{hasModelTransformation:!1,linearDepth:i}),t.include(o.c,e),t.attributes.add(_.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),v&&t.varyings.add("depth","float");const{vertex:b,fragment:w}=t;return i&&(t.include(a.F,e),b.uniforms.add(new p.A("nearFar",((e,t)=>t.camera.nearFar))),t.varyings.add("linearDepth","float")),b.code.add(m.H`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${v?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?m.H`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:m.H`transformPosition(proj, view, vpos);`}
    }
  `),t.include(s.f5,e),v&&t.include(c.l,e),w.include(h.Y),w.uniforms.add(new f.N("eColor",(e=>e.color))),e.output===r.H.Highlight&&t.include(l.bA),w.code.add(m.H`
  void main() {
    discardBySlice(vpos);
    ${v?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${m.H.float(u.b)}) {
      discard;
    }

    ${e.output===r.H.Alpha?m.H`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===r.H.Color?m.H`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===y.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===r.H.Highlight?m.H`outputHighlight();`:""};
    ${e.output===r.H.Depth?m.H`outputDepth(linearDepth);`:""};
  }
  `),t}const b=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},9004:(e,t,i)=>{"use strict";i.d(t,{C:()=>H,a:()=>V,b:()=>z,g:()=>B});var r=i(14260),s=i(9812),n=i(68848),o=i(22919),a=i(98135),l=i(95650),c=i(25714),u=i(5885),h=i(90511),d=i(82082),p=i(6502),f=i(78549),m=i(62295),g=i(59004),y=i(55994),_=i(6665),v=i(16220),b=i(3417),w=i(91489),x=i(24623),C=i(73393),T=i(3864),S=i(14351),E=i(45416),A=i(97582),M=i(44391),O=i(41272),R=i(94283),P=i(43036),I=i(24603),L=i(23410),D=i(67948),N=i(3961),F=i(15176),k=i(70984),U=i(21414);const V=new Map([[U.T.POSITION,0],[U.T.NORMAL,1],[U.T.NORMALCOMPRESSED,1],[U.T.COLOR,2],[U.T.UV0,3],[U.T.UVREGION,4],[U.T.COMPONENTINDEX,5]]);function z(e){const t=new N.kG;t.include(m.up,e),t.include(f.Bb,e),t.include(p.c,e),t.include(d.D,e),t.include(l.q,e),t.include(o.AD,e),t.include(O.o,e),t.include(u.P_,e),t.include(S.s,e),t.include(a.z,e);const{vertex:i,fragment:s}=t;s.uniforms.add(new D.B("view")),e.pbrMode!==T.f7.Normal&&e.pbrMode!==T.f7.Schematic||(t.include(T.jV,e),e.hasNormalTexture&&t.include(b.Q,e)),e.output===c.H.Shadow&&e.componentData===o._N.Varying?i.code.add(L.H`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(L.H`#define discardShadows(castShadows) {}`);const U=e.integratedMeshMode===n.OH.ColorOverlay||e.integratedMeshMode===n.OH.ColorOverlayWithWater,V=U&&e.output===c.H.Color&&e.pbrMode===T.f7.WaterOnIntegratedMesh;return U&&(t.include(x.X,e),t.include(A.WB,e),e.spherical?i.code.add(L.H`
      const float invEllipsoidRadius = ${L.H.float(1/(e.ellipsoidMode===R.U.Earth?r.sv.radius:e.ellipsoidMode===R.U.Mars?r.yr.radius:r.Z1.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(L.H`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),V&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),i.code.add(L.H`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${L.H.float(M.b)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${V?e.spherical?L.H`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:L.H`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${U?L.H`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===c.H.Alpha&&(s.include(_.S),t.include(C.l,e),t.include(v.P,e),U&&s.uniforms.add(new F.A("ovColorTex",((e,t)=>(0,A.Tw)(e,t)))),s.code.add(L.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?L.H`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${U?L.H`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===c.H.Color&&(s.include(_.S),t.include(C.l,e),t.include(v.P,e),t.include(w.B,e),t.include(x.X,e),e.receiveShadows?(t.include(E.hb,e),s.code.add(L.H`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):s.code.add(L.H`float evaluateShadow() { return 0.0; }`),U&&s.uniforms.add(new F.A("ovColorTex",((e,t)=>(0,A.Tw)(e,t)))),s.code.add(L.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?L.H`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${U?L.H`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===T.f7.Normal||e.pbrMode===T.f7.Schematic?(s.uniforms.add(new P.J("lightingMainIntensity",((e,t)=>t.lighting.mainLight.intensity))),s.code.add(L.H`
        ${e.pbrMode===T.f7.Normal?L.H`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?s.code.add(L.H`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):s.code.add(L.H`vec3 shadingNormal = normalVertex;`),s.code.add(L.H`${e.spherical?L.H`vec3 normalGround = normalize(positionWorld());`:L.H`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),s.code.add(L.H`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?L.H`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${U?L.H` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?s.code.add(L.H`float shadow = evaluateShadow();`):e.spherical?(s.uniforms.add(new I.p("lightingGlobalFactor",((e,t)=>t.lighting.globalFactor))),s.code.add(L.H`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):s.code.add(L.H`float shadow = 0.0;`),V&&s.uniforms.add(new F.A("ovNormalTex",((e,t)=>B(t)))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),s.code.add(L.H`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),s.code.add(L.H`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${U?L.H` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${V?L.H`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),s.code.add(L.H`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===k.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==c.H.Depth&&e.output!==c.H.Shadow||(t.include(g.F,e),s.code.add(L.H`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===c.H.Normal&&(t.include(w.B,e),s.code.add(L.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===h.h.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===c.H.Highlight&&(t.include(y.bA),s.code.add(L.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${U?L.H`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function B(e){return 0===e.overlays.length?null:e.overlays[s.fu.INNER].getValidTexture(s.NH.Water)}const H=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:V,build:z,getOverlayNormalTexture:B},Symbol.toStringTag,{value:"Module"}))},73487:(e,t,i)=>{"use strict";i.d(t,{C:()=>h,a:()=>p,b:()=>d});var r=i(27755),s=i(41383),n=i(24603),o=i(59842),a=i(23410),l=i(3961),c=i(15176),u=i(42199);class h extends a.K{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function d(e){const t=new l.kG;t.include(s.k);const i=t.fragment;switch(e.function){case u.v3.Standard:i.uniforms.add(new c.A("tex",(e=>e.texture))),e.hasOpacityFactor?(i.uniforms.add(new n.p("opacity",(e=>e.opacity))),i.code.add(a.H`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):i.code.add(a.H`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case u.v3.OverlayWithTransparency:i.uniforms.add(new c.A("tex",(e=>e.texture))),i.uniforms.add(new o._("overlayIdx",(e=>e.overlayIndex))),e.hasOpacityFactor&&i.uniforms.add(new n.p("opacity",(e=>e.opacity))),i.code.add(a.H`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
        }`);break;case u.v3.TransparentToHUDVisibility:i.uniforms.add(new c.A("tex",(e=>e.texture))),i.code.add(a.H`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case u.v3.Transparency:i.uniforms.add([new c.A("colorTexture",(e=>e.colorTexture)),new c.A("alphaTexture",(e=>e.alphaTexture)),new c.A("frontFaceTexture",(e=>e.frontFaceTexture))]),i.code.add(a.H`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case u.v3.COUNT:break;default:(0,r.Bg)(e.function)}return t}const p=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:h,build:d},Symbol.toStringTag,{value:"Module"}))},45584:(e,t,i)=>{"use strict";i.d(t,{D:()=>G,b:()=>j});var r=i(61681),s=i(39100),n=i(95650),o=i(57218),a=i(25714),l=i(5885),c=i(4731),u=i(99163),h=i(90511),d=i(91636),p=i(92835),f=i(82082),m=i(6502),g=i(78549),y=i(77700),_=i(77546),v=i(3417),b=i(30786),w=i(24623),x=i(73393),C=i(2833),T=i(89585),S=i(3864),E=i(45416),A=i(12664),M=i(44391),O=i(41272),R=i(78115),P=i(27452),I=i(84614),L=i(43036),D=i(63371),N=i(24603),F=i(23410),k=i(87621),U=i(3961),V=i(15176),z=i(70984),B=i(21414),H=i(39501);function j(e){const t=new U.kG,i=t.vertex.code,j=t.fragment.code;t.include(R.a,{name:"Default Material Shader",output:e.output});const G=(0,I.S)(t,e);return t.include(d.f),t.varyings.add("vpos","vec3"),t.include(A.k,e),t.include(u.f,e),t.include(y.L,e),e.output!==a.H.Color&&e.output!==a.H.Alpha||((0,I.h)(t.vertex,e),t.include(h.O,e),t.include(c.w,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===h.h.Attribute&&e.offsetBackfaces&&t.include(o.w),t.include(v.Q,e),t.include(g.Bb,e),e.instancedColor&&t.attributes.add(B.T.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(f.D,e),t.include(n.q,e),t.include(p.R,e),t.include(m.c,e),t.vertex.uniforms.add(new D.N("externalColor",(e=>e.externalColor))),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new k.g("model",(e=>(0,r.pC)(e.modelTransformation)?e.modelTransformation:s.I))),i.add(F.H`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${F.H.float(M.b)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===h.h.Attribute?F.H`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===h.h.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===a.H.Alpha&&(t.include(l.f5,e),t.include(O.z,e),t.include(x.l,e),t.fragment.uniforms.add([new N.p("opacity",(e=>e.opacity)),new N.p("layerOpacity",(e=>e.layerOpacity))]),e.hasColorTexture&&t.fragment.uniforms.add(new V.A("tex",(e=>e.texture))),t.fragment.include(P.y),j.add(F.H`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?F.H`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:F.H`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?F.H`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:F.H`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===a.H.Color&&(t.include(l.f5,e),t.include(w.X,e),t.include(b.K,e),t.include(O.z,e),t.include(e.instancedDoublePrecision?E.hb:E.XE,e),t.include(x.l,e),(0,I.h)(t.fragment,e),t.fragment.uniforms.add([G,new L.J("ambient",(e=>e.ambient)),new L.J("diffuse",(e=>e.diffuse)),new N.p("opacity",(e=>e.opacity)),new N.p("layerOpacity",(e=>e.layerOpacity)),new N.p("lightingGlobalFactor",((e,t)=>t.lighting.globalFactor)),new L.J("lightingMainIntensity",((e,t)=>t.lighting.mainLight.intensity))]),t.fragment.constants.add("ambientBoostFactor","float",H.V),e.hasColorTexture&&t.fragment.uniforms.add(new V.A("tex",(e=>e.texture))),t.include(S.jV,e),t.include(T.T,e),t.fragment.include(P.y),t.include(C.k,e),j.add(F.H`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?F.H`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:F.H`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===h.h.ScreenDerivative?F.H`
                vec3 normal = screenDerivativeNormal(localvpos);`:F.H`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===S.f7.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?F.H`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:F.H`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?F.H`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:F.H`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?F.H`normalize(vpos + localOrigin);`:F.H`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?F.H`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===S.f7.Normal||e.pbrMode===S.f7.Schematic?F.H`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?F.H`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:F.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===z.Am.Color?F.H`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(_.s,e),t}const G=Object.freeze(Object.defineProperty({__proto__:null,build:j},Symbol.toStringTag,{value:"Module"}))},94721:(e,t,i)=>{"use strict";i.d(t,{E:()=>T,b:()=>x});var r=i(55709),s=i(69666),n=i(5885),o=i(73393),a=i(93072),l=i(63371),c=i(24603),u=i(23410),h=i(67948),d=i(3961),p=i(21414),f=i(62467),m=i(57057),g=i(63922),y=i(70239),_=i(37630),v=i(99e3),b=i(50297),w=i(25926);function x(e){const t=new d.kG,i=t.vertex,s=t.fragment;return e.legacy&&i.uniforms.add(new h.B("model")),e.antialiasing&&(i.code.add(u.H`#define ANTIALIASING 1`),s.code.add(u.H`#define ANTIALIASING 1`)),t.include(f.g,e),t.include(_.UR,e),t.include(v.B,e),t.include(w.H,e),t.include(b.N,e),t.include(n.f5,e),t.include(g.o,e),t.include(m.S,e),t.include(y.l,e),t.include(o.l,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new a.A("pixelToNDC",((e,t)=>(0,r.a)(C,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])))),i.uniforms.add(new l.N("viewport",((e,t)=>t.camera.fullViewport))),i.uniforms.add(new c.p("pixelRatio",((e,t)=>t.camera.pixelRatio))),t.attributes.add(p.T.POSITION0,"vec3"),t.attributes.add(p.T.POSITION1,"vec3"),t.attributes.add(p.T.VARIANTOFFSET,"float"),t.attributes.add(p.T.VARIANTSTROKE,"float"),t.attributes.add(p.T.VARIANTEXTENSION,"float"),i.code.add(u.H`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(u.H`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const C=(0,s.a)(),T=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}))},28539:(e,t,i)=>{"use strict";i.d(t,{F:()=>_,b:()=>g});var r=i(24455),s=i(39100),n=i(82082),o=i(6665),a=i(76203),l=i(93072),c=i(96371),u=i(39820),h=i(23410),d=i(87621),p=i(3961),f=i(57663),m=i(21414);function g(e){const t=new p.kG;t.attributes.add(m.T.POSITION,"vec2"),t.include(n.D,{textureCoordinateType:n.N.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:s}=t;return i.uniforms.add([new d.g("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new d.g("inverseViewMatrix",((e,t)=>(0,r.a)(y,t.camera.viewMatrix)))]),i.code.add(h.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),s.uniforms.add(new u.d("atmosphereC")),s.uniforms.add(new c.K("cameraPosition")),s.uniforms.add(new l.A("nearFar",((e,t)=>t.camera.nearFar))),s.uniforms.add(new f.Q("depthTex")),s.uniforms.add(new u.d("fogStrength")),s.uniforms.add(new u.d("fogAmount")),s.uniforms.add(new c.K("fogColor")),t.include(a.D),s.include(o.S),s.code.add(h.H`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),s.code.add(h.H`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),s.code.add(h.H`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?h.H`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const y=(0,s.c)(),_=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}))},56444:(e,t,i)=>{"use strict";i.d(t,{H:()=>D,b:()=>R,c:()=>I});var r=i(61681),s=i(55709),n=i(69666),o=i(1983),a=i(57741),l=i(25714),c=i(5885),u=i(94728),h=i(21737),d=i(74319),p=i(55994),f=i(12664),m=i(44391),g=i(32394),y=i(9794),_=i(76774),v=i(93072),b=i(63371),w=i(36444),x=i(24603),C=i(40335),T=i(23410),S=i(3961),E=i(15176),A=i(70984),M=i(21414),O=i(67874);function R(e){const t=new S.kG,i=e.signedDistanceFieldEnabled;if(t.include(u.H),t.include(h.R,e),t.include(c.f5,e),e.output===l.H.Occlusion)return t.include(d.R,e),t;const{vertex:R,fragment:D}=t;t.include(_.cK),D.include(y.n),D.include(g.Y),t.include(f.k,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),R.uniforms.add([new b.N("viewport",((e,t)=>t.camera.fullViewport)),new v.A("screenOffset",((e,t)=>(0,s.a)(L,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new v.A("anchorPosition",(e=>I(e))),new b.N("materialColor",(e=>e.color)),new x.p("pixelRatio",((e,t)=>t.camera.pixelRatio))]),i&&(R.uniforms.add(new b.N("outlineColor",(e=>e.outlineColor))),D.uniforms.add([new b.N("outlineColor",(e=>P(e)?e.outlineColor:o.Z)),new x.p("outlineSize",(e=>P(e)?e.outlineSize:0))])),e.hasScreenSizePerspective&&((0,_.ww)(R),(0,_.m8)(R)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(M.T.UV0,"vec2"),t.attributes.add(M.T.COLOR,"vec4"),t.attributes.add(M.T.SIZE,"vec2"),t.attributes.add(M.T.AUXPOS2,"vec4"),R.code.add(T.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?T.H`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:T.H`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const N=T.H`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,F=e.pixelSnappingEnabled?i?T.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:T.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:T.H`posProj += quadOffset;`;e.vvColor&&R.uniforms.add([new w.b("vvColorColors",(e=>e.vvColorColors),O.x),new C.O("vvColorValues",(e=>e.vvColorValues),O.x)]),R.uniforms.add(new v.A("textureCoordinateScaleFactor",(e=>(0,r.pC)(e.texture)&&(0,r.pC)(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:n.O))),R.code.add(T.H`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${N}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${T.H.float(m.b)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${T.H.float(m.b)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${F}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?T.H`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),D.uniforms.add(new E.A("tex",(e=>e.texture)));const k=e.debugDrawLabelBorder?T.H`(isBorder > 0.0 ? 0.0 : ${T.H.float(m.F)})`:T.H.float(m.F),U=T.H`
    ${e.debugDrawLabelBorder?T.H`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?T.H`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${T.H.float(a.Ph)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${k} ||
          fillPixelColor.a + outlinePixelColor.a < ${T.H.float(m.b)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${k}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:T.H`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${k}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?T.H`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===l.H.Alpha&&D.code.add(T.H`
      void main() {
        ${U}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===l.H.Color&&D.code.add(T.H`
    void main() {
      ${U}
      ${e.transparencyPassType===A.Am.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===l.H.Highlight&&(t.include(p.bA),D.code.add(T.H`
    void main() {
      ${U}
      ${e.binaryHighlightOcclusionEnabled?T.H`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function P(e){return e.outlineColor[3]>0&&e.outlineSize>0}function I(e,t=L){return e.textureIsSignedDistanceField?(i=e.anchorPosition,n=e.distanceFieldBoundingBox,o=t,(0,r.pC)(n)?(0,s.a)(o,i[0]*(n[2]-n[0])+n[0],i[1]*(n[3]-n[1])+n[1]):(0,s.a)(o,0,0)):(0,s.c)(t,e.anchorPosition),t;var i,n,o}const L=(0,n.a)(),D=Object.freeze(Object.defineProperty({__proto__:null,build:R,calculateAnchorPosForRendering:I},Symbol.toStringTag,{value:"Module"}))},64183:(e,t,i)=>{"use strict";i.d(t,{H:()=>d,b:()=>u});var r=i(88589),s=i(1983),n=i(63371),o=i(23410),a=i(3961),l=i(15176),c=i(21414);function u(){const e=new a.kG,{vertex:t,fragment:i}=e,s=t.code,u=i.code;return e.attributes.add(c.T.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(c.T.UV0,"vec2"),t.uniforms.add(new l.A("coverageTex",(e=>e.coverageTexture))),s.add(o.H`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new l.A("tex",(e=>e.blurColorTexture))),i.uniforms.add(new l.A("origin",(e=>e.highlightColorTexture))),i.uniforms.add(new n.N("uColor",(e=>e.color))),i.uniforms.add(new n.N("haloColor",(e=>e.haloColor))),i.uniforms.add(new n.N("opacities",(e=>(0,r.s)(h,e.haloOpacity,e.haloOpacityOccluded,e.fillOpacity,e.fillOpacityOccluded)))),i.constants.add("outlineSize","float",8.6),i.constants.add("blurSize","float",.4),u.add(o.H`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const h=(0,s.c)(),d=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}))},43930:(e,t,i)=>{"use strict";i.d(t,{H:()=>u,a:()=>d,b:()=>h});var r=i(69666),s=i(26482),n=i(23410),o=i(3961),a=i(37649),l=i(15176),c=i(21414);class u extends n.K{constructor(){super(...arguments),this.blurSize=(0,r.a)()}}function h(){const e=new o.kG,{vertex:t,fragment:i}=e,r=t.code,u=i.code;return e.attributes.add(c.T.POSITION,"vec2"),e.attributes.add(c.T.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new l.A("coverageTex",(e=>e.coverageTexture))),i.uniforms.add(new s.q("blurSize",(e=>e.blurSize))),r.add(n.H`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new a.R("tex",(e=>e.blurInputTexture))),u.add(n.H`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:u,build:h},Symbol.toStringTag,{value:"Module"}))},37738:(e,t,i)=>{"use strict";i.d(t,{H:()=>c,a:()=>h,b:()=>u});var r=i(69666),s=i(26482),n=i(23410),o=i(3961),a=i(37649),l=i(21414);class c extends n.K{constructor(){super(...arguments),this.invFramebufferDim=(0,r.a)()}}function u(){const e=new o.kG,{vertex:t,fragment:i}=e,r=t.code,c=i.code;return e.attributes.add(l.T.POSITION,"vec2"),r.add(n.H`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new a.R("tex",(e=>e.inputTexture))),i.uniforms.add(new s.q("invFramebufferDim",(e=>e.invFramebufferDim))),c.add(n.H`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},1485:(e,t,i)=>{"use strict";i.d(t,{L:()=>w,b:()=>_});var r=i(61681),s=i(55709),n=i(69666),o=i(1983),a=i(5885),l=i(94728),c=i(21737),u=i(32078),h=i(76774),d=i(93072),p=i(63371),f=i(24603),m=i(23410),g=i(3961),y=i(21414);function _(e){const t=new g.kG;t.include(l.H),t.include(c.R,e),t.include(a.f5,e),t.attributes.add(y.T.UV0,"vec2");const{vertex:i,fragment:n}=t;return i.uniforms.add([new p.N("viewport",((e,t)=>t.camera.fullViewport)),new f.p("lineSize",((e,t)=>Math.ceil(e.size)*t.camera.pixelRatio)),new d.A("pixelToNDC",((e,t)=>(0,s.a)(b,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3]))),new f.p("borderSize",((e,t)=>(0,r.pC)(e.borderColor)?t.camera.pixelRatio:0)),new d.A("screenOffset",((e,t)=>(0,s.a)(b,e.screenOffset[0]*t.camera.pixelRatio,e.screenOffset[1]*t.camera.pixelRatio)))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&(0,h.m8)(i),i.code.add(m.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?m.H`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?m.H`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:m.H`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?m.H`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:m.H`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?m.H`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:m.H`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),n.uniforms.add([new p.N("uColor",(e=>v(e.color))),new p.N("borderColor",(e=>v(e.borderColor)))]),e.hasMultipassGeometry&&(n.include(u.S,e),n.uniforms.add(new d.A("inverseViewport",((e,t)=>t.inverseViewport)))),n.code.add(m.H`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?m.H`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:m.H`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function v(e){return(0,r.pC)(e)?e:o.Z}const b=(0,n.a)(),w=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},52331:(e,t,i)=>{"use strict";i.d(t,{a:()=>d});var r,s=i(36663),n=i(30936),o=i(82064),a=i(67134),l=i(81977),c=(i(7283),i(40266)),u=i(50264);let h=r=class extends o.wq{constructor(){super(...arguments),this.color=new n.Z("white")}clone(){return new r({color:(0,a.d9)(this.color)})}};(0,s._)([(0,l.Cb)(u.a)],h.prototype,"color",void 0),h=r=(0,s._)([(0,c.j)("esri.symbols.callouts.LineCallout3DBorder")],h);const d=h;Object.freeze(Object.defineProperty({__proto__:null,default:d},Symbol.toStringTag,{value:"Module"}))},25625:(e,t,i)=>{"use strict";i.d(t,{L:()=>C,b:()=>x});var r=i(59225),s=i(25714),n=i(5885),o=i(65915),a=i(59004),l=i(73393),c=i(44391),u=i(32394),h=i(9794),d=i(84614),p=i(93072),f=i(63371),m=i(24603),g=i(23410),y=i(87621),_=i(3961),v=i(15176),b=i(70984),w=i(21414);function x(e){const t=new _.kG,i=e.hasMultipassTerrain&&(e.output===s.H.Color||e.output===s.H.Alpha);t.include(o.U,e),e.output===s.H.Depth&&t.include(a.F,e);const{vertex:x,fragment:C}=t;return C.include(h.n),(0,d.S)(t,e),t.attributes.add(w.T.POSITION,"vec3"),t.attributes.add(w.T.UV0,"vec2"),t.attributes.add(w.T.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float"),x.code.add(g.H`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),x.uniforms.add([new p.A("nearFar",((e,t)=>t.camera.nearFar)),new f.N("viewport",((e,t)=>t.camera.fullViewport))]),x.code.add(g.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),x.code.add(g.H`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(x.uniforms.add(new y.g("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix))),x.code.add(g.H`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),x.code.add(g.H`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),x.uniforms.add(new m.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),x.code.add(g.H`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),x.uniforms.add(new m.p("pixelRatio",((e,t)=>t.camera.pixelRatio))),x.code.add(g.H`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${g.H.float(r.vT/r.CM)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||x.code.add(g.H`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),x.code.add(g.H`
        ${i?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&t.include(l.l,e),t.include(n.f5,e),C.uniforms.add([new f.N("intrinsicColor",(e=>e.color)),new v.A("tex",(e=>e.texture))]),C.include(u.Y),C.code.add(g.H`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${g.H.float(1/r.vT)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${g.H.float(c.b)}) {
      discard;
    }

    ${e.output===s.H.Alpha?g.H`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===s.H.Color?g.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===s.H.Color&&e.transparencyPassType===b.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===s.H.Highlight?g.H`gl_FragColor = vec4(1.0);`:""}
    ${e.output===s.H.Depth?g.H`outputDepth(linearDepth);`:""}
  }
  `),t}const C=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}))},14179:(e,t,i)=>{"use strict";i.d(t,{N:()=>y,b:()=>g});var r=i(25714),s=i(5885),n=i(4731),o=i(6502),a=i(55994),l=i(37009),c=i(44391),u=i(84614),h=i(63371),d=i(24603),p=i(23410),f=i(3961),m=i(21414);function g(e){const t=new f.kG;t.include(n.w),t.include(o.c,e),t.include(l.q,e),(0,u.S)(t,e);const{vertex:i,fragment:g}=t;return e.stippleEnabled&&(t.attributes.add(m.T.UV0,"vec2"),t.attributes.add(m.T.AUXPOS1,"vec3"),i.uniforms.add(new h.N("viewport",((e,t)=>t.camera.fullViewport)))),t.attributes.add(m.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(p.H`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(p.H`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new d.p("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):i.code.add(p.H`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(p.H`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(p.H`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(p.H`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(p.H`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(p.H`}`),e.output===r.H.Highlight&&t.include(a.bA),t.include(s.f5,e),g.uniforms.add(new d.p("alphaCoverage",((e,t)=>Math.min(1,e.width*t.camera.pixelRatio)))),e.hasVertexColors||g.uniforms.add(new h.N("constantColor",(e=>e.color))),g.code.add(p.H`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${p.H.float(c.b)}) {
      discard;
    }

    ${e.output===r.H.Color?p.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===r.H.Highlight?p.H`outputHighlight();`:""}
  }
  `),t}const y=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}))},3720:(e,t,i)=>{"use strict";i.d(t,{N:()=>u,b:()=>c});var r=i(13696),s=i(43175),n=i(41383),o=i(74001),a=i(23410),l=i(3961);function c(e){const t=new l.kG;if(t.include(n.k,!1),t.fragment.code.add(a.H`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.fragment.uniforms.add(new o.e("weatherTile")),e.mode===r.u.Full){const e=2,i=8;t.fragment.code.add(a.H`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${a.H.float(s.jy)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${a.H.float(i)});

      float worley0 = worley(p, ${a.H.float(e)} * 2.0);
      float worley1 = worley(p, ${a.H.float(e)} * 8.0);
      float worley2 = worley(p, ${a.H.float(e)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${a.H.float(e)});
      float worley1 = worley(p, ${a.H.float(e)} * 2.0);
      float worley2 = worley(p, ${a.H.float(e)} * 4.0);
      float worley3 = worley(p, ${a.H.float(e)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `)}return t.fragment.code.add(a.H`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${a.H.float(s.A)});

      // Get global coordinates of p
      p += weatherTile * ${a.H.float(s.A)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${a.H.float(s.iZ)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(a.H`void main() {`),e.mode===r.u.Full&&t.fragment.code.add(a.H`
        float padWidth = 1.0;
        float paddedSize = ${a.H.float(s.I_)} + 2.0 * padWidth;
        float tileCount = ${a.H.float(s.jy)} * ${a.H.float(s.jy)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${a.H.float(s.I_)};
          }

          if (startPadY) {
            pixel.y += ${a.H.float(s.I_)};
          }

          if (endPadX) {
            pixel.x -= ${a.H.float(s.I_)};
          }

          if (endPadY) {
            pixel.y -= ${a.H.float(s.I_)};
          }

          uv = vec2(pixel.xy / ${a.H.float(s.I_)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${a.H.float(s.I_)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${a.H.float(s.jy)} * ${a.H.float(s.jy)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${a.H.float(s.jy)} * ${a.H.float(s.jy)});
        p = p_;
        p.z /= (${a.H.float(s.jy)} * ${a.H.float(s.jy)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(a.H`
      vec2 mapUV = ${a.H.float(s.A)} * (gl_FragCoord.xy / ${a.H.float(s.IQ)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===r.u.Full?a.H`gl_FragColor.ba = vec2(0.0, map);`:a.H`gl_FragColor = vec4(map);`};
    }
  `),t}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},68490:(e,t,i)=>{"use strict";i.d(t,{P:()=>M,b:()=>A});var r=i(95650),s=i(25714),n=i(5885),o=i(4731),a=i(28881),l=i(59004),c=i(55994),u=i(30786),h=i(24623),d=i(73393),p=i(2833),f=i(37451),m=i(45416),g=i(32394),y=i(84614),_=i(93072),v=i(43036),b=i(62869),w=i(24603),x=i(23410),C=i(87621),T=i(3961),S=i(70984),E=i(39501);function A(e){const t=new T.kG,i=(0,y.S)(t,e),{vertex:A,fragment:M}=t;return t.varyings.add("vpos","vec3"),t.include(a.W,e),e.output!==s.H.Color&&e.output!==s.H.Alpha||(t.include(o.w),t.include(m.XE,e),t.include(r.q,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),A.code.add(x.H`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===s.H.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(d.l,e),e.output===s.H.Alpha&&(t.include(n.f5,e),M.uniforms.add(new w.p("opacity",(e=>e.opacity))),M.code.add(x.H`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===s.H.Color&&(t.include(n.f5,e),t.include(h.X,e),t.include(u.K,e),t.include(m.XE,e),t.include(p.k,e),(0,y.h)(M,e),M.uniforms.add([i,new v.J("ambient",(e=>e.ambient)),new v.J("diffuse",(e=>e.diffuse)),new v.J("specular",(e=>e.specular)),new w.p("opacity",(e=>e.opacity)),new w.p("lightingGlobalFactor",((e,t)=>t.lighting.globalFactor)),new v.J("lightingMainIntensity",((e,t)=>t.lighting.mainLight.intensity))]),M.constants.add("ambientBoostFactor","float",E.V),M.include(g.Y),M.code.add(x.H`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===S.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==s.H.Depth&&e.output!==s.H.Shadow||(t.include(o.w,{hasModelTransformation:!1,linearDepth:!0}),A.uniforms.add(new _.A("nearFar",((e,t)=>t.camera.nearFar))),t.varyings.add("depth","float"),A.code.add(x.H`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(n.f5,e),t.include(l.F,e),M.code.add(x.H`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===s.H.Normal&&(t.include(o.w),t.include(f.n,e),A.uniforms.add(new C.g("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix))),t.varyings.add("vnormal","vec3"),A.code.add(x.H`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(n.f5,e),M.uniforms.add(new b.y("waterColor")),M.code.add(x.H`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===s.H.Highlight&&(t.include(o.w),t.include(f.n,e),t.varyings.add("vnormal","vec3"),A.code.add(x.H`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(n.f5,e),t.include(c.bA),M.code.add(x.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const M=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}))},46076:(e,t,i)=>{"use strict";i.d(t,{P:()=>T,b:()=>C});var r=i(25714),s=i(5885),n=i(4731),o=i(6502),a=i(59004),l=i(55994),c=i(73393),u=i(44391),h=i(32394),d=i(84614),p=i(93072),f=i(63371),m=i(24603),g=i(23410),y=i(3961),_=i(70984),v=i(21414),b=i(9066);const w=.70710678118,x=w;function C(e){const t=new y.kG,i=e.hasMultipassTerrain&&(e.output===r.H.Color||e.output===r.H.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const C=e.output===r.H.Depth,{vertex:T,fragment:S}=t;(0,d.S)(t,e),t.include(n.w,{hasModelTransformation:!1,linearDepth:C}),t.include(o.c,e),C&&(t.include(a.F,e),T.uniforms.add(new p.A("nearFar",((e,t)=>t.camera.nearFar))),t.varyings.add("linearDepth","float")),e.draped?T.uniforms.add(new m.p("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):t.attributes.add(v.T.BOUNDINGRECT,"mat3"),t.attributes.add(v.T.POSITION,"vec3"),t.attributes.add(v.T.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i&&t.varyings.add("depth","float");const E=e.style===b.b.ForwardDiagonal||e.style===b.b.BackwardDiagonal||e.style===b.b.DiagonalCross;return E&&T.code.add(g.H`
      const mat2 rotate45 = mat2(${g.H.float(w)}, ${g.H.float(-x)},
                                 ${g.H.float(x)}, ${g.H.float(w)});
    `),e.draped||((0,d.h)(T,e),T.uniforms.add(new m.p("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),T.code.add(g.H`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),T.code.add(g.H`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),T.code.add(g.H`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${g.H.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),T.code.add(g.H`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${E?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${E?" * rotate45":""};

      ${e.draped?"":g.H`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${g.H.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),T.code.add(g.H`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${C?g.H`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:g.H`transformPosition(proj, view, vpos);`}
    }
  `),t.include(s.f5,e),S.include(h.Y),e.draped&&S.uniforms.add(new m.p("texelSize",((e,t)=>1/t.camera.pixelRatio))),e.output===r.H.Highlight&&t.include(l.bA),i&&t.include(c.l,e),e.output!==r.H.Highlight&&(S.code.add(g.H`
      const float lineWidth = ${g.H.float(e.lineWidth)};
      const float spacing = ${g.H.float(e.patternSpacing)};
      const float spacingINV = ${g.H.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||S.code.add(g.H`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),S.uniforms.add(new f.N("uColor",(e=>e.color))),S.code.add(g.H`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==r.H.Highlight?g.H`color.a *= ${function(e){function t(t){return e.draped?g.H`coverage(vuv.${t}, texelSize)`:g.H`sample(vuv.${t})`}switch(e.style){case b.b.ForwardDiagonal:case b.b.Horizontal:return t("y");case b.b.BackwardDiagonal:case b.b.Vertical:return t("x");case b.b.DiagonalCross:case b.b.Cross:return g.H`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}(e)};`:""}

      if (color.a < ${g.H.float(u.b)}) {
        discard;
      }

      ${e.output===r.H.Alpha?g.H`gl_FragColor = vec4(color.a);`:""}

      ${e.output===r.H.Color?g.H`gl_FragColor = color; ${e.transparencyPassType===_.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===r.H.Highlight?g.H`outputHighlight();`:""}
      ${e.output===r.H.Depth?g.H`outputDepth(linearDepth);`:""};
    }
  `),t}const T=Object.freeze(Object.defineProperty({__proto__:null,build:C},Symbol.toStringTag,{value:"Module"}))},74630:(e,t,i)=>{"use strict";i.d(t,{P:()=>d,b:()=>h});var r=i(15396),s=i(96371),n=i(39820),o=i(23410),a=i(87621),l=i(67948),c=i(3961),u=i(21414);function h(e){const t=new c.kG;return t.attributes.add(u.T.POSITION,"vec3"),t.attributes.add(u.T.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new s.K("cameraPosition")),t.vertex.uniforms.add(new s.K("offset")),t.vertex.uniforms.add(new n.d("width")),t.vertex.uniforms.add(new a.g("proj",((e,t)=>t.camera.projectionMatrix))),t.vertex.uniforms.add(new l.B("view")),t.vertex.uniforms.add(new n.d("time")),t.varyings.add("vUv","vec2"),t.vertex.code.add(o.H`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===r.H.Rain?o.H`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:o.H`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new n.d("opacity")),t.fragment.uniforms.add(new s.K("particleColor")),t.fragment.code.add(o.H`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===r.H.Rain?o.H`d = 0.35 * smoothstep(0.5, 0.0, d);`:o.H`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const d=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},28624:(e,t,i)=>{"use strict";i.d(t,{C:()=>T,R:()=>M,a:()=>S,b:()=>E,c:()=>A});var r=i(61681),s=i(8909),n=i(84342),o=i(23998),a=i(35434),l=i(45979),c=i(61296),u=i(52191),h=i(73721),d=i(33803),p=i(78541),f=i(32394),m=i(71278),g=i(93072),y=i(43036),_=i(24603),v=i(40335),b=i(59842),w=i(23410),x=i(3961),C=i(15176);class T extends l.J{constructor(e,t,i,r,n,o){super(e,r,n),this.colormap=t,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=s.Z,this.fboTexture=null,this.baseOpacity=1}}class S extends T{}class E extends T{}function A(e){const t=new x.kG;t.include(h.T),t.include(l.G),t.include(a.i),e.tileBlendInput===u.R.GridComposite&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(c.H));const i=e.tileBlendInput===u.R.ColorComposite;i&&t.fragment.uniforms.add(new y.J("backgroundColor",(e=>e.backgroundColor))),e.baseOpacityMode!==d.a.One&&t.fragment.uniforms.add(new _.p("baseOpacity",(e=>e.baseOpacity)));const s=e.baseOpacityMode===d.a.OnBaseLayer,T=e.baseOpacityMode===d.a.OnBackground||e.baseOpacityMode===d.a.OnBaseLayer,S=e.blendMode!==o.iM.Normal;t.fragment.include(p.d,e);const E=e.tileBlendInput!==u.R.LayerOnly;return(S&&!E||s)&&(t.fragment.uniforms.add(new C.A("fboColor",(e=>e.fboTexture))),t.fragment.uniforms.add(new _.p("tileSize",(e=>(0,r.pC)(e.fboTexture)?e.fboTexture.descriptor.width:1)))),t.fragment.code.add(w.H`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${E||s?w.H`
          vec4 bgColor = ${s?w.H`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:i?w.H`vec4(backgroundColor, 1.0)`:w.H`gridColor(vuv)`};
          ${T?w.H`bgColor *= baseOpacity;`:""}`:""}
      ${S?w.H`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${E?w.H`bgColor;`:w.H`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${s?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:E||s?w.H`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:w.H`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),e.colorizerType===n.U.Stretch?function(e,t){e.fragment.uniforms.add([new b._("u_bandCount",(e=>e.symbolizer.u_bandCount)),new v.O("u_minCutOff",(e=>e.symbolizer.u_minCutOff),3),new v.O("u_maxCutOff",(e=>e.symbolizer.u_maxCutOff),3),new v.O("u_factor",(e=>e.symbolizer.u_factor),3),new _.p("u_minOutput",(e=>e.symbolizer.u_minOutput)),new _.p("u_maxOutput",(e=>e.symbolizer.u_maxOutput)),new m.U("u_useGamma",(e=>e.symbolizer.u_useGamma)),new v.O("u_gamma",(e=>e.symbolizer.u_gamma),3),new v.O("u_gammaCorrection",(e=>e.symbolizer.u_gammaCorrection),3),new _.p("u_opacity",(e=>e.common.u_opacity))]),e.fragment.code.add(w.H`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?w.H`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:w.H`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(w.H`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===n.H.Noop?w.H`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:w.H`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}(t,e):e.colorizerType===n.U.Lut?t.fragment.code.add(w.H`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):e.colorizerType===n.U.Hillshade&&function(e,t){const i=e.fragment;i.uniforms.add([new C.A("u_image",(e=>e.u_image)),new b._("u_hillshadeType",(e=>e.symbolizer.u_hillshadeType)),new v.O("u_sinZcosAs",(e=>e.symbolizer.u_sinZcosAs),6),new v.O("u_sinZsinAs",(e=>e.symbolizer.u_sinZsinAs),6),new v.O("u_cosZs",(e=>e.symbolizer.u_cosZs),6),new v.O("u_weights",(e=>e.symbolizer.u_weights),6),new g.A("u_factor",(e=>e.symbolizer.u_factor)),new _.p("u_minValue",(e=>e.symbolizer.u_minValue)),new _.p("u_maxValue",(e=>e.symbolizer.u_maxValue)),new g.A("u_srcImageSize",(e=>e.common.u_srcImageSize))]),i.include(f.Y),i.code.add(w.H`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),i.code.add(w.H`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t.applyColormap?w.H`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:w.H`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(w.H`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}(t,e),t}const M=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:T,ColorizerStretchUniforms:S,ColorizerHillshadeUniforms:E,build:A},Symbol.toStringTag,{value:"Module"}))},60926:(e,t,i)=>{"use strict";i.d(t,{R:()=>U,b:()=>k});var r=i(95650),s=i(57218),n=i(25714),o=i(5885),a=i(4731),l=i(99163),c=i(90511),u=i(91636),h=i(92835),d=i(82082),p=i(6502),f=i(77700),m=i(77546),g=i(30786),y=i(24623),_=i(73393),v=i(89585),b=i(3864),w=i(45416),x=i(12664),C=i(44391),T=i(41272),S=i(27452),E=i(84614),A=i(43036),M=i(63371),O=i(24603),R=i(23410),P=i(67948),I=i(3961),L=i(15176),D=i(70984),N=i(21414),F=i(39501);function k(e){const t=new I.kG,i=t.vertex.code,k=t.fragment.code,U=(0,E.S)(t,e);return t.include(u.f),t.varyings.add("vpos","vec3"),t.include(x.k,e),t.include(l.f,e),t.include(f.L,e),e.output!==n.H.Color&&e.output!==n.H.Alpha||((0,E.h)(t.vertex,e),t.include(c.O,e),t.include(a.w),e.offsetBackfaces&&t.include(s.w),e.instancedColor&&t.attributes.add(N.T.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(d.D,e),t.include(r.q,e),t.include(h.R,e),t.include(p.c,e),t.vertex.uniforms.add(new M.N("externalColor",(e=>e.externalColor))),t.varyings.add("vcolorExt","vec4"),i.add(R.H`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${R.H.float(C.b)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?R.H`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===n.H.Alpha&&(t.include(o.f5,e),t.include(T.z,e),t.include(_.l,e),t.fragment.uniforms.add([new O.p("opacity",(e=>e.opacity)),new O.p("layerOpacity",(e=>e.layerOpacity)),new P.B("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new L.A("tex",(e=>e.texture))),t.fragment.include(S.y),k.add(R.H`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?R.H`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?R.H`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:R.H`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?R.H`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:R.H`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===n.H.Color&&(t.include(o.f5,e),t.include(y.X,e),t.include(g.K,e),t.include(T.z,e),t.include(e.instancedDoublePrecision?w.hb:w.XE,e),t.include(_.l,e),(0,E.h)(t.fragment,e),t.fragment.uniforms.add([U,new A.J("ambient",(e=>e.ambient)),new A.J("diffuse",(e=>e.diffuse)),new O.p("opacity",(e=>e.opacity)),new O.p("layerOpacity",(e=>e.layerOpacity)),new P.B("view"),new O.p("lightingGlobalFactor",((e,t)=>t.lighting.globalFactor)),new A.J("lightingMainIntensity",((e,t)=>t.lighting.mainLight.intensity))]),t.fragment.constants.add("ambientBoostFactor","float",F.V),e.hasColorTexture&&t.fragment.uniforms.add(new L.A("tex",(e=>e.texture))),t.include(b.jV,e),t.include(v.T,e),t.fragment.include(S.y),t.extensions.add("GL_OES_standard_derivatives"),k.add(R.H`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?R.H`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?R.H`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:R.H`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===b.f7.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?R.H`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:R.H`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?R.H`albedo = mix(albedo, vec3(1), 0.9);`:R.H``}
        ${R.H`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===b.f7.Normal||e.pbrMode===b.f7.Schematic?e.spherical?R.H`vec3 normalGround = normalize(vpos + localOrigin);`:R.H`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:R.H``}
        ${e.pbrMode===b.f7.Normal||e.pbrMode===b.f7.Schematic?R.H`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?R.H`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:R.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===D.Am.Color?R.H`gl_FragColor = premultiplyAlpha(gl_FragColor);`:R.H``}
      }
    `)),t.include(m.s,e),t}const U=Object.freeze(Object.defineProperty({__proto__:null,build:k},Symbol.toStringTag,{value:"Module"}))},2013:(e,t,i)=>{"use strict";i.d(t,{N:()=>C,R:()=>S,b:()=>T});var r=i(61681),s=i(25714),n=i(5885),o=i(65915),a=i(59004),l=i(37009),c=i(73393),u=i(95509),h=i(44391),d=i(32394),p=i(84614),f=i(93072),m=i(63371),g=i(24603),y=i(23410),_=i(87621),v=i(3961),b=i(70984),w=i(21414),x=i(26531);const C=1;function T(e){const t=new v.kG,i=e.hasMultipassTerrain&&(e.output===s.H.Color||e.output===s.H.Alpha);t.include(u.e),t.include(o.U,e),t.include(l.q,e),e.output===s.H.Depth&&t.include(a.F,e),(0,p.S)(t,e);const{vertex:T,fragment:S}=t;T.uniforms.add([new _.g("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new f.A("nearFar",((e,t)=>t.camera.nearFar)),new g.p("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new m.N("viewport",((e,t)=>t.camera.fullViewport))]),T.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(w.T.POSITION,"vec3"),t.attributes.add(w.T.SUBDIVISIONFACTOR,"float"),t.attributes.add(w.T.UV0,"vec2"),t.attributes.add(w.T.AUXPOS1,"vec3"),t.attributes.add(w.T.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float");const E=e.capType===x.R.ROUND,A=e.stippleEnabled&&e.stippleScaleWithLineWidth||E;A&&t.varyings.add("vLineWidth","float");const M=e.stippleEnabled&&e.stippleScaleWithLineWidth;M&&t.varyings.add("vLineSizeInv","float");const O=e.innerColorEnabled||E;O&&t.varyings.add("vLineDistance","float");const R=e.stippleEnabled&&E,P=e.falloffEnabled||R;P&&t.varyings.add("vLineDistanceNorm","float"),E&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),T.code.add(y.H`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),T.code.add(y.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),T.code.add(y.H`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${i?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),T.uniforms.add(new g.p("pixelRatio",((e,t)=>t.camera.pixelRatio))),T.code.add(y.H`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${A?y.H`vLineWidth = lineWidth;`:""}
      ${M?y.H`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||E)&&T.code.add(y.H`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${E?y.H`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),T.code.add(y.H`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?T.code.add(y.H`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?y.H`min(1.0, subdivisionFactor * ${y.H.float((C+2)/(C+1))})`:y.H`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):T.code.add(y.H`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const I=e.capType!==x.R.BUTT;return T.code.add(y.H`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${I?y.H`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),T.code.add(y.H`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${P||O?y.H`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${O?y.H`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${P?y.H`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),E&&T.code.add(y.H`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?T.uniforms.add(new g.p("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):T.code.add(y.H`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),T.code.add(y.H`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?T.code.add(y.H`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):T.code.add(y.H`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),T.code.add(y.H`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),T.code.add(y.H`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),i&&t.include(c.l,e),t.include(n.f5,e),S.include(d.Y),S.code.add(y.H`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?S.code.add(y.H`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(E&&S.code.add(y.H`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${y.H.float(h.b)}) {
        discard;
      }
    `),R?S.code.add(y.H`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${y.H.float(h.b)}, stippleCoverage);
      `):S.code.add(y.H`float stippleAlpha = getStippleAlpha();`),S.uniforms.add(new m.N("intrinsicColor",(e=>e.color))),S.code.add(y.H`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(S.uniforms.add(new m.N("innerColor",(e=>(0,r.Pt)(e.innerColor,e.color)))),S.uniforms.add(new g.p("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),S.code.add(y.H`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),S.code.add(y.H`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(S.uniforms.add(new g.p("falloff",(e=>e.falloff))),S.code.add(y.H`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),S.code.add(y.H`
    if (finalColor.a < ${y.H.float(h.b)}) {
      discard;
    }

    ${e.output===s.H.Alpha?y.H`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===s.H.Color?y.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===s.H.Color&&e.transparencyPassType===b.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===s.H.Highlight?y.H`gl_FragColor = vec4(1.0);`:""}
    ${e.output===s.H.Depth?y.H`outputDepth(linearDepth);`:""}
  }
  `),t}const S=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:C,build:T},Symbol.toStringTag,{value:"Module"}))},41490:(e,t,i)=>{"use strict";i.d(t,{S:()=>u,b:()=>c});var r=i(62869),s=i(23410),n=i(3961),o=i(57663),a=i(52694),l=i(21414);function c(e){const t=new n.kG;return e.output===a.f.EdgeDetector&&(t.attributes.add(l.T.POSITION,"vec2"),t.vertex.uniforms.add(new r.y("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(s.H`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add(new o.Q("tColor")),t.fragment.code.add(s.H`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${s.H.float(.05)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${s.H.float(2)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===a.f.BlendWeight&&(t.attributes.add(l.T.POSITION,"vec2"),t.vertex.uniforms.add(new r.y("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(s.H`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${s.H.int(8)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add(new o.Q("tEdges")),t.fragment.uniforms.add(new o.Q("tArea")),t.fragment.uniforms.add(new o.Q("tSearch")),t.fragment.uniforms.add(new o.Q("tColor")),t.fragment.uniforms.add(new r.y("resolution")),t.fragment.code.add(s.H`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${s.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${s.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${s.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${s.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${s.H.int(16)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===a.f.Blur&&(t.attributes.add(l.T.POSITION,"vec2"),t.vertex.uniforms.add(new r.y("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(s.H`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add(new o.Q("tBlendWeights")),t.fragment.uniforms.add(new o.Q("tColor")),t.fragment.uniforms.add(new r.y("resolution")),t.fragment.code.add(s.H`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},91800:(e,t,i)=>{"use strict";i.d(t,{S:()=>f,b:()=>p});var r=i(41383),s=i(6665),n=i(77334),o=i(93072),a=i(74001),l=i(39820),c=i(23410),u=i(3961),h=i(57663),d=i(89158);function p(e){const t=new u.kG,i=t.fragment;if(t.include(r.k),e.output===d.Q.Blur){const e=2.5,t=1/(2*e*e);i.include(s.S),i.uniforms.add([new h.Q("normalMap"),new h.Q("depthMap"),new h.Q("tex"),new a.e("blurSize"),new l.d("projScale"),new o.A("nearFar",((e,t)=>t.camera.nearFar))]),i.code.add(c.H`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${c.H.float(t)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),i.code.add(c.H`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${c.H.int(4)}; r <= ${c.H.int(4)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===d.Q.SSAO&&(i.include(s.S),t.include(n.G),i.uniforms.add(new h.Q("normalMap")),i.uniforms.add(new h.Q("depthMap")),i.uniforms.add(new h.Q("rnm")),i.uniforms.add(new l.d("intensity")),i.uniforms.add(new l.d("projScale")),i.uniforms.add(new l.d("radius")),i.uniforms.add(new o.A("nearFar",((e,t)=>t.camera.nearFar))),i.uniforms.add(new a.e("screenSize")),i.uniforms.add(new a.e("rnmScale")),i.code.add(c.H`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),i.code.add(c.H`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new o.A("zScale",((e,t)=>(0,n.R)(t)))),i.code.add(c.H`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${c.H.int(16)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${c.H.int(16)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const f=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}))},89417:(e,t,i)=>{"use strict";i.d(t,{S:()=>m,a:()=>b,b:()=>_,s:()=>g});var r=i(24455),s=i(39100),n=i(41383),o=i(6665),a=i(45416),l=i(77334),c=i(9794),u=i(93072),h=i(23410),d=i(87621),p=i(3961),f=i(15176);class m extends a.ry{}const g=255,y=1/g;function _(){const e=new p.kG,t=e.fragment;return t.include(c.n),t.include(o.S),e.include(l.G),e.include(n.k),e.include(a.hb,{receiveShadows:!0}),t.uniforms.add([new f.A("depthMap",(e=>e.linearDepthTexture)),new d.g("inverseViewMatrix",((e,t)=>(0,r.a)(v,(0,r.j)(v,t.camera.viewMatrix,t.camera.center)))),new u.A("nearFar",((e,t)=>t.camera.nearFar))]),t.constants.add("sampleValue","float",y),t.code.add(h.H`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const v=(0,s.c)(),b=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:m,shadowCastMaxSamples:g,build:_},Symbol.toStringTag,{value:"Module"}))},52436:(e,t,i)=>{"use strict";i.d(t,{S:()=>m,b:()=>f});var r=i(41383),s=i(6665),n=i(77334),o=i(9794),a=i(63371),l=i(24603),c=i(23410),u=i(3961),h=i(15176),d=i(89417),p=i(50740);function f(e){const t=new u.kG,i=t.fragment;i.include(o.n),i.include(s.S),t.include(n.G),t.include(r.k);const{visualization:f,bandsEnabled:m}=e;i.constants.add("inverseSampleValue","float",d.s),i.uniforms.add([new h.A("shadowCastMap",(e=>e.shadowCastMap)),new l.p("sampleScale",(e=>e.sampleScale)),new l.p("opacityFromElevation",(e=>e.opacityFromElevation)),new a.N("uColor",(e=>e.color))]);const g=f===p.w.Gradient,y=f===p.w.Threshold;return g&&m?i.uniforms.add(new l.p("bandSize",(e=>e.bandSize))):y&&i.uniforms.add(new l.p("threshold",(e=>e.threshold))),i.code.add(c.H`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${y?c.H`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${g&&m?c.H`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${g?c.H`* strength`:""});
      }
    `),t}const m=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}))},23839:(e,t,i)=>{"use strict";i.d(t,{S:()=>O,b:()=>S});var r=i(61681),s=i(24455),n=i(39100),o=i(55709),a=i(69666),l=i(6766),c=i(8909),u=i(41383),h=i(55994),d=i(6665),p=i(45416),f=i(77334),m=i(9794),g=i(93072),y=i(43036),_=i(63371),v=i(24603),b=i(23410),w=i(87621),x=i(3961),C=i(15176),T=i(80876);function S(){const e=new x.kG;e.include(p.XE,{receiveShadows:!0});const t=e.fragment;return t.include(m.n),t.include(d.S),e.include(f.G),e.include(u.k),t.uniforms.add([new C.A("defaultDepthTex",((e,t)=>t.shadowMap.getSnapshot(T.i.Default))),new C.A("highlightDepthTex",((e,t)=>t.shadowMap.getSnapshot(T.i.Highlight))),new C.A("depthMap",((e,t)=>t.linearDepthTexture)),new C.A("highlightMap",((e,t)=>t.highlightColorTexture)),new _.N("uColor",(e=>e.shadowColor)),new g.A("nearFar",((e,t)=>t.camera.nearFar)),new v.p("opacity",(e=>e.shadowOpacity)),new v.p("occludedOpacity",(e=>e.occludedShadowOpacity)),new v.p("terminationFactor",(e=>e.opacityElevation*e.dayNightTerminator)),new y.J("lightingMainDirectionView",((e,t)=>(0,l.n)(A,(0,l.m)(A,t.lighting.lightingMainDirection,t.camera.viewInverseTransposeMatrix)))),new g.A("texelSize",((e,t)=>(0,r.pC)(t.linearDepthTexture)?(0,o.a)(M,1/t.linearDepthTexture.descriptor.width,1/t.linearDepthTexture.descriptor.height):a.Z)),new w.g("inverseViewMatrix",((e,t)=>(0,s.a)(E,(0,s.j)(E,t.camera.viewMatrix,t.camera.center))))]),t.constants.add("unoccludedHighlightFlag","vec4",h.ck).add("highlightedThreshold","float",.99999).add("selfShadowThreshold","float",.025),t.code.add(b.H`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(b.H`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const E=(0,n.c)(),A=(0,c.c)(),M=(0,a.a)(),O=Object.freeze(Object.defineProperty({__proto__:null,build:S},Symbol.toStringTag,{value:"Module"}))},41938:(e,t,i)=>{"use strict";i.d(t,{S:()=>m,a:()=>y,b:()=>g});var r=i(28876),s=i(4731),n=i(74001),o=i(43036),a=i(96371),l=i(39820),c=i(23410),u=i(87621),h=i(67948),d=i(3961),p=i(15176),f=i(21414);class m extends c.K{}function g(e){const t=new d.kG,{vertex:i,fragment:m}=t;if(e.geometry===r.n.Underground)t.attributes.add(f.T.POSITION,"vec2"),t.varyings.add("color","vec4"),i.uniforms.add([new o.J("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection)),new a.K("cameraPosition"),new l.d("undergroundFadeAlpha")]),i.code.add(c.H`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),m.code.add(c.H`void main() {
gl_FragColor = color;
}`);else{t.include(s.w),t.attributes.add(f.T.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const d=e.geometry===r.n.Cylinder;i.uniforms.add([new u.g("proj",((e,t)=>t.camera.projectionMatrix)),new h.B("view"),new o.J("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection))]),d||(t.varyings.add("innerFactor","float"),i.uniforms.add(new a.K("silCircleCenter")),i.uniforms.add(new a.K("silCircleV1")),i.uniforms.add(new a.K("silCircleV2")),i.uniforms.add(new n.e("texV")),i.uniforms.add(new l.d("innerScale")));const g=6.2831853,y=1/128;i.code.add(c.H`
		void main(void) {
      ${d?c.H`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:c.H`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${c.H.float(g*y)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${c.H.float(y)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),m.uniforms.add(new p.A("tex",(e=>e.texture))),d||m.uniforms.add(new l.d("altitudeFade")),m.code.add(c.H`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${d?c.H`gl_FragColor = atmosphereColor;`:c.H`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const y=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:m,build:g},Symbol.toStringTag,{value:"Module"}))},26761:(e,t,i)=>{"use strict";i.d(t,{S:()=>f,b:()=>d});var r=i(24455),s=i(39100),n=i(94728),o=i(63371),a=i(24603),l=i(23410),c=i(87621),u=i(3961),h=i(21414);function d(){const e=new u.kG;return e.attributes.add(h.T.POSITION,"vec3"),e.attributes.add(h.T.COLOR,"vec4"),e.attributes.add(h.T.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new c.g("transform",((e,t)=>function(e,t){const i=24e-8;return(0,r.c)(p,t.camera.projectionMatrix),p[10]=i-1,p[11]=-1,p[14]=(i-2)*t.camera.near,(0,r.m)(p,p,t.camera.viewMatrix),(0,r.m)(p,p,e.modelMatrix)}(e,t))),new o.N("viewport",((e,t)=>t.camera.fullViewport)),new a.p("pixelRatio",((e,t)=>t.camera.pixelRatio))]),e.include(n.H),e.vertex.code.add(l.H`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(l.H`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}const p=(0,s.c)(),f=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}))},8106:(e,t,i)=>{"use strict";i.d(t,{T:()=>L,a:()=>k,b:()=>D});var r=i(24455),s=i(39100),n=i(6766),o=i(8909),a=i(9812),l=i(25714),c=i(5885),u=i(4731),h=i(14140),d=i(59004),p=i(55994),f=i(30786),m=i(24623),g=i(37451),y=i(3864),_=i(45416),v=i(97582),b=i(47096),w=i(78115),x=i(93072),C=i(32006),T=i(43036),S=i(24603),E=i(23410),A=i(3875),M=i(87621),O=i(3961),R=i(15176),P=i(21414),I=i(39501);class L extends v.uS{}function D(e){const t=new O.kG;t.include(w.a,{name:"Terrain Shader",output:e.output}),t.attributes.add(P.T.POSITION,"vec3"),t.attributes.add(P.T.UV0,"vec2"),t.attributes.add(P.T.NORMAL,"vec3");const{vertex:i,fragment:s}=t;if(i.uniforms.add([new M.g("proj",((e,t)=>t.camera.projectionMatrix)),new A.K("view",((e,t)=>(0,r.j)(N,t.camera.viewMatrix,e.origin))),new C.B("origin",(e=>e.origin))]),s.uniforms.add(new C.B("origin",(e=>e.origin))),e.output===l.H.Color){t.include(u.w),t.include(g.n,e),t.include(b.E,e),t.include(m.X,e);const o=e.overlayMode!==v.gT.Disabled,l=e.overlayMode===v.gT.EnabledWithWater;o&&t.include(v.yl,{...e,pbrMode:y.f7.Water}),l&&t.include(h.M,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),(e.atmosphere||e.screenSizePerspective)&&i.uniforms.add(new M.g("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix)));const d=e.receiveShadows&&!e.renderOccluded;d&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(i.uniforms.add(new T.J("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection))),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),i.code.add(E.H`
      void main(void) {
        vpos = position;
        vnormal = ${e.shading?E.H`normal`:E.H`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${e.atmosphere?E.H`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?E.H`vuv = uv;`:""}
        ${e.screenSizePerspective?E.H`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${d?E.H`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${o?E.H`setOverlayVTC(uv);`:""}
        ${l?E.H`forwardVertexTangent(vnormal);`:E.H``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(c.f5,e),t.include(m.X,e),t.include(f.K,e),t.include(_.XE,e),s.uniforms.add([new C.B("cameraPosition",((e,t)=>(0,n.b)(F,t.camera.eye,e.origin))),new T.J("viewDirection",((e,t)=>(0,n.n)(F,(0,n.s)(F,t.camera.viewMatrix[12],t.camera.viewMatrix[13],t.camera.viewMatrix[14])))),new S.p("lightingGlobalFactor",((e,t)=>t.lighting.globalFactor)),new T.J("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection)),new T.J("lightingMainIntensity",((e,t)=>t.lighting.mainLight.intensity))]),s.constants.add("ambientBoostFactor","float",I.V),l&&s.uniforms.add([new R.A("ovWaterTex",((e,t)=>0===t.overlays.length?null:t.overlays[a.fu.INNER].getNormalTexture(e.overlaySource))),new A.K("view",((e,t)=>(0,r.j)(N,t.camera.viewMatrix,e.origin)))]),s.code.add(E.H`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),s.code.add(E.H`
      void main() {
        ${d?E.H`float shadow = readShadowMap(vpos, linearDepth);`:E.H`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${o?E.H`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?E.H`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?E.H`atm + tileColor.rgb;`:E.H`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${e.shading?"":E.H`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${e.shading?"":E.H`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${l?E.H`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?E.H`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?E.H`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==l.H.Depth&&e.output!==l.H.Shadow||(t.include(u.w,{hasModelTransformation:!1,linearDepth:!0}),t.include(d.F,{output:e.output}),t.include(g.n,e),t.varyings.add("linearDepth","float"),i.uniforms.add(new x.A("nearFar",((e,t)=>t.camera.nearFar))),i.code.add(E.H`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),s.code.add(E.H`void main() {
outputDepth(linearDepth);
}`)),e.output===l.H.Normal&&(t.include(u.w),t.include(g.n,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),i.uniforms.add(new M.g("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix))),i.code.add(E.H`
        void main(void) {
          vec3 normal = ${e.shading?E.H`normal`:E.H`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),s.code.add(E.H`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===l.H.Highlight&&(t.include(u.w),t.include(g.n,e),t.include(v.yl,e),i.code.add(E.H`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),t.include(p.bA),s.code.add(E.H`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const N=(0,s.c)(),F=(0,o.c)(),k=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:L,build:D},Symbol.toStringTag,{value:"Module"}))},86243:(e,t,i)=>{"use strict";i.d(t,{T:()=>c,b:()=>l});var r=i(41383),s=i(62869),n=i(23410),o=i(3961),a=i(57663);function l(){const e=new o.kG;return e.include(r.k),e.fragment.uniforms.add([new a.Q("tex"),new s.y("uColor")]),e.fragment.code.add(n.H`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const c=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}))},18406:(e,t,i)=>{"use strict";i.d(t,{W:()=>O,b:()=>M});var r=i(95650),s=i(25714),n=i(5885),o=i(4731),a=i(55994),l=i(77787),c=i(58749),u=i(73393),h=i(37451),d=i(3864),p=i(45416),f=i(81049),m=i(18995),g=i(44391),y=i(32394),_=i(84614),v=i(43036),b=i(63371),w=i(62869),x=i(24603),C=i(23410),T=i(67948),S=i(3961),E=i(70984),A=i(21414);function M(e){const t=new S.kG,{vertex:i,fragment:M}=t,O=(0,_.S)(t,e);return t.include(o.w),t.attributes.add(A.T.POSITION,"vec3"),t.attributes.add(A.T.UV0,"vec2"),i.uniforms.add(new b.N("waterColor",(e=>e.color))),e.output!==s.H.Color&&e.output!==s.H.Alpha||(t.include(h.n,e),t.include(r.q,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),M.uniforms.add(O),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(C.H`
      void main(void) {
        if (waterColor.a < ${C.H.float(g.b)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===s.H.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(u.l,e),e.output===s.H.Alpha&&(t.include(n.f5,e),M.uniforms.add(new w.y("waterColor")),M.code.add(C.H`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===s.H.Color&&(t.include(c.k,{isGround:!1}),t.include(l._,{pbrMode:d.f7.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(m.M),t.include(n.f5,e),t.include(p.XE,e),t.include(f.B,e),M.uniforms.add([new w.y("waterColor"),new v.J("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection)),new v.J("lightingMainIntensity",((e,t)=>t.lighting.mainLight.intensity)),new x.p("timeElapsed",(e=>e.timeElapsed)),new T.B("view")]),(0,_.h)(M,e),M.include(y.Y),M.code.add(C.H`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?C.H`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===E.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===s.H.Normal&&(t.include(h.n,e),t.include(m.M,e),t.include(n.f5,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.code.add(C.H`
        void main(void) {
          if (waterColor.a < ${C.H.float(g.b)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),M.uniforms.add(new x.p("timeElapsed",(e=>e.timeElapsed))),M.code.add(C.H`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===s.H.Draped&&(t.varyings.add("vpos","vec3"),i.code.add(C.H`
        void main(void) {
          if (waterColor.a < ${C.H.float(g.b)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),M.uniforms.add(new w.y("waterColor")),M.code.add(C.H`void main() {
gl_FragColor = waterColor;
}`)),e.output===s.H.Highlight&&(t.include(a.bA),t.varyings.add("vpos","vec3"),i.code.add(C.H`
      void main(void) {
        if (waterColor.a < ${C.H.float(g.b)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(n.f5,e),M.code.add(C.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const O=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}))},58340:(e,t,i)=>{"use strict";i.d(t,{a:()=>n,c:()=>r,g:()=>s});var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}},96739:(e,t,i)=>{"use strict";i.d(t,{B:()=>y,a:()=>v,b:()=>Y,c:()=>_,d:()=>L,e:()=>P,f:()=>b,g:()=>C,h:()=>R,i:()=>T,n:()=>F,r:()=>N,t:()=>D,u:()=>w}),i(39994);var r=i(13802),s=i(19431),n=i(19480),o=i(24455),a=i(39100),l=i(6766),c=i(8909),u=i(19546),h=i(56215),d=i(69430),p=i(97537),f=i(5700),m=i(68817);const g=r.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class y{constructor(){this.plane=(0,d.Ue)(),this.origin=(0,c.c)(),this.basis1=(0,c.c)(),this.basis2=(0,c.c)()}}function _(e=B){return{plane:(0,d.Ue)(e.plane),origin:(0,c.a)(e.origin),basis1:(0,c.a)(e.basis1),basis2:(0,c.a)(e.basis2)}}function v(e,t=_()){return b(e.origin,e.basis1,e.basis2,t)}function b(e,t,i,r=_()){return(0,l.c)(r.origin,e),(0,l.c)(r.basis1,t),(0,l.c)(r.basis2,i),w(r),function(e,t){Math.abs((0,l.e)(e.basis1,e.basis2)/((0,l.l)(e.basis1)*(0,l.l)(e.basis2)))>1e-6&&g.warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,l.e)(e.basis1,F(e)))>1e-6&&g.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.e)(F(e),e.origin)-e.plane[3])>1e-6&&g.warn(t,"Plane offset is not consistent with plane origin")}(r,"fromValues()"),r}function w(e){(0,d.my)(e.basis2,e.basis1,e.origin,e.plane)}function x(e,t,i){e!==i&&v(e,i);const r=(0,l.g)(m.WM.get(),F(e),t);return(0,l.a)(i.origin,i.origin,r),i.plane[3]-=t,i}function C(e,t=_()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return(0,l.s)(t.origin,e[0]+i,e[1]+r,0),(0,l.s)(t.basis1,i,0,0),(0,l.s)(t.basis2,0,r,0),(0,d.al)(0,0,1,0,t.plane),t}function T(e,t,i){return!!(0,d.BR)(e.plane,t,i)&&k(e,i)}function S(e,t,i){const r=H.get();z(e,t,r,H.get());let n=Number.POSITIVE_INFINITY;for(const o of Z){const a=V(e,o,j.get()),c=m.WM.get();if((0,d.rx)(r,a,c)){const e=(0,l.r)(m.WM.get(),t.origin,c),r=Math.abs((0,s.ZF)((0,l.e)(t.direction,e)));r<n&&(n=r,(0,l.c)(i,c))}}return n===Number.POSITIVE_INFINITY?E(e,t,i):i}function E(e,t,i){if(T(e,t,i))return i;const r=H.get(),s=H.get();z(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const o of Z){const a=V(e,o,j.get()),c=m.WM.get();if((0,d.dZ)(r,a,c)){const e=(0,p.Jk)(t,c);if(!(0,d.Ac)(s,c))continue;e<n&&(n=e,(0,l.c)(i,c))}}return O(e,t.origin)<n&&A(e,t.origin,i),i}function A(e,t,i){const r=(0,d.nF)(e.plane,t,m.WM.get()),s=(0,h.ct)(U(e,e.basis1),r,-1,1,m.WM.get()),n=(0,h.ct)(U(e,e.basis2),r,-1,1,m.WM.get());return(0,l.b)(i,(0,l.a)(m.WM.get(),s,n),e.origin),i}function M(e,t,i){const{origin:r,basis1:s,basis2:n}=e,o=(0,l.b)(m.WM.get(),t,r),a=(0,f.SR)(s,o),c=(0,f.SR)(n,o),u=(0,f.SR)(F(e),o);return(0,l.s)(i,a,c,u)}function O(e,t){const i=M(e,t,m.WM.get()),{basis1:r,basis2:s}=e,n=(0,l.l)(r),o=(0,l.l)(s),a=Math.max(Math.abs(i[0])-n,0),c=Math.max(Math.abs(i[1])-o,0),u=i[2];return a*a+c*c+u*u}function R(e,t){return Math.sqrt(O(e,t))}function P(e,t){return(0,d.Ac)(e.plane,t)&&k(e,t)}function I(e,t){const i=-e.plane[3];return(0,f.SR)(F(e),t)-i}function L(e,t){return(0,l.k)(e.basis1,t.basis1)&&(0,l.k)(e.basis2,t.basis2)&&(0,l.k)(e.origin,t.origin)}function D(e,t,i){return e!==i&&v(e,i),(0,o.a)(q,t),(0,o.t)(q,q),(0,l.m)(i.basis1,e.basis1,q),(0,l.m)(i.basis2,e.basis2,q),(0,l.m)((0,d.mJ)(i.plane),(0,d.mJ)(e.plane),q),(0,l.m)(i.origin,e.origin,t),(0,d.T5)(i.plane,i.plane,i.origin),i}function N(e,t,i,r){return e!==r&&v(e,r),(0,o.d)($,t,i),(0,l.m)(r.basis1,e.basis1,$),(0,l.m)(r.basis2,e.basis2,$),w(r),r}function F(e){return(0,d.mJ)(e.plane)}function k(e,t){const i=(0,l.b)(m.WM.get(),t,e.origin),r=(0,l.p)(e.basis1),s=(0,l.p)(e.basis2),n=(0,l.e)(e.basis1,i),o=(0,l.e)(e.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function U(e,t){const i=j.get();return(0,l.c)(i.origin,e.origin),(0,l.c)(i.vector,t),i}function V(e,t,i){const{basis1:r,basis2:s,origin:n}=e,o=(0,l.g)(m.WM.get(),r,t.origin[0]),a=(0,l.g)(m.WM.get(),s,t.origin[1]);(0,l.a)(i.origin,o,a),(0,l.a)(i.origin,i.origin,n);const c=(0,l.g)(m.WM.get(),r,t.direction[0]),u=(0,l.g)(m.WM.get(),s,t.direction[1]);return(0,l.g)(i.vector,(0,l.a)(c,c,u),2),i}function z(e,t,i,r){const s=F(e);(0,d.my)(s,t.direction,t.origin,i),(0,d.my)((0,d.mJ)(i),s,t.origin,r)}const B={plane:(0,d.Ue)(),origin:(0,c.f)(0,0,0),basis1:(0,c.f)(1,0,0),basis2:(0,c.f)(0,1,0)},H=new n.x(d.Ue),j=new n.x(h.Ue),G=(0,c.c)(),W=new n.x((()=>({origin:null,basis1:null,basis2:null,plane:null}))),Z=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],q=(0,a.c)(),$=(0,a.c)(),Y=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:y,create:_,wrap:function(e,t,i){const r=W.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=(0,d.re)(0,0,0,0),w(r),r},copy:v,copyWithoutVerify:function(e,t){(0,l.c)(t.origin,e.origin),(0,l.c)(t.basis1,e.basis1),(0,l.c)(t.basis2,e.basis2),(0,d.JG)(t.plane,e.plane)},fromValues:b,updateUnboundedPlane:w,elevate:x,setExtent:function(e,t,i){return C(t,i),x(i,I(e,e.origin),i),i},fromAABoundingRect:C,intersectRay:T,intersectRayClosestSilhouette:function(e,t,i){if(T(e,t,i))return i;const r=S(e,t,m.WM.get());return(0,l.a)(i,t.origin,(0,l.g)(m.WM.get(),t.direction,(0,l.i)(t.origin,r)/(0,l.l)(t.direction))),i},closestPointOnSilhouette:S,closestPoint:E,projectPoint:A,projectPointLocal:M,distance2:O,distance:R,distanceToSilhouette:function(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of Z){const s=V(e,r,j.get()),n=(0,h.Jk)(s,t);n>i&&(i=n)}return Math.sqrt(i)},extrusionContainsPoint:P,axisAt:function(e,t,i,r){return function(e,t,i){switch(t){case u.R.X:(0,l.c)(i,e.basis1),(0,l.n)(i,i);break;case u.R.Y:(0,l.c)(i,e.basis2),(0,l.n)(i,i);break;case u.R.Z:(0,l.c)(i,F(e))}return i}(e,i,r)},altitudeAt:I,setAltitudeAt:function(e,t,i,r){const s=I(e,t),n=(0,l.g)(G,F(e),i-s);return(0,l.a)(r,t,n),r},equals:L,transform:D,rotate:N,normal:F,UP:B},Symbol.toStringTag,{value:"Module"}))},93011:(e,t,i)=>{"use strict";i.d(t,{E:()=>r,R:()=>s,t:()=>a});const r=1e-6,s=Math.random,n=Math.PI/180,o=180/Math.PI;function a(e){return e*n}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:r,RANDOM:s,toRadian:a,toDegree:function(e){return e*o},equals:function(e,t){return Math.abs(e-t)<=r*Math.max(1,Math.abs(e),Math.abs(t))}},Symbol.toStringTag,{value:"Module"}))},5992:(e,t,i)=>{"use strict";i.d(t,{e:()=>a});var r,s,n,o={exports:{}};r=o,s=function(){function e(e,i,s){s=s||2;var n,o,a,c,u,h,d,p=i&&i.length,f=p?i[0]*s:e.length,m=t(e,0,f,s,!0),g=[];if(!m||m.next===m.prev)return g;if(p&&(m=l(e,i,m,s)),e.length>80*s){n=a=e[0],o=c=e[1];for(var y=s;y<f;y+=s)(u=e[y])<n&&(n=u),(h=e[y+1])<o&&(o=h),u>a&&(a=u),h>c&&(c=h);d=0!==(d=Math.max(a-n,c-o))?1/d:0}return r(m,g,s,n,o,d),g}function t(e,t,i,r,s){var n,o;if(s===M(e,t,i,r)>0)for(n=t;n<i;n+=r)o=S(n,e[n],e[n+1],o);else for(n=i-r;n>=t;n-=r)o=S(n,e[n],e[n+1],o);if(o&&v(o,o.next)){var a=o.next;E(o),o=a}return o}function i(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!v(r,r.next)&&0!==_(r.prev,r,r.next))r=r.next;else{var s=r.prev;if(E(r),(r=t=s)===r.next)break;i=!0}}while(i||r!==t);return t}function r(e,t,l,c,u,h,d){if(e){!d&&h&&p(e,c,u,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?n(e,c,u,h):s(e))t.push(f.i/l),t.push(e.i/l),t.push(m.i/l),E(e),e=m.next,g=m.next;else if((e=m)===g){d?1===d?r(e=o(i(e),t,l),t,l,c,u,h,2):2===d&&a(e,t,l,c,u,h):r(i(e),t,l,c,u,h,1);break}}}function s(e){var t=e.prev,i=e,r=e.next;if(_(t,i,r)>=0)return!1;for(var s=e.next.next;s!==e.prev;){if(g(t.x,t.y,i.x,i.y,r.x,r.y,s.x,s.y)&&_(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function n(e,t,i,r){var s=e.prev,n=e,o=e.next;if(_(s,n,o)>=0)return!1;for(var a=s.x<n.x?s.x<o.x?s.x:o.x:n.x<o.x?n.x:o.x,l=s.y<n.y?s.y<o.y?s.y:o.y:n.y<o.y?n.y:o.y,c=s.x>n.x?s.x>o.x?s.x:o.x:n.x>o.x?n.x:o.x,u=s.y>n.y?s.y>o.y?s.y:o.y:n.y>o.y?n.y:o.y,h=f(a,l,t,i,r),d=f(c,u,t,i,r),p=e.prevZ,m=e.nextZ;p&&p.z>=h&&m&&m.z<=d;){if(p!==e.prev&&p!==e.next&&g(s.x,s.y,n.x,n.y,o.x,o.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&g(s.x,s.y,n.x,n.y,o.x,o.y,m.x,m.y)&&_(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&g(s.x,s.y,n.x,n.y,o.x,o.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&g(s.x,s.y,n.x,n.y,o.x,o.y,m.x,m.y)&&_(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function o(e,t,r){var s=e;do{var n=s.prev,o=s.next.next;!v(n,o)&&b(n,s,s.next,o)&&C(n,o)&&C(o,n)&&(t.push(n.i/r),t.push(s.i/r),t.push(o.i/r),E(s),E(s.next),s=e=o),s=s.next}while(s!==e);return i(s)}function a(e,t,s,n,o,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&y(l,c)){var u=T(l,c);return l=i(l,l.next),u=i(u,u.next),r(l,t,s,n,o,a),void r(u,t,s,n,o,a)}c=c.next}l=l.next}while(l!==e)}function l(e,r,s,n){var o,a,l,u=[];for(o=0,a=r.length;o<a;o++)(l=t(e,r[o]*n,o<a-1?r[o+1]*n:e.length,n,!1))===l.next&&(l.steiner=!0),u.push(m(l));for(u.sort(c),o=0;o<u.length;o++)s=i(s=h(u[o],s),s.next);return s}function c(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function h(e,t){var r=function(e,t){var i,r=t,s=e.x,n=e.y,o=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var a=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=s&&a>o){if(o=a,a===s){if(n===r.y)return r;if(n===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(s===o)return i;var l,c=i,u=i.x,h=i.y,p=1/0;r=i;do{s>=r.x&&r.x>=u&&s!==r.x&&g(n<h?s:o,n,u,h,n<h?o:s,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(s-r.x),C(r,e)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&d(i,r)))&&(i=r,p=l)),r=r.next}while(r!==c);return i}(e,t);if(!r)return t;var s=T(r,e),n=i(r,r.next);let o=u(s);return i(o,o.next),n=u(n),u(t===r?n:t)}function d(e,t){return _(e.prev,e,t.prev)<0&&_(t.next,e,e.next)<0}function p(e,t,i,r){var s=e;do{null===s.z&&(s.z=f(s.x,s.y,t,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){var t,i,r,s,n,o,a,l,c=1;do{for(i=e,e=null,n=null,o=0;i;){for(o++,r=i,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:e=s,s.prevZ=n,n=s;i=r}n.nextZ=null,c*=2}while(o>1)}(s)}function f(e,t,i,r,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function g(e,t,i,r,s,n,o,a){return(s-o)*(t-a)-(e-o)*(n-a)>=0&&(e-o)*(r-a)-(i-o)*(t-a)>=0&&(i-o)*(n-a)-(s-o)*(r-a)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&b(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(C(e,t)&&C(t,e)&&function(e,t){var i=e,r=!1,s=(e.x+t.x)/2,n=(e.y+t.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(_(e.prev,e,t.prev)||_(e,t.prev,t))||v(e,t)&&_(e.prev,e,e.next)>0&&_(t.prev,t,t.next)>0)}function _(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,i,r){var s=x(_(e,t,i)),n=x(_(e,t,r)),o=x(_(i,r,e)),a=x(_(i,r,t));return s!==n&&o!==a||!(0!==s||!w(e,i,t))||!(0!==n||!w(e,r,t))||!(0!==o||!w(i,e,r))||!(0!==a||!w(i,t,r))}function w(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function x(e){return e>0?1:e<0?-1:0}function C(e,t){return _(e.prev,e,e.next)<0?_(e,t,e.next)>=0&&_(e,e.prev,t)>=0:_(e,t,e.prev)<0||_(e,e.next,t)<0}function T(e,t){var i=new A(e.i,e.x,e.y),r=new A(t.i,t.x,t.y),s=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function S(e,t,i,r){var s=new A(e,t,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(e,t,i,r){for(var s=0,n=t,o=i-r;n<i;n+=r)s+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return s}return e.deviation=function(e,t,i,r){var s=t&&t.length,n=s?t[0]*i:e.length,o=Math.abs(M(e,0,n,i));if(s)for(var a=0,l=t.length;a<l;a++){var c=t[a]*i,u=a<l-1?t[a+1]*i:e.length;o-=Math.abs(M(e,c,u,i))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,p=r[a+1]*i,f=r[a+2]*i;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,s=0;s<e.length;s++){for(var n=0;n<e[s].length;n++)for(var o=0;o<t;o++)i.vertices.push(e[s][n][o]);s>0&&(r+=e[s-1].length,i.holes.push(r))}return i},e},void 0!==(n=s())&&(r.exports=n);const a=o.exports},94837:(e,t,i)=>{"use strict";i.d(t,{$:()=>he,A:()=>le,B:()=>k,C:()=>L,D:()=>Y,E:()=>ne,F:()=>W,G:()=>ce,H:()=>me,I:()=>T,J:()=>_e,K:()=>ye,L:()=>ve,M:()=>R,N:()=>C,O:()=>Z,P:()=>Pe,Q:()=>Me,R:()=>S,S:()=>E,T:()=>Ae,U:()=>Oe,V:()=>Re,W:()=>ee,X:()=>xe,Y:()=>be,Z:()=>de,_:()=>ue,a:()=>F,b:()=>D,c:()=>Te,d:()=>Ee,e:()=>I,f:()=>re,g:()=>ae,h:()=>Q,i:()=>N,j:()=>j,k:()=>se,l:()=>U,m:()=>K,n:()=>H,o:()=>P,p:()=>G,q:()=>J,r:()=>Ce,s:()=>V,t:()=>te,u:()=>Ie,v:()=>A,w:()=>M,x:()=>O,y:()=>z,z:()=>B});var r=i(30359),s=i(58830),n=i(46001),o=i(8965),a=i(91772),l=i(20031),c=i(74304),u=i(53446),h=i(89542),d=i(90819),p=i(99490),f=i(61681),m=i(94978),g=i(38028),y=i(8108),_=i(68673);class v{constructor(e){this.value=e}}class b{constructor(e){this.value=e}}class w{constructor(e){this.fn=e}}class x{constructor(e,t){this.paramCount=t,this.fn=e}}const C=w,T=b,S=v,E=x,A={type:"VOID"},M={type:"BREAK"},O={type:"CONTINUE"};function R(e,t,i){return""===t||null==t||t===i||t===i?e:e=e.split(t).join(i)}function P(e){return e instanceof w||e instanceof r.Z||e instanceof x}function I(e){return!!(D(e)||F(e)||j(e)||N(e)||null===e||e===A||"number"==typeof e)}function L(e,t){return void 0===e?t:e}function D(e){return"string"==typeof e||e instanceof String}function N(e){return"boolean"==typeof e}function F(e){return"number"==typeof e}function k(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function U(e){return e instanceof Array}function V(e){return"esri.arcade.Feature"===e?.arcadeDeclaredClass}function z(e){return!0===(e&&e.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===e.declaredRootClass)}function B(e){return!0===(e&&e.declaredRootClass&&"esri.arcade.featureSetCollection"===e.declaredRootClass)}function H(e){return e instanceof s.Z}function j(e){return e instanceof Date}function G(e,t,i){if(e.length<t||e.length>i)throw new Error("Function called with wrong number of Parameters")}function W(e){return e<0?-Math.round(-e):Math.round(e)}function Z(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:3&i|8).toString(16)}))}function q(e,t){return!1===isNaN(e)?null==t||""===t?e.toString():(t=R(t,"",""),t=R(t,"",""),(0,m.WU)(e,{pattern:t})):e.toString()}function $(e,t){const i=p.ou.fromJSDate(e);return null==t||""===t?i.toISO({suppressMilliseconds:!0}):i.toFormat(Y(t),{locale:(0,y.Kd)(),numberingSystem:"latn"})}function Y(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const i=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i))switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=r;break;default:r.length>=2&&"["===r.slice(0,1)&&"]"===r.slice(-1)?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}function X(e,t,i){switch(i){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function J(e,t,i){if(null===e){if(null===t||t===A)return X(null,null,i);if(F(t))return X(0,t,i);if(D(t))return X(0,re(t),i);if(N(t))return X(0,re(t),i);if(j(t))return X(0,t.getTime(),i)}if(e===A){if(null===t||t===A)return X(null,null,i);if(F(t))return X(0,t,i);if(D(t))return X(0,re(t),i);if(N(t))return X(0,re(t),i);if(j(t))return X(0,t.getTime(),i)}else if(F(e)){if(F(t))return X(e,t,i);if(N(t))return X(e,re(t),i);if(null===t||t===A)return X(e,0,i);if(D(t))return X(e,re(t),i);if(j(t))return X(e,t.getTime(),i)}else if(D(e)){if(D(t))return X(Q(e),Q(t),i);if(j(t))return X(re(e),t.getTime(),i);if(F(t))return X(re(e),t,i);if(null===t||t===A)return X(re(e),0,i);if(N(t))return X(re(e),re(t),i)}else if(j(e)){if(j(t))return X(e,t,i);if(null===t||t===A)return X(e.getTime(),0,i);if(F(t))return X(e.getTime(),t,i);if(N(t))return X(e.getTime(),re(t),i);if(D(t))return X(e.getTime(),re(t),i)}else if(N(e)){if(N(t))return X(e,t,i);if(F(t))return X(re(e),re(t),i);if(j(t))return X(re(e),t.getTime(),i);if(null===t||t===A)return X(re(e),0,i);if(D(t))return X(re(e),re(t),i)}return!!K(e,t)&&("<="===i||">="===i)}function K(e,t){if(e===t)return!0;if(null===e&&t===A||null===t&&e===A)return!0;if(j(e)&&j(t))return e.getTime()===t.getTime();if(e instanceof n.Z)return e.equalityTest(t);if(e instanceof o.Z)return e.equalityTest(t);if(e instanceof u.Z&&t instanceof u.Z){const i=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(null!=i)return i===r}if(void 0!==e&&void 0!==t&&null!==e&&null!==t&&"object"==typeof e&&"object"==typeof t){if(e._arcadeCacheId===t._arcadeCacheId&&void 0!==e._arcadeCacheId&&null!==e._arcadeCacheId)return!0;if(e._underlyingGraphic===t._underlyingGraphic&&void 0!==e._underlyingGraphic&&null!==e._underlyingGraphic)return!0}return!1}function Q(e,t){if(D(e))return e;if(null===e)return"";if(F(e))return q(e,t);if(N(e))return e.toString();if(j(e))return $(e,t);if(e instanceof l.Z)return JSON.stringify(e.toJSON());if(U(e)){const t=[];for(let i=0;i<e.length;i++)t[i]=ie(e[i]);return"["+t.join(",")+"]"}if(e instanceof s.Z){const t=[];for(let i=0;i<e.length();i++)t[i]=ie(e.get(i));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():P(e)?"object, Function":""}function ee(e){const t=[];if(!1===U(e))return null;if(e instanceof s.Z){for(let i=0;i<e.length();i++)t[i]=re(e.get(i));return t}for(let i=0;i<e.length;i++)t[i]=re(e[i]);return t}function te(e,t){if(D(e))return e;if(null===e)return"";if(F(e))return q(e,t);if(N(e))return e.toString();if(j(e))return $(e,t);if(e instanceof l.Z)return e instanceof a.Z?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+fe(e.spatialReference)+"}":fe(e.toJSON(),((e,t)=>e.key===t.key?0:"spatialReference"===e.key?1:"spatialReference"===t.key||e.key<t.key?-1:e.key>t.key?1:0));if(U(e)){const t=[];for(let i=0;i<e.length;i++)t[i]=ie(e[i]);return"["+t.join(",")+"]"}if(e instanceof s.Z){const t=[];for(let i=0;i<e.length();i++)t[i]=ie(e.get(i));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():P(e)?"object, Function":""}function ie(e){if(null===e)return"null";if(N(e)||F(e)||D(e))return JSON.stringify(e);if(e instanceof l.Z)return te(e);if(e instanceof s.Z)return te(e);if(e instanceof Array)return te(e);if(e instanceof Date)return JSON.stringify($(e,""));if(null!==e&&"object"==typeof e){if(void 0!==e.castToText)return e.castToText()}else if(e===A)return"null";return"null"}function re(e,t){return F(e)?e:null===e||""===e?0:j(e)?NaN:N(e)?e?1:0:U(e)||""===e||void 0===e?NaN:void 0!==t&&D(e)?(t=R(t,"",""),t=R(t,"",""),(0,m.Qc)(e,{pattern:t})):e===A?0:Number(e)}function se(e){if(j(e))return e;if(D(e)){const t=oe(e);if(t)return t.toJSDate()}return null}function ne(e){return j(e)?p.ou.fromJSDate(e):D(e)?oe(e):null}function oe(e){const t=/ (\d\d)/;let i=p.ou.fromISO(e);return i.isValid||t.test(e)&&(e=e.replace(t,"T$1"),i=p.ou.fromISO(e),i.isValid)?i:null}function ae(e){return N(e)?e:D(e)?"true"===(e=e.toLowerCase()):!!F(e)&&0!==e&&!isNaN(e)}function le(e,t){return(0,f.Wi)(e)?null:(null!==e.spatialReference&&void 0!==e.spatialReference||(e.spatialReference=t),e)}function ce(e){if(null===e)return null;if(e instanceof u.Z)return"NaN"===e.x||null===e.x||isNaN(e.x)?null:e;if(e instanceof h.Z){if(0===e.rings.length)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof d.Z){if(0===e.paths.length)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof c.Z?0===e.points.length?null:e:e instanceof a.Z?"NaN"===e.xmin||null===e.xmin||isNaN(e.xmin)?null:e:null}function ue(e,t){if(!e)return t;if(!e.domain)return t;let i=null;if("string"===e.field.type||"esriFieldTypeString"===e.field.type)t=Q(t);else{if(null==t)return null;if(""===t)return t;t=re(t)}for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.code===t&&(i=s)}return null===i?t:i.name}function he(e,t){if(!e)return t;if(!e.domain)return t;let i=null;t=Q(t);for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.name===t&&(i=s)}return null===i?t:i.code}function de(e,t,i=null,r=null){if(!t)return null;if(!t.fields)return null;let s,n,o=null;for(let i=0;i<t.fields.length;i++){const r=t.fields[i];r.name.toLowerCase()===e.toString().toLowerCase()&&(o=r)}if(null===o)throw new Error("Field not found");return null===r&&i&&t.typeIdField&&(r=i.hasField(t.typeIdField)?i.field(t.typeIdField):null),null!=r&&t.types.some((function(e){return e.id===r&&(s=e.domains&&e.domains[o.name],s&&"inherited"===s.type&&(s=pe(o.name,t),n=!0),!0)})),n||s||(s=pe(e,t)),{field:o,domain:s}}function pe(e,t){let i;return t.fields.some((function(t){return t.name.toLowerCase()===e.toLowerCase()&&(i=t.domain),!!i})),i}function fe(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const i="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(s=t.cmp,function(e){return function(t,i){const r={key:t,value:e[t]},n={key:i,value:e[i]};return s(r,n)}});var s;const n=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let s,o;if(Array.isArray(t)){for(o="[",s=0;s<t.length;s++)s&&(o+=","),o+=e(t[s])||"null";return o+"]"}if(null===t)return"null";if(n.includes(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const a=n.push(t)-1,l=Object.keys(t).sort(r&&r(t));for(o="",s=0;s<l.length;s++){const i=l[s],r=e(t[i]);r&&(o&&(o+=","),o+=JSON.stringify(i)+":"+r)}return n.splice(a,1),"{"+o+"}"}(e)}function me(e){if(null===e)return null;const t=[];for(const i of e)i&&i.arcadeDeclaredClass&&"esri.arcade.Feature"===i.arcadeDeclaredClass?t.push(i.geometry()):t.push(i);return t}function ge(e,t){if(!(t instanceof u.Z))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function ye(e,t){if(U(e)||H(e)){let i=!1,r=!1,s=[],n=t;if(U(e)){for(const t of e)ge(s,t);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ,r=e[0].hasM)}else if(e instanceof o.Z)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else{if(!H(e))throw new Error("Invalid Argument");for(const t of e.toArray())ge(s,t);s.length>0&&(n=e.get(0).spatialReference,i=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===s.length?null:(!1===(0,g.bu)(s,r,i)&&(s=s.slice(0).reverse()),new h.Z({rings:[s],spatialReference:n,hasZ:i,hasM:r}))}return e}function _e(e,t){if(U(e)||H(e)){let i=!1,r=!1,s=[],n=t;if(U(e)){for(const t of e)ge(s,t);s.length>0&&(n=e[0].spatialReference,i=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof o.Z)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(H(e)){for(const t of e.toArray())ge(s,t);s.length>0&&(n=e.get(0).spatialReference,i=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===s.length?null:new d.Z({paths:[s],spatialReference:n,hasZ:i,hasM:r})}return e}function ve(e,t){if(U(e)||H(e)){let i=!1,r=!1,s=[],n=t;if(U(e)){for(const t of e)ge(s,t);s.length>0&&(n=e[0].spatialReference,i=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof o.Z)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(H(e)){for(const t of e.toArray())ge(s,t);s.length>0&&(n=e.get(0).spatialReference,i=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===s.length?null:new c.Z({points:s,spatialReference:n,hasZ:i,hasM:r})}return e}function be(e,t=!1){const i=[];if(null===e)return i;if(!0===U(e)){for(let r=0;r<e.length;r++){const s=Q(e[r]);""===s&&!0!==t||i.push(s)}return i}if(e instanceof s.Z){for(let r=0;r<e.length();r++){const s=Q(e.get(r));""===s&&!0!==t||i.push(s)}return i}if(I(e)){const r=Q(e);return""===r&&!0!==t||i.push(r),i}return[]}let we=0;function xe(e){return we++,we%100==0?(we=0,new Promise((t=>{setTimeout((()=>{t(e)}),0)}))):e}function Ce(e,t,i){switch(i){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function Te(e,t=null){return null==e?null:N(e)||F(e)||D(e)?e:e instanceof l.Z?!0===t?.keepGeometryType?e:e.toJSON():e instanceof s.Z?e.toArray().map((e=>Te(e,t))):e instanceof Array?e.map((e=>Te(e,t))):e instanceof Date?e:null!==e&&"object"==typeof e&&void 0!==e.castAsJson?e.castAsJson(t):null}async function Se(e,t,i,r,s){const n=await Ee(e,t,i);s[r]=n}async function Ee(e,t=null,i=null){if(e instanceof s.Z&&(e=e.toArray()),null==e)return null;if(I(e)||e instanceof l.Z||e instanceof Date)return Te(e,i);if(e instanceof Array){const r=[],s=[];for(const n of e)null===n||I(n)||n instanceof l.Z||n instanceof Date?s.push(Te(n,i)):(s.push(null),r.push(Se(n,t,i,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return null!==e&&"object"==typeof e&&void 0!==e.castAsJsonAsync?e.castAsJsonAsync(t,i):null}function Ae(e,t,i){const r=e.fullSchema();return null===r?null:r.fields?de(t,r,e,i):null}function Me(e){const t=e.fullSchema();return null===t?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map((e=>({name:e.name,code:e.id}))):[]}:null}function Oe(e,t,i,r){const s=e.fullSchema();if(null===s)return null;if(!s.fields)return null;const n=de(t,s,e,r);if(void 0===i)try{i=e.field(t)}catch(e){return null}return ue(n,i)}function Re(e,t,i,r){const s=e.fullSchema();if(null===s)return null;if(!s.fields)return null;if(void 0===i){try{i=e.field(t)}catch(e){return null}return i}return he(de(t,s,e,r),i)}function Pe(e){const t=e.fullSchema();if(null===t)return null;if(!t.fields)return null;const i=[];for(const e of t.fields)i.push((0,_.Sh)(e));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:void 0===_.q2[t.geometryType]?"":_.q2[t.geometryType],fields:i}}const Ie=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:v,ImplicitResultE:b,NativeFunctionE:w,SizzleFunctionE:x,NativeFunction:C,ImplicitResult:T,ReturnResult:S,SizzleFunction:E,voidOperation:A,breakResult:M,continueResult:O,multiReplace:R,isFunctionParameter:P,isSimpleType:I,defaultUndefined:L,isString:D,isBoolean:N,isNumber:F,isInteger:k,isArray:U,isFeature:V,isFeatureSet:z,isFeatureSetCollection:B,isImmutableArray:H,isDate:j,pcCheck:G,absRound:W,generateUUID:Z,formatNumber:q,formatDate:$,standardiseDateFormat:Y,greaterThanLessThan:J,equalityTest:K,toString:Q,toNumberArray:ee,toStringExplicit:te,toNumber:re,toDate:se,toDateTime:ne,toBoolean:ae,fixSpatialReference:le,fixNullGeometry:ce,getDomainValue:ue,getDomainCode:he,getDomain:de,stableStringify:fe,autoCastFeatureToGeometry:me,autoCastArrayOfPointsToPolygon:ye,autoCastArrayOfPointsToPolyline:_e,autoCastArrayOfPointsToMultiPoint:ve,toStringArray:be,tick:xe,binaryOperator:Ce,castAsJson:Te,castAsJsonAsync:Ee,featureFullDomain:Ae,featureSubtypes:Me,featureDomainValueLookup:Oe,featureDomainCodeLookup:Re,featureSchema:Pe},Symbol.toStringTag,{value:"Module"}))},40278:(e,t,i)=>{"use strict";i.d(t,{a:()=>d,b:()=>n,c:()=>u,f:()=>h,i:()=>s,m:()=>o,r:()=>a,s:()=>l,t:()=>c});var r=i(93011);function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function n(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function o(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],u=i[1],h=i[2],d=i[3],p=i[4],f=i[5];return e[0]=r*c+n*u,e[1]=s*c+o*u,e[2]=r*h+n*d,e[3]=s*h+o*d,e[4]=r*p+n*f+a,e[5]=s*p+o*f+l,e}function a(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),u=Math.cos(i);return e[0]=r*u+n*c,e[1]=s*u+o*c,e[2]=r*-c+n*u,e[3]=s*-c+o*u,e[4]=a,e[5]=l,e}function l(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],u=i[1];return e[0]=r*c,e[1]=s*c,e[2]=n*u,e[3]=o*u,e[4]=a,e[5]=l,e}function c(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],u=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*c+n*u+a,e[5]=s*c+o*u+l,e}function u(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function h(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function d(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function p(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}const f=o,m=p;Object.freeze(Object.defineProperty({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:s,set:function(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e},invert:n,determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:o,rotate:a,scale:l,translate:c,fromRotation:u,fromScaling:h,fromTranslation:d,str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},subtract:p,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=t[0],u=t[1],h=t[2],d=t[3],p=t[4],f=t[5];return Math.abs(i-c)<=r.E*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-u)<=r.E*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-h)<=r.E*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-d)<=r.E*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=r.E*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-f)<=r.E*Math.max(1,Math.abs(l),Math.abs(f))},mul:f,sub:m},Symbol.toStringTag,{value:"Module"}))},59566:(e,t,i)=>{"use strict";function r(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function s(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function n(e,t,i,r=0,n=0,o=2){const a=n||t.length/o;for(let n=r;n<a;n++)s(e,t,i,n*o)}i.d(t,{c:()=>r,t:()=>n}),Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:function(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},fromValues:function(e,t,i,r,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o},createView:function(e,t){return new Float32Array(e,t,6)},transform:s,transformMany:n},Symbol.toStringTag,{value:"Module"}))},1662:(e,t,i)=>{"use strict";i.d(t,{a:()=>m,b:()=>o,c:()=>u,d:()=>d,e:()=>l,f:()=>s,g:()=>p,i:()=>y,m:()=>c,n:()=>f,r:()=>h,s:()=>n,t:()=>a});var r=i(93011);function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function n(e,t,i,r,s,n,o,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function a(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function l(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*o-a*c,d=-u*n+a*l,p=c*n-o*l;let f=i*h+r*d+s*p;return f?(f=1/f,e[0]=h*f,e[1]=(-u*r+s*c)*f,e[2]=(a*r-s*o)*f,e[3]=d*f,e[4]=(u*i-s*l)*f,e[5]=(-a*i+s*n)*f,e[6]=p*f,e[7]=(-c*i+r*l)*f,e[8]=(o*i-r*n)*f,e):null}function c(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],y=i[5],_=i[6],v=i[7],b=i[8];return e[0]=d*r+p*o+f*c,e[1]=d*s+p*a+f*u,e[2]=d*n+p*l+f*h,e[3]=m*r+g*o+y*c,e[4]=m*s+g*a+y*u,e[5]=m*n+g*l+y*h,e[6]=_*r+v*o+b*c,e[7]=_*s+v*a+b*u,e[8]=_*n+v*l+b*h,e}function u(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=d*r+p*o+c,e[7]=d*s+p*a+u,e[8]=d*n+p*l+h,e}function h(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(i),p=Math.cos(i);return e[0]=p*r+d*o,e[1]=p*s+d*a,e[2]=p*n+d*l,e[3]=p*o-d*r,e[4]=p*a-d*s,e[5]=p*l-d*n,e[6]=c,e[7]=u,e[8]=h,e}function d(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function p(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,h=r*a,d=s*o,p=s*a,f=s*l,m=n*o,g=n*a,y=n*l;return e[0]=1-h-f,e[3]=u-y,e[6]=d+g,e[1]=u+y,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-h,e}function f(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10],h=u*o-a*c,d=-u*n+a*l,p=c*n-o*l,f=i*h+r*d+s*p;if(!f)return null;const m=1/f;return e[0]=h*m,e[1]=(-u*r+s*c)*m,e[2]=(a*r-s*o)*m,e[3]=d*m,e[4]=(u*i-s*l)*m,e[5]=(-a*i+s*n)*m,e[6]=p*m,e[7]=(-c*i+r*l)*m,e[8]=(o*i-r*n)*m,e}function m(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=i*a-r*o,v=i*l-s*o,b=i*c-n*o,w=r*l-s*a,x=r*c-n*a,C=s*c-n*l,T=u*m-h*f,S=u*g-d*f,E=u*y-p*f,A=h*g-d*m,M=h*y-p*m,O=d*y-p*g;let R=_*O-v*M+b*A+w*E-x*S+C*T;return R?(R=1/R,e[0]=(a*O-l*M+c*A)*R,e[1]=(l*E-o*O-c*S)*R,e[2]=(o*M-a*E+c*T)*R,e[3]=(s*M-r*O-n*A)*R,e[4]=(i*O-s*E+n*S)*R,e[5]=(r*E-i*M-n*T)*R,e[6]=(m*C-g*x+y*w)*R,e[7]=(g*b-f*C-y*v)*R,e[8]=(f*x-m*b+y*_)*R,e):null}function g(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function y(e){const t=r.E,i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8];return Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+u*u))<=t&&Math.abs(1-(n*n+l*l+h*h))<=t}const _=c,v=g;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:s,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},set:n,identity:o,transpose:a,invert:l,adjoint:function(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-a*c,e[1]=s*c-r*u,e[2]=r*a-s*o,e[3]=a*l-n*u,e[4]=i*u-s*l,e[5]=s*n-i*a,e[6]=n*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*n,e},determinant:function(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)},multiply:c,translate:u,rotate:h,scale:d,scaleByVec2:function(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:p,normalFromMat4Legacy:f,normalFromMat4:m,projection:function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},subtract:g,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=t[0],p=t[1],f=t[2],m=t[3],g=t[4],y=t[5],_=t[6],v=t[7],b=t[8];return Math.abs(i-d)<=r.E*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-p)<=r.E*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(n-f)<=r.E*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-m)<=r.E*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-g)<=r.E*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-y)<=r.E*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-_)<=r.E*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(u-v)<=r.E*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-b)<=r.E*Math.max(1,Math.abs(h),Math.abs(b))},isOrthoNormal:y,mul:_,sub:v},Symbol.toStringTag,{value:"Module"}))},19710:(e,t,i)=>{"use strict";function r(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function s(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function n(e,t,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}i.d(t,{a:()=>s,c:()=>r,f:()=>n}),Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:s,fromValues:n,createView:function(e,t){return new Float32Array(e,t,9)}},Symbol.toStringTag,{value:"Module"}))},34344:(e,t,i)=>{"use strict";function r(){return[1,0,0,0,1,0,0,0,1]}function s(e,t){return new Float64Array(e,t,9)}i.d(t,{a:()=>s,c:()=>r}),Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},fromValues:function(e,t,i,r,s,n,o,a,l){return[e,t,i,r,s,n,o,a,l]},createView:s},Symbol.toStringTag,{value:"Module"}))},24455:(e,t,i)=>{"use strict";i.d(t,{C:()=>T,a:()=>c,b:()=>w,c:()=>n,d:()=>v,e:()=>p,f:()=>y,g:()=>g,h:()=>d,i:()=>a,j:()=>h,k:()=>E,l:()=>A,m:()=>u,n:()=>O,o:()=>m,p:()=>D,q:()=>M,r:()=>f,s:()=>o,t:()=>l,u:()=>_,v:()=>L,w:()=>I,x:()=>S,y:()=>R,z:()=>b});var r=i(8909),s=i(93011);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e,t,i,r,s,n,o,a,l,c,u,h,d,p,f,m,g){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e}function a(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function c(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=i*a-r*o,v=i*l-s*o,b=i*c-n*o,w=r*l-s*a,x=r*c-n*a,C=s*c-n*l,T=u*m-h*f,S=u*g-d*f,E=u*y-p*f,A=h*g-d*m,M=h*y-p*m,O=d*y-p*g;let R=_*O-v*M+b*A+w*E-x*S+C*T;return R?(R=1/R,e[0]=(a*O-l*M+c*A)*R,e[1]=(s*M-r*O-n*A)*R,e[2]=(m*C-g*x+y*w)*R,e[3]=(d*x-h*C-p*w)*R,e[4]=(l*E-o*O-c*S)*R,e[5]=(i*O-s*E+n*S)*R,e[6]=(g*b-f*C-y*v)*R,e[7]=(u*C-d*b+p*v)*R,e[8]=(o*M-a*E+c*T)*R,e[9]=(r*E-i*M-n*T)*R,e[10]=(f*x-m*b+y*_)*R,e[11]=(h*b-u*x-p*_)*R,e[12]=(a*S-o*A-l*T)*R,e[13]=(i*A-r*S+s*T)*R,e[14]=(m*v-f*w-g*_)*R,e[15]=(u*w-h*v+d*_)*R,e):null}function u(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15];let v=i[0],b=i[1],w=i[2],x=i[3];return e[0]=v*r+b*a+w*h+x*m,e[1]=v*s+b*l+w*d+x*g,e[2]=v*n+b*c+w*p+x*y,e[3]=v*o+b*u+w*f+x*_,v=i[4],b=i[5],w=i[6],x=i[7],e[4]=v*r+b*a+w*h+x*m,e[5]=v*s+b*l+w*d+x*g,e[6]=v*n+b*c+w*p+x*y,e[7]=v*o+b*u+w*f+x*_,v=i[8],b=i[9],w=i[10],x=i[11],e[8]=v*r+b*a+w*h+x*m,e[9]=v*s+b*l+w*d+x*g,e[10]=v*n+b*c+w*p+x*y,e[11]=v*o+b*u+w*f+x*_,v=i[12],b=i[13],w=i[14],x=i[15],e[12]=v*r+b*a+w*h+x*m,e[13]=v*s+b*l+w*d+x*g,e[14]=v*n+b*c+w*p+x*y,e[15]=v*o+b*u+w*f+x*_,e}function h(e,t,i){const r=i[0],s=i[1],n=i[2];if(t===e)e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15];else{const i=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7],p=t[8],f=t[9],m=t[10],g=t[11];e[0]=i,e[1]=o,e[2]=a,e[3]=l,e[4]=c,e[5]=u,e[6]=h,e[7]=d,e[8]=p,e[9]=f,e[10]=m,e[11]=g,e[12]=i*r+c*s+p*n+t[12],e[13]=o*r+u*s+f*n+t[13],e[14]=a*r+h*s+m*n+t[14],e[15]=l*r+d*s+g*n+t[15]}return e}function d(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function p(e,t,i,r){let n,o,a,l,c,u,h,d,p,f,m,g,y,_,v,b,w,x,C,T,S,E,A,M,O=r[0],R=r[1],P=r[2],I=Math.sqrt(O*O+R*R+P*P);return I<s.E?null:(I=1/I,O*=I,R*=I,P*=I,n=Math.sin(i),o=Math.cos(i),a=1-o,l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],p=t[5],f=t[6],m=t[7],g=t[8],y=t[9],_=t[10],v=t[11],b=O*O*a+o,w=R*O*a+P*n,x=P*O*a-R*n,C=O*R*a-P*n,T=R*R*a+o,S=P*R*a+O*n,E=O*P*a+R*n,A=R*P*a-O*n,M=P*P*a+o,e[0]=l*b+d*w+g*x,e[1]=c*b+p*w+y*x,e[2]=u*b+f*w+_*x,e[3]=h*b+m*w+v*x,e[4]=l*C+d*T+g*S,e[5]=c*C+p*T+y*S,e[6]=u*C+f*T+_*S,e[7]=h*C+m*T+v*S,e[8]=l*E+d*A+g*M,e[9]=c*E+p*A+y*M,e[10]=u*E+f*A+_*M,e[11]=h*E+m*A+v*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function f(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*r,e[5]=o*s+u*r,e[6]=a*s+h*r,e[7]=l*s+d*r,e[8]=c*s-n*r,e[9]=u*s-o*r,e[10]=h*s-a*r,e[11]=d*s-l*r,e}function m(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*r,e[1]=o*s-u*r,e[2]=a*s-h*r,e[3]=l*s-d*r,e[8]=n*r+c*s,e[9]=o*r+u*s,e[10]=a*r+h*s,e[11]=l*r+d*s,e}function g(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*r,e[1]=o*s+u*r,e[2]=a*s+h*r,e[3]=l*s+d*r,e[4]=c*s-n*r,e[5]=u*s-o*r,e[6]=h*s-a*r,e[7]=d*s-l*r,e}function y(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function _(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t,i){let r,n,o,a=i[0],l=i[1],c=i[2],u=Math.sqrt(a*a+l*l+c*c);return u<s.E?null:(u=1/u,a*=u,l*=u,c*=u,r=Math.sin(t),n=Math.cos(t),o=1-n,e[0]=a*a*o+n,e[1]=l*a*o+c*r,e[2]=c*a*o-l*r,e[3]=0,e[4]=a*l*o-c*r,e[5]=l*l*o+n,e[6]=c*l*o+a*r,e[7]=0,e[8]=a*c*o+l*r,e[9]=l*c*o-a*r,e[10]=c*c*o+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function b(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,l=s+s,c=n+n,u=r*a,h=r*l,d=r*c,p=s*l,f=s*c,m=n*c,g=o*a,y=o*l,_=o*c;return e[0]=1-(p+m),e[1]=h+_,e[2]=d-y,e[3]=0,e[4]=h-_,e[5]=1-(u+m),e[6]=f+g,e[7]=0,e[8]=d+y,e[9]=f-g,e[10]=1-(u+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}const C=(0,r.c)();function T(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function S(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function E(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,h=r*a,d=s*o,p=s*a,f=s*l,m=n*o,g=n*a,y=n*l;return e[0]=1-h-f,e[1]=u+y,e[2]=d-g,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function A(e,t,i,r,s,n,o){const a=1/(i-t),l=1/(s-r),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(s+r)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function M(e,t,i,r,s,n,o){const a=1/(t-i),l=1/(r-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(s+r)*l,e[14]=(o+n)*c,e[15]=1,e}function O(e,t,i,r){let n,o,l,c,u,h,d,p,f,m;const g=t[0],y=t[1],_=t[2],v=r[0],b=r[1],w=r[2],x=i[0],C=i[1],T=i[2];return Math.abs(g-x)<s.E&&Math.abs(y-C)<s.E&&Math.abs(_-T)<s.E?a(e):(d=g-x,p=y-C,f=_-T,m=1/Math.sqrt(d*d+p*p+f*f),d*=m,p*=m,f*=m,n=b*f-w*p,o=w*d-v*f,l=v*p-b*d,m=Math.sqrt(n*n+o*o+l*l),m?(m=1/m,n*=m,o*=m,l*=m):(n=0,o=0,l=0),c=p*l-f*o,u=f*n-d*l,h=d*o-p*n,m=Math.sqrt(c*c+u*u+h*h),m?(m=1/m,c*=m,u*=m,h*=m):(c=0,u=0,h=0),e[0]=n,e[1]=c,e[2]=d,e[3]=0,e[4]=o,e[5]=u,e[6]=p,e[7]=0,e[8]=l,e[9]=h,e[10]=f,e[11]=0,e[12]=-(n*g+o*y+l*_),e[13]=-(c*g+u*y+h*_),e[14]=-(d*g+p*y+f*_),e[15]=1,e)}function R(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=r[0],l=r[1],c=r[2];let u=s-i[0],h=n-i[1],d=o-i[2],p=u*u+h*h+d*d;p>0&&(p=1/Math.sqrt(p),u*=p,h*=p,d*=p);let f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return p=f*f+m*m+g*g,p>0&&(p=1/Math.sqrt(p),f*=p,m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*f-u*g,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function P(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function I(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function L(e,t){if(e===t)return!0;const i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=t[0],b=t[1],w=t[2],x=t[3],C=t[4],T=t[5],S=t[6],E=t[7],A=t[8],M=t[9],O=t[10],R=t[11],P=t[12],I=t[13],L=t[14],D=t[15];return Math.abs(i-v)<=s.E*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-b)<=s.E*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(n-w)<=s.E*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(o-x)<=s.E*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-C)<=s.E*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(l-T)<=s.E*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-S)<=s.E*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-E)<=s.E*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-A)<=s.E*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-M)<=s.E*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(p-O)<=s.E*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(f-R)<=s.E*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(m-P)<=s.E*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(g-I)<=s.E*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(y-L)<=s.E*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(_-D)<=s.E*Math.max(1,Math.abs(_),Math.abs(D))}function D(e){const t=s.E,i=e[0],r=e[1],n=e[2],o=e[4],a=e[5],l=e[6],c=e[8],u=e[9],h=e[10];return Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(r*r+a*a+u*u))<=t&&Math.abs(1-(n*n+l*l+h*h))<=t}const N=u,F=P;Object.freeze(Object.defineProperty({__proto__:null,copy:n,set:o,identity:a,transpose:l,invert:c,adjoint:function(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15];return e[0]=a*(d*y-p*g)-h*(l*y-c*g)+m*(l*p-c*d),e[1]=-(r*(d*y-p*g)-h*(s*y-n*g)+m*(s*p-n*d)),e[2]=r*(l*y-c*g)-a*(s*y-n*g)+m*(s*c-n*l),e[3]=-(r*(l*p-c*d)-a*(s*p-n*d)+h*(s*c-n*l)),e[4]=-(o*(d*y-p*g)-u*(l*y-c*g)+f*(l*p-c*d)),e[5]=i*(d*y-p*g)-u*(s*y-n*g)+f*(s*p-n*d),e[6]=-(i*(l*y-c*g)-o*(s*y-n*g)+f*(s*c-n*l)),e[7]=i*(l*p-c*d)-o*(s*p-n*d)+u*(s*c-n*l),e[8]=o*(h*y-p*m)-u*(a*y-c*m)+f*(a*p-c*h),e[9]=-(i*(h*y-p*m)-u*(r*y-n*m)+f*(r*p-n*h)),e[10]=i*(a*y-c*m)-o*(r*y-n*m)+f*(r*c-n*a),e[11]=-(i*(a*p-c*h)-o*(r*p-n*h)+u*(r*c-n*a)),e[12]=-(o*(h*g-d*m)-u*(a*g-l*m)+f*(a*d-l*h)),e[13]=i*(h*g-d*m)-u*(r*g-s*m)+f*(r*d-s*h),e[14]=-(i*(a*g-l*m)-o*(r*g-s*m)+f*(r*l-s*a)),e[15]=i*(a*d-l*h)-o*(r*d-s*h)+u*(r*l-s*a),e},determinant:function(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*o-i*n)*(h*g-d*m)-(t*a-r*n)*(u*g-d*f)+(t*l-s*n)*(u*m-h*f)+(i*a-r*o)*(c*g-d*p)-(i*l-s*o)*(c*m-h*p)+(r*l-s*a)*(c*f-u*p)},multiply:u,translate:h,scale:d,rotate:p,rotateX:f,rotateY:m,rotateZ:g,fromTranslation:y,fromScaling:_,fromRotation:v,fromXRotation:b,fromYRotation:function(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:w,fromRotationTranslation:x,fromQuat2:function(e,t){const i=C,r=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=r*r+s*s+n*n+o*o;return h>0?(i[0]=2*(a*o+u*r+l*n-c*s)/h,i[1]=2*(l*o+u*s+c*r-a*n)/h,i[2]=2*(c*o+u*n+a*s-l*r)/h):(i[0]=2*(a*o+u*r+l*n-c*s),i[1]=2*(l*o+u*s+c*r-a*n),i[2]=2*(c*o+u*n+a*s-l*r)),x(e,t,i),e},getTranslation:T,getScaling:S,getRotation:function(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e},fromRotationTranslationScale:function(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,u=o+o,h=s*l,d=s*c,p=s*u,f=n*c,m=n*u,g=o*u,y=a*l,_=a*c,v=a*u,b=r[0],w=r[1],x=r[2];return e[0]=(1-(f+g))*b,e[1]=(d+v)*b,e[2]=(p-_)*b,e[3]=0,e[4]=(d-v)*w,e[5]=(1-(h+g))*w,e[6]=(m+y)*w,e[7]=0,e[8]=(p+_)*x,e[9]=(m-y)*x,e[10]=(1-(h+f))*x,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,i,r,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,u=o+o,h=a+a,d=n*c,p=n*u,f=n*h,m=o*u,g=o*h,y=a*h,_=l*c,v=l*u,b=l*h,w=r[0],x=r[1],C=r[2],T=s[0],S=s[1],E=s[2],A=(1-(m+y))*w,M=(p+b)*w,O=(f-v)*w,R=(p-b)*x,P=(1-(d+y))*x,I=(g+_)*x,L=(f+v)*C,D=(g-_)*C,N=(1-(d+m))*C;return e[0]=A,e[1]=M,e[2]=O,e[3]=0,e[4]=R,e[5]=P,e[6]=I,e[7]=0,e[8]=L,e[9]=D,e[10]=N,e[11]=0,e[12]=i[0]+T-(A*T+R*S+L*E),e[13]=i[1]+S-(M*T+P*S+D*E),e[14]=i[2]+E-(O*T+I*S+N*E),e[15]=1,e},fromQuat:E,frustum:A,perspective:function(e,t,i,r,s){const n=1/Math.tan(t/2);let o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e},perspectiveFromFieldOfView:function(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e},ortho:M,lookAt:O,targetTo:R,str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},subtract:P,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e},exactEquals:I,equals:L,isOrthoNormal:D,mul:N,sub:F},Symbol.toStringTag,{value:"Module"}))},64790:(e,t,i)=>{"use strict";function r(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}i.d(t,{c:()=>r});const s=r();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:function(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(e,t,i,r,s,n,o,a,l,c,u,h,d,p,f,m){const g=new Float32Array(16);return g[0]=e,g[1]=t,g[2]=i,g[3]=r,g[4]=s,g[5]=n,g[6]=o,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},createView:function(e,t){return new Float32Array(e,t,16)},IDENTITY:s},Symbol.toStringTag,{value:"Module"}))},39100:(e,t,i)=>{"use strict";function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function s(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function n(e,t,i,r,s,n,o,a,l,c,u,h,d,p,f,m){return[e,t,i,r,s,n,o,a,l,c,u,h,d,p,f,m]}function o(e,t){return new Float64Array(e,t,16)}i.d(t,{I:()=>a,a:()=>o,b:()=>s,c:()=>r,f:()=>n});const a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:s,fromValues:n,createView:o,IDENTITY:a},Symbol.toStringTag,{value:"Module"}))},96926:(e,t,i)=>{"use strict";i.d(t,{e:()=>h,f:()=>u,g:()=>c,h:()=>g,i:()=>a,j:()=>w,l:()=>l,p:()=>M});var r=i(36567),s=i(39994);let n,o=null;function a(){return!!o}function l(){return n||(n=i.e(8506).then(i.bind(i,28506)).then((e=>e.p)).then((({default:e})=>e({locateFile:e=>(0,r.V)(`esri/geometry/support/${e}`)}))).then((e=>{C(e)})),n)}var c,u,h,d;!function(e){function t(e,t,i){o.ensureCache.prepare();const r=E(i),s=i===r,n=o.ensureFloat64(r),a=o._pe_geog_to_proj(o.getPointer(e),t,n);return a&&A(i,t,n,s),a}function i(e,t,i){return r(e,t,i,0)}function r(e,t,i,r){o.ensureCache.prepare();const s=E(i),n=i===s,a=o.ensureFloat64(s),l=o._pe_proj_to_geog_center(o.getPointer(e),t,a,r);return l&&A(i,t,a,n),l}e.geogToProj=t,e.projGeog=function(e,r,s,n){switch(n){case u.PE_TRANSFORM_P_TO_G:return i(e,r,s);case u.PE_TRANSFORM_G_TO_P:return t(e,r,s)}return 0},e.projToGeog=i,e.projToGeogCenter=r}(c||(c={})),(d=u||(u={})).init=function(){d.PE_BUFFER_MAX=o.PeDefs.prototype.PE_BUFFER_MAX,d.PE_NAME_MAX=o.PeDefs.prototype.PE_NAME_MAX,d.PE_MGRS_MAX=o.PeDefs.prototype.PE_MGRS_MAX,d.PE_USNG_MAX=o.PeDefs.prototype.PE_USNG_MAX,d.PE_DD_MAX=o.PeDefs.prototype.PE_DD_MAX,d.PE_DDM_MAX=o.PeDefs.prototype.PE_DDM_MAX,d.PE_DMS_MAX=o.PeDefs.prototype.PE_DMS_MAX,d.PE_UTM_MAX=o.PeDefs.prototype.PE_UTM_MAX,d.PE_PARM_MAX=o.PeDefs.prototype.PE_PARM_MAX,d.PE_TYPE_NONE=o.PeDefs.prototype.PE_TYPE_NONE,d.PE_TYPE_GEOGCS=o.PeDefs.prototype.PE_TYPE_GEOGCS,d.PE_TYPE_PROJCS=o.PeDefs.prototype.PE_TYPE_PROJCS,d.PE_TYPE_GEOGTRAN=o.PeDefs.prototype.PE_TYPE_GEOGTRAN,d.PE_TYPE_COORDSYS=o.PeDefs.prototype.PE_TYPE_COORDSYS,d.PE_TYPE_UNIT=o.PeDefs.prototype.PE_TYPE_UNIT,d.PE_TYPE_LINUNIT=o.PeDefs.prototype.PE_TYPE_LINUNIT,d.PE_STR_OPTS_NONE=o.PeDefs.prototype.PE_STR_OPTS_NONE,d.PE_STR_AUTH_NONE=o.PeDefs.prototype.PE_STR_AUTH_NONE,d.PE_STR_AUTH_TOP=o.PeDefs.prototype.PE_STR_AUTH_TOP,d.PE_STR_NAME_CANON=o.PeDefs.prototype.PE_STR_NAME_CANON,d.PE_PARM_X0=o.PeDefs.prototype.PE_PARM_X0,d.PE_PARM_ND=o.PeDefs.prototype.PE_PARM_ND,d.PE_TRANSFORM_1_TO_2=o.PeDefs.prototype.PE_TRANSFORM_1_TO_2,d.PE_TRANSFORM_2_TO_1=o.PeDefs.prototype.PE_TRANSFORM_2_TO_1,d.PE_TRANSFORM_P_TO_G=o.PeDefs.prototype.PE_TRANSFORM_P_TO_G,d.PE_TRANSFORM_G_TO_P=o.PeDefs.prototype.PE_TRANSFORM_G_TO_P,d.PE_HORIZON_RECT=o.PeDefs.prototype.PE_HORIZON_RECT,d.PE_HORIZON_POLY=o.PeDefs.prototype.PE_HORIZON_POLY,d.PE_HORIZON_LINE=o.PeDefs.prototype.PE_HORIZON_LINE,d.PE_HORIZON_DELTA=o.PeDefs.prototype.PE_HORIZON_DELTA},function(e){const t={},i={},r=e=>{if(e){const t=e.getType();switch(t){case u.PE_TYPE_GEOGCS:e=o.castObject(e,o.PeGeogcs);break;case u.PE_TYPE_PROJCS:e=o.castObject(e,o.PeProjcs);break;case u.PE_TYPE_GEOGTRAN:e=o.castObject(e,o.PeGeogtran);break;default:t&u.PE_TYPE_UNIT&&(e=o.castObject(e,o.PeUnit))}}return e};function s(e,i){let s=null,n=t[e];if(n||(n={},t[e]=n),n.hasOwnProperty(String(i)))s=n[i];else{const t=o.PeFactory.prototype.factoryByType(e,i);o.compare(t,o.NULL)||(s=t,n[i]=s)}return s=r(s),s}e.initialize=function(){o.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return s(u.PE_TYPE_COORDSYS,e)},e.factoryByType=s,e.fromString=function(e,t){let s=null,n=i[e];if(n||(n={},i[e]=n),n.hasOwnProperty(t))s=n[t];else{const i=o.PeFactory.prototype.fromString(e,t);o.compare(i,o.NULL)||(s=i,n[t]=s)}return s=r(s),s},e.geogcs=function(e){return s(u.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return s(u.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return o.PeFactory.prototype.getCode(e)},e.projcs=function(e){return s(u.PE_TYPE_PROJCS,e)},e.unit=function(e){return s(u.PE_TYPE_UNIT,e)}}(h||(h={}));let p=null;var f,m,g,y,_,v,b,w,x;function C(e){function t(e,t,i){e[t]=i(e[t])}o=e,u.init(),f.init(),_.init(),b.init(),w.init(),p=class extends o.PeGCSExtent{destroy(){o.destroy(this)}};const i=[o.PeDatum,o.PeGeogcs,o.PeGeogtran,o.PeObject,o.PeParameter,o.PePrimem,o.PeProjcs,o.PeSpheroid,o.PeUnit];for(const e of i)t(e.prototype,"getName",(e=>function(){return e.call(this,new Array(u.PE_NAME_MAX))}));for(const e of[o.PeGeogtran,o.PeProjcs])t(e.prototype,"getParameters",(e=>function(){const t=new Array(u.PE_PARM_MAX);let i=e.call(this);for(let e=0;e<t.length;e++){const r=o.getValue(i,"*");t[e]=r?o.wrapPointer(r,o.PeParameter):null,i+=Int32Array.BYTES_PER_ELEMENT}return t}));t(o.PeHorizon.prototype,"getCoord",(e=>function(){const t=this.getSize();if(!t)return null;const i=[];return A(i,t,e.call(this)),i})),t(o.PeGTlistExtendedEntry.prototype,"getEntries",(e=>{const t=o._pe_getPeGTlistExtendedGTsSize();return function(){let i=null;const r=e.call(this);if(!o.compare(r,o.NULL)){i=[r];const e=this.getSteps();if(e>1){const s=o.getPointer(r);for(let r=1;r<e;r++)i.push(o.wrapPointer(s+t*r,o.PeGTlistExtendedGTs))}}return i}}));const r=o._pe_getPeHorizonSize(),s=e=>function(){let t=this._cache;if(t||(t=new Map,this._cache=t),t.has(e))return t.get(e);let i=null;const s=e.call(this);if(!o.compare(s,o.NULL)){i=[s];const e=s.getNump();if(e>1){const t=o.getPointer(s);for(let s=1;s<e;s++)i.push(o.wrapPointer(t+r*s,o.PeHorizon))}}return t.set(e,i),i};t(o.PeProjcs.prototype,"horizonGcsGenerate",s),t(o.PeProjcs.prototype,"horizonPcsGenerate",s),o.PeObject.prototype.toString=function(e=u.PE_STR_OPTS_NONE){o.ensureCache.prepare();const t=o.getPointer(this),i=o.ensureInt8(new Array(u.PE_BUFFER_MAX));return o.UTF8ToString(o._pe_object_to_string_ext(t,e,i))}}function T(e){if(!e)return;const t=o.getClass(e);if(!t)return;const i=o.getCache(t);if(!i)return;const r=o.getPointer(e);r&&delete i[r]}function S(e,t){const i=[],r=new Array(t);for(let t=0;t<e;t++)i.push(o.ensureInt8(r));return i}function E(e){let t;return Array.isArray(e[0])?(t=[],e.forEach((e=>{t.push(e[0],e[1])}))):t=e,t}function A(e,t,i,r=!1){if(r)for(let r=0;r<2*t;r++)e[r]=o.getValue(i+r*Float64Array.BYTES_PER_ELEMENT,"double");else{const r=0===e.length;for(let s=0;s<t;s++)r&&(e[s]=new Array(2)),e[s][0]=o.getValue(i,"double"),e[s][1]=o.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}!function(e){let t;e.init=function(){e.PE_GTLIST_OPTS_COMMON=o.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=o._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,i,r,s,n,a){let l=null;const c=new o.PeInteger(a);try{const u=o.PeGTlistExtended.prototype.getGTlist(e,i,r,s,n,c);if((a=c.val)&&(l=[u],a>1)){const e=o.getPointer(u);for(let i=1;i<a;i++)l.push(o.wrapPointer(e+t*i,o.PeGTlistExtendedEntry))}}finally{o.destroy(c)}return l}}(f||(f={})),function(e){e.destroy=function(e){if(e&&e.length){for(const t of e)T(t),t.getEntries().forEach((e=>{T(e);const t=e.getGeogtran();T(t),t.getParameters().forEach(T),[t.getGeogcs1(),t.getGeogcs2()].forEach((e=>{T(e);const t=e.getDatum();T(t),T(t.getSpheroid()),T(e.getPrimem()),T(e.getUnit())}))}));o.PeGTlistExtendedEntry.prototype.Delete(e[0])}}}(m||(m={})),function(e){e.geogToGeog=function(e,t,i,r,s){o.ensureCache.prepare();const n=E(i),a=i===n,l=o.ensureFloat64(n);let c=0;r&&(c=o.ensureFloat64(r));const u=o._pe_geog_to_geog(o.getPointer(e),t,l,c,s);return u&&A(i,t,l,a),u}}(g||(g={})),function(e){const t=(e,t,i,r,s,n)=>{let a,l;switch(o.ensureCache.prepare(),e){case"dd":a=o._pe_geog_to_dd,l=u.PE_DD_MAX;break;case"ddm":a=o._pe_geog_to_ddm,l=u.PE_DDM_MAX;break;case"dms":a=o._pe_geog_to_dms,l=u.PE_DMS_MAX}let c=0;t&&(c=o.getPointer(t));const h=E(r),d=o.ensureFloat64(h),p=S(i,l),f=a(c,i,d,s,o.ensureInt32(p));if(f)for(let e=0;e<i;e++)n[e]=o.UTF8ToString(p[e]);return f},i=(e,t,i,r,s)=>{let n;switch(o.ensureCache.prepare(),e){case"dd":n=o._pe_dd_to_geog;break;case"ddm":n=o._pe_ddm_to_geog;break;case"dms":n=o._pe_dms_to_geog}let a=0;t&&(a=o.getPointer(t));const l=r.map((e=>o.ensureString(e))),c=o.ensureInt32(l),u=o.ensureFloat64(new Array(2*i)),h=n(a,i,c,u);return h&&A(s,i,u),h};e.geogToDms=function(e,i,r,s,n){return t("dms",e,i,r,s,n)},e.dmsToGeog=function(e,t,r,s){return i("dms",e,t,r,s)},e.geogToDdm=function(e,i,r,s,n){return t("ddm",e,i,r,s,n)},e.ddmToGeog=function(e,t,r,s){return i("ddm",e,t,r,s)},e.geogToDd=function(e,i,r,s,n){return t("dd",e,i,r,s,n)},e.ddToGeog=function(e,t,r,s){return i("dd",e,t,r,s)}}(y||(y={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=o.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=o.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=o.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=o.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=o.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geogToMgrsExtended=function(e,t,i,r,s,n,a){o.ensureCache.prepare();let l=0;e&&(l=o.getPointer(e));const c=E(i),h=o.ensureFloat64(c),d=S(t,u.PE_MGRS_MAX),p=o.ensureInt32(d),f=o._pe_geog_to_mgrs_extended(l,t,h,r,s,n,p);if(f)for(let e=0;e<t;e++)a[e]=o.UTF8ToString(d[e]);return f},e.mgrsToGeogExtended=function(e,t,i,r,s){o.ensureCache.prepare();let n=0;e&&(n=o.getPointer(e));const a=i.map((e=>o.ensureString(e))),l=o.ensureInt32(a),c=o.ensureFloat64(new Array(2*t)),u=o._pe_mgrs_to_geog_extended(n,t,l,r,c);return u&&A(s,t,c),u}}(_||(_={})),function(e){e.geogToUsng=function(e,t,i,r,s,n,a){o.ensureCache.prepare();let l=0;e&&(l=o.getPointer(e));const c=E(i),h=o.ensureFloat64(c),d=S(t,u.PE_MGRS_MAX),p=o.ensureInt32(d),f=o._pe_geog_to_usng(l,t,h,r,s,n,p);if(f)for(let e=0;e<t;e++)a[e]=o.UTF8ToString(d[e]);return f},e.usngToGeog=function(e,t,i,r){o.ensureCache.prepare();let s=0;e&&(s=o.getPointer(e));const n=i.map((e=>o.ensureString(e))),a=o.ensureInt32(n),l=o.ensureFloat64(new Array(2*t)),c=o._pe_usng_to_geog(s,t,a,l);return c&&A(r,t,l),c}}(v||(v={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=o.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=o.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=o.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geogToUtm=function(e,t,i,r,s){o.ensureCache.prepare();let n=0;e&&(n=o.getPointer(e));const a=E(i),l=o.ensureFloat64(a),c=S(t,u.PE_UTM_MAX),h=o.ensureInt32(c),d=o._pe_geog_to_utm(n,t,l,r,h);if(d)for(let e=0;e<t;e++)s[e]=o.UTF8ToString(c[e]);return d},e.utmToGeog=function(e,t,i,r,s){o.ensureCache.prepare();let n=0;e&&(n=o.getPointer(e));const a=i.map((e=>o.ensureString(e))),l=o.ensureInt32(a),c=o.ensureFloat64(new Array(2*t)),u=o._pe_utm_to_geog(n,t,l,r,c);return u&&A(s,t,c),u}}(b||(b={})),function(e){const t=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=o.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=o.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=o.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=o.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(i,r=e.PE_PCSINFO_OPTION_DOMAIN){let s,n;return t.has(i)&&(n=t.get(i),n[r]&&(s=n[r])),s||(s=o.PePCSInfo.prototype.generate(i,r),n||(n=[],t.set(i,n)),n[r]=s),s}}(w||(w={})),function(e){e.versionString=function(){return o.PeVersion.prototype.version_string()}}(x||(x={}));const M=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return o},isLoaded:a,isSupported:function(){return!!(0,s.Z)("esri-wasm")},load:l,get PeCSTransformations(){return c},get PeDefs(){return u},get PeFactory(){return h},get PeGCSExtent(){return p},get PeGTlistExtended(){return f},get PeGTlistExtendedEntry(){return m},get PeGTTransformations(){return g},get PeNotationDms(){return y},get PeNotationMgrs(){return _},get PeNotationUsng(){return v},get PeNotationUtm(){return b},get PePCSInfo(){return w},get PeVersion(){return x},_init:C},Symbol.toStringTag,{value:"Module"}))},16641:(e,t,i)=>{"use strict";i.d(t,{M:()=>f,e:()=>d,f:()=>n,i:()=>h,p:()=>g,r:()=>a,t:()=>o,w:()=>l});var r=i(61681),s=i(3466);function n(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=(0,s.hF)(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const i=(0,s.PF)(e,t.portalItem.itemUrl);u.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return p(e,t&&t.portal)}function o(e,t,i=f.YES){if(!e)return e;!(0,s.YP)(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=(0,s.hF)(e);if(t){const i=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(i){const n=p(i,t.portal);r=(0,s.PF)(p(r,t.portal),n,n),r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=d(r,t&&t.portal),(0,s.YP)(r)&&(r=(0,s.Fv)(r)),t?.resources&&t?.portalItem&&!(0,s.YP)(r)&&!(0,s.HK)(r)&&i===f.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r)}),r}function a(e,t,i){return n(e,i)}function l(e,t,i,r){const s=o(e,r);void 0!==s&&(t[i]=s)}const c=/\/items\/([^\/]+)\/resources\//,u=/^\.\/resources\//;function h(e){const t=(0,r.pC)(e)?e.match(c):null;return(0,r.pC)(t)?t[1]:null}function d(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?(0,s.Ie)(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function p(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=(0,s.TI)();return(0,s.D6)(r,`${r.scheme}://${i}`)?(0,s.Ie)(e,t.portalHostname,i):(0,s.Ie)(e,i,t.portalHostname)}var f,m;(m=f||(f={}))[m.YES=0]="YES",m[m.NO=1]="NO";const g=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:n,toJSON:o,read:a,write:l,itemIdFromResourceUrl:h,ensureMainOnlineDomain:d,get MarkKeep(){return f}},Symbol.toStringTag,{value:"Module"}))},10663:(e,t,i)=>{"use strict";i.d(t,{a:()=>g,c:()=>p,g:()=>u,j:()=>M,k:()=>m,m:()=>h,r:()=>R,s:()=>c});var r=i(34344),s=i(61044),n=i(8909),o=i(93011),a=i(6766),l=i(88589);function c(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function u(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>o.E?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function h(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=r*u+o*a+s*c-n*l,e[1]=s*u+o*l+n*a-r*c,e[2]=n*u+o*c+r*l-s*a,e[3]=o*u-r*a-s*l-n*c,e}function d(e,t,i,r){const s=t[0],n=t[1],a=t[2],l=t[3];let c,u,h,d,p,f=i[0],m=i[1],g=i[2],y=i[3];return u=s*f+n*m+a*g+l*y,u<0&&(u=-u,f=-f,m=-m,g=-g,y=-y),1-u>o.E?(c=Math.acos(u),h=Math.sin(c),d=Math.sin((1-r)*c)/h,p=Math.sin(r*c)/h):(d=1-r,p=r),e[0]=d*s+p*f,e[1]=d*n+p*m,e[2]=d*a+p*g,e[3]=d*l+p*y,e}function p(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function f(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*s+s]-t[3*n+n]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*s+n]-t[3*n+s])*r,e[s]=(t[3*s+i]+t[3*i+s])*r,e[n]=(t[3*n+i]+t[3*i+n])*r}return e}function m(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return e[0]=n*l*u-o*a*c,e[1]=o*a*u+n*l*c,e[2]=o*l*c-n*a*u,e[3]=o*l*u+n*a*c,e}const g=l.c,y=l.s,_=l.a,v=h,b=l.b,w=l.d,x=l.l,C=l.e,T=C,S=l.f,E=S,A=l.n,M=l.g,O=l.h;function R(e,t,i){const r=(0,a.e)(t,i);return r<-.999999?((0,a.f)(P,I,t),(0,a.u)(P)<1e-6&&(0,a.f)(P,L,t),(0,a.n)(P,P),c(e,P,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,a.f)(P,t,i),e[0]=P[0],e[1]=P[1],e[2]=P[2],e[3]=1+r,A(e,e))}const P=(0,n.c)(),I=(0,n.f)(1,0,0),L=(0,n.f)(0,1,0),D=(0,s.a)(),N=(0,s.a)(),F=(0,r.c)();Object.freeze(Object.defineProperty({__proto__:null,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:c,getAxisAngle:u,multiply:h,rotateX:function(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-r*a,e},rotateY:function(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=s*l+o*a,e[2]=n*l+r*a,e[3]=o*l-s*a,e},rotateZ:function(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=s*l-r*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e},calculateW:function(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e},slerp:d,random:function(e){const t=(0,o.R)(),i=(0,o.R)(),r=(0,o.R)(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e},invert:function(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-s*a,e[3]=n*a,e},conjugate:p,fromMat3:f,fromEuler:m,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},copy:g,set:y,add:_,mul:v,scale:b,dot:w,lerp:x,length:C,len:T,squaredLength:S,sqrLen:E,normalize:A,exactEquals:M,equals:O,rotationTo:R,sqlerp:function(e,t,i,r,s,n){return d(D,t,s,n),d(N,i,r,n),d(e,D,N,2*n*(1-n)),e},setAxes:function(e,t,i,r){const s=F;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],A(e,f(e,s))}},Symbol.toStringTag,{value:"Module"}))},70347:(e,t,i)=>{"use strict";function r(){const e=new Float32Array(4);return e[3]=1,e}function s(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function n(e,t){return new Float32Array(e,t,4)}i.d(t,{a:()=>s,b:()=>n,c:()=>r}),Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:s,fromValues:function(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s},createView:n},Symbol.toStringTag,{value:"Module"}))},61044:(e,t,i)=>{"use strict";function r(){return[0,0,0,1]}function s(e){return[e[0],e[1],e[2],e[3]]}function n(e,t){return new Float64Array(e,t,4)}i.d(t,{I:()=>o,a:()=>r,b:()=>s,c:()=>n});const o=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:s,fromValues:function(e,t,i,r){return[e,t,i,r]},createView:n,IDENTITY:o},Symbol.toStringTag,{value:"Module"}))},15642:(e,t,i)=>{"use strict";function r(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}i.d(t,{m:()=>r}),Object.freeze(Object.defineProperty({__proto__:null,copy:function(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let e=0;e<a;++e)r[l]=n[c],l+=s,c+=o},makeDense:r},Symbol.toStringTag,{value:"Module"}))},91917:(e,t,i)=>{"use strict";i.d(t,{a:()=>b,b:()=>y,c:()=>g,d:()=>x,e:()=>R,f:()=>T,g:()=>C,h:()=>S,i:()=>A,j:()=>M,k:()=>w,l:()=>_,m:()=>N,s:()=>U,t:()=>k,w:()=>v}),i(39994);var r=i(13802),s=i(19431),n=i(61681),o=i(24455),a=i(6766),l=i(8909),c=i(88589),u=i(1983),h=i(19546),d=i(97537),p=i(5700),f=i(68817);const m=r.Z.getLogger("esri.geometry.support.sphere");function g(){return(0,u.c)()}function y(e,t=g()){return(0,c.c)(t,e)}function _(e,t){return(0,u.f)(e[0],e[1],e[2],t)}function v(e){return e}function b(e){e[0]=e[1]=e[2]=e[3]=0}function w(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function x(e){return e[3]}function C(e){return e}function T(e,t,i,r){return(0,u.f)(e,t,i,r)}function S(e,t,i){if((0,n.Wi)(t))return!1;const{origin:r,direction:s}=t,o=E;o[0]=r[0]-e[0],o[1]=r[1]-e[1],o[2]=r[2]-e[2];const a=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],l=2*(s[0]*o[0]+s[1]*o[1]+s[2]*o[2]),c=l*l-4*a*(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]-e[3]*e[3]);if(c<0)return!1;const u=Math.sqrt(c);let h=(-l-u)/(2*a);const d=(-l+u)/(2*a);return(h<0||d<h&&d>0)&&(h=d),!(h<0||(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),0))}const E=(0,l.c)();function A(e,t){return S(e,t,null)}function M(e,t,i){const r=f.WM.get(),s=f.MP.get();(0,a.f)(r,t.origin,t.direction);const n=x(e);(0,a.f)(i,r,t.origin),(0,a.g)(i,i,1/(0,a.l)(i)*n);const l=P(e,t.origin),c=(0,p.EU)(t.origin,i);return(0,o.d)(s,c+l,r),(0,a.m)(i,i,s),i}function O(e,t,i){const r=(0,a.b)(f.WM.get(),t,e),s=(0,a.g)(f.WM.get(),r,e[3]/(0,a.l)(r));return(0,a.a)(i,s,e)}function R(e,t){const i=(0,a.b)(f.WM.get(),t,e),r=(0,a.p)(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))}function P(e,t){const i=(0,a.b)(f.WM.get(),t,e),r=(0,a.l)(i),n=x(e),o=n+Math.abs(n-r);return(0,s.ZF)(n/o)}const I=(0,l.c)();function L(e,t,i,r){const n=(0,a.b)(I,t,e);switch(i){case h.R.X:{const e=(0,s.jE)(n,I)[2];return(0,a.s)(r,-Math.sin(e),Math.cos(e),0)}case h.R.Y:{const e=(0,s.jE)(n,I),t=e[1],i=e[2],o=Math.sin(t);return(0,a.s)(r,-o*Math.cos(i),-o*Math.sin(i),Math.cos(t))}case h.R.Z:return(0,a.n)(r,n);default:return}}function D(e,t){const i=(0,a.b)(F,t,e);return(0,a.l)(i)-e[3]}function N(e,t){const i=(0,a.d)(e,t),r=x(e);return i<=r*r}const F=(0,l.c)(),k=g(),U=Object.freeze(Object.defineProperty({__proto__:null,create:g,copy:y,fromCenterAndRadius:_,wrap:v,clear:b,fromRadius:w,getRadius:x,getCenter:C,fromValues:T,elevate:function(e,t,i){return e!==i&&(0,a.c)(i,e),i[3]=e[3]+t,i},setExtent:function(e,t,i){return m.error("sphere.setExtent is not yet supported"),e===i?i:y(e,i)},intersectRay:S,intersectsRay:A,intersectRayClosestSilhouette:function(e,t,i){if(S(e,t,i))return i;const r=M(e,t,f.WM.get());return(0,a.a)(i,t.origin,(0,a.g)(f.WM.get(),t.direction,(0,a.i)(t.origin,r)/(0,a.l)(t.direction))),i},closestPointOnSilhouette:M,closestPoint:function(e,t,i){return S(e,t,i)?i:((0,d.JI)(t,e,i),O(e,i,i))},projectPoint:O,distanceToSilhouette:R,angleToSilhouette:P,axisAt:L,altitudeAt:D,setAltitudeAt:function(e,t,i,r){const s=D(e,t),n=L(e,t,h.R.Z,F),o=(0,a.g)(F,n,i-s);return(0,a.a)(r,t,o)},containsPoint:N,tmpSphere:k},Symbol.toStringTag,{value:"Module"}))},36663:(e,t,i)=>{"use strict";function r(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}i.d(t,{_:()=>r})},55709:(e,t,i)=>{"use strict";i.d(t,{a:()=>n,b:()=>o,c:()=>s,d:()=>R,e:()=>T,f:()=>u,g:()=>a,h:()=>_,i:()=>y,j:()=>d,k:()=>A,l:()=>b,m:()=>v,n:()=>g,o:()=>f,p:()=>w,q:()=>S,r:()=>C,s:()=>p,t:()=>x,u:()=>m,v:()=>h});var r=i(93011);function s(e,t){return e[0]=t[0],e[1]=t[1],e}function n(e,t,i){return e[0]=t,e[1]=i,e}function o(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function a(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function l(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function c(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function u(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function h(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function d(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function p(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function f(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function m(e){const t=e[0],i=e[1];return t*t+i*i}function g(e,t){return e[0]=-t[0],e[1]=-t[1],e}function y(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function _(e,t){return e[0]*t[0]+e[1]*t[1]}function v(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function b(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function w(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function x(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function C(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=s*a-n*o+i[0],e[1]=s*o+n*a+i[1],e}function T(e,t){return e[0]===t[0]&&e[1]===t[1]}function S(e,t,i,r,s){let n=t[0]-i[0],o=t[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const E=f,A=a,M=l,O=c,R=d,P=p,I=m;Object.freeze(Object.defineProperty({__proto__:null,copy:s,set:n,add:o,subtract:a,multiply:l,divide:c,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},max:function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:u,scaleAndAdd:h,distance:d,squaredDistance:p,length:f,squaredLength:m,negate:g,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:y,dot:_,cross:v,lerp:b,random:function(e,t){t=t||1;const i=2*(0,r.R)()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},transformMat2:w,transformMat2d:x,transformMat3:function(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e},transformMat4:function(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e},rotate:C,angle:function(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:T,equals:function(e,t){const i=e[0],s=e[1],n=t[0],o=t[1];return Math.abs(i-n)<=r.E*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(s-o)<=r.E*Math.max(1,Math.abs(s),Math.abs(o))},projectAndScale:S,len:E,sub:A,mul:M,div:O,dist:R,sqrDist:P,sqrLen:I},Symbol.toStringTag,{value:"Module"}))},385:(e,t,i)=>{"use strict";i.d(t,{f:()=>o,n:()=>n});var r=i(90331);function s(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let e=0;e<a;++e)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function n(e,t,i){const n=e.typedBuffer,o=e.typedBufferStride,a=t.typedBuffer,l=t.typedBufferStride,c=i?i.count:t.count;let u=(i&&i.dstIndex?i.dstIndex:0)*o,h=(i&&i.srcIndex?i.srcIndex:0)*l;if((0,r.U)(t.elementType)){const e=(0,r.Op)(t.elementType);if((0,r.B3)(t.elementType))for(let t=0;t<c;++t)n[u]=Math.max(a[h]/e,-1),n[u+1]=Math.max(a[h+1]/e,-1),u+=o,h+=l;else for(let t=0;t<c;++t)n[u]=a[h]/e,n[u+1]=a[h+1]/e,u+=o,h+=l}else s(e,t,i);return e}function o(e,t,i,r){const s=e.typedBuffer,n=e.typedBufferStride,o=r?.count??e.count;let a=(r?.dstIndex??0)*n;for(let e=0;e<o;++e)s[a]=t,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:s,normalizeIntegerBuffer:n,fill:o},Symbol.toStringTag,{value:"Module"}))},55542:(e,t,i)=>{"use strict";function r(){return new Float32Array(2)}function s(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function n(){return r()}function o(){return s(1,1)}function a(){return s(1,0)}function l(){return s(0,1)}i.d(t,{c:()=>r,f:()=>s});const c=n(),u=o(),h=a(),d=l();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},fromValues:s,createView:function(e,t){return new Float32Array(e,t,2)},zeros:n,ones:o,unitX:a,unitY:l,ZEROS:c,ONES:u,UNIT_X:h,UNIT_Y:d},Symbol.toStringTag,{value:"Module"}))},69666:(e,t,i)=>{"use strict";function r(){return[0,0]}function s(e){return[e[0],e[1]]}function n(e,t){return[e,t]}function o(e){const t=[0,0],i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function a(e,t){return new Float64Array(e,t,2)}function l(){return n(1,1)}function c(){return n(1,0)}function u(){return n(0,1)}i.d(t,{O:()=>d,Z:()=>h,a:()=>r,b:()=>o,c:()=>a,d:()=>s,f:()=>n});const h=[0,0],d=l(),p=c(),f=u();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:s,fromValues:n,fromArray:o,createView:a,zeros:function(){return[0,0]},ones:l,unitX:c,unitY:u,ZEROS:h,ONES:d,UNIT_X:p,UNIT_Y:f},Symbol.toStringTag,{value:"Module"}))},6766:(e,t,i)=>{"use strict";i.d(t,{A:()=>d,B:()=>f,C:()=>g,D:()=>p,E:()=>u,F:()=>z,G:()=>h,a:()=>l,b:()=>c,c:()=>o,d:()=>_,e:()=>x,f:()=>C,g:()=>m,h:()=>T,i:()=>y,j:()=>F,k:()=>R,l:()=>n,m:()=>S,n:()=>w,o:()=>b,p:()=>v,q:()=>A,r:()=>I,s:()=>a,t:()=>E,u:()=>U,v:()=>L,w:()=>V,x:()=>k,z:()=>P});var r=i(8909),s=i(93011);function n(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function l(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function c(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function u(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function h(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function d(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function p(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function f(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function m(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function g(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function y(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function _(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function v(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function b(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function w(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function x(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function C(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o,e}function T(e,t,i,r){const s=t[0],n=t[1],o=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e}function S(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function E(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function A(e,t,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=t[0],l=t[1],c=t[2];let u=s*c-n*l,h=n*a-r*c,d=r*l-s*a,p=s*d-n*h,f=n*u-r*d,m=r*h-s*u;const g=2*o;return u*=g,h*=g,d*=g,p*=2,f*=2,m*=2,e[0]=a+u+p,e[1]=l+h+f,e[2]=c+d+m,e}const M=(0,r.c)(),O=(0,r.c)();function R(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function P(e,t){if(e===t)return!0;const i=e[0],r=e[1],n=e[2],o=t[0],a=t[1],l=t[2];return Math.abs(i-o)<=s.E*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=s.E*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=s.E*Math.max(1,Math.abs(n),Math.abs(l))}function I(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const L=c,D=u,N=h,F=y,k=_,U=n,V=v,z=Object.freeze(Object.defineProperty({__proto__:null,length:n,copy:o,set:a,add:l,subtract:c,multiply:u,divide:h,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},abs:d,sign:p,min:f,max:function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:m,scaleAndAdd:g,distance:y,squaredDistance:_,squaredLength:v,negate:b,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:w,dot:x,cross:C,lerp:T,hermite:function(e,t,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*c+s[0]*u,e[1]=t[1]*a+i[1]*l+r[1]*c+s[1]*u,e[2]=t[2]*a+i[2]*l+r[2]*c+s[2]*u,e},bezier:function(e,t,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,u=3*n*a,h=3*l*o,d=l*n;return e[0]=t[0]*c+i[0]*u+r[0]*h+s[0]*d,e[1]=t[1]*c+i[1]*u+r[1]*h+s[1]*d,e[2]=t[2]*c+i[2]*u+r[2]*h+s[2]*d,e},random:function(e,t){t=t||1;const i=2*(0,s.R)()*Math.PI,r=2*(0,s.R)()-1,n=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e[2]=r*t,e},transformMat4:S,transformMat3:E,transformQuat:A,rotateX:function(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e},rotateY:function(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e},rotateZ:function(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e},angle:function(e,t){o(M,e),o(O,t),w(M,M),w(O,O);const i=x(M,O);return i>1?0:i<-1?Math.PI:Math.acos(i)},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:R,equals:P,direction:I,sub:L,mul:D,div:N,dist:F,sqrDist:k,len:U,sqrLen:V},Symbol.toStringTag,{value:"Module"}))},86717:(e,t,i)=>{"use strict";i.d(t,{a:()=>n,b:()=>l,n:()=>a,s:()=>o,t:()=>s});var r=i(45150);function s(e,t,i){if(e.count!==t.count)return void r.c.error("source and destination buffers need to have the same number of elements");const s=e.count,n=i[0],o=i[1],a=i[2],l=i[4],c=i[5],u=i[6],h=i[8],d=i[9],p=i[10],f=i[12],m=i[13],g=i[14],y=e.typedBuffer,_=e.typedBufferStride,v=t.typedBuffer,b=t.typedBufferStride;for(let e=0;e<s;e++){const t=e*_,i=e*b,r=v[i],s=v[i+1],w=v[i+2];y[t]=n*r+l*s+h*w+f,y[t+1]=o*r+c*s+d*w+m,y[t+2]=a*r+u*s+p*w+g}}function n(e,t,i){if(e.count!==t.count)return void r.c.error("source and destination buffers need to have the same number of elements");const s=e.count,n=i[0],o=i[1],a=i[2],l=i[3],c=i[4],u=i[5],h=i[6],d=i[7],p=i[8],f=e.typedBuffer,m=e.typedBufferStride,g=t.typedBuffer,y=t.typedBufferStride;for(let e=0;e<s;e++){const t=e*m,i=e*y,r=g[i],s=g[i+1],_=g[i+2];f[t]=n*r+l*s+h*_,f[t+1]=o*r+c*s+d*_,f[t+2]=a*r+u*s+p*_}}function o(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let e=0;e<r;e++){const t=e*n,r=e*a;s[t]=i*o[r],s[t+1]=i*o[r+1],s[t+2]=i*o[r+2]}}function a(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let e=0;e<i;e++){const t=e*s,i=e*o,a=n[i],l=n[i+1],c=n[i+2],u=a*a+l*l+c*c;if(u>0){const e=1/Math.sqrt(u);r[t]=e*a,r[t+1]=e*l,r[t+2]=e*c}}}function l(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let e=0;e<r;e++){const t=e*n,r=e*a;s[t]=o[r]>>i,s[t+1]=o[r+1]>>i,s[t+2]=o[r+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:s,transformMat3:n,scale:o,normalize:a,shiftRight:l},Symbol.toStringTag,{value:"Module"}))},14789:(e,t,i)=>{"use strict";function r(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let e=0;e<a;++e)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function s(e,t,i,r,s){const n=e.typedBuffer,o=e.typedBufferStride,a=s?.count??e.count;let l=(s?.dstIndex??0)*o;for(let e=0;e<a;++e)n[l]=t,n[l+1]=i,n[l+2]=r,l+=o}i.d(t,{c:()=>r,f:()=>s}),Object.freeze(Object.defineProperty({__proto__:null,copy:r,fill:s},Symbol.toStringTag,{value:"Module"}))},79912:(e,t,i)=>{"use strict";function r(){return new Float32Array(3)}function s(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function n(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function o(e,t){return new Float32Array(e,t,3)}function a(){return r()}function l(){return n(1,1,1)}function c(){return n(1,0,0)}function u(){return n(0,1,0)}function h(){return n(0,0,1)}i.d(t,{a:()=>s,b:()=>o,c:()=>r,f:()=>n,z:()=>a});const d=a(),p=l(),f=c(),m=u(),g=h();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:s,fromValues:n,createView:o,zeros:a,ones:l,unitX:c,unitY:u,unitZ:h,ZEROS:d,ONES:p,UNIT_X:f,UNIT_Y:m,UNIT_Z:g},Symbol.toStringTag,{value:"Module"}))},8909:(e,t,i)=>{"use strict";function r(){return[0,0,0]}function s(e){return[e[0],e[1],e[2]]}function n(e,t,i){return[e,t,i]}function o(e){const t=[0,0,0],i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function a(e,t){return new Float64Array(e,t,3)}function l(){return n(1,1,1)}function c(){return n(1,0,0)}function u(){return n(0,1,0)}function h(){return n(0,0,1)}i.d(t,{O:()=>p,U:()=>g,Z:()=>d,a:()=>s,b:()=>a,c:()=>r,d:()=>o,f:()=>n,u:()=>h});const d=[0,0,0],p=l(),f=c(),m=u(),g=h();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:s,fromValues:n,fromArray:o,createView:a,zeros:function(){return[0,0,0]},ones:l,unitX:c,unitY:u,unitZ:h,ZEROS:d,ONES:p,UNIT_X:f,UNIT_Y:m,UNIT_Z:g},Symbol.toStringTag,{value:"Module"}))},88589:(e,t,i)=>{"use strict";i.d(t,{a:()=>o,b:()=>u,c:()=>s,d:()=>g,e:()=>p,f:()=>f,g:()=>v,h:()=>b,i:()=>d,l:()=>y,n:()=>m,s:()=>n,t:()=>_,v:()=>M});var r=i(93011);function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function n(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function o(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function a(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function l(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function c(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function u(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function h(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function d(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function p(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function f(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function m(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e}function g(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function y(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function _(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,e}function v(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function b(e,t){const i=e[0],s=e[1],n=e[2],o=e[3],a=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(i-a)<=r.E*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=r.E*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=r.E*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-u)<=r.E*Math.max(1,Math.abs(o),Math.abs(u))}const w=a,x=l,C=c,T=h,S=d,E=p,A=f,M=Object.freeze(Object.defineProperty({__proto__:null,copy:s,set:n,add:o,subtract:a,multiply:l,divide:c,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},max:function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:u,scaleAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},distance:h,squaredDistance:d,length:p,squaredLength:f,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:m,dot:g,lerp:y,random:function(e,t){let i,s,n,o,a,l;t=t||1;do{i=2*(0,r.R)()-1,s=2*(0,r.R)()-1,a=i*i+s*s}while(a>=1);do{n=2*(0,r.R)()-1,o=2*(0,r.R)()-1,l=n*n+o*o}while(l>=1);const c=Math.sqrt((1-a)/l);return e[0]=t*i,e[1]=t*s,e[2]=t*n*c,e[3]=t*o*c,e},transformMat4:_,transformQuat:function(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*n-l*s,h=c*s+l*r-o*n,d=c*n+o*s-a*r,p=-o*r-a*s-l*n;return e[0]=u*c+p*-o+h*-l-d*-a,e[1]=h*c+p*-a+d*-o-u*-l,e[2]=d*c+p*-l+u*-a-h*-o,e[3]=t[3],e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:v,equals:b,sub:w,mul:x,div:C,dist:T,sqrDist:S,len:E,sqrLen:A},Symbol.toStringTag,{value:"Module"}))},56999:(e,t,i)=>{"use strict";i.d(t,{a:()=>a,n:()=>n,s:()=>o,t:()=>s});var r=i(45150);function s(e,t,i){if(e.count!==t.count)return void r.c.error("source and destination buffers need to have the same number of elements");const s=e.count,n=i[0],o=i[1],a=i[2],l=i[3],c=i[4],u=i[5],h=i[6],d=i[7],p=i[8],f=e.typedBuffer,m=e.typedBufferStride,g=t.typedBuffer,y=t.typedBufferStride;for(let e=0;e<s;e++){const t=e*m,i=e*y,r=g[i],s=g[i+1],_=g[i+2],v=g[i+3];f[t]=n*r+l*s+h*_,f[t+1]=o*r+c*s+d*_,f[t+2]=a*r+u*s+p*_,f[t+3]=v}}function n(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let e=0;e<i;e++){const t=e*s,i=e*o,a=n[i],l=n[i+1],c=n[i+2],u=a*a+l*l+c*c;if(u>0){const e=1/Math.sqrt(u);r[t]=e*a,r[t+1]=e*l,r[t+2]=e*c}}}function o(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let e=0;e<r;e++){const t=e*n,r=e*a;s[t]=i*o[r],s[t+1]=i*o[r+1],s[t+2]=i*o[r+2],s[t+3]=i*o[r+3]}}function a(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let e=0;e<r;e++){const t=e*n,r=e*a;s[t]=o[r]>>i,s[t+1]=o[r+1]>>i,s[t+2]=o[r+2]>>i,s[t+3]=o[r+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:function(e,t,i){if(e.count!==t.count)return void r.c.error("source and destination buffers need to have the same number of elements");const s=e.count,n=i[0],o=i[1],a=i[2],l=i[3],c=i[4],u=i[5],h=i[6],d=i[7],p=i[8],f=i[9],m=i[10],g=i[11],y=i[12],_=i[13],v=i[14],b=i[15],w=e.typedBuffer,x=e.typedBufferStride,C=t.typedBuffer,T=t.typedBufferStride;for(let e=0;e<s;e++){const t=e*x,i=e*T,r=C[i],s=C[i+1],S=C[i+2],E=C[i+3];w[t]=n*r+c*s+p*S+y*E,w[t+1]=o*r+u*s+f*S+_*E,w[t+2]=a*r+h*s+m*S+v*E,w[t+3]=l*r+d*s+g*S+b*E}},transformMat3:s,normalize:n,scale:o,shiftRight:a},Symbol.toStringTag,{value:"Module"}))},32101:(e,t,i)=>{"use strict";function r(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let e=0;e<a;++e)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function s(e,t,i,r,s,n){const o=e.typedBuffer,a=e.typedBufferStride,l=n?.count??e.count;let c=(n?.dstIndex??0)*a;for(let e=0;e<l;++e)o[c]=t,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}i.d(t,{c:()=>r,f:()=>s}),Object.freeze(Object.defineProperty({__proto__:null,copy:r,fill:s},Symbol.toStringTag,{value:"Module"}))},18916:(e,t,i)=>{"use strict";function r(){return new Float32Array(4)}function s(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function n(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function o(){return r()}function a(){return n(1,1,1,1)}function l(){return n(1,0,0,0)}function c(){return n(0,1,0,0)}function u(){return n(0,0,1,0)}function h(){return n(0,0,0,1)}i.d(t,{a:()=>s,c:()=>r,f:()=>n});const d=o(),p=a(),f=l(),m=c(),g=u(),y=h();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:s,fromValues:n,createView:function(e,t){return new Float32Array(e,t,4)},zeros:o,ones:a,unitX:l,unitY:c,unitZ:u,unitW:h,ZEROS:d,ONES:p,UNIT_X:f,UNIT_Y:m,UNIT_Z:g,UNIT_W:y},Symbol.toStringTag,{value:"Module"}))},1983:(e,t,i)=>{"use strict";function r(){return[0,0,0,0]}function s(e){return[e[0],e[1],e[2],e[3]]}function n(e,t,i,r){return[e,t,i,r]}function o(e){const t=[0,0,0,0],i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function a(e,t){return new Float64Array(e,t,4)}function l(){return n(1,1,1,1)}function c(){return n(1,0,0,0)}function u(){return n(0,1,0,0)}function h(){return n(0,0,1,0)}function d(){return n(0,0,0,1)}i.d(t,{O:()=>f,Z:()=>p,a:()=>a,b:()=>o,c:()=>r,d:()=>s,f:()=>n});const p=[0,0,0,0],f=l(),m=c(),g=u(),y=h(),_=d();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:s,fromValues:n,fromArray:o,createView:a,zeros:function(){return[0,0,0,0]},ones:l,unitX:c,unitY:u,unitZ:h,unitW:d,ZEROS:p,ONES:f,UNIT_X:m,UNIT_Y:g,UNIT_Z:y,UNIT_W:_},Symbol.toStringTag,{value:"Module"}))},86875:(e,t,i)=>{"use strict";i.d(t,{B7:()=>l,St:()=>s,VL:()=>o,h$:()=>n,rW:()=>c});const r={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function s(e){return r[e]||r[e.toLowerCase()]}function n(e){return r[e]??r[e.toLowerCase()]}function o(e){return[...n(e)]}function a(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function l(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,o=2*i-n;return[Math.round(255*a(o,n,s+1/3)),Math.round(255*a(o,n,s)),Math.round(255*a(o,n,s-1/3)),r]}function c(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?9===e.length:5===e.length;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}},51366:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s}),i(39994);var r=i(86745);const s={apiKey:void 0,applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&((0,r.RH)(s,globalThis.esriConfig,!0),delete s.has),!s.assetsPath){const e="4.24.7";s.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}s.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(s,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),s.request.corsEnabledServers=[],s.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0}},53443:(e,t,i)=>{"use strict";i.d(t,{Z:()=>R});var r=i(99118),s=i(61681),n=i(51777),o=i(66175),a=i(41610),l=(i(39994),i(67134)),c=i(13802),u=i(34596),h=i(65943),d=i(55860),p=i(38488),f=i(53080);class m{constructor(e,t,i){this.properties=e,this.propertyName=t,this.metadata=i,this._observers=null,this._accessed=null,this._handles=null,this.flags=p.v.Dirty|(i.nonNullable?p.v.NonNullable:0)|(i.hasOwnProperty("value")?p.v.HasDefaultValue:0)|(void 0===i.get?p.v.DepTrackingInitialized:0)|(void 0===i.dependsOn?p.v.AutoTracked:0)}destroy(){if(this.flags&p.v.Dirty&&this._observers){const e=this._observers.slice();for(const t of e)t.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){(0,d.it)(this);const e=this.properties.store,t=this.propertyName,i=this.flags,r=e.get(t);if(i&p.v.Computing)return r;if(~i&p.v.Dirty&&e.has(t))return r;this.flags|=p.v.Computing;const s=this.properties.host;let n;i&p.v.AutoTracked?n=(0,d.LJ)(this,this.metadata.get,s):((0,d.GF)(s,this),n=this.metadata.get.call(s)),e.set(t,n,h.s3.COMPUTED);const o=e.get(t);return o===r?this.flags&=~p.v.Dirty:(0,d.gb)(this.commit,this),this.flags&=~p.v.Computing,o}onObservableAccessed(e){e!==this&&(null===this._accessed&&(this._accessed=[]),this._accessed.includes(e)||this._accessed.push(e))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=p.v.DepTrackingInitialized;const e=this._accessed;if(null===e)return;let t=this._handles;null===t&&(t=this._handles=[]);for(let i=0;i<e.length;++i)t.push(e[i].observe(this));e.length=0}observe(e){return null===this._observers&&(this._observers=[]),this._observers.includes(e)||this._observers.push(e),new f.X(this._observers,e)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&p.v.Overriden&&(this.flags|=p.v.Dirty);const e=this._observers;if(null!==e)for(let t=0;t<e.length;++t)e[t].onInvalidated()}commit(){this.flags&=~p.v.Dirty,this.onCommitted()}onCommitted(){if(null===this._observers)return;const e=this._observers.slice();for(let t=0;t<e.length;++t)e[t].onCommitted()}_clearObservationHandles(){const e=this._handles;if(null!==e){for(let t=0;t<e.length;++t)e[t].remove();e.length=0}}}class g{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const t=new g;return this._values.forEach(((i,r)=>{e&&e.has(r)||t.set(r,(0,l.d9)(i))})),t}get(e){return this._values.get(e)}originOf(){return h.s3.USER}keys(){return[...this._values.keys()]}set(e,t){this._values.set(e,t)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}}var y=i(95620);function _(e,t,i){return void 0!==e}function v(e,t,i,r){return!(void 0===e||null==i&&e.flags&p.v.NonNullable&&(r.lifecycle,o.F.INITIALIZING,1))}function b(e){return e&&"function"==typeof e.destroy}c.Z.getLogger("esri.core.accessorSupport.Properties");class w{constructor(e){this.host=e,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=o.F.INITIALIZING,this.store=new g,this._origin=h.s3.USER;const t=this.host.constructor.__accessorMetadata__,i=t.properties;for(const e in i){const t=new m(this,e,i[e]);this.properties.set(e,t)}this.metadatas=i,this._autoDestroy=t.autoDestroy}initialize(){this.lifecycle=o.F.CONSTRUCTING}constructed(){this.lifecycle=o.F.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[e,t]of this.properties){const i=this.internalGet(e);i&&b(i)&&(i.destroy(),~t.flags&p.v.NonNullable&&this._internalSet(t,null)),t.destroy()}else for(const[e,t]of this.properties)t.destroy()}get initialized(){return this.lifecycle!==o.F.INITIALIZING}get(e){const t=this.properties.get(e);if(t.metadata.get)return t.getComputed();(0,d.it)(t);const i=this.store;return i.has(e)?i.get(e):t.metadata.value}originOf(e){const t=this.store.originOf(e);if(void 0===t){const t=this.properties.get(e);if(void 0!==t&&t.flags&p.v.HasDefaultValue)return"defaults"}return(0,h.x3)(t)}has(e){return!!this.properties.has(e)&&this.store.has(e)}keys(){return[...this.properties.keys()]}internalGet(e){const t=this.properties.get(e);if(_(t))return this.store.has(e)?this.store.get(e):t.metadata.value}internalSet(e,t){const i=this.properties.get(e);_(i)&&this._internalSet(i,t)}getDependsInfo(e,t,i){const r=this.properties.get(t);if(!_(r))return"";const s=new Set,n=(0,d.LJ)({onObservableAccessed:e=>s.add(e),onTrackingEnd:()=>{}},(()=>r.metadata.get?.call(e)));let o=`${i}${e.declaredClass.split(".").pop()}.${t}: ${n}\n`;if(0===s.size)return o;i+="  ";for(const e of s){if(!(e instanceof m))continue;const t=e.properties.host,r=e.propertyName,s=(0,y.vw)(t);o+=s?s.getDependsInfo(t,r,i):`${i}${r}: undefined\n`}return o}setAtOrigin(e,t,i){const r=this.properties.get(e);if(_(r))return this._setAtOrigin(r,t,i)}isOverridden(e){const t=this.properties.get(e);return void 0!==t&&!!(t.flags&p.v.Overriden)}clearOverride(e){const t=this.properties.get(e);void 0!==t&&t.flags&p.v.Overriden&&(t.flags&=~p.v.Overriden,t.notifyChange())}override(e,t){const i=this.properties.get(e);if(!v(i,0,t,this))return;const r=i.metadata.cast;if(r){const e=this._cast(r,t),{valid:i,value:s}=e;if(x.release(e),!i)return;t=s}i.flags|=p.v.Overriden,this._internalSet(i,t)}set(e,t){const i=this.properties.get(e);if(!v(i,0,t,this))return;const r=i.metadata.cast;if(r){const e=this._cast(r,t),{valid:i,value:s}=e;if(x.release(e),!i)return;t=s}const s=i.metadata.set;s?s.call(this.host,t):this._internalSet(i,t)}setDefaultOrigin(e){this._origin=(0,h.M9)(e)}getDefaultOrigin(){return(0,h.x3)(this._origin)}notifyChange(e){const t=this.properties.get(e);void 0!==t&&t.notifyChange()}invalidate(e){const t=this.properties.get(e);void 0!==t&&t.invalidate()}commit(e){const t=this.properties.get(e);void 0!==t&&t.commit()}_internalSet(e,t){const i=this.lifecycle!==o.F.INITIALIZING?this._origin:h.s3.DEFAULTS;this._setAtOrigin(e,t,i)}_setAtOrigin(e,t,i){const r=this.store,s=e.propertyName;r.has(s,i)&&(0,l.fS)(t,r.get(s))&&~e.flags&p.v.Overriden&&i===r.originOf(s)||(e.invalidate(),r.set(s,t,i),e.commit(),(0,d.mS)(this.host,e))}_cast(e,t){const i=x.acquire();return i.valid=!0,i.value=t,e&&(i.value=e.call(this.host,t,i)),i}}const x=new u.Z(class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}});var C,T=i(33156),S=i(81509),E=i(81977),A=i(40266);function M(e){if(null==e)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return e.constructor?.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const O=Symbol("Accessor-Handles");class R{constructor(...e){if(this[C]=null,this.constructor===R)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new w(this)}),e.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,e))}static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:t,declaredClass:i,constructor:r}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class n extends s{constructor(...e){super(...e),this.inherited=null,r&&r.apply(this,e)}}(0,a.JT)(n.prototype);for(const t in e){const i=e[t];n.prototype[t]="function"==typeof i?function(...e){const r=this.inherited;let n;this.inherited=function(...e){if(s.prototype[t])return s.prototype[t].apply(this,e)};try{n=i.apply(this,e)}catch(e){throw this.inherited=r,e}return this.inherited=r,n}:e[t]}for(const e in t){const i=M(t[e]);(0,E.Cb)(i)(n.prototype,e)}return(0,A.j)(i)(n)}postscript(e){const t=this.__accessor__,i=t.ctorArgs||e;t.initialize(),i&&(this.set(i),t.ctorArgs=null),t.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||((0,s.yw)(this[O],(e=>{e.forEach((e=>e.remove()))})),this[O]=null,(0,S.BT)(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===o.F.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return(0,n.U2)(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,t){return(0,T.t)(this,e,t),this}watch(e,t,i){return(0,S.YP)(this,e,t,i)}own(e){let t=this[O];if((0,s.Wi)(t)&&(t=this[O]=new Set),(0,r.TW)(e))for(const i of e)t.add(i);else t.add(e)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_override(e,t){return this.__accessor__.override(e,t)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,t){return this.__accessor__.internalSet(e,t),this}}C=O},50904:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var r=i(34596);function s(e){e.length=0}class n{constructor(e=50,t=50){this._pool=new r.Z(Array,void 0,s,t,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return o.acquire()}static release(e){return o.release(e)}static prune(){o.prune()}}const o=new n(100)},41151:(e,t,i)=>{"use strict";i.d(t,{J:()=>h,j:()=>d});var r=i(36663),s=i(53443),n=(i(39994),i(67134)),o=i(13802),a=i(61681),l=i(65943),c=i(95620),u=i(40266);o.Z.getLogger("esri.core.Clonable");const h=e=>{let t=class extends e{clone(){const e=(0,a.s3)((0,c.vw)(this),"unable to clone instance of non-accessor class"),t=e.metadatas,i=e.store,r={},s=new Map;for(const e in t){const o=t[e],a=i?.originOf(e),c=o.clonable;if(o.readOnly||!1===c||a!==l.s3.USER&&a!==l.s3.DEFAULTS&&a!==l.s3.WEB_MAP&&a!==l.s3.WEB_SCENE)continue;const u=this[e];let h=null;h="function"==typeof c?c(u):"reference"===c?u:(0,n.Vo)(u),null!=u&&null==h||(a===l.s3.DEFAULTS?s.set(e,h):r[e]=h)}const o=new(0,Object.getPrototypeOf(this).constructor)(r);if(s.size){const e=(0,c.vw)(o)?.store;if(e)for(const[t,i]of s)e.set(t,i,l.s3.DEFAULTS)}return o}};return t=(0,r._)([(0,u.j)("esri.core.Clonable")],t),t};let d=class extends(h(s.Z)){};d=(0,r._)([(0,u.j)("esri.core.Clonable")],d)},41831:(e,t,i)=>{"use strict";i.d(t,{Z:()=>R});var r,s=i(36663),n=i(50904),o=i(31355),a=i(67134),l=i(61681),c=i(34596),u=i(98722),h=i(17262),d=i(81977),p=i(7283),f=i(2107),m=i(40266),g=i(55860),y=i(26096);const _=new c.Z(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},void 0,(e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1})),v=()=>{};function b(e){return e?e instanceof O?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function w(e){if(e&&e.length)return e[0]}function x(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function C(e,t,i,r){t&&t.forEach(((t,s,n)=>{e.push(t),C(e,i.call(r,t,s,n),i,r)}))}const T=new Set,S=new Set,E=new Set,A=new Map;let M=0,O=r=class extends o.Z.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new y.s,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:M++})}static isCollection(e){return null!=e&&e instanceof r}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof r?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return(0,g.it)(this._observable),this._items}set items(e){this._emitBeforeChanges(u.y.ADD)||(this._splice(0,this.length,b(e)),this._emitAfterChanges(u.y.ADD))}hasEventListener(e){return"change"===e?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if("change"===e){const e=this._chgListeners,i={removed:!1,callback:t};return e.push(i),this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=v,i.removed=!0,e.splice(e.indexOf(i),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if((0,g.it)(this._observable),this._emitBeforeChanges(u.y.ADD))return this;const i=this.getNextIndex(t??null);return this._splice(i,0,[e]),this._emitAfterChanges(u.y.ADD),this}addMany(e,t=this._items.length){if((0,g.it)(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(u.y.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,b(e)),this._emitAfterChanges(u.y.ADD),this}at(e){if((0,g.it)(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if((0,g.it)(this._observable),!this.length||this._emitBeforeChanges(u.y.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(u.y.REMOVE),e}clone(){return(0,g.it)(this._observable),this._createNewInstance({items:this._items.map(a.d9)})}concat(...e){(0,g.it)(this._observable);const t=e.map(b);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if((0,g.it)(this._observable),!this.length||this._emitBeforeChanges(u.y.REMOVE))return;const i=(0,l.j0)(this._splice(0,this.length)),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(u.y.REMOVE)}every(e,t){return(0,g.it)(this._observable),this._items.every(e,t)}filter(e,t){let i;return(0,g.it)(this._observable),i=2===arguments.length?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return(0,g.it)(this._observable),this._items.find(e,t)}findIndex(e,t){return(0,g.it)(this._observable),this._items.findIndex(e,t)}flatten(e,t){(0,g.it)(this._observable);const i=[];return C(i,this,e,t),new r(i)}forEach(e,t){return(0,g.it)(this._observable),this._items.forEach(e,t)}getItemAt(e){return(0,g.it)(this._observable),this._items[e]}getNextIndex(e){(0,g.it)(this._observable);const t=this.length;return(e=null==e?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return(0,g.it)(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return(0,g.it)(this._observable),this._items.indexOf(e,t)}join(e=","){return(0,g.it)(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return(0,g.it)(this._observable),this._items.lastIndexOf(e,t)}map(e,t){(0,g.it)(this._observable);const i=this._items.map(e,t);return new r({items:i})}reorder(e,t=this.length-1){(0,g.it)(this._observable);const i=this.indexOf(e);if(-1!==i){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(u.y.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(u.y.MOVE)}return e}}pop(){if((0,g.it)(this._observable),!this.length||this._emitBeforeChanges(u.y.REMOVE))return;const e=w(this._splice(this.length-1,1));return this._emitAfterChanges(u.y.REMOVE),e}push(...e){return(0,g.it)(this._observable),this._emitBeforeChanges(u.y.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(u.y.ADD)),this.length}reduce(e,t){(0,g.it)(this._observable);const i=this._items;return 2===arguments.length?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){(0,g.it)(this._observable);const i=this._items;return 2===arguments.length?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return(0,g.it)(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if((0,g.it)(this._observable),e<0||e>=this.length||this._emitBeforeChanges(u.y.REMOVE))return;const t=w(this._splice(e,1));return this._emitAfterChanges(u.y.REMOVE),t}removeMany(e){if((0,g.it)(this._observable),!e||!e.length||this._emitBeforeChanges(u.y.REMOVE))return[];const t=e instanceof r?e.toArray():e,i=this._items,s=[],n=t.length;for(let e=0;e<n;e++){const r=t[e],n=i.indexOf(r);if(n>-1){const r=1+x(t,i,e+1,n+1),o=this._splice(n,r);o&&o.length>0&&s.push.apply(s,o),e+=r-1}}return this._emitAfterChanges(u.y.REMOVE),s}reverse(){if((0,g.it)(this._observable),this._emitBeforeChanges(u.y.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(u.y.MOVE),this}shift(){if((0,g.it)(this._observable),!this.length||this._emitBeforeChanges(u.y.REMOVE))return;const e=w(this._splice(0,1));return this._emitAfterChanges(u.y.REMOVE),e}slice(e=0,t=this.length){return(0,g.it)(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return(0,g.it)(this._observable),this._items.some(e,t)}sort(e){if((0,g.it)(this._observable),!this.length||this._emitBeforeChanges(u.y.MOVE))return this;const t=(0,l.j0)(this._splice(0,this.length));return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(u.y.MOVE),this}splice(e,t,...i){(0,g.it)(this._observable);const r=(t?u.y.REMOVE:0)|(i.length?u.y.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return(0,g.it)(this._observable),this._items.slice()}toJSON(){return(0,g.it)(this._observable),this.toArray()}toLocaleString(){return(0,g.it)(this._observable),this._items.toLocaleString()}toString(){return(0,g.it)(this._observable),this._items.toString()}unshift(...e){return(0,g.it)(this._observable),!e.length||this._emitBeforeChanges(u.y.ADD)||(this._splice(0,0,e),this._emitAfterChanges(u.y.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=(0,h.Os)((()=>this._dispatchChange()))),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const t=_.acquire();t.target=this,t.cancellable=!0;for(let i=0,s=o.length;i<s;i++)n=o[i],t.reset(n),this.emit("before-remove",t),t.defaultPrevented&&(o.splice(i,1),r.splice(e,0,n),e+=1,i-=1,s-=1);_.release(t)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const e=_.acquire();e.target=this,e.cancellable=!1;const t=o.length;for(let i=0;i<t;i++)e.reset(o[i]),this.emit("after-remove",e);_.release(e)}}if(i&&i.length){if(s){const e=[];for(const t of i){const i=s.ensureType(t);null==i&&null!=t||e.push(i)}i=e}const t=this.hasEventListener("before-add"),n=this.hasEventListener("after-add"),o=e===this.length;if(t||n){const s=_.acquire();s.target=this,s.cancellable=!0;const a=_.acquire();a.target=this,a.cancellable=!1;for(const l of i)t?(s.reset(l),this.emit("before-add",s),s.defaultPrevented||(o?r.push(l):r.splice(e++,0,l),this._set("length",r.length),n&&(a.reset(l),this.emit("after-add",a)))):(o?r.push(l):r.splice(e++,0,l),this._set("length",r.length),a.reset(l),this.emit("after-add",a));_.release(a),_.release(s)}else{if(o)for(const e of i)r.push(e);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=_.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,_.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=_.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),_.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const e=t.changes;T.clear(),S.clear(),E.clear();for(const{added:t,removed:i}of e){if(t)if(0===E.size&&0===S.size)for(const e of t)T.add(e);else for(const e of t)S.has(e)?(E.add(e),S.delete(e)):E.has(e)||T.add(e);if(i)if(0===E.size&&0===T.size)for(const e of i)S.add(e);else for(const e of i)T.has(e)?T.delete(e):(E.delete(e),S.add(e))}const i=n.Z.acquire();T.forEach((e=>{i.push(e)}));const r=n.Z.acquire();S.forEach((e=>{r.push(e)}));const s=this._items,o=t.items,a=n.Z.acquire();if(E.forEach((e=>{o.indexOf(e)!==s.indexOf(e)&&a.push(e)})),t.listeners&&(i.length||r.length||a.length)){const e={target:this,added:i,removed:r,moved:a},s=t.listeners.length;for(let i=0;i<s;i++){const r=t.listeners[i];r.removed||r.callback.call(this,e)}}n.Z.release(i),n.Z.release(r),n.Z.release(a)}T.clear(),S.clear(),E.clear()}};O.ofType=e=>{if(!e)return r;if(A.has(e))return A.get(e);let t=null;if("function"==typeof e)t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const r=e.typeMap[i].prototype.declaredClass;t?t+=` | ${r}`:t=r}let i=class extends r{};return(0,s._)([(0,f.c)({Type:e,ensureType:"function"==typeof e?(0,p.se)(e):(0,p.N7)(e)})],i.prototype,"itemType",void 0),i=(0,s._)([(0,m.j)(`esri.core.Collection<${t}>`)],i),A.set(e,i),i},(0,s._)([(0,d.Cb)()],O.prototype,"length",void 0),(0,s._)([(0,d.Cb)()],O.prototype,"items",null),O=r=(0,s._)([(0,m.j)("esri.core.Collection")],O);const R=O},81739:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r=i(36663),s=i(41831),n=i(53280),o=i(61681),a=(i(39994),i(70375),i(13802),i(81509),i(63235)),l=i(81977),c=(i(7753),i(7283),i(40266));let u=class extends((0,n.p)(s.Z)){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add((0,a.EH)((()=>this._refresh())))}destroy(){this.getCollections=null}_refresh(){const e=(0,o.pC)(this.getCollections)?this.getCollections():null;if((0,o.Wi)(e))return void this.removeAll();let t=0;for(const i of e)(0,o.pC)(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new s.Z(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:e=>!!e;for(const r of t)if(r){if(i(r)){const t=this.indexOf(r,e);t>=0?t!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const t=this.getChildrenFunction(r);if(Array.isArray(t))for(const i of t)e=this._processCollection(e,i);else e=this._processCollection(e,t)}}return e}};(0,r._)([(0,l.Cb)()],u.prototype,"getCollections",void 0),(0,r._)([(0,l.Cb)()],u.prototype,"getChildrenFunction",void 0),(0,r._)([(0,l.Cb)()],u.prototype,"itemFilterFunction",void 0),u=(0,r._)([(0,c.j)("esri.core.CollectionFlattener")],u);const h=u},16068:(e,t,i)=>{"use strict";i.d(t,{BV:()=>l,Q4:()=>a,c5:()=>o,pE:()=>s});var r=i(19431);class s{constructor(e,t){this.min=e,this.max=t,this.range=t-e}ndiff(e,t=0){return Math.ceil((e-t)/this.range)*this.range+t}_normalize(e,t,i,r=0,s=!1){return(i-=r)<e?i+=this.ndiff(e-i):i>t&&(i-=this.ndiff(i-t)),s&&i===t&&(i=e),i+r}normalize(e,t=0,i=!1){return this._normalize(this.min,this.max,e,t,i)}clamp(e,t=0){return(0,r.uZ)(e-t,this.min,this.max)+t}monotonic(e,t,i){return e<t?t:t+this.ndiff(e-t,i)}minimalMonotonic(e,t,i){return this._normalize(e,e+this.range,t,i)}center(e,t,i){return t=this.monotonic(e,t,i),this.normalize((e+t)/2,i)}diff(e,t,i){return this.monotonic(e,t,i)-e}shortestSignedDiff(e,t){e=this.normalize(e);const i=(t=this.normalize(t))-e,r=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(i)<Math.abs(r)?i:r}contains(e,t,i){return t=this.minimalMonotonic(e,t),(i=this.minimalMonotonic(e,i))>e&&i<t}}function n(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const o=n(new s(0,2*Math.PI)),a=n(new s(-Math.PI,Math.PI)),l=n(new s(0,360))},70375:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var r=i(67134),s=i(13802),n=i(49290);class o extends n.Z{constructor(e,t,i){if(super(e,t,i),!(this instanceof o))return new o(e,t,i)}toJSON(){if(null!=this.details)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,((e,t)=>{if(t&&"object"==typeof t&&"function"==typeof t.toJSON)return t;try{return(0,r.d9)(t)}catch(e){return"[object]"}})))}}catch(e){throw s.Z.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new o(e.name,e.message,e.details)}}o.prototype.type="error"},31355:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(36663),s=i(53443),n=i(23148),o=i(40266);class a{constructor(){this._emitter=new a.EventEmitter(this)}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}}!function(e){class t{constructor(e=null){this.target=e,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(e,t){const i=this._listenersMap&&this._listenersMap.get(e);if(!i)return!1;const r=this.target||this;return[...i].forEach((e=>{e.call(r,t)})),i.length>0}on(e,t){if(Array.isArray(e)){const i=e.map((e=>this.on(e,t)));return(0,n.AL)(i)}if(e.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const i=this._listenersMap.get(e)||[];return i.push(t),this._listenersMap.set(e,i),{remove:()=>{const i=this._listenersMap&&this._listenersMap.get(e)||[],r=i.indexOf(t);r>=0&&i.splice(r,1)}}}once(e,t){const i=this.on(e,(e=>{i.remove(),t.call(null,e)}));return i}hasEventListener(e){const t=this._listenersMap&&this._listenersMap.get(e);return null!=t&&t.length>0}}e.EventEmitter=t,e.EventedMixin=e=>{let i=class extends e{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};return i=(0,r._)([(0,o.j)("esri.core.Evented")],i),i};let i=class extends s.Z{constructor(){super(...arguments),this._emitter=new a.EventEmitter(this)}destroy(){this._emitter.clear()}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};i=(0,r._)([(0,o.j)("esri.core.Evented")],i),e.EventedAccessor=i}(a||(a={}));const l=a},53280:(e,t,i)=>{"use strict";i.d(t,{p:()=>c,r:()=>u});var r=i(36663),s=i(53443),n=i(44584),o=i(81977),a=i(40266),l=i(81589);const c=e=>{let t=class extends e{destroy(){this.destroyed||(this._get("handles")?.destroy(),this._get("updatingHandles")?.destroy())}get handles(){return this._get("handles")||new n.Z}get updatingHandles(){return this._get("updatingHandles")||new l.t}};return(0,r._)([(0,o.Cb)({readOnly:!0})],t.prototype,"handles",null),(0,r._)([(0,o.Cb)({readOnly:!0})],t.prototype,"updatingHandles",null),t=(0,r._)([(0,a.j)("esri.core.HandleOwner")],t),t};let u=class extends(c(s.Z)){};u=(0,r._)([(0,a.j)("esri.core.HandleOwner")],u)},44584:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r=i(36663),s=i(53443),n=i(41831),o=i(61681),a=i(81977),l=i(40266);let c=class extends s.Z{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach((t=>{e+=t.length})),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!n.Z.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||n.Z.isCollection(e)?e.forEach((e=>this._isHandle(e)&&i.push(e))):i.push(e),this.notifyChange("size"),this}forEach(e,t){if("function"==typeof e)this._groups.forEach((t=>t.forEach(e)));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||n.Z.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let e=0;e<t.length;e++)t[e].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach((e=>{for(let t=0;t<e.length;t++)e[t].remove()})),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return(0,o.j0)(this._groups.get(this._ensureGroupKey(e)))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};(0,r._)([(0,a.Cb)({readOnly:!0})],c.prototype,"size",null),c=(0,r._)([(0,l.j)("esri.core.Handles")],c);const u=c},86618:(e,t,i)=>{"use strict";i.d(t,{Ej:()=>a,IG:()=>o});var r=i(36663),s=i(40266);let n=0;const o=e=>{let t=class extends e{constructor(...e){super(...e),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+n++})}};return t=(0,r._)([(0,s.j)("esri.core.Identifiable")],t),t};let a=class extends(o(class{})){};a=(0,r._)([(0,s.j)("esri.core.Identifiable")],a)},77234:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var r=i(40366);class s{constructor(e,t){this._storage=new r.WJ,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t){this._storage.put(e,t,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}},82064:(e,t,i)=>{"use strict";i.d(t,{wq:()=>y,eC:()=>m});var r=i(36663),s=i(53443),n=i(61681),o=i(67134),a=i(65943);class l{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const t=new l;return this._values.forEach(((i,r)=>{e&&e.has(r)||t.set(r,(0,o.d9)(i.value),i.origin)})),t}get(e,t){t=this._normalizeOrigin(t);const i=this._values.get(e);return null==t||i?.origin===t?i?.value:void 0}originOf(e){return this._values.get(e)?.origin??a.s3.USER}keys(e){e=this._normalizeOrigin(e);const t=[...this._values.keys()];return null==e?t:t.filter((t=>this._values.get(t)?.origin===e))}set(e,t,i){if((i=this._normalizeOrigin(i))===a.s3.DEFAULTS){const t=this._values.get(e);if(t&&null!=t.origin&&t.origin>i)return}this._values.set(e,new c(t,i))}delete(e,t){null!=(t=this._normalizeOrigin(t))&&this._values.get(e)?.origin!==t||this._values.delete(e)}has(e,t){return null!=(t=this._normalizeOrigin(t))?this._values.get(e)?.origin===t:this._values.has(e)}forEach(e){this._values.forEach((({value:t},i)=>e(t,i)))}_normalizeOrigin(e){if(null!=e)return e===a.s3.DEFAULTS?e:a.s3.USER}}class c{constructor(e,t){this.value=e,this.origin=t}}var u=i(20701),h=i(70148),d=i(95620),p=i(86561),f=i(40266);const m=e=>{let t=class extends e{constructor(...e){super(...e);const t=(0,n.j0)((0,d.vw)(this)),i=t.store,r=new l;t.store=r,(0,u.M)(t,i,r)}read(e,t){(0,h.i)(this,e,t)}write(e={},t){return(0,p.c)(this,e,t)}toJSON(e){return this.write({},e)}static fromJSON(e,t){return g.call(this,e,t)}};return t=(0,r._)([(0,f.j)("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function g(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let y=class extends(m(s.Z)){};y=(0,r._)([(0,f.j)("esri.core.JSONSupport")],y)},55854:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var r=i(40366);class s{constructor(e,t){this._storage=new r.WJ,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t,i){this._storage.put(e,t,i,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}}},68309:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r=i(36663),s=i(70375),n=i(64189),o=i(78668),a=i(96863),l=i(81977),c=i(40266);const u="loaded",h=e=>{let t=class extends e{constructor(...e){super(...e),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise((e=>{const t=this.load.bind(this);this.load=i=>{const r=new Promise(((e,t)=>{const r=(0,o.$F)(i,t);this.destroyed&&t(new s.Z("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(e,t).finally((()=>{r&&r.remove()}))}));if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const e=this._loadController=new AbortController;t({signal:e.signal}),(0,o.fu)(e.signal,(()=>{this._promiseProps.abort()}))}return e(),r}}))),this.when((()=>{this._set("loadStatus",u),this._loadController=null}),(e=>{this._set("loadStatus","failed"),this._set("loadError",e),this._loadController=null}))}get loaded(){return this.loadStatus===u}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new s.Z("load:cancelled","Cancelled")),this._loadController?.abort()),this}};return(0,r._)([(0,l.Cb)({readOnly:!0})],t.prototype,"loaded",null),(0,r._)([(0,l.Cb)({readOnly:!0})],t.prototype,"loadError",void 0),(0,r._)([(0,l.Cb)({clonable:!1})],t.prototype,"loadStatus",void 0),(0,r._)([(0,l.Cb)({type:[a.Z],readOnly:!0})],t.prototype,"loadWarnings",null),t=(0,r._)([(0,c.j)("esri.core.Loadable")],t),t};let d=class extends(h(n.D)){};var p;d=(0,r._)([(0,c.j)("esri.core.Loadable")],d),(p=d||(d={})).LoadableMixin=h,p.isLoadable=function(e){return!(!e||!e.load)};const f=d},13802:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var r=i(51366),s=(i(39994),i(61681)),n=i(21130);const o={info:0,warn:1,error:2,none:3};class a{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},null!=e.level&&(this.level=e.level),null!=e.writer&&(this.writer=e.writer),this._module=e.module,a._loggers[this.module]=this;const t=this.module.lastIndexOf(".");-1!==t&&(this._parent=a.getLogger(this.module.slice(0,t)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(e={}){const t=a._loggers;return a._loggers=e,t},set throttlingDisabled(e){a._throttlingDisabled=e}}}static getLogger(e){let t=a._loggers[e];return t||(t=new a({module:e})),t}_log(e,t,...i){if(this._matchLevel(e)){if("always"!==t&&!a._throttlingDisabled){const r=this._argsToKey(i),s=this._loggedMessages[e].get(r);if("once"===t&&null!=s||"oncePerTick"===t&&s&&s>=a._tickCounter)return;this._loggedMessages[e].set(r,a._tickCounter),a._scheduleTickCounterIncrement()}for(const t of r.Z.log.interceptors)if(t(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,t){let i=this;for(;(0,s.pC)(i);){const t=i[e];if((0,s.pC)(t))return t;i=i.parent}return t}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,t,...i){console[e](`[${t}]`,...i)}_matchLevel(e){const t=r.Z.log.level?r.Z.log.level:"warn";return o[this._parentWithMember("level",t)]<=o[e]}_argsToKey(...e){return(0,n.hP)(JSON.stringify(e,((e,t)=>"object"!=typeof t||Array.isArray(t)?t:"[Object]")))}static _scheduleTickCounterIncrement(){a._tickCounterScheduled||(a._tickCounterScheduled=!0,Promise.resolve().then((()=>{a._tickCounter++,a._tickCounterScheduled=!1})))}}a._loggers={},a._tickCounter=0,a._tickCounterScheduled=!1,a._throttlingDisabled=!1},86114:(e,t,i)=>{"use strict";function r(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function s(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}function n(e,t,i){const r=e.get(t);if(void 0!==r)return r;const s=i();return e.set(t,s),s}i.d(t,{fQ:()=>s,oE:()=>r,s1:()=>n})},40366:(e,t,i)=>{"use strict";i.d(t,{WJ:()=>c,Xq:()=>l,an:()=>n,lN:()=>o});var r=i(61681),s=i(17135);const n=-3;var o,a;(a=o||(o={}))[a.ALL=0]="ALL",a[a.SOME=1]="SOME";class l{constructor(e,t,i){this._namespace=e,this._storage=t,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,t,i,r=0){this._storage.put(this._namespace+e,t,i,r)}get(e){const t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}pop(e){const t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}updateSize(e,t,i){this._storage.updateSize(this._namespace+e,t,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class c{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new s.Z,this._users=new s.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,t,i,r){const s=this._db.get(e);if(s&&(this._size-=s.size,this._db.delete(e),s.entry!==t&&this._notifyRemove(e,s.entry,o.ALL)),i>this._maxSize)return void this._notifyRemove(e,t,o.ALL);if(void 0===t)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const a=1+Math.max(r,n)-n;this._db.set(e,{entry:t,size:i,lifetime:a,lives:a}),this._size+=i,this._checkSizeLimit()}updateSize(e,t,i){const s=this._db.get(e);if(s&&s.entry===t){for(this._size-=s.size;i>this._maxSize;){const s=this._notifyRemove(e,t,o.SOME);if(!((0,r.pC)(s)&&s>0))return void this._db.delete(e);i=s}s.size=i,this._size+=i,this._checkSizeLimit()}}pop(e){const t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}get(e){const t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},i=new Array;this._db.forEach(((e,r)=>{const s=e.lifetime;i[s]=(i[s]||0)+e.size,this._users.forAll((i=>{const s=i.namespace;if(r.startsWith(s)){const i=t[s]||0;t[s]=i+e.size}}))}));const r={};this._users.forAll((e=>{const i=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){const s=t[i]||0;t[i]=s,r[i]=Math.round(100*e.hitRate)+"%"}else r[i]="0%"}));const s=Object.keys(t);s.sort(((e,i)=>t[i]-t[e])),s.forEach((i=>e[i]=Math.round(t[i]/2**20)+"MB / "+r[i]));for(let t=i.length-1;t>=0;--t){const r=i[t];r&&(e["Priority "+(t+n-1)]=Math.round(r/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){this._db.forEach(((t,i)=>{i.startsWith(e)&&(this._size-=t.size,this._db.delete(i),this._notifyRemove(i,t.entry,o.ALL))}))}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,o.ALL))),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,i){let r;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,i);return"number"==typeof e&&(r=e),!0}return!1})),r}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,t]of this._db){if(this._db.delete(e),t.lives<=1){this._size-=t.size;const i=this._notifyRemove(e,t.entry,o.SOME);(0,r.pC)(i)&&i>0&&(this._size+=i,t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t);if(this._size<=.9*this.maxSize)return}}}},49290:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var r=i(86745);class s{constructor(e,t,i){this.name=e,this.details=i,this.message=void 0,this instanceof s&&(this.message=t&&function(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,((e,i)=>{if(""===i)return"$";const s=(0,r.hS)(i,t),n=null==s?"":s;if(void 0===n)throw new Error(`could not find key "${i}" in template`);return n.toString()}))}(t,i)||"")}toString(){return"["+this.name+"]: "+this.message}}},15842:(e,t,i)=>{"use strict";i.d(t,{R:()=>v,w:()=>b});var r=i(36663),s=i(53443),n=i(61681),o=i(20701),a=i(67134),l=i(65943);class c{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(l.kk),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const t=new c,i=this._originStores[l.s3.DEFAULTS];i&&i.forEach(((e,i)=>{t.set(i,(0,a.d9)(e),l.s3.DEFAULTS)}));for(let i=l.s3.SERVICE;i<l.kk;i++){const r=this._originStores[i];r&&r.forEach(((r,s)=>{e&&e.has(s)||t.set(s,(0,a.d9)(r),i)}))}return t}get(e,t){const i=void 0===t?this._values:this._originStores[t];return i?i.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?[...t.keys()]:[]}set(e,t,i=l.s3.USER){let r=this._originStores[i];if(r||(r=new Map,this._originStores[i]=r),r.set(e,t),!this._values.has(e)||(0,n.j0)(this._propertyOriginMap.get(e))<=i){const r=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,i),r!==t}return!1}delete(e,t=l.s3.USER){const i=this._originStores[t];if(!i)return;const r=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let i=t-1;i>=0;i--){const t=this._originStores[i];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,i);break}}}return r}has(e,t){const i=void 0===t?this._values:this._originStores[t];return!!i&&i.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const i=this._originStores[t],r=i&&i.get(e),s=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,t),s!==r}originOf(e){return this._propertyOriginMap.get(e)||l.s3.DEFAULTS}forEach(e){this._values.forEach(e)}}var u=i(70148),h=i(95620),d=i(40266);const p=e=>{let t=class extends e{constructor(...e){super(...e);const t=(0,n.j0)((0,h.vw)(this)),i=t.store,r=new c;t.store=r,(0,o.M)(t,i,r)}read(e,t){(0,u.i)(this,e,t)}getAtOrigin(e,t){const i=f(this),r=(0,l.M9)(t);if("string"==typeof e)return i.get(e,r);const s={};return e.forEach((e=>{s[e]=i.get(e,r)})),s}originOf(e){return(0,l.x3)(this.originIdOf(e))}originIdOf(e){return f(this).originOf(e)}revert(e,t){const i=f(this),r=(0,l.M9)(t),s=(0,h.vw)(this);let n;n="string"==typeof e?"*"===e?i.keys(r):[e]:e,n.forEach((e=>{s.invalidate(e),i.revert(e,r),s.commit(e)}))}};return t=(0,r._)([(0,d.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function f(e){return(0,h.vw)(e).store}let m=class extends(p(s.Z)){};m=(0,r._)([(0,d.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],m);var g=i(86561);const y=e=>{let t=class extends e{constructor(...e){super(...e)}clear(e,t="user"){return _(this).delete(e,(0,l.M9)(t))}write(e={},t){return(0,g.c)(this,e=e||{},t),e}setAtOrigin(e,t,i){(0,h.vw)(this).setAtOrigin(e,t,(0,l.M9)(i))}removeOrigin(e){const t=_(this),i=(0,l.M9)(e),r=t.keys(i);for(const e of r)t.originOf(e)===i&&t.set(e,t.get(e,i),l.s3.USER)}updateOrigin(e,t){const i=_(this),r=(0,l.M9)(t),s=this.get(e);for(let t=r+1;t<l.kk;++t)i.delete(e,t);i.set(e,s,r)}toJSON(e){return this.write({},e)}};return t=(0,r._)([(0,d.j)("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function _(e){return(0,h.vw)(e).store}const v=e=>{let t=class extends(y(p(e))){constructor(...e){super(...e)}};return t=(0,r._)([(0,d.j)("esri.core.MultiOriginJSONSupport")],t),t};let b=class extends(v(s.Z)){};b=(0,r._)([(0,d.j)("esri.core.MultiOriginJSONSupport")],b)},22445:(e,t,i)=>{"use strict";i.d(t,{r:()=>r});class r{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}set(e,t,i){const r=this._outer.get(e);r?r.set(t,i):this._outer.set(e,new Map([[t,i]]))}delete(e,t){const i=this._outer.get(e);i&&(i.delete(t),0===i.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,i)=>e(t,i)))}}},34596:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});class r{constructor(e,t,i,r=1,s=0){if(this.ctor=e,this.acquireFunction=t,this.releaseFunction=i,this.allocationSize=r,this._pool=new Array(s),this._initialSize=s,this.ctor)for(let e=0;e<s;e++)this._pool[e]=new this.ctor;this.allocationSize=Math.max(r,1)}destroy(){this.prune(0)}acquire(...e){let t;if(r.test.disabled)t=new this.ctor;else{if(0===this._pool.length){const e=this.allocationSize;for(let t=0;t<e;t++)this._pool[t]=new this.ctor}t=this._pool.pop()}return this.acquireFunction?this.acquireFunction(t,...e):function(e){return e&&e.acquire&&"function"==typeof e.acquire}(t)&&t.acquire(...e),t}release(e){var t;e&&!r.test.disabled&&(this.releaseFunction?this.releaseFunction(e):(t=e)&&t.release&&"function"==typeof t.release&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let t=e;t<this._pool.length;++t){const e=this._pool[t];this._dispose(e)}this._pool.length=e}}_dispose(e){e.dispose&&"function"==typeof e.dispose&&e.dispose()}}r.test={disabled:!1}},19480:(e,t,i)=>{"use strict";i.d(t,{x:()=>s});var r=i(66581);class s{constructor(e){this.allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&(0,r.Y)((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*n);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,n));e++)this._items.push(this.allocator())}}const n=1024},98722:(e,t,i)=>{"use strict";var r;i.d(t,{y:()=>r}),function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"}(r||(r={}))},31168:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});class r{constructor(e,t=29){this.name=e,this._counter=0,this._items=new Array(t)}record(e){this._items[++this._counter%this._items.length]=e}get median(){return this._items.slice().sort(((e,t)=>e-t))[Math.floor(this._items.length/2)]}get average(){return this._items.reduce(((e,t)=>e+t),0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}},17135:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var r,s=i(7753);!function(e){const t=(e,t,i,r)=>{let s=t,n=t;const o=i>>>1,a=e[s-1];for(;n<=o;){n=s<<1,n<i&&r(e[n-1],e[n])<0&&++n;const t=e[n-1];if(r(t,a)<=0)break;e[s-1]=t,s=n}e[s-1]=a},i=(e,t)=>e<t?-1:e>t?1:0;e.sort=function(e,r,s,n){void 0===r&&(r=0),void 0===s&&(s=e.length),void 0===n&&(n=i);for(let i=s>>>1;i>r;i--)t(e,i,s,n);const o=r+1;for(let i=s-1;i>r;i--){const s=e[r];e[r]=e[i],e[i]=s,t(e,o,i,n)}},e.iterableSort=function*(e,r,s,n){void 0===r&&(r=0),void 0===s&&(s=e.length),void 0===n&&(n=i);for(let i=s>>>1;i>r;i--)t(e,i,s,n),yield;const o=r+1;for(let i=s-1;i>r;i--){const s=e[r];e[r]=e[i],e[i]=s,t(e,o,i,n),yield}}}(r||(r={}));const n=r;class o{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new s.SO,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),void 0!==e.deallocator&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>a(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const t=new Array;for(let i=0;i<this._length;i++){const r=this.data[i];e(r)&&t.push(r)}return t}getItemAt(e){if(!(e<0||e>=this._length))return this.data[e]}includes(e,t){const i=this.data.indexOf(e,t);return-1!==i&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let t=e;t<this._length;++t)this.data[t]=this._deallocator(this.data[t]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,t=e.length){for(let i=0;i<t;i++)this.data[this._length++]=e[i]}fill(e,t){for(let i=0;i<t;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,a(this)}pop(){if(0===this.length)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const t=(0,s.cq)(this.data,e,this.length,this._hint);if(-1!==t)return this.data.splice(t,1),this.length=this.length-1,e}removeUnordered(e){const t=(0,s.e$)(this.data,e,this.length,this._hint);return void 0!==t&&(this.length=this.length-1),this._shrink(),t}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,t=e.length,i){this.length=(0,s.FY)(this.data,e,this.length,t,this._hint,i),this._shrink()}front(){if(0!==this.length)return this.data[0]}back(){if(0!==this.length)return this.data[this.length-1]}swapElements(e,t){e>=this.length||t>=this.length||e===t||([this.data[e],this.data[t]]=[this.data[t],this.data[e]])}sort(e){n.sort(this.data,0,this.length,e)}iterableSort(e){return n.iterableSort(this.data,0,this.length,e)}some(e,t){for(let i=0;i<this.length;++i)if(e.call(t,this.data[i],i,this.data))return!0;return!1}filterInPlace(e,t){let i=0;for(let r=0;r<this._length;++r){const s=this.data[r];e.call(t,s,r,this.data)&&(this.data[r]=this.data[i],this.data[i]=s,i++)}if(this._deallocator)for(let e=i;e<this._length;e++)this.data[e]=this._deallocator(this.data[e]);return this._length=i,this._shrink(),this}forAll(e,t){const i=this.length,r=this.data;for(let s=0;s<i;++s)e.call(t,r[s],s,r)}forEach(e,t){for(let i=0;i<this.length;++i)e.call(t,this.data[i],i,this.data)}map(e,t){const i=new Array(this.length);for(let r=0;r<this.length;++r)i[r]=e.call(t,this.data[r],r,this.data);return i}reduce(e,t){let i=t;for(let t=0;t<this.length;++t)i=e(i,this.data[t],t,this.data);return i}has(e){const t=this.length,i=this.data;for(let r=0;r<t;++r)if(i[r]===e)return!0;return!1}}function a(e){e.data.length>1.5*e.length&&(e.data.length=Math.floor(1.1*e.length))}},64189:(e,t,i)=>{"use strict";i.d(t,{D:()=>d,v:()=>h});var r,s,n=i(36663),o=i(53443),a=i(61681),l=i(78668),c=i(40266);(s=r||(r={}))[s.PENDING=0]="PENDING",s[s.RESOLVED=1]="RESOLVED",s[s.REJECTED=2]="REJECTED";class u{constructor(e){this.instance=e,this._resolver=(0,l.dD)(),this._status=r.PENDING,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=r.RESOLVED,this._cleanUp()}),(()=>{this._status=r.REJECTED,this._cleanUp()}))}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===r.RESOLVED}isRejected(){return this._status===r.REJECTED}isFulfilled(){return this._status!==r.PENDING}abort(){this._resolver.reject((0,l.zE)())}when(e,t){return this._resolver.promise.then(e,t)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const e=(0,l.dD)(),t=[...this._resolvingPromises,(0,a.j0)(e.promise)],i=this._allPromise=Promise.all(t);i.then((()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)}),(e=>{this.isFulfilled()||this._allPromise!==i||(0,l.D_)(e)||this._resolver.reject(e)})),e.resolve()}}const h=e=>{let t=class extends e{constructor(...e){super(...e),this._promiseProps=new u(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(e,t){return new Promise(((e,t)=>{this._promiseProps.when(e,t)})).then(e,t)}catch(e){return this.when(null,e)}addResolvingPromise(e){e&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in e?e.when():e)}};return t=(0,n._)([(0,c.j)("esri.core.Promise")],t),t};let d=class extends(h(o.Z)){};d=(0,n._)([(0,c.j)("esri.core.Promise")],d)},58713:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var r=i(61681);class s{constructor(e=(e=>e.values().next().value)){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(0===this._items.size)return;let e;for(e of this._items);return e}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete((0,r.j0)(e)),e}popLast(){if(0===this.length)return;const e=this.last();return this._items.delete((0,r.j0)(e)),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach((t=>{e(t)||this._items.delete(t)})),this}}},4157:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});class r{constructor(e=1){this._seed=e}set seed(e){this._seed=null==e?Math.random()*r._m:e}getInt(){return this._seed=(r._a*this._seed+r._c)%r._m,this._seed}getFloat(){return this.getInt()/(r._m-1)}getIntRange(e,t){return Math.round(this.getFloatRange(e,t))}getFloatRange(e,t){const i=t-e;return e+this.getInt()/r._m*i}}r._m=2147483647,r._a=48271,r._c=0},2497:(e,t,i)=>{"use strict";i.d(t,{e:()=>n});var r=i(61681),s=i(34596);class n extends s.Z{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=(0,r.Bd)(this._set)}acquire(...e){const t=super.acquire(...e);return this._set.delete(t),t}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}}},19784:(e,t,i)=>{"use strict";function r(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}i.d(t,{f:()=>r})},26139:(e,t,i)=>{"use strict";i.d(t,{G:()=>s});var r=i(70375);class s{constructor(e,t,i=""){this.major=e,this.minor=t,this._context=i}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",i=this._context&&this._context+" ";throw new r.Z(t+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new s(this.major,this.minor,this._context)}static parse(e,t=""){const[i,n]=e.split("."),o=/^\s*\d+\s*$/;if(!i||!i.match||!i.match(o))throw new r.Z((t&&t+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!n||!n.match||!n.match(o))throw new r.Z((t&&t+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const a=parseInt(i,10),l=parseInt(n,10);return new s(a,l,t)}}},96863:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var r=i(49290);class s extends r.Z{constructor(e,t,i){if(super(e,t,i),!(this instanceof s))return new s(e,t,i)}}s.prototype.type="warning"},65943:(e,t,i)=>{"use strict";i.d(t,{M9:()=>a,Wm:()=>c,kk:()=>o,s3:()=>r,x3:()=>l});var r,s,n=i(61681);(s=r||(r={}))[s.DEFAULTS=0]="DEFAULTS",s[s.COMPUTED=1]="COMPUTED",s[s.SERVICE=2]="SERVICE",s[s.PORTAL_ITEM=3]="PORTAL_ITEM",s[s.WEB_SCENE=4]="WEB_SCENE",s[s.WEB_MAP=5]="WEB_MAP",s[s.USER=6]="USER";const o=r.USER+1;function a(e){switch(e){case"defaults":return r.DEFAULTS;case"service":return r.SERVICE;case"portal-item":return r.PORTAL_ITEM;case"web-scene":return r.WEB_SCENE;case"web-map":return r.WEB_MAP;case"user":return r.USER}}function l(e){switch(e){case r.DEFAULTS:return"defaults";case r.SERVICE:return"service";case r.PORTAL_ITEM:return"portal-item";case r.WEB_SCENE:return"web-scene";case r.WEB_MAP:return"web-map";case r.USER:return"user"}return(0,n.j0)(void 0)}function c(e){return l(e)}},42730:(e,t,i)=>{"use strict";i.d(t,{B:()=>s});var r=i(81977);function s(e,t){const i=t?{...t,source:e}:e;return(0,r.Cb)({aliasOf:i})}},69236:(e,t,i)=>{"use strict";i.d(t,{p:()=>l});var r=i(7283),s=i(41610);const n=Object.prototype.toString;function o(e){const t="__accessorMetadata__"in e?(0,r.se)(e):e;return function(...e){if(e.push(t),"number"==typeof e[2])throw new Error("Using @cast has parameter decorator is not supported since 4.16");return a.apply(this,e)}}function a(e,t,i,r){(0,s.VZ)(e,t).cast=r}function l(...e){if(3!==e.length||"string"!=typeof e[1])return 1===e.length&&"[object Function]"===n.call(e[0])?o(e[0]):1===e.length&&"string"==typeof e[0]?function(e){return(t,i)=>{(0,s.VZ)(t,e).cast=t[i]}}(e[0]):void 0}},79438:(e,t,i)=>{"use strict";i.d(t,{J:()=>n});var r=i(25709),s=i(81977);function n(e,t={}){const i=e instanceof r.X?e:new r.X(e,t),n={type:t?.ignoreUnknown??1?i.apiValues:String,json:{type:i.jsonValues,read:!t?.readOnly&&{reader:i.read},write:{writer:i.write}}};return void 0!==t?.readOnly&&(n.readOnly=!!t.readOnly),void 0!==t?.default&&(n.json.default=t.default),void 0!==t?.name&&(n.json.name=t.name),(0,s.Cb)(n)}},42557:(e,t,i)=>{"use strict";i.d(t,{B:()=>g});var r=i(61681),s=i(71760),n=i(3466),o=i(12173),a=i(41610),l=i(65943),c=i(81977);function u(e){return h[function(e){return e instanceof Blob?e.type:function(e){const t=(0,n.Ml)(e);return f[t]||d}(e.url)}(e)]||p}const h={},d="text/plain",p=h[d],f={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const e in f)h[f[e]]=e;var m=i(16641);function g(e){const t=(0,r.pC)(e)&&e.origins?e.origins:[void 0];return(i,o)=>{const h=function(e,t,i){if((0,r.pC)(e)&&"resource"===e.type)return function(e,t,i){const o=(0,a.VZ)(t,i);return{type:String,read:(e,t,i)=>{const r=(0,m.r)(e,t,i);return o.type===String?r:"function"==typeof o.type?new o.type({url:r}):void 0},write:{writer(t,a,c,h){if(!h||!h.resources)return"string"==typeof t?void(a[c]=(0,m.t)(t,h)):void(a[c]=t.write({},h));const d=function(e){return(0,r.Wi)(e)?null:"string"==typeof e?e:e.url}(t),p=d?(0,m.t)(d,{...h,verifyItemRelativeUrls:h&&h.verifyItemRelativeUrls?{writtenUrls:h.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},m.M.NO):null,f=o.type!==String&&(!(0,s.l)(this)||h&&h.origin&&this.originIdOf(i)>(0,l.M9)(h.origin));h&&h.portalItem&&(0,r.pC)(p)&&!(0,n.YP)(p)?f?function(e,t,i,r,s,o,a,l){const c=a.portalItem.resourceFromPath(r),h=v(i,r,a);u(h)===(0,n.Ml)(c.path)?(_(e,t,c,h,a.resources.toUpdate),s[o]=r):y(e,t,i,r,s,o,a,l)}(this,i,t,p,a,c,h,e):function(e,t,i,r){r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(e)}),t[i]=e}(p,a,c,h):h&&h.portalItem&&((0,r.Wi)(p)||(0,r.pC)((0,m.i)(p))||(0,n.jc)(p)||f)?y(this,i,t,p,a,c,h,e):a[c]=p}}}}(e,t,i);switch((0,r.pC)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=m.p;return{read:e,write:t}}}}(e,i,o);for(const e of t){const t=(0,c.CJ)(i,e,o);for(const e in h)t[e]=h[e]}}}function y(e,t,s,a,l,c,h,d){const p=(0,o.D)(),f=v(s,a,h),m=(0,n.v_)((0,r.U2)(d,"prefix"),p),g=`${m}.${u(f)}`,y=h.portalItem.resourceFromPath(g);(0,n.jc)(a)&&h.resources.pendingOperations.push(async function(e){const t=(await Promise.resolve().then(i.bind(i,66341))).default,{data:r}=await t(e,{responseType:"blob"});return r}(a).then((e=>{y.path=`${m}.${u(e)}`,l[c]=y.itemRelativeUrl})).catch((()=>{}))),_(e,t,y,f,h.resources.toAdd),l[c]=y.itemRelativeUrl}function _(e,t,i,r,s){s.push({resource:i,content:r,finish:i=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function v(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}},81977:(e,t,i)=>{"use strict";i.d(t,{CJ:()=>c,Cb:()=>l,Eg:()=>u});var r=i(13802),s=i(7283),n=i(51777),o=i(41610),a=i(33156);function l(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const l=Object.getOwnPropertyDescriptor(t,i),c=(0,o.VZ)(t,i);l&&(l.get||l.set?(c.get=l.get||c.get,c.set=l.set||c.set):"value"in l&&("value"in e&&r.Z.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),c.value=e.value=l.value)),null!=e.readOnly&&(c.readOnly=e.readOnly);const h=e.aliasOf;if(h){const e="string"==typeof h?h:h.source,t="string"==typeof h?null:!0===h.overridable;let r;c.dependsOn=[e],c.get=function(){let t=(0,n.U2)(this,e);if("function"==typeof t){r||(r=e.split(".").slice(0,-1).join("."));const i=(0,n.U2)(this,r);i&&(t=t.bind(i))}return t},c.readOnly||(c.set=t?function(e){void 0!==e?this._override(i,e):this._clearOverride(i)}:function(t){(0,a.t)(this,e,t)})}const d=e.type,p=e.types;c.cast||(d?c.cast=function(e){let t=0,i=e;if((0,s.AY)(e))return(0,s.sY)(e);for(;Array.isArray(i)&&1===i.length&&"string"!=typeof i[0]&&"number"!=typeof i[0];)i=i[0],t++;const r=i;if((0,s.gB)(r))return 0===t?(0,s.i$)(r):(0,s.Iu)((0,s.i$)(r),t);if(1===t)return(0,s.rY)(r);if(t>1)return(0,s.di)(r,t);const n=e;return n.from?n.from:(0,s.se)(n)}(d):p&&(Array.isArray(p)?c.cast=(0,s.Ls)((0,s.N7)(p[0])):c.cast=(0,s.N7)(p))),e.range&&(c.cast=u(c.cast,e.range)),(0,o.tz)(c,e)}}function c(e,t,i){const r=(0,o.VZ)(e,i);r.json||(r.json={});let s=r.json;return void 0!==t&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function u(e,t){return i=>{let r=+e(i);return null!=t.step&&(r=Math.round(r/t.step)*t.step),null!=t.min&&(r=Math.max(t.min,r)),null!=t.max&&(r=Math.min(t.max,r)),r}}},34248:(e,t,i)=>{"use strict";i.d(t,{r:()=>s});var r=i(81977);function s(e,t,i){let s,n;return void 0===t||Array.isArray(t)?(n=e,i=t,s=[void 0]):(n=t,s=Array.isArray(e)?e:[e]),(e,t)=>{const o=e.constructor.prototype;s.forEach((s=>{const a=(0,r.CJ)(e,s,n);a.read&&"object"==typeof a.read||(a.read={}),a.read.reader=o[t],i&&(a.read.source=(a.read.source||[]).concat(i))}))}}},2107:(e,t,i)=>{"use strict";function r(e){return(t,i)=>{t[i]=e}}i.d(t,{c:()=>r})},40266:(e,t,i)=>{"use strict";i.d(t,{j:()=>c}),i(39994);var r=i(66175),s=i(41610),n=i(55860),o=i(48616);const a=new Set,l=new Set;function c(e){return t=>{t.prototype.declaredClass=e,h(t);const i=[],r=[];let n=t.prototype;for(;n;)n.hasOwnProperty("initialize")&&!a.has(n.initialize)&&(a.add(n.initialize),i.push(n.initialize)),n.hasOwnProperty("destroy")&&!l.has(n.destroy)&&(l.add(n.destroy),r.push(n.destroy)),n=Object.getPrototypeOf(n);a.clear(),l.clear();class o extends t{constructor(...e){if(super(...e),this.constructor===o&&"function"==typeof this.postscript){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let e=i.length-1;e>=0;e--)i[e].call(this)}}),r.length){let e=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!e){e=!0;for(let e=0;e<r.length;e++)r[e].call(this)}}})}this.postscript(...e)}}}return o.__accessorMetadata__=(0,s.JT)(t.prototype),o.prototype.declaredClass=e,o}}function u(e,t){return null==t.get?function(){const t=this.__accessor__.properties.get(e);if(void 0===t)return;(0,n.it)(t);const i=this.__accessor__.store;return i.has(e)?i.get(e):t.metadata.value}:function(){const t=this.__accessor__.properties.get(e);if(void 0!==t)return t.getComputed()}}function h(e){const t=e.prototype,i=(0,s.JT)(t).properties,n={};for(const e of Object.getOwnPropertyNames(i)){const t=i[e];(0,o.OM)(t),n[e]={enumerable:!0,configurable:!0,get:u(e,t),set(i){const s=this.__accessor__;if(void 0!==s){if(!Object.isFrozen(this)){if(s.initialized&&t.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${e}' of ${this.declaredClass}`);if(s.lifecycle===r.F.CONSTRUCTED&&t.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${e}' of ${this.declaredClass}`);s.set(e,i)}}else Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:i})}}}Object.defineProperties(e.prototype,n)}},39835:(e,t,i)=>{"use strict";i.d(t,{c:()=>s});var r=i(81977);function s(e,t,i){let s,n;return void 0===t?(n=e,s=[void 0]):"string"!=typeof t?(n=e,s=[void 0],i=t):(n=t,s=Array.isArray(e)?e:[e]),(e,t)=>{const o=e.constructor.prototype;for(const a of s){const s=(0,r.CJ)(e,a,n);s.write&&"object"==typeof s.write||(s.write={}),i&&(s.write.target=i),s.write.writer=o[t]}}}},20701:(e,t,i)=>{"use strict";i.d(t,{M:()=>s});var r=i(65943);function s(e,t,i){t.keys().forEach((e=>{i.set(e,t.get(e),r.s3.DEFAULTS)}));const s=e.metadatas;Object.keys(s).forEach((t=>{e.internalGet(t)&&i.set(t,e.internalGet(t),r.s3.DEFAULTS)}))}},27281:(e,t,i)=>{"use strict";i.d(t,{Hg:()=>m,V7:()=>f,uD:()=>p,xb:()=>g});var r=i(53443),s=i(41831),n=i(61681),o=i(95620);const a=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function l(e){return e instanceof r.Z}function c(e){return e instanceof s.Z?Object.keys(e.items):l(e)?(0,o.vw)(e).keys():e?Object.keys(e):[]}function u(e,t){return e instanceof s.Z?e.items[t]:e[t]}function h(e){return e?e.declaredClass:null}function d(e,t){const i=e.diff;if(i&&"function"==typeof i)return i(e,t);const r=c(e),s=c(t);if(0===r.length&&0===s.length)return;if(!r.length||!s.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const o=s.filter((e=>!r.includes(e))),p=r.filter((e=>!s.includes(e))),f=r.filter((i=>s.includes(i)&&u(e,i)!==u(t,i))).concat(o,p).sort(),m=h(e);if(m&&a.includes(m)&&f.length)return{type:"complete",oldValue:e,newValue:t};let g;const y=l(e)&&l(t);for(const r of f){const s=u(e,r),o=u(t,r);let a;if((y||"function"!=typeof s&&"function"!=typeof o)&&s!==o&&(null!=s||null!=o)){if(i&&i[r]&&"function"==typeof i[r])a=i[r](s,o);else if(s instanceof Date&&o instanceof Date){if(s.getTime()===o.getTime())continue;a={type:"complete",oldValue:s,newValue:o}}else a="object"==typeof s&&"object"==typeof o&&h(s)===h(o)?d(s,o):{type:"complete",oldValue:s,newValue:o};(0,n.pC)(a)&&((0,n.pC)(g)?g.diff[r]=a:g={type:"partial",diff:{[r]:a}})}}return g}function p(e,t){if((0,n.Wi)(e))return!1;const i=t.split(".");let r=e;for(const e of i){if("complete"===r.type)return!0;if("partial"!==r.type)return!1;{const t=r.diff[e];if(!t)return!1;r=t}}return!0}function f(e,t){for(const i of t)if(p(e,i))return!0;return!1}function m(e,t){if(!("function"==typeof e||"function"==typeof t||(0,n.Wi)(e)&&(0,n.Wi)(t)))return(0,n.Wi)(e)||(0,n.Wi)(t)||"object"==typeof e&&"object"==typeof t&&h(e)!==h(t)?{type:"complete",oldValue:e,newValue:t}:d(e,t)}function g(e){if((0,n.Wi)(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!g(e))return!1;for(const e of t.removed)if(!g(e))return!1;for(const e of t.changed)if(!g(e))return!1;return!0}case"partial":for(const t in e.diff)if(!g(e.diff[t]))return!1;return!0}}},7283:(e,t,i)=>{"use strict";i.d(t,{AY:()=>P,Iu:()=>T,Ls:()=>w,N7:()=>M,TJ:()=>g,V5:()=>R,Zs:()=>l,di:()=>S,gB:()=>E,i$:()=>A,q9:()=>c,rY:()=>x,sY:()=>I,se:()=>b,vU:()=>u,z8:()=>O}),i(39994);var r=i(13802),s=i(86114);const n=r.Z.getLogger("esri.core.Accessor");function o(e){return null==e?e:new Date(e)}function a(e){return null==e?e:!!e}function l(e){return null==e?e:e.toString()}function c(e){return null==e?e:(e=parseFloat(e),isNaN(e)?0:e)}function u(e){return null==e?e:Math.round(parseFloat(e))}function h(e){return e&&e.constructor&&void 0!==e.constructor.__accessorMetadata__}function d(e,t){return null!=t&&e&&!(t instanceof e)}function p(e){return e&&"isCollection"in e}function f(e){return e&&e.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function m(e,t){return!!h(t)&&(n.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+y(e)+"'"),!0)}function g(e,t){return null==t?t:p(e)?function(e,t){if(!t||!t.constructor||!p(t.constructor))return m(e,t)?t:new e(t);const i=f(e.prototype.itemType),r=f(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(m(e,t),t):new e(t):t}(e,t):d(e,t)?m(e,t)?t:new e(t):t}function y(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const _=new WeakMap;function v(e){switch(e){case Number:return c;case O:return u;case Boolean:return a;case String:return l;case Date:return o;default:return(0,s.s1)(_,e,(()=>g.bind(null,e)))}}function b(e,t){const i=v(e);return 1===arguments.length?i:i(t)}function w(e,t,i){return 1===arguments.length?w.bind(null,e):t?Array.isArray(t)?t.map((t=>e(t,i))):[e(t,i)]:t}function x(e,t){return 1===arguments.length?w(b.bind(null,e)):w(b.bind(null,e),t)}function C(e,t,i){return 0!==t&&Array.isArray(i)?i.map((i=>C(e,t-1,i))):e(i)}function T(e,t,i){if(2===arguments.length)return T.bind(null,e,t);if(!i)return i;let r=t,s=i=C(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(void 0!==s)for(let e=0;e<r;e++)i=[i];return i}function S(e,t,i){return 2===arguments.length?T(b.bind(null,e),t):T(b.bind(null,e),t,i)}function E(e){return!!Array.isArray(e)&&!e.some((t=>{const i=typeof t;return!("string"===i||"number"===i||"function"===i&&e.length>1)}))}function A(e,t){if(2===arguments.length)return A(e).call(null,t);const i=new Set,r=e.filter((e=>"function"!=typeof e)),s=e.filter((e=>"function"==typeof e));for(const t of e)"string"!=typeof t&&"number"!=typeof t||i.add(t);let o=null,a=null;return(e,t)=>{if(null==e)return e;const l=typeof e,c="string"===l||"number"===l;return c&&(i.has(e)||s.some((e=>"string"===l&&e===String||"number"===l&&e===Number)))||"object"===l&&s.some((t=>!d(e,t)))?e:(c&&r.length?(o||(o=r.map((e=>"string"==typeof e?`'${e}'`:`${e}`)).join(", ")),n.error("Accessor#set",`'${e}' is not a valid value for this property, only the following values are valid: ${o}`)):"object"==typeof e&&s.length?(a||(a=s.map((e=>y(e))).join(", ")),n.error("Accessor#set",`'${e}' is not a valid value for this property, value must be one of ${a}`)):n.error("Accessor#set",`'${e}' is not a valid value for this property`),t&&(t.valid=!1),null)}}function M(e,t){if(2===arguments.length)return M(e).call(null,t);const i={},r=[],s=[];for(const t in e.typeMap){const n=e.typeMap[t];i[t]=b(n),r.push(y(n)),s.push(t)}const o=()=>`'${r.join("', '")}'`,a=()=>`'${s.join("', '")}'`,l="string"==typeof e.key?t=>t[e.key]:e.key;return t=>{if(e.base&&!d(e.base,t))return t;if(null==t)return t;const r=l(t)||e.defaultKeyValue,s=i[r];if(!s)return n.error("Accessor#set",`Invalid property value, value needs to be one of ${o()}, or a plain object that can autocast (having .type = ${a()})`),null;if(!d(e.typeMap[r],t))return t;if("string"==typeof e.key&&!h(t)){const i={};for(const r in t)r!==e.key&&(i[r]=t[r]);return s(i)}return s(t)}}class O{}const R={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function P(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function I(e){switch(e.type){case"native":return b(e.value);case"array":return w(I(e.value));case"one-of":return function(e){let t=null;return(i,r)=>D(i,e)?i:(null==t&&(t=L(e)),n.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}(e);default:return null}}function L(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case O:return"integer";case Date:return"date";default:return y(e.value)}case"array":return`array of ${L(e.value)}`;case"one-of":{const t=e.values.map((e=>L(e)));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function D(e,t){if(null==e)return!0;switch(t.type){case"native":switch(t.value){case Number:case O:return"number"==typeof e;case Boolean:return"boolean"==typeof e;case String:return"string"==typeof e}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some((e=>!D(e,t.value)));case"one-of":return t.values.some((t=>D(e,t)))}}},48616:(e,t,i)=>{"use strict";i.d(t,{hk:()=>d,HS:()=>u,Ah:()=>h,OM:()=>g});var r=i(7283),s=i(3593);function n(e){if(e.json||(e.json={}),a(e.json),l(e.json),o(e.json),e.json.origins)for(const t in e.json.origins)a(e.json.origins[t]),l(e.json.origins[t]),o(e.json.origins[t]);return!0}function o(e){e.name&&(e.read&&"object"==typeof e.read?void 0===e.read.source&&(e.read.source=e.name):e.read={source:e.name},e.write&&"object"==typeof e.write?void 0===e.write.target&&(e.write.target=e.name):e.write={target:e.name})}function a(e){"boolean"==typeof e.read?e.read={enabled:e.read}:"function"==typeof e.read?e.read={enabled:!0,reader:e.read}:e.read&&"object"==typeof e.read&&void 0===e.read.enabled&&(e.read.enabled=!0)}function l(e){"boolean"==typeof e.write?e.write={enabled:e.write}:"function"==typeof e.write?e.write={enabled:!0,writer:e.write}:e.write&&"object"==typeof e.write&&void 0===e.write.enabled&&(e.write.enabled=!0)}var c=i(64626);function u(e,t){return d(e,"read",t)}function h(e,t){return d(e,"write",t)}function d(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=e.json.origins[i.origin];s&&("any"===t||t in s)&&(r=s)}return r}function p(e){return e.type?f(e):m(e)}function f(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!(0,r.gB)(i);)i=i[0],t++;return{type:i,ndimArray:t}}function m(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function g(e){n(e)&&(function(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const e in i)if(t[e]){const r=t[e];i[e].forEach((e=>{t[e]=r})),delete t[e]}}}(e),function(e){const t=function(e){return e.json.types?m(e.json):e.type?f(e):m(e)}(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],n=r.types?p(r):t;(0,s.U)(n,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write={...e.json.write}),(0,c.U)(n,r)}(0,s.U)(t,e.json,!0),(0,c.U)(t,e.json)}(e))}},3593:(e,t,i)=>{"use strict";i.d(t,{U:()=>c,d:()=>u});var r=i(13802),s=i(86745),n=i(96863),o=i(41610),a=i(15680);const l=r.Z.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function c(e,t,i){e&&(!i&&!t.read||t.read?.reader||!1===t.read?.enabled||function(e){return"types"in e?g(e.types):m(e.type)}(e)&&(0,s.RB)("read.reader",u(e),t))}function u(e){const t=e.ndimArray??0;if(t>1)return function(e){const t=h(e),i=d.bind(null,t),r=e.ndimArray??0;return(e,t,s)=>{if(null==e)return e;e=i(e,s,r);let n=r,o=e;for(;n>0&&Array.isArray(o);)n--,o=o[0];if(void 0!==o)for(let t=0;t<n;t++)e=[e];return e}}(e);if(1===t)return p(e);if("type"in e&&f(e.type)){const t=e.type.prototype?.itemType?.Type,i=p("function"==typeof t?{type:t}:{types:t});return(t,r,s)=>{const n=i(t,r,s);return n?new e.type(n):n}}return h(e)}function h(e){return"type"in e?function(e){return e.prototype.read?(t,i,r)=>{if(null==t)return t;const s=typeof t;if("object"!==s)return void l.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}(e.type):function(e){let t=null;const i=e.errorContext??"type";return(r,s,a)=>{if(null==r)return r;const c=typeof r;if("object"!==c)return void l.error(`Expected JSON value of type 'object' to deserialize, but got '${c}'`);t||(t=function(e){const t={};for(const i in e.typeMap){const r=e.typeMap[i],s=(0,o.JT)(r.prototype);if("function"==typeof e.key)continue;const n=s.properties[e.key];if(!n)continue;n.json?.type&&Array.isArray(n.json.type)&&1===n.json.type.length&&"string"==typeof n.json.type[0]&&(t[n.json.type[0]]=r);const a=n.json?.write;if(!a||!a.writer){t[i]=r;continue}const l=a.target,c="string"==typeof l?l:e.key,u={};a.writer(i,u,c),u[c]&&(t[u[c]]=r)}return t}(e));const u=e.key;if("string"!=typeof u)return;const h=r[u],d=h?t[h]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!d){const e=`Type '${h||"unknown"}' is not supported`;return a&&a.messages&&r&&a.messages.push(new n.Z(`${i}:unsupported`,e,{definition:r,context:a})),void l.error(e)}const p=new d;return p.read(r,a),p}}(e.types)}function d(e,t,i,r){return 0!==r&&Array.isArray(t)?t.map((t=>d(e,t,i,r-1))):e(t,void 0,i)}function p(e){const t=h(e);return(e,i,r)=>{if(null==e)return e;if(Array.isArray(e)){const i=[];for(const s of e){const e=t(s,void 0,r);void 0!==e&&i.push(e)}return i}const s=t(e,void 0,r);return void 0!==s?[s]:void 0}}function f(e){if(!(0,a.u)(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&("function"==typeof t.Type?m(t.Type):g(t.Type))}function m(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||f(e))}function g(e){for(const t in e.typeMap)if(!m(e.typeMap[t]))return!1;return!0}},15680:(e,t,i)=>{"use strict";function r(e){return!!e&&e.prototype&&e.prototype.declaredClass&&0===e.prototype.declaredClass.indexOf("esri.core.Collection")}i.d(t,{u:()=>r})},64626:(e,t,i)=>{"use strict";i.d(t,{U:()=>l,k:()=>d});var r=i(70375),s=i(13802),n=i(86745),o=i(15680);const a=s.Z.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function l(e,t){if(!t.write||t.write.writer||!1===t.write.enabled&&!t.write.overridePolicy)return;const i=e?.ndimArray??0;e&&(1===i||"type"in e&&(0,o.u)(e.type))?t.write.writer=p:i>1?t.write.writer=function(e){return(t,i,r,s)=>{let o;if(null===t)o=null;else{o=f(t,s,e);let i=e,r=o;for(;i>0&&Array.isArray(r);)i--,r=r[0];if(void 0!==r)for(let e=0;e<i;e++)o=[o]}(0,n.RB)(r,o,i)}}(i):t.types?Array.isArray(t.types)?t.write.writer=function(e){return(t,i,r,s)=>t&&Array.isArray(t)?u(t.filter((t=>c(t,e,s))),i,r,s):u(t,i,r,s)}(t.types[0]):t.write.writer=function(e){return(t,i,r,s)=>t?c(t,e,s)?u(t,i,r,s):void 0:u(t,i,r,s)}(t.types):t.write.writer=u}function c(e,t,i){for(const i in t.typeMap)if(e instanceof t.typeMap[i])return!0;if(i?.messages){const s=t.errorContext??"type",n=`Values of type '${("function"!=typeof t.key?e[t.key]:e.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new r.Z(`${s}:unsupported`,n,{definition:e,context:i})),a.error(n)}return!1}function u(e,t,i,r){(0,n.RB)(i,h(e,r),t)}function h(e,t){return e&&"function"==typeof e.write?e.write({},t):e&&"function"==typeof e.toJSON?e.toJSON():"number"==typeof e?d(e):e}function d(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function p(e,t,i,r){let s;null===e?s=null:e&&"function"==typeof e.map?(s=e.map((e=>h(e,r))),"function"==typeof s.toArray&&(s=s.toArray())):s=[h(e,r)],(0,n.RB)(i,s,t)}function f(e,t,i){return 0!==i&&Array.isArray(e)?e.map((e=>f(e,t,i-1))):h(e,t)}},51777:(e,t,i)=>{"use strict";i.d(t,{$z:()=>o,Gg:()=>l,U2:()=>a});var r=i(95620);function s(e,t){const i="?"===e[e.length-1]?e.slice(0,-1):e;if(null!=t.getItemAt||Array.isArray(t)){const e=parseInt(i,10);if(!isNaN(e))return Array.isArray(t)?t[e]:t.getItemAt(e)}const s=(0,r.vw)(t);return(0,r.b6)(s,i)?s.get(i):t[i]}function n(e,t,i){if(null==e)return e;const r=s(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:n(r,t,i+1)}function o(e,t,i=0){return"string"!=typeof t||t.includes(".")?n(e,(0,r.NI)(t),i):s(t,e)}function a(e,t){return o(e,t)}function l(e,t){return void 0!==o(t,e)}},66175:(e,t,i)=>{"use strict";var r;i.d(t,{F:()=>r}),function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"}(r||(r={}))},41610:(e,t,i)=>{"use strict";i.d(t,{JT:()=>a,VZ:()=>l,tz:()=>c});var r=i(67134),s=i(61681),n=i(95620);class o{constructor(e){this.autoDestroy=!1,this.properties=e}}function a(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){const i=Object.create(t.properties),s=t.autoDestroy;for(const e in i)i[e]=(0,r.d9)(i[e]);t=new o(i),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new o({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return(0,s.j0)(e.constructor.__accessorMetadata__)}function l(e,t){const i=function(e){return a(e).properties}(e);let r=i[t];return r||(r=i[t]={}),r}function c(e,t){return(0,n.TS)(e,t,h)}const u=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function h(e){return u.test(e)?"replace":"merge"}},50516:(e,t,i)=>{"use strict";i.d(t,{D:()=>s});var r=i(71760);function s(e){e&&e.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:t,newOrigin:i})=>{(0,r.l)(e)&&i&&e.originOf(t)!==i&&e.updateOrigin(t,i)}))}},70148:(e,t,i)=>{"use strict";i.d(t,{$:()=>h,i:()=>u});var r=i(51777),s=i(95620),n=i(48616);function o(e,t,i){if(!e||!e.read||!1===e.read.enabled||!e.read.source)return!1;const s=e.read.source;if("string"==typeof s){if(s===t)return!0;if(s.includes(".")&&0===s.indexOf(t)&&(0,r.Gg)(s,i))return!0}else for(const e of s){if(e===t)return!0;if(e.includes(".")&&0===e.indexOf(t)&&(0,r.Gg)(e,i))return!0}return!1}function a(e,t,i,r,s){let a=(0,n.HS)(t[i],s);(function(e){return e&&(!e.read||!1!==e.read.enabled&&!e.read.source)})(a)&&(e[i]=!0);for(const l of Object.getOwnPropertyNames(t))a=(0,n.HS)(t[l],s),o(a,i,r)&&(e[l]=!0)}function l(e,t,i,r){const s=i.metadatas,o=(0,n.hk)(s[t],"any",r),a=o&&o.default;if(void 0===a)return;const l="function"==typeof a?a.call(e,t,r):a;void 0!==l&&i.set(t,l)}const c={origin:"service"};function u(e,t,i=c){if(!t||"object"!=typeof t)return;const o=(0,s.vw)(e),u=o.metadatas,h={};for(const e of Object.getOwnPropertyNames(t))a(h,u,e,t,i);o.setDefaultOrigin(i.origin);for(const s of Object.getOwnPropertyNames(h)){const a=(0,n.HS)(u[s],i).read,l=a&&a.source;let c;c=l&&"string"==typeof l?(0,r.$z)(t,l):t[s],a&&a.reader&&(c=a.reader.call(e,c,t,i)),void 0!==c&&o.set(s,c)}if(!i||!i.ignoreDefaults){o.setDefaultOrigin("defaults");for(const t of Object.getOwnPropertyNames(u))h[t]||l(e,t,o,i)}o.setDefaultOrigin("user")}function h(e,t,i,r=c){const s={...r,messages:[]};i(s),s.messages?.forEach((t=>{"warning"!==t.type||e.loaded?r&&r.messages&&r.messages.push(t):e.loadWarnings.push(t)}))}},33156:(e,t,i)=>{"use strict";i.d(t,{t:()=>a});var r=i(70375),s=i(39994),n=i(13802),o=i(51777);function a(e,t,i){if(e&&t)if("object"==typeof t)for(const i of Object.getOwnPropertyNames(t))a(e,i,t[i]);else{if(t.includes(".")){const r=t.split("."),s=r.splice(r.length-1,1)[0];return void a((0,o.U2)(e,r),s,i)}const n=e.__accessor__;null!=n&&function(e,t){if((0,s.Z)("esri-unknown-property-errors")&&!function(e,t){return null!=t.metadatas[e]}(e,t))throw new r.Z("set:unknown-property",function(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}(e,t))}(t,n),e[t]=i}}n.Z.getLogger("esri.core.accessorSupport.set")},55860:(e,t,i)=>{"use strict";i.d(t,{GF:()=>v,LJ:()=>d,gb:()=>p,it:()=>c,mS:()=>y}),i(39994);var r=i(13802),s=i(95620),n=i(38488);let o,a=[];const l=r.Z.getLogger("esri.core.Accessor");function c(e){void 0!==o&&o.onObservableAccessed(e)}let u=!1,h=!1;function d(e,t,i){if(u)return f(e,t,i);m(e);const r=t.call(i);return g(),r}function p(e,t){return d(void 0,e,t)}function f(e,t,i){const r=u;u=!0,m(e);let s=null;try{s=t.call(i)}catch(e){h&&l.error(e)}return g(),u=r,s}function m(e){o=e,a.push(e)}function g(){const e=a.pop();o=a.length>0?a[a.length-1]:void 0,void 0!==e&&e.onTrackingEnd()}function y(e,t){if(t.flags&n.v.DepTrackingInitialized)return;const i=h;h=!1,t.flags&n.v.AutoTracked?f(t,t.metadata.get,e):v(e,t),h=i}const _=[];function v(e,t){t.flags&n.v.ExplicitlyTracking||(t.flags|=n.v.ExplicitlyTracking,f(t,(()=>{const i=t.metadata.dependsOn||_;for(const t of i)if("string"!=typeof t||t.includes(".")){const i=(0,s.NI)(t);for(let t=0,r=e;t<i.length&&null!=r&&"object"==typeof r;++t)r=b(r,i[t],t!==i.length-1)}else b(e,t,!1)})),t.flags&=~n.v.ExplicitlyTracking)}function b(e,t,i){const r="?"===t[t.length-1]?t.slice(0,-1):t;if(null!=e.getItemAt||Array.isArray(e)){const t=parseInt(r,10);if(!isNaN(t))return Array.isArray(e)?e[t]:e.getItemAt(t)}const n=(0,s.vw)(e)?.properties.get(r);return n&&(c(n),y(e,n)),i?e[r]:void 0}},63235:(e,t,i)=>{"use strict";i.d(t,{EH:()=>c,U5:()=>a,Xz:()=>l});var r=i(55860),s=i(24163);let n=!1;const o=[];function a(e,t){let i=new s.M((function s(){if(!i||a)return;if(n)return void u(s);const l=o;i.clear(),n=!0,a=!0,o=(0,r.LJ)(i,e),a=!1,n=!1,t(o,l),h()})),o=null,a=!1;return a=!0,o=(0,r.LJ)(i,e),a=!1,{remove:function(){i&&(i.destroy(),i=null,o=null)}}}function l(e,t){let i=new s.M((function(){t(n,o)})),n=null;function o(){return i?(i.clear(),n=(0,r.LJ)(i,e),n):null}return o(),{remove:function(){i&&(i.destroy(),i=null),n=null}}}function c(e){let t=new s.M((function s(){t&&!i&&(n?u(s):(t.clear(),n=!0,i=!0,(0,r.LJ)(t,e),i=!1,n=!1,h()))})),i=!1;return i=!0,(0,r.LJ)(t,e),i=!1,{remove:function(){t&&(t.destroy(),t=null)}}}function u(e){o.includes(e)||o.unshift(e)}function h(){for(;o.length;)o.pop()()}},38488:(e,t,i)=>{"use strict";var r;i.d(t,{v:()=>r}),function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"}(r||(r={}))},53080:(e,t,i)=>{"use strict";i.d(t,{X:()=>s});var r=i(7753);class s{constructor(e,t){this._observers=e,this._observer=t}remove(){(0,r.Od)(this._observers,this._observer)}}},26096:(e,t,i)=>{"use strict";i.d(t,{s:()=>s});var r=i(53080);class s{constructor(){this._observers=[]}observe(e){return this._observers.includes(e)||this._observers.push(e),new r.X(this._observers,e)}notify(){const e=this._observers.slice();for(let t=0;t<e.length;++t){const i=e[t];i.onInvalidated(),i.onCommitted()}}}},24163:(e,t,i)=>{"use strict";i.d(t,{M:()=>r});class r{constructor(e){this._notify=e,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const e=this._invalidCount;if(1===e)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}onObservableAccessed(e){this._accessed.includes(e)||this._accessed.push(e)}onTrackingEnd(){const e=this._handles,t=this._accessed;for(let i=0;i<t.length;++i)e.push(t[i].observe(this));t.length=0}clear(){const e=this._handles;for(let t=0;t<e.length;++t)e[t].remove();e.length=0}}},95620:(e,t,i)=>{"use strict";i.d(t,{IH:()=>p,NI:()=>u,Qc:()=>d,TS:()=>l,b6:()=>a,vw:()=>o});var r=i(23148),s=i(67134),n=i(61681);function o(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function a(e,t){return null!=e&&e.metadatas&&null!=e.metadatas[t]}function l(e,t,i){return c(e,t,i?{policy:i,path:""}:null)}function c(e,t,i){return t?Object.keys(t).reduce(((e,r)=>{let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${r}`:r,a=i.policy(o)),"replace"===a)return e[r]=t[r],e;if(void 0===e[r])return e[r]=(0,s.d9)(t[r]),e;let l=e[r],u=t[r];if(l===u)return e;if(Array.isArray(u)||Array.isArray(e))l=l?Array.isArray(l)?e[r]=l.concat():e[r]=[l]:e[r]=[],u&&(Array.isArray(u)||(u=[u]),u.forEach((e=>{l.includes(e)||l.push(e)})));else if(u&&"object"==typeof u)if(i){const t=i.path;i.path=(0,n.j0)(o),e[r]=c(l,u,i),i.path=t}else e[r]=c(l,u,null);else e.hasOwnProperty(r)&&!t.hasOwnProperty(r)||(e[r]=u);return e}),e||{}):e}function u(e){return Array.isArray(e)?e:e.split(".")}function h(e){return e.includes(",")?e.split(",").map((e=>e.trim())):[e.trim()]}function d(e,t,i,s){const n=function(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...h(i));return t}return h(e)}(t);if(1!==n.length){const t=n.map((t=>s(e,t,i)));return(0,r.AL)(t)}return s(e,n[0],i)}function p(e){let t=!1;return()=>{t||(t=!0,e())}}},81509:(e,t,i)=>{"use strict";i.d(t,{BT:()=>b,Fs:()=>T,NC:()=>A,YP:()=>S,aQ:()=>E});var r,s,n=i(50904),o=i(67134),a=i(2497),l=i(17262),c=i(19784),u=i(7958),h=i(51777),d=i(63235),p=i(95620);(s=r||(r={}))[s.Untracked=0]="Untracked",s[s.Tracked=1]="Tracked";class f{constructor(){this.uid=(0,u.D)(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,t,i,s,n){return this.pool.acquire(r.Untracked,e,t,i,s,n,o.fS)}static acquireTracked(e,t,i,s){return this.pool.acquire(r.Tracked,e,t,i,null,null,s)}notify(e,t){this.type===r.Untracked?this.callback.call(this.target,e,t,this.path,this.target):this.callback.call(null,e,t)}acquire(e,t,i,r,s,n,o){this.uid=(0,u.D)(),this.removed=!1,this.type=e,this.oldValue=t,this.callback=i,this.getValue=r,this.target=s,this.path=n,this.equals=o}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=(0,u.D)(),this.removed=!0}}f.pool=new a.e(f);const m=new n.Z,g=new Set;let y;function _(e){g.delete(e),g.add(e),y||(y=(0,l.Os)(w))}function v(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function b(e){for(const t of g.values())t.target===e&&(t.removed=!0)}function w(){let e=10;for(;y&&e--;){y=null;const e=x(),t=m.acquire();for(const i of e){const e=i.uid;v(i),e===i.uid&&i.removed&&t.push(i)}for(const e of g)e.removed&&(t.push(e),g.delete(e));for(const e of t)f.pool.release(e);m.release(t),m.release(e),C.forEach((e=>e()))}}function x(){const e=m.acquire();e.length=g.size;let t=0;for(const i of g)e[t]=i,++t;return g.clear(),e}const C=new Set;function T(e){return C.add(e),{remove(){C.delete(e)}}}function S(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?function(e,t,i){const r=(0,p.Qc)(e,t,i,((e,t,i)=>{let s=!1;return(0,d.U5)((()=>(0,h.$z)(e,t)),((n,a)=>{e.__accessor__.destroyed?r.remove():s||(s=!0,(0,o.fS)(a,n)||i.call(e,n,a,t,e),s=!1)}))}));return r}(e,t,i):function(e,t,i){let r=(0,p.Qc)(e,t,i,((e,t,i)=>{let s,n,o=(0,d.Xz)((()=>(0,h.$z)(e,t)),((o,a)=>{e.__accessor__.destroyed||s&&s.uid!==n?r.remove():(s||(s=f.acquireUntracked(o,i,a,e,t),n=s.uid),_(s))}));return{remove:(0,p.IH)((()=>{o.remove(),s&&(s.uid!==n||s.removed||(s.removed=!0,_(s)),s=null),r=o=null}))}}));return r}(e,t,i)}function E(e,t,i=!1,r=o.y7){return i?function(e,t,i){let r=!1;return(0,d.U5)(e,((e,s)=>{r||(r=!0,i(s,e)||t(e,s),r=!1)}))}(e,t,r):function(e,t,i){let r,s,n=(0,d.Xz)(e,((e,o)=>{r&&r.uid!==s?n.remove():(r||(r=f.acquireTracked(e,t,o,i),s=r.uid),_(r))}));return{remove:(0,p.IH)((()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,_(r)),r=null),n=null}))}}(e,t,r)}function A(e){return(0,c.f)(g,(t=>t.oldValue===e))}},86561:(e,t,i)=>{"use strict";i.d(t,{c:()=>p,d:()=>d});var r=i(7753),s=i(70375),n=i(13802),o=i(65943),a=i(95620),l=i(48616);const c=n.Z.getLogger("esri.core.accessorSupport.write");function u(e,t,i,r,s){const n={};return t.write?.writer?.call(e,r,n,i,s),n}function h(e,t,i,n,a,l){if(!n||!n.write)return!1;const u=e.get(i);if(!a&&n.write.overridePolicy){const t=n.write.overridePolicy.call(e,u,i,l);void 0!==t&&(a=t)}if(a||(a=n.write),!a||!1===a.enabled)return!1;if((null===u&&!a.allowNull&&!a.writerEnsuresNonNull||void 0===u)&&a.isRequired){const t=new s.Z("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return t&&l&&l.messages?l.messages.push(t):t&&!l&&c.error(t.name,t.message),!1}return!(void 0===u||null===u&&!a.allowNull&&!a.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(i)===o.s3.DEFAULTS)&&function(e,t,i,s,n){const o=s.default;if(void 0===o)return!1;if(null!=s.defaultEquals)return s.defaultEquals(n);if("function"==typeof o){if(Array.isArray(n)){const s=o.call(e,t,i);return(0,r.fS)(s,n)}return!1}return o===n}(e,i,l,n,u)||!a.ignoreOrigin&&l&&l.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<(0,o.M9)(l.origin))}function d(e,t,i,r){const s=(0,a.vw)(e),n=s.metadatas,o=(0,l.Ah)(n[t],r);return!!o&&h(e,s,t,o,i,r)}function p(e,t,i){if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return(0,a.TS)(t,e.toJSON(i));const r=(0,a.vw)(e),s=r.metadatas;for(const n in s){const c=(0,l.Ah)(s[n],i);if(!h(e,r,n,c,void 0,i))continue;const d=e.get(n),p=u(e,c,c.write&&"string"==typeof c.write.target?c.write.target:n,d,i);Object.keys(p).length>0&&(t=(0,a.TS)(t,p),i?.resources?.pendingOperations?.length&&Promise.all(i.resources.pendingOperations).then((()=>(0,a.TS)(t,p))),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:n,oldOrigin:(0,o.Wm)(r.store.originOf(n)),newOrigin:i.origin}))}return t}},7753:(e,t,i)=>{"use strict";i.d(t,{$A:()=>f,FY:()=>w,Od:()=>T,SO:()=>g,TV:()=>x,Tw:()=>n,Vx:()=>a,a9:()=>d,cq:()=>_,e$:()=>v,e5:()=>l,fS:()=>o,vr:()=>u,w6:()=>p,xH:()=>m,zG:()=>c});var r=i(61681),s=i(4157);function n(e,t){return t?e.filter(((e,i,r)=>r.findIndex(t.bind(null,e))===i)):e.filter(((e,t,i)=>i.indexOf(e)===t))}function o(e,t,i){if((0,r.Wi)(e)&&(0,r.Wi)(t))return!0;if((0,r.Wi)(e)||(0,r.Wi)(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function a(e,t){let i=e.length!==t.length;e.length=t.length;for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function l(e,t,i){let r,s;return i?(r=t.filter((t=>!e.some((e=>i(e,t))))),s=e.filter((e=>!t.some((t=>i(t,e)))))):(r=t.filter((t=>!e.includes(t))),s=e.filter((e=>!t.includes(e)))),{added:r,removed:s}}function c(e){return e&&"number"==typeof e.length}function u(e,t){const i=e.length;if(0===i)return[];const r=[];for(let s=0;s<i;s+=t)r.push(e.slice(s,s+t));return r}const h=!!Array.prototype.fill;function d(e,t){if(h)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function p(e,t){void 0===t&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function f(e,t,i){const r=e.length;let s=0,n=r-1;for(;s<n;){const i=s+Math.floor((n-s)/2);t>e[i]?s=i+1:n=i}const o=e[s];return i?t>=e[r-1]?-1:o===t?s:s-1:o===t?s:-1}function m(e){return e.reduce(((e,t)=>e.concat(t||[])),[])}class g{constructor(){this.last=0}}const y=new g;function _(e,t,i,r){r=r||y;const s=Math.max(0,r.last-10);for(let n=s;n<i;++n)if(e[n]===t)return r.last=n,n;const n=Math.min(s,i);for(let i=0;i<n;++i)if(e[i]===t)return r.last=i,i;return-1}function v(e,t,i,r){const s=null==i?e.length:i,n=_(e,t,s,r);if(-1!==n)return e[n]=e[s-1],null==i&&e.pop(),t}const b=new Set;function w(e,t,i=e.length,r=t.length,s,n){if(0===r||0===i)return i;b.clear();for(let e=0;e<r;++e)b.add(t[e]);s=s||y;const o=Math.max(0,s.last-10);for(let t=o;t<i;++t)if(b.has(e[t])&&(n&&n.push(e[t]),b.delete(e[t]),e[t]=e[i-1],--i,--t,0===b.size||0===i))return b.clear(),i;for(let t=0;t<o;++t)if(b.has(e[t])&&(n&&n.push(e[t]),b.delete(e[t]),e[t]=e[i-1],--i,--t,0===b.size||0===i))return b.clear(),i;return b.clear(),i}function x(e,t){const i=function(e){return e?(C.seed=e,()=>C.getFloat()):Math.random}(t);for(let t=e.length-1;t>0;t--){const r=Math.floor(i()*(t+1)),s=e[t];e[t]=e[r],e[r]=s}return e}const C=new s.Z;function T(e,t){const i=e.indexOf(t);return-1!==i?(e.splice(i,1),t):null}},67979:(e,t,i)=>{"use strict";i.d(t,{Ed:()=>n,UI:()=>o,mt:()=>l,q6:()=>a,w6:()=>c});var r=i(61681),s=i(78668);function n(e,t,i){return(0,s.as)(e.map(((e,r)=>t.apply(i,[e,r]))))}async function o(e,t,i){return(await(0,s.as)(e.map(((e,r)=>t.apply(i,[e,r]))))).map((e=>e.value))}async function a(e){if((0,r.Wi)(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(e){return{ok:!1,error:e}}}async function l(e){try{return{ok:!0,value:await e}}catch(e){return(0,s.r9)(e),{ok:!1,error:e}}}function c(e){if(!0===e.ok)return e.value;throw e.error}},4745:(e,t,i)=>{"use strict";function r(e){return 32+e.length}function s(){return 16}function n(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const s=e[i];switch(typeof s){case"string":t+=r(s);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function o(e,t){return 32+e.length*t}var a;i.d(t,{G3:()=>s,Y8:()=>a,do:()=>o,f2:()=>n,hH:()=>r}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(a||(a={}))},18234:(e,t,i)=>{"use strict";i.d(t,{m:()=>r});const r=(s=globalThis,{setTimeout:(e,t)=>{const i=s.setTimeout(e,t);return{remove:()=>s.clearTimeout(i)}}});var s},58811:(e,t,i)=>{"use strict";i.d(t,{R:()=>n,Z:()=>s});var r=i(41831);function s(e,t,i=r.Z){return t||(t=new i),t===e||(t.removeAll(),(s=e)&&(Array.isArray(s)||"items"in s&&Array.isArray(s.items))?t.addMany(e):e&&t.add(e)),t;var s}function n(e){return e}},39043:(e,t,i)=>{"use strict";function r(e){return"h"in e&&"s"in e&&"v"in e}function s(e){return"l"in e&&"a"in e&&"b"in e}function n(e){return"l"in e&&"c"in e&&"h"in e}i.d(t,{Y3:()=>m,_Y:()=>f,sJ:()=>g,xr:()=>p});const o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],a=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function l(e,t){const i=[];let r,s;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,o=e[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=e[r][s]*t[s];i.push(a)}return i}function c(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),i=l(o,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function u(e){const t=l(a,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function h(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function d(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function p(e){return"r"in(t=e)&&"g"in t&&"b"in t?e:n(e)?function(e){return u(d(function(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}(e)))}(e):s(e)?function(e){return u(d(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?u(e):r(e)?function(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,s=r*i,n=s*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}(e):e;var t}function f(e){return r(e)?e:function(e){const t=e.r,i=e.g,r=e.b,s=Math.max(t,i,r),n=s-Math.min(t,i,r);let o=s,a=0===n?0:s===t?(i-r)/n%6:s===i?(r-t)/n+2:(t-i)/n+4,l=0===n?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(p(e))}function m(e){return s(e)?e:function(e){return h(c(e))}(p(e))}function g(e){return n(e)?e:function(e){return function(e){const t=e.l,i=e.a,r=e.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:t,c:s,h:n}}(h(c(e)))}(p(e))}},27755:(e,t,i)=>{"use strict";function r(e){}function s(e){return()=>e}i.d(t,{Bg:()=>r,sM:()=>s}),i(39994)},59801:(e,t,i)=>{"use strict";i.d(t,{Mr:()=>o,x9:()=>a});var r=i(39994);const s=new Set;function n(e,t,i=!1){i&&s.has(t)||(i&&s.add(t),e.warn(` DEPRECATED - ${t}`))}function o(e,t,i={}){if((0,r.Z)("esri-deprecation-warnings")){const{moduleName:r}=i;a(e,"Property: "+(r?r+"::":"")+t,i)}}function a(e,t,i={}){if((0,r.Z)("esri-deprecation-warnings")){const{replacement:r,version:s,see:o,warnOnce:a}=i;let l=t;r&&(l+=`\n\t Replacement: ${r}`),s&&(l+=`\n\t Version: ${s}`),o&&(l+=`\n\t See ${o} for more details.`),n(e,l,a)}}},57989:(e,t,i)=>{"use strict";function r(e){return e=e||globalThis.location.hostname,c.some((t=>null!=e?.match(t)))}function s(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(n)||null!=t.match(a)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(o)||null!=t.match(l)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}i.d(t,{XO:()=>r,pJ:()=>s});const n=/^devext.arcgis.com$/,o=/^qaext.arcgis.com$/,a=/^[\w-]*\.mapsdevext.arcgis.com$/,l=/^[\w-]*\.mapsqa.arcgis.com$/,c=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,n,o,/^jsapps.esri.com$/,a,l]},59183:(e,t,i)=>{"use strict";function r(e){return"string"==typeof e?document.getElementById(e):e}function s(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function n(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function o(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}i.d(t,{L7:()=>r,Vt:()=>n,YD:()=>o,cS:()=>s}),(()=>{if("function"==typeof Element.prototype.closest)return(e,t)=>e.closest(t);Element.prototype.matches||Element.prototype.msMatchesSelector})()},49546:(e,t,i)=>{"use strict";function r(e){return e&&("function"==typeof e.on||"function"==typeof e.addEventListener)}function s(e,t,i){if(!r(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const t of r)e.addEventListener(t,i);return{remove(){for(const t of r)e.removeEventListener(t,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function n(e,t,i){if(!r(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const n=s(e,t,(t=>{n.remove(),i.call(e,t)}));return{remove(){n.remove()}}}i.d(t,{IH:()=>n,kK:()=>a,on:()=>s,vT:()=>r});const o={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function a({key:e}){return o[e]||e}},73534:(e,t,i)=>{"use strict";i.d(t,{I:()=>s,v:()=>n});var r=i(19431);function s(e,t,i=0){const s=(0,r.uZ)(e,0,l);for(let e=0;e<4;e++)t[i+e]=Math.floor(256*c(s*o[e]))}function n(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*a[r];return i}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=n(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},23148:(e,t,i)=>{"use strict";i.d(t,{AL:()=>s,HO:()=>a,ed:()=>o,kB:()=>n});var r=i(61681);function s(e){return n((()=>e.forEach((e=>(0,r.pC)(e)&&e.remove()))))}function n(e){return{remove:()=>{e&&(e(),e=void 0)}}}function o(e){return n((0,r.pC)(e)?()=>e.destroy():void 0)}function a(e,t){const i=setTimeout(e,t);return n((()=>clearTimeout(i)))}},39994:(e,t,i)=>{"use strict";let r;function s(e){return"function"==typeof r[e]?r[e]=r[e](globalThis):r[e]}i.d(t,{Z:()=>s}),r=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},s.add=(e,t,i,n)=>((n||void 0===r[e])&&(r[e]=t),i&&s(e)),s.cache=r,s.add("esri-deprecation-warnings",!0),(()=>{s.add("host-webworker",void 0!==globalThis.WorkerGlobalScope&&self instanceof globalThis.WorkerGlobalScope);const e="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document;if(s.add("host-browser",e),s.add("host-node","object"==typeof globalThis.process&&globalThis.process.versions?.node&&globalThis.process.versions.v8),s.add("dom",e),s("host-browser")){const e=navigator,t=e.userAgent,i=e.appVersion,r=parseFloat(i);if(s.add("wp",parseFloat(t.split("Windows Phone")[1])||void 0),s.add("msapp",parseFloat(t.split("MSAppHost/")[1])||void 0),s.add("khtml",i.includes("Konqueror")?r:void 0),s.add("edge",parseFloat(t.split("Edge/")[1])||void 0),s.add("opr",parseFloat(t.split("OPR/")[1])||void 0),s.add("webkit",!s("wp")&&!s("edge")&&parseFloat(t.split("WebKit/")[1])||void 0),s.add("chrome",!s("edge")&&!s("opr")&&parseFloat(t.split("Chrome/")[1])||void 0),s.add("android",!s("wp")&&parseFloat(t.split("Android ")[1])||void 0),s.add("safari",!i.includes("Safari")||s("wp")||s("chrome")||s("android")||s("edge")||s("opr")?void 0:parseFloat(i.split("Version/")[1])),s.add("mac",i.includes("Macintosh")),!s("wp")&&t.match(/(iPhone|iPod|iPad)/)){const e=RegExp.$1.replace(/P/,"p"),i=t.match(/OS ([\d_]+)/)?RegExp.$1:"1",r=parseFloat(i.replace(/_/,".").replace(/_/g,""));s.add(e,r),s.add("ios",r)}s.add("trident",parseFloat(i.split("Trident/")[1])||void 0),s("webkit")||(!t.includes("Gecko")||s("wp")||s("khtml")||s("trident")||s("edge")||s.add("mozilla",r),s("mozilla")&&s.add("ff",parseFloat(t.split("Firefox/")[1]||t.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&s.add("esri-mobile",t),i&&s.add("esri-iPhone",i),s.add("esri-geolocation",!!navigator.geolocation)}s.add("esri-canvas-svg-support",!s("trident")),s.add("esri-wasm","WebAssembly"in globalThis),s.add("esri-shared-array-buffer",(()=>{const e="SharedArrayBuffer"in globalThis,t=!1===globalThis.crossOriginIsolated;return e&&!t})),s.add("wasm-simd",(()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))),s.add("esri-atomics","Atomics"in globalThis),s.add("esri-workers","Worker"in globalThis),s.add("web-feat:cache","caches"in globalThis),s.add("esri-workers-arraybuffer-transfer",!s("safari")||Number(s("safari"))>=12),s.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),s.add("featurelayer-simplify-payload-size-factors",[1,1,4]),s.add("featurelayer-snapshot-enabled",!0),s.add("featurelayer-snapshot-point-min-threshold",8e4),s.add("featurelayer-snapshot-point-max-threshold",4e5),s.add("featurelayer-snapshot-point-coverage",.1),s.add("featurelayer-advanced-symbols",!1),s.add("featurelayer-pbf",!0),s.add("featurelayer-pbf-statistics",!1),s.add("feature-layers-workers",!0),s.add("feature-polyline-generalization-factor",1),s.add("mapview-transitions-duration",200),s.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),s.add("mapserver-pbf-enabled",!1),s.add("mapimagelayer-popup-identify-max-tolerance",20),s.add("heatmap-allow-raster-fallback",!0),s.add("heatmap-force-raster",!1),s("host-webworker")||s("host-browser")&&(s.add("esri-csp-restrictions",(()=>{try{new Function}catch{return!0}return!1})),s.add("esri-image-decode",(()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then((()=>{s.add("esri-image-decode",!0,!0,!0)})).catch((()=>{s.add("esri-image-decode",!1,!0,!0)}))}return!1})),s.add("esri-url-encodes-apostrophe",(()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")})))})()},99118:(e,t,i)=>{"use strict";function r(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function s(e,t){for(const i of e)if(null!=i&&t(i))return i}function n(e){return null!=e&&"function"==typeof e[Symbol.iterator]}i.d(t,{Fs:()=>r,TW:()=>n,sE:()=>s})},25709:(e,t,i)=>{"use strict";i.d(t,{X:()=>s,w:()=>n});var r=i(86745);class s{constructor(e,t={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=e,this.options=t,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=e=>this.fromJSON(e),this.write=(e,t,i)=>{const s=this.toJSON(e);void 0!==s&&(0,r.RB)(i,s,t)},this.write.isJSONMapWriter=!0}toJSON(e){if(this.apiToJSON.hasOwnProperty(e)){const t=this.apiToJSON[e];return this.options.useNumericKeys?+t:t}return this.options.ignoreUnknown?void 0:e}fromJSON(e){return this.jsonToAPI.hasOwnProperty(e)?this.jsonToAPI[e]:this.options.ignoreUnknown?void 0:e}_invertMap(e){const t={};for(const i in e)t[e[i]]=i;return t}_getKeysSorted(e){const t=[];for(const i in e)t.push(i);return t.sort(),t}}function n(){return function(e,t){return new s(e,{ignoreUnknown:!0,...t})}}},67134:(e,t,i)=>{"use strict";i.d(t,{Vo:()=>l,d9:()=>a,fS:()=>f,y7:()=>m,yd:()=>o});var r=i(7753),s=(i(39994),i(61681)),n=i(86098);function o(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(void 0===e[i]?delete e[i]:e[i]instanceof Object&&o(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&void 0===e[i]&&delete e[i];return e}function a(e){if(!e||"object"!=typeof e||"function"==typeof e)return e;const t=p(e);if((0,s.pC)(t))return t;if(c(e))return e.clone();if(u(e))return e.map(a);if(h(e))return e.clone();const i={};for(const t of Object.getOwnPropertyNames(e))i[t]=a(e[t]);return i}function l(e){if(!e||"object"!=typeof e||"function"==typeof e)return e;const t=p(e);if((0,s.pC)(t))return t;if(u(e)){let t=!0;const i=e.map((e=>{const i=l(e);return null!=e&&null==i&&(t=!1),i}));return t?i:null}if(c(e))return e.clone();if(!h(e)){const t=new(0,Object.getPrototypeOf(e).constructor);for(const i of Object.getOwnPropertyNames(e)){const r=e[i],s=l(r);if(null!=r&&null==s)return null;t[i]=s}return t}return null}function c(e){return"function"==typeof e.clone}function u(e){return"function"==typeof e.map&&"function"==typeof e.forEach}function h(e){return"function"==typeof e.notifyChange&&"function"==typeof e.watch}function d(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function p(e){if((0,n.W0)(e)||(0,n.lq)(e)||(0,n.KZ)(e)||(0,n.z3)(e)||(0,n.Uc)(e)||(0,n.Hx)(e)||(0,n.ZY)(e)||(0,n.xZ)(e)||(0,n.fS)(e))return(0,n.tP)(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach(((e,i)=>{t.set(i,a(e))})),t}if(e instanceof Set){const t=new Set;return e.forEach((e=>{t.add(a(e))})),t}return null}function f(e,t){return e===t||"number"==typeof e&&isNaN(e)&&"number"==typeof t&&isNaN(t)||"function"==typeof(e||{}).getTime&&"function"==typeof(t||{}).getTime&&e.getTime()===t.getTime()||!1}function m(e,t){return e===t||(null==e||"string"==typeof e?e===t:"number"==typeof e?e===t||"number"==typeof t&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&(0,r.fS)(e,t):e instanceof Set?t instanceof Set&&function(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}(e,t):e instanceof Map?t instanceof Map&&function(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const e=t.get(i);if(e!==r||void 0===e&&!t.has(i))return!1}return!0}(e,t):!!d(e)&&d(t)&&function(e,t){if(null===e||null===t)return!1;const i=Object.keys(e);if(null===t||Object.keys(t).length!==i.length)return!1;for(const r of i)if(e[r]!==t[r]||!Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}(e,t))}},70144:(e,t,i)=>{"use strict";function r(e){return(t=e)instanceof Float32Array&&t.length>=2||function(e){return Array.isArray(e)&&e.length>=2}(e);var t}i.d(t,{lM:()=>r})},63592:(e,t,i)=>{"use strict";i.d(t,{G:()=>a,w:()=>l});var r=i(67979),s=i(41831),n=i(68309),o=i(61681);async function a(e,t){return await e.load(),l(e,t)}async function l(e,t){const i=[],a=(...e)=>{for(const t of e)(0,o.Wi)(t)||(Array.isArray(t)?a(...t):s.Z.isCollection(t)?t.forEach((e=>a(e))):n.Z.isLoadable(t)&&i.push(t))};t(a);let l=null;if(await(0,r.UI)(i,(async e=>{!1!==(await(0,r.q6)(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load())).ok||l||(l=e)})),l)throw l.loadError;return e}},19431:(e,t,i)=>{"use strict";i.d(t,{BV:()=>p,CW:()=>w,H:()=>C,Kt:()=>g,Sf:()=>o,Vl:()=>d,W8:()=>_,Y8:()=>y,ZF:()=>m,_3:()=>S,b_:()=>f,fp:()=>c,jE:()=>x,oK:()=>v,oc:()=>T,sk:()=>u,t7:()=>h,uZ:()=>a,wt:()=>l});var r=i(6766),s=i(88589);const n=new Float32Array(1);function o(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function a(e,t,i){return Math.min(Math.max(e,t),i)}function l(e){return 0==(e&e-1)}function c(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function u(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function h(e,t,i){return e+(t-e)*i}function d(e){return e*Math.PI/180}function p(e){return 180*e/Math.PI}function f(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function m(e){return Math.acos(a(e,-1,1))}function g(e){return Math.asin(a(e,-1,1))}function y(e,t,i=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const r=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(0===e||0===t||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function _(e,t,i=1e-6){return!isNaN(e)&&!isNaN(t)&&(e>t?e-t:t-e)<=i}function v(e){return b(Math.max(-S,Math.min(e,S)))}function b(e){return n[0]=e,n[0]}function w(e,t,i){const r=a((i-e)/(t-e),0,1);return r*r*(3-2*r)}function x(e,t){const i=(0,r.l)(e),s=g(e[2]/i),n=Math.atan2(e[1]/i,e[0]/i);return(0,r.s)(t,i,s,n),t}function C(e,t,i){return(0,s.s)(e,t[0],t[1],t[2],t[3]*i)}function T(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(_(t,1)&&_(i,1)&&_(r,1))}const S=b(34028234663852886e22)},61681:(e,t,i)=>{"use strict";i.d(t,{Bd:()=>y,Fd:()=>v,IM:()=>f,JR:()=>b,O3:()=>d,Pt:()=>c,R2:()=>w,RY:()=>m,SC:()=>h,U2:()=>C,Wg:()=>a,Wi:()=>n,YP:()=>r,_W:()=>g,e8:()=>_,hw:()=>p,j0:()=>T,lV:()=>x,pC:()=>s,s3:()=>l,yl:()=>u,yw:()=>o});const r=null;function s(e){return null!=e}function n(e){return null==e}function o(e,t){return s(e)?t(e):r}function a(e){return e}function l(e,t){if(n(e))throw new Error(t);return e}function c(e,t){return s(e)?e:"function"==typeof t?t():t}function u(e,t){return s(e)?e:t}function h(e){return s(e)&&e.destroy(),null}function d(e){return s(e)&&e.dispose(),null}function p(e){return s(e)&&e.remove(),null}function f(e){return s(e)&&e.abort(),null}function m(e){return s(e)&&e.release(),null}function g(e,t,i){return s(e)&&s(t)?s(i)?i(e,t):e.equals(t):e===t}function y(e){return null}function _(e,t){const i=new Array;return e.forEach((e=>{const r=t(e);s(r)&&i.push(r)})),i}function v(e,t){const i=new Array;for(const r of e)i.push(w(r,null,t));return i}function b(e,t){for(const i of e)o(i,t)}function w(e,t,i){return s(e)?i(e):t}function x(e){return e.filter((e=>s(e)))}function C(e,...t){let i=e;for(let e=0;e<t.length&&i;++e)i=i[t[e]];return i}function T(e){return e}},71760:(e,t,i)=>{"use strict";function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{l:()=>r})},66581:(e,t,i)=>{"use strict";i.d(t,{Y:()=>s});const r=[];function s(e){r.push(e),1===r.length&&queueMicrotask((()=>{const e=r.slice();r.length=0;for(const t of e)t()}))}},94978:(e,t,i)=>{"use strict";i.d(t,{Qc:()=>u,WU:()=>a,lt:()=>c});var r=i(21130),s=i(8108);const n={ar:[".",","],bg:[",",""],bs:[",","."],ca:[",","."],cs:[",",""],da:[",","."],de:[",","."],"de-ch":[".",""],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",",""],fi:[",",""],fr:[",",""],"fr-ch":[",",""],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",",""],id:[",","."],it:[",","."],"it-ch":[".",""],ja:[".",","],ko:[".",","],lt:[",",""],lv:[",",""],mk:[",","."],nb:[",",""],nl:[",","."],pl:[",",""],pt:[",","."],"pt-pt":[",",""],ro:[",","."],ru:[",",""],sk:[",",""],sl:[",","."],sr:[",","."],sv:[",",""],th:[".",","],tr:[",","."],uk:[",",""],vi:[",","."],zh:[".",","]};function o(e){e||(e=(0,s.Kd)());let t=e in n;if(!t){const i=e.split("-");i.length>1&&i[0]in n&&(e=i[0],t=!0),t||(e="en")}const[i,r,o="#,##0.###"]=n[e];return{decimal:i,group:r,pattern:o}}function a(e,t){const i=o((t={...t}).locale);t.customs=i;const r=t.pattern||i.pattern;return isNaN(e)||Math.abs(e)===1/0?null:function(e,t,i){const r=(i=i||{}).customs.group,s=i.customs.decimal,n=t.split(";"),o=n[0];if((t=n[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes(""))e*=1e3;else{if(t.includes(""))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const a=l,c=o.match(a);if(!c)throw new Error("unable to find a number expression in pattern: "+t);return!1===i.fractional&&(i.places=0),t.replace(a,function(e,t,i){!0===(i=i||{}).places&&(i.places=0),i.places===1/0&&(i.places=6);const r=t.split("."),s="string"==typeof i.places&&i.places.indexOf(",");let n=i.places;s?n=i.places.substring(s+1):n>=0||(n=(r[1]||[]).length),i.round<0||(e=Number(e.toFixed(Number(n))));const o=String(Math.abs(e)).split("."),a=o[1]||"";if(r[1]||i.places){s&&(i.places=i.places.substring(0,s));const e=void 0!==i.places?i.places:r[1]&&r[1].lastIndexOf("0")+1;e>a.length&&(o[1]=a.padEnd(Number(e),"0")),n<a.length&&(o[1]=a.substr(0,Number(n)))}else o[1]&&o.pop();const l=r[0].replace(",","");let c=l.indexOf("0");-1!==c&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let u,h,d=r[0].lastIndexOf(",");if(-1!==d){u=r[0].length-d-1;const e=r[0].substr(0,d);d=e.lastIndexOf(","),-1!==d&&(h=e.length-d-1)}const p=[];for(let e=o[0];e;){const t=e.length-u;p.push(t>0?e.substr(t):e),e=t>0?e.slice(0,t):"",h&&(u=h,h=void 0)}return o[0]=p.reverse().join(i.group||","),o.join(i.decimal||".")}(e,c[0],{decimal:s,group:r,places:i.places,round:i.round}))}(e,r,t)}const l=/[#0,]*[#0](?:\.0*#*)?/;function c(e){const t=o((e=e||{}).locale),i=e.pattern||t.pattern,s=t.group,n=t.decimal;let a=1;if(i.includes("%"))a/=100;else if(i.includes(""))a/=1e3;else if(i.includes(""))throw new Error("currency notation not supported");const c=i.split(";");1===c.length&&c.push("-"+c[0]);const u=d(c,(t=>(t="(?:"+(0,r.Qs)(t,".")+")").replace(l,(t=>{const i={signed:!1,separator:e.strict?s:[s,""],fractional:e.fractional,decimal:n,exponent:!1},r=t.split(".");let o=e.places;1===r.length&&1!==a&&(r[1]="###"),1===r.length||0===o?i.fractional=!1:(void 0===o&&(o=e.pattern?r[1].lastIndexOf("0")+1:1/0),o&&null==e.fractional&&(i.fractional=!0),!e.places&&o<r[1].length&&(o+=","+r[1].length),i.places=o);const l=r[0].split(",");return l.length>1&&(i.groupSize=l.pop().length,l.length>1&&(i.groupSize2=l.pop().length)),"("+function(e){"places"in(e=e||{})||(e.places=1/0),"string"!=typeof e.decimal&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=h(e),i=d(e.fractional,(t=>{let i="";return t&&0!==e.places&&(i="\\"+e.decimal,e.places===1/0?i="(?:"+i+"\\d+)?":i+="\\d{"+e.places+"}"),i}),!0);let r=t+i;return i&&(r="(?:(?:"+r+")|(?:"+i+"))"),r+d(e.exponent,(t=>t?"([eE]"+h({signed:e.eSigned})+")":""))}(i)+")"}))),!0);return{regexp:u.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:s,decimal:n,factor:a}}function u(e,t){const i=c(t),r=new RegExp("^"+i.regexp+"$").exec(e);if(!r)return NaN;let s=r[1];if(!r[1]){if(!r[2])return NaN;s=r[2],i.factor*=-1}return s=s.replace(new RegExp("["+i.group+"\\s\\xa0]","g"),"").replace(i.decimal,"."),Number(s)*i.factor}function h(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",d(e.signed,(e=>e?"[-+]":""),!0)+d(e.separator,(t=>{if(!t)return"(?:\\d+)";" "===(t=(0,r.Qs)(t))?t="\\s":""===t&&(t="\\s\\xa0");const i=e.groupSize,s=e.groupSize2;if(s){const e="(?:0|[1-9]\\d{0,"+(s-1)+"}(?:["+t+"]\\d{"+s+"})*["+t+"]\\d{"+i+"})";return i-s>0?"(?:"+e+"|(?:0|[1-9]\\d{0,"+(i-1)+"}))":e}return"(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*)"}),!0)}const d=(e,t,i)=>{if(!(e instanceof Array))return t(e);const r=[];for(let i=0;i<e.length;i++)r.push(t(e[i]));return p(r.join("|"),i)},p=(e,t)=>"("+(t?"?:":"")+e+")"},86745:(e,t,i)=>{"use strict";i.d(t,{RB:()=>o,RH:()=>s,hS:()=>n});var r=i(67134);function s(e,t,i=!1){return l(e,t,i)}function n(e,t){if(null!=t)return t[e]||a(e.split("."),!1,t)}function o(e,t,i){const r=e.split("."),s=r.pop(),n=a(r,!0,i);n&&s&&(n[s]=t)}function a(e,t,i){let r=i;for(const i of e){if(null==r)return;if(!(i in r)){if(!t)return;r[i]={}}r=r[i]}return r}function l(e,t,i){return t?Object.keys(t).reduce(((e,s)=>{let n=e[s],o=t[s];return n===o?e:void 0===n?(e[s]=(0,r.d9)(o),e):(Array.isArray(o)||Array.isArray(e)?(n=n?Array.isArray(n)?e[s]=n.concat():e[s]=[n]:e[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach((e=>{n.includes(e)||n.push(e)})):e[s]=o.concat())):o&&"object"==typeof o?e[s]=l(n,o,i):e.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(e[s]=o),e)}),e||{}):e}},76480:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s,n=i(39994),o=i(34596);(s=r||(r={}))[s.varint=0]="varint",s[s.fixed64=1]="fixed64",s[s.delimited=2]="delimited",s[s.fixed32=5]="fixed32",s[s.unknown=99]="unknown";const a=4294967296,l=new TextDecoder("utf-8"),c=(0,n.Z)("safari")||(0,n.Z)("ios")?6:(0,n.Z)("ff")?12:32;class u{constructor(e,t,i=0,s=(e?e.byteLength:0)){this._tag=0,this._dataType=r.unknown,this._init(e,t,i,s)}_init(e,t,i,r){this._data=e,this._dataView=t,this._pos=i,this._end=r}clone(){return new u(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+e.getUint32(t+4,!0)*a;return this._skip(8),i}getSFixed64(){const e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+e.getInt32(t+4,!0)*a;return this._skip(8),i}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,i=this._toString(this._data,t,t+e);return this._skip(e),i}getBytes(){const e=this._getLength(),t=this._pos,i=this._toBytes(this._data,t,t+e);return this._skip(e),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,i,r){const s=this.getMessage(),n=e(s,t,i,r);return s.release(),n}processMessage(e){const t=this.getMessage(),i=e(t);return t.release(),i}getMessage(){const e=this._getLength(),t=u.pool.acquire();return t._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){u.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case r.varint:this._decodeVarint();break;case r.fixed64:this._skip(8);break;case r.delimited:this._skip(this._getLength());break;case r.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t,i=this._pos,r=0;if(this._end-i>=10)do{if(t=e[i++],r|=127&t,0==(128&t))break;if(t=e[i++],r|=(127&t)<<7,0==(128&t))break;if(t=e[i++],r|=(127&t)<<14,0==(128&t))break;if(t=e[i++],r|=(127&t)<<21,0==(128&t))break;if(t=e[i++],r+=268435456*(127&t),0==(128&t))break;if(t=e[i++],r+=34359738368*(127&t),0==(128&t))break;if(t=e[i++],r+=4398046511104*(127&t),0==(128&t))break;if(t=e[i++],r+=562949953421312*(127&t),0==(128&t))break;if(t=e[i++],r+=72057594037927940*(127&t),0==(128&t))break;if(t=e[i++],r+=0x8000000000000000*(127&t),0==(128&t))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;i!==this._end&&(t=e[i],0!=(128&t));)++i,r+=(127&t)*s,s*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=t*s}return this._pos=i,r}_decodeSVarint(){const e=this._decodeVarint();return e%2?-(e+1)/2:e/2}_getLength(){if(this._dataType!==r.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,i){if((i=Math.min(this._end,i))-t>c){const r=e.subarray(t,i);return l.decode(r)}let r="",s="";for(let n=t;n<i;++n){const t=e[n];128&t?s+="%"+t.toString(16):(r+=decodeURIComponent(s)+String.fromCharCode(t),s="")}return s.length&&(r+=decodeURIComponent(s)),r}_toBytes(e,t,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,t,i-t)}}u.pool=new o.Z(u,null,(e=>{e._data=null,e._dataView=null}))},78668:(e,t,i)=>{"use strict";i.d(t,{$F:()=>m,Bx:()=>M,D_:()=>y,Ds:()=>E,H9:()=>p,Hc:()=>h,Hl:()=>g,R8:()=>_,U3:()=>v,WW:()=>x,Yn:()=>R,as:()=>w,dD:()=>b,e4:()=>C,fu:()=>f,gx:()=>S,hh:()=>A,k_:()=>c,r9:()=>d,vr:()=>O,y8:()=>T,zE:()=>l});var r=i(18234),s=(i(59801),i(70375)),n=i(49546),o=i(13802),a=i(61681);function l(e="Aborted"){return new s.Z("AbortError",e)}function c(e,t="Aborted"){if(h(e))throw l(t)}function u(e){return(0,a.pC)(e)?"aborted"in e?e:e.signal:e}function h(e){const t=u(e);return(0,a.pC)(t)&&t.aborted}function d(e){if(y(e))throw e}function p(e){if(!y(e))throw e}function f(e,t){const i=u(e);if(!(0,a.Wi)(i)){if(!i.aborted)return(0,n.IH)(i,"abort",(()=>t()));t()}}function m(e,t){const i=u(e);if(!(0,a.Wi)(i))return c(i),(0,n.IH)(i,"abort",(()=>t(l())))}function g(e,t){const i=u(t);return(0,a.Wi)(i)?e:new Promise(((i,r)=>{let s=f(t,(()=>r(l())));const n=()=>s=(0,a.hw)(s);e.then(n,n),e.then(i,r)}))}function y(e){return e&&"AbortError"===e.name}async function _(e){try{return await e}catch(e){if(!y(e))throw e}}async function v(e,t=o.Z.getLogger("esri")){try{return await e}catch(e){y(e)||t.error(e)}}function b(){let e=null;const t=new Promise(((t,i)=>{e={promise:void 0,resolve:t,reject:i}}));return e.promise=t,e}async function w(e){if(!e)return;if("function"!=typeof e.forEach){const t=Object.keys(e),i=t.map((t=>e[t])),r=await w(i),s={};return t.map(((e,t)=>s[e]=r[t])),s}const t=e;return new Promise((e=>{const i=[];let r=t.length;0===r&&e(i),t.forEach((t=>{const s={promise:t||Promise.resolve(t)};i.push(s),s.promise.then((e=>{s.value=e})).catch((e=>{s.error=e})).then((()=>{--r,0===r&&e(i)}))}))}))}async function x(e){return(await w(e)).filter((e=>!!e.value)).map((e=>e.value))}function C(e,t,i){const r=new AbortController;return f(i,(()=>r.abort())),new Promise(((i,s)=>{let n=setTimeout((()=>{n=0,i(t)}),e);f(r,(()=>{n&&(clearTimeout(n),s(l()))}))}))}function T(e){return e&&"function"==typeof e.then}function S(e){return T(e)?e:Promise.resolve(e)}function E(e,t=-1){let i,r,s,n,o=null;const c=(...u)=>{if(i){r=u,n&&n.reject(l()),n=b();const e=(0,a.j0)(n.promise);if(o){const e=o;o=null,e.abort()}return e}if(s=n||b(),n=null,t>0){const r=new AbortController;i=S(e(...u,r.signal));const s=i;C(t).then((()=>{i===s&&(n?r.abort():o=r)}))}else i=1,i=S(e(...u));const h=()=>{const e=r;r=s=i=o=null,null!=e&&c(...e)},d=i,p=s;return d.then(h,h),d.then(p.resolve,p.reject),(0,a.j0)(p.promise)};return c}function A(){let e,t;const i=new Promise(((i,r)=>{e=i,t=r})),s=t=>{e(t)};return s.resolve=t=>e(t),s.reject=e=>t(e),s.timeout=(e,t)=>r.m.setTimeout((()=>s.reject(t)),e),s.promise=i,s}function M(e,t){return e.then(t,t)}function O(e,t){let i,r=new AbortController;const s=e(r.signal);let n={promise:s,finished:!1,abort:()=>{r&&(r.abort(),r=null)}};const o=()=>{n&&(n.finished=!0,n=null),(0,a.pC)(i)&&(i.remove(),i=null),r=null};return s.then(o,o),i=f(t,(()=>{(0,a.pC)(n)&&n.abort()})),n}async function R(e){await Promise.resolve(),c(e)}},76868:(e,t,i)=>{"use strict";i.d(t,{N1:()=>d,YP:()=>l,Z_:()=>m,gx:()=>c,nn:()=>g,on:()=>h,tX:()=>y});var r=i(49546),s=i(23148),n=i(61681),o=i(78668),a=i(81509);function l(e,t,i={}){return u(e,t,i,p)}function c(e,t,i={}){return u(e,t,i,f)}function u(e,t,i={},r){let s=null;const o=i.once?(e,i)=>{r(e)&&((0,n.hw)(s),t(e,i))}:(e,i)=>{r(e)&&t(e,i)};if(s=(0,a.aQ)(e,o,i.sync,i.equals),i.initial){const t=e();o(t,t)}return s}function h(e,t,i,o={}){let a=null,c=null,u=null;function h(){a&&c&&(c.remove(),o.onListenerRemove?.(a),a=null,c=null)}function d(e){o.once&&o.once&&(0,n.hw)(u),i(e)}const p=l(e,((e,i)=>{h(),(0,r.vT)(e)&&(a=e,c=(0,r.on)(e,t,d),o.onListenerAdd?.(e))}),{sync:o.sync,initial:!0});return u=(0,s.kB)((()=>{p.remove(),h()})),u}function d(e,t){return function(e,t,i){if((0,o.Hc)(i))return Promise.reject((0,o.zE)());const r=e();if(t?.(r))return Promise.resolve(r);let a=null;function l(){a=(0,n.hw)(a)}return new Promise(((r,n)=>{a=(0,s.AL)([(0,o.fu)(i,(()=>{l(),n((0,o.zE)())})),u(e,(e=>{l(),r(e)}),{sync:!1,once:!0},t??p)])}))}(e,f,t)}function p(e){return!0}function f(e){return!!e}i(63235);const m={sync:!0},g={initial:!0},y={sync:!0,initial:!0}},17262:(e,t,i)=>{"use strict";i.d(t,{A:()=>b,MU:()=>A,Os:()=>v,bP:()=>x});var r=i(61681),s=i(66581),n=i(31168),o=i(17135),a=i(78668),l=i(12928);class c{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}}class u{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}}let h=0,d=0;const p={time:(0,l.HA)(0),deltaTime:(0,l.HA)(0),elapsedFrameTime:(0,l.HA)(0),frameDuration:(0,l.HA)(0)},f=["prepare","preRender","render","postRender","update","finish"],m=[],g=new o.Z;class y{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const _={frameTasks:g,willDispatch:!1,clearFrameTasks:function(e=!1){g.forAll((e=>{e.removed=!0})),e&&S()},dispatch:E,executeFrameTasks:function(e){const t=(0,l.HA)(e-h);h=e;const i=d>0?d:1e3/60,r=Math.max(0,t-i);for(let s=0;s<f.length;s++){const n=performance.now(),o=f[s];g.forAll((n=>{n.paused||n.removed||(0===s&&n.ticks++,n.phases[o]&&(p.time=e,p.deltaTime=0===n.ticks?(0,l.HA)(0):t,p.elapsedFrameTime=(0,l.HA)(performance.now()-e),p.frameDuration=(0,l.HA)(i-r),n.phases[o]?.call(n,p)))})),M[s].record(performance.now()-n)}S(),O.record(performance.now()-e)}};function v(e){const t=new u(e);return m.push(t),_.willDispatch||(_.willDispatch=!0,(0,s.Y)(E)),t}function b(e){const t=new c(e);return g.push(t),null==w&&(h=performance.now(),w=requestAnimationFrame(C)),new y(t)}let w=null;function x(e){d=Math.max(0,e)}function C(){const e=performance.now();w=null,w=g.length>0?requestAnimationFrame(C):null,_.executeFrameTasks(e)}const T=new o.Z;function S(){g.forAll((e=>{e.removed&&T.push(e)})),g.removeUnorderedMany(T.data,T.length),T.clear()}function E(){for(;m.length;){const e=(0,r.j0)(m.shift());e.isActive&&e.callback()}_.willDispatch=!1}function A(e=1,t){const i=(0,a.hh)(),r=()=>{(0,a.Hc)(t)?i.reject((0,a.zE)()):0===e?i():(--e,(0,s.Y)((()=>r())))};return r(),i.promise}const M=f.map((e=>new n.Z(e))),O=new n.Z("total")},95550:(e,t,i)=>{"use strict";i.d(t,{F2:()=>s,J$:()=>u,So:()=>h,Wv:()=>d,Wz:()=>n,c$:()=>p,gX:()=>c,md:()=>f,s1:()=>l,t_:()=>o,vW:()=>a});const r=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function s(e){return e?e/72*96:0}function n(e){return e?72*e/96:0}function o(e){if("string"==typeof e){const t=e.match(r);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s="-"===e.charAt(0),o="px"===r?n(i):i;return s?-o:o}return console.warn("screenUtils.toPt: input not recognized!"),null}return e}function a(e=0,t=0){return{x:e,y:t}}function l(e=0,t=0){return[e,t]}function c(e=0,t=0){return[e,t]}function u(e=0,t=0,i=0){return[e,t,i]}function h(e){return e}function d(e){return e}function p(e){return e}function f(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}},84684:(e,t,i)=>{"use strict";i.d(t,{E:()=>s,_:()=>n});var r=i(61681);async function s(e,t){const{WhereClause:r}=await i.e(3362).then(i.bind(i,3362));return r.create(e,t)}function n(e,t){return(0,r.pC)(e)?(0,r.pC)(t)?`(${e}) AND (${t})`:e:t}},21130:(e,t,i)=>{"use strict";i.d(t,{Cb:()=>c,Qs:()=>a,gx:()=>o,hP:()=>l});var r=i(86745);const s=/\{([^\}]+)\}/g;function n(e){return null==e?"":e}function o(e,t){return e.replace(s,"object"==typeof t?(e,i)=>n((0,r.hS)(i,t)):(e,i)=>n(t(i)))}function a(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,(e=>t&&t.includes(e)?e:`\\${e}`))}function l(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function c(e){return(new DOMParser).parseFromString(e||"","text/html").body.innerText||""}},4637:(e,t,i)=>{"use strict";i.d(t,{a:()=>h,z:()=>d});var r=i(36663),s=i(41831),n=i(58811),o=i(53280),a=(i(39994),i(13802)),l=i(61681),c=i(81977),u=(i(7753),i(7283),i(40266));a.Z.getLogger("esri.core.support.OwningCollection");let h=class extends((0,o.p)(s.Z)){constructor(e){super(e),this.handles.add([this.on("before-add",(e=>{(0,l.Wi)(e.item)&&e.preventDefault()})),this.on("after-add",(e=>this._own(e.item))),this.on("after-remove",(e=>this._release(e.item)))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(s.Z.ofType(this.itemType.Type))(e):new s.Z(e)}};function d(e,t){return{type:e,cast:n.R,set(i){const r=(0,n.Z)(i,this._get(t),e);r.owner=this,this._set(t,r)}}}(0,r._)([(0,c.Cb)()],h.prototype,"owner",null),h=(0,r._)([(0,u.j)("esri.core.support.OwningCollection")],h)},81589:(e,t,i)=>{"use strict";i.d(t,{t:()=>h});var r=i(36663),s=i(53443),n=i(44584),o=i(61681),a=i(76868),l=i(17262),c=i(81977),u=i(40266);let h=class extends s.Z{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new n.Z,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i={}){return this._installWatch(e,t,i,a.YP)}addWhen(e,t,i={}){return this._installWatch(e,t,i,a.gx)}addOnCollectionChange(e,t,{initial:i=!1,final:r=!1}={}){const s=++this.handleId;return this.handles.add([(0,a.on)(e,"after-changes",this._createSyncUpdatingCallback(),a.Z_),(0,a.on)(e,"change",t,{onListenerAdd:i?e=>t({added:e.toArray(),removed:[]}):void 0,onListenerRemove:r?e=>t({added:[],removed:e.toArray()}):void 0})],s),{remove:()=>this.handles.remove(s)}}addPromise(e){if((0,o.Wi)(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(0!==this.pendingPromises.size||this.handles.has(d)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,i={},r){const s=++this.handleId;i.sync||this._installSyncUpdatingWatch(e,s);const n=r(e,t,i);return this.handles.add(n,s),{remove:()=>this.handles.remove(s)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=(0,a.YP)(e,i,{sync:!0,equals:()=>!1});return this.handles.add(r,t),r}_createSyncUpdatingCallback(){return()=>{this.handles.remove(d),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add((0,l.Os)((()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(d))})),d)}}};(0,r._)([(0,c.Cb)({readOnly:!0})],h.prototype,"updating",void 0),h=(0,r._)([(0,u.j)("esri.core.support.WatchUpdatingTracking")],h);const d=-42;var p,f;(f=p||(p={}))[f.NONE=0]="NONE",f[f.SYNC=1]="SYNC",f[f.INIT=2]="INIT"},12928:(e,t,i)=>{"use strict";function r(e){return e}function s(e){return 1e3*e}function n(e){return e}function o(e){return.001*e}i.d(t,{D9:()=>o,HA:()=>r,_H:()=>n,up:()=>s})},807:(e,t,i)=>{"use strict";i.d(t,{JE:()=>o,Nm:()=>n,rJ:()=>a}),i(39994);const r={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},s={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function n(e,t,i){const r=new Date(e.getTime());if(t&&i){const e=s[i],{getter:n,setter:o,multiplier:a}=e;if("months"===i){const e=function(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}(r.getFullYear(),r.getMonth()+t);r.getDate()>e&&r.setDate(e)}r[o](r[n]()+t*a)}return r}function o(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function a(e,t,i){return 0===e?0:e*r[t]/r[i]}},86098:(e,t,i)=>{"use strict";i.d(t,{Ed:()=>s,Hx:()=>d,KZ:()=>c,Uc:()=>h,W0:()=>a,Xw:()=>y,ZY:()=>p,eP:()=>o,fS:()=>m,lq:()=>l,qo:()=>g,tP:()=>n,xZ:()=>f,z3:()=>u});var r=i(61681);function s(e,t){if(e.forEach)e.forEach(t);else for(let i=0;i<e.length;i++)t(e[i],i,e)}function n(e,t,i){if(e.slice)return e.slice(t,i);void 0===t?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),void 0===i?i=e.length:(i<0&&(i+=e.length),i=Math.min(e.length,Math.max(0,i)));const r=Math.max(0,i-t),s=new(0,e.constructor)(r);for(let i=0;i<r;i++)s[i]=e[t+i];return s}function o(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}function a(e){return e instanceof Int8Array||e&&e.constructor&&"Int8Array"===e.constructor.name}function l(e){return e instanceof Uint8Array||e&&e.constructor&&"Uint8Array"===e.constructor.name}function c(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&"Uint8ClampedArray"===e.constructor.name}function u(e){return e instanceof Int16Array||e&&e.constructor&&"Int16Array"===e.constructor.name}function h(e){return e instanceof Uint16Array||e&&e.constructor&&"Uint16Array"===e.constructor.name}function d(e){return e instanceof Int32Array||e&&e.constructor&&"Int32Array"===e.constructor.name}function p(e){return e instanceof Uint32Array||e&&e.constructor&&"Uint32Array"===e.constructor.name}function f(e){return e instanceof Float32Array||e&&e.constructor&&"Float32Array"===e.constructor.name}function m(e){return e instanceof Float64Array||e&&e.constructor&&"Float64Array"===e.constructor.name}function g(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}function y(e){return(0,r.Wi)(e)?0:128+e.buffer.byteLength+64}},7958:(e,t,i)=>{"use strict";i.d(t,{D:()=>n,u:()=>s});let r=0;const s=0;function n(){return++r}},90551:(e,t,i)=>{"use strict";i.d(t,{Rd:()=>c,Ud:()=>h,VG:()=>l,Wv:()=>u,Zv:()=>d,sS:()=>f});var r=i(4745),s=(i(16068),i(19431)),n=i(21130),o=i(17321),a=i(25741);function l(e,t,i,r=2,s="abbr"){return`${(0,a.uf)(t,{minimumFractionDigits:r,maximumFractionDigits:r})} ${function(e,t,i){return e.units[t][i]}(e,i,s)}`}function c(e,t,i,r=2,s="abbr"){const n=(0,o.KU)(t,i);return l(e,(0,o.En)(t,i,n),n,r,s)}function u(e,t,i,r=2,s="abbr"){const n=(0,o.OG)(t,i);return l(e,(0,o.En)(t,i,n),n,r,s)}function h(e,t,i,r=2,s="abbr"){const n=(0,o.FN)(t,i);return l(e,(0,o.En)(t,i,n),n,r,s)}function d(e,t,i,r=2,s="abbr"){const n=(0,o.qv)(t,i);return l(e,(0,o.En)(t,i,n),n,r,s)}const p=["B","kB","MB","GB","TB"];function f(e,t){let i=0===t?0:Math.floor(Math.log(t)/Math.log(r.Y8.KILOBYTES));i=(0,s.uZ)(i,0,p.length-1);const o=(0,a.uf)(t/r.Y8.KILOBYTES**i,{maximumFractionDigits:2});return(0,n.gx)(e.units.bytes[p[i]],{fileSize:o})}},17321:(e,t,i)=>{"use strict";i.d(t,{$C:()=>I,En:()=>T,FN:()=>A,Jo:()=>Z,KU:()=>S,OG:()=>E,RG:()=>H,UF:()=>x,Yl:()=>R,_R:()=>L,c9:()=>N,cM:()=>D,gV:()=>W,hd:()=>u,j5:()=>V,qE:()=>U,qv:()=>M,tQ:()=>O,ty:()=>P}),i(39994);var r=i(25709),s=i(61681),n=i(25726),o=i(14685),a=i(14260),l=i(35925),c=i(36644);const u=39.37,h=a.sv.radius*Math.PI/200,d=/UNIT\[([^\]]+)\]\]$/i,p=c.Z,f=/UNIT\[([^\]]+)\]/i,m=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),g=(0,r.w)()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),y=e=>e*e,_=e=>e*e*e,v={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:y(.001)},"square-centimeters":{inBaseUnits:y(.01)},"square-decimeters":{inBaseUnits:y(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:y(1e3)},"square-inches":{inBaseUnits:y(.0254)},"square-feet":{inBaseUnits:y(.3048)},"square-yards":{inBaseUnits:y(.9144)},"square-miles":{inBaseUnits:y(1609.344)},"square-us-feet":{inBaseUnits:y(1200/3937)},acres:{inBaseUnits:.0015625*y(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*_(.001)},"cubic-centimeters":{inBaseUnits:1e3*_(.01)},"cubic-decimeters":{inBaseUnits:1e3*_(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*_(1e3)},"cubic-inches":{inBaseUnits:1e3*_(.0254)},"cubic-feet":{inBaseUnits:1e3*_(.3048)},"cubic-yards":{inBaseUnits:1e3*_(.9144)},"cubic-miles":{inBaseUnits:1e3*_(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},b=(()=>{const e={};for(const t in v)for(const i in v[t].units)e[i]=t;return e})(),w=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function x(e){const t=b[e];if(!t)throw new Error("unknown type");return t}function C(e,t=null){return t=t||x(e),v[t].baseUnit===e}function T(e,t,i){if(t===i)return e;const r=x(t);if(r!==x(i))throw new Error("incompatible units");const s=C(t,r)?e:function(e,t,i){return e*v[i].units[t].inBaseUnits}(e,t,r);return C(i,r)?s:function(e,t,i){return e/v[i].units[t].inBaseUnits}(s,i,r)}function S(e,t){const i=T(e,t,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function E(e,t){const i=T(e,t,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function A(e,t){const i=T(e,t,"feet");return Math.abs(i)<1e3?"feet":"miles"}function M(e,t){const i=T(e,t,"feet");return Math.abs(i)<1e5?"feet":"miles"}function O(e,t){const i=T(e,t,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function R(e,t){const i=T(e,t,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function P(e,t,i){return T(e,t,"meters")/(i*Math.PI/180)}function I(e){return g.fromJSON(e.toLowerCase())||null}function L(e){if(e&&"object"==typeof e&&!(0,l.N$)(e))return 1;const t=N(e);return t>1e5?1:t}function D(e){return N(e)>=(e instanceof o.Z?(0,n.Iu)(e).metersPerDegree:1e5)?"meters":U(e)}function N(e,t=a.sv.metersPerDegree){return(0,s.Pt)(function(e,t=!1){let i,r,s=null;if(null!=e&&("object"==typeof e?(i=e.wkid,r=e.wkt):"number"==typeof e?i=e:"string"==typeof e&&(r=e)),i){if((0,l.o$)(i))return a.yr.metersPerDegree;if((0,l.ME)(i))return a.Z1.metersPerDegree;s=p.values[p[i]],!s&&t&&m.has(i)&&(s=h)}else r&&(B(r)?s=F(d.exec(r),s):z(r)&&(s=F(f.exec(r),s)));return s}(e,!0),t)}function F(e,t){return e&&e[1]?k(e[1]):t}function k(e){return parseFloat(e.split(",")[1])}function U(e){let t,i,r=null;if(null!=e&&("object"==typeof e?(t=e.wkid,i=e.wkt):"number"==typeof e?t=e:"string"==typeof e&&(i=e)),t)r=p.units[p[t]];else if(i){const e=B(i)?d:z(i)?f:null;if(e){const t=e.exec(i);t&&t[1]&&(r=function(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||!p.units.includes(i)){const t=k(e);i=null;const r=p.values;for(let e=0;e<r.length;++e)if(Math.abs(t-r[e])<1e-7){i=p.units[e];break}}return i}(t[1]))}}return(0,s.pC)(r)?I(r):null}function V(e){const t=U(e);return(0,s.Wi)(t)||!w.includes(t)?null:t}function z(e){return/^GEOCCS/i.test(e)}function B(e){return/^PROJCS/i.test(e)}function H(e){const t="metric";if((0,s.Wi)(e))return t;const i=e.map,r=i&&"portalItem"in i?i.portalItem?.portal:null;if(r)switch(r?.user?.units??r.units){case t:return t;case"english":return"imperial"}return(0,s.Pt)(function(e){const t=U(e);if((0,s.Wi)(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}(e.spatialReference),t)}new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);const j={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},G={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},W=(0,r.w)()(j),Z=(0,r.w)()(G);(0,r.w)()({...j,...G})},3466:(e,t,i)=>{"use strict";i.d(t,{$U:()=>re,AH:()=>Y,B7:()=>A,D6:()=>U,Fv:()=>j,HK:()=>$,Hu:()=>pe,Ie:()=>ue,L:()=>C,Ml:()=>ge,P$:()=>W,PF:()=>H,Qj:()=>ce,R9:()=>_,TI:()=>x,YP:()=>Z,Yd:()=>ae,ZN:()=>fe,_l:()=>Q,b7:()=>M,ed:()=>D,fl:()=>me,hF:()=>B,hO:()=>se,io:()=>ee,jc:()=>q,kl:()=>V,mN:()=>T,oC:()=>te,oh:()=>k,qg:()=>O,rS:()=>X,sJ:()=>K,tD:()=>L,tm:()=>N,u0:()=>S,v_:()=>G,vt:()=>le,zd:()=>de});var r=i(51366),s=i(70375),n=i(13802),o=i(61681);const a=n.Z.getLogger("esri.core.urlUtils"),l=r.Z.request,c="esri/config: esriConfig.request.proxyUrl is not set.",u=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,h=/^\s*http:/i,d=/^\s*https:/i,p=/^\s*file:/i,f=/:\d+$/,m=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,g=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),y=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class _{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let t=(0,o.j0)(this.uri.match(g));this.scheme=t[2]||(t[1]?"":null),this.authority=t[4]||(t[3]?"":null),this.path=t[5],this.query=t[7]||(t[6]?"":null),this.fragment=t[9]||(t[8]?"":null),null!=this.authority&&(t=(0,o.j0)(this.authority.match(y)),this.user=t[3]||null,this.password=t[4]||null,this.host=t[6]||t[7],this.port=t[9]||null)}toString(){return this.uri}}const v={};let b=new _(r.Z.applicationUrl);let w=function(){const e=(0,o.j0)(b.path),t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${b.scheme}://${b.host}${null!=b.port?`:${b.port}`:""}${t}`}();const x=()=>b,C=()=>w;function T(e){const t={path:null,query:null},i=new _(e),r=e.indexOf("?");return null===i.query?t.path=e:(t.path=e.substring(0,r),t.query=S(i.query)),i.fragment&&(t.hash=i.fragment,null===i.query&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function S(e){const t=e.split("&"),i={};for(const e of t){if(!e)continue;const t=e.indexOf("=");let r,s;t<0?(r=decodeURIComponent(e),s=""):(r=decodeURIComponent(e.slice(0,t)),s=decodeURIComponent(e.slice(t+1)));let n=i[r];"string"==typeof n&&(n=i[r]=[n]),Array.isArray(n)?n.push(s):i[r]=s}return i}function E(e){return e&&"object"==typeof e&&"toJSON"in e&&"function"==typeof e.toJSON}function A(e,t){return e?t&&"function"==typeof t?Object.keys(e).map((i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i])))).join("&"):Object.keys(e).map((i=>{const r=e[i];if(null==r)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map((e=>E(e)?s+encodeURIComponent(JSON.stringify(e)):s+encodeURIComponent(e))).join("&"):E(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)})).filter((e=>e)).join("&"):""}function M(e=!1){let t,i=l.proxyUrl;if("string"==typeof e){t=re(e);const r=D(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw a.warn(c),new s.Z("urlutils:proxy-not-set",c);return t&&ne()&&(i=se(i)),T(i)}function O(e){const t=D(e);let i,r;if(t){const e=P(t.proxyUrl);i=e.path,r=e.query?S(e.query):null}if(i){const t=T(e);e=i+"?"+t.path;const s=A({...r,...t.query});s&&(e=`${e}?${s}`)}return e}const R={path:"",query:""};function P(e){const t=e.indexOf("?");return-1!==t?(R.path=e.slice(0,t),R.query=e.slice(t+1)):(R.path=e,R.query=null),R}function I(e){return(e=oe(e=function(e){return e&&"/"===e[e.length-1]?e:`${e}/`}(e=P(e).path),!0)).toLowerCase()}function L(e){const t={proxyUrl:e.proxyUrl,urlPrefix:I(e.urlPrefix)},i=l.proxyRules,r=t.urlPrefix;let s=i.length;for(let e=0;e<i.length;e++){const t=i[e].urlPrefix;if(0===r.indexOf(t)){if(r.length===t.length)return-1;s=e;break}0===t.indexOf(r)&&(s=e+1)}return i.splice(s,0,t),s}function D(e){const t=l.proxyRules,i=I(e);for(let e=0;e<t.length;e++)if(0===i.indexOf(t[e].urlPrefix))return t[e]}function N(e,t){return e=F(e),t=F(t),oe(e)===oe(t)}function F(e){const t=(e=j(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function k(e){const t=t=>null==t||t instanceof RegExp&&t.test(e)||"string"==typeof t&&e.startsWith(t),i=l.interceptors;if(i)for(const e of i)if(Array.isArray(e.urls)){if(e.urls.some(t))return e}else if(t(e.urls))return e;return null}function U(e,t,i=!1){const r=he(e),s=he(t);return!(!i&&r.scheme!==s.scheme)&&null!=r.host&&null!=s.host&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function V(e){if("string"==typeof e){if(!Z(e))return!0;e=he(e)}if(U(e,b))return!0;const t=l.trustedServers||[];for(let i=0;i<t.length;i++){const r=z(t[i]);for(let t=0;t<r.length;t++)if(U(e,r[t]))return!0}return!1}function z(e){return v[e]||(ie(e)||te(e)?v[e]=[new _(B(e))]:v[e]=[new _(`http://${e}`),new _(`https://${e}`)]),v[e]}function B(e,t=w,i){return te(e)?i&&i.preserveProtocolRelative?e:"http"===b.scheme&&b.authority===W(e).slice(2)?`http:${e}`:`https:${e}`:ie(e)?e:(0,o.j0)(G("/"===e[0]?function(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return-1===i?e:e.slice(0,i)}(t):t,e))}function H(e,t=w,i){if(!Z(e))return e;const r=j(e),s=r.toLowerCase(),n=j(t).toLowerCase().replace(/\/+$/,""),o=i?j(i).toLowerCase().replace(/\/+$/,""):null;if(o&&0!==n.indexOf(o))return e;const a=(e,t,i)=>-1===(i=e.indexOf(t,i))?e.length:i;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(-1===c)return e;if(o&&c<o.length)return e;e=r.slice(c);const u=n.slice(c-1).replace(/[^/]+/g,"").length;if(u>0)for(let t=0;t<u;t++)e=`../${e}`;else e=`./${e}`;return e}function j(e){return function(e){const t=l.httpsDomains;if(!function(e){return h.test(e)||"http"===b.scheme&&te(e)}(e))return e;const i=e.indexOf("/",7);let r;if(r=-1===i?e:e.slice(0,i),r=r.toLowerCase().slice(7),f.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return"http"===b.scheme&&r===b.authority&&!m.test(e)||(ne()&&r===b.authority||t&&t.some((e=>r===e||r.endsWith(`.${e}`)))||ne()&&!D(e))&&(e=se(e)),e}(e=function(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}(e=function(e){if(/^https?:\/\//i.test(e)){const t=P(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}(e=B(e=e.trim()))))}function G(...e){const t=e.filter(o.pC);if(!t||!t.length)return;const i=[];if(Z(t[0])){const e=t[0],r=e.indexOf("//");-1!==r&&(i.push(e.slice(0,r+1)),function(e){return p.test(e)}(t[0])&&(i[0]+="/"),t[0]=e.slice(r+2))}else"/"===t[0][0]&&i.push("");const r=t.reduce(((e,t)=>t?e.concat(t.split("/")):e),[]);for(let e=0;e<r.length;e++){const t=r[e];".."===t&&i.length>0&&".."!==i[i.length-1]?i.pop():(!t&&e===r.length-1||t&&("."!==t||0===i.length))&&i.push(t)}return i.join("/")}function W(e,t=!1){if(q(e)||$(e))return null;let i=e.indexOf("://");if(-1===i&&te(e))i=2;else{if(-1===i)return null;i+=3}const r=e.indexOf("/",i);return-1!==r&&(e=e.slice(0,r)),t&&(e=oe(e,!0)),e}function Z(e){return te(e)||ie(e)}function q(e){return null!=e&&"blob:"===e.slice(0,5)}function $(e){return"data:"===e.slice(0,5)}function Y(e){const t=K(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let e=0;e<i.length;e++)r[e]=i.charCodeAt(e);return r.buffer}function X(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const J=/^data:(.*?)(;base64)?,(.*)$/;function K(e){const t=e.match(J);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function Q(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function ee(e,t){(function(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0})(e,t)||function(e,t){!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}(e,t)}function te(e){return null!=e&&void 0!==e&&"/"===e[0]&&"/"===e[1]}function ie(e){return u.test(e)}function re(e){return d.test(e)||"https"===b.scheme&&te(e)}function se(e){return te(e)?`https:${e}`:e.replace(h,"https:")}function ne(){return"https"===b.scheme}function oe(e,t=!1){return te(e)?e.slice(2):(e=e.replace(u,""),t&&e.length>1&&"/"===e[0]&&"/"===e[1]&&(e=e.slice(2)),e)}function ae(e){let t=0;if(Z(e)){const i=e.indexOf("//");-1!==i&&(t=i+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function le(e,t){if(!e)return"";const i=T(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!t?.length)return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function ce(e){return e.replace(/\/+$/,"")}function ue(e,t,i){if(!(t&&i&&e&&Z(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function he(e){return"string"==typeof e?new _(B(e)):(e.scheme||(e.scheme=b.scheme),e)}function de(e){return _e.test(e)}function pe(e,t){const i=T(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function fe(e,t,i){const r=T(e),s=r.query||{};return s[t]=String(i),`${r.path}?${A(s)}`}function me(e,t){const i=T(e),r=i.query||{};for(const e in t)r[e]=t[e];const s=A(r);return s?`${i.path}?${s}`:i.path}function ge(e){if((0,o.Wi)(e))return null;const t=e.match(ye);return t?t[1]:null}const ye=/.*?\.([^\/]*)$/,_e=/(^data:image\/svg|\.svg$)/i},12173:(e,t,i)=>{"use strict";i.d(t,{D:()=>s});const r="randomUUID"in crypto;function s(){if(r)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=t=>e[t].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}},97595:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r=i(23148),s=i(13802),n=i(78668),o=i(58713),a=i(66839);const l=s.Z.getLogger("esri.core.workers.Connection");class c{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new o.Z}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,t){return new Promise(((i,r)=>{let s=!0;const o=e=>{(0,n.k_)(t.signal),s&&(s=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let s=0;s<e.length;++s){const l=e[s];(0,n.y8)(l)?this._clientPromises[s]=l.then((e=>(this._clients[s]=new a.Z(e,t,(()=>this._ongoingJobsQueue.pop())),o(i),this._clients[s])),(()=>(o(r),null))):(this._clients[s]=new a.Z(l,t,(()=>this._ongoingJobsQueue.pop())),this._clientPromises[s]=Promise.resolve(this._clients[s]),o(i))}}))}broadcast(e,t,i){const r=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const n=this._clientPromises[s];r[s]=n.then((r=>r.invoke(e,t,i)))}return r}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.deferred.reject((0,n.zE)(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then((e=>e.close()));this._clients.length=0,this._clientPromises.length=0}invoke(e,t,i){let r=null;Array.isArray(i)?(l.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),r={transferList:i}):r=i;const s=(0,n.dD)();this._ongoingJobsQueue.push({methodName:e,data:t,invokeOptions:r,deferred:s});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then((e=>e.jobAdded()))}return s.promise}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,r.AL)(this._clients.map((i=>i.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let i=t.length;for(let r=0;r<this._clientPromises.length;++r)this._clientPromises[r].then((s=>{t[r]=s.openPort(),0==--i&&e(t)}))}))}get test(){return{numClients:this._clients.length}}}},66839:(e,t,i)=>{"use strict";i.d(t,{Z:()=>_});var r=i(88256),s=i(70375),n=i(49546),o=i(61681),a=i(78668),l=i(71627),c=i(9870);const u={statsWorker:()=>i.e(1489).then(i.bind(i,61489)),geometryEngineWorker:()=>Promise.all([i.e(9067),i.e(922)]).then(i.bind(i,50922)),CSVSourceWorker:()=>Promise.all([i.e(3362),i.e(7519),i.e(3840),i.e(4218)]).then(i.bind(i,94218)),EdgeProcessingWorker:()=>Promise.resolve().then(i.bind(i,5843)),ElevationSamplerWorker:()=>i.e(2902).then(i.bind(i,12902)),FeatureServiceSnappingSourceWorker:()=>Promise.all([i.e(3362),i.e(7519),i.e(3840),i.e(5668)]).then(i.bind(i,25668)),GeoJSONSourceWorker:()=>Promise.all([i.e(3362),i.e(7519),i.e(3840),i.e(9955)]).then(i.bind(i,59955)),LercWorker:()=>i.e(9821).then(i.bind(i,9821)),MemorySourceWorker:()=>Promise.all([i.e(3362),i.e(7519),i.e(3840),i.e(8536)]).then(i.bind(i,98536)),PBFDecoderWorker:()=>i.e(5019).then(i.bind(i,95019)),Pipeline:()=>Promise.all([i.e(3362),i.e(7519),i.e(3840),i.e(4343)]).then(i.bind(i,74343)),PointCloudWorker:()=>i.e(5552).then(i.bind(i,95552)),RasterWorker:()=>Promise.all([i.e(1329),i.e(7359),i.e(7107),i.e(2247)]).then(i.bind(i,92247)),SceneLayerSnappingSourceWorker:()=>Promise.all([i.e(3362),i.e(7519),i.e(4863)]).then(i.bind(i,34863)),SceneLayerWorker:()=>i.e(2552).then(i.bind(i,12552)),WFSSourceWorker:()=>Promise.all([i.e(3362),i.e(7519),i.e(3840),i.e(1691)]).then(i.bind(i,1691)),WorkerTileHandler:()=>Promise.all([i.e(3043),i.e(5826)]).then(i.bind(i,25826))},{CLOSE:h,ABORT:d,INVOKE:p,RESPONSE:f,OPEN_PORT:m,ON:g}=l.Cs;class y{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===l.Cs.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class _{constructor(e,t,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new y((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(e){const t=new MessageChannel;let i;i="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const r=new _(t.port1,{channel:t,client:i},(()=>null));return"object"==typeof i&&"remoteClient"in i&&(i.remoteClient=r),_.clients.set(r,i),t.port2}static loadWorker(e){const t=u[e];return t?t():Promise.resolve(null)}close(){this._post({type:h}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,i){const r=i&&i.signal,n=i&&i.transferList;if(!this._port)return Promise.reject(new s.Z("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const c=(0,l.jt)();return new Promise(((i,s)=>{if((0,a.Hc)(r))return this._processWork(),void s((0,a.zE)());const l=(0,a.fu)(r,(()=>{const e=this._outJobs.get(c);e&&(this._outJobs.delete(c),this._processWork(),(0,o.hw)(e.abortHandle),this._post({type:d,jobId:c}),s((0,a.zE)()))})),u={resolve:i,reject:s,abortHandle:l,debugInfo:e};this._outJobs.set(c,u),this._post({type:p,jobId:c,methodName:e,abortable:null!=r},t,n)}))}on(e,t){const i=new MessageChannel;function r(e){t(e.data)}return this._port.postMessage({type:l.Cs.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",r),i.port1.start(),{remove(){i.port1.postMessage({type:l.Cs.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",r)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:m,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=2)return;const e=this._getNextJob();if(!e)return;const{methodName:t,data:i,invokeOptions:r,deferred:s}=e;this.invoke(t,i,r).then((e=>s.resolve(e))).catch((e=>s.reject(e)))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{(0,o.hw)(e.abortHandle),e.reject((0,a.zE)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(e){(0,o.pC)(this._schedule)?this._schedule((()=>this._processMessage(e))):this._processMessage(e)}_processMessage(e){const t=(0,l.QM)(e);if(t)switch(t.type){case f:this._onResponseMessage(t);break;case p:this._invokeQueue.push(t);break;case d:this._onAbortMessage(t);break;case h:this._onCloseMessage();break;case m:this._onOpenPortMessage(t);break;case g:this._onOnMessage(t)}}_onAbortMessage(e){const t=this._inJobs,i=e.jobId,r=t.get(i);this._invokeQueue.push(e),r&&(r.controller&&r.controller.abort(),t.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&_.clients.get(this)===e&&e.destroy(),_.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:i,data:r,abortable:s}=e,n=s?new AbortController:null,o=this._inJobs;let c,u=this._client,h=u[t];try{if(!h&&t&&t.includes(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)u=u[e[t]],h=u[e[t+1]]}if("function"!=typeof h)throw new TypeError(`${t} is not a function`);c=h.call(u,r,{client:this,signal:n?n.signal:null})}catch(e){return void this._post({type:f,jobId:i,error:(0,l.AB)(e)})}(0,a.y8)(c)?(o.set(i,{controller:n,promise:c}),c.then((e=>{o.has(i)&&(o.delete(i),this._post({type:f,jobId:i},e))}),(e=>{o.has(i)&&(o.delete(i),(0,a.D_)(e)||this._post({type:f,jobId:i,error:(0,l.AB)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:f,jobId:i},c)}_onOpenPortMessage(e){new _(e.port,{client:this._client},(()=>null))}_onOnMessage(e){const{port:t}=e,i=this._client.on(e.eventType,(e=>{t.postMessage(e)})),r=(0,n.on)(e.port,"message",(e=>{(0,l.QM)(e).type===l.Cs.CLOSE&&(r.remove(),i.remove(),t.close())}))}_onResponseMessage(e){const{jobId:t,error:i,data:r}=e,n=this._outJobs;if(!n.has(t))return;const a=n.get(t);this._processWork(),n.delete(t),(0,o.hw)(a.abortHandle),i?a.reject(s.Z.fromJSON(JSON.parse(i))):a.resolve(r)}_post(e,t,i){return(0,l.oi)(this._port,e,t,i)}}_.kernelInfo={revision:c.$,version:r.i8,buildDate:c.r},_.clients=new Map},12916:(e,t,i)=>{"use strict";i.d(t,{q:()=>u});var r=i(7753),s=i(23148),n=i(13802),o=i(61681),a=i(78668),l=i(47109);const c=n.Z.getLogger("esri.core.workers.WorkerHandle");class u{constructor(e,t,i,r,s={}){this._mainMethod=t,this._transferLists=i,this._listeners=[],this._promise=(0,l.bA)(e,{...s,schedule:r}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>c.error(`Failed to initialize ${e} worker: ${t}`)))}on(e,t){const i={removed:!1,eventName:e,callback:t,threadHandle:null};return this._listeners.push(i),this._connectListener(i),(0,s.kB)((()=>{i.removed=!0,(0,r.Od)(this._listeners,i),this._thread&&(0,o.pC)(i.threadHandle)&&i.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,i){if(this._thread){const r=this._transferLists[e],s=r?r(t):[];return this._thread.invoke(e,t,{transferList:s,signal:i})}return this._promise?this._promise.then((()=>((0,a.k_)(i),this.invokeMethod(e,t,i)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}}},71627:(e,t,i)=>{"use strict";i.d(t,{AB:()=>l,Cs:()=>r,QM:()=>u,jt:()=>a,oi:()=>c});var r,s,n=i(39994);(s=r||(r={}))[s.HANDSHAKE=0]="HANDSHAKE",s[s.OPEN=1]="OPEN",s[s.OPENED=2]="OPENED",s[s.RESPONSE=3]="RESPONSE",s[s.INVOKE=4]="INVOKE",s[s.ABORT=5]="ABORT",s[s.CLOSE=6]="CLOSE",s[s.OPEN_PORT=7]="OPEN_PORT",s[s.ON=8]="ON";let o=0;function a(){return o++}function l(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function c(e,t,i,s){if(t.type===r.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==r.INVOKE&&t.type!==r.RESPONSE)return void e.postMessage(t);let n;!function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(i)?(n=h(s),t.data=i):(n=h(i.transferList),t.data=i.result),n?e.postMessage(t,n):e.postMessage(t)}function u(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function h(e){if(!e||!e.length)return null;if((0,n.Z)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}(e)));return t.length?t:null}},47109:(e,t,i)=>{"use strict";i.d(t,{j2:()=>V,bA:()=>B});var r=i(70375),s=i(39994),n=i(78668),o=i(97595),a=i(66839),l=i(88256),c=i(13802),u=i(61681),h=i(71627),d=i(36567),p=i(51366),f=(i(87090),i(3466));const m={};function g(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=m.baseUrl),m.packages?.forEach((e=>{!function(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}(t.packages,e)})),t}var y=i(66581);class _{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...i)=>e[t](...i)}))}}class v{constructor(){this._dispatcher=new _,this._workerPostMessage({type:h.Cs.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){(0,y.Y)((()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,i){this._dispatcher.addEventListener(e,t,i)}removeEventListener(e,t,i){this._dispatcher.removeEventListener(e,t,i)}_workerPostMessage(e){(0,y.Y)((()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))}))}async _workerMessageHandler(e){const t=(0,h.QM)(e);if(t&&t.type===h.Cs.OPEN){const{modulePath:e,jobId:i}=t;let r=await a.Z.loadWorker(e);r||(r=await import(e));const s=a.Z.connect(r);this._workerPostMessage({type:h.Cs.OPENED,jobId:i,data:s})}}}var b=i(8108),w=i(9870);const x=c.Z.getLogger("esri.core.workers"),{HANDSHAKE:C}=h.Cs;let T,S;const E="Failed to create Worker. Fallback to execute module in main thread";async function A(e){return new Promise((t=>{function i(s){const n=(0,h.QM)(s);n&&n.type===C&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(t){t.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),x.warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new v).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)}))}let M=0;const O=c.Z.getLogger("esri.core.workers"),{ABORT:R,INVOKE:P,OPEN:I,OPENED:L,RESPONSE:D}=h.Cs;class N{constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),O.error(e)}))}static async create(e){const t=await async function(){if(!(0,s.Z)("esri-workers")||((0,s.Z)("mozilla"),0))return A(new v);if(!T&&!S)try{const e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.replace('"{CONFIGURATION}"',`'${function(){let e;if(null!=p.Z.default){const t={...p.Z};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(p.Z));e.assetsPath=(0,f.hF)(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,b.Kd)(),e.has={"esri-csp-restrictions":(0,s.Z)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,s.Z)("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":(0,s.Z)("esri-2d-query-centroid-enabled"),"featurelayer-pbf":(0,s.Z)("featurelayer-pbf"),"featurelayer-simplify-thresholds":(0,s.Z)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,s.Z)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,s.Z)("featurelayer-simplify-mobile-factor"),"esri-atomics":(0,s.Z)("esri-atomics"),"esri-shared-array-buffer":(0,s.Z)("esri-shared-array-buffer"),"esri-tiles-debug":(0,s.Z)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,s.Z)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,s.Z)("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=(0,f.hF)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=(0,f.hF)(e.workers.workerPath):e.workers.workerPath=(0,f.hF)((0,d.V)("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=p.Z.workers.loaderConfig,i=g({baseUrl:t?.baseUrl,locale:(0,b.Kd)(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t?.has},map:{...t?.map},paths:{...t?.paths},packages:t?.packages||[]}),r={version:l.i8,buildDate:w.r,revision:w.$};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}()}'`);T=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){S=e||{}}let e;if(T)try{e=new Worker(T,{name:"esri-worker-"+M++})}catch(t){x.warn(E,S),e=new v}else x.warn(E,S),e=new v;return A(e)}();return new N(t,e)}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:i}=t,r=(0,h.jt)();return new Promise(((t,s)=>{const o={resolve:t,reject:s,abortHandle:(0,n.$F)(i,(()=>{this._outJobs.delete(r),this._post({type:R,jobId:r})}))};this._outJobs.set(r,o),this._post({type:I,jobId:r,modulePath:e})}))}_onMessage(e){const t=(0,h.QM)(e);if(t)switch(t.type){case L:this._onOpenedMessage(t);break;case D:this._onResponseMessage(t);break;case R:this._onAbortMessage(t);break;case P:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,i=e.jobId,r=t.get(i);r&&(r.controller&&r.controller.abort(),t.delete(i))}_onInvokeMessage(e){const{methodName:t,jobId:i,data:r,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,c=l.Nv[t];let u;try{if("function"!=typeof c)throw new TypeError(`${t} is not a function`);u=c.call(null,r,{signal:o?o.signal:null})}catch(e){return void this._post({type:D,jobId:i,error:(0,h.AB)(e)})}(0,n.y8)(u)?(a.set(i,{controller:o,promise:u}),u.then((e=>{a.has(i)&&(a.delete(i),this._post({type:D,jobId:i},e))}),(e=>{a.has(i)&&(a.delete(i),e||(e={message:"Error encountered at method"+t}),(0,n.D_)(e)||this._post({type:D,jobId:i,error:(0,h.AB)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:D,jobId:i},u)}_onOpenedMessage(e){const{jobId:t,data:i}=e,r=this._outJobs.get(t);r&&(this._outJobs.delete(t),(0,u.hw)(r.abortHandle),r.resolve(i))}_onResponseMessage(e){const{jobId:t,error:i,data:s}=e,n=this._outJobs.get(t);n&&(this._outJobs.delete(t),(0,u.hw)(n.abortHandle),i?n.reject(r.Z.fromJSON(JSON.parse(i))):n.resolve(s))}_post(e,t,i){return(0,h.oi)(this.worker,e,t,i)}}let F=(0,s.Z)("esri-workers-debug")?1:(0,s.Z)("host-browser")?navigator.hardwareConcurrency-1:0;F||(F=(0,s.Z)("safari")&&(0,s.Z)("mac")||(0,s.Z)("trident")?7:2);let k=0;const U=[];function V(){G()}async function z(e,t){const i=new o.Z;return await i.open(e,t),i}async function B(e,t={}){if("string"!=typeof e)throw new r.Z("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if((0,s.Z)("host-webworker")&&!(0,s.Z)("esri-workers")&&(i="local"),"local"===i){let i=await a.Z.loadWorker(e);i||(i=await import(e)),(0,n.k_)(t.signal);const r=t.client||i;return z([a.Z.connect(i)],{...t,client:r})}if(await G(),(0,n.k_)(t.signal),"dedicated"===i){const i=k++%F;return z([await U[i].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const i=Math.min(t.maxNumWorkers,F);if(i<F){const r=new Array(i);for(let s=0;s<i;++s){const i=k++%F;r[s]=U[i].open(e,t)}return z(r,t)}}return z(U.map((i=>i.open(e,t))),t)}let H,j=null;async function G(){if(j)return j;H=new AbortController;const e=[];for(let t=0;t<F;t++){const i=N.create(t).then((e=>(U[t]=e,e)));e.push(i)}return j=Promise.all(e),j}},3363:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=r=class extends n.wq{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new r({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"name",void 0),(0,s._)([(0,o.Cb)({type:["boolean","date","number","string"],json:{write:!0}})],l.prototype,"returnType",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=r=(0,s._)([(0,a.j)("esri.form.ExpressionInfo")],l);const c=l},91957:(e,t,i)=>{"use strict";i.d(t,{qM:()=>u});var r=i(7283),s=i(91772),n=i(20031),o=i(74304),a=i(53446),l=i(89542),c=i(90819);i(14685),i(59659),i(53736);const u={base:n.Z,key:"type",typeMap:{extent:s.Z,multipoint:o.Z,point:a.Z,polyline:c.Z,polygon:l.Z}};(0,r.N7)(u)},91772:(e,t,i)=>{"use strict";i.d(t,{Z:()=>_});var r,s=i(36663),n=i(61681),o=i(21130),a=i(81977),l=(i(7753),i(39994),i(7283),i(40266)),c=i(20031),u=i(53446),h=i(14685),d=i(27127),p=i(68668),f=i(35925),m=i(39536);function g(e,t,i){return null==t?i:null==i?t:e(t,i)}let y=r=class extends c.Z{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return function(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:"object"==typeof e?(e.spatialReference=null==e.spatialReference?h.Z.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:null==s?h.Z.WGS84:s}}static fromBounds(e,t){return new r({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new r({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new u.Z({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return null!=this.mmin&&null!=this.mmax}get hasZ(){return null!=this.zmin&&null!=this.zmax}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return null!=e.z&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new r;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,null!=this.zmin&&(e.zmin=this.zmin,e.zmax=this.zmax),null!=this.mmin&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&(0,m.Q8)(t,i)&&(e=t.isWebMercator?(0,m.$)(e):(0,m.Sx)(e,!0)),"point"===e.type?(0,d.aV)(this,e):"extent"===e.type&&(0,d.uP)(this,e)}equals(e){if(this===e)return!0;if((0,n.Wi)(e))return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&(0,m.Q8)(t,i)&&(e=t.isWebMercator?(0,m.$)(e):(0,m.Sx)(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const e=(this.zmax-this.zmin)*t;this.zmin+=e,this.zmax-=e}if(this.hasM){const e=(this.mmax-this.mmin)*t;this.mmin+=e,this.mmax-=e}return this}intersects(e){if((0,n.Wi)(e))return!1;"mesh"===e.type&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&(0,m.Q8)(t,i)&&(e=t.isWebMercator?(0,m.$)(e):(0,m.Sx)(e,!0)),(0,p.IY)(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,null!=i&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=g(Math.min,this.zmin,e.zmin),this.zmax=g(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=g(Math.min,this.mmin,e.mmin),this.mmax=g(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:(0,n.Wi)(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=g(Math.max,this.zmin,e.zmin),this.zmax=g(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=g(Math.max,this.mmin,e.mmin),this.mmax=g(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=(0,f.C5)(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?(0,m.Sx)(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new h.Z((0,o.gx)(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;if(!(i=i||(0,f.C5)(r)))return this;const s=this._getParts(i).map((e=>e.extent));if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(e)return this._shiftCM(i);if(t)return s;let n=!0,o=!0;return s.forEach((e=>{e.hasZ||(n=!1),e.hasM||(o=!1)})),{rings:s.map((e=>{const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(n){const i=(e.zmax-e.zmin)/2;for(let e=0;e<t.length;e++)t[e].push(i)}if(o){const i=(e.mmax-e.mmin)/2;for(let e=0;e<t.length;e++)t[e].push(i)}return t})),hasZ:n,hasM:o,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:i,ymax:s,spatialReference:n}=this,o=this.width,a=this.xmin,l=this.xmax;let c;e=e||(0,f.C5)(n);const[u,h]=e.valid;c=this._normalizeX(this.xmin,e);const d=c.x,p=c.frameId;c=this._normalizeX(this.xmax,e);const m=c.x,g=c.frameId,y=d===m&&o>0;if(o>2*h){const e=new r(a<l?d:m,i,h,s,n),o=new r(u,i,a<l?m:d,s,n),c=new r(0,i,h,s,n),f=new r(u,i,0,s,n),y=[],_=[];e.contains(c)&&y.push(p),e.contains(f)&&_.push(p),o.contains(c)&&y.push(g),o.contains(f)&&_.push(g);for(let e=p+1;e<g;e++)y.push(e),_.push(e);t.push({extent:e,frameIds:[p]},{extent:o,frameIds:[g]},{extent:c,frameIds:y},{extent:f,frameIds:_})}else d>m||y?t.push({extent:new r(d,i,h,s,n),frameIds:[p]},{extent:new r(u,i,m,s,n),frameIds:[g]}):t.push({extent:new r(d,i,m,s,n),frameIds:[p]});this.cache._parts=t}const i=this.hasZ,s=this.hasM;if(i||s){const e={};i&&(e.zmin=this.zmin,e.zmax=this.zmax),s&&(e.mmin=this.mmin,e.mmax=this.mmax);for(let i=0;i<t.length;i++)t[i].extent.set(e)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}};(0,s._)([(0,a.Cb)({readOnly:!0})],y.prototype,"cache",null),(0,s._)([(0,a.Cb)({readOnly:!0})],y.prototype,"center",null),(0,s._)([(0,a.Cb)({readOnly:!0})],y.prototype,"extent",null),(0,s._)([(0,a.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],y.prototype,"hasM",null),(0,s._)([(0,a.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],y.prototype,"hasZ",null),(0,s._)([(0,a.Cb)({readOnly:!0})],y.prototype,"height",null),(0,s._)([(0,a.Cb)({readOnly:!0})],y.prototype,"width",null),(0,s._)([(0,a.Cb)({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],y.prototype,"xmin",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],y.prototype,"ymin",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],y.prototype,"mmin",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],y.prototype,"zmin",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],y.prototype,"xmax",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],y.prototype,"ymax",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],y.prototype,"mmax",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],y.prototype,"zmax",void 0),y=r=(0,s._)([(0,l.j)("esri.geometry.Extent")],y),y.prototype.toJSON.isDefaultToJSON=!0;const _=y},20031:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(34248)),a=i(40266),l=i(14685);let c=class extends s.wq{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=l.Z.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof l.Z)return e;if(null!=e){const i=new l.Z;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};(0,r._)([(0,n.Cb)()],c.prototype,"type",void 0),(0,r._)([(0,n.Cb)({readOnly:!0})],c.prototype,"cache",null),(0,r._)([(0,n.Cb)({readOnly:!0})],c.prototype,"extent",null),(0,r._)([(0,n.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],c.prototype,"hasM",void 0),(0,r._)([(0,n.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],c.prototype,"hasZ",void 0),(0,r._)([(0,n.Cb)({type:l.Z,json:{write:!0}})],c.prototype,"spatialReference",void 0),(0,r._)([(0,o.r)("spatialReference")],c.prototype,"readSpatialReference",null),c=(0,r._)([(0,a.j)("esri.geometry.Geometry")],c);const u=c},64307:(e,t,i)=>{"use strict";i.d(t,{Z:()=>v});var r,s=i(36663),n=i(7753),o=i(25709),a=i(82064),l=i(17321),c=i(96863),u=i(81977),h=(i(39994),i(7283),i(34248)),d=i(40266),p=i(39835);const f=(0,o.w)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),m=f.jsonValues.slice();(0,n.e$)(m,"orthometric");const g=(0,o.w)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let y=r=class extends a.wq{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return f.write(e,t,i)}readHeightModel(e,t,i){return f.read(e)||(i&&i.messages&&i.messages.push(function(e,t){return new c.Z("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:i})),null)}readHeightUnit(e,t,i){return g.read(e)||(i&&i.messages&&i.messages.push(_(e,{context:i})),null)}readHeightUnitService(e,t,i){return(0,l.$C)(e)||g.read(e)||(i&&i.messages&&i.messages.push(_(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new r({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=(0,l.cM)(t);return new r({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new r;return t.read(e,{origin:"web-scene"}),t}};function _(e,t){return new c.Z("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}(0,s._)([(0,u.Cb)({type:f.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:m,default:"ellipsoidal"}}}})],y.prototype,"heightModel",void 0),(0,s._)([(0,p.c)("web-scene","heightModel")],y.prototype,"writeHeightModel",null),(0,s._)([(0,h.r)(["web-scene","service"],"heightModel")],y.prototype,"readHeightModel",null),(0,s._)([(0,u.Cb)({type:g.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:g.jsonValues,write:g.write}}}})],y.prototype,"heightUnit",void 0),(0,s._)([(0,h.r)("web-scene","heightUnit")],y.prototype,"readHeightUnit",null),(0,s._)([(0,h.r)("service","heightUnit")],y.prototype,"readHeightUnitService",null),(0,s._)([(0,u.Cb)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],y.prototype,"vertCRS",void 0),(0,s._)([(0,h.r)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],y.prototype,"readVertCRS",null),y=r=(0,s._)([(0,d.j)("esri.geometry.HeightModelInfo")],y);const v=y},74304:(e,t,i)=>{"use strict";i.d(t,{Z:()=>m});var r,s=i(36663),n=i(67134),o=i(81977),a=(i(7283),i(40266)),l=i(39835),c=i(91772),u=i(20031),h=i(53446),d=i(36939);function p(e){return(t,i)=>null==t?i:null==i?t:e(t,i)}let f=r=class extends u.Z{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):function(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(void 0===i.hasZ&&void 0===i.hasM?(i.hasZ=r.length>2,i.hasM=!1):void 0===i.hasZ?i.hasZ=r.length>3:void 0===i.hasM&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new c.Z,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],o=p(Math.min),a=p(Math.max);let l,u,h,d,[f,m]=n,[g,y]=n;for(let t=0,n=e.length;t<n;t++){const n=e[t],[c,p]=n;if(f=o(f,c),m=o(m,p),g=a(g,c),y=a(y,p),i&&n.length>2){const e=n[2];l=o(l,e),h=a(h,e)}if(r&&n.length>s){const e=n[s];u=o(u,e),d=a(d,e)}}return t.xmin=f,t.ymin=m,t.xmax=g,t.ymax=y,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=h):(t.zmin=null,t.zmax=null),r?(t.mmin=u,t.mmax=d):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=(0,n.d9)(this.points)}addPoint(e){return(0,d.l)(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:(0,n.d9)(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new r(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new h.Z(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new h.Z(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?((0,d.l)(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return null!=e&&e>=0&&e<this.points.length}};(0,s._)([(0,o.Cb)({readOnly:!0})],f.prototype,"cache",null),(0,s._)([(0,o.Cb)()],f.prototype,"extent",null),(0,s._)([(0,o.Cb)({type:[[Number]],json:{write:{isRequired:!0}}})],f.prototype,"points",void 0),(0,s._)([(0,l.c)("points")],f.prototype,"writePoints",null),f=r=(0,s._)([(0,a.j)("esri.geometry.Multipoint")],f),f.prototype.toJSON.isDefaultToJSON=!0;const m=f},53446:(e,t,i)=>{"use strict";i.d(t,{Z:()=>w});var r,s=i(36663),n=i(13802),o=i(61681),a=i(81977),l=(i(7753),i(39994),i(69236)),c=i(34248),u=i(40266),h=i(39835),d=i(7283),p=i(20031),f=i(14685),m=i(35925),g=i(39536);const y=[0,0];function _(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}const v=n.Z.getLogger("esri.geometry.Point");let b=r=class extends p.Z{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&"object"==typeof e){if(n=e,e=null!=n.x?n.x:n.longitude,t=null!=n.y?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&"esri.geometry.SpatialReference"!==s.declaredClass&&(s=new f.Z(s)),null!=n.longitude||null!=n.latitude)if(null==n.longitude)v.warn(".longitude=","Latitude was defined without longitude");else if(null==n.latitude)v.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const i=(0,g.hG)(n.longitude,n.latitude,y);e=i[0],t=i[1]}}else _(i)?(s=i,i=null):_(r)&&(s=r,r=null);const o={x:e,y:t};return null==o.x&&null!=o.y?v.warn(".y=","Y coordinate was defined without an X coordinate"):null==o.y&&null!=o.x&&v.warn(".x=","X coordinate was defined without a Y coordinate"),null!=s&&(o.spatialReference=s),null!=i&&(o.z=i),null!=r&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return void 0!==this.m}set hasM(e){e!==(void 0!==this._get("m"))&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return void 0!==this.z}set hasZ(e){e!==(void 0!==this._get("z"))&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return(0,g.R6)(t,i,y)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;t&&(t.isWebMercator?this._set("y",(0,g.hG)(i,e,y)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return(0,g.R6)(e,t,y)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;i&&(i.isWebMercator?this._set("x",(0,g.hG)(e,t,y)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return"string"==typeof e?NaN:e}clone(){const e=new r;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return r.copy(e,this),this}equals(e){if((0,o.Wi)(e))return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:a,m:l}=e;let{x:c,y:u,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[c,u]=(0,g.hG)(c,u),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[c,u]=(0,g.R6)(c,u),h=n}return t===c&&i===u&&r===a&&s===l&&n.wkid===h.wkid}offset(e,t,i){return function(e,t,i,r){return e.x=e.x+t,e.y=e.y+i,null!=r&&(e.z=(e.z??0)+r),e}(this,e,t,i)}normalize(){if(!this.spatialReference)return this;const e=(0,m.C5)(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return function(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};(0,s._)([(0,a.Cb)({readOnly:!0})],b.prototype,"cache",null),(0,s._)([(0,a.Cb)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],b.prototype,"hasM",null),(0,s._)([(0,a.Cb)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],b.prototype,"hasZ",null),(0,s._)([(0,a.Cb)({type:Number})],b.prototype,"latitude",null),(0,s._)([(0,a.Cb)({type:Number})],b.prototype,"longitude",null),(0,s._)([(0,a.Cb)({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),(0,l.p)((e=>isNaN(e)?e:(0,d.q9)(e)))],b.prototype,"x",void 0),(0,s._)([(0,h.c)("x")],b.prototype,"writeX",null),(0,s._)([(0,c.r)("x")],b.prototype,"readX",null),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],b.prototype,"y",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],b.prototype,"z",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],b.prototype,"m",void 0),b=r=(0,s._)([(0,u.j)("esri.geometry.Point")],b),b.prototype.toJSON.isDefaultToJSON=!0;const w=b},89542:(e,t,i)=>{"use strict";i.d(t,{Z:()=>T});var r,s=i(36663),n=i(7753),o=i(67134),a=i(61681),l=i(81977),c=(i(7283),i(40266)),u=i(39835),h=i(91772),d=i(20031),p=i(53446),f=i(14685),m=i(18449),g=i(27127),y=i(38028),_=i(50842),v=i(68668),b=i(39536),w=i(36939);function x(e){return!Array.isArray(e[0])}let C=r=class extends d.Z{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let s=!1,n=!1;for(const e of t)e.hasZ&&(s=!0),e.hasM&&(n=!0);const o={rings:t.map((e=>{const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(s&&e.hasZ){const i=e.zmin+.5*(e.zmax-e.zmin);for(let e=0;e<t.length;e++)t[e].push(i)}if(n&&e.hasM){const i=e.mmin+.5*(e.mmax-e.mmin);for(let e=0;e<t.length;e++)t[e].push(i)}return t})),spatialReference:i};return s&&(o.hasZ=!0),n&&(o.hasM=!0),new r(o)}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||f.Z.WGS84,s.length&&s[0]&&null!=s[0][0]&&"number"==typeof s[0][0]&&(s=[s]),n=s[0]&&s[0][0],n&&(void 0===i&&void 0===r?(i=n.length>2,r=n.length>3):void 0===i?i=r?n.length>3:n.length>2:void 0===r&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=(0,m.tO)(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new p.Z;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=(0,_._w)(this);if(!t)return null;const i=new h.Z(t);return i.spatialReference=e,i}get isSelfIntersecting(){return(0,v.Ff)(this.rings)}writeRings(e,t){t.rings=(0,o.d9)(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(x(e)){const r=[];for(let t=0,i=e.length;t<i;t++)r[t]=e[t].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new r;return e.spatialReference=this.spatialReference,e.rings=(0,o.d9)(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if((0,a.Wi)(e))return!1;const t=this.spatialReference,i=e.spatialReference;if((0,a.pC)(t)!==(0,a.pC)(i))return!1;if((0,a.pC)(t)&&(0,a.pC)(i)&&!t.equals(i))return!1;if(this.rings.length!==e.rings.length)return!1;const r=([e,t,i,r],[s,n,o,a])=>e===s&&t===n&&(null==i&&null==o||i===o)&&(null==r&&null==a||r===a);for(let t=0;t<this.rings.length;t++){const i=this.rings[t],s=e.rings[t];if(!(0,n.fS)(i,s,r))return!1}return!0}contains(e){if(!e)return!1;const t=(0,b.iV)(e,this.spatialReference);return(0,g.CI)(this,(0,a.pC)(t)?t:e)}isClockwise(e){let t;return t=x(e)?e.map((e=>this.hasZ?this.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])):e,(0,y.bu)(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new p.Z(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new p.Z(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new p.Z(i[0],i[1],i[2],i[3],this.spatialReference):new p.Z(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?((0,w.l)(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new p.Z(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map((e=>new p.Z(e,i)));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?((0,w.l)(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(null==e||e<0||e>=this.rings.length)return!1;if(null!=t){const r=this.rings[e];if(i&&(t<0||t>r.length))return!1;if(!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};(0,s._)([(0,l.Cb)({readOnly:!0})],C.prototype,"cache",null),(0,s._)([(0,l.Cb)({readOnly:!0})],C.prototype,"centroid",null),(0,s._)([(0,l.Cb)({readOnly:!0})],C.prototype,"extent",null),(0,s._)([(0,l.Cb)({readOnly:!0})],C.prototype,"isSelfIntersecting",null),(0,s._)([(0,l.Cb)({type:[[[Number]]],json:{write:{isRequired:!0}}})],C.prototype,"rings",void 0),(0,s._)([(0,u.c)("rings")],C.prototype,"writeRings",null),C=r=(0,s._)([(0,c.j)("esri.geometry.Polygon")],C),C.prototype.toJSON.isDefaultToJSON=!0;const T=C},90819:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r,s=i(36663),n=i(67134),o=i(81977),a=(i(7283),i(40266)),l=i(39835),c=i(91772),u=i(20031),h=i(53446),d=i(14685),p=i(50842),f=i(36939);let m=r=class extends u.Z{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||d.Z.WGS84,s.length&&s[0]&&null!=s[0][0]&&"number"==typeof s[0][0]&&(s=[s]),n=s[0]&&s[0][0],n&&(void 0===i&&void 0===r?(i=n.length>2,r=!1):void 0===i?i=!r&&n.length>3:void 0===r&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=(0,p.Wn)(this);if(!t)return null;const i=new c.Z(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=(0,n.d9)(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(function(e){return!Array.isArray(e[0])}(e)){const r=[];for(let t=0,i=e.length;t<i;t++)r[t]=e[t].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new r;return e.spatialReference=this.spatialReference,e.paths=(0,n.d9)(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new h.Z(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new h.Z(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new h.Z(i[0],i[1],i[2],i[3],this.spatialReference):new h.Z(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?((0,f.l)(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map((e=>new h.Z(e,i)));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new h.Z(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?((0,f.l)(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(null==e||e<0||e>=this.paths.length)return!1;if(null!=t){const r=this.paths[e];if(i&&(t<0||t>r.length))return!1;if(!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};(0,s._)([(0,o.Cb)({readOnly:!0})],m.prototype,"cache",null),(0,s._)([(0,o.Cb)({readOnly:!0})],m.prototype,"extent",null),(0,s._)([(0,o.Cb)({type:[[[Number]]],json:{write:{isRequired:!0}}})],m.prototype,"paths",void 0),(0,s._)([(0,l.c)("paths")],m.prototype,"writePaths",null),m=r=(0,s._)([(0,a.j)("esri.geometry.Polyline")],m),m.prototype.toJSON.isDefaultToJSON=!0;const g=m},14685:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r,s=i(36663),n=i(82064),o=i(67134),a=i(7283),l=i(81977),c=i(40266),u=i(39835),h=i(35925);let d=r=class extends n.wq{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(102100===e.wkid)return r.WebMercator;if(4326===e.wkid)return r.WGS84}const t=new r;return t.read(e),t}normalizeCtorArgs(e){return e&&"object"==typeof e?e:{["string"==typeof e?"wkt":"wkid"]:e}}get isWGS84(){return(0,h.oR)(this)}get isWebMercator(){return(0,h.sS)(this)}get isGeographic(){return(0,h.sT)(this)}get isWrappable(){return(0,h.MP)(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===r.WGS84)return r.WGS84;if(this===r.WebMercator)return r.WebMercator;const e=new r;return null!=this.wkid?(e.wkid=this.wkid,null!=this.latestWkid&&(e.latestWkid=this.latestWkid),null!=this.vcsWkid&&(e.vcsWkid=this.vcsWkid),null!=this.latestVcsWkid&&(e.latestVcsWkid=this.latestVcsWkid)):null!=this.wkt&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=(0,o.d9)(this.imageCoordinateSystem)),e}equals(e){if(null==e)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(null==this.imageCoordinateSystem||null==e.imageCoordinateSystem)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return null==t||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return(0,h.fS)(this,e)}toJSON(e){return this.write(void 0,e)}};d.GCS_NAD_1927=null,d.WGS84=null,d.WebMercator=null,d.PlateCarree=null,(0,s._)([(0,l.Cb)({readOnly:!0})],d.prototype,"isWGS84",null),(0,s._)([(0,l.Cb)({readOnly:!0})],d.prototype,"isWebMercator",null),(0,s._)([(0,l.Cb)({readOnly:!0})],d.prototype,"isGeographic",null),(0,s._)([(0,l.Cb)({readOnly:!0})],d.prototype,"isWrappable",null),(0,s._)([(0,l.Cb)({type:a.z8,json:{write:!0}})],d.prototype,"latestWkid",void 0),(0,s._)([(0,l.Cb)({type:a.z8,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null===this.wkt}}}}}}})],d.prototype,"wkid",void 0),(0,s._)([(0,l.Cb)({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null===this.wkid}}}}}}})],d.prototype,"wkt",void 0),(0,s._)([(0,u.c)("wkt"),(0,u.c)("web-scene","wkt")],d.prototype,"writeWkt",null),(0,s._)([(0,l.Cb)({type:a.z8,json:{write:!0}})],d.prototype,"vcsWkid",void 0),(0,s._)([(0,l.Cb)({type:a.z8,json:{write:!0}})],d.prototype,"latestVcsWkid",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"imageCoordinateSystem",void 0),d=r=(0,s._)([(0,c.j)("esri.geometry.SpatialReference")],d),d.prototype.toJSON.isDefaultToJSON=!0,d.GCS_NAD_1927=new d({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),d.WGS84=new d(h.Zn),d.WebMercator=new d(h.R_),d.PlateCarree=new d(h.WR),Object.freeze&&(Object.freeze(d.GCS_NAD_1927),Object.freeze(d.WGS84),Object.freeze(d.WebMercator));const p=d},90472:(e,t,i)=>{"use strict";i.d(t,{Bm:()=>ue,CM:()=>re,KC:()=>K,MT:()=>J,PR:()=>Pe,Qr:()=>se,Rg:()=>Q,SH:()=>ee,UY:()=>te,Up:()=>H,Wt:()=>$,X4:()=>ce,YD:()=>G,dH:()=>le,dz:()=>F,fA:()=>X,fM:()=>B,fi:()=>W,gH:()=>_e,iQ:()=>j,iV:()=>D,jF:()=>Se,kR:()=>I,ke:()=>ie,nF:()=>Z,oj:()=>N,rS:()=>k,st:()=>oe,yH:()=>de,zD:()=>L,zP:()=>Ee});var r=i(70375),s=i(19431),n=i(61681),o=i(78668),a=i(17321),l=i(55860),c=i(26096),u=i(24455),h=i(6766),d=i(8909),p=i(91772),f=i(74304),m=i(96926),g=i(53446),y=i(89542),_=i(90819),v=i(25726),b=i(24568),w=i(14260),x=i(36285),C=i(44924),T=i(35925),S=i(52345),E=i(95247);let A=null,M=null,O=null,R={};const P=new c.s;function I(){return!!A&&(0,m.i)()}function L(e){return(0,n.Wi)(O)&&(O=Promise.all([(0,m.l)(),i.e(9067).then(i.bind(i,89067)).then((e=>e.g)),i.e(8427).then(i.bind(i,48427))])),O.then((([,t,{hydratedAdapter:i}])=>{(0,o.k_)(e),M=i,A=t.default,A._enableProjection(m.p),P.notify()}))}function D(e,t,i=null,r=null){return Array.isArray(e)?0===e.length?[]:N(M,e,e[0].spatialReference,t,i,r):N(M,[e],e.spatialReference,t,i,r)[0]}function N(e,t,i,r,s=null,o=null){if((0,n.Wi)(i)||(0,n.Wi)(r))return t;if(H(i,r,s))return t.map((e=>(0,n.Wg)(W(e,i,r))));if((0,n.Wi)(s)){const e=C.Z.cacheKey(i,r);void 0!==R[e]?s=R[e]:(s=k(i,r,null),(0,n.Wi)(s)&&(s=new C.Z),R[e]=s)}if((0,n.Wi)(A))throw new U;return(0,n.pC)(o)?A._project(e,t,i,r,s,o):A._project(e,t,i,r,s)}function F(e,t){return(0,n.Wi)(e)?{pending:null,geometry:null}:(0,T.fS)(e.spatialReference,t)?{pending:null,geometry:e}:(0,T.JY)(e.spatialReference)&&(0,T.JY)(t)?H(e.spatialReference,t)||I()?{pending:null,geometry:B(e,t)}:((0,l.it)(P),{pending:L(),geometry:null}):{pending:null,geometry:null}}function k(e,t,i=null){if((0,n.Wi)(A))throw new U;if((0,n.Wi)(e)||(0,n.Wi)(t))return null;const r=A._getTransformation(M,e,t,i,i?.spatialReference);return null!==r?C.Z.fromGE(r):null}class U extends r.Z{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var V,z;function B(e,t){try{const i=D(e,t);if(null==i)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=(0,E.k)(i.type,e.spatialReference,t);return(0,n.pC)(r)&&r(i),i}catch(e){if(!(e instanceof U))throw e;return null}}function H(e,t,i){return!i&&(!!(0,T.fS)(e,t)||(0,T.JY)(e)&&(0,T.JY)(t)&&!!He(e,t,qe))}async function j(e,t,i,r){if(I())return(0,o.Yn)(r);if(Array.isArray(e)){for(const{source:t,dest:i,geographicTransformation:s}of e)if(!H(t,i,s))return L(r)}else if(!H(e,t,i))return L(r);return(0,o.Yn)(r)}function G(e,t){switch(He(e,t,qe)){case fe:return"copy3";case Re:return"wgs84ToSphericalECEF";case ve:return"wgs84ToWebMercator";case xe:return"wgs84ToPlateCarree";case ke:return"wgs84ToWGS84ECEF";case me:return"webMercatorToWGS84";case ge:return"webMercatorToSphericalECEF";case ye:return"webMercatorToWGS84ECEF";case Te:return"webMercatorToPlateCarree";case Ue:return"wgs84ECEFToWGS84";case Ve:return"wgs84ECEFToSphericalECEF";case ze:return"wgs84ECEFToWebMercator";case De:return"sphericalECEFToWGS84";case Ne:return"sphericalECEFToWebMercator";case Le:return"sphericalMarsPCPFToMars2000";case Ie:return"sphericalMoonPCPFToMoon2000";case Fe:return"sphericalECEFToWGS84ECEF";case Oe:return"mars2000ToSphericalPCPF";case Me:return"moon2000ToSphericalPCPF";default:return null}}function W(e,t,i){return e?"x"in e?q(e,t,new g.Z,i,0):"xmin"in e?function(e,t,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=e;return Q(n,o,c?e.zmin:s,t,et,r)?(i.xmin=et[0],i.ymin=et[1],c&&(i.zmin=et[2]),Q(a,l,c?e.zmax:s,t,et,r)?(i.xmax=et[0],i.ymax=et[1],c&&(i.zmax=et[2]),u&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null):null}(e,t,new p.Z,i,0):"rings"in e?Y(e,t,new y.Z,i,0):"paths"in e?function(e,t,i,r,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return ne(n,o,a,t,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}(e,t,new _.Z,i,0):"points"in e?function(e,t,i,r,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,u=[];for(const e of n)u.push(e[0],e[1],o?e[2]:s);if(!re(u,t,0,u,r,0,c))return null;for(let e=0;e<c;++e){const t=3*e,i=u[t],r=u[t+1];o&&a?l.push([i,r,u[t+2],n[e][3]]):o?l.push([i,r,u[t+2]]):a?l.push([i,r,n[e][2]]):l.push([i,r])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}(e,t,new f.Z,i,0):null:null}function Z(e,t,i=t.spatialReference,r=0){return!(0,n.Wi)(i)&&(0,n.pC)(q(e,e.spatialReference,t,i,r))}function q(e,t,i,r,s){et[0]=e.x,et[1]=e.y;const n=e.z;return et[2]=void 0!==n?n:s,re(et,t,0,et,r,0,1)?(i.x=et[0],i.y=et[1],i.spatialReference=r,void 0===n?(i.z=void 0,i.hasZ=!1):(i.z=et[2],i.hasZ=!0),void 0===e.m?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function $(e,t,i=t.spatialReference,r=0){return(0,n.pC)(i)&&(0,n.pC)(Y(e,e.spatialReference,t,i,r))}function Y(e,t,i,r,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return ne(n,o,a,t,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function X(e,t,i){if((0,n.Wi)(t)||(0,n.Wi)(i))return null;const r=new g.Z({spatialReference:i});return re(e,t,0,et,i,0,1)?(r.x=et[0],r.y=et[1],r.z=et[2],r):null}function J(e,t,i){return re(e,t,0,et,i.spatialReference,0,1)?(i.x=et[0],i.y=et[1],i.z=et[2],i):null}function K(e,t,i,r=0){et[0]=e.x,et[1]=e.y;const s=e.z;return et[2]=void 0!==s?s:r,re(et,e.spatialReference,0,t,i,0,1)}function Q(e,t,i,r,s,n){return Je[0]=e,Je[1]=t,Je[2]=i,re(Je,r,0,s,n,0,1)}function ee(e,t,i,r){return!((0,n.Wi)(t)||(0,n.Wi)(r)||e.length<2)&&(2===e.length&&(Je[0]=e[0],Je[1]=e[1],Je[2]=0,e=Je),re(e,t,0,i,r,0,1))}function te(e,t){et[0]=e.x,et[1]=e.y;const i=e.z;return et[2]=void 0!==i?i:0,ie(et,e.spatialReference,t)}function ie(e,t,i){return function(e,t,i){if((0,n.Wi)(t))return!1;const r=pe(t,We),s=Be[r][V.WGS84_COMPARABLE_LON_LAT];return!(0,n.Wi)(s)&&(s(e,0,Je,0),i!==Je&&(i[0]=Je[0],i[1]=Je[1],i.length>2&&(i[2]=Je[2])),!0)}(e,t,i)}function re(e,t,i,r,s,o,a=1){const l=He(t,s,qe);if((0,n.Wi)(l))return!1;if(l===fe){if(e===r&&i===o)return!0;const t=i+3*a;for(let s=i,n=o;s<t;s++,n++)r[n]=e[s];return!0}const c=i+3*a;for(let t=i,s=o;t<c;t+=3,s+=3)l(e,t,r,s);return!0}function se(e,t,i,r,s){(0,h.c)(et,e),(0,h.a)(tt,e,t),ee(et,i,et,s),ee(tt,i,tt,s),(0,h.b)(r,tt,et),(0,h.n)(r,r)}function ne(e,t,i,r,s,n,o=0){const a=new Array;for(const i of e)for(const e of i)a.push(e[0],e[1],t?e[2]:o);if(!re(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const r of e){const e=new Array;for(const s of r)t&&i?e.push([a[l++],a[l++],a[l++],s[3]]):t?e.push([a[l++],a[l++],a[l++]]):i?(e.push([a[l++],a[l++],s[2]]),l++):(e.push([a[l++],a[l++]]),l++);s.push(e)}return!0}function oe(e,t,i,r){if((0,n.Wi)(t)||(0,n.Wi)(r))return!1;const s=je(t,r,$e);if(s.projector===fe)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;if((0,n.Wi)(s.projector))return!1;const{source:o,dest:a}=s;if(a.spatialReferenceId===V.WEB_MERCATOR){const t=Be[o.spatialReferenceId][V.WGS84];return!(0,n.Wi)(t)&&(t(e,0,Ke,0),ve(Ke,0,i,0),i[3]=ae(Ke[1],e[2],e[3],w.sv.radius),!0)}if(o.spatialReferenceId!==V.WGS84&&o.spatialReferenceId!==V.CGCS2000||a.spatialReferenceId!==V.PLATE_CARREE)s.projector(e,0,i,0),i[3]=e[3]*o.metersPerUnit/a.metersPerUnit;else{const t=Be[o.spatialReferenceId][V.SPHERICAL_ECEF],r=Be[V.SPHERICAL_ECEF][V.PLATE_CARREE];let a=e[3];(0,n.pC)(t)&&(0,n.pC)(r)&&(a=ae(e[1],e[2],e[3],w.sv.radius)),s.projector(e,0,i,0),i[3]=a}return!0}function ae(e,t,i,r){const s=r+t;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(Ye*e)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function le(e,t,i,r){return!(null==e||((0,T.fS)(t,r)?((0,b.JG)(i,e),0):(Je[0]=e[0],Je[1]=e[1],Je[2]=0,!re(Je,t,0,Je,r,0,1)||(i[0]=Je[0],i[1]=Je[1],Je[0]=e[2],Je[1]=e[3],Je[2]=0,!re(Je,t,0,Je,r,0,1)||(i[2]=Je[0],i[3]=Je[1],0)))))}function ce(e,t,i,r){if((0,n.Wi)(t)||(0,n.Wi)(r))return!1;const s=pe(t,We),o=pe(r,Ze);if(s===o&&s!==V.UNKNOWN||(0,T.fS)(t,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===V.SPHERICAL_ECEF){const t=(0,h.l)(e),r=t/Math.sqrt(e[0]*e[0]+e[1]*e[1]),s=t/w.sv.radius;if(o===V.WEB_MERCATOR)return i[0]=r*s,i[1]=r*s,i[2]=1,!0;if(o===V.WGS84||o===V.CGCS2000){const e=we;return i[0]=e*r*s,i[1]=e*s,i[2]=1,!0}}else if(s===V.PLATE_CARREE){if(o===V.WGS84||o===V.CGCS2000)return i[0]=we,i[1]=we,i[2]=1,!0;if(o===V.WEB_MERCATOR){const t=e[1]/w.sv.radius;return i[0]=1,i[1]=1/Math.cos(t),i[2]=1,!0}}return!1}function ue(e,t,i,r){if((0,n.Wi)(e)||(0,n.Wi)(r))return!1;const s=pe(e,We),o=pe(r,Ze);if(s===o&&!he(o)&&(s!==V.UNKNOWN||(0,T.fS)(e,r)))return(0,u.f)(i,t),!0;if(he(o)){const e=Be[s][V.LON_LAT],r=Be[V.LON_LAT][o];return!(0,n.Wi)(e)&&!(0,n.Wi)(r)&&(e(t,0,Ke,0),r(Ke,0,Qe,0),de(Ye*Ke[0],Ye*Ke[1],i),i[12]=Qe[0],i[13]=Qe[1],i[14]=Qe[2],!0)}if((o===V.WEB_MERCATOR||o===V.PLATE_CARREE)&&(s===V.WGS84||s===V.CGCS2000&&o===V.PLATE_CARREE||s===V.SPHERICAL_ECEF||s===V.WEB_MERCATOR)){const e=Be[s][V.LON_LAT],r=Be[V.LON_LAT][o];return!(0,n.Wi)(e)&&!(0,n.Wi)(r)&&(e(t,0,Ke,0),r(Ke,0,Qe,0),s===V.SPHERICAL_ECEF?function(e,t,i){de(e,t,i),(0,u.t)(i,i)}(Ye*Ke[0],Ye*Ke[1],i):(0,u.i)(i),i[12]=Qe[0],i[13]=Qe[1],i[14]=Qe[2],!0)}return!1}function he(e){return e===V.SPHERICAL_ECEF||e===V.SPHERICAL_MARS_PCPF||e===V.SPHERICAL_MOON_PCPF}function de(e,t,i){const r=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function pe(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=(0,a.c9)(e,1)),e.wkt===v.GG.wkt?t.spatialReferenceId=V.SPHERICAL_ECEF:(0,T.oR)(e)?t.spatialReferenceId=V.WGS84:(0,T.sS)(e)?t.spatialReferenceId=V.WEB_MERCATOR:(0,T.QM)(e)?t.spatialReferenceId=V.PLATE_CARREE:e.wkt===v.wY.wkt?t.spatialReferenceId=V.WGS84_ECEF:e.wkid===S.W.CGCS2000?t.spatialReferenceId=V.CGCS2000:e.wkt===v.HQ.wkt?t.spatialReferenceId=V.SPHERICAL_MARS_PCPF:e.wkt===v.VY.wkt?t.spatialReferenceId=V.SPHERICAL_MOON_PCPF:(0,T.BZ)(e)?t.spatialReferenceId=V.GCSMARS2000:(0,T.V2)(e)?t.spatialReferenceId=V.GCSMOON2000:t.spatialReferenceId=V.UNKNOWN)}function fe(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function me(e,t,i,r){i[r++]=Xe*(e[t++]/w.sv.radius),i[r++]=Xe*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/w.sv.radius))),i[r]=e[t]}function ge(e,t,i,r){me(e,t,i,r),Re(i,r,i,r)}function ye(e,t,i,r){me(e,t,i,r),ke(i,r,i,r)}function _e(e,t,i,r,n){const o=.4999999*Math.PI,a=(0,s.uZ)(Ye*e[t+1],-o,o),l=Math.sin(a);i[r++]=Ye*e[t]*n.radius,i[r++]=n.halfSemiMajorAxis*Math.log((1+l)/(1-l)),i[r]=e[t+2]}function ve(e,t,i,r){_e(e,t,i,r,w.sv)}(z=V||(V={}))[z.UNKNOWN=0]="UNKNOWN",z[z.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",z[z.WGS84=2]="WGS84",z[z.WEB_MERCATOR=3]="WEB_MERCATOR",z[z.WGS84_ECEF=4]="WGS84_ECEF",z[z.CGCS2000=5]="CGCS2000",z[z.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",z[z.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",z[z.GCSMARS2000=8]="GCSMARS2000",z[z.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",z[z.GCSMOON2000=10]="GCSMOON2000",z[z.LON_LAT=11]="LON_LAT",z[z.PLATE_CARREE=12]="PLATE_CARREE";const be=w.sv.radius*Math.PI/180,we=180/(w.sv.radius*Math.PI);function xe(e,t,i,r){i[r]=e[t]*be,i[r+1]=e[t+1]*be,i[r+2]=e[t+2]}function Ce(e,t,i,r){i[r]=e[t]*we,i[r+1]=e[t+1]*we,i[r+2]=e[t+2]}function Te(e,t,i,r){me(e,t,i,r),xe(i,r,i,r)}function Se(e){if((0,n.Wi)(e))return!1;const t=pe(e,We);return!!Be[t][V.WGS84_COMPARABLE_LON_LAT]}function Ee(e,t,i,r){const s=Math.cos(i);e[0]=Math.cos(t)*s*r,e[1]=Math.sin(t)*s*r,e[2]=Math.sin(i)*r}function Ae(e,t,i,r,s){const n=s+e[t+2],o=Ye*e[t+1],a=Ye*e[t],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function Me(e,t,i,r){Ae(e,t,i,r,w.Z1.radius)}function Oe(e,t,i,r){Ae(e,t,i,r,w.yr.radius)}function Re(e,t,i,r){Ae(e,t,i,r,w.sv.radius)}function Pe(e,t,i,r,n){const o=e[t],a=e[t+1],l=e[t+2],c=Math.sqrt(o*o+a*a+l*l),u=(0,s.Kt)(l/(0===c?1:c)),h=Math.atan2(a,o);i[r++]=Xe*h,i[r++]=Xe*u,i[r]=c-n}function Ie(e,t,i,r){Pe(e,t,i,r,w.Z1.radius)}function Le(e,t,i,r){Pe(e,t,i,r,w.yr.radius)}function De(e,t,i,r){Pe(e,t,i,r,w.sv.radius)}function Ne(e,t,i,r){De(e,t,i,r),ve(i,r,i,r)}function Fe(e,t,i,r){De(e,t,i,r),ke(i,r,i,r)}function ke(e,t,i,r){!function(e,t,i,r,s){const n=Ye*e[t],o=Ye*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),u=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(u+a)*c*Math.cos(n),i[r++]=(u+a)*c*Math.sin(n),i[r++]=(u*(1-s.eccentricitySquared)+a)*l}(e,t,i,r,w.sv)}function Ue(e,t,i,r){const s=x.cD,n=e[t],o=e[t+1],a=e[t+2];let l,c,u,h,d,p,f,m,g,y,_,v,b,C,T,S,E,A,M,O,R;l=Math.abs(a),c=n*n+o*o,u=Math.sqrt(c),h=c+a*a,d=Math.sqrt(h),O=Math.atan2(o,n),p=a*a/h,f=c/h,C=s.a2/d,T=s.a3-s.a4/d,f>.3?(m=l/d*(1+f*(s.a1+C+p*T)/d),M=Math.asin(m),y=m*m,g=Math.sqrt(1-y)):(g=u/d*(1-p*(s.a5-C-f*T)/d),M=Math.acos(g),y=1-g*g,m=Math.sqrt(y)),_=1-w.sv.eccentricitySquared*y,v=w.sv.radius/Math.sqrt(_),b=s.a6*v,C=u-v*g,T=l-b*m,E=g*C+m*T,S=g*T-m*C,A=S/(b/_+E),M+=A,R=E+S*A/2,a<0&&(M=-M),i[r++]=Xe*O,i[r++]=Xe*M,i[r]=R}function Ve(e,t,i,r){Ue(e,t,i,r),Re(i,r,i,r)}function ze(e,t,i,r){Ue(e,t,i,r),ve(i,r,i,r)}const Be={[V.WGS84]:{[V.CGCS2000]:null,[V.GCSMARS2000]:null,[V.GCSMOON2000]:null,[V.LON_LAT]:fe,[V.WGS84_COMPARABLE_LON_LAT]:fe,[V.SPHERICAL_ECEF]:Re,[V.SPHERICAL_MARS_PCPF]:null,[V.SPHERICAL_MOON_PCPF]:null,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:ve,[V.PLATE_CARREE]:xe,[V.WGS84]:fe,[V.WGS84_ECEF]:ke},[V.CGCS2000]:{[V.CGCS2000]:fe,[V.GCSMARS2000]:null,[V.GCSMOON2000]:null,[V.LON_LAT]:fe,[V.WGS84_COMPARABLE_LON_LAT]:fe,[V.SPHERICAL_ECEF]:Re,[V.SPHERICAL_MARS_PCPF]:null,[V.SPHERICAL_MOON_PCPF]:null,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:null,[V.PLATE_CARREE]:xe,[V.WGS84]:null,[V.WGS84_ECEF]:ke},[V.GCSMARS2000]:{[V.CGCS2000]:null,[V.GCSMARS2000]:fe,[V.GCSMOON2000]:null,[V.LON_LAT]:fe,[V.WGS84_COMPARABLE_LON_LAT]:null,[V.SPHERICAL_ECEF]:null,[V.SPHERICAL_MARS_PCPF]:Oe,[V.SPHERICAL_MOON_PCPF]:null,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:null,[V.PLATE_CARREE]:null,[V.WGS84]:null,[V.WGS84_ECEF]:null},[V.GCSMOON2000]:{[V.CGCS2000]:null,[V.GCSMARS2000]:null,[V.GCSMOON2000]:fe,[V.LON_LAT]:fe,[V.WGS84_COMPARABLE_LON_LAT]:null,[V.SPHERICAL_ECEF]:null,[V.SPHERICAL_MARS_PCPF]:null,[V.SPHERICAL_MOON_PCPF]:Me,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:null,[V.PLATE_CARREE]:null,[V.WGS84]:null,[V.WGS84_ECEF]:null},[V.WEB_MERCATOR]:{[V.CGCS2000]:null,[V.GCSMARS2000]:null,[V.GCSMOON2000]:null,[V.LON_LAT]:me,[V.WGS84_COMPARABLE_LON_LAT]:me,[V.SPHERICAL_ECEF]:ge,[V.SPHERICAL_MARS_PCPF]:null,[V.SPHERICAL_MOON_PCPF]:null,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:fe,[V.PLATE_CARREE]:Te,[V.WGS84]:me,[V.WGS84_ECEF]:ye},[V.WGS84_ECEF]:{[V.CGCS2000]:Ue,[V.GCSMARS2000]:null,[V.GCSMOON2000]:null,[V.LON_LAT]:Ue,[V.WGS84_COMPARABLE_LON_LAT]:Ue,[V.SPHERICAL_ECEF]:Ve,[V.SPHERICAL_MARS_PCPF]:null,[V.SPHERICAL_MOON_PCPF]:null,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:ze,[V.PLATE_CARREE]:function(e,t,i,r){Ue(e,t,i,r),xe(i,r,i,r)},[V.WGS84]:Ue,[V.WGS84_ECEF]:fe},[V.SPHERICAL_ECEF]:{[V.CGCS2000]:De,[V.GCSMARS2000]:null,[V.GCSMOON2000]:null,[V.LON_LAT]:De,[V.WGS84_COMPARABLE_LON_LAT]:De,[V.SPHERICAL_ECEF]:fe,[V.SPHERICAL_MARS_PCPF]:null,[V.SPHERICAL_MOON_PCPF]:null,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:Ne,[V.PLATE_CARREE]:function(e,t,i,r){De(e,t,i,r),xe(i,r,i,r)},[V.WGS84]:De,[V.WGS84_ECEF]:Fe},[V.SPHERICAL_MARS_PCPF]:{[V.CGCS2000]:null,[V.GCSMARS2000]:Le,[V.GCSMOON2000]:null,[V.LON_LAT]:Le,[V.WGS84_COMPARABLE_LON_LAT]:null,[V.SPHERICAL_ECEF]:null,[V.SPHERICAL_MARS_PCPF]:fe,[V.SPHERICAL_MOON_PCPF]:null,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:null,[V.PLATE_CARREE]:null,[V.WGS84]:null,[V.WGS84_ECEF]:null},[V.SPHERICAL_MOON_PCPF]:{[V.CGCS2000]:null,[V.GCSMARS2000]:null,[V.GCSMOON2000]:Ie,[V.LON_LAT]:Ie,[V.WGS84_COMPARABLE_LON_LAT]:null,[V.SPHERICAL_ECEF]:null,[V.SPHERICAL_MARS_PCPF]:null,[V.SPHERICAL_MOON_PCPF]:fe,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:null,[V.PLATE_CARREE]:null,[V.WGS84]:null,[V.WGS84_ECEF]:null},[V.UNKNOWN]:{[V.CGCS2000]:null,[V.GCSMARS2000]:null,[V.GCSMOON2000]:null,[V.LON_LAT]:null,[V.WGS84_COMPARABLE_LON_LAT]:null,[V.SPHERICAL_ECEF]:null,[V.SPHERICAL_MARS_PCPF]:null,[V.SPHERICAL_MOON_PCPF]:null,[V.UNKNOWN]:fe,[V.WEB_MERCATOR]:null,[V.PLATE_CARREE]:null,[V.WGS84]:null,[V.WGS84_ECEF]:null},[V.LON_LAT]:{[V.CGCS2000]:fe,[V.GCSMARS2000]:fe,[V.GCSMOON2000]:fe,[V.LON_LAT]:fe,[V.WGS84_COMPARABLE_LON_LAT]:fe,[V.SPHERICAL_ECEF]:Re,[V.SPHERICAL_MARS_PCPF]:Oe,[V.SPHERICAL_MOON_PCPF]:Me,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:ve,[V.PLATE_CARREE]:xe,[V.WGS84]:fe,[V.WGS84_ECEF]:ke},[V.WGS84_COMPARABLE_LON_LAT]:{[V.CGCS2000]:null,[V.GCSMARS2000]:null,[V.GCSMOON2000]:null,[V.LON_LAT]:fe,[V.WGS84_COMPARABLE_LON_LAT]:fe,[V.SPHERICAL_ECEF]:Re,[V.SPHERICAL_MARS_PCPF]:null,[V.SPHERICAL_MOON_PCPF]:null,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:null,[V.PLATE_CARREE]:xe,[V.WGS84]:fe,[V.WGS84_ECEF]:ke},[V.PLATE_CARREE]:{[V.CGCS2000]:Ce,[V.GCSMARS2000]:null,[V.GCSMOON2000]:null,[V.LON_LAT]:Ce,[V.WGS84_COMPARABLE_LON_LAT]:Ce,[V.SPHERICAL_ECEF]:function(e,t,i,r){Ce(e,t,i,r),Re(i,r,i,r)},[V.SPHERICAL_MARS_PCPF]:null,[V.SPHERICAL_MOON_PCPF]:null,[V.UNKNOWN]:null,[V.WEB_MERCATOR]:function(e,t,i,r){Ce(e,t,i,r),ve(i,r,i,r)},[V.PLATE_CARREE]:fe,[V.WGS84]:Ce,[V.WGS84_ECEF]:function(e,t,i,r){Ce(e,t,i,r),ke(i,r,i,r)}}};function He(e,t,i=Ge()){return(0,n.Wi)(e)||(0,n.Wi)(t)?null:je(e,t,i).projector}function je(e,t,i){if((0,n.Wi)(e)||(0,n.Wi)(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=pe(e,i.source),s=pe(t,i.dest);return r===V.UNKNOWN&&s===V.UNKNOWN?(0,T.fS)(e,t)?i.projector=fe:i.projector=null:i.projector=Be[r][s],i}function Ge(){return{source:{spatialReference:null,spatialReferenceId:V.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:V.UNKNOWN,metersPerUnit:1},projector:fe}}const We={spatialReference:null,spatialReferenceId:V.UNKNOWN},Ze={spatialReference:null,spatialReferenceId:V.UNKNOWN},qe=Ge(),$e=Ge(),Ye=(0,s.Vl)(1),Xe=(0,s.BV)(1),Je=(0,d.c)(),Ke=(0,d.c)(),Qe=(0,d.c)(),et=(0,d.c)(),tt=(0,d.c)()},25726:(e,t,i)=>{"use strict";i.d(t,{GG:()=>a,HQ:()=>l,Iu:()=>d,VY:()=>c,e8:()=>p,rS:()=>h,wY:()=>u});var r=i(14685),s=i(14260),n=i(35925);function o(e){return new r.Z({wkt:`GEOCCS["Spherical geocentric",\n    DATUM["Not specified",\n      SPHEROID["Sphere",${e.radius},0]],\n    PRIMEM["Greenwich",0.0,\n      AUTHORITY["EPSG","8901"]],\n    UNIT["m",1.0],\n    AXIS["Geocentric X",OTHER],\n    AXIS["Geocentric Y",EAST],\n    AXIS["Geocentric Z",NORTH]\n  ]`})}const a=o(s.sv),l=o(s.yr),c=o(s.Z1),u=new r.Z({wkt:`GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",${s.sv.radius},298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]`});function h(e){return e&&((0,n.BZ)(e)||e===l)?l:e&&((0,n.V2)(e)||e===c)?c:a}function d(e){return e&&((0,n.BZ)(e)||e===l)?s.yr:e&&((0,n.V2)(e)||e===c)?s.Z1:s.sv}function p(e){return(0,n.o$)(e)?s.yr:(0,n.ME)(e)?s.Z1:s.sv}},19546:(e,t,i)=>{"use strict";var r;i.d(t,{R:()=>r}),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(r||(r={}))},14260:(e,t,i)=>{"use strict";i.d(t,{Z1:()=>o,sv:()=>s,yr:()=>n});class r{constructor(e,t,i,r){this.semiMajorAxis=e,this.flattening=t,this.outerAtmosphereRimWidth=i;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=r||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const s=new r(6378137,1/298.257223563,3e5,.006694379990137799),n=new r(3396190,1/169.8944472236118,23e4),o=new r(1737400,0,0)},44924:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});let r=0;class s{constructor(e=null){this.uid=r++,e?(this._wkt=void 0!==e.wkt?e.wkt:null,this._wkid=void 0!==e.wkid?e.wkid:-1,this._isInverse=void 0!==e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(e){const t=new s;return t._wkt=e.wkt,t._wkid=e.wkid,t._isInverse=e.isInverse,t}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=r++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=r++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=r++}getInverse(){const e=new s;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}}class n{constructor(e){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const t of e.steps)t instanceof s?this.steps.push(t):this.steps.push(new s({wkid:t.wkid,wkt:t.wkt,isInverse:t.isInverse}))}static cacheKey(e,t){return[void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&null!==e.wkt?e.wkt.toString():"",void 0!==t.wkid&&null!==t.wkid?t.wkid.toString():"-1",void 0!==t.wkt&&null!==t.wkt?t.wkt.toString():""].join(",")}static fromGE(e){const t=new n;let i="";for(const r of e.steps){const e=s.fromGE(r);t.steps.push(e),i+=e.uid.toString()+","}return t._cached_projection={},t._gtlistentry=null,t._chain=i,t}getInverse(){const e=new n;e.steps=[];for(let t=this.steps.length-1;t>=0;t--){const i=this.steps[t];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const t of this.steps)e+=t.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e),this._gtlistentry}assignCachedGe(e,t,i){this._cached_projection[n.cacheKey(e,t)]=i}getCachedGeTransformation(e,t){let i="";for(const e of this.steps)i+=e.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=i);const r=this._cached_projection[n.cacheKey(e,t)];return void 0===r?null:r}}},77727:(e,t,i)=>{"use strict";i.d(t,{Z:()=>y});var r,s=i(36663),n=i(82064),o=i(67134),a=i(13802),l=i(81977),c=i(69236),u=i(40266),h=i(7283),d=i(27428),p=i(1680),f=i(124);const m=a.Z.getLogger("esri.geometry.support.MeshComponent");let g=r=class extends n.wq{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return(0,h.TJ)(r,e)}castFaces(e){return(0,f.X)(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},m)}castMaterial(e){return(0,h.TJ)(e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?p.Z:d.Z,e)}clone(){return new r({faces:(0,o.d9)(this.faces),shading:this.shading,material:(0,o.d9)(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:(0,o.d9)(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new r(i)}};(0,s._)([(0,l.Cb)({json:{write:!0}})],g.prototype,"faces",void 0),(0,s._)([(0,c.p)("faces")],g.prototype,"castFaces",null),(0,s._)([(0,l.Cb)({type:d.Z,json:{write:!0}})],g.prototype,"material",void 0),(0,s._)([(0,c.p)("material")],g.prototype,"castMaterial",null),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],g.prototype,"shading",void 0),(0,s._)([(0,l.Cb)({type:Boolean})],g.prototype,"trustSourceNormals",void 0),g=r=(0,s._)([(0,u.j)("esri.geometry.support.MeshComponent")],g);const y=g},27428:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var r,s=i(36663),n=i(30936),o=i(82064),a=i(61681),l=i(81977),c=(i(7753),i(39994),i(7283),i(40266)),u=i(33206);let h=r=class extends o.wq{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=(0,a.pC)(e)?e.get(this):null;if(i)return i;const s=new r(this.clonePropertiesWithDeduplication(t));return(0,a.pC)(e)&&e.set(this,s),s}clonePropertiesWithDeduplication(e){return{color:(0,a.pC)(this.color)?this.color.clone():null,colorTexture:(0,a.pC)(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:(0,a.pC)(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};(0,s._)([(0,l.Cb)({type:n.Z,json:{write:!0}})],h.prototype,"color",void 0),(0,s._)([(0,l.Cb)({type:u.Z,json:{write:!0}})],h.prototype,"colorTexture",void 0),(0,s._)([(0,l.Cb)({type:u.Z,json:{write:!0}})],h.prototype,"normalTexture",void 0),(0,s._)([(0,l.Cb)({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaMode",void 0),(0,s._)([(0,l.Cb)({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaCutoff",void 0),(0,s._)([(0,l.Cb)({nonNullable:!0,json:{write:!0}})],h.prototype,"doubleSided",void 0),h=r=(0,s._)([(0,c.j)("esri.geometry.support.MeshMaterial")],h);const d=h},1680:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var r,s=i(36663),n=i(30936),o=i(61681),a=i(81977),l=(i(7753),i(39994),i(7283),i(40266)),c=i(27428),u=i(33206);let h=r=class extends c.Z{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=(0,o.pC)(e)?e.get(this):null;if(i)return i;const s=new r(this.clonePropertiesWithDeduplication(t));return(0,o.pC)(e)&&e.set(this,s),s}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:(0,o.pC)(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:(0,o.pC)(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:(0,o.pC)(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(0,o.pC)(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null}}};(0,s._)([(0,a.Cb)({type:n.Z,json:{write:!0}})],h.prototype,"emissiveColor",void 0),(0,s._)([(0,a.Cb)({type:u.Z,json:{write:!0}})],h.prototype,"emissiveTexture",void 0),(0,s._)([(0,a.Cb)({type:u.Z,json:{write:!0}})],h.prototype,"occlusionTexture",void 0),(0,s._)([(0,a.Cb)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"metallic",void 0),(0,s._)([(0,a.Cb)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"roughness",void 0),(0,s._)([(0,a.Cb)({type:u.Z,json:{write:!0}})],h.prototype,"metallicRoughnessTexture",void 0),h=r=(0,s._)([(0,l.j)("esri.geometry.support.MeshMaterialMetallicRoughness")],h);const d=h},33206:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r,s=i(36663),n=(i(39994),i(82064)),o=i(81977),a=(i(7753),i(7283)),l=i(34248),c=i(40266),u=i(39835),h=i(16641),d=i(994);const p=new WeakMap;let f=0,m=r=class extends n.wq{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const s={type:"image-element",src:(0,h.t)(e.src,r),crossOrigin:e.crossOrigin};t[i]=s}else if(e instanceof HTMLCanvasElement){const r=e.getContext("2d").getImageData(0,0,e.width,e.height),s={type:"canvas-element",imageData:this._encodeImageData(r)};t[i]=s}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:(0,h.t)(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=s}else{const r={type:"image-data",imageData:this._encodeImageData(e)};t[i]=r}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const e=t.substr(t.length-4,4).toLowerCase(),i=t.substr(0,15).toLocaleLowerCase();if(".png"===e||"data:image/png;"===i)return!0}return!1}set transparent(e){null!=e?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(t="")=>`d:${t},t:${this.transparent},w:${e}`;return null!=this.url?t(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(p.has(this.data)||p.set(this.data,++f),t(p.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new r(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return(0,d.Jl)(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1}static from(e){return"string"==typeof e?new r({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new r({data:e}):(0,a.TJ)(r,e)}};(0,s._)([(0,o.Cb)({type:String,json:{write:h.w}})],m.prototype,"url",null),(0,s._)([(0,o.Cb)({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),(0,o.Cb)()],m.prototype,"data",null),(0,s._)([(0,u.c)("data")],m.prototype,"writeData",null),(0,s._)([(0,l.r)("data")],m.prototype,"readData",null),(0,s._)([(0,o.Cb)({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],m.prototype,"transparent",null),(0,s._)([(0,o.Cb)({json:{write:!0}})],m.prototype,"wrap",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],m.prototype,"contentHash",null),m=r=(0,s._)([(0,c.j)("esri.geometry.support.MeshTexture")],m);const g=m},124:(e,t,i)=>{"use strict";i.d(t,{Q:()=>d,X:()=>f});var r,s=i(36663),n=i(82064),o=i(67134),a=i(13802),l=i(81977),c=i(69236),u=i(40266);const h=a.Z.getLogger("esri.geometry.support.MeshVertexAttributes");let d=r=class extends n.wq{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return f(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},h)}castPosition(e){return e&&e instanceof Float32Array&&h.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),f(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},h)}castUv(e){return f(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},h)}castNormal(e){return f(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},h)}castTangent(e){return f(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},h)}clone(){const e={position:(0,o.d9)(this.position),uv:(0,o.d9)(this.uv),normal:(0,o.d9)(this.normal),tangent:(0,o.d9)(this.tangent),color:(0,o.d9)(this.color)};return new r(e)}clonePositional(){const e={position:(0,o.d9)(this.position),normal:(0,o.d9)(this.normal),tangent:(0,o.d9)(this.tangent),uv:this.uv,color:this.color};return new r(e)}};function p(e,t,i,r){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):e}function f(e,t,i,r,s){if(!e)return e;if(e instanceof t)return p(e,r,t,s);for(const n of i)if(e instanceof n)return p(new t(e),r,t,s);if(Array.isArray(e))return p(new t(e),r,t,s);{const r=i.map((e=>`'${e.name}'`));return s.error(`Failed to set property, expected one of ${r}, but got ${e.constructor.name}`),new t([])}}function m(e,t,i){t[i]=function(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}(e)}(0,s._)([(0,l.Cb)({json:{write:m}})],d.prototype,"color",void 0),(0,s._)([(0,c.p)("color")],d.prototype,"castColor",null),(0,s._)([(0,l.Cb)({nonNullable:!0,json:{write:m}})],d.prototype,"position",void 0),(0,s._)([(0,c.p)("position")],d.prototype,"castPosition",null),(0,s._)([(0,l.Cb)({json:{write:m}})],d.prototype,"uv",void 0),(0,s._)([(0,c.p)("uv")],d.prototype,"castUv",null),(0,s._)([(0,l.Cb)({json:{write:m}})],d.prototype,"normal",void 0),(0,s._)([(0,c.p)("normal")],d.prototype,"castNormal",null),(0,s._)([(0,l.Cb)({json:{write:m}})],d.prototype,"tangent",void 0),(0,s._)([(0,c.p)("tangent")],d.prototype,"castTangent",null),d=r=(0,s._)([(0,u.j)("esri.geometry.support.MeshVertexAttributes")],d)},52345:(e,t,i)=>{"use strict";var r;i.d(t,{W:()=>r}),function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"}(r||(r={}))},36644:(e,t,i)=>{"use strict";let r;i.d(t,{Z:()=>s});const s={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(r=2e3;r<=2045;r++)s[r]=0;for(r=2056;r<=2065;r++)s[r]=0;for(r=2067;r<=2135;r++)s[r]=0;for(r=2137;r<=2154;r++)s[r]=0;for(r=2161;r<=2170;r++)s[r]=0;for(r=2172;r<=2193;r++)s[r]=0;for(r=2195;r<=2198;r++)s[r]=0;for(r=2200;r<=2203;r++)s[r]=0;for(r=2205;r<=2217;r++)s[r]=0;for(r=2222;r<=2224;r++)s[r]=1;for(r=2225;r<=2250;r++)s[r]=2;for(r=2251;r<=2253;r++)s[r]=1;for(r=2257;r<=2264;r++)s[r]=2;for(r=2274;r<=2279;r++)s[r]=2;for(r=2280;r<=2282;r++)s[r]=1;for(r=2283;r<=2289;r++)s[r]=2;for(r=2290;r<=2292;r++)s[r]=0;for(r=2308;r<=2313;r++)s[r]=0;for(r=2315;r<=2491;r++)s[r]=0;for(r=2494;r<=2866;r++)s[r]=0;for(r=2867;r<=2869;r++)s[r]=1;for(r=2870;r<=2888;r++)s[r]=2;for(r=2891;r<=2895;r++)s[r]=2;for(r=2896;r<=2898;r++)s[r]=1;for(r=2902;r<=2908;r++)s[r]=2;for(r=2915;r<=2920;r++)s[r]=2;for(r=2921;r<=2923;r++)s[r]=1;for(r=2924;r<=2930;r++)s[r]=2;for(r=2931;r<=2962;r++)s[r]=0;for(r=2964;r<=2968;r++)s[r]=2;for(r=2969;r<=2973;r++)s[r]=0;for(r=2975;r<=2991;r++)s[r]=0;for(r=2995;r<=3051;r++)s[r]=0;for(r=3054;r<=3079;r++)s[r]=0;for(r=3081;r<=3088;r++)s[r]=0;for(r=3092;r<=3101;r++)s[r]=0;for(r=3106;r<=3138;r++)s[r]=0;for(r=3146;r<=3151;r++)s[r]=0;for(r=3153;r<=3166;r++)s[r]=0;for(r=3168;r<=3172;r++)s[r]=0;for(r=3174;r<=3203;r++)s[r]=0;for(r=3294;r<=3358;r++)s[r]=0;for(r=3367;r<=3403;r++)s[r]=0;for(r=3408;r<=3416;r++)s[r]=0;for(r=3417;r<=3438;r++)s[r]=2;for(r=3441;r<=3446;r++)s[r]=2;for(r=3447;r<=3450;r++)s[r]=0;for(r=3451;r<=3459;r++)s[r]=2;for(r=3460;r<=3478;r++)s[r]=0;for(r=3554;r<=3559;r++)s[r]=0;for(r=3560;r<=3570;r++)s[r]=2;for(r=3571;r<=3581;r++)s[r]=0;for(r=3594;r<=3597;r++)s[r]=0;for(r=3601;r<=3604;r++)s[r]=0;for(r=3637;r<=3639;r++)s[r]=0;for(r=3665;r<=3667;r++)s[r]=0;for(r=3693;r<=3695;r++)s[r]=0;for(r=3701;r<=3727;r++)s[r]=0;for(r=3728;r<=3739;r++)s[r]=2;for(r=3740;r<=3751;r++)s[r]=0;for(r=3753;r<=3760;r++)s[r]=2;for(r=3761;r<=3773;r++)s[r]=0;for(r=3775;r<=3777;r++)s[r]=0;for(r=3779;r<=3781;r++)s[r]=0;for(r=3783;r<=3785;r++)s[r]=0;for(r=3788;r<=3791;r++)s[r]=0;for(r=3797;r<=3802;r++)s[r]=0;for(r=3814;r<=3816;r++)s[r]=0;for(r=3825;r<=3829;r++)s[r]=0;for(r=3832;r<=3841;r++)s[r]=0;for(r=3844;r<=3852;r++)s[r]=0;for(r=3873;r<=3885;r++)s[r]=0;for(r=3890;r<=3893;r++)s[r]=0;for(r=3907;r<=3912;r++)s[r]=0;for(r=3942;r<=3950;r++)s[r]=0;for(r=3968;r<=3970;r++)s[r]=0;for(r=3973;r<=3976;r++)s[r]=0;for(r=3986;r<=3989;r++)s[r]=0;for(r=3994;r<=3997;r++)s[r]=0;for(r=4048;r<=4051;r++)s[r]=0;for(r=4056;r<=4063;r++)s[r]=0;for(r=4093;r<=4096;r++)s[r]=0;for(r=4390;r<=4398;r++)s[r]=0;for(r=4399;r<=4413;r++)s[r]=2;for(r=4418;r<=4433;r++)s[r]=2;for(r=4455;r<=4457;r++)s[r]=2;for(r=4484;r<=4489;r++)s[r]=0;for(r=4491;r<=4554;r++)s[r]=0;for(r=4568;r<=4589;r++)s[r]=0;for(r=4652;r<=4656;r++)s[r]=0;for(r=4766;r<=4800;r++)s[r]=0;for(r=5014;r<=5016;r++)s[r]=0;for(r=5069;r<=5072;r++)s[r]=0;for(r=5105;r<=5130;r++)s[r]=0;for(r=5173;r<=5188;r++)s[r]=0;for(r=5253;r<=5259;r++)s[r]=0;for(r=5269;r<=5275;r++)s[r]=0;for(r=5292;r<=5311;r++)s[r]=0;for(r=5329;r<=5331;r++)s[r]=0;for(r=5343;r<=5349;r++)s[r]=0;for(r=5355;r<=5357;r++)s[r]=0;for(r=5387;r<=5389;r++)s[r]=0;for(r=5459;r<=5463;r++)s[r]=0;for(r=5479;r<=5482;r++)s[r]=0;for(r=5518;r<=5520;r++)s[r]=0;for(r=5530;r<=5539;r++)s[r]=0;for(r=5550;r<=5552;r++)s[r]=0;for(r=5562;r<=5583;r++)s[r]=0;for(r=5623;r<=5625;r++)s[r]=2;for(r=5631;r<=5639;r++)s[r]=0;for(r=5649;r<=5653;r++)s[r]=0;for(r=5663;r<=5680;r++)s[r]=0;for(r=5682;r<=5685;r++)s[r]=0;for(r=5875;r<=5877;r++)s[r]=0;for(r=5896;r<=5899;r++)s[r]=0;for(r=5921;r<=5940;r++)s[r]=0;for(r=6050;r<=6125;r++)s[r]=0;for(r=6244;r<=6275;r++)s[r]=0;for(r=6328;r<=6348;r++)s[r]=0;for(r=6350;r<=6356;r++)s[r]=0;for(r=6366;r<=6372;r++)s[r]=0;for(r=6381;r<=6387;r++)s[r]=0;for(r=6393;r<=6404;r++)s[r]=0;for(r=6480;r<=6483;r++)s[r]=0;for(r=6511;r<=6514;r++)s[r]=0;for(r=6579;r<=6581;r++)s[r]=0;for(r=6619;r<=6624;r++)s[r]=0;for(r=6625;r<=6627;r++)s[r]=2;for(r=6628;r<=6632;r++)s[r]=0;for(r=6634;r<=6637;r++)s[r]=0;for(r=6669;r<=6692;r++)s[r]=0;for(r=6707;r<=6709;r++)s[r]=0;for(r=6720;r<=6723;r++)s[r]=0;for(r=6732;r<=6738;r++)s[r]=0;for(r=6931;r<=6933;r++)s[r]=0;for(r=6956;r<=6959;r++)s[r]=0;for(r=7005;r<=7007;r++)s[r]=0;for(r=7057;r<=7070;r++)s[r]=2;for(r=7074;r<=7082;r++)s[r]=0;for(r=7109;r<=7118;r++)s[r]=0;for(r=7119;r<=7127;r++)s[r]=1;for(r=7374;r<=7376;r++)s[r]=0;for(r=7528;r<=7586;r++)s[r]=0;for(r=7587;r<=7645;r++)s[r]=2;for(r=7692;r<=7696;r++)s[r]=0;for(r=7755;r<=7787;r++)s[r]=0;for(r=7791;r<=7795;r++)s[r]=0;for(r=7799;r<=7801;r++)s[r]=0;for(r=7803;r<=7805;r++)s[r]=0;for(r=7825;r<=7831;r++)s[r]=0;for(r=7845;r<=7859;r++)s[r]=0;for(r=8013;r<=8032;r++)s[r]=0;for(r=8065;r<=8068;r++)s[r]=1;for(r=8518;r<=8529;r++)s[r]=2;for(r=8533;r<=8536;r++)s[r]=2;for(r=8538;r<=8540;r++)s[r]=2;for(r=8677;r<=8679;r++)s[r]=0;for(r=8836;r<=8840;r++)s[r]=0;for(r=8857;r<=8859;r++)s[r]=0;for(r=8908;r<=8910;r++)s[r]=0;for(r=9154;r<=9159;r++)s[r]=0;for(r=9205;r<=9218;r++)s[r]=0;for(r=9271;r<=9273;r++)s[r]=0;for(r=9295;r<=9297;r++)s[r]=0;for(r=9356;r<=9360;r++)s[r]=0;for(r=9404;r<=9407;r++)s[r]=0;for(r=9476;r<=9482;r++)s[r]=0;for(r=9487;r<=9494;r++)s[r]=0;for(r=9697;r<=9699;r++)s[r]=0;for(r=20002;r<=20032;r++)s[r]=0;for(r=20062;r<=20092;r++)s[r]=0;for(r=20135;r<=20138;r++)s[r]=0;for(r=20248;r<=20258;r++)s[r]=0;for(r=20348;r<=20358;r++)s[r]=0;for(r=20436;r<=20440;r++)s[r]=0;for(r=20822;r<=20824;r++)s[r]=0;for(r=20904;r<=20932;r++)s[r]=0;for(r=20934;r<=20936;r++)s[r]=0;for(r=21004;r<=21032;r++)s[r]=0;for(r=21035;r<=21037;r++)s[r]=0;for(r=21095;r<=21097;r++)s[r]=0;for(r=21148;r<=21150;r++)s[r]=0;for(r=21207;r<=21264;r++)s[r]=0;for(r=21307;r<=21364;r++)s[r]=0;for(r=21413;r<=21423;r++)s[r]=0;for(r=21453;r<=21463;r++)s[r]=0;for(r=21473;r<=21483;r++)s[r]=0;for(r=21780;r<=21782;r++)s[r]=0;for(r=21891;r<=21894;r++)s[r]=0;for(r=21896;r<=21899;r++)s[r]=0;for(r=22171;r<=22177;r++)s[r]=0;for(r=22181;r<=22187;r++)s[r]=0;for(r=22191;r<=22197;r++)s[r]=0;for(r=22234;r<=22236;r++)s[r]=0;for(r=22521;r<=22525;r++)s[r]=0;for(r=22991;r<=22994;r++)s[r]=0;for(r=23028;r<=23038;r++)s[r]=0;for(r=23830;r<=23853;r++)s[r]=0;for(r=23866;r<=23872;r++)s[r]=0;for(r=23877;r<=23884;r++)s[r]=0;for(r=23886;r<=23894;r++)s[r]=0;for(r=23946;r<=23948;r++)s[r]=0;for(r=24311;r<=24313;r++)s[r]=0;for(r=24342;r<=24347;r++)s[r]=0;for(r=24370;r<=24374;r++)s[r]=10;for(r=24375;r<=24381;r++)s[r]=0;for(r=24718;r<=24721;r++)s[r]=0;for(r=24817;r<=24821;r++)s[r]=0;for(r=24877;r<=24882;r++)s[r]=0;for(r=24891;r<=24893;r++)s[r]=0;for(r=25391;r<=25395;r++)s[r]=0;for(r=25828;r<=25838;r++)s[r]=0;for(r=26191;r<=26195;r++)s[r]=0;for(r=26391;r<=26393;r++)s[r]=0;for(r=26701;r<=26722;r++)s[r]=0;for(r=26729;r<=26799;r++)s[r]=2;for(r=26801;r<=26803;r++)s[r]=2;for(r=26811;r<=26813;r++)s[r]=2;for(r=26847;r<=26870;r++)s[r]=2;for(r=26891;r<=26899;r++)s[r]=0;for(r=26901;r<=26923;r++)s[r]=0;for(r=26929;r<=26946;r++)s[r]=0;for(r=26948;r<=26998;r++)s[r]=0;for(r=27037;r<=27040;r++)s[r]=0;for(r=27205;r<=27232;r++)s[r]=0;for(r=27258;r<=27260;r++)s[r]=0;for(r=27391;r<=27398;r++)s[r]=0;for(r=27561;r<=27564;r++)s[r]=0;for(r=27571;r<=27574;r++)s[r]=0;for(r=27581;r<=27584;r++)s[r]=0;for(r=27591;r<=27594;r++)s[r]=0;for(r=28191;r<=28193;r++)s[r]=0;for(r=28348;r<=28358;r++)s[r]=0;for(r=28402;r<=28432;r++)s[r]=0;for(r=28462;r<=28492;r++)s[r]=0;for(r=29118;r<=29122;r++)s[r]=0;for(r=29168;r<=29172;r++)s[r]=0;for(r=29177;r<=29185;r++)s[r]=0;for(r=29187;r<=29195;r++)s[r]=0;for(r=29900;r<=29903;r++)s[r]=0;for(r=30161;r<=30179;r++)s[r]=0;for(r=30491;r<=30494;r++)s[r]=0;for(r=30729;r<=30732;r++)s[r]=0;for(r=31251;r<=31259;r++)s[r]=0;for(r=31265;r<=31268;r++)s[r]=0;for(r=31275;r<=31279;r++)s[r]=0;for(r=31281;r<=31297;r++)s[r]=0;for(r=31461;r<=31469;r++)s[r]=0;for(r=31491;r<=31495;r++)s[r]=0;for(r=31917;r<=31922;r++)s[r]=0;for(r=31965;r<=32e3;r++)s[r]=0;for(r=32001;r<=32003;r++)s[r]=2;for(r=32005;r<=32031;r++)s[r]=2;for(r=32033;r<=32060;r++)s[r]=2;for(r=32064;r<=32067;r++)s[r]=2;for(r=32074;r<=32077;r++)s[r]=2;for(r=32081;r<=32086;r++)s[r]=0;for(r=32107;r<=32130;r++)s[r]=0;for(r=32133;r<=32158;r++)s[r]=0;for(r=32164;r<=32167;r++)s[r]=2;for(r=32180;r<=32199;r++)s[r]=0;for(r=32201;r<=32260;r++)s[r]=0;for(r=32301;r<=32360;r++)s[r]=0;for(r=32601;r<=32662;r++)s[r]=0;for(r=32664;r<=32667;r++)s[r]=2;for(r=32701;r<=32761;r++)s[r]=0;for(r=53001;r<=53004;r++)s[r]=0;for(r=53008;r<=53019;r++)s[r]=0;for(r=53021;r<=53032;r++)s[r]=0;for(r=53034;r<=53037;r++)s[r]=0;for(r=53042;r<=53046;r++)s[r]=0;for(r=53074;r<=53080;r++)s[r]=0;for(r=54001;r<=54004;r++)s[r]=0;for(r=54008;r<=54019;r++)s[r]=0;for(r=54021;r<=54032;r++)s[r]=0;for(r=54034;r<=54037;r++)s[r]=0;for(r=54042;r<=54046;r++)s[r]=0;for(r=54048;r<=54053;r++)s[r]=0;for(r=54074;r<=54080;r++)s[r]=0;for(r=54098;r<=54101;r++)s[r]=0;for(r=102001;r<=102040;r++)s[r]=0;for(r=102042;r<=102063;r++)s[r]=0;for(r=102065;r<=102067;r++)s[r]=0;for(r=102070;r<=102117;r++)s[r]=0;for(r=102122;r<=102216;r++)s[r]=0;for(r=102221;r<=102377;r++)s[r]=0;for(r=102382;r<=102388;r++)s[r]=0;for(r=102389;r<=102398;r++)s[r]=2;for(r=102399;r<=102444;r++)s[r]=0;for(r=102445;r<=102447;r++)s[r]=2;for(r=102448;r<=102458;r++)s[r]=0;for(r=102459;r<=102468;r++)s[r]=2;for(r=102469;r<=102499;r++)s[r]=0;for(r=102500;r<=102519;r++)s[r]=1;for(r=102520;r<=102524;r++)s[r]=0;for(r=102525;r<=102529;r++)s[r]=2;for(r=102530;r<=102588;r++)s[r]=0;for(r=102590;r<=102598;r++)s[r]=0;for(r=102601;r<=102603;r++)s[r]=0;for(r=102605;r<=102628;r++)s[r]=0;for(r=102629;r<=102646;r++)s[r]=2;for(r=102648;r<=102700;r++)s[r]=2;for(r=102701;r<=102703;r++)s[r]=0;for(r=102707;r<=102730;r++)s[r]=2;for(r=102733;r<=102758;r++)s[r]=2;for(r=102767;r<=102900;r++)s[r]=0;for(r=102901;r<=102933;r++)s[r]=2;for(r=102934;r<=102950;r++)s[r]=13;for(r=102951;r<=102955;r++)s[r]=0;for(r=102961;r<=102963;r++)s[r]=0;for(r=102965;r<=102969;r++)s[r]=0;for(r=102971;r<=102973;r++)s[r]=0;for(r=102975;r<=102989;r++)s[r]=0;for(r=102990;r<=102992;r++)s[r]=1;for(r=102997;r<=103002;r++)s[r]=0;for(r=103003;r<=103008;r++)s[r]=2;for(r=103009;r<=103011;r++)s[r]=0;for(r=103012;r<=103014;r++)s[r]=2;for(r=103019;r<=103021;r++)s[r]=0;for(r=103022;r<=103024;r++)s[r]=2;for(r=103029;r<=103031;r++)s[r]=0;for(r=103032;r<=103034;r++)s[r]=2;for(r=103065;r<=103068;r++)s[r]=0;for(r=103074;r<=103076;r++)s[r]=0;for(r=103077;r<=103079;r++)s[r]=1;for(r=103080;r<=103082;r++)s[r]=0;for(r=103083;r<=103085;r++)s[r]=2;for(r=103090;r<=103093;r++)s[r]=0;for(r=103097;r<=103099;r++)s[r]=0;for(r=103100;r<=103102;r++)s[r]=2;for(r=103107;r<=103109;r++)s[r]=0;for(r=103110;r<=103112;r++)s[r]=2;for(r=103113;r<=103116;r++)s[r]=0;for(r=103117;r<=103120;r++)s[r]=2;for(r=103153;r<=103157;r++)s[r]=0;for(r=103158;r<=103162;r++)s[r]=2;for(r=103163;r<=103165;r++)s[r]=0;for(r=103166;r<=103168;r++)s[r]=1;for(r=103169;r<=103171;r++)s[r]=2;for(r=103186;r<=103188;r++)s[r]=0;for(r=103189;r<=103191;r++)s[r]=2;for(r=103192;r<=103195;r++)s[r]=0;for(r=103196;r<=103199;r++)s[r]=2;for(r=103200;r<=103224;r++)s[r]=0;for(r=103225;r<=103227;r++)s[r]=1;for(r=103232;r<=103237;r++)s[r]=0;for(r=103238;r<=103243;r++)s[r]=2;for(r=103244;r<=103246;r++)s[r]=0;for(r=103247;r<=103249;r++)s[r]=2;for(r=103254;r<=103256;r++)s[r]=0;for(r=103257;r<=103259;r++)s[r]=2;for(r=103264;r<=103266;r++)s[r]=0;for(r=103267;r<=103269;r++)s[r]=2;for(r=103300;r<=103375;r++)s[r]=0;for(r=103381;r<=103383;r++)s[r]=0;for(r=103384;r<=103386;r++)s[r]=1;for(r=103387;r<=103389;r++)s[r]=0;for(r=103390;r<=103392;r++)s[r]=2;for(r=103397;r<=103399;r++)s[r]=0;for(r=103400;r<=103471;r++)s[r]=2;for(r=103476;r<=103478;r++)s[r]=0;for(r=103479;r<=103481;r++)s[r]=2;for(r=103486;r<=103488;r++)s[r]=0;for(r=103489;r<=103491;r++)s[r]=2;for(r=103492;r<=103495;r++)s[r]=0;for(r=103496;r<=103499;r++)s[r]=2;for(r=103528;r<=103543;r++)s[r]=0;for(r=103544;r<=103548;r++)s[r]=2;for(r=103549;r<=103551;r++)s[r]=0;for(r=103552;r<=103554;r++)s[r]=1;for(r=103555;r<=103557;r++)s[r]=2;for(r=103558;r<=103560;r++)s[r]=0;for(r=103571;r<=103573;r++)s[r]=0;for(r=103574;r<=103576;r++)s[r]=2;for(r=103577;r<=103580;r++)s[r]=0;for(r=103581;r<=103583;r++)s[r]=2;for(r=103595;r<=103694;r++)s[r]=0;for(r=103696;r<=103699;r++)s[r]=0;for(r=103700;r<=103793;r++)s[r]=2;for(r=103794;r<=103887;r++)s[r]=0;for(r=103900;r<=103971;r++)s[r]=2},37116:(e,t,i)=>{"use strict";i.d(t,{BD:()=>x,Cb:()=>y,G1:()=>d,Gv:()=>V,HH:()=>l,JR:()=>L,TC:()=>c,Tn:()=>O,Ue:()=>o,VK:()=>u,Wi:()=>p,Ye:()=>g,Zp:()=>S,aO:()=>w,al:()=>a,bA:()=>A,bd:()=>U,be:()=>v,bf:()=>m,cS:()=>P,cv:()=>E,dp:()=>b,fS:()=>F,kK:()=>T,op:()=>M,pp:()=>h,r3:()=>C,re:()=>k,sU:()=>f,t8:()=>R,wp:()=>N,wz:()=>_,xE:()=>z,y8:()=>I});var r=i(61681),s=i(91772),n=i(24568);function o(e=z){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,i,r,s,n,a=o()){return a[0]=e,a[1]=t,a[2]=i,a[3]=r,a[4]=s,a[5]=n,a}function l(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new s.Z(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function c(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function u(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function h(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function d(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let e=0;e<r;e++)s=Math.min(s,t[i+3*e]),n=Math.min(n,t[i+3*e+1]),o=Math.min(o,t[i+3*e+2]),a=Math.max(a,t[i+3*e]),l=Math.max(l,t[i+3*e+1]),c=Math.max(c,t[i+3*e+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function p(e,t,i){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(i)for(let e=0;e<r;e++){const i=t[e];s=Math.min(s,i[0]),n=Math.min(n,i[1]),o=Math.min(o,i[2]),a=Math.max(a,i[0]),l=Math.max(l,i[1]),c=Math.max(c,i[2])}else for(let e=0;e<r;e++){const i=t[e];s=Math.min(s,i[0]),n=Math.min(n,i[1]),a=Math.max(a,i[0]),l=Math.max(l,i[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function f(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function m(e){return e[0]>=e[3]?0:e[3]-e[0]}function g(e){return e[1]>=e[4]?0:e[4]-e[1]}function y(e){return e[2]>=e[5]?0:e[5]-e[2]}function _(e){const t=m(e),i=y(e),r=g(e);return Math.sqrt(t*t+i*i+r*r)}function v(e,t=[0,0,0]){return t[0]=e[0]+m(e)/2,t[1]=e[1]+g(e)/2,t[2]=e[2]+y(e)/2,t}function b(e,t=[0,0,0]){return t[0]=m(e),t[1]=g(e),t[2]=y(e),t}function w(e){return Math.max(m(e),y(e),g(e))}function x(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function C(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function T(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function S(e,t){return!!(0,r.Wi)(t)||T(e,t)}function E(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function A(e,t,i=e){const r=e[0]+m(e)/2,s=e[1]+g(e)/2,n=e[2]+y(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=s+(e[1]-s)*t,i[2]=n+(e[2]-n)*t,i[3]=r+(e[3]-r)*t,i[4]=s+(e[4]-s)*t,i[5]=n+(e[5]-n)*t,i}function M(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function O(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function R(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function P(e){return e?R(e,V):o(V)}function I(e,t){return t||(t=(0,n.Ue)()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function L(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function D(e){return 6===e.length}function N(e){return 0===m(e)&&0===g(e)&&0===y(e)}function F(e,t,i){if((0,r.Wi)(e)||(0,r.Wi)(t))return e===t;if(!D(e)||!D(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function k(e,t,i,r,s,n){return a(e,t,i,r,s,n,B)}const U=[-1/0,-1/0,-1/0,1/0,1/0,1/0],V=[1/0,1/0,1/0,-1/0,-1/0,-1/0],z=[0,0,0,0,0,0],B=o()},24568:(e,t,i)=>{"use strict";i.d(t,{BD:()=>b,Cb:()=>y,Gv:()=>k,HH:()=>h,Ho:()=>d,I7:()=>x,JG:()=>l,OC:()=>S,Qn:()=>C,SO:()=>_,TE:()=>R,Ue:()=>o,Wi:()=>f,Zm:()=>E,al:()=>c,bd:()=>F,be:()=>v,bf:()=>g,cS:()=>I,cv:()=>P,d9:()=>a,fS:()=>N,hr:()=>w,jE:()=>T,jV:()=>O,jn:()=>p,kK:()=>A,oJ:()=>u,r3:()=>M,sU:()=>m,wp:()=>D}),i(39994);var r=i(19431),s=i(61681),n=i(91772);function o(e=U){return[e[0],e[1],e[2],e[3]]}function a(e){return[e[0],e[1],e[2],e[3]]}function l(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function c(e,t,i,r,s=o()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function u(e,t=o()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function h(e,t){return new n.Z({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function d(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function p(e,t,i){if((0,s.Wi)(t))l(i,e);else if("length"in t)L(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):2!==t.length&&3!==t.length||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}}function f(e,t,i=e){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let e=0;e<r;e++){const i=t[e];s=Math.min(s,i[0]),n=Math.min(n,i[1]),o=Math.max(o,i[0]),a=Math.max(a,i[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function m(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function g(e){return(0,s.Wi)(e)||e[0]>=e[2]?0:e[2]-e[0]}function y(e){return e[1]>=e[3]?0:e[3]-e[1]}function _(e){return g(e)*y(e)}function v(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function b(e,t){return T(e,t[0],t[1])}function w(e,t){const i=t[3],r=.5*(e[0]+e[2]),s=Math.abs(t[0]-r),n=.5*(e[2]-e[0]);if(s>i+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,u=l-a;return c*c+u*u<=i*i}function x(e,t,i){const r=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:u}=i,h=(e,t)=>(u-l)*e+(a-c)*t+(c*l-a*u)<0,d=h(r,o),p=h(n,o),f=h(n,s),m=h(r,s);return!(d===p&&p===f&&f===m&&m===d||a<r&&c<r||a>n&&c>n||l>o&&u>o||l<s&&u<s)}function C(e,t){return T(e,t.x,t.y)}function T(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function S(e,t,i,r){return t>=e[0]-r&&i>=e[1]-r&&t<=e[2]+r&&i<=e[3]+r}function E(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function A(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function M(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function O(e,t,i){if((0,s.Wi)(t))return l(i,e);const n=t[0],o=t[1],a=t[2],c=t[3];return i[0]=(0,r.uZ)(e[0],n,a),i[1]=(0,r.uZ)(e[1],o,c),i[2]=(0,r.uZ)(e[2],n,a),i[3]=(0,r.uZ)(e[3],o,c),i}function R(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-i)-g(e)/2,0),n=Math.max(Math.abs(t[1]-r)-y(e)/2,0);return Math.sqrt(s*s+n*n)}function P(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function I(e){return e?l(e,k):o(k)}function L(e){return null!=e&&4===e.length}function D(e){return!(0!==g(e)&&isFinite(e[0])||0!==y(e)&&isFinite(e[1]))}function N(e,t){return L(e)&&L(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const F=[-1/0,-1/0,1/0,1/0],k=[1/0,1/0,-1/0,-1/0],U=[0,0,0,0]},79880:(e,t,i)=>{"use strict";function r(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function s(e){return void 0!==e.points}function n(e){return void 0!==e.x&&void 0!==e.y}function o(e){return void 0!==e.paths}function a(e){return void 0!==e.rings}function l(e){return(t,i)=>null==t?i:null==i?t:e(t,i)}i.d(t,{$P:()=>h,C6:()=>p,Yg:()=>d,lC:()=>m});const c=l(Math.min),u=l(Math.max);function h(e,t){return o(t)?p(e,t.paths,!1,!1):a(t)?p(e,t.rings,!1,!1):s(t)?m(e,t.points,!1,!1,!1,!1):r(t)?f(e,t):(n(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function d(e,t){return o(t)?p(e,t.paths,!0,!1):a(t)?p(e,t.rings,!0,!1):s(t)?m(e,t.points,!0,!1,!0,!1):r(t)?f(e,t,0,0,!0,!1):(n(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function p(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[h,d]=t[0][0],[p,f]=t[0][0];for(let e=0;e<t.length;e++){const m=t[e];for(let e=0;e<m.length;e++){const t=m[e],[g,y]=t;if(h=c(h,g),d=c(d,y),p=u(p,g),f=u(f,y),i&&t.length>2){const e=t[2];n=c(n,e),o=u(o,e)}if(r&&t.length>s){const e=t[s];a=c(n,e),l=u(o,e)}}}return i?r?(e[0]=h,e[1]=d,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=h,e[1]=d,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):r?(e[0]=h,e[1]=d,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=h,e[1]=d,e[2]=p,e[3]=f,e.length=4,e)}function f(e,t,i,r,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let u=t.zmin,h=t.zmax,d=t.mmin,p=t.mmax;return s?(u=u||0,h=h||0,n?(d=d||0,p=p||0,e[0]=o,e[1]=l,e[2]=u,e[3]=d,e[4]=a,e[5]=c,e[6]=h,e[7]=p,e):(e[0]=o,e[1]=l,e[2]=u,e[3]=a,e[4]=c,e[5]=h,e)):n?(d=d||0,p=p||0,e[0]=o,e[1]=l,e[2]=d,e[3]=a,e[4]=c,e[5]=p,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function m(e,t,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!t.length||!t[0].length)return null;let h,d,p,f,[m,g]=t[0],[y,_]=t[0];for(let e=0;e<t.length;e++){const i=t[e],[r,s]=i;if(m=c(m,r),g=c(g,s),y=u(y,r),_=u(_,s),l&&i.length>2){const e=i[2];h=c(h,e),d=u(d,e)}if(a&&i.length>o){const e=i[o];p=c(h,e),f=u(d,e)}}return s?(h=h||0,d=d||0,n?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=h,e[3]=p,e[4]=y,e[5]=_,e[6]=d,e[7]=f,e):(e[0]=m,e[1]=g,e[2]=h,e[3]=y,e[4]=_,e[5]=d,e)):n?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=p,e[3]=y,e[4]=_,e[5]=f,e):(e[0]=m,e[1]=g,e[2]=y,e[3]=_,e)}},81936:(e,t,i)=>{"use strict";i.d(t,{ly:()=>d,oS:()=>b,o7:()=>z,Jj:()=>G,Hz:()=>F,gK:()=>g,ey:()=>y,bj:()=>_,O1:()=>v,av:()=>M,Nu:()=>I,D_:()=>T,Eu:()=>p,q6:()=>w,or:()=>B,wA:()=>W,Vs:()=>k,TS:()=>O,qt:()=>L,xA:()=>S,ct:()=>f,fP:()=>x,n1:()=>H,PP:()=>Z,P_:()=>U,mw:()=>R,G5:()=>D,ne:()=>E,ek:()=>m,Cd:()=>C,zO:()=>j,TN:()=>q,ir:()=>V,v6:()=>P,hu:()=>N,mc:()=>A});class r{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=9;const n=this.TypedArrayConstructor;void 0===r&&(r=9*n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let e=0;e<9;e++)t[e]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let e=0;e<9;e++)this.typedBuffer[i++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,s=t.typedBuffer;let n=e*this.typedBufferStride,o=i*t.typedBufferStride;for(let e=0;e<9;++e)r[n++]=s[o++]}get buffer(){return this.typedBuffer.buffer}}r.ElementCount=9;class s{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=16;const n=this.TypedArrayConstructor;void 0===r&&(r=16*n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let e=0;e<16;e++)t[e]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let e=0;e<16;e++)this.typedBuffer[i++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,s=t.typedBuffer;let n=e*this.typedBufferStride,o=i*t.typedBufferStride;for(let e=0;e<16;++e)r[n++]=s[o++]}get buffer(){return this.typedBuffer.buffer}}s.ElementCount=16;class n{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=1;const n=this.TypedArrayConstructor;void 0===r&&(r=n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=1;var o=i(55709);class a{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=2;const n=this.TypedArrayConstructor;void 0===r&&(r=2*n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,o.a)(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=i}copyFrom(e,t,i){const r=this.typedBuffer,s=t.typedBuffer;let n=e*this.typedBufferStride,o=i*t.typedBufferStride;r[n++]=s[o++],r[n]=s[o]}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=2;var l=i(6766);class c{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=3;const n=this.TypedArrayConstructor;void 0===r&&(r=3*n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,l.s)(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,t,i){const r=this.typedBuffer,s=t.typedBuffer;let n=e*this.typedBufferStride,o=i*t.typedBufferStride;r[n++]=s[o++],r[n++]=s[o++],r[n]=s[o]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=3;var u=i(88589);class h{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=4;const n=this.TypedArrayConstructor;void 0===r&&(r=4*n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,u.s)(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,t,i){const r=this.typedBuffer,s=t.typedBuffer;let n=e*this.typedBufferStride,o=i*t.typedBufferStride;r[n++]=s[o++],r[n++]=s[o++],r[n++]=s[o++],r[n]=s[o]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=4;class d extends n{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}static fromTypedArray(e,t){return new d(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}d.ElementType="f32";class p extends a{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class f extends c{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class m extends h{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f32";class g extends r{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f32";class y extends r{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f64";class _ extends s{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f32";class v extends s{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f64";class b extends n{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f64";class w extends a{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="f64";class x extends c{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="f64";class C extends h{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="f64";class T extends n{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="u8";class S extends a{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="u8";class E extends c{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u8";class A extends h{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u8";class M extends n{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u16";class O extends a{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="u16";class R extends c{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u16";class P extends h{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="u16";class I extends n{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u32";class L extends a{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="u32";class D extends c{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class N extends h{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="u32";class F extends n{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="i8";class k extends a{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i8";class U extends c{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i8";class V extends h{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i8";class z extends n{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i16";class B extends a{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i16";class H extends c{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i16";class j extends h{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="i16";class G extends n{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i32";class W extends a{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32";class Z extends c{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Z,e,t)}static fromTypedArray(e,t){return new Z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Z.ElementType="i32";class q extends h{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(q,e,t)}static fromTypedArray(e,t){return new q(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}q.ElementType="i32"},45150:(e,t,i)=>{"use strict";i.d(t,{c:()=>r});const r=i(13802).Z.getLogger("esri.views.3d.support.buffer.math")},90331:(e,t,i)=>{"use strict";function r(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function s(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function n(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function o(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}i.d(t,{B3:()=>s,Op:()=>o,U:()=>n,n1:()=>r}),i(39994)},79:(e,t,i)=>{"use strict";i.d(t,{gS:()=>s});var r=i(90331);function s(e,t){return new e(new ArrayBuffer(t*e.ElementCount*(0,r.n1)(e.ElementType)))}Object.freeze(Object.defineProperty({__proto__:null,copy:function(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let e=0;e<a;++e){for(let e=0;e<9;++e)r[l+e]=n[c+e];l+=s,c+=o}}},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,copy:function(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let e=0;e<a;++e){for(let e=0;e<16;++e)r[l+e]=n[c+e];l+=s,c+=o}}},Symbol.toStringTag,{value:"Module"})),i(15642),i(385),i(14789),i(32101)},18449:(e,t,i)=>{"use strict";i.d(t,{$G:()=>s,a:()=>o,tO:()=>n});var r=i(38028);function s(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function n(e){return e?o(e.rings,e.hasZ):null}function o(e,t){if(!e||!e.length)return null;const i=[],s=[],n=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let i=0,r=e.length;i<r;i++){const r=a(e[i],t,n);r&&s.push(r)}if(s.sort(((e,i)=>{let r=e[2]-i[2];return 0===r&&t&&(r=e[4]-i[4]),r})),s.length&&(i[0]=s[0][0],i[1]=s[0][1],t&&(i[2]=s[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||t&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){const s=e[0]&&e[0].length?function(e,t){const i=t?[0,0,0]:[0,0],s=t?[0,0,0]:[0,0];let n=0,o=0,a=0,l=0;for(let c=0,u=e.length;c<u-1;c++){const u=e[c],h=e[c+1];if(u&&h){i[0]=u[0],i[1]=u[1],s[0]=h[0],s[1]=h[1],t&&u.length>2&&h.length>2&&(i[2]=u[2],s[2]=h[2]);const e=(0,r.xA)(i,s);if(e){n+=e;const i=(0,r.Gi)(u,h);o+=e*i[0],a+=e*i[1],t&&i.length>2&&(l+=e*i[2])}}}return n>0?t?[o/n,a/n,l/n]:[o/n,a/n]:e.length?e[0]:null}(e[0],t):null;if(!s)return null;i[0]=s[0],i[1]=s[1],t&&s.length>2&&(i[2]=s[2])}return i}function a(e,t,i){let r=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,u=e.length&&t?e[0][2]:0;for(let h=0;h<e.length;h++){const d=e[h],p=e[(h+1)%e.length],[f,m,g]=d,y=f-l,_=m-c,v=t?g-u:void 0,[b,w,x]=p,C=b-l,T=w-c,S=t?x-u:void 0,E=y*T-C*_;if(o+=E,r+=(y+C)*E,s+=(_+T)*E,t&&d.length>2&&p.length>2){const e=y*S-C*v;n+=(v+S)*e,a+=e}f<i[0]&&(i[0]=f),f>i[1]&&(i[1]=f),m<i[2]&&(i[2]=m),m>i[3]&&(i[3]=m),t&&(g<i[4]&&(i[4]=g),g>i[5]&&(i[5]=g))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const h=[r/(6*o)+l,s/(6*o)+c,o];return t&&(i[4]===i[5]||0===a?(h[3]=(i[4]+i[5])/2,h[4]=0):(h[3]=n/(6*a)+u,h[4]=a)),h}},70740:(e,t,i)=>{"use strict";i.d(t,{S$:()=>u,Ue:()=>o,Ws:()=>c,_k:()=>l,iL:()=>a});var r=i(19480),s=i(6766),n=i(97537);function o(e){return e?{ray:(0,n.Ue)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,n.Ue)(),c0:0,c1:Number.MAX_VALUE}}function a(e,t=o()){return(0,n.JG)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function l(e,t,i=o()){const r=(0,s.l)(e.vector);return(0,n.al)(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function c(e,t){return h(e,e.c0,t)}function u(e,t){return h(e,e.c1,t)}function h(e,t,i){return(0,s.a)(i,e.ray.origin,(0,s.g)(i,e.ray.direction,t))}i(68817),new r.x((()=>({c0:0,c1:0,ray:null})))},27127:(e,t,i)=>{"use strict";i.d(t,{CI:()=>h,Kv:()=>u,OQ:()=>l,Qg:()=>c,aV:()=>n,lQ:()=>o,uP:()=>a,wP:()=>d});var r=i(61681);const s=[0,0];function n(e,t){return!!(0,r.pC)(t)&&u(e,t.x,t.y,t.z)}function o(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!l(e,i))return!1;return!0}function a(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?u(e,i,r,s)&&u(e,i,o,s)&&u(e,n,o,s)&&u(e,n,r,s)&&u(e,i,r,a)&&u(e,i,o,a)&&u(e,n,o,a)&&u(e,n,r,a):u(e,i,r)&&u(e,i,o)&&u(e,n,o)&&u(e,n,r)}function l(e,t){return u(e,t[0],t[1])}function c(e,t){return u(e,t[0],t[1],t[2])}function u(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(null==r||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function h(e,t){return s[1]=t.y,s[0]=t.x,function(e,t){return d(e.rings,t)}(e,s)}function d(e,t){if(!e)return!1;if(function(e){return!Array.isArray(e[0][0])}(e))return p(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=p(i,e[r],t);return i}function p(e,t,i){const[r,s]=i;let n=e,o=0;for(let e=0,i=t.length;e<i;e++){o++,o===i&&(o=0);const[a,l]=t[e],[c,u]=t[o];(l<s&&u>=s||u<s&&l>=s)&&a+(s-l)/(u-l)*(c-a)<r&&(n=!n)}return n}},47190:(e,t,i)=>{"use strict";i.d(t,{BR:()=>v,E2:()=>M,Is:()=>x,Kf:()=>_,NE:()=>T,P0:()=>y,Tz:()=>A,Ue:()=>h,ej:()=>b,id:()=>w,pb:()=>g,pt:()=>f,qf:()=>d,rF:()=>C,yS:()=>E});var r=i(24455),s=i(6766),n=i(8909),o=i(25726),a=i(14685),l=i(19546),c=i(96739),u=i(91917);function h(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function d(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function p(e,t,i=function(e){return{operations:e,value:e.create()}}(e)){return i.operations=e,e.copy(t,i.value),i}function f(e){return p(u.s,(0,u.f)(0,0,0,(0,o.Iu)(e).radius))}const m=2**50;function g(){return p(c.b,(0,c.f)([0,0,0],[m,0,0],[0,m,0]))}function y(e,t,i){return e.operations.axisAt(e.value,t,l.R.Z,i)}function _(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function v(e,t,i){return e.operations.intersectRay(e.value,t,i)}function b(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function w(e,t){return e.operations.altitudeAt(e.value,t)}function x(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function C(e,t,i,n){return t!==n&&(0,r.c)(n,t),(0,s.s)(S,n[12],n[13],n[14]),x(e,S,i,S),n[12]=S[0],n[13]=S[1],n[14]=S[2],n}function T(e,t,i){return e.operations.elevate(e.value,t,i.value)}const S=(0,n.c)();function E(e,t,i,r,n){return n[0]=(0,s.e)(e,t),n[1]=(0,s.e)(e,i),n[2]=(0,s.e)(e,r),n}function A(e,t,i,r,n){(0,s.c)(i,e),(0,s.c)(O,t),(0,s.n)(O,O),(0,s.f)(r,O,i),(0,s.f)(n,r,i)}function M(e,t){return e?(0,o.rS)(t):t.isGeographic?a.Z.PlateCarree:t}const O=(0,n.c)()},38028:(e,t,i)=>{"use strict";function r(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function s(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function n(e,t){return s(e,t,.5)}function o(e){const t=e.length;let i=0;for(let s=0;s<t-1;++s)i+=r(e[s],e[s+1]);return i}function a(e,t){if(t<=0)return e[0];const i=e.length;let n=0;for(let o=0;o<i-1;++o){const i=r(e[o],e[o+1]);if(t-n<i){const r=(t-n)/i;return s(e[o],e[o+1],r)}n+=i}return e[i-1]}function l(e,t,i){const r=e.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=e[a],c=e[(a+1)%r];let u=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],u=3),l.length>u&&c.length>u&&t&&(o+=l[0]*c[u]-c[0]*l[u])}return s<=0&&n<=0&&o<=0}function c(e){if("rings"in e)for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]])}i.d(t,{Gi:()=>n,Zy:()=>c,bu:()=>l,n8:()=>a,ok:()=>o,xA:()=>r}),i(35925)},50842:(e,t,i)=>{"use strict";i.d(t,{Wn:()=>d,_w:()=>h,aO:()=>u});var r=i(79880);const s=[];function n(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function o(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function a(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function l(e,t,i,r,s,n,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function c(e,t=!1,i=!1){return t?i?l(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):o(e[0],e[1],e[2],e[3],e[4],e[5]):i?a(e[0],e[1],e[2],e[3],e[4],e[5]):n(e[0],e[1],e[2],e[3])}function u(e){return e?function(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}(e)?e:function(e){return void 0!==e.x&&void 0!==e.y}(e)?function(e){const{x:t,y:i,z:r,m:s}=e,c=null!=s;return null!=r?c?l(t,i,r,s,t,i,r,s):o(t,i,r,t,i,r):c?a(t,i,s,t,i,s):n(t,i,t,i)}(e):function(e){return void 0!==e.rings}(e)?h(e):function(e){return void 0!==e.paths}(e)?d(e):function(e){return void 0!==e.points}(e)?function(e){const{hasZ:t,hasM:i,points:n}=e;return c((0,r.lC)(s,n,t,i),t,i)}(e):null:null}function h(e){const{hasZ:t,hasM:i,rings:n}=e,o=(0,r.C6)(s,n,t,i);return o?c(o,t,i):null}function d(e){const{hasZ:t,hasM:i,paths:n}=e,o=(0,r.C6)(s,n,t,i);return o?c(o,t,i):null}},59934:(e,t,i)=>{"use strict";i.d(t,{Hf:()=>g,JG:()=>y,Jp:()=>v,NQ:()=>s,Nu:()=>r,Ue:()=>m,Zr:()=>w,fz:()=>S,g8:()=>T,hr:()=>b,q_:()=>_,rN:()=>C,tc:()=>M,xu:()=>A,zq:()=>x});var r,s,n,o=i(19480),a=i(24455),l=i(6766),c=i(8909),u=i(88589),h=i(1983),d=i(70740),p=i(69430),f=i(68817);function m(e){return e?[(0,p.Ue)(e[0]),(0,p.Ue)(e[1]),(0,p.Ue)(e[2]),(0,p.Ue)(e[3]),(0,p.Ue)(e[4]),(0,p.Ue)(e[5])]:[(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)()]}function g(){return[(0,c.c)(),(0,c.c)(),(0,c.c)(),(0,c.c)(),(0,c.c)(),(0,c.c)(),(0,c.c)(),(0,c.c)()]}function y(e,t){for(let i=0;i<M.NUM;i++)(0,p.JG)(e[i],t[i])}function _(e,t,i,r=I){const s=(0,a.m)(f.MP.get(),t,e);(0,a.a)(s,s);for(let e=0;e<O.NUM;++e){const t=(0,u.t)(f.o6.get(),R[e],s);(0,l.s)(r[e],t[0]/t[3],t[1]/t[3],t[2]/t[3])}v(i,r)}function v(e,t){(0,p.zk)(t[s.FAR_BOTTOM_LEFT],t[s.NEAR_BOTTOM_LEFT],t[s.NEAR_TOP_LEFT],e[r.LEFT]),(0,p.zk)(t[s.NEAR_BOTTOM_RIGHT],t[s.FAR_BOTTOM_RIGHT],t[s.FAR_TOP_RIGHT],e[r.RIGHT]),(0,p.zk)(t[s.FAR_BOTTOM_LEFT],t[s.FAR_BOTTOM_RIGHT],t[s.NEAR_BOTTOM_RIGHT],e[r.BOTTOM]),(0,p.zk)(t[s.NEAR_TOP_LEFT],t[s.NEAR_TOP_RIGHT],t[s.FAR_TOP_RIGHT],e[r.TOP]),(0,p.zk)(t[s.NEAR_BOTTOM_LEFT],t[s.NEAR_BOTTOM_RIGHT],t[s.NEAR_TOP_RIGHT],e[r.NEAR]),(0,p.zk)(t[s.FAR_BOTTOM_RIGHT],t[s.FAR_BOTTOM_LEFT],t[s.FAR_TOP_LEFT],e[r.FAR])}function b(e,t){for(let i=0;i<M.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function w(e,t){return E(e,(0,d.iL)(t,P.get()))}function x(e,t){for(let i=0;i<M.NUM;i++){const r=e[i];if(!(0,p.Er)(r,t))return!1}return!0}function C(e,t,i){return E(e,(0,d._k)(t,i,P.get()))}function T(e,t){for(let i=0;i<M.NUM;i++)if((0,p.jH)(e[i],t)>0)return!1;return!0}function S(e,t){for(let i=0;i<M.NUM;i++)if((0,p.U4)(e[i],t))return!1;return!0}function E(e,t){for(let i=0;i<M.NUM;i++)if(!(0,p.oq)(e[i],t))return!1;return!0}(n=r||(r={}))[n.LEFT=0]="LEFT",n[n.RIGHT=1]="RIGHT",n[n.BOTTOM=2]="BOTTOM",n[n.TOP=3]="TOP",n[n.NEAR=4]="NEAR",n[n.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(s||(s={}));const A={bottom:[s.FAR_BOTTOM_RIGHT,s.NEAR_BOTTOM_RIGHT,s.NEAR_BOTTOM_LEFT,s.FAR_BOTTOM_LEFT],near:[s.NEAR_BOTTOM_LEFT,s.NEAR_BOTTOM_RIGHT,s.NEAR_TOP_RIGHT,s.NEAR_TOP_LEFT],far:[s.FAR_BOTTOM_RIGHT,s.FAR_BOTTOM_LEFT,s.FAR_TOP_LEFT,s.FAR_TOP_RIGHT],right:[s.NEAR_BOTTOM_RIGHT,s.FAR_BOTTOM_RIGHT,s.FAR_TOP_RIGHT,s.NEAR_TOP_RIGHT],left:[s.FAR_BOTTOM_LEFT,s.NEAR_BOTTOM_LEFT,s.NEAR_TOP_LEFT,s.FAR_TOP_LEFT],top:[s.FAR_TOP_LEFT,s.NEAR_TOP_LEFT,s.NEAR_TOP_RIGHT,s.FAR_TOP_RIGHT]};var M,O;!function(e){e[e.NUM=6]="NUM"}(M||(M={})),function(e){e[e.NUM=8]="NUM"}(O||(O={}));const R=[(0,h.f)(-1,-1,-1,1),(0,h.f)(1,-1,-1,1),(0,h.f)(1,1,-1,1),(0,h.f)(-1,1,-1,1),(0,h.f)(-1,-1,1,1),(0,h.f)(1,-1,1,1),(0,h.f)(1,1,1,1),(0,h.f)(-1,1,1,1)],P=new o.x(d.Ue),I=g()},36285:(e,t,i)=>{"use strict";i.d(t,{Dg:()=>c,Yr:()=>s,cD:()=>l,yB:()=>n});var r=i(14260);const s=Math.PI/180,n=/SPHEROID\[([^\]]+)]/i,o=r.sv.radius,a=r.sv.eccentricitySquared,l={a1:o*a,a2:o*a*o*a,a3:o*a*a/2,a4:o*a*o*a*2.5,a5:o*a+o*a*a/2,a6:1-a},c={4267:{a:6378206.4,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:r.sv.radius,f:r.sv.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:r.Z1.radius,f:r.Z1.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:r.yr.radius,f:r.yr.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:r.yr.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}}},64862:(e,t,i)=>{"use strict";i.d(t,{Ku:()=>d,Wt:()=>c,qC:()=>g}),i(39994);var r,s,n=i(70375),o=i(61681),a=i(64307),l=i(20692);function c(e,t,i){const s=d(e),o=t,l=u(s,o,i);if(s){const t=a.Z.deriveUnitFromSR(s,e.spatialReference).heightUnit;if(!i&&t!==s.heightUnit){const e=new n.Z("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${t})`,{horizontalUnit:t});return new n.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:s,error:e})}}if(!("heightModelInfo"in(c=e)&&null!=c.heightModelInfo||null!=c.spatialReference)&&m(c)||l===r.Unsupported)return new n.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:s});var c;switch(l){case r.Units:{const e=s.heightUnit||"unknown",t=o.heightUnit||"unknown",i=new n.Z("layerview:incompatible-height-unit",`The vertical units of the layer (${e}) must match the vertical units of the scene (${t})`,{layerUnit:e,sceneUnit:t});return new n.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:s,sceneHeightModelInfo:o,error:i})}case r.HeightModel:{const e=s.heightModel||"unknown",t=o.heightModel||"unknown",i=new n.Z("layerview:incompatible-height-model",`The height model of the layer (${e}) must match the height model of the scene (${t})`,{layerHeightModel:e,sceneHeightModel:t});return new n.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:s,sceneHeightModelInfo:o,error:i})}case r.CRS:{const e=s.vertCRS||"unknown",t=o.vertCRS||"unknown",i=new n.Z("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${e}) must match the vertical datum of the scene (${t})`,{layerDatum:e,sceneDatum:t});return new n.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:s,sceneHeightModelInfo:o,error:i})}}return null}function u(e,t,i){if(!h(e)||!h(t))return r.Unsupported;if(null==e||null==t)return r.Ok;if(!i&&e.heightUnit!==t.heightUnit)return r.Units;if(e.heightModel!==t.heightModel)return r.HeightModel;switch(e.heightModel){case"gravity-related-height":return r.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?r.Ok:r.CRS;default:return r.Unsupported}}function h(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function d(e){const t=e.url&&(0,l.Qc)(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&(0,o.pC)(t)&&"ImageServer"===t.serverType||!p(e)||!e.heightModelInfo?m(e)?a.Z.deriveUnitFromSR(_,e.spatialReference):null:e.heightModelInfo}function p(e){return"heightModelInfo"in e}function f(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function m(e){return f(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):y(e)}function g(e){return null!=e.layers||y(e)||f(e)||p(e)}function y(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(s=r||(r={}))[s.Ok=0]="Ok",s[s.Units=1]="Units",s[s.HeightModel=2]="HeightModel",s[s.CRS=3]="CRS",s[s.Unsupported=4]="Unsupported";const _=new a.Z({heightModel:"gravity-related-height"})},68668:(e,t,i)=>{"use strict";i.d(t,{Ff:()=>g,IY:()=>v,UT:()=>_,h_:()=>n});var r=i(27127);function s(e,t){return(0,r.aV)(e,t)}function n(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ)if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1;return!0}function o(e,t){const{points:i,hasZ:s}=t,n=s?r.Qg:r.OQ;for(const t of i)if(n(e,t))return!0;return!1}const a=[0,0],l=[0,0],c=[0,0],u=[0,0],h=[a,l,c,u],d=[[c,a],[a,l],[l,u],[u,c]];function p(e,t){return function(e,t){a[0]=e.xmin,a[1]=e.ymax,l[0]=e.xmax,l[1]=e.ymax,c[0]=e.xmin,c[1]=e.ymin,u[0]=e.xmax,u[1]=e.ymin;for(const e of h)if((0,r.wP)(t,e))return!0;for(const i of t){if(!i.length)continue;let t=i[0];if((0,r.OQ)(e,t))return!0;for(let s=1;s<i.length;s++){const n=i[s];if((0,r.OQ)(e,n)||y(t,n,d))return!0;t=n}}return!1}(e,t.rings)}function f(e,t){a[0]=e.xmin,a[1]=e.ymax,l[0]=e.xmax,l[1]=e.ymax,c[0]=e.xmin,c[1]=e.ymin,u[0]=e.xmax,u[1]=e.ymin;const i=t.paths;for(const t of i){if(!i.length)continue;let s=t[0];if((0,r.OQ)(e,s))return!0;for(let i=1;i<t.length;i++){const n=t[i];if((0,r.OQ)(e,n)||y(s,n,d))return!0;s=n}}return!1}const m=[0,0];function g(e){for(let t=0;t<e.length;t++){const i=e[t];for(let r=0;r<i.length-1;r++){const s=i[r],n=i[r+1];for(let i=t+1;i<e.length;i++)for(let t=0;t<e[i].length-1;t++){const r=e[i][t],o=e[i][t+1];if(_(s,n,r,o,m)&&!(m[0]===s[0]&&m[1]===s[1]||m[0]===r[0]&&m[1]===r[1]||m[0]===n[0]&&m[1]===n[1]||m[0]===o[0]&&m[1]===o[1]))return!0}}const r=i.length;if(!(r<=4))for(let e=0;e<r-3;e++){let t=r-1;0===e&&(t=r-2);const s=i[e],n=i[e+1];for(let r=e+2;r<t;r++){const e=i[r],t=i[r+1];if(_(s,n,e,t,m)&&!(m[0]===s[0]&&m[1]===s[1]||m[0]===e[0]&&m[1]===e[1]||m[0]===n[0]&&m[1]===n[1]||m[0]===t[0]&&m[1]===t[1]))return!0}}}return!1}function y(e,t,i){for(let r=0;r<i.length;r++)if(_(e,t,i[r][0],i[r][1]))return!0;return!1}function _(e,t,i,r,s){const[n,o]=e,[a,l]=t,[c,u]=i,[h,d]=r,p=h-c,f=n-c,m=a-n,g=d-u,y=o-u,_=l-o,v=g*m-p*_;if(0===v)return!1;const b=(p*y-g*f)/v,w=(m*y-_*f)/v;return b>=0&&b<=1&&w>=0&&w<=1&&(s&&(s[0]=n+b*(a-n),s[1]=o+b*(l-o)),!0)}function v(e){switch(e){case"esriGeometryEnvelope":case"extent":return n;case"esriGeometryMultipoint":case"multipoint":return o;case"esriGeometryPoint":case"point":return s;case"esriGeometryPolygon":case"polygon":return p;case"esriGeometryPolyline":case"polyline":return f}}},53736:(e,t,i)=>{"use strict";i.d(t,{Ji:()=>g,YX:()=>u,aW:()=>h,im:()=>m,l9:()=>p,oU:()=>f,q9:()=>_,wp:()=>d});var r=i(61681),s=i(91772),n=i(20031),o=i(74304),a=i(53446),l=i(89542),c=i(90819);function u(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function h(e){return void 0!==e.points}function d(e){return void 0!==e.x&&void 0!==e.y}function p(e){return void 0!==e.paths}function f(e){return void 0!==e.rings}function m(e){return(0,r.Wi)(e)?null:e instanceof n.Z?e:d(e)?a.Z.fromJSON(e):p(e)?c.Z.fromJSON(e):f(e)?l.Z.fromJSON(e):h(e)?o.Z.fromJSON(e):u(e)?s.Z.fromJSON(e):null}function g(e){return e?d(e)?"esriGeometryPoint":p(e)?"esriGeometryPolyline":f(e)?"esriGeometryPolygon":u(e)?"esriGeometryEnvelope":h(e)?"esriGeometryMultipoint":null:null}const y={esriGeometryPoint:a.Z,esriGeometryPolyline:c.Z,esriGeometryPolygon:l.Z,esriGeometryEnvelope:s.Z,esriGeometryMultipoint:o.Z};function _(e){return e&&y[e]||null}},56215:(e,t,i)=>{"use strict";i.d(t,{AR:()=>y,Gr:()=>g,JG:()=>c,Jk:()=>d,KU:()=>f,Ue:()=>l,al:()=>u,ct:()=>m,nF:()=>p,zk:()=>h});var r=i(19431),s=i(19480),n=i(6766),o=i(8909),a=i(68817);function l(e){return e?{origin:(0,o.a)(e.origin),vector:(0,o.a)(e.vector)}:{origin:(0,o.c)(),vector:(0,o.c)()}}function c(e,t=l()){return u(e.origin,e.vector,t)}function u(e,t,i=l()){return(0,n.c)(i.origin,e),(0,n.c)(i.vector,t),i}function h(e,t,i=l()){return(0,n.c)(i.origin,e),(0,n.b)(i.vector,t,e),i}function d(e,t){const i=(0,n.b)(a.WM.get(),t,e.origin),s=(0,n.e)(e.vector,i),o=(0,n.e)(e.vector,e.vector),l=(0,r.uZ)(s/o,0,1),c=(0,n.b)(a.WM.get(),(0,n.g)(a.WM.get(),e.vector,l),i);return(0,n.e)(c,c)}function p(e,t,i){return m(e,t,0,1,i)}function f(e,t,i){return(0,n.a)(i,e.origin,(0,n.g)(i,e.vector,t))}function m(e,t,i,s,o){const{vector:l,origin:c}=e,u=(0,n.b)(a.WM.get(),t,c),h=(0,n.e)(l,u)/(0,n.p)(l);return(0,n.g)(o,l,(0,r.uZ)(h,i,s)),(0,n.a)(o,o,e.origin)}function g(e,t){if(_(e,function(e,t){const i=b.get();return i.origin=e,i.vector=t,i}(t.origin,t.direction),!1,v)){const{tA:t,pB:i,distance2:r}=v;if(t>=0&&t<=1)return r;if(t<0)return(0,n.d)(e.origin,i);if(t>1)return(0,n.d)((0,n.a)(a.WM.get(),e.origin,e.vector),i)}return null}function y(e,t,i){return!!_(e,t,!0,v)&&((0,n.c)(i,v.pA),!0)}function _(e,t,i,s){const o=1e-6,l=e.origin,c=(0,n.a)(a.WM.get(),l,e.vector),u=t.origin,h=(0,n.a)(a.WM.get(),u,t.vector),d=a.WM.get(),p=a.WM.get();if(d[0]=l[0]-u[0],d[1]=l[1]-u[1],d[2]=l[2]-u[2],p[0]=h[0]-u[0],p[1]=h[1]-u[1],p[2]=h[2]-u[2],Math.abs(p[0])<o&&Math.abs(p[1])<o&&Math.abs(p[2])<o)return!1;const f=a.WM.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],Math.abs(f[0])<o&&Math.abs(f[1])<o&&Math.abs(f[2])<o)return!1;const m=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],g=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],y=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],_=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],v=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*_-g*g;if(Math.abs(v)<o)return!1;let b=(m*g-y*_)/v,w=(m+g*b)/_;i&&(b=(0,r.uZ)(b,0,1),w=(0,r.uZ)(w,0,1));const x=a.WM.get(),C=a.WM.get();return x[0]=l[0]+b*f[0],x[1]=l[1]+b*f[1],x[2]=l[2]+b*f[2],C[0]=u[0]+w*p[0],C[1]=u[1]+w*p[1],C[2]=u[2]+w*p[2],s.tA=b,s.tB=w,s.pA=x,s.pB=C,s.distance2=(0,n.d)(x,C),!0}const v={tA:0,tB:0,pA:(0,o.c)(),pB:(0,o.c)(),distance2:0},b=new s.x((()=>({origin:null,vector:null})))},67262:(e,t,i)=>{"use strict";i.d(t,{d:()=>s});var r=i(19431);function s(e,t,i){const s=e.byteLength/(4*t),c=new Uint32Array(e,0,s*t);let u=new Uint32Array(s);const h=i?.minReduction??0,d=i?.originalIndices||null,p=d?d.length:0,f=i?.componentOffsets||null;let m=0;if(f)for(let e=0;e<f.length-1;e++){const t=f[e+1]-f[e];t>m&&(m=t)}else m=s;const g=Math.floor(1.1*m)+1;(null==l||l.length<2*g)&&(l=new Uint32Array((0,r.Sf)(2*g)));for(let e=0;e<2*g;e++)l[e]=0;let y=0;const _=!!f&&!!d,v=_?p:s,b=_?new Uint32Array(p):null,w=1.96;let x=0!==h?Math.ceil(4*w*w/(h*h)*h*(1-h)):v,C=1,T=f?f[1]:v;for(let e=0;e<v;e++){if(e===x){const t=1-y/e;if(t+w*Math.sqrt(t*(1-t)/e)<h)return null;x*=2}if(e===T){for(let e=0;e<2*g;e++)l[e]=0;if(d)for(let e=f[C-1];e<f[C];e++)b[e]=u[d[e]];T=f[++C]}const i=_?d[e]:e,r=i*t,s=a(c,r,t);let o=s%g,p=y;for(;0!==l[2*o+1];){if(l[2*o]===s){const e=l[2*o+1]-1;if(n(c,r,e*t,t)){p=u[e];break}}o++,o>=g&&(o-=g)}p===y&&(l[2*o]=s,l[2*o+1]=i+1,y++),u[i]=p}if(0!==h&&1-y/s<h)return null;if(_){for(let e=f[C-1];e<b.length;e++)b[e]=u[d[e]];u=b}const S=new Uint32Array(t*y);y=0;for(let e=0;e<v;e++)u[e]===y&&(o(c,(_?d[e]:e)*t,S,y*t,t),y++);if(d&&!_){const e=new Uint32Array(p);for(let t=0;t<e.length;t++)e[t]=u[d[t]];u=e}return{buffer:S.buffer,indices:u,uniqueCount:y}}function n(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function o(e,t,i,r,s){for(let n=0;n<s;n++)i[r+n]=e[t+n]}function a(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let l=null},49921:(e,t,i)=>{"use strict";i.d(t,{Iz:()=>y,M2:()=>S,To:()=>b,VS:()=>C,XO:()=>v,Yk:()=>_,w9:()=>x,wi:()=>T,zZ:()=>w});var r=i(13802),s=i(61681),n=i(1662),o=i(34344),a=i(39100),l=i(6766),c=i(8909),u=i(90472),h=i(25726),d=i(35925),p=i(39536),f=i(81936),m=i(86717);const g=r.Z.getLogger("esri.geometry.support.meshUtils.normalProjection");function y(e,t,i,r,s){return A(r)?(E(O.TO_PCPF,f.ct.fromTypedArray(e),f.fP.fromTypedArray(t),f.fP.fromTypedArray(i),r,f.ct.fromTypedArray(s)),s):(g.error("Cannot convert spatial reference to PCPF"),s)}function _(e,t,i,r,s){return A(r)?(E(O.FROM_PCPF,f.ct.fromTypedArray(e),f.fP.fromTypedArray(t),f.fP.fromTypedArray(i),r,f.ct.fromTypedArray(s)),s):(g.error("Cannot convert to spatial reference from PCPF"),s)}function v(e,t,i){return(0,u.CM)(e,t,0,i,(0,h.rS)(t),0,e.length/3),i}function b(e,t,i){return(0,u.CM)(e,(0,h.rS)(i),0,t,i,0,e.length/3),t}function w(e,t,i){if((0,s.Wi)(e))return t;const r=f.fP.fromTypedArray(e),n=f.fP.fromTypedArray(t);return(0,m.t)(n,r,i),t}function x(e,t,i){if((0,s.Wi)(e))return t;(0,n.a)(D,i);const r=f.ct.fromTypedArray(e),o=f.ct.fromTypedArray(t);return(0,m.a)(o,r,D),(0,n.i)(D)||(0,m.n)(o,o),t}function C(e,t,i){if((0,s.Wi)(e))return t;(0,n.a)(D,i);const r=f.ct.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),o=f.ct.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if((0,m.a)(o,r,D),(0,n.i)(D)||(0,m.n)(o,o),e!==t)for(let i=3;i<e.length;i+=4)t[i]=e[i];return t}function T(e,t,i,r,s){if(!A(r))return g.error("Cannot convert spatial reference to PCPF"),s;E(O.TO_PCPF,f.ct.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),f.fP.fromTypedArray(t),f.fP.fromTypedArray(i),r,f.ct.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let t=3;t<e.length;t+=4)s[t]=e[t];return s}function S(e,t,i,r,s){if(!A(r))return g.error("Cannot convert to spatial reference from PCPF"),s;E(O.FROM_PCPF,f.ct.fromTypedArray(e,16),f.fP.fromTypedArray(t),f.fP.fromTypedArray(i),r,f.ct.fromTypedArray(s,16));for(let t=3;t<e.length;t+=4)s[t]=e[t];return s}function E(e,t,i,r,s,o){if(!t)return;const a=i.count,c=(0,h.rS)(s);if(M(s))for(let i=0;i<a;i++)r.getVec(i,P),t.getVec(i,I),(0,u.Bm)(c,P,L,c),(0,n.f)(D,L),e===O.FROM_PCPF&&(0,n.t)(D,D),(0,l.t)(I,I,D),o.setVec(i,I);else for(let s=0;s<a;s++){r.getVec(s,P),t.getVec(s,I),(0,u.Bm)(c,P,L,c),(0,n.f)(D,L);const a=(0,p.mZ)(i.get(s,1));let h=Math.cos(a);e===O.TO_PCPF&&(h=1/h),D[0]*=h,D[1]*=h,D[2]*=h,D[3]*=h,D[4]*=h,D[5]*=h,e===O.FROM_PCPF&&(0,n.t)(D,D),(0,l.t)(I,I,D),(0,l.n)(I,I),o.setVec(s,I)}return o}function A(e){return M(e)||function(e){return e.isWebMercator}(e)}function M(e){return e.isWGS84||(0,d.yW)(e)||(0,d.BZ)(e)||(0,d.V2)(e)}var O,R;(R=O||(O={}))[R.TO_PCPF=0]="TO_PCPF",R[R.FROM_PCPF=1]="FROM_PCPF";const P=(0,c.c)(),I=(0,c.c)(),L=(0,a.c)(),D=(0,o.c)()},49756:(e,t,i)=>{"use strict";i.d(t,{aX:()=>w});var r=i(51366),s=i(70375),n=i(13802),o=i(61681),a=i(89542),l=i(90819),c=i(25266),u=i(35925),h=i(39536),d=(i(91957),i(66341)),p=i(3466),f=i(53736);const m=n.Z.getLogger("esri.geometry.support.normalizeUtils");function g(e){return"polygon"===e[0].type}function y(e){return"polyline"===e[0].type}function _(e,t,i){if(t){const t=function(e,t){if(!(e instanceof l.Z||e instanceof a.Z)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw m.error(e),new s.Z(e)}const i=(0,c.x3)(e),r=[];for(const e of i){const i=[];r.push(i),i.push([e[0][0],e[0][1]]);for(let r=0;r<e.length-1;r++){const s=e[r][0],n=e[r][1],o=e[r+1][0],a=e[r+1][1],l=Math.sqrt((o-s)*(o-s)+(a-n)*(a-n)),c=(a-n)/l,u=(o-s)/l,h=l/t;if(h>1){for(let e=1;e<=h-1;e++){const r=e*t,o=u*r+s,a=c*r+n;i.push([o,a])}const e=(l+Math.floor(h-1)*t)/2,r=u*e+s,o=c*e+n;i.push([r,o])}i.push([o,a])}}return function(e){return"polygon"===e.type}(e)?new a.Z({rings:r,spatialReference:e.spatialReference}):new l.Z({paths:r,spatialReference:e.spatialReference})}(e,1e6);e=(0,h.Sx)(t,!0)}return i&&(e=(0,c.Sy)(e,i)),e}function v(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const i=(0,c.XZ)(r,t);e[0]=r+i*(-2*t)}else if(r<i){const t=(0,c.XZ)(r,i);e[0]=r+t*(-2*i)}}else{const r=e.x;if(r>t){const i=(0,c.XZ)(r,t);e=e.clone().offset(i*(-2*t),0)}else if(r<i){const t=(0,c.XZ)(r,i);e=e.clone().offset(t*(-2*i),0)}}return e}function b(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],o=(0,c.x3)(n);for(let e=0;e<o.length;e++){const t=o[e];t.some((i=>{if(i[0]<180)return!0;{let i=0;for(let e=0;e<t.length;e++){const r=t[e][0];i=r>i?r:i}i=Number(i.toFixed(9));const r=-360*(0,c.XZ)(i,180);for(let i=0;i<t.length;i++){const t=n.getPoint(e,i);n.setPoint(e,i,t.clone().offset(r,0))}return!0}}))}if(s===i){if(g(e))for(const t of(0,c.x3)(n))e[s]=e[s].addRing(t);else if(y(e))for(const t of(0,c.x3)(n))e[s]=e[s].addPath(t)}else i=s,e[s]=n}return e}async function w(e,t,i){if(!Array.isArray(e))return w([e],t);t&&"string"!=typeof t&&m.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const s="string"==typeof t?t:t?.url??r.Z.geometryServiceUrl;let n,g,y,x,C,T,S,E,A=0;const M=[],O=[];for(const t of e)if((0,o.Wi)(t))O.push(t);else if(n||(n=t.spatialReference,g=(0,u.C5)(n),y=n.isWebMercator,T=y?102100:4326,x=c.UZ[T].maxX,C=c.UZ[T].minX,S=c.UZ[T].plus180Line,E=c.UZ[T].minus180Line),g)if("mesh"===t.type)O.push(t);else if("point"===t.type)O.push(v(t.clone(),x,C));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>v(e,x,C))),O.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,g);O.push(e.rings?new a.Z(e):e)}else if(t.extent){const e=t.extent,i=(0,c.XZ)(e.xmin,C)*(2*x);let r=0===i?t.clone():(0,c.Sy)(t.clone(),i);e.offset(i,0),e.intersects(S)&&e.xmax!==x?(A=e.xmax>A?e.xmax:A,r=_(r,y),M.push(r),O.push("cut")):e.intersects(E)&&e.xmin!==C?(A=e.xmax*(2*x)>A?e.xmax*(2*x):A,r=_(r,y,360),M.push(r),O.push("cut")):O.push(r)}else O.push(t.clone());else O.push(t);let R=(0,c.XZ)(A,x),P=-90;const I=R,L=new l.Z;for(;R>0;){const e=360*R-180;L.addPath([[e,P],[e,-1*P]]),P*=-1,R--}if(M.length>0&&I>0){const t=b(M,await async function(e,t,i,r){const s="string"==typeof e?(0,p.mN)(e):e,n=t[0].spatialReference,o={...r,query:{...s.query,f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:(0,f.Ji)(t[0]),geometries:t}),cutter:JSON.stringify(i)}},a=await(0,d.default)(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map((e=>{const t=(0,f.im)(e);return t.spatialReference=n,t}))}}(s,M,L,i)),r=[],n=[];for(let i=0;i<O.length;i++){const s=O[i];if("cut"!==s)n.push(s);else{const s=t.shift(),a=e[i];(0,o.pC)(a)&&"polygon"===a.type&&a.rings&&a.rings.length>1&&s.rings.length>=a.rings.length?(r.push(s),n.push("simplify")):n.push(y?(0,h.$)(s):s)}}if(!r.length)return n;const a=await async function(e,t,i){const r="string"==typeof e?(0,p.mN)(e):e,s=t[0].spatialReference,n=(0,f.Ji)(t[0]),o={...i,query:{...r.query,f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify((a=t,{geometryType:(0,f.Ji)(a[0]),geometries:a.map((e=>e.toJSON()))}))}};var a;return function(e,t,i){const r=(0,f.q9)(t);return e.map((e=>{const t=r.fromJSON(e);return t.spatialReference=i,t}))}((await(0,d.default)(r.path+"/simplify",o)).data,n,s)}(s,r,i),l=[];for(let e=0;e<n.length;e++){const t=n[e];"simplify"!==t?l.push(t):l.push(y?(0,h.$)(a.shift()):a.shift())}return l}const D=[];for(let e=0;e<O.length;e++){const t=O[e];if("cut"!==t)D.push(t);else{const e=M.shift();D.push(!0===y?(0,h.$)(e):e)}}return D}},25266:(e,t,i)=>{"use strict";i.d(t,{Sy:()=>l,UZ:()=>o,XZ:()=>a,x3:()=>c});var r=i(90819),s=i(14685),n=i(53736);const o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new r.Z({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:s.Z.WebMercator}),minus180Line:new r.Z({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:s.Z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new r.Z({paths:[[[180,-180],[180,180]]],spatialReference:s.Z.WGS84}),minus180Line:new r.Z({paths:[[[-180,-180],[-180,180]]],spatialReference:s.Z.WGS84})}};function a(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const i=c(e);for(const e of i)for(const i of e)i[0]+=t;return e}function c(e){return(0,n.oU)(e)?e.rings:e.paths}},69430:(e,t,i)=>{"use strict";i.d(t,{$I:()=>m,Ac:()=>O,BR:()=>E,Er:()=>I,JG:()=>u,Oy:()=>d,T5:()=>x,U4:()=>R,Ue:()=>l,Yq:()=>p,_l:()=>D,al:()=>h,dZ:()=>M,fn:()=>S,jH:()=>N,mJ:()=>k,my:()=>T,nF:()=>L,oq:()=>P,re:()=>c,rx:()=>A,tk:()=>C,zk:()=>f});var r=i(19431),s=i(61681),n=i(6766),o=i(8909),a=(i(91917),i(5700),i(68817));function l(e=U){return[e[0],e[1],e[2],e[3]]}function c(e=U[0],t=U[1],i=U[2],r=U[3]){return h(e,t,i,r,a.o6.get())}function u(e,t){return h(t[0],t[1],t[2],t[3],e)}function h(e,t,i,r,s=l()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function d(e,t,i){return(0,n.c)(i,e),i[3]=t,i}function p(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function f(e,t,i,r=l()){const s=i[0]-t[0],n=i[1]-t[1],o=i[2]-t[2],a=e[0]-t[0],c=e[1]-t[1],u=e[2]-t[2],h=n*u-o*c,d=o*a-s*u,p=s*c-n*a,f=h*h+d*d+p*p,m=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;return r[0]=h*m,r[1]=d*m,r[2]=p*m,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function m(e,t,i,r,s){if(e.count<3)return!1;e.getVec(i,y);let o=r,a=!1;for(;o<e.count-1&&!a;)e.getVec(o,_),o++,a=!(0,n.k)(y,_);if(!a)return!1;for(o=Math.max(o,s),a=!1;o<e.count&&!a;)e.getVec(o,v),o++,(0,n.b)(b,y,_),(0,n.n)(b,b),(0,n.b)(w,_,v),(0,n.n)(w,w),a=!(0,n.k)(y,v)&&!(0,n.k)(_,v)&&Math.abs((0,n.e)(b,w))<g;return a?(f(y,_,v,t),!0):(0!==i||1!==r||2!==s)&&m(e,t,0,1,2)}i(35369);const g=.99619469809,y=(0,o.c)(),_=(0,o.c)(),v=(0,o.c)(),b=(0,o.c)(),w=(0,o.c)();function x(e,t,i){return t!==e&&u(e,t),e[3]=-(0,n.e)(e,i),e}function C(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function T(e,t,i,r){return(0,n.f)(v,t,e),p(i,v,r)}function S(e,t,i,r){return F(e,t,(0,n.b)(a.WM.get(),i,t),B,r)}function E(e,t,i){return!!(0,s.pC)(t)&&F(e,t.origin,t.direction,H,i)}function A(e,t,i){return F(e,t.origin,t.vector,V.NONE,i)}function M(e,t,i){return F(e,t.origin,t.vector,V.CLAMP,i)}function O(e,t){return N(e,t)>=0}function R(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];return e[0]*(e[0]>0?i:n)+e[1]*(e[1]>0?r:o)+e[2]*(e[2]>0?s:a)+e[3]>=0}function P(e,t){const i=(0,n.e)(e,t.ray.direction),r=-N(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function I(e,t){const i=(0,n.e)(e,t.ray.direction),r=-N(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function L(e,t,i){const r=(0,n.g)(a.WM.get(),e,-e[3]),s=D(e,(0,n.b)(a.WM.get(),t,r),a.WM.get());return(0,n.a)(i,s,r),i}function D(e,t,i){const r=(0,n.g)(a.WM.get(),e,(0,n.e)(e,t));return(0,n.b)(i,t,r),i}function N(e,t){return(0,n.e)(e,t)+e[3]}function F(e,t,i,s,o){const a=(0,n.e)(e,i);if(0===a)return!1;let l=-((0,n.e)(e,t)+e[3])/a;return s&V.CLAMP&&(l=(0,r.uZ)(l,0,1)),!(!(s&V.INFINITE_MIN)&&l<0||!(s&V.INFINITE_MAX)&&l>1||((0,n.a)(o,t,(0,n.g)(o,i,l)),0))}function k(e){return e}const U=[0,0,1,0];var V,z;(z=V||(V={}))[z.NONE=0]="NONE",z[z.CLAMP=1]="CLAMP",z[z.INFINITE_MIN=4]="INFINITE_MIN",z[z.INFINITE_MAX=8]="INFINITE_MAX";const B=V.INFINITE_MIN|V.INFINITE_MAX,H=V.INFINITE_MAX},7505:(e,t,i)=>{"use strict";i.d(t,{G6:()=>g,Ie:()=>m,J9:()=>p,RF:()=>d,U1:()=>f,vY:()=>a});var r=i(61681);i(53736);const s=(e,t,i)=>[t,i],n=(e,t,i)=>[t,i,e[2]],o=(e,t,i)=>[t,i,e[2],e[3]];function a(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:(0,r.pC)(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},i){return i*e[0]+t[0]}function c({scale:e,translate:t},i){return t[1]-i*e[1]}function u(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let o=l(e,i[0][0]),a=c(e,i[0][1]);r[0]=t(i[0],o,a);for(let e=1;e<i.length;e++){const l=i[e];o+=l[0]*s,a-=l[1]*n,r[e]=t(l,o,a)}return r}function h(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=u(e,t,i[s]);return r}function d(e,t,i,r,s){return t.x=function({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}(e,i.x),t.y=function({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function p(e,t,i,a,l){return(0,r.pC)(i)&&(t.points=function(e,t,i,r){return u(e,i?r?o:n:r?n:s,t)}(e,i.points,a,l)),t}function f(e,t,i,s,n){return(0,r.Wi)(i)||(t.x=l(e,i.x),t.y=c(e,i.y),t!==i&&(s&&(t.z=i.z),n&&(t.m=i.m))),t}function m(e,t,i,a,l){return(0,r.pC)(i)&&(t.rings=function(e,t,i,r){return h(e,i?r?o:n:r?n:s,t)}(e,i.rings,a,l)),t}function g(e,t,i,a,l){return(0,r.pC)(i)&&(t.paths=function(e,t,i,r){return h(e,i?r?o:n:r?n:s,t)}(e,i.paths,a,l)),t}},97537:(e,t,i)=>{"use strict";i.d(t,{JG:()=>h,JI:()=>m,Jk:()=>f,Ue:()=>l,al:()=>p,fS:()=>c,re:()=>u,zk:()=>d});var r=i(7753),s=i(19480),n=i(6766),o=i(8909),a=i(68817);function l(e){return e?{origin:(0,o.a)(e.origin),direction:(0,o.a)(e.direction)}:{origin:(0,o.c)(),direction:(0,o.c)()}}function c(e,t){return(0,r.fS)(e.origin,t.origin)&&(0,r.fS)(e.direction,t.direction)}function u(e,t){const i=g.get();return i.origin=e,i.direction=t,i}function h(e,t=l()){return p(e.origin,e.direction,t)}function d(e,t,i=l()){return(0,n.c)(i.origin,e),(0,n.b)(i.direction,t,e),i}function p(e,t,i=l()){return(0,n.c)(i.origin,e),(0,n.c)(i.direction,t),i}function f(e,t){const i=(0,n.f)(a.WM.get(),(0,n.n)(a.WM.get(),e.direction),(0,n.b)(a.WM.get(),t,e.origin));return(0,n.e)(i,i)}function m(e,t,i){const r=(0,n.e)(e.direction,(0,n.b)(i,t,e.origin));return(0,n.a)(i,e.origin,(0,n.g)(i,e.direction,r)),i}const g=new s.x((function(){return{origin:null,direction:null}}))},68577:(e,t,i)=>{"use strict";i.d(t,{D9:()=>o,dp:()=>n,yZ:()=>s});var r=i(17321);function s(e,t){const i=t||e.extent,s=e.width,n=(0,r.c9)(i&&i.spatialReference);return i&&s?i.width/s*n*r.hd*96:0}function n(e,t){return e/((0,r.c9)(t)*r.hd*96)}function o(e,t){const i=e.extent,r=e.width,s=n(t,i.spatialReference);return i.clone().expand(s*r/i.width)}},35925:(e,t,i)=>{"use strict";i.d(t,{BZ:()=>x,C5:()=>f,JY:()=>E,ME:()=>C,MP:()=>S,N$:()=>g,QM:()=>b,R_:()=>M,V2:()=>T,WR:()=>O,Zn:()=>A,fS:()=>p,o$:()=>w,oR:()=>y,sS:()=>v,sT:()=>m,yW:()=>_});var r=i(61681),s=i(21130),n=i(52345),o=i(36644);const a={102113:!0,102100:!0,3857:!0,3785:!0},l={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},c='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',u=[-20037508.342788905,20037508.342788905],h=[-20037508.342787,20037508.342787],d={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:u,origin:h,dx:1e-5},102100:{wkTemplate:c,valid:u,origin:h,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:u,origin:h,dx:1e-5},3857:{wkTemplate:c,valid:u,origin:h,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function p(e,t){return!(0,r.Wi)(e)&&!(0,r.Wi)(t)&&(e===t||(null!=e.wkid||null!=t.wkid?e.wkid===t.wkid||v(e)&&v(t)||null!=t.latestWkid&&e.wkid===t.latestWkid||null!=e.latestWkid&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function f(e){return E(e)&&e.wkid&&d[e.wkid]||null}function m(e){return!!E(e)&&(e.wkid?null==o.Z[e.wkid]:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function g(e){return!(x(e)||T(e))}function y(e){return E(e)&&4326===e.wkid}function _(e){return E(e)&&e.wkid===n.W.CGCS2000}function v(e){return E(e)&&null!=e.wkid&&!0===a[e.wkid]}function b(e){return E(e)&&32662===e.wkid}function w(e){return e===n.W.GCSMARS2000||e===n.W.GCSMARS2000_SPHERE}function x(e){return E(e)&&null!=e.wkid&&w(e.wkid)}function C(e){return e===n.W.GCSMOON2000}function T(e){return E(e)&&null!=e.wkid&&C(e.wkid)}function S(e){return E(e)&&null!=e.wkid&&!0===l[e.wkid]}function E(e){return(0,r.pC)(e)&&(null!=e.wkid&&e.wkid>=2e3||null!=e.wkt)}const A={wkid:4326,wkt:(0,s.gx)(d[4326].wkTemplate,{Central_Meridian:"0.0"})},M={wkid:102100,latestWkid:3857},O={wkid:32662}},42772:(e,t,i)=>{"use strict";i.d(t,{bE:()=>l,wu:()=>a});var r=i(19480),s=i(6766),n=i(8909),o=i(56215);function a(e,t,i){const r=t[0]-e[0],s=t[1]-e[1],n=i[0]-e[0],o=i[1]-e[1];return.5*Math.abs(r*o-s*n)}function l(e,t,i){return(0,s.b)(c,t,e),(0,s.b)(u,i,e),(0,s.l)((0,s.f)(c,c,u))/2}i(68817),new r.x(o.Ue),new r.x((()=>({p0:null,p1:null,p2:null})));const c=(0,n.c)(),u=(0,n.c)()},35413:(e,t,i)=>{"use strict";i.d(t,{Mk:()=>c,ZI:()=>r,bT:()=>l});var r,s,n=i(5992),o=i(38028),a=i(67262);function l(e){const t=c(e.rings,e.hasZ,r.CCW_IS_HOLE),i=[];let s=0,o=0;for(const e of t.polygons){const r=e.count,a=e.index,l=new Float64Array(t.position.buffer,3*a*t.position.BYTES_PER_ELEMENT,3*r),c=e.holeIndices.map((e=>e-a)),u=new Uint32Array((0,n.e)(l,c,3));i.push({position:l,faces:u}),s+=l.length,o+=u.length}const l=function(e,t,i){if(1===e.length)return e[0];const r=new Float64Array(t),s=new Uint32Array(i);let n=0,o=0,a=0;for(const t of e){for(let e=0;e<t.position.length;e++)r[n++]=t.position[e];for(let e=0;e<t.faces.length;e++)s[o++]=t.faces[e]+a;a=n/3}return{position:r,faces:s}}(i,s,o),u=(0,a.d)(l.position.buffer,6,{originalIndices:l.faces});return l.position=new Float64Array(u.buffer),l.faces=u.indices,l}function c(e,t,i){const s=e.length,n=new Array(s),o=new Array(s),a=new Array(s);let l=0,c=0,d=0,p=0;for(let t=0;t<s;++t)p+=e[t].length;const f=new Float64Array(3*p);let m=0;for(let p=s-1;p>=0;p--){const g=e[p],y=i===r.CCW_IS_HOLE&&h(g);if(y&&1!==s)n[l++]=g;else{let e=g.length;for(let t=0;t<l;++t)e+=n[t].length;const i={index:m,pathLengths:new Array(l+1),count:e,holeIndices:new Array(l)};i.pathLengths[0]=g.length,g.length>0&&(a[d++]={index:m,count:g.length}),m=y?u(g,g.length-1,-1,f,m,g.length,t):u(g,0,1,f,m,g.length,t);for(let e=0;e<l;++e){const r=n[e];i.holeIndices[e]=m,i.pathLengths[e+1]=r.length,r.length>0&&(a[d++]={index:m,count:r.length}),m=u(r,0,1,f,m,r.length,t)}l=0,i.count>0&&(o[c++]=i)}}for(let e=0;e<l;++e){const i=n[e];i.length>0&&(a[d++]={index:m,count:i.length}),m=u(i,0,1,f,m,i.length,t)}return c<s&&(o.length=c),d<s&&(a.length=d),{position:f,polygons:o,outlines:a}}function u(e,t,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const n=e[t];r[s++]=n[0],r[s++]=n[1],r[s++]=o?n[2]:0,t+=i}return s/3}function h(e){return!(0,o.bu)(e,!1,!1)}(s=r||(r={}))[s.NONE=0]="NONE",s[s.CCW_IS_HOLE=1]="CCW_IS_HOLE"},59659:(e,t,i)=>{"use strict";i.d(t,{Mk:()=>s,P$:()=>n});var r=i(25709);const s=(0,r.w)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),n=(0,r.w)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"})},5700:(e,t,i)=>{"use strict";i.d(t,{EU:()=>a,SR:()=>o,cp:()=>l});var r=i(19431),s=i(6766),n=i(8909);function o(e,t){return(0,s.e)(e,t)/(0,s.l)(e)}function a(e,t){const i=(0,s.e)(e,t)/((0,s.l)(e)*(0,s.l)(t));return-(0,r.ZF)(i)}function l(e,t,i){(0,s.n)(c,e),(0,s.n)(u,t);const n=(0,s.e)(c,u),o=(0,r.ZF)(n),a=(0,s.f)(c,c,u);return(0,s.e)(a,i)<0?2*Math.PI-o:o}const c=(0,n.c)(),u=(0,n.c)()},68817:(e,t,i)=>{"use strict";i.d(t,{MP:()=>g,vD:()=>y,qW:()=>p,WM:()=>f,o6:()=>m});var r=i(4745),s=i(66581),n=i(34344),o=i(39100),a=i(61044),l=i(69666),c=i(8909),u=i(1983);class h{constructor(e,t,i){this.itemByteSize=e,this.itemCreate=t,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this.itemByteSize)}get(){0===this._itemsPtr&&(0,s.Y)((()=>this._reset()));const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const e=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let t=0;t<this._itemsPerBuffer;++t)this._items.push(this.itemCreate(e,t*this.itemByteSize));this._buffers.push(e)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=d){return new h(16,l.c,e)}static createVec3f64(e=d){return new h(24,c.b,e)}static createVec4f64(e=d){return new h(32,u.a,e)}static createMat3f64(e=d){return new h(72,n.a,e)}static createMat4f64(e=d){return new h(128,o.a,e)}static createQuatf64(e=d){return new h(32,a.c,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const d=4*r.Y8.KILOBYTES,p=h.createVec2f64(),f=h.createVec3f64(),m=h.createVec4f64(),g=(h.createMat3f64(),h.createMat4f64()),y=h.createQuatf64()},39536:(e,t,i)=>{"use strict";i.d(t,{$:()=>v,Q8:()=>m,R6:()=>_,Sx:()=>b,hG:()=>y,iV:()=>g,mZ:()=>h,tp:()=>u});var r=i(67134),s=i(61681),n=i(14685),o=i(14260),a=i(35925);function l(e){return 57.29577951308232*e}function c(e){return.017453292519943*e}function u(e){return e/o.sv.radius}function h(e){return Math.PI/2-2*Math.atan(Math.exp(-e/o.sv.radius))}function d(e){return null!=e.wkid||null!=e.wkt}const p=[0,0];function f(e,t,i,r,s){const n=e,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,p,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,p,r),[o.xmax,o.ymax]=t(n.xmax,n.ymax,p,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const e="paths"in n?n.paths:n.rings,i=[];let s;for(let n=0;n<e.length;n++){const o=e[n];s=[],i.push(s);for(let e=0;e<o.length;e++)s.push(t(o[e][0],o[e][1],[0,0],r)),o[e].length>2&&s[e].push(o[e][2]),o[e].length>3&&s[e].push(o[e][3])}"paths"in o?o.paths=i:o.rings=i}else if("points"in n&&"points"in o){const e=n.points,i=[];for(let s=0;s<e.length;s++)i[s]=t(e[s][0],e[s][1],[0,0],r),e[s].length>2&&i[s].push(e[s][2]),e[s].length>3&&i[s].push(e[s][3]);o.points=i}return s}function m(e,t){const i=e&&(d(e)?e:e.spatialReference),r=t&&(d(t)?t:t.spatialReference);return!(e&&"type"in e&&"mesh"===e.type||t&&"type"in t&&"mesh"===t.type||!i||!r)&&(!!(0,a.fS)(r,i)||(0,a.sS)(r)&&(0,a.oR)(i)||(0,a.sS)(i)&&(0,a.oR)(r))}function g(e,t){if((0,s.Wi)(e))return null;const i=e.spatialReference,o=t&&(d(t)?t:t.spatialReference);return m(i,o)?(0,a.fS)(i,o)?(0,r.d9)(e):(0,a.sS)(o)?f(e,y,n.Z.WebMercator,!1,(0,r.d9)(e)):(0,a.oR)(o)?f(e,_,n.Z.WGS84,!1,(0,r.d9)(e)):null:null}function y(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=c(t);return i[0]=c(e)*o.sv.radius,i[1]=o.sv.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function _(e,t,i=[0,0],r=!1){const s=l(e/o.sv.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=l(Math.PI/2-2*Math.atan(Math.exp(-t/o.sv.radius))),i}function v(e,t=!1,i=(0,r.d9)(e)){return f(e,y,n.Z.WebMercator,t,i)}function b(e,t=!1,i=(0,r.d9)(e)){return f(e,_,n.Z.WGS84,t,i)}},36939:(e,t,i)=>{"use strict";function r(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?4!==t.length||r||s?3===t.length&&i&&!r?(s=!0,r=!1):3===t.length&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}i.d(t,{l:()=>r})},95247:(e,t,i)=>{"use strict";i.d(t,{k:()=>o});var r=i(61681),s=i(17321),n=i(35925);function o(e,t,i){if((0,r.Wi)(t)||(0,r.Wi)(i)||i.vcsWkid||(0,n.fS)(t,i))return null;const o=(0,s._R)(t)/(0,s._R)(i);if(1===o)return null;switch(e){case"point":case"esriGeometryPoint":return e=>function(e,t){e&&null!=e.z&&(e.z*=t)}(e,o);case"polyline":case"esriGeometryPolyline":return e=>function(e,t){if(e)for(const i of e.paths)for(const e of i)e.length>2&&(e[2]*=t)}(e,o);case"polygon":case"esriGeometryPolygon":return e=>function(e,t){if(e)for(const i of e.rings)for(const e of i)e.length>2&&(e[2]*=t)}(e,o);case"multipoint":case"esriGeometryMultipoint":return e=>function(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}(e,o);case"extent":case"esriGeometryExtent":return e=>function(e,t){e&&null!=e.zmin&&null!=e.zmax&&(e.zmin*=t,e.zmax*=t)}(e,o);default:return null}}},87090:(e,t,i)=>{"use strict";i(72057),i(25741),i(61547),i(8108);var r=i(60720),s=i(66341),n=i(70375),o=i(61681);async function a(e){if((0,o.pC)(c.fetchBundleAsset))return c.fetchBundleAsset(e);const t=await(0,s.default)(e,{responseType:"text"});return JSON.parse(t.data)}class l{constructor({base:e="",pattern:t,location:i=new URL(window.location.href)}){let r;r="string"==typeof i?e=>new URL(e,new URL(i,window.location.href)).href:i instanceof URL?e=>new URL(e,i).href:i,this.pattern="string"==typeof t?new RegExp(`^${t}`):t,this.getAssetUrl=r,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,t){return async function(e,t,i,s){const o=t.exec(i);if(!o)throw new n.Z("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const l=o[1]?`${o[1]}/`:"",c=o[2],u=(0,r.Su)(s),h=`${l}${c}.json`,d=u?`${l}${c}_${u}.json`:h;let p;try{p=await a(e(d))}catch(t){if(d===h)throw new n.Z("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:t});try{p=await a(e(h))}catch(e){throw new n.Z("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:e})}}return p}(this.getAssetUrl,this.matcher,e,t)}}const c={};var u,h=i(36567);(0,r.tz)((u={pattern:"esri/",location:h.V},new l(u)))},72057:(e,t,i)=>{"use strict";i.d(t,{Ze:()=>g,p6:()=>y});var r=i(25709),s=i(8108);const n={year:"numeric",month:"numeric",day:"numeric"},o={year:"numeric",month:"long",day:"numeric"},a={year:"numeric",month:"short",day:"numeric"},l={year:"numeric",month:"long",weekday:"long",day:"numeric"},c={hour:"numeric",minute:"numeric"},u={...c,second:"numeric"},h={"short-date":n,"short-date-short-time":{...n,...c},"short-date-short-time-24":{...n,...c,hour12:!1},"short-date-long-time":{...n,...u},"short-date-long-time-24":{...n,...u,hour12:!1},"short-date-le":n,"short-date-le-short-time":{...n,...c},"short-date-le-short-time-24":{...n,...c,hour12:!1},"short-date-le-long-time":{...n,...u},"short-date-le-long-time-24":{...n,...u,hour12:!1},"long-month-day-year":o,"long-month-day-year-short-time":{...o,...c},"long-month-day-year-short-time-24":{...o,...c,hour12:!1},"long-month-day-year-long-time":{...o,...u},"long-month-day-year-long-time-24":{...o,...u,hour12:!1},"day-short-month-year":a,"day-short-month-year-short-time":{...a,...c},"day-short-month-year-short-time-24":{...a,...c,hour12:!1},"day-short-month-year-long-time":{...a,...u},"day-short-month-year-long-time-24":{...a,...u,hour12:!1},"long-date":l,"long-date-short-time":{...l,...c},"long-date-short-time-24":{...l,...c,hour12:!1},"long-date-long-time":{...l,...u},"long-date-long-time-24":{...l,...u,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":c,"long-time":u},d=(0,r.w)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),p=(d.apiValues,d.toJSON.bind(d),d.fromJSON.bind(d),{ar:"ar-u-nu-latn-ca-gregory"});let f=new WeakMap,m=h["short-date-short-time"];function g(e){return h[e]||null}function y(e,t){return function(e){const t=e||m;if(!f.has(t)){const e=(0,s.Kd)(),i=p[(0,s.Kd)()]||e;f.set(t,new Intl.DateTimeFormat(i,t))}return f.get(t)}(t).format(e)}(0,s.Ze)((()=>{f=new WeakMap,m=h["short-date-short-time"]}))},8108:(e,t,i)=>{"use strict";let r;i.d(t,{Kd:()=>o,Ze:()=>u,qe:()=>l});const s=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function n(){return s??globalThis.navigator?.language??"en"}function o(){return void 0===r&&(r=n()),r}const a=[];function l(e){return a.push(e),{remove(){a.splice(a.indexOf(e),1)}}}const c=[];function u(e){return c.push(e),{remove(){a.splice(c.indexOf(e),1)}}}globalThis.addEventListener?.("languagechange",(function(){const e=n();r!==e&&(r=e,[...c].forEach((t=>{t.call(null,e)})),[...a].forEach((t=>{t.call(null,e)})))}))},60720:(e,t,i)=>{"use strict";i.d(t,{ME:()=>p,Su:()=>f,tz:()=>d});var r=i(70375),s=i(78668),n=i(8108);const o=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,a={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function l(e){return a[e]??!1}const c=[],u=new Map;function h(e){for(const t of u.keys())m(e.pattern,t)&&u.delete(t)}function d(e){return c.includes(e)||(h(e),c.unshift(e)),{remove(){const t=c.indexOf(e);t>-1&&(c.splice(t,1),h(e))}}}async function p(e){const t=(0,n.Kd)();u.has(e)||u.set(e,async function(e,t){const i=[];for(const r of c)if(m(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(e){i.push(e)}if(i.length)throw new r.Z("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i});throw new r.Z("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,t));const i=u.get(e);return await g.add(i),i}function f(e){if(!o.test(e))return null;const[,t,i]=o.exec(e),r=t+(i?"-"+i.toUpperCase():"");return l(r)?r:l(t)?t:null}function m(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}(0,n.Ze)((()=>{u.clear()}));const g=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=(0,s.dD)())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}}},25741:(e,t,i)=>{"use strict";i.d(t,{sh:()=>l,uf:()=>c});var r=i(61681),s=i(8108);const n={ar:"ar-u-nu-latn"};let o=new WeakMap,a={};function l(e={}){const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function c(e,t){return-0===e&&(e=0),function(e){const t=e||a;if(!o.has(t)){const i=(0,s.Kd)(),r=n[(0,s.Kd)()]||i;o.set(t,new Intl.NumberFormat(r,e))}return(0,r.j0)(o.get(t))}(t).format(e)}(0,s.Ze)((()=>{o=new WeakMap,a={}}))},61547:(e,t,i)=>{"use strict";i.d(t,{n:()=>c});var r=i(13802),s=i(86745),n=i(21130),o=i(72057),a=i(25741);const l=r.Z.getLogger("esri.intl");function c(e,t,i={}){const{format:r={}}=i;return(0,n.gx)(e,(e=>function(e,t,i){let r,n;const o=e.indexOf(":");if(-1===o?r=e.trim():(r=e.slice(0,o).trim(),n=e.slice(o+1).trim()),!r)return"";const a=(0,s.hS)(r,t);if(null==a)return"";const l=i[n]||i[r];return l?u(a,l):n?h(a,n):d(a)}(e,t,r)))}function u(e,t){switch(t.type){case"date":return(0,o.p6)(e,t.intlOptions);case"number":return(0,a.uf)(e,t.intlOptions);default:return l.warn("missing format descriptor for key {key}"),d(e)}}function h(e,t){switch(t.toLowerCase()){case"dateformat":return(0,o.p6)(e);case"numberformat":return(0,a.uf)(e);default:return l.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?(0,o.p6)(e):/^numberformat/i.test(t)?(0,a.uf)(e):d(e)}}function d(e){switch(typeof e){case"string":return e;case"number":return(0,a.uf)(e);case"boolean":return""+e;default:return e instanceof Date?(0,o.p6)(e):""}}},88256:(e,t,i)=>{"use strict";i.d(t,{Dp:()=>c,Nv:()=>o,i8:()=>n,id:()=>a,qh:()=>l});var r=i(39994),s=i(3466);const n="4.24",o={async request(e,t){const{default:r}=await Promise.resolve().then(i.bind(i,66341)),n=e.options,o=n.responseType;n.signal=t?.signal,n.responseType="native"===o||"native-request-init"===o?"native-request-init":["blob","json","text"].includes(o)&&(0,s.oh)(e.url)?.after?o:"array-buffer";const a=await r(e.url,n),l={data:a.data,ssl:a.ssl};switch(a.requestOptions.responseType){case"native-request-init":return delete l.data.signal,l;case"blob":l.data=await l.data.arrayBuffer();break;case"json":l.data=(new TextEncoder).encode(JSON.stringify(l.data)).buffer;break;case"text":l.data=(new TextEncoder).encode(l.data).buffer}return{result:l,transferList:[l.data]}}};let a;function l(e){a=e}function c(e){const t=a&&a.findCredential(e);return t&&t.token?(0,s.ZN)(e,"token",t.token):e}(0,r.Z)("host-webworker")||((0,r.Z)("edge")||(0,r.Z)("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser")},45955:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Kt});var r=i(36663),s=i(80020),n=(i(86004),i(45510),i(16192),i(71297),i(878),i(22836),i(50172)),o=i(25634),a=i(72506),l=i(54021),c=i(66341),u=i(4905),h=i(41151),d=i(41831),p=i(70375),f=i(44584),m=i(39994),g=i(25709),y=i(67134),_=i(13802),v=i(61681),b=i(15842),w=i(86745),x=i(78668),C=i(84684),T=i(3466),S=i(81977),E=i(69236),A=i(34248),M=i(40266),O=i(39835),R=i(3593),P=i(82064),I=i(3363);let L=class extends P.wq{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],L.prototype,"description",void 0),(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],L.prototype,"label",void 0),(0,r._)([(0,S.Cb)()],L.prototype,"type",void 0),(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],L.prototype,"visibilityExpression",void 0),L=(0,r._)([(0,M.j)("esri.form.elements.Element")],L);const D=L;var N,F=i(7283);i(7753);let k=N=class extends P.wq{constructor(e){super(e),this.type=null}clone(){return new N({type:this.type})}};(0,r._)([(0,S.Cb)({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],k.prototype,"type",void 0),k=N=(0,r._)([(0,M.j)("esri.form.elements.inputs.AttachmentInput")],k);const U=k;var V;let z=V=class extends D{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new V({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],z.prototype,"attachmentKeyword",void 0),(0,r._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],z.prototype,"editable",void 0),(0,r._)([(0,S.Cb)({type:U,json:{read:{source:"inputType"},write:{target:"inputType"}}})],z.prototype,"input",void 0),(0,r._)([(0,S.Cb)({type:["attachment"],json:{read:!1,write:!0}})],z.prototype,"type",void 0),z=V=(0,r._)([(0,M.j)("esri.form.elements.AttachmentElement")],z);const B=z;let H=class extends P.wq{constructor(e){super(e),this.type=null}};(0,r._)([(0,S.Cb)()],H.prototype,"type",void 0),H=(0,r._)([(0,M.j)("esri.form.elements.inputs.Input")],H);const j=H;let G=class extends j{constructor(e){super(e),this.maxLength=null,this.minLength=0}};(0,r._)([(0,S.Cb)({type:Number,json:{write:!0}})],G.prototype,"maxLength",void 0),(0,r._)([(0,S.Cb)({type:Number,json:{write:!0}})],G.prototype,"minLength",void 0),G=(0,r._)([(0,M.j)("esri.form.elements.inputs.TextInput")],G);const W=G;var Z;let q=Z=class extends W{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new Z({maxLength:this.maxLength,minLength:this.minLength})}};(0,r._)([(0,S.Cb)({type:["barcode-scanner"],json:{read:!1,write:!0}})],q.prototype,"type",void 0),q=Z=(0,r._)([(0,M.j)("esri.form.elements.inputs.BarcodeScannerInput")],q);const $=q;var Y;let X=Y=class extends j{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new Y({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],X.prototype,"noValueOptionLabel",void 0),(0,r._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],X.prototype,"showNoValueOption",void 0),(0,r._)([(0,S.Cb)({type:["combo-box"],json:{read:!1,write:!0}})],X.prototype,"type",void 0),X=Y=(0,r._)([(0,M.j)("esri.form.elements.inputs.ComboBoxInput")],X);const J=X;var K;function Q(e){return null!=e?new Date(e):null}function ee(e){return e?e.getTime():null}let te=K=class extends j{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return Q(t.max)}writeMax(e,t){t.max=ee(e)}readMin(e,t){return Q(t.min)}writeMin(e,t){t.min=ee(e)}clone(){return new K({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};(0,r._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],te.prototype,"includeTime",void 0),(0,r._)([(0,S.Cb)({type:Date,json:{type:Number,write:!0}})],te.prototype,"max",void 0),(0,r._)([(0,A.r)("max")],te.prototype,"readMax",null),(0,r._)([(0,O.c)("max")],te.prototype,"writeMax",null),(0,r._)([(0,S.Cb)({type:Date,json:{type:Number,write:!0}})],te.prototype,"min",void 0),(0,r._)([(0,A.r)("min")],te.prototype,"readMin",null),(0,r._)([(0,O.c)("min")],te.prototype,"writeMin",null),(0,r._)([(0,S.Cb)({type:["datetime-picker"],json:{read:!1,write:!0}})],te.prototype,"type",void 0),te=K=(0,r._)([(0,M.j)("esri.form.elements.inputs.DateTimePickerInput")],te);const ie=te;var re;let se=re=class extends j{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new re({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],se.prototype,"noValueOptionLabel",void 0),(0,r._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],se.prototype,"showNoValueOption",void 0),(0,r._)([(0,S.Cb)({type:["radio-buttons"],json:{read:!1,write:!0}})],se.prototype,"type",void 0),se=re=(0,r._)([(0,M.j)("esri.form.elements.inputs.RadioButtonsInput")],se);const ne=se;var oe;let ae=oe=class extends j{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new oe({offValue:this.offValue,onValue:this.onValue})}};(0,r._)([(0,S.Cb)({type:[String,Number],json:{write:!0}})],ae.prototype,"offValue",void 0),(0,r._)([(0,S.Cb)({type:[String,Number],json:{write:!0}})],ae.prototype,"onValue",void 0),(0,r._)([(0,S.Cb)({type:["switch"],json:{read:!1,write:!0}})],ae.prototype,"type",void 0),ae=oe=(0,r._)([(0,M.j)("esri.form.elements.inputs.SwitchInput")],ae);const le=ae;var ce;let ue=ce=class extends W{constructor(e){super(e),this.type="text-area"}clone(){return new ce({maxLength:this.maxLength,minLength:this.minLength})}};(0,r._)([(0,S.Cb)({type:["text-area"],json:{read:!1,write:!0}})],ue.prototype,"type",void 0),ue=ce=(0,r._)([(0,M.j)("esri.form.elements.inputs.TextAreaInput")],ue);const he=ue;var de;let pe=de=class extends W{constructor(e){super(e),this.type="text-box"}clone(){return new de({maxLength:this.maxLength,minLength:this.minLength})}};(0,r._)([(0,S.Cb)({type:["text-box"],json:{read:!1,write:!0}})],pe.prototype,"type",void 0),pe=de=(0,r._)([(0,M.j)("esri.form.elements.inputs.TextBoxInput")],pe);const fe={base:j,key:"type",typeMap:{"barcode-scanner":$,"combo-box":J,"datetime-picker":ie,"radio-buttons":ne,switch:le,"text-area":he,"text-box":pe}};var me,ge=i(12795);let ye=me=class extends D{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new me({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};(0,r._)([(0,S.Cb)({types:ge.V5,json:{read:{reader:ge.im},write:!0}})],ye.prototype,"domain",void 0),(0,r._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],ye.prototype,"editable",void 0),(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],ye.prototype,"editableExpression",void 0),(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],ye.prototype,"fieldName",void 0),(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],ye.prototype,"hint",void 0),(0,r._)([(0,S.Cb)({types:fe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ye.prototype,"input",void 0),(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],ye.prototype,"requiredExpression",void 0),(0,r._)([(0,S.Cb)({type:String,json:{read:!1,write:!0}})],ye.prototype,"type",void 0),(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],ye.prototype,"valueExpression",void 0),ye=me=(0,r._)([(0,M.j)("esri.form.elements.FieldElement")],ye);const _e=ye;var ve,be=i(79163);let we=ve=class extends D{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new ve({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:(0,y.d9)(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};(0,r._)([(0,S.Cb)({type:Number,json:{write:!0}})],we.prototype,"displayCount",void 0),(0,r._)([(0,S.Cb)({type:["list"],json:{write:!0}})],we.prototype,"displayType",void 0),(0,r._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],we.prototype,"editable",void 0),(0,r._)([(0,S.Cb)({type:[be.Z],json:{write:!0}})],we.prototype,"orderByFields",void 0),(0,r._)([(0,S.Cb)({type:Number,json:{write:!0}})],we.prototype,"relationshipId",void 0),(0,r._)([(0,S.Cb)({type:["relationship"],json:{read:!1,write:!0}})],we.prototype,"type",void 0),we=ve=(0,r._)([(0,M.j)("esri.form.elements.RelationshipElement")],we);const xe=we;function Ce(e){return{typesWithGroup:{base:D,key:"type",typeMap:{attachment:B,field:_e,group:e,relationship:xe}},typesWithoutGroup:{base:D,key:"type",typeMap:{attachment:B,field:_e,relationship:xe}}}}function Te(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>r[e.type].fromJSON(e)))}function Se(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>e.toJSON()))}function Ee(e,t,i=!0){return e?e.map((e=>(0,F.N7)(i?t.typesWithGroup:t.typesWithoutGroup,e))):null}var Ae;let Me=Ae=class extends D{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Ee(e,Oe,!1)}readElements(e,t){return Te(t.formElements,Oe,!1)}writeElements(e,t){t.formElements=Se(e,Oe,!1)}clone(){return new Ae({description:this.description,elements:(0,y.d9)(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};(0,r._)([(0,S.Cb)({json:{write:!0}})],Me.prototype,"elements",void 0),(0,r._)([(0,E.p)("elements")],Me.prototype,"castElements",null),(0,r._)([(0,A.r)("elements",["formElements"])],Me.prototype,"readElements",null),(0,r._)([(0,O.c)("elements")],Me.prototype,"writeElements",null),(0,r._)([(0,S.Cb)({type:["collapsed","expanded"],json:{write:!0}})],Me.prototype,"initialState",void 0),(0,r._)([(0,S.Cb)({type:String,json:{read:!1,write:!0}})],Me.prototype,"type",void 0),Me=Ae=(0,r._)([(0,M.j)("esri.form.elements.GroupElement")],Me);const Oe=Ce(Me);var Re;const Pe=Ce(Me);let Ie=Re=class extends P.wq{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return Ee(e,Pe)}readElements(e,t){return Te(t.formElements,Pe)}writeElements(e,t){t.formElements=Se(e,Pe)}clone(){return new Re({description:this.description,expressionInfos:(0,y.d9)(this.expressionInfos),elements:(0,y.d9)(this.elements),title:this.title})}};(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],Ie.prototype,"description",void 0),(0,r._)([(0,S.Cb)({json:{write:!0}})],Ie.prototype,"elements",void 0),(0,r._)([(0,E.p)("elements")],Ie.prototype,"castElements",null),(0,r._)([(0,A.r)("elements",["formElements"])],Ie.prototype,"readElements",null),(0,r._)([(0,O.c)("elements")],Ie.prototype,"writeElements",null),(0,r._)([(0,S.Cb)({type:[I.Z],json:{write:!0}})],Ie.prototype,"expressionInfos",void 0),(0,r._)([(0,S.Cb)({type:String,json:{write:!0}})],Ie.prototype,"title",void 0),Ie=Re=(0,r._)([(0,M.j)("esri.form.FormTemplate")],Ie);const Le=Ie;var De=i(91772),Ne=i(64307),Fe=i(14685),ke=i(38481),Ue=(i(91957),i(80085)),Ve=i(53280),ze=i(68309),Be=i(64189),He=i(47109),je=i(2107),Ge=i(66565),We=i(13097),Ze=i(51211),qe=i(89542),$e=i(59659);let Ye=0;const Xe=_.Z.getLogger("esri.layers.graphics.sources.MemorySource");let Je=class extends(ze.Z.LoadableMixin((0,Be.v)((0,Ve.p)(d.Z)))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=(0,v.pC)(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get workerGeometryType(){const e=this.layer?.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then((()=>this._applyEdits(e)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);(0,We.p)(e,this.layer.spatialReference,i);const r=Ze.default.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const e of r.features){const t=e.attributes[s],i=this._idToClientGraphic.get(t);i&&(e.geometry=i.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new p.Z("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return(0,We.p)(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)))}queryObjectIds(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)))}queryExtent(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:De.Z.fromJSON(e.extent)})))}querySnapping(e,t={}){return this.load(t).then((()=>this._connection.invoke("querySnapping",e,t)))}async _applyEdits(e){if(!this._connection)throw new p.Z("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=e=>"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[t]?e.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const t of e.deleteFeatures){const e=n(t);null!=e&&r.push(e)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures)for(const t of e.updateFeatures)if(s.push(this._serializeFeature(t)),o){const e=n(t);null!=e&&o.set(e,t)}(0,Ge.P)(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=a,i&&i.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if("mesh"!==this.layerOrSourceGeometryType||(0,v.Wi)(e))return;const i=[];for(const{geometry:r}of e)!(0,v.pC)(r)||"mesh"!==r.type||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const t=e.get(i.objectId);null!=t&&this._addIdToClientGraphic(t)}for(const e of t.deleteResults)e.success&&this._idToClientGraphic.delete(e.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new p.Z("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let s=0;s<e.length;s++){const n=e[s],o=this._serializeFeature(n);!r&&(0,v.pC)(n.geometry)&&(r=n.geometry.type),i[s]=o,t.set(`${o.uid}`,n)}const s=this;return{features:i,inferredGeometryType:r,finish(e){const i=s.sourceJSON.objectIdField;for(const r in e){const n=e[r],o=t.get(r);o&&(o.attributes||(o.attributes={}),-1===n?delete o.attributes[i]:o.attributes[i]=n,s._addIdToClientGraphic(o))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];null!=i&&this._idToClientGraphic.set(i,e)}get layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return"mesh"===e||"multipatch"===e||"extent"===e}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(Ye++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return(0,v.Wi)(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?qe.Z.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await(0,He.bA)("MemorySourceWorker",{strategy:(0,m.Z)("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,a="defaults"===this.layer.originOf("spatialReference");await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",(e=>{Xe.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()})));const c={features:l.features,fields:t&&t.map((e=>e.toJSON())),geometryType:$e.P$.toJSON(this.workerGeometryType),hasM:"mesh"!==this.layerOrSourceGeometryType&&s,hasZ:"mesh"===this.layerOrSourceGeometryType||n,objectIdField:r,spatialReference:a?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},u=await this._connection.invoke("load",c,{signal:e});for(const e of u.warnings)Xe.warn(e.message,{layer:this.layer,warning:e});u.featureErrors.length&&Xe.warn(`Encountered ${u.featureErrors.length} validation errors while loading features`,u.featureErrors);const h=u.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(h.geometryType=$e.P$.toJSON(l.inferredGeometryType)),this.sourceJSON=h,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(u.assignedObjectIds)}};(0,r._)([(0,je.c)({Type:Ue.Z,ensureType:(0,F.se)(Ue.Z)})],Je.prototype,"itemType",void 0),(0,r._)([(0,S.Cb)()],Je.prototype,"type",void 0),(0,r._)([(0,S.Cb)({constructOnly:!0})],Je.prototype,"layer",void 0),(0,r._)([(0,S.Cb)({readOnly:!0})],Je.prototype,"workerGeometryType",null),(0,r._)([(0,S.Cb)()],Je.prototype,"sourceJSON",void 0),Je=(0,r._)([(0,M.j)("esri.layers.graphics.sources.MemorySource")],Je);var Ke,Qe=i(91223),et=i(87232),tt=i(27668),it=i(63989),rt=i(22368),st=i(43330),nt=i(50386),ot=i(18241),at=i(12478),lt=i(95874),ct=i(2030),ut=i(20692),ht=i(51599);let dt=Ke=class extends P.wq{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new Ke({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};(0,r._)([(0,S.Cb)({constructOnly:!0})],dt.prototype,"name",void 0),(0,r._)([(0,S.Cb)({constructOnly:!0})],dt.prototype,"fields",void 0),(0,r._)([(0,S.Cb)({constructOnly:!0})],dt.prototype,"isAscending",void 0),(0,r._)([(0,S.Cb)({constructOnly:!0})],dt.prototype,"isUnique",void 0),(0,r._)([(0,S.Cb)({constructOnly:!0})],dt.prototype,"description",void 0),dt=Ke=(0,r._)([(0,M.j)("esri.layers.support.FeatureIndex")],dt);var pt=i(84465),ft=i(60822),mt=i(18160),gt=i(89076),yt=i(17095),_t=i(17321);let vt=class extends((0,h.J)(P.wq)){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};(0,r._)([(0,S.Cb)({type:String,json:{read:{source:"shapeAreaFieldName"}}})],vt.prototype,"shapeAreaField",void 0),(0,r._)([(0,S.Cb)({type:String,json:{read:{source:"shapeLengthFieldName"}}})],vt.prototype,"shapeLengthField",void 0),(0,r._)([(0,S.Cb)({type:String,json:{read:e=>_t.gV.read(e)||_t.Jo.read(e)}})],vt.prototype,"units",void 0),vt=(0,r._)([(0,M.j)("esri.layers.support.GeometryFieldsInfo")],vt);const bt=vt;var wt=i(26732),xt=i(49341),Ct=i(94081);const Tt=new g.X({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),St=new g.X({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Et=class extends((0,h.J)(P.wq)){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};(0,r._)([(0,S.Cb)({json:{read:Tt.read,write:Tt.write}})],Et.prototype,"cardinality",void 0),(0,r._)([(0,S.Cb)({json:{read:!0,write:!0}})],Et.prototype,"composite",void 0),(0,r._)([(0,S.Cb)({json:{read:!0,write:!0}})],Et.prototype,"id",void 0),(0,r._)([(0,S.Cb)({json:{read:!0,write:!0}})],Et.prototype,"keyField",void 0),(0,r._)([(0,S.Cb)({json:{read:!0,write:!0}})],Et.prototype,"keyFieldInRelationshipTable",void 0),(0,r._)([(0,S.Cb)({json:{read:!0,write:!0}})],Et.prototype,"name",void 0),(0,r._)([(0,S.Cb)({json:{read:!0,write:!0}})],Et.prototype,"relatedTableId",void 0),(0,r._)([(0,S.Cb)({json:{read:!0,write:!0}})],Et.prototype,"relationshipTableId",void 0),(0,r._)([(0,S.Cb)({json:{read:St.read,write:St.write}})],Et.prototype,"role",void 0),Et=(0,r._)([(0,M.j)("esri.layers.support.Relationship")],Et);const At=Et;var Mt=i(84573),Ot=i(76912),Rt=i(10743),Pt=i(16603),It=i(67692),Lt=i(14136),Dt=i(8284),Nt=i(12621),Ft=i(10171),kt=i(78621);const Ut=new g.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Vt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},zt="FeatureLayer",Bt=_.Z.getLogger("esri.layers.FeatureLayer");function Ht(e,t){return new p.Z("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function jt(e){return e&&e instanceof d.Z}function Gt(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function Wt(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}function Zt(e){const t=e?.supportedSpatialAggregationStatistics?.map((e=>e.toLowerCase()));return{envelope:!!t?.includes("envelopeaggregate"),centroid:!!t?.includes("centroidaggregate"),convexHull:!!t?.includes("convexhullaggregate")}}function qt(e,t){const i=e?.supportedOperationsWithCacheHint?.map((e=>e.toLowerCase()));return!!i?.includes(t.toLowerCase())}const $t=(0,gt.v)();function Yt(e,t,i){const r=!!i?.writeLayerSchema;return{enabled:r,ignoreOrigin:r}}let Xt=class extends((0,rt.b)((0,tt.h)((0,nt.c)((0,ct.n)((0,lt.M)((0,at.Q)((0,et.Y)((0,st.q)((0,ot.I)((0,b.R)((0,it.N)((0,Qe.V)((0,h.J)(ke.Z)))))))))))))){constructor(...e){super(...e),this._handles=new f.Z,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=Fe.Z.WGS84,this.subtypeCode=null,this.subtypeField=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(d.Z.ofType(dt)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){this.source?.destroy(),this._handles=(0,v.SC)(this._handles)}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=(0,v.pC)(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then((e=>this._initLayerProperties(e))));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(x.r9).then((async()=>{if(this.url&&null==this.layerId&&/FeatureServer|MapServer\/*$/i.test(this.url)){const e=await this._fetchFirstLayerId(t);null!=e&&(this.layerId=e)}if(!this.url&&!this._hasMemorySource())throw new p.Z("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))})).then((()=>this.finishLoadEditablePortalLayer(e)));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{analytics:this._readAnalyticsCapabilities(t),attachment:this._readAttachmentCapabilities(t),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),queryTopFeatures:this._readQueryTopFeaturesCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){null!=e?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:null!=i.lastEditDate?new Date(i.lastEditDate):null}:null}readIsTable(e,t){return"Table"===(t=t&&t.layerDefinition||t).type||!t.geometryType}writeIsTable(e,t,i,r){r?.writeLayerSchema&&(0,w.RB)(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(const e of t.fields)if("esriFieldTypeGlobalID"===e.type)return e.name}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(const e of t.fields)if("esriFieldTypeOID"===e.type)return e.name}get parsedUrl(){const e=this.url?(0,T.mN)(this.url):null;return null!=e&&(null!=this.dynamicDataSource?e.path=(0,T.v_)(e.path,"dynamicLayer"):null!=this.layerId&&(e.path=(0,T.v_)(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){(0,yt.YN)(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const e=(0,a.a)(r,t,i)||void 0;return e||Bt.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),e}if(t.defaultSymbol)return t.types&&t.types.length?new o.Z({defaultSymbol:Jt(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map((e=>({id:e.id,symbol:Jt(e.symbol,e,i)})))}):new n.Z({symbol:Jt(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(jt(t)&&this._resetMemorySource(t),jt(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof d.Z?new Je({layer:this,items:e}):e:null}readSource(e,t){const i=Ze.default.fromJSON(t.featureSet);return new Je({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map((e=>ft.Z.fromJSON(e))),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const e=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?(0,ut.a7)(this.url,i):i;let t=i;if(!t&&this.url){const e=(0,ut.Qc)(this.url);(0,v.pC)(e)&&(t=e.title)}if(!t)return;return"item-title-and-service-name"===this.sublayerTitleMode&&e&&e!==t&&(t=e+" - "+t),(0,ut.ld)(t)}if("item-title"===this.sublayerTitleMode&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const e=t.fields.find((e=>e.name.toLowerCase()===i));e&&(i=e.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map((e=>(e=mt.Z.fromJSON(e),this._fixTemplates(e.templates,r),this._fixTemplates(e.templates,s),e)))}set url(e){const t=(0,ut.XG)({layer:this,url:e,nonStandardUrlAllowed:!0,logger:Bt});this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){(0,ut.wH)(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0}addAttachment(e,t){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("addAttachment"in this.source))throw new p.Z(zt,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)}))}updateAttachment(e,t,i){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("updateAttachment"in this.source))throw new p.Z(zt,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)}))}async applyEdits(e,t){const r=await i.e(3261).then(i.bind(i,23261));return await this.load(),r.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return(0,Ft.eZ)(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await(0,x.Hl)(i.e(5825).then(i.bind(i,25825)),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new Lt.Z,t=this.get("capabilities.data"),i=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=["*"];const r=(0,v.pC)(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,s=(0,C._)(this.definitionExpression,r);e.where=s||"1=1";const{timeOffset:n,timeExtent:o}=this;return e.timeExtent=null!=n&&null!=o?o.offset(-n.value,n.unit):o||null,e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("deleteAttachments"in this.source))throw new p.Z(zt,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)}))}fetchRecomputedExtents(e){return this.load({signal:e?.signal}).then((()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new p.Z(zt,"Layer source does not support fetchUpdates capability")}))}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(null==r)return null;let s=null;return i.some((e=>{const{id:t}=e;return null!=t&&(t.toString()===r.toString()&&(s=e),!!s)})),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const t=r.domains&&r.domains[e];if(t&&"inherited"!==t.type)return t}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=It.Z.from(e),this.load().then((()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new p.Z(zt,"this layer doesn't support attachments");const{attachmentTypes:t,objectIds:i,globalIds:r,num:s,size:n,start:o,where:a}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const l=i&&i.length>1,c=t&&t.length,u=r&&r.length,h=n&&n.length;if(l||c||u||h||s||o||a)throw new p.Z(zt,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(i&&i.length||a))throw new p.Z(zt,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new p.Z(zt,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)}))}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(Lt.Z.from(e)||this.createQuery(),t))).then((e=>{if(e?.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(Lt.Z.from(e)||this.createQuery(),t);throw new p.Z(zt,"Layer source does not support queryObjectIds capability")}))}queryFeatureCount(e,t){return this.load().then((()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(Lt.Z.from(e)||this.createQuery(),t);throw new p.Z(zt,"Layer source does not support queryFeatureCount capability")}))}queryExtent(e,t){return this.load().then((()=>{if(this.source.queryExtent)return this.source.queryExtent(Lt.Z.from(e)||this.createQuery(),t);throw new p.Z(zt,"Layer source does not support queryExtent capability")}))}queryRelatedFeatures(e,t){return this.load().then((()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(Dt.Z.from(e),t);throw new p.Z(zt,"Layer source does not support queryRelatedFeatures capability")}))}queryRelatedFeaturesCount(e,t){return this.load().then((()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(Dt.Z.from(e),t);throw new p.Z(zt,"Layer source does not support queryRelatedFeaturesCount capability")}))}queryTopFeatures(e,t){return this.load().then((()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(Nt.Z.from(e),t).then((e=>{if(e?.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}));throw new p.Z(zt,"Layer source does not support queryTopFeatures capability")}))}queryTopObjectIds(e,t){return this.load().then((()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(Nt.Z.from(e),t);throw new p.Z(zt,"Layer source does not support queryTopObjectIds capability")}))}queryTopFeaturesExtent(e,t){return this.load().then((()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(Nt.Z.from(e),t);throw new p.Z(zt,"Layer source does not support queryTopExtents capability")}))}queryTopFeatureCount(e,t){return this.load().then((()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(Nt.Z.from(e),t);throw new p.Z(zt,"Layer source does not support queryFeatureCount capability")}))}read(e,t){const i=e.featureCollection;if(i){const e=i.layers;e&&1===e.length&&(super.read(e[0],t),null!=i.showLegend&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&"service"===t.origin&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){t={...t,writeLayerSchema:t?.writeLayerSchema??this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:s}=t;if(this.dynamicDataSource)return s?.push(Ht(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if("web-scene"===i||"web-map"===i&&"tables"!==r)return s?.push(Ht(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s?.push(Ht(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&"web-map"===i&&"tables"===r)return s?.push(Ht(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new p.Z(zt,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&("memory"===this.source.type||(0,Ot.D)(this,e))}async save(e){return(await i.e(8015).then(i.bind(i,8015))).save(this,e)}async saveAs(e,t){return(await i.e(8015).then(i.bind(i,8015))).saveAs(this,e,t)}_readEditingEnabled(e,t,i){let r=e.layerDefinition?.capabilities;return r?this._hasEditingCapability(r):(r=e.capabilities,t&&"web-map"===i?.origin&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map((e=>e.trim())).includes("editing")}_writeEditingEnabled(e,t,i,r){if(!e){const e=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";(0,w.RB)("layerDefinition.capabilities",e,t),i&&!r?.writeLayerSchema&&(t.capabilities=e)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new p.Z(zt,`feature is missing the identifying attribute ${i}`)):Promise.reject(new p.Z(zt,"'attributes' are required on a feature to query attachments")):Promise.reject(new p.Z(zt,"A feature is required to add/delete/update attachments")):Promise.reject(new p.Z(zt,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return(0,c.default)(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then((e=>{const t=e.data;if(t)return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}))}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),(0,yt.YN)(this.renderer,this.fieldsIndex),(0,yt.UF)(this.timeInfo,this.fieldsIndex),(0,Pt.y)(this,{origin:"service"})}async hasDataChanged(){if(this.source?.refresh)try{const{dataChanged:e,updates:t}=await(this.source?.refresh());if((0,v.pC)(t)&&(this.sourceJSON={...this.sourceJSON,...t},this.read(t,{origin:"service",url:this.parsedUrl})),e)return!0}catch{}if(this.definitionExpression)try{return(await(0,C.E)(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields?.some((e=>"geometry"===e.type))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach((e=>{const i=e.prototype&&e.prototype.attributes;i&&t&&delete i[t]}))}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new p.Z("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new p.Z("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach((e=>{e.layer=this,e.sourceLayer=this})),this._handles.add([e.on("after-add",(e=>{e.item.layer=this,e.item.sourceLayer=this})),e.on("after-remove",(e=>{e.item.layer=null,e.item.sourceLayer=null}))],"fl-source")}_resetMemorySource(e){e.forEach((e=>{e.layer=null,e.sourceLayer=null})),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAnalyticsCapabilities(e){return{supportsCacheHint:qt(e.advancedQueryCapabilities,"queryAnalytics")}}_readAttachmentCapabilities(e){const t=e.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:qt(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:Gt(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach((e=>{const t=Vt[e.name];t&&(i[t]=!!e.isEnabled)})),i}_readDataCapabilities(e){return{isVersioned:Gt(e,"isDataVersioned",!1),supportsAttachment:Gt(e,"hasAttachments",!1),supportsM:Gt(e,"hasM",!1),supportsZ:Gt(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Gt(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map((e=>e.trim())):[],r=this.url?(0,ut.Qc)(this.url):null,s=i.includes((0,v.pC)(r)&&"MapServer"===r.serverType?"data":"query"),n=i.includes("editing")&&!t.datesInUnknownTimezone;let o=n&&i.includes("create"),a=n&&i.includes("delete"),l=n&&i.includes("update");const c=i.includes("changetracking"),u=t.advancedQueryCapabilities;return n&&!(o||a||l)&&(o=a=l=!0),{supportsCalculate:Gt(t,"supportsCalculate",!1),supportsTruncate:Gt(t,"supportsTruncate",!1),supportsValidateSql:Gt(t,"supportsValidateSql",!1),supportsAdd:o,supportsDelete:a,supportsEditing:n,supportsChangeTracking:c,supportsQuery:s,supportsQueryAnalytics:Gt(u,"supportsQueryAnalytic",!1),supportsQueryAttachments:Gt(u,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Gt(u,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Gt(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:Gt(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){const t=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,r=e.archivingInfo,s=this.url?.includes("MapServer"),n=!(0,m.Z)("mapserver-pbf-enabled")&&s&&this.version<10.81,o=(0,ut.M8)(this.url),a=(e.supportedQueryFormats||"").split(",").reduce(((e,t)=>{const i=t.toLowerCase().trim();return i&&e.add(i),e}),new Set);return{supportsStatistics:Gt(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Gt(t,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Gt(t,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:Zt(t),supportsCentroid:Gt(t,"supportsReturningGeometryCentroid",!1),supportsDistance:Gt(t,"supportsQueryWithDistance",!1),supportsDistinct:Gt(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Gt(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Gt(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:Gt(t,"supportsHavingClause",!1),supportsOrderBy:Gt(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Gt(t,"supportsPagination",!1),supportsQuantization:Gt(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Gt(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Gt(e,"supportsReturningQueryGeometry",!1),supportsResultType:Gt(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Gt(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Gt(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Gt(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Gt(t,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Gt(i,"allowOthersToQuery",!0),supportsHistoricMoment:Gt(r,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!n&&a.has("pbf"),supportsDisjointSpatialRelationship:Gt(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:Gt(t,"supportsQueryWithCacheHint",!1)||qt(t,"query"),supportsDefaultSpatialReference:Gt(t,"supportsDefaultSR",!1),supportsCompactGeometry:o,maxRecordCountFactor:Wt(e,"maxRecordCountFactor",void 0),maxRecordCount:Wt(e,"maxRecordCount",void 0),standardMaxRecordCount:Wt(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:Wt(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=Gt(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Gt(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:qt(t,"queryRelated")}}_readQueryTopFeaturesCapabilities(e){return{supportsCacheHint:qt(e.advancedQueryCapabilities,"queryTopFilter")}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Gt(e,"allowGeometryUpdates",!0),supportsGlobalId:Gt(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Gt(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Gt(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Gt(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Gt(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Gt(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Gt(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Gt(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Gt(t,"allowOthersToUpdate",!0)}}};(0,r._)([(0,S.Cb)({readOnly:!0,json:{read:!1}})],Xt.prototype,"capabilities",void 0),(0,r._)([(0,A.r)("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Xt.prototype,"readCapabilities",null),(0,r._)([(0,S.Cb)({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Xt.prototype,"charts",void 0),(0,r._)([(0,S.Cb)({readOnly:!0})],Xt.prototype,"createQueryVersion",null),(0,r._)([(0,S.Cb)({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Xt.prototype,"copyright",void 0),(0,r._)([(0,S.Cb)({type:Boolean})],Xt.prototype,"datesInUnknownTimezone",void 0),(0,r._)([(0,S.Cb)({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Xt.prototype,"displayField",void 0),(0,r._)([(0,S.Cb)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Xt.prototype,"definitionExpression",void 0),(0,r._)([(0,S.Cb)({types:u.LB,readOnly:!0})],Xt.prototype,"defaultSymbol",void 0),(0,r._)([(0,S.Cb)({type:Rt.n})],Xt.prototype,"dynamicDataSource",void 0),(0,r._)([(0,S.Cb)({readOnly:!0})],Xt.prototype,"editFieldsInfo",void 0),(0,r._)([(0,S.Cb)({type:Boolean})],Xt.prototype,"editingEnabled",null),(0,r._)([(0,A.r)(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Xt.prototype,"readEditingEnabled",null),(0,r._)([(0,A.r)("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Xt.prototype,"readEditingEnabledFromWebMap",null),(0,r._)([(0,O.c)(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Xt.prototype,"writeEditingEnabled",null),(0,r._)([(0,O.c)("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Xt.prototype,"writeEditingEnabledToWebMap",null),(0,r._)([(0,S.Cb)({readOnly:!0})],Xt.prototype,"editingInfo",void 0),(0,r._)([(0,A.r)("editingInfo")],Xt.prototype,"readEditingInfo",null),(0,r._)([(0,S.Cb)((()=>{const e=(0,y.d9)(ht.PV),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],Xt.prototype,"elevationInfo",void 0),(0,r._)([(0,S.Cb)(pt.d)],Xt.prototype,"featureReduction",void 0),(0,r._)([(0,S.Cb)({...$t.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:Yt}}}}})],Xt.prototype,"fields",void 0),(0,r._)([(0,S.Cb)($t.fieldsIndex)],Xt.prototype,"fieldsIndex",void 0),(0,r._)([(0,S.Cb)({type:Ct.Z,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Xt.prototype,"floorInfo",void 0),(0,r._)([(0,S.Cb)({type:Le,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Xt.prototype,"formTemplate",void 0),(0,r._)([(0,S.Cb)({type:De.Z,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Xt.prototype,"fullExtent",void 0),(0,r._)([(0,S.Cb)()],Xt.prototype,"gdbVersion",void 0),(0,r._)([(0,S.Cb)({readOnly:!0,type:bt,json:{read:{source:"geometryProperties"}}})],Xt.prototype,"geometryFieldsInfo",void 0),(0,r._)([(0,S.Cb)({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Ut.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:Yt,writer(e,t,i){const r=e?Ut.toJSON(e):null;r&&(0,w.RB)(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:Ut.read}}})],Xt.prototype,"geometryType",void 0),(0,r._)([(0,S.Cb)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Xt.prototype,"hasM",void 0),(0,r._)([(0,S.Cb)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Xt.prototype,"hasZ",void 0),(0,r._)([(0,S.Cb)({readOnly:!0,type:Ne.Z})],Xt.prototype,"heightModelInfo",void 0),(0,r._)([(0,S.Cb)({type:Date})],Xt.prototype,"historicMoment",void 0),(0,r._)([(0,S.Cb)(ht.id)],Xt.prototype,"id",void 0),(0,r._)([(0,S.Cb)({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Xt.prototype,"infoFor3D",void 0),(0,r._)([(0,S.Cb)({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Xt.prototype,"isTable",void 0),(0,r._)([(0,A.r)("service","isTable",["type","geometryType"]),(0,A.r)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Xt.prototype,"readIsTable",null),(0,r._)([(0,O.c)("web-map","isTable")],Xt.prototype,"writeIsTable",null),(0,r._)([(0,S.Cb)(ht.iR)],Xt.prototype,"labelsVisible",void 0),(0,r._)([(0,S.Cb)({type:[wt.Z],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:xt.r},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:xt.r},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Xt.prototype,"labelingInfo",void 0),(0,r._)([(0,S.Cb)((()=>{const e=(0,y.d9)(ht.bT);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,t,i){(0,w.RB)(i,(0,kt.a)(e),t)}}},e})())],Xt.prototype,"opacity",void 0),(0,r._)([(0,S.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],Xt.prototype,"layerId",void 0),(0,r._)([(0,S.Cb)(ht.rn)],Xt.prototype,"legendEnabled",void 0),(0,r._)([(0,S.Cb)({type:["show","hide"],json:(()=>{const e=(0,y.d9)(ht.rT.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],Xt.prototype,"listMode",void 0),(0,r._)([(0,S.Cb)(ht.rO)],Xt.prototype,"minScale",void 0),(0,r._)([(0,A.r)("service","minScale",["minScale","effectiveMinScale"])],Xt.prototype,"readMinScale",null),(0,r._)([(0,S.Cb)(ht.u1)],Xt.prototype,"maxScale",void 0),(0,r._)([(0,A.r)("service","maxScale",["maxScale","effectiveMaxScale"])],Xt.prototype,"readMaxScale",null),(0,r._)([(0,S.Cb)({type:String})],Xt.prototype,"globalIdField",void 0),(0,r._)([(0,A.r)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),(0,A.r)("service","globalIdField",["globalIdField","fields"])],Xt.prototype,"readGlobalIdFieldFromService",null),(0,r._)([(0,S.Cb)({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:Yt}}}}})],Xt.prototype,"objectIdField",void 0),(0,r._)([(0,A.r)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),(0,A.r)("service","objectIdField",["objectIdField","fields"])],Xt.prototype,"readObjectIdFieldFromService",null),(0,r._)([(0,S.Cb)({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Xt.prototype,"operationalLayerType",void 0),(0,r._)([(0,S.Cb)($t.outFields)],Xt.prototype,"outFields",void 0),(0,r._)([(0,S.Cb)({readOnly:!0})],Xt.prototype,"parsedUrl",null),(0,r._)([(0,S.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Xt.prototype,"path",void 0),(0,r._)([(0,S.Cb)(ht.C_)],Xt.prototype,"popupEnabled",void 0),(0,r._)([(0,S.Cb)({type:s.Z,json:{name:"popupInfo",write:!0}})],Xt.prototype,"popupTemplate",void 0),(0,r._)([(0,S.Cb)({readOnly:!0})],Xt.prototype,"defaultPopupTemplate",null),(0,r._)([(0,S.Cb)({type:[At],readOnly:!0})],Xt.prototype,"relationships",void 0),(0,r._)([(0,S.Cb)({types:l.A,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:l.o,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,i)=>({ignoreOrigin:i?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:i?.writeLayerSchema})}}})],Xt.prototype,"renderer",null),(0,r._)([(0,A.r)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),(0,A.r)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Xt.prototype,"readRenderer",null),(0,r._)([(0,S.Cb)()],Xt.prototype,"sourceJSON",void 0),(0,r._)([(0,S.Cb)({type:Boolean})],Xt.prototype,"returnM",void 0),(0,r._)([(0,S.Cb)({type:Boolean})],Xt.prototype,"returnZ",void 0),(0,r._)([(0,S.Cb)((()=>{const e=(0,y.d9)(ht.YI);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],Xt.prototype,"screenSizePerspectiveEnabled",void 0),(0,r._)([(0,S.Cb)({clonable:!1})],Xt.prototype,"source",null),(0,r._)([(0,E.p)("source")],Xt.prototype,"castSource",null),(0,r._)([(0,A.r)("portal-item","source",["featureSet"]),(0,A.r)("web-map","source",["featureSet"])],Xt.prototype,"readSource",null),(0,r._)([(0,S.Cb)({readOnly:!0})],Xt.prototype,"serviceDefinitionExpression",void 0),(0,r._)([(0,A.r)("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Xt.prototype,"readServiceDefinitionExpression",null),(0,r._)([(0,S.Cb)({type:Fe.Z,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Xt.prototype,"spatialReference",void 0),(0,r._)([(0,S.Cb)({type:Number})],Xt.prototype,"subtypeCode",void 0),(0,r._)([(0,S.Cb)({type:String,json:{origins:{service:{read:!0}}}})],Xt.prototype,"subtypeField",void 0),(0,r._)([(0,S.Cb)({type:[ft.Z]})],Xt.prototype,"templates",void 0),(0,r._)([(0,A.r)("templates",["editFieldsInfo","creatorField","editorField","templates"])],Xt.prototype,"readTemplates",null),(0,r._)([(0,S.Cb)({type:Mt.Z})],Xt.prototype,"timeInfo",void 0),(0,r._)([(0,S.Cb)()],Xt.prototype,"title",void 0),(0,r._)([(0,A.r)("service","title",["name"]),(0,A.r)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Xt.prototype,"readTitle",null),(0,r._)([(0,A.r)("web-map","title",["layerDefinition.name","title"])],Xt.prototype,"readTitleFromWebMap",null),(0,r._)([(0,S.Cb)({type:String})],Xt.prototype,"sublayerTitleMode",void 0),(0,r._)([(0,S.Cb)({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Xt.prototype,"trackIdField",void 0),(0,r._)([(0,S.Cb)({json:{read:!1}})],Xt.prototype,"type",void 0),(0,r._)([(0,S.Cb)({type:String})],Xt.prototype,"typeIdField",void 0),(0,r._)([(0,A.r)("service","typeIdField"),(0,A.r)("typeIdField",["layerDefinition.typeIdField"])],Xt.prototype,"readTypeIdField",null),(0,r._)([(0,S.Cb)({type:[mt.Z]})],Xt.prototype,"types",void 0),(0,r._)([(0,A.r)("service","types",["types"]),(0,A.r)("types",["layerDefinition.types"])],Xt.prototype,"readTypes",null),(0,r._)([(0,S.Cb)({readOnly:!0,json:{write:!1}})],Xt.prototype,"serverGens",void 0),(0,r._)([(0,S.Cb)({type:d.Z.ofType(dt),readOnly:!0})],Xt.prototype,"indexes",void 0),(0,r._)([(0,S.Cb)(ht.HQ)],Xt.prototype,"url",null),(0,r._)([(0,O.c)("url")],Xt.prototype,"writeUrl",null),(0,r._)([(0,S.Cb)({readOnly:!0})],Xt.prototype,"userIsAdmin",void 0),(0,r._)([(0,S.Cb)({json:{origins:{service:{read:!0}},read:!1}})],Xt.prototype,"version",void 0),(0,r._)([(0,A.r)("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Xt.prototype,"readVersion",null),(0,r._)([(0,S.Cb)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Xt.prototype,"visible",void 0),(0,r._)([(0,A.r)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Xt.prototype,"readVisible",null),Xt=(0,r._)([(0,M.j)("esri.layers.FeatureLayer")],Xt);const Jt=(0,R.d)({types:u.QT}),Kt=Xt},38481:(e,t,i)=>{"use strict";i.d(t,{Z:()=>b});var r=i(36663),s=(i(91957),i(66341)),n=i(70375),o=i(31355),a=i(86618),l=i(68309),c=i(13802),u=i(78668),h=i(3466),d=i(81977),p=(i(7753),i(39994),i(7283),i(40266)),f=i(51366);const m=c.Z.getLogger("esri.layers.support.fromPortalItem");var g=i(91772),y=i(14685);let _=0,v=class extends(o.Z.EventedMixin((0,a.IG)(l.Z))){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new g.Z(-180,-90,180,90,y.Z.WGS84),this.id=Date.now().toString(16)+"-layer-"+_++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=y.Z.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t="string"==typeof e?{url:e}:e;return(await i.e(6361).then(i.bind(i,66361))).fromUrl(t)}static fromPortalItem(e){return async function(e){const t="portalItem"in e?e:{portalItem:e},r=await i.e(5831).then(i.bind(i,55831));try{return await r.fromItem(t)}catch(e){const i=t&&t.portalItem,r=i&&i.id||"unset",s=i&&i.portal&&i.portal.url||f.Z.portalUrl;throw m.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+s+"', id: '"+r+"')",e),e}}(e)}initialize(){this.when().catch((e=>{(0,u.D_)(e)||c.Z.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})}))}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return null!=this.attributionDataUrl}get parsedUrl(){const e=this.url;return e?(0,h.mN)(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await(0,s.default)(e,{query:{f:"json"},responseType:"json"})).data;throw new n.Z("layer:no-attribution-data","Layer does not have attribution data")}};(0,r._)([(0,d.Cb)({type:String})],v.prototype,"attributionDataUrl",void 0),(0,r._)([(0,d.Cb)({type:g.Z})],v.prototype,"fullExtent",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],v.prototype,"hasAttributionData",null),(0,r._)([(0,d.Cb)({type:String,clonable:!1})],v.prototype,"id",void 0),(0,r._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],v.prototype,"legendEnabled",void 0),(0,r._)([(0,d.Cb)({type:["show","hide","hide-children"]})],v.prototype,"listMode",void 0),(0,r._)([(0,d.Cb)({type:Number,range:{min:0,max:1},nonNullable:!0})],v.prototype,"opacity",void 0),(0,r._)([(0,d.Cb)({clonable:!1})],v.prototype,"parent",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],v.prototype,"parsedUrl",null),(0,r._)([(0,d.Cb)({type:Boolean})],v.prototype,"popupEnabled",void 0),(0,r._)([(0,d.Cb)({type:Boolean})],v.prototype,"attributionVisible",void 0),(0,r._)([(0,d.Cb)({type:y.Z})],v.prototype,"spatialReference",void 0),(0,r._)([(0,d.Cb)({type:String})],v.prototype,"title",void 0),(0,r._)([(0,d.Cb)({readOnly:!0,json:{read:!1}})],v.prototype,"type",void 0),(0,r._)([(0,d.Cb)()],v.prototype,"url",void 0),(0,r._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],v.prototype,"visible",void 0),v=(0,r._)([(0,p.j)("esri.layers.Layer")],v);const b=v},74606:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ue});var r=i(36663),s=i(80020),n=(i(86004),i(45510),i(16192),i(71297),i(878),i(22836),i(50172),i(25634),i(72506),i(54021)),o=i(66341),a=i(41831),l=i(70375),c=i(13802),u=i(61681),h=i(15842),d=i(78668),p=i(76868),f=i(3466),m=i(81977),g=(i(7753),i(39994),i(95620)),y=(i(7283),i(34248)),_=i(40266),v=i(65943),b=i(38481),w=i(91223),x=i(87232),C=i(43330),T=i(18241),S=i(95874),E=i(69877),A=i(31484),M=i(51599),O=i(48257),R=i(69766),P=i(31906),I=i(89076),L=i(28790),D=i(17095),N=i(97304),F=i(26732),k=i(49341),U=i(94081),V=i(82064);let z=class extends V.wq{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};(0,r._)([(0,m.Cb)({type:String,json:{read:!0,write:!0}})],z.prototype,"name",void 0),(0,r._)([(0,m.Cb)({type:String,json:{read:!0,write:!0}})],z.prototype,"field",void 0),(0,r._)([(0,m.Cb)({type:[Number],json:{read:!0,write:!0}})],z.prototype,"currentRangeExtent",void 0),(0,r._)([(0,m.Cb)({type:[Number],json:{read:!0,write:!0}})],z.prototype,"fullRangeExtent",void 0),(0,r._)([(0,m.Cb)({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],z.prototype,"type",void 0),z=(0,r._)([(0,_.j)("esri.layers.support.RangeInfo")],z);var B,H=i(44584),j=i(67134),G=i(42557),W=i(96863),Z=(i(33156),i(89542)),q=i(90472);let $=B=class extends((0,V.eC)(a.Z.ofType(Z.Z))){constructor(e){super(e)}clone(){return new B(this.items.map((e=>e.clone())))}write(e,t){return this.toJSON(t)}toJSON(e){const t=e?.layer?.spatialReference;return t?this.toArray().map((i=>{if(!t.equals(i.spatialReference)){if(!(0,q.Up)(i.spatialReference,t))return e&&e.messages&&e.messages.push(new W.Z("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const r=new Z.Z;(0,q.Wt)(i,r,t),i=r}const r=i.toJSON(e);return delete r.spatialReference,r})).filter((e=>null!=e)):(e?.messages&&e.messages.push(new W.Z("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map((t=>t.toJSON(e))))}static fromJSON(e,t){const i=new B;return e.forEach((e=>i.add(Z.Z.fromJSON(e,t)))),i}};$=B=(0,r._)([(0,_.j)("esri.layers.support.PolygonCollection")],$);const Y=$;var X,J=i(16641);let K=X=class extends V.wq{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new Y,this._geometriesSource=null,this._handles=new H.Z}initialize(){this._handles.add((0,p.on)((()=>this.geometries),"after-changes",(()=>this.geometries=this.geometries),p.Z_))}destroy(){this._handles.destroy()}readGeometries(e,t,i){this._geometriesSource={url:(0,J.f)(e,i),context:i}}async loadGeometries(e,t){if((0,u.Wi)(this._geometriesSource))return;const{url:i,context:r}=this._geometriesSource,s=await(0,o.default)(i,{responseType:"json",signal:(0,u.U2)(t,"signal")}),n=e.toJSON(),a=s.data.map((e=>({...e,spatialReference:n})));this.geometries=Y.fromJSON(a,r),this._geometriesSource=null}clone(){return new X({geometries:(0,j.d9)(this.geometries),spatialRelationship:this.spatialRelationship})}};(0,r._)([(0,m.Cb)({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],K.prototype,"spatialRelationship",void 0),(0,r._)([(0,m.Cb)({type:Y,nonNullable:!0,json:{write:!0}}),(0,G.B)({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],K.prototype,"geometries",void 0),(0,r._)([(0,y.r)(["web-scene","portal-item"],"geometries")],K.prototype,"readGeometries",null),K=X=(0,r._)([(0,_.j)("esri.layers.support.SceneFilter")],K);const Q=K;var ee=i(16603),te=i(14136),ie=i(10171),re=i(78621);const se=["3DObject","Point"],ne=c.Z.getLogger("esri.layers.SceneLayer"),oe=(0,I.v)();let ae=class extends((0,E.Vt)((0,x.Y)((0,C.q)((0,T.I)((0,S.M)((0,h.R)((0,w.V)(b.Z)))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new a.Z,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){const i=this.getFeatureType(t?.feature)?.domains?.[e];return i&&"inherited"!==i.type?i:this.getField(e)?.domain??null}getFeatureType(e){return e&&(0,u.pC)(this.associatedLayer)?this.associatedLayer.getFeatureType(e):null}get types(){return(0,u.pC)(this.associatedLayer)?this.associatedLayer.types:[]}get typeIdField(){return(0,u.pC)(this.associatedLayer)?this.associatedLayer.typeIdField:null}get formTemplate(){return(0,u.pC)(this.associatedLayer)?this.associatedLayer.formTemplate:null}get fieldsIndex(){return new L.Z(this.fields)}readNodePages(e,t,i){return"Point"===t.layerType&&(e=t.pointNodePages),null==e||"object"!=typeof e?null:N.U4.fromJSON(e,i)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get geometryType(){return ce[this.profile]||"mesh"}set renderer(e){(0,D.YN)(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return null!=e&&"object"==typeof e||(e={}),null==e.color&&(e.color=!1),e}get capabilities(){const e=(0,u.pC)(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:A.C,{query:t,editing:{supportsGlobalId:i,supportsRollbackOnFailure:r,supportsUploadWithItemId:s,supportsReturnServiceEditsInSourceSpatialReference:n},data:{supportsZ:o,supportsM:a,isVersioned:l,supportsAttachment:c},operations:{supportsEditing:h,supportsUpdate:d,supportsQuery:p,supportsQueryAttachments:f}}=e,m=e.operations.supportsChangeTracking;return{query:t,editing:{supportsGlobalId:i,supportsReturnServiceEditsInSourceSpatialReference:n,supportsRollbackOnFailure:r,supportsGeometryUpdate:!1,supportsUploadWithItemId:s},data:{supportsAttachment:c,supportsZ:o,supportsM:a,isVersioned:l},operations:{supportsQuery:p,supportsQueryAttachments:f,supportsEditing:h&&m,supportsAdd:!1,supportsDelete:!1,supportsUpdate:d&&m}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(e){null!=e?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}get defaultPopupTemplate(){return(0,u.pC)(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some((t=>("esriFieldTypeOID"===t.type&&(e=t.name),!!e))),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some((t=>("esriFieldTypeGlobalID"===t.type&&(e=t.name),!!e))),e||void 0}get displayField(){return(0,u.pC)(this.associatedLayer)?this.associatedLayer.displayField:null}readProfile(e,t){const i=t.store.profile;return null!=i&&le[i]?le[i]:(ne.error("Unknown or missing profile",{profile:i,layer:this}),"mesh-pyramids")}load(e){const t=(0,u.pC)(e)?e.signal:null,i=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(d.r9).then((()=>this._fetchService(t))).then((()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),(0,u.pC)(this.filter)?this.filter.loadGeometries(this.spatialReference):null]))).then((()=>this._validateElevationInfo())).then((()=>this._applyAssociatedLayerOverrides())).then((()=>this._populateFieldUsageInfo())).then((()=>(0,ee.y)(this,{origin:"service"},t))).then((()=>(0,D.YN)(this.renderer,this.fieldsIndex))).then((()=>this.finishLoadEditablePortalLayer(e)));return this.addResolvingPromise(i),Promise.resolve(this)}async beforeSave(){(0,u.pC)(this.filter)&&await this.load()}createQuery(){const e=new te.Z;return"mesh"!==this.geometryType&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryExtent(e||this.createQuery(),t)))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryFeatureCount(e||this.createQuery(),t)))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryFeatures(e||this.createQuery(),t))).then((e=>{if(e?.features)for(const t of e.features)t.layer=this,t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryObjectIds(e||this.createQuery(),t)))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryAttachments(e,t)))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(ne.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return(0,ie.eZ)(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return(0,u.pC)(e)&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),(0,u.Wi)(this.associatedLayer))throw new l.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new l.Z("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return null!=this.statisticsInfo&&this.statisticsInfo.some((t=>t.name===e))}async queryCachedStatistics(e,t){if(await this.load(t),!this.statisticsInfo)throw new l.Z("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const i=this.fieldsIndex.get(e);if(!i)throw new l.Z("scenelayer:field-unexisting",`Field '${e}' does not exist on the layer`);for(const e of this.statisticsInfo)if(e.name===i.name){const i=(0,f.v_)(this.parsedUrl.path,e.href);return(0,o.default)(i,{query:{f:"json",token:this.apiKey},responseType:"json",signal:t?t.signal:null}).then((e=>e.data))}throw new l.Z("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(e,t){return this._debouncedSaveOperations(E.xp.SAVE_AS,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(E.xp.SAVE,e)}async applyEdits(e,t){const r=await i.e(3261).then(i.bind(i,23261));if(await this.load(),(0,u.Wi)(this.associatedLayer))throw new l.Z(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),r.applyEdits(this,this.associatedLayer.source,e,t)}on(e,t){return super.on(e,t)}validateLayer(e){if(e.layerType&&!se.includes(e.layerType))throw new l.Z("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new l.Z("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new l.Z("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});!function(e,t){let i=!1,r=!1;if(null==e)i=!0,r=!0;else{const s=t&&t.isGeographic;switch(e){case"east-north-up":case"earth-centered":i=!0,r=s;break;case"vertex-reference-frame":i=!0,r=!s;break;default:i=!1}}if(!i)throw new l.Z("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!r)throw new l.Z("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if("points"===this.profile)e.push("Point");else{if("mesh-pyramids"!==this.profile)throw new l.Z("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const t=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some((t=>t.name===e.name))),i=!!((0,u.pC)(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some((t=>t&&e.name===t.name))),r={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||i,supportsLayerQuery:i};this._fieldUsageInfo[e.name]=r}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides()}_applyAssociatedLayerFieldsOverrides(){if((0,u.Wi)(this.associatedLayer)||!this.associatedLayer.fields)return;let e=null;for(const t of this.associatedLayer.fields){const i=this.getField(t.name);i?(!i.domain&&t.domain&&(i.domain=t.domain.clone()),i.editable=t.editable,i.nullable=t.nullable,i.length=t.length):(e||(e=this.fields?this.fields.slice():[]),e.push(t.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if((0,u.Wi)(this.associatedLayer))return;const e=["popupTemplate","popupEnabled"],t=(0,g.vw)(this);for(let i=0;i<e.length;i++){const r=e[i],s=this.originIdOf(r),n=this.associatedLayer.originIdOf(r);s<n&&(n===v.s3.SERVICE||n===v.s3.PORTAL_ITEM)&&t.setAtOrigin(r,this.associatedLayer[r],n)}}async _setAssociatedFeatureLayer(e){if(!["mesh-pyramids","points"].includes(this.profile))return;const t=new P.W(this.parsedUrl,this.portalItem,this.apiKey,e);try{this.associatedLayer=await t.fetch()}catch(e){(0,d.D_)(e)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await(0,p.N1)((()=>this.popupEnabled&&null!=this.popupTemplate));const e=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?ne.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):ne.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;e&&("mesh-pyramids"===this.profile&&"relative-to-scene"===e.mode&&ne.warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),e.featureExpressionInfo&&"0"!==e.featureExpressionInfo.expression&&ne.warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};(0,r._)([(0,m.Cb)({types:{key:"type",base:O.B,typeMap:{selection:R.Z}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],ae.prototype,"featureReduction",void 0),(0,r._)([(0,m.Cb)({type:[z],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],ae.prototype,"rangeInfos",void 0),(0,r._)([(0,m.Cb)({json:{read:!1}})],ae.prototype,"associatedLayer",void 0),(0,r._)([(0,m.Cb)({type:["show","hide"]})],ae.prototype,"listMode",void 0),(0,r._)([(0,m.Cb)({type:["ArcGISSceneServiceLayer"]})],ae.prototype,"operationalLayerType",void 0),(0,r._)([(0,m.Cb)({json:{read:!1},readOnly:!0})],ae.prototype,"type",void 0),(0,r._)([(0,m.Cb)({...oe.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],ae.prototype,"fields",void 0),(0,r._)([(0,m.Cb)()],ae.prototype,"types",null),(0,r._)([(0,m.Cb)()],ae.prototype,"typeIdField",null),(0,r._)([(0,m.Cb)()],ae.prototype,"formTemplate",null),(0,r._)([(0,m.Cb)({readOnly:!0})],ae.prototype,"fieldsIndex",null),(0,r._)([(0,m.Cb)({type:U.Z,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],ae.prototype,"floorInfo",void 0),(0,r._)([(0,m.Cb)(oe.outFields)],ae.prototype,"outFields",void 0),(0,r._)([(0,m.Cb)({type:N.U4,readOnly:!0,json:{read:!1}})],ae.prototype,"nodePages",void 0),(0,r._)([(0,y.r)("service","nodePages",["nodePages","pointNodePages"])],ae.prototype,"readNodePages",null),(0,r._)([(0,m.Cb)({type:[N.QI],readOnly:!0})],ae.prototype,"materialDefinitions",void 0),(0,r._)([(0,m.Cb)({type:[N.Yh],readOnly:!0})],ae.prototype,"textureSetDefinitions",void 0),(0,r._)([(0,m.Cb)({type:[N.H3],readOnly:!0})],ae.prototype,"geometryDefinitions",void 0),(0,r._)([(0,m.Cb)({readOnly:!0})],ae.prototype,"serviceUpdateTimeStamp",void 0),(0,r._)([(0,m.Cb)({readOnly:!0})],ae.prototype,"attributeStorageInfo",void 0),(0,r._)([(0,m.Cb)({readOnly:!0})],ae.prototype,"statisticsInfo",void 0),(0,r._)([(0,m.Cb)({type:a.Z.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],ae.prototype,"excludeObjectIds",void 0),(0,r._)([(0,m.Cb)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],ae.prototype,"definitionExpression",void 0),(0,r._)([(0,m.Cb)({type:Q,json:{name:"layerDefinition.polygonFilter",write:!0}})],ae.prototype,"filter",void 0),(0,r._)([(0,m.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],ae.prototype,"path",void 0),(0,r._)([(0,m.Cb)(M.PV)],ae.prototype,"elevationInfo",null),(0,r._)([(0,m.Cb)({type:String})],ae.prototype,"geometryType",null),(0,r._)([(0,m.Cb)(M.iR)],ae.prototype,"labelsVisible",void 0),(0,r._)([(0,m.Cb)({type:[F.Z],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:k.r},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:k.r},write:!0}})],ae.prototype,"labelingInfo",void 0),(0,r._)([(0,m.Cb)(M.rn)],ae.prototype,"legendEnabled",void 0),(0,r._)([(0,m.Cb)({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){if("number"==typeof e&&e>=0&&e<=1)return e;const i=t.layerDefinition?.drawingInfo?.transparency;return void 0!==i?(0,re.b)(i):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],ae.prototype,"opacity",void 0),(0,r._)([(0,m.Cb)({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],ae.prototype,"priority",void 0),(0,r._)([(0,m.Cb)({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],ae.prototype,"semantic",void 0),(0,r._)([(0,m.Cb)({types:n.o,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],ae.prototype,"renderer",null),(0,r._)([(0,m.Cb)({json:{read:!1}})],ae.prototype,"cachedDrawingInfo",void 0),(0,r._)([(0,y.r)("service","cachedDrawingInfo")],ae.prototype,"readCachedDrawingInfo",null),(0,r._)([(0,m.Cb)({readOnly:!0,json:{read:!1}})],ae.prototype,"capabilities",null),(0,r._)([(0,m.Cb)({type:Boolean,json:{read:!1}})],ae.prototype,"editingEnabled",null),(0,r._)([(0,m.Cb)(M.C_)],ae.prototype,"popupEnabled",void 0),(0,r._)([(0,m.Cb)({type:s.Z,json:{name:"popupInfo",write:!0}})],ae.prototype,"popupTemplate",void 0),(0,r._)([(0,m.Cb)({readOnly:!0,json:{read:!1}})],ae.prototype,"defaultPopupTemplate",null),(0,r._)([(0,m.Cb)({type:String,json:{read:!1}})],ae.prototype,"objectIdField",void 0),(0,r._)([(0,y.r)("service","objectIdField",["objectIdField","fields"])],ae.prototype,"readObjectIdField",null),(0,r._)([(0,m.Cb)({type:String,json:{read:!1}})],ae.prototype,"globalIdField",void 0),(0,r._)([(0,y.r)("service","globalIdField",["globalIdField","fields"])],ae.prototype,"readGlobalIdField",null),(0,r._)([(0,m.Cb)({readOnly:!0,type:String,json:{read:!1}})],ae.prototype,"displayField",null),(0,r._)([(0,m.Cb)({type:String,json:{read:!1}})],ae.prototype,"profile",void 0),(0,r._)([(0,y.r)("service","profile",["store.profile"])],ae.prototype,"readProfile",null),(0,r._)([(0,m.Cb)({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],ae.prototype,"normalReferenceFrame",void 0),(0,r._)([(0,m.Cb)(M.YI)],ae.prototype,"screenSizePerspectiveEnabled",void 0),ae=(0,r._)([(0,_.j)("esri.layers.SceneLayer")],ae);const le={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},ce={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},ue=ae},88649:(e,t,i)=>{"use strict";i.d(t,{rk:()=>a,Tj:()=>l,GI:()=>c,CE:()=>u,Tq:()=>h,Zx:()=>d,Ee:()=>m});var r=i(86875),s=i(95550),n=i(64790),o=i(24455);class a{constructor(e,t,i){this.strength=e,this.radius=t,this.threshold=i,this.type="bloom"}interpolate(e,t,i){this.strength=p(e.strength,t.strength,i),this.radius=p(e.radius,t.radius,i),this.threshold=p(e.threshold,t.threshold,i)}clone(){return new a(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:f(this.radius),strength:this.strength,threshold:this.threshold}}}class l{constructor(e){this.radius=e,this.type="blur"}interpolate(e,t,i){this.radius=Math.round(p(e.radius,t.radius,i))}clone(){return new l(this.radius)}toJSON(){return{type:"blur",radius:f(this.radius)}}}class c{constructor(e,t){this.type=e,this.amount=t,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,i){this.amount=p(e.amount,t.amount,i),this._updateMatrix()}clone(){return new c(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||(0,n.c)();switch(this.type){case"brightness":this._colorMatrix=((e,t)=>{const i=(0,o.s)(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return(0,o.t)(i,i)})(e,this.amount);break;case"contrast":this._colorMatrix=((e,t)=>{const i=(0,o.s)(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return(0,o.t)(i,i)})(e,this.amount);break;case"grayscale":this._colorMatrix=((e,t)=>{const i=1-this.amount,r=(0,o.s)(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return(0,o.t)(r,r)})(e);break;case"invert":this._colorMatrix=((e,t)=>{const i=1-2*t,r=(0,o.s)(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return(0,o.t)(r,r)})(e,this.amount);break;case"saturate":this._colorMatrix=((e,t)=>{const i=(0,o.s)(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return(0,o.t)(i,i)})(e,this.amount);break;case"sepia":this._colorMatrix=((e,t)=>{const i=1-this.amount,r=(0,o.s)(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return(0,o.t)(r,r)})(e)}}}class u{constructor(e,t,i,r){this.offsetX=e,this.offsetY=t,this.blurRadius=i,this.color=r,this.type="drop-shadow"}interpolate(e,t,i){this.offsetX=p(e.offsetX,t.offsetX,i),this.offsetY=p(e.offsetY,t.offsetY,i),this.blurRadius=p(e.blurRadius,t.blurRadius,i),this.color[0]=Math.round(p(e.color[0],t.color[0],i)),this.color[1]=Math.round(p(e.color[1],t.color[1],i)),this.color[2]=Math.round(p(e.color[2],t.color[2],i)),this.color[3]=p(e.color[3],t.color[3],i)}clone(){return new u(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:f(this.offsetX),yoffset:f(this.offsetY),blurRadius:f(this.blurRadius),color:e}}}class h{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,i){this.angle=p(e.angle,t.angle,i),this._updateMatrix()}clone(){return new h(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||(0,n.c)();this._colorMatrix=((e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=(0,o.s)(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return(0,o.t)(s,s)})(e,this.angle)}}class d{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,t,i){this.amount=p(e.amount,t.amount,i)}clone(){return new d(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function p(e,t,i){return e+(t-e)*i}function f(e){return Math.round(1e3*(0,s.Wz)(e))/1e3}function m(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new c(e.type,0);case"saturate":case"brightness":case"contrast":return new c(e.type,1);case"opacity":return new d(1);case"hue-rotate":return new h(0);case"blur":return new l(0);case"drop-shadow":return new u(0,0,0,[...(0,r.h$)("transparent")]);case"bloom":return new a(0,0,1)}}},50913:(e,t,i)=>{"use strict";i.d(t,{cW:()=>l,ij:()=>a,rM:()=>c});var r=i(70375),s=i(86745),n=i(13045),o=i(60278);function a(e,t,i){try{return function(e){if(!e||0===e.length)return null;if(function(e){const t=e[0];return!!t&&"scale"in t}(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:c(i.value)});return t}return c(e)}(e)}catch(e){i?.messages?.push(e)}return null}function l(e,t,i,r){try{const r=function(e){const t=(0,n.Q)(e);return t?(0,o.Cb)(t)?t.map((e=>e.toJSON())):t.map((({scale:e,effects:t})=>({scale:e,value:t.map((e=>e.toJSON()))}))):null}(e);(0,s.RB)(i,r,t)}catch(e){r.messages&&r.messages.push(e)}}function c(e){if(!e||!e.length)return"";const t=[];for(const i of e){let e=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":e=[u(i,"amount")];break;case"blur":e=[u(i,"radius","pt")];break;case"hue-rotate":e=[u(i,"angle","deg")];break;case"drop-shadow":e=[u(i,"xoffset","pt"),u(i,"yoffset","pt"),u(i,"blurRadius","pt"),h(i,"color")];break;case"bloom":e=[u(i,"strength"),u(i,"radius","pt"),u(i,"threshold")]}const r=`${i.type}(${e.filter(Boolean).join(" ")})`;(0,n.Q)(r),t.push(r)}return t.join(" ")}function u(e,t,i){if(null==e[t])throw new r.Z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function h(e,t){if(null==e[t])throw new r.Z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}},13045:(e,t,i)=>{"use strict";i.d(t,{Q:()=>u});var r,s,n=i(86875),o=i(70375),a=i(88649),l=(i(58340),i(60278)),c={exports:{}};function u(e){if(!e||0===e.length)return null;if("string"==typeof e){const t=h(e);return t&&0!==t.length?t:null}const t=e.map((e=>{if(!Number.isFinite(e.scale)||e.scale<=0)throw new o.Z("effect:invalid-scale","scale must be finite and greater than 0",{stop:e});return{scale:e.scale,effects:h(e.value)}}));t.sort(((e,t)=>t.effects.length-e.effects.length));for(let e=0;e<t.length-1;e++){if(!(0,l.AS)(t[e].effects,t[e+1].effects))throw new o.Z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[e].effects,b:t[e+1].effects});(0,l.uF)(t[e].effects,t[e+1].effects)}return t.sort(((e,t)=>t.scale-e.scale)),t}function h(e){let t;if(!e)return[];try{t=c.exports.parse(e)}catch(t){throw new o.Z("effect:invalid-syntax","Invalid effect syntax",{value:e,error:t})}return t.map((e=>function(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(e){let t=1;return d(e.parameters,1),1===e.parameters.length&&(t=y(e.parameters[0])),new a.GI(e.name,t)}(e);case"opacity":return function(e){let t=1;return d(e.parameters,1),1===e.parameters.length&&(t=y(e.parameters[0])),new a.Zx(t)}(e);case"hue-rotate":return function(e){let t=0;return d(e.parameters,1),1===e.parameters.length&&(t=function(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=m[e.unit]))throw new o.Z("effect:type-error",`Expected <angle>, Actual: ${p(e)}`,{term:e})}(e),e.value*m[e.unit]||0}(e.parameters[0])),new a.Tq(t)}(e);case"blur":return function(e){let t=0;return d(e.parameters,1),1===e.parameters.length&&(t=_(e.parameters[0]),f(t,e.parameters[0])),new a.Tj(t)}(e);case"drop-shadow":return function(e){const t=[];let i=null;for(const r of e.parameters)if("color"===r.type){if(t.length&&Object.freeze(t),i)throw new o.Z("effect:type-error","Accepts only one color",{});i=v(r)}else{const e=_(r);if(Object.isFrozen(t))throw new o.Z("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&f(e,r)}if(t.length<2||t.length>3)throw new o.Z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new a.CE(t[0],t[1],t[2]||0,i||b("black"))}(e);case"bloom":return function(e){let t=1,i=0,r=0;return d(e.parameters,3),e.parameters[0]&&(t=y(e.parameters[0])),e.parameters[1]&&(i=_(e.parameters[1]),f(i,e.parameters[1])),e.parameters[2]&&(r=y(e.parameters[2])),new a.rk(t,i,r)}(e)}}catch(t){throw t.details.filter=e,t}throw new o.Z("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}(e)))}function d(e,t){if(e.length>t)throw new o.Z("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function p(e){if("color"===e.type)return"<color>";if(e.unit){if(g[e.unit])return"<length>";if(m[e.unit])return"<angle>";if("%"===e.unit)return"<percentage>"}return"<double>"}function f(e,t){if(e<0)throw new o.Z("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}s=function(){function e(t,i,r,s){var n=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(n,e.prototype),n.expected=i,n.found=r,n.location=s,n.name="SyntaxError",n}function t(e,t,i){return i=i||" ",e.length>t?e:(t-=e.length,e+(i+=i.repeat(t)).slice(0,t))}return function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}(e,Error),e.prototype.format=function(e){var i="Error: "+this.message;if(this.location){var r,s=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){s=e[r].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,o=this.location.source+":"+n.line+":"+n.column;if(s){var a=this.location.end,l=t("",n.line.toString().length),c=s[n.line-1],u=n.line===a.line?a.column:c.length+1;i+="\n --\x3e "+o+"\n"+l+" |\n"+n.line+" | "+c+"\n"+l+" | "+t("",n.column-1)+t("",u-n.column,"^")}else i+="\n at "+o}return i},e.buildMessage=function(e,t){var i={literal:function(e){return'"'+s(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?n(e[0])+"-"+n(e[1]):n(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function s(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function n(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function o(e){return i[e.type](e)}return"Expected "+function(e){var t,i,r=e.map(o);if(r.sort(),r.length>0){for(t=1,i=1;t<r.length;t++)r[t-1]!==r[t]&&(r[i]=r[t],i++);r.length=i}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,i){var r,s={},n=(i=void 0!==i?i:{}).grammarSource,o={start:ae},a=ae,l="none",c="grad",u="turn",h=/^[ \t\n\r]/,d=/^[a-z\-]/,p=/^[0-9a-fA-F]/,f=/^[+\-]/,m=/^[0-9]/,g=re("none"),y=te("none",!1),_=te(")",!1),v=te(",",!1),b=re("whitespace"),w=ie([" ","\t","\n","\r"],!1,!1),x=re("function"),C=te("(",!1),T=re("identifier"),S=ie([["a","z"],"-"],!1,!1),E=re("percentage"),A=te("%",!1),M=re("length"),O=te("px",!1),R=te("cm",!1),P=te("mm",!1),I=te("in",!1),L=te("pt",!1),D=te("pc",!1),N=re("angle"),F=te("deg",!1),k=te("rad",!1),U=te("grad",!1),V=te("turn",!1),z=re("number"),B=re("color"),H=te("#",!1),j=ie([["0","9"],["a","f"],["A","F"]],!1,!1),G=ie(["+","-"],!1,!1),W=ie([["0","9"]],!1,!1),Z=te(".",!1),q=te("e",!1),$=0,Y=0,X=[{line:1,column:1}],J=0,K=[],Q=0;if("startRule"in i){if(!(i.startRule in o))throw new Error("Can't start parsing from rule \""+i.startRule+'".');a=o[i.startRule]}function ee(){return t.substring(Y,$)}function te(e,t){return{type:"literal",text:e,ignoreCase:t}}function ie(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function re(e){return{type:"other",description:e}}function se(e){var i,r=X[e];if(r)return r;for(i=e-1;!X[i];)i--;for(r={line:(r=X[i]).line,column:r.column};i<e;)10===t.charCodeAt(i)?(r.line++,r.column=1):r.column++,i++;return X[e]=r,r}function ne(e,t){var i=se(e),r=se(t);return{source:n,start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:r.line,column:r.column}}}function oe(e){$<J||($>J&&(J=$,K=[]),K.push(e))}function ae(){var e;return(e=le())===s&&(e=function(){var e,t;if(e=[],(t=ce())!==s)for(;t!==s;)e.push(t),t=ce();else e=s;return e}()),e}function le(){var e,i;return Q++,e=$,he(),t.substr($,4)===l?(i=l,$+=4):(i=s,0===Q&&oe(y)),i!==s?(he(),Y=e,e=[]):($=e,e=s),Q--,e===s&&0===Q&&oe(g),e}function ce(){var e,i,r,n;return e=$,he(),(i=function(){var e,i,r;return Q++,e=$,(i=de())!==s?(40===t.charCodeAt($)?(r="(",$++):(r=s,0===Q&&oe(C)),r!==s?(Y=e,e=i):($=e,e=s)):($=e,e=s),Q--,e===s&&(i=s,0===Q&&oe(x)),e}())!==s?(he(),(r=function(){var e,i,r,n,o,a,l,c;if(e=$,(i=ue())!==s){for(r=[],n=$,o=he(),44===t.charCodeAt($)?(a=",",$++):(a=s,0===Q&&oe(v)),a===s&&(a=null),l=he(),(c=ue())!==s?n=o=[o,a,l,c]:($=n,n=s);n!==s;)r.push(n),n=$,o=he(),44===t.charCodeAt($)?(a=",",$++):(a=s,0===Q&&oe(v)),a===s&&(a=null),l=he(),(c=ue())!==s?n=o=[o,a,l,c]:($=n,n=s);Y=e,e=function(e,t){return t.length>0?function(e,t,i){return[e].concat(function(e,t){return e.map((function(e){return e[3]}))}(t))}(e,t):[e]}(i,r)}else $=e,e=s;return e}())===s&&(r=null),he(),41===t.charCodeAt($)?(n=")",$++):(n=s,0===Q&&oe(_)),n!==s?(he(),Y=e,e=function(e,t){return{type:"function",name:e,parameters:t||[]}}(i,r)):($=e,e=s)):($=e,e=s),e}function ue(){var e,t;return e=$,(t=pe())===s&&(t=fe())===s&&(t=me())===s&&(t=function(){var e,t;return Q++,e=$,he(),(t=ye())!==s?(Y=e,e=function(e){return{value:e,unit:null}}(t)):($=e,e=s),Q--,e===s&&0===Q&&oe(z),e}()),t!==s&&(Y=e,t=function(e){return{type:"quantity",value:e.value,unit:e.unit}}(t)),(e=t)===s&&(e=$,(t=ge())!==s&&(Y=e,t=function(e){return{type:"color",colorType:e.type,value:e.value}}(t)),e=t),e}function he(){var e,i;for(Q++,e=[],h.test(t.charAt($))?(i=t.charAt($),$++):(i=s,0===Q&&oe(w));i!==s;)e.push(i),h.test(t.charAt($))?(i=t.charAt($),$++):(i=s,0===Q&&oe(w));return Q--,i=s,0===Q&&oe(b),e}function de(){var e,i,r;if(Q++,e=$,i=[],d.test(t.charAt($))?(r=t.charAt($),$++):(r=s,0===Q&&oe(S)),r!==s)for(;r!==s;)i.push(r),d.test(t.charAt($))?(r=t.charAt($),$++):(r=s,0===Q&&oe(S));else i=s;return i!==s&&(Y=e,i=ee()),Q--,(e=i)===s&&(i=s,0===Q&&oe(T)),e}function pe(){var e,i,r;return Q++,e=$,he(),(i=ye())!==s?(37===t.charCodeAt($)?(r="%",$++):(r=s,0===Q&&oe(A)),r!==s?(Y=e,e=function(e){return{value:e,unit:"%"}}(i)):($=e,e=s)):($=e,e=s),Q--,e===s&&0===Q&&oe(E),e}function fe(){var e,i,r;return Q++,e=$,he(),(i=ye())!==s?("px"===t.substr($,2)?(r="px",$+=2):(r=s,0===Q&&oe(O)),r!==s?(Y=e,e=function(e){return{value:e,unit:"px"}}(i)):($=e,e=s)):($=e,e=s),e===s&&(e=$,he(),(i=ye())!==s?("cm"===t.substr($,2)?(r="cm",$+=2):(r=s,0===Q&&oe(R)),r!==s?(Y=e,e=function(e){return{value:e,unit:"cm"}}(i)):($=e,e=s)):($=e,e=s),e===s&&(e=$,he(),(i=ye())!==s?("mm"===t.substr($,2)?(r="mm",$+=2):(r=s,0===Q&&oe(P)),r!==s?(Y=e,e=function(e){return{value:e,unit:"mm"}}(i)):($=e,e=s)):($=e,e=s),e===s&&(e=$,he(),(i=ye())!==s?("in"===t.substr($,2)?(r="in",$+=2):(r=s,0===Q&&oe(I)),r!==s?(Y=e,e=function(e){return{value:e,unit:"in"}}(i)):($=e,e=s)):($=e,e=s),e===s&&(e=$,he(),(i=ye())!==s?("pt"===t.substr($,2)?(r="pt",$+=2):(r=s,0===Q&&oe(L)),r!==s?(Y=e,e=function(e){return{value:e,unit:"pt"}}(i)):($=e,e=s)):($=e,e=s),e===s&&(e=$,he(),(i=ye())!==s?("pc"===t.substr($,2)?(r="pc",$+=2):(r=s,0===Q&&oe(D)),r!==s?(Y=e,e=function(e){return{value:e,unit:"pc"}}(i)):($=e,e=s)):($=e,e=s)))))),Q--,e===s&&0===Q&&oe(M),e}function me(){var e,i,r;return Q++,e=$,(i=ye())!==s?("deg"===t.substr($,3)?(r="deg",$+=3):(r=s,0===Q&&oe(F)),r!==s?(Y=e,e=function(e){return{value:e,unit:"deg"}}(i)):($=e,e=s)):($=e,e=s),e===s&&(e=$,(i=ye())!==s?("rad"===t.substr($,3)?(r="rad",$+=3):(r=s,0===Q&&oe(k)),r!==s?(Y=e,e=function(e){return{value:e,unit:"rad"}}(i)):($=e,e=s)):($=e,e=s),e===s&&(e=$,(i=ye())!==s?(t.substr($,4)===c?(r=c,$+=4):(r=s,0===Q&&oe(U)),r!==s?(Y=e,e=function(e){return{value:e,unit:"grad"}}(i)):($=e,e=s)):($=e,e=s),e===s&&(e=$,(i=ye())!==s?(t.substr($,4)===u?(r=u,$+=4):(r=s,0===Q&&oe(V)),r!==s?(Y=e,e=function(e){return{value:e,unit:"turn"}}(i)):($=e,e=s)):($=e,e=s)))),Q--,e===s&&(i=s,0===Q&&oe(N)),e}function ge(){var e,i,r,n;if(Q++,e=$,35===t.charCodeAt($)?(i="#",$++):(i=s,0===Q&&oe(H)),i!==s){if(r=[],p.test(t.charAt($))?(n=t.charAt($),$++):(n=s,0===Q&&oe(j)),n!==s)for(;n!==s;)r.push(n),p.test(t.charAt($))?(n=t.charAt($),$++):(n=s,0===Q&&oe(j));else r=s;r!==s?(Y=e,e={type:"hex",value:ee()}):($=e,e=s)}else $=e,e=s;return e===s&&(e=$,(i=ce())!==s&&(Y=e,i=function(e){return{type:"function",value:e}}(i)),(e=i)===s&&(e=$,(i=de())!==s&&(Y=e,i={type:"named",value:ee()}),e=i)),Q--,e===s&&(i=s,0===Q&&oe(B)),e}function ye(){var e,i,r,n,o,a,l;for(e=$,f.test(t.charAt($))?(t.charAt($),$++):0===Q&&oe(G),i=$,r=[],m.test(t.charAt($))?(n=t.charAt($),$++):(n=s,0===Q&&oe(W));n!==s;)r.push(n),m.test(t.charAt($))?(n=t.charAt($),$++):(n=s,0===Q&&oe(W));if(46===t.charCodeAt($)?(n=".",$++):(n=s,0===Q&&oe(Z)),n!==s){if(o=[],m.test(t.charAt($))?(a=t.charAt($),$++):(a=s,0===Q&&oe(W)),a!==s)for(;a!==s;)o.push(a),m.test(t.charAt($))?(a=t.charAt($),$++):(a=s,0===Q&&oe(W));else o=s;o!==s?i=r=[r,n,o]:($=i,i=s)}else $=i,i=s;if(i===s)if(i=[],m.test(t.charAt($))?(r=t.charAt($),$++):(r=s,0===Q&&oe(W)),r!==s)for(;r!==s;)i.push(r),m.test(t.charAt($))?(r=t.charAt($),$++):(r=s,0===Q&&oe(W));else i=s;if(i!==s){if(r=$,101===t.charCodeAt($)?(n="e",$++):(n=s,0===Q&&oe(q)),n!==s){if(f.test(t.charAt($))?(o=t.charAt($),$++):(o=s,0===Q&&oe(G)),o===s&&(o=null),a=[],m.test(t.charAt($))?(l=t.charAt($),$++):(l=s,0===Q&&oe(W)),l!==s)for(;l!==s;)a.push(l),m.test(t.charAt($))?(l=t.charAt($),$++):(l=s,0===Q&&oe(W));else a=s;a!==s?r=n=[n,o,a]:($=r,r=s)}else $=r,r=s;r===s&&(r=null),Y=e,e=parseFloat(ee())}else $=e,e=s;return e}if((r=a())!==s&&$===t.length)return r;throw r!==s&&$<t.length&&oe({type:"end"}),function(t,i,r){return new e(e.buildMessage(t,i),t,i,r)}(K,J<t.length?t.charAt(J):null,J<t.length?ne(J,J+1):ne(J,J))}}},(r=c).exports&&(r.exports=s());const m={deg:1,grad:.9,rad:180/Math.PI,turn:360},g={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function y(e){!function(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new o.Z("effect:type-error",`Expected <double> or <percentage>, Actual: ${p(e)}`,{term:e})}(e);const t=e.value;return f(t,e),"%"===e.unit?.01*t:t}function _(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=g[e.unit]))throw new o.Z("effect:type-error",`Expected <length>, Actual: ${p(e)}`,{term:e})}(e),e.value*g[e.unit]||0}function v(e){switch(e.colorType){case"hex":return(0,n.rW)(e.value);case"named":return b(e.value);case"function":return function(e){if(d(e.parameters,4),w.test(e.name))return[y(e.parameters[0]),y(e.parameters[1]),y(e.parameters[2]),e.parameters[3]?y(e.parameters[3]):1];if(x.test(e.name))return(0,n.B7)(function(e){return function(e){if("quantity"!==e.type||null!==e.unit)throw new o.Z("effect:type-error",`Expected <double>, Actual: ${p(e)}`,{term:e})}(e),f(e.value,e),e.value}(e.parameters[0]),y(e.parameters[1]),y(e.parameters[2]),e.parameters[3]?y(e.parameters[3]):1);throw new o.Z("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}(e.value)}}function b(e){if(!(0,n.St)(e))throw new o.Z("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return(0,n.VL)(e)}const w=/^rgba?/i,x=/^hsla?/i},60278:(e,t,i)=>{"use strict";i.d(t,{AS:()=>s,Cb:()=>o,uF:()=>n});var r=i(88649);function s(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every(((e,t)=>e.type===i[t].type))}function n(e,t){const i=e.length>t.length?e:t,s=e.length>t.length?t:e;for(let e=s.length;e<i.length;e++)s.push((0,r.Ee)(i[e]))}function o(e){const t=e[0];return!!t&&"type"in t}},59958:(e,t,i)=>{"use strict";i.d(t,{S6:()=>n,nd:()=>o,u_:()=>s});var r=i(61681);class s{constructor(e=null,t={},i,r){this.geometry=e,this.attributes=t,this.centroid=i,this.objectId=r,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new s(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}function n(e){return!((0,r.Wi)(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class o extends s{}},61619:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});class r{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new r;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},15540:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});class r{constructor(e=[],t=[],i=!1){this.lengths=e??[],this.coords=t??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[t,i,s,n]=e,o=s-t,a=n-i;return new r([5],[t,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const r=this.lengths[i];for(let i=0;i<r;i++)e(this.coords[2*(i+t)],this.coords[2*(i+t)+1]);t+=r}}clone(e){return e?(e.set(this.coords),new r(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new r(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}},41109:(e,t,i)=>{"use strict";i.d(t,{f:()=>h,k:()=>o}),i(39994);var r=i(61681);function s(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const r=e[i],s=t[i];if(r.length!==s.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!==s[e])return!1}return!0}function n(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!s(e[i],t[i]))return!1;return!0}function o(e,t){return!!u(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function a(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!u(e.spatialReference,t.spatialReference)&&n(e.paths,t.paths)}function l(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!u(e.spatialReference,t.spatialReference)&&n(e.rings,t.rings)}function c(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!u(e.spatialReference,t.spatialReference)&&s(e.points,t.points)}function u(e,t){return e===t||e&&t&&e.equals(t)}function h(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!function(e,t){if(e===t)return!0;if((0,r.Wi)(e)||(0,r.Wi)(t))return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return o(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!u(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return a(e,t);case"polygon":return l(e,t);case"multipoint":return c(e,t);case"mesh":return!1;default:return}}(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const r of i)if(e[r]!==t[r])return!1;return!0}(e.attributes,t.attributes)}},94486:(e,t,i)=>{"use strict";function r(e){return"point"===e.type}i.d(t,{f:()=>r})},48358:(e,t,i)=>{"use strict";i.d(t,{FS:()=>x,MS:()=>T,PA:()=>g,Pj:()=>m,R3:()=>b,S6:()=>f,TF:()=>C,Tx:()=>_,Wh:()=>p,Xw:()=>v,dF:()=>w});var r=i(4745),s=(i(39994),i(61681)),n=i(86098),o=i(7958),a=i(14685),l=i(37116),c=i(24568),u=i(7505),h=i(59659),d=i(12512);i(41109);class p{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function f(e){return(0,s.pC)(e.geometry)}class m{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function g(e){const t=h.Mk.fromJSON(e.geometryType),i=a.Z.fromJSON(e.spatialReference),r=e.transform,n=e.features.map((n=>{const a=function(e,t,i,r){return{uid:(0,o.D)(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:y(e.geometry,t,i),visible:!0}}(n,t,i,e.objectIdFieldName),l=a.geometry;if((0,s.pC)(l)&&r)switch(l.type){case"point":a.geometry=(0,u.U1)(r,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=(0,u.J9)(r,l,l,l.hasZ,l.hasM);break;case"polygon":a.geometry=(0,u.Ie)(r,l,l,l.hasZ,l.hasM);break;case"polyline":a.geometry=(0,u.G6)(r,l,l,l.hasZ,l.hasM);break;case"extent":case"mesh":a.geometry=l}return a}));return{geometryType:t,features:n,spatialReference:i,fields:e.fields?e.fields.map((e=>d.Z.fromJSON(e))):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function y(e,t,i){if((0,s.Wi)(e))return null;switch(t){case"point":{const t=e;return{x:t.x,y:t.y,z:t.z,m:t.m,hasZ:null!=t.z,hasM:null!=t.m,type:"point",spatialReference:i}}case"polyline":{const t=e;return{paths:t.paths,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polyline",spatialReference:i}}case"polygon":{const t=e;return{rings:t.rings,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const t=e;return{points:t.points,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"multipoint",spatialReference:i}}}}function _(e,t,i,r){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:r,type:"point"}}function v(e){let t=32;return t+=(0,r.f2)(e.attributes),t+=3,t+=8+function(e){if((0,s.Wi)(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),s="polyline"===e.type?e.paths:e.rings;for(const e of s)i+=e.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(s.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=(0,n.Xw)(e.vertexAttributes.position),t+=(0,n.Xw)(e.vertexAttributes.normal),t+=(0,n.Xw)(e.vertexAttributes.uv),t+=(0,n.Xw)(e.vertexAttributes.tangent)}return t}(e.geometry),t}function b(e){if((0,s.Wi)(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function w(e){if((0,s.Wi)(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function x(e,t){switch((0,l.cS)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)(0,l.Wi)(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)(0,l.Wi)(t,e.rings[i],e.hasZ);break;case"multipoint":(0,l.Wi)(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function C(e,t){switch((0,c.cS)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)(0,c.Wi)(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)(0,c.Wi)(t,e.rings[i]);break;case"multipoint":(0,c.Wi)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function T(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}(0,l.Ue)(),(0,c.Ue)()},12065:(e,t,i)=>{"use strict";i.d(t,{$:()=>te,$g:()=>ie,EI:()=>j,GH:()=>G,IN:()=>v,Iv:()=>L,J6:()=>N,Jd:()=>_,Nh:()=>J,RZ:()=>X,Uy:()=>U,XA:()=>B,Yn:()=>H,cn:()=>q,dd:()=>I,di:()=>W,eG:()=>k,fQ:()=>x,hY:()=>re,h_:()=>$,lM:()=>Y,lz:()=>ne,oB:()=>oe,zj:()=>K});var r=i(70375),s=i(13802),n=i(61681),o=i(53736),a=i(59958),l=i(61619),c=i(15540);function u(e,t){return e?t?4:3:t?3:2}const h=s.Z.getLogger("esri.layers.graphics.featureConversionUtils"),d={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},p=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},f=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},m=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},g=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function y(e,t,i,r){if(e){if(i)return t&&r?g:f;if(t&&r)return m}else if(t&&r)return f;return p}function _({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function v({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function b({scale:e,translate:t},i){return i*e[0]+t[0]}function w({scale:e,translate:t},i){return t[1]-i*e[1]}function x(e,t,i){return e?t?i?O(e):S(e):i?A(e):C(e):null}function C(e){const t=e.coords;return{x:t[0],y:t[1]}}function T(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function S(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function E(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function A(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function M(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function O(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function R(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function P(e,t){return e&&t?R:e?E:t?M:T}function I(e,t,i=P(null!=t.z,null!=t.m)){return i(e,t)}function L(e,t,i){if((0,n.Wi)(e))return null;const r=u(t,i),s=[];for(let t=0;t<e.coords.length;t+=r){const i=[];for(let s=0;s<r;s++)i.push(e.coords[t+s]);s.push(i)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function D(e,t,i=u(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const e of t.points)for(let t=0;t<i;t++)r[s++]=e[t];return e}function N(e,t,i){if(!e)return null;const r=u(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const e of n){const t=[];for(let i=0;i<e;i++){const e=[];for(let t=0;t<r;t++)e.push(s[a++]);t.push(e)}o.push(t)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function F(e,t,i=u(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const e of t.paths){for(const t of e)for(let e=0;e<i;e++)s[n++]=t[e];r.push(e.length)}return e}function k(e,t,i){if(!e)return null;const r=u(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const e of n){const t=[];for(let i=0;i<e;i++){const e=[];for(let t=0;t<r;t++)e.push(s[a++]);t.push(e)}o.push(t)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function U(e,t,i=t.hasZ,r=t.hasM){return function(e,t,i,r){const s=u(i,r),{lengths:n,coords:o}=e;let a=0;n.length=o.length=0;for(const e of t){for(const t of e)for(let e=0;e<s;e++)o[a++]=t[e];n.push(e.length)}}(e,t.rings,i,r),e}const V=[],z=[];function B(e,t,i,r,s){V[0]=e;const[n]=H(z,V,t,i,r,s);return V.length=z.length=0,n}function H(e,t,i,s,o,l){if(e.length=0,!i){for(const i of t){const t=i.attributes[l];e.push(new a.u_(null,i.attributes,null,t))}return e}switch(i){case"esriGeometryPoint":return function(e,t,i,r,s){const n=P(i,r);for(const i of t){const{geometry:t,attributes:r}=i;let o;t&&(o=n(new c.Z,t)),e.push(new a.u_(o,r,null,r[s]))}return e}(e,t,s,o,l);case"esriGeometryMultipoint":return function(e,t,i,r,s){const n=u(i,r);for(const i of t){const t=i.geometry,r=i.attributes;let o;t&&(o=D(new c.Z,t,n)),e.push(new a.u_(o,r,null,r[s]))}return e}(e,t,s,o,l);case"esriGeometryPolyline":return function(e,t,i,r,s){const n=u(i,r);for(const i of t){const t=i.geometry,r=i.attributes;let o;t&&(o=F(new c.Z,t,n)),e.push(new a.u_(o,r,null,r[s]))}return e}(e,t,s,o,l);case"esriGeometryPolygon":return function(e,t,i,r,s){for(const o of t){const t=o.geometry,l=o.centroid,u=o.attributes;let h;t&&(h=U(new c.Z,t,i,r)),(0,n.pC)(l)?e.push(new a.u_(h,u,T(new c.Z,l),u[s])):e.push(new a.u_(h,u,null,u[s]))}return e}(e,t,s,o,l);default:h.error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function j(e,t,i,r){z[0]=e,Z(V,z,t,i,r);const s=V[0];return V.length=z.length=0,s}function G(e,t,i){if((0,n.Wi)(e))return null;const s=new c.Z;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==i&&(i=e.hasM),(0,o.wp)(e)?P(null!=t?t:null!=e.z,null!=i?i:null!=e.m)(s,e):(0,o.oU)(e)?U(s,e,t,i):(0,o.l9)(e)?F(s,e,u(t,i)):(0,o.aW)(e)?D(s,e,u(t,i)):void h.error("convertFromGeometry:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${e}'`))}function W(e,t,i,s){const o=e&&("coords"in e?e:e.geometry);if((0,n.Wi)(o))return null;switch(t){case"esriGeometryPoint":{let e=C;return i&&s?e=O:i?e=S:s&&(e=A),e(o)}case"esriGeometryMultipoint":return L(o,i,s);case"esriGeometryPolyline":return N(o,i,s);case"esriGeometryPolygon":return k(o,i,s);default:return void h.error("convertToGeometry:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${t}'`))}}function Z(e,t,i,s,o){if(e.length=0,(0,n.Wi)(i))return function(e,t){for(const i of t)e.push({attributes:i.attributes});return e}(e,t);switch(i){case"esriGeometryPoint":return function(e,t,i,r){let s=C;i&&r?s=O:i?s=S:r&&(s=A);for(const i of t){const{geometry:t,attributes:r}=i,o=(0,n.pC)(t)?s(t):null;e.push({attributes:r,geometry:o})}return e}(e,t,s,o);case"esriGeometryMultipoint":return function(e,t,i,r){for(const s of t){const{geometry:t,attributes:n}=s;let o;t&&(o=L(t,i,r)),e.push({attributes:n,geometry:o})}return e}(e,t,s,o);case"esriGeometryPolyline":return function(e,t,i,r){for(const s of t){const{geometry:t,attributes:o}=s;let a;(0,n.pC)(t)&&(a=N(t,i,r)),e.push({attributes:o,geometry:a})}return e}(e,t,s,o);case"esriGeometryPolygon":return function(e,t,i,r){for(const s of t){const{geometry:t,attributes:o,centroid:a}=s;let l;if((0,n.pC)(t)&&(l=k(t,i,r)),(0,n.pC)(a)){const t=C(a);e.push({attributes:o,centroid:t,geometry:l})}else e.push({attributes:o,geometry:l})}return e}(e,t,s,o);default:h.error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${i}'`))}return e}function q(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:d}=e,p={features:Z([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:u,queryGeometry:W(h,d,!1,!1)};return r&&(p.transform=r),c&&(p.exceededTransferLimit=c),n&&(p.hasM=n),o&&(p.hasZ=o),p}function $(e,t){const i=new l.Z,{hasM:s,hasZ:n,features:o,objectIdFieldName:a,spatialReference:c,geometryType:u,exceededTransferLimit:d,transform:p,fields:f}=e;return f&&(i.fields=f),i.geometryType=u,i.objectIdFieldName=a||t,i.spatialReference=c,i.objectIdFieldName?(o&&H(i.features,o,u,n,s,i.objectIdFieldName),d&&(i.exceededTransferLimit=d),s&&(i.hasM=s),n&&(i.hasZ=n),p&&(i.transform=p),i):(h.error(new r.Z("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function Y(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const e of i)(0,n.pC)(e.geometry)&&ie(e.geometry,e.geometry,r,s,t),(0,n.pC)(e.centroid)&&ie(e.centroid,e.centroid,r,s,t);return e.transform=null,e}function X(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let t=0;t<r.length;t++){const o=r[t],a=o.weakClone();a.geometry=new c.Z,J(a.geometry,o.geometry,s,n,i,e),o.centroid&&(a.centroid=new c.Z,J(a.centroid,o.centroid,s,n,"esriGeometryPoint",e)),r[t]=a}return t.transform=e,t}function J(e,t,i,r,s,o,a=i,l=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),(0,n.Wi)(t)||!t.coords.length)return null;const c=d[s],{coords:h,lengths:p}=t,f=u(i,r),m=u(i&&a,r&&l),g=y(i,r,a,l);if(!p.length)return g(e.coords,h,0,0,_(o,h[0]),v(o,h[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=f,e;let b,w,x,C,T=0,S=0,E=S;for(const t of p){if(t<c)continue;let i=0;S=E,x=b=_(o,h[T]),C=w=v(o,h[T+1]),g(e.coords,h,S,T,x,C),i++,T+=f,S+=m;for(let r=1;r<t;r++,T+=f)x=_(o,h[T]),C=v(o,h[T+1]),x===b&&C===w||(g(e.coords,h,S,T,x-b,C-w),S+=m,i++,b=x,w=C);i>=c&&(e.lengths.push(i),E=S)}return e.coords.length=E,e.coords.length?e:null}function K(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=d[s],{coords:c,lengths:h}=t,p=u(i,r),f=u(i&&o,r&&a),m=y(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let g=0;const _=n*n;for(const t of h){if(t<l){g+=t*p;continue}const i=e.coords.length/f,r=g,s=g+(t-1)*p;m(e.coords,c,e.coords.length,r,c[r],c[r+1]),ee(e.coords,c,p,_,m,r,s),m(e.coords,c,e.coords.length,s,c[s],c[s+1]);const n=e.coords.length/f-i;n>=l?e.lengths.push(n):e.coords.length=i*f,g+=t*p}return e.coords.length?e:null}function Q(e,t,i,r){const s=e[t],n=e[t+1],o=e[i],a=e[i+1],l=e[r],c=e[r+1];let u=o,h=a,d=l-u,p=c-h;if(0!==d||0!==p){const e=((s-u)*d+(n-h)*p)/(d*d+p*p);e>1?(u=l,h=c):e>0&&(u+=d*e,h+=p*e)}return d=s-u,p=n-h,d*d+p*p}function ee(e,t,i,r,s,n,o){let a,l=r,c=0;for(let e=n+i;e<o;e+=i)a=Q(t,e,n,o),a>l&&(c=e,l=a);l>r&&(c-n>i&&ee(e,t,i,r,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>i&&ee(e,t,i,r,s,c,o))}function te(e,t,i,r){if((0,n.Wi)(t)||!t.coords||!t.coords.length)return null;const s=u(i,r);let o=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=s){const i=e[t],r=e[t+1];o=Math.min(o,i),l=Math.max(l,i),a=Math.min(a,r),c=Math.max(c,r)}}return e[0]=o,e[1]=a,e[2]=l,e[3]=c,e}function ie(e,t,i,r,s){const{coords:n,lengths:o}=t,a=i?r?g:f:r?f:p,l=u(i,r);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,n,0,0,b(s,n[0]),w(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,h]=s.scale;let d=0;for(let t=0;t<o.length;t++){const i=o[t];e.lengths[t]=i;let r=b(s,n[d]),u=w(s,n[d+1]);a(e.coords,n,d,d,r,u),d+=l;for(let t=1;t<i;t++,d+=l)r+=n[d]*c,u-=n[d+1]*h,a(e.coords,n,d,d,r,u)}return e!==t&&(e.lengths.length=o.length,e.coords.length=n.length),e}function re(e,t,i,r,s,n){const o=u(i,r),a=y(i,r,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let t=0;t<l.length;t+=o)a(e.coords,l,e.coords.length,t,l[t],l[t+1]);return e}function se(e,t,i,r){let s=0,n=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const i=n+e[r*(t+a)],l=o+e[r*(t+a)+1],c=(i-n)*(l+o);n=i,o=l,s+=c}return.5*s}function ne(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let e=0;e<r.length;e++)n+=se(i,s,r[e],t),s+=e;return Math.abs(n)}function oe(e,t){if((0,n.Wi)(e))return null;const i=e.clone(),r=e.coords,s=e.lengths;let o=0;for(let e=0;e<s.length;e++){const n=s[e];let a=r[t*o],l=r[t*o+1];for(let e=1;e<n;e++){const s=a+r[t*(o+e)],n=l+r[t*(o+e)+1];i.coords[t*(o+e)]=s,i.coords[t*(o+e)+1]=n,a=s,l=n}o+=n}return i}},45043:(e,t,i)=>{"use strict";i.d(t,{Ou:()=>c,WG:()=>g,kB:()=>d,mW:()=>h});var r=i(80085),s=(i(39994),i(67134)),n=i(61681),o=i(86098),a=i(53736),l=i(48358);function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function h(e,t){if(!e)return null;if("declaredClass"in e)return e;const i=new r.Z({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=(0,s.d9)(e.symbol),i.attributes=(0,s.d9)(e.attributes),i.geometry=d(e.geometry),i}function d(e){return(0,n.Wi)(e)?null:c(e)?e:(0,a.im)(function(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:s,m:n}=e;return{x:i,y:r,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=e;return{rings:p(i),hasZ:r,hasM:s,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=e;return{paths:p(i),hasZ:r,hasM:s,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h}=e;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=e;return{points:m(i)?f(i):i,hasZ:r,hasM:s,spatialReference:t}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return m(t);return!1}(e)?e.map((e=>f(e))):e}function f(e){return e.map((e=>(0,o.qo)(e)))}function m(e){return e.length&&((0,o.xZ)(e[0])||(0,o.fS)(e[0]))}function g(e,t){if(!e)return null;let i;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=(0,l.Tx)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}},91223:(e,t,i)=>{"use strict";i.d(t,{V:()=>o});var r=i(36663),s=i(81977),n=(i(7753),i(39994),i(7283),i(40266));const o=e=>{let t=class extends e{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):"portalItem"in this?this.portalItem?.apiKey:null}set apiKey(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,r._)([(0,s.Cb)({type:String})],t.prototype,"apiKey",null),t=(0,r._)([(0,n.j)("esri.layers.mixins.APIKeyMixin")],t),t}},87232:(e,t,i)=>{"use strict";i.d(t,{Y:()=>c});var r=i(36663),s=i(13802),n=i(61681),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(20692);const c=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=(0,l.Qc)(this.url);if((0,n.pC)(e)&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",(0,l.Nm)(e,s.Z.getLogger(this.declaredClass)))}};return(0,r._)([(0,o.Cb)()],t.prototype,"title",null),(0,r._)([(0,o.Cb)({type:String})],t.prototype,"url",null),t=(0,r._)([(0,a.j)("esri.layers.mixins.ArcGISService")],t),t}},27668:(e,t,i)=>{"use strict";i.d(t,{h:()=>l});var r=i(36663),s=i(81977),n=(i(7753),i(39994),i(7283),i(40266)),o=i(50913);const a={read:{reader:o.ij},write:{allowNull:!0,writer:o.cW}},l=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,r._)([(0,s.Cb)({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),(0,r._)([(0,s.Cb)({json:{read:!1,write:!1,origins:{"web-map":a,"portal-item":a}}})],t.prototype,"effect",void 0),t=(0,r._)([(0,n.j)("esri.layers.mixins.BlendLayer")],t),t}},63989:(e,t,i)=>{"use strict";i.d(t,{N:()=>o});var r=i(36663),s=i(81977),n=(i(7753),i(39994),i(7283),i(40266));const o=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return(0,r._)([(0,s.Cb)({type:Object,json:{write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0)})}}})],t.prototype,"customParameters",void 0),t=(0,r._)([(0,n.j)("esri.layers.mixins.CustomParametersMixin")],t),t}},22368:(e,t,i)=>{"use strict";i.d(t,{b:()=>l});var r=i(36663),s=i(81977),n=(i(7753),i(39994),i(7283),i(40266)),o=i(92150);const a={write:{allowNull:!0}},l=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return(0,r._)([(0,s.Cb)({type:o.Z,json:{origins:{"web-map":a,"portal-item":a}}})],t.prototype,"featureEffect",void 0),t=(0,r._)([(0,n.j)("esri.layers.mixins.FeatureEffectLayer")],t),t}},43330:(e,t,i)=>{"use strict";i.d(t,{q:()=>p});var r=i(36663),s=i(70375),n=i(3466),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(39835),c=i(70148),u=i(86561);const h={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};var d=i(51599);const p=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(e,t,i,r){(r&&"ground"===r.layerContainerType||e&&(0,u.d)(this,i,{},r))&&(t[i]=e)}writeOperationalLayerType(e,t,i,r){!e||r&&"tables"===r.layerContainerType||(t.layerType=e)}writeTitle(e,t){t.title=e||"Layer"}read(e,t){t&&(t.layer=this),(0,c.$)(this,e,(t=>super.read(e,t)),t)}write(e,t){if(t?.origin){const e=`${t.origin}/${t.layerContainerType||"operational-layers"}`,i=h[e];let r=i&&i[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(r=!1),!r)return t.messages?.push(new s.Z("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const i=super.write(e,{...t,layer:this}),r=!!t&&!!t.messages&&!!t.messages.filter((e=>e instanceof s.Z&&"web-document-write:property-required"===e.name)).length;return(0,n.jc)(i?.url)?(t?.messages?.push(new s.Z("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&r?null:i}beforeSave(){}};return(0,r._)([(0,o.Cb)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),(0,r._)([(0,o.Cb)(d.rT)],t.prototype,"listMode",void 0),(0,r._)([(0,l.c)("listMode")],t.prototype,"writeListMode",null),(0,r._)([(0,o.Cb)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),(0,r._)([(0,l.c)("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),(0,r._)([(0,o.Cb)(d.Oh)],t.prototype,"opacity",void 0),(0,r._)([(0,o.Cb)({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),(0,r._)([(0,l.c)([void 0,"web-scene"],"title")],t.prototype,"writeTitle",null),(0,r._)([(0,o.Cb)({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=(0,r._)([(0,a.j)("esri.layers.mixins.OperationalLayer")],t),t}},50386:(e,t,i)=>{"use strict";i.d(t,{c:()=>m});var r,s=i(36663),n=i(86745),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(25709),c=i(82064);const u=new l.X({asc:"ascending",desc:"descending"});let h=r=class extends c.wq{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new r({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],h.prototype,"field",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],h.prototype,"valueExpression",void 0),(0,s._)([(0,o.Cb)({type:u.apiValues,json:{read:u.read,write:u.write}})],h.prototype,"order",void 0),h=r=(0,s._)([(0,a.j)("esri.layers.support.OrderByInfo")],h);const d=h;function p(e,t,i){if(!e)return null;const r=e.find((e=>!!e.field));if(!r)return null;const s=new d;return s.read(r,i),[s]}function f(e,t,i,r){const s=e.find((e=>!!e.field));s&&(0,n.RB)(i,[s.toJSON()],t)}const m=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return(0,s._)([(0,o.Cb)({type:[d],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:p},write:{target:"layerDefinition.orderBy",writer:f}}})],t.prototype,"orderBy",void 0),t=(0,s._)([(0,a.j)("esri.layers.mixins.OrderedLayer")],t),t}},18241:(e,t,i)=>{"use strict";i.d(t,{I:()=>b});var r=i(36663),s=i(88256),n=i(66341),o=i(67979),a=i(70375),l=i(13802),c=i(61681),u=i(78668),h=i(3466),d=i(81977),p=(i(7753),i(39994),i(7283),i(34248)),f=i(40266),m=i(39835),g=i(26869),y=i(53110),_=i(90298);const v=l.Z.getLogger("esri.layers.mixins.PortalLayer"),b=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){this.portalItem?.destroy(),this.portalItem=null}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,i){if(t.itemId)return new y.default({id:t.itemId,portal:i&&i.portal})}writePortalItem(e,t){e&&e.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem&&this.portalItem.id)try{const r=await i.e(9112).then(i.bind(i,49112));return(0,u.k_)(t),await r.load({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData},t)}catch(e){throw(0,u.D_)(e)||v.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${e}`),e}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch((e=>((0,u.r9)(e),!0))))}async _fetchUserHasEditingPrivileges(e){const t=this.url?s.id?.findCredential(this.url):null;if(!t)return!0;const i=w.credential===t?w.user:await this._fetchEditingUser(e);return w.credential=t,w.user=i,(0,c.Wi)(i)||null==i.privileges||i.privileges.includes("features:user:edit")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const i=s.id.findServerInfo(this.url);if(!i?.owningSystemUrl)return null;const r=`${i.owningSystemUrl}/sharing/rest`,a=g.Z.getDefault();if(a&&a.loaded&&(0,h.Fv)(a.restUrl)===(0,h.Fv)(r))return a.user;const l=`${r}/community/self`,u=(0,c.pC)(e)?e.signal:null,d=await(0,o.q6)((0,n.default)(l,{authMode:"no-prompt",query:{f:"json"},signal:u}));return d.ok?_.default.fromJSON(d.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const i=t&&t.portal,r=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||g.Z.getDefault());return i&&r&&!(0,h.tm)(r.restUrl,i.restUrl)?(t.messages&&t.messages.push(new a.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return(0,r._)([(0,d.Cb)({type:y.default})],t.prototype,"portalItem",null),(0,r._)([(0,p.r)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,r._)([(0,m.c)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,r._)([(0,d.Cb)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=(0,r._)([(0,f.j)("esri.layers.mixins.PortalLayer")],t),t},w={credential:null,user:null}},12478:(e,t,i)=>{"use strict";i.d(t,{Q:()=>_,d:()=>y});var r=i(36663),s=i(13802),n=i(78668),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(41831),c=(i(70375),i(81509),i(63235));const u=new l.Z,h=new WeakMap;function d(e){return e&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e}function p(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:p(t,e%t):0}let f=0,m=0;function g(){const e=Date.now();for(const t of u)t.refreshInterval&&e-(h.get(t)??0)+5>=6e4*t.refreshInterval&&(h.set(t,e),t.refresh(e))}function y(e){return e&&"object"==typeof e&&"refreshTimestamp"in e&&"refresh"in e}(0,c.EH)((()=>{const e=Date.now();let t=0;for(const i of u)t=p(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?h.get(i)||h.set(i,e):h.delete(i);if(t!==m){if(m=t,clearInterval(f),0===m)return void(f=0);f=setInterval(g,m)}}));const _=e=>{let t=class extends e{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,n.Ds)((()=>this.hasDataChanged())),this.when().then((()=>{!function(e){d(e)&&u.push(e)}(this)}),(()=>{}))}destroy(){var e;d(e=this)&&u.includes(e)&&u.remove(e)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){(0,n.R8)(this._debounceHasDataChanged()).then((t=>{t&&this._set("refreshTimestamp",e),this.emit("refresh",{dataChanged:t})}),(e=>{s.Z.getLogger(this.declaredClass).error(e),this.emit("refresh",{dataChanged:!1,error:e})}))}async hasDataChanged(){return!0}};return(0,r._)([(0,o.Cb)({type:Number,cast:e=>e>=.1?e:e<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),(0,r._)([(0,o.Cb)()],t.prototype,"refreshParameters",null),t=(0,r._)([(0,a.j)("esri.layers.mixins.RefreshableLayer")],t),t}},95874:(e,t,i)=>{"use strict";i.d(t,{M:()=>o});var r=i(36663),s=i(81977),n=(i(7753),i(39994),i(7283),i(40266));const o=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const e={minScale:this.minScale,maxScale:this.maxScale},t=this.parent;t&&"effectiveScaleRange"in t&&function(e,t){e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale}(e,t.effectiveScaleRange);const i=this._get("effectiveScaleRange");return i&&i.minScale===e.minScale&&i.maxScale===e.maxScale?i:e}};return(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=(0,r._)([(0,n.j)("esri.layers.mixins.ScaleRangeLayer")],t),t}},69877:(e,t,i)=>{"use strict";i.d(t,{xp:()=>k,Vt:()=>R});var r=i(36663),s=i(66341),n=i(70375),o=(i(39994),i(13802)),a=i(61681),l=i(78668),c=i(3466),u=i(81977),h=(i(7753),i(7283),i(34248)),d=i(40266),p=i(39835),f=i(50516),m=i(91772),g=i(64307),y=i(14685),_=i(20692),v=i(51599),b=i(40909),w=i(26869),x=i(53110),C=i(67979),T=i(12173),S=i(68611);async function E(e,t,i){if(!t||!t.resources)return;const r=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map((e=>e.resource.path))),o=new Set,a=[];s.forEach((t=>{r.delete(t),e.paths.push(t)}));for(const n of t.resources.toUpdate)if(r.delete(n.resource.path),s.has(n.resource.path)||o.has(n.resource.path)){const{resource:t,content:r,finish:s,error:o}=n,l=(0,S.getSiblingOfSameTypeI)(t,(0,T.D)());e.paths.push(l.path),a.push(A({resource:l,content:r,finish:s,error:o},i))}else e.paths.push(n.resource.path),a.push(M(n,i)),o.add(n.resource.path);for(const r of t.resources.toAdd)a.push(A(r,i)),e.paths.push(r.resource.path);if(r.forEach((e=>{const i=t.portalItem.resourceFromPath(e);a.push(i.portalItem.removeResource(i).catch((()=>{})))})),0===a.length)return;const c=await(0,l.as)(a);(0,l.k_)(i);const u=c.filter((e=>"error"in e)).map((e=>e.error));if(u.length>0)throw new n.Z("save:resources","Failed to save one or more resources",{errors:u})}async function A(e,t){const i=await(0,C.q6)(e.resource.portalItem.addResource(e.resource,e.content,t));if(!0!==i.ok)throw e.error&&e.error(i.error),i.error;e.finish&&e.finish(e.resource)}async function M(e,t){const i=await(0,C.q6)(e.resource.update(e.content,t));if(!0!==i.ok)throw e.error(i.error),i.error;e.finish(e.resource)}const O=o.Z.getLogger("esri.layers.mixins.SceneService"),R=e=>{let t=class extends e{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,l.Ds)((async(e,t,i)=>{switch(e){case k.SAVE:return this._save(t);case k.SAVE_AS:return this._saveAs(i,t)}}))}readSpatialReference(e,t){return this._readSpatialReference(t)}_readSpatialReference(e){if(null!=e.spatialReference)return y.Z.fromJSON(e.spatialReference);{const t=e.store,i=t.indexCRS||t.geographicCRS,r=i&&parseInt(i.substring(i.lastIndexOf("/")+1,i.length),10);return null!=r?new y.Z(r):null}}readFullExtent(e,t,i){if(null!=e&&"object"==typeof e){const r=null==e.spatialReference?{...e,spatialReference:this._readSpatialReference(t)}:e;return m.Z.fromJSON(r,i)}const r=t.store,s=this._readSpatialReference(t);return null==s||null==r||null==r.extent||!Array.isArray(r.extent)||r.extent.some((e=>e<P))?null:new m.Z({xmin:r.extent[0],ymin:r.extent[1],xmax:r.extent[2],ymax:r.extent[3],spatialReference:s})}parseVersionString(e){const t={major:Number.NaN,minor:Number.NaN,versionString:e},i=e.split(".");return i.length>=2&&(t.major=parseInt(i[0],10),t.minor=parseInt(i[1],10)),t}readVersion(e,t){const i=t.store,r=null!=i.version?i.version.toString():"";return this.parseVersionString(r)}readTitlePortalItem(e){return"item-title"!==this.sublayerTitleMode?void 0:e}readTitleService(e,t){const i=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return(0,_.a7)(this.url,t.name);let r=t.name;if(!r&&this.url){const e=(0,_.Qc)(this.url);(0,a.pC)(e)&&(r=e.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&i&&(r=i+" - "+r),(0,_.ld)(r)}set url(e){const t=(0,_.XG)({layer:this,url:e,nonStandardUrlAllowed:!1,logger:O});this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){(0,_.wH)(this,e,"layers",t,r)}get parsedUrl(){const e=this._get("url");if(!e)return null;const t=(0,c.mN)(e);return null!=this.layerId&&(t.path=`${t.path}/layers/${this.layerId}`),t}async _fetchIndexAndUpdateExtent(e,t){this.indexInfo=(0,b.T)(this.parsedUrl.path,this.rootNode,e,this.apiKey,O,t),null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(e){if("page"===e?.type){const t=e.rootIndex%e.pageSize,i=e.rootPage?.nodes?.[t];if(null==i||null==i.obb||null==i.obb.center||null==i.obb.halfSize)throw new n.Z("sceneservice:invalid-node-page","Invalid node page.");if(i.obb.center[0]<P||null==this.fullExtent||this.fullExtent.hasZ)return;const r=i.obb.halfSize,s=i.obb.center[2],o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this.fullExtent.zmin=s-o,this.fullExtent.zmax=s+o}else if("node"===e?.type){const t=e.rootNode?.mbs;if(!Array.isArray(t)||4!==t.length||t[0]<P)return;const i=t[2],r=t[3];this.fullExtent.zmin=i-r,this.fullExtent.zmax=i+r}}async _fetchService(e){if(null==this.url)throw new n.Z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const t=await this._fetchFirstLayerId(e);null!=t&&(this.layerId=t)}return this._fetchServiceLayer(e)}async _fetchFirstLayerId(e){const t=await(0,s.default)(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:e});if(t.data&&Array.isArray(t.data.layers)&&t.data.layers.length>0)return t.data.layers[0].id}async _fetchServiceLayer(e){const t=await(0,s.default)(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:e});t.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let i=!1;if(t.data.layerType&&"Voxel"===t.data.layerType&&(i=!0),i)return this._fetchVoxelServiceLayer();const r=t.data;this.read(r,{origin:"service",url:this.parsedUrl}),this.validateLayer(r)}async _fetchVoxelServiceLayer(e){const t=(await(0,s.default)(this.parsedUrl.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:e})).data;this.read(t,{origin:"service",url:this.parsedUrl}),this.validateLayer(t)}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&"function"==typeof this.beforeSave&&await this.beforeSave()}validateLayer(e){}_updateTypeKeywords(e,t,i){e.typeKeywords||(e.typeKeywords=[]);const r=t.getTypeKeywords();for(const t of r)e.typeKeywords.push(t);e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,i)=>i.indexOf(e)===t)),i===L.newItem&&(e.typeKeywords=e.typeKeywords.filter((e=>"Hosted Service"!==e))))}async _saveAs(e,t){const i={...F,...t};let r=x.default.from(e);r||(O.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new n.Z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),r.id&&(r=r.clone(),r.id=null);const s=r.portal||w.Z.getDefault();await this._ensureLoadBeforeSave(),r.type=N,r.portal=s;const o={origin:"portal-item",url:null,messages:[],portal:s,portalItem:r,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},a={layers:[this.write({},o)]};return await Promise.all(o.resources.pendingOperations),await this._validateAgainstJSONSchema(a,o,i),r.url=this.url,r.title||(r.title=this.title),this._updateTypeKeywords(r,i,L.newItem),await s._signIn(),await s.user.addItem({item:r,folder:i&&i.folder,data:a}),await E(this.resourceReferences,o,null),this.portalItem=r,(0,f.D)(o),o.portalItem=r,r}async _save(e){const t={...F,...e};this.portalItem||(O.error("_save(): requires the .portalItem property to be set"),await Promise.reject(new n.Z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),this.portalItem.type!==N&&(O.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+N),await Promise.reject(new n.Z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${N}"`))),await this._ensureLoadBeforeSave();const i={origin:"portal-item",url:this.portalItem.itemUrl&&(0,c.mN)(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||w.Z.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},r={layers:[this.write({},i)]};return await Promise.all(i.resources.pendingOperations),await this._validateAgainstJSONSchema(r,i,t),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,t,L.existingItem),await this.portalItem.update({data:r}),await E(this.resourceReferences,i,null),(0,f.D)(i),this.portalItem}async _validateAgainstJSONSchema(e,t,r){let s=t.messages.filter((e=>"error"===e.type)).map((e=>new n.Z(e.name,e.message,e.details)));if(r&&r.validationOptions.ignoreUnsupported&&(s=s.filter((e=>"layer:unsupported"!==e.name&&"symbol:unsupported"!==e.name&&"symbol-layer:unsupported"!==e.name&&"property:unsupported"!==e.name&&"url:unsupported"!==e.name&&"scenemodification:unsupported"!==e.name))),r.validationOptions.enabled||I){const t=(await i.e(7062).then(i.bind(i,67062))).validate(e,r.portalItemLayerType);if(t.length>0){const e=`Layer item did not validate:\n${t.join("\n")}`;if(O.error(`_validateAgainstJSONSchema(): ${e}`),"throw"===r.validationOptions.failPolicy){const e=t.map((e=>new n.Z("sceneservice:schema-validation",e))).concat(s);throw new n.Z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:e})}}}if(s.length>0)throw new n.Z("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:s})}};return(0,r._)([(0,u.Cb)(v.id)],t.prototype,"id",void 0),(0,r._)([(0,u.Cb)({type:y.Z})],t.prototype,"spatialReference",void 0),(0,r._)([(0,h.r)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readSpatialReference",null),(0,r._)([(0,u.Cb)({type:m.Z})],t.prototype,"fullExtent",void 0),(0,r._)([(0,h.r)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readFullExtent",null),(0,r._)([(0,u.Cb)({readOnly:!0,type:g.Z})],t.prototype,"heightModelInfo",void 0),(0,r._)([(0,u.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],t.prototype,"minScale",void 0),(0,r._)([(0,u.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],t.prototype,"maxScale",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],t.prototype,"version",void 0),(0,r._)([(0,h.r)("version",["store.version"])],t.prototype,"readVersion",null),(0,r._)([(0,u.Cb)({type:String,json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),(0,r._)([(0,u.Cb)({type:String,json:{read:!1}})],t.prototype,"sublayerTitleMode",void 0),(0,r._)([(0,u.Cb)({type:String})],t.prototype,"title",void 0),(0,r._)([(0,h.r)("portal-item","title")],t.prototype,"readTitlePortalItem",null),(0,r._)([(0,h.r)("service","title",["name"])],t.prototype,"readTitleService",null),(0,r._)([(0,u.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],t.prototype,"layerId",void 0),(0,r._)([(0,u.Cb)(v.HQ)],t.prototype,"url",null),(0,r._)([(0,p.c)("url")],t.prototype,"writeUrl",null),(0,r._)([(0,u.Cb)()],t.prototype,"parsedUrl",null),(0,r._)([(0,u.Cb)({readOnly:!0})],t.prototype,"store",void 0),(0,r._)([(0,u.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],t.prototype,"rootNode",void 0),t=(0,r._)([(0,d.j)("esri.layers.mixins.SceneService")],t),t},P=-1e38,I=!1;var L,D;(D=L||(L={}))[D.existingItem=0]="existingItem",D[D.newItem=1]="newItem";const N="Scene Service",F={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var k;!function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(k||(k={}))},2030:(e,t,i)=>{"use strict";i.d(t,{n:()=>d});var r=i(36663),s=i(37956),n=i(74589),o=i(81977),a=(i(7753),i(39994),i(7283),i(34248)),l=i(40266),c=i(17095),u=i(84573),h=i(80680);const d=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const i=t.timeInfo.exportOptions;if(!i)return null;const r=i.timeOffset,s=h.v.fromJSON(i.timeOffsetUnits);return r&&s?new n.Z({value:r,unit:s}):null}set timeInfo(e){(0,c.UF)(e,this.fieldsIndex),this._set("timeInfo",e)}};return(0,r._)([(0,o.Cb)({type:s.Z,json:{write:!1}})],t.prototype,"timeExtent",void 0),(0,r._)([(0,o.Cb)({type:n.Z})],t.prototype,"timeOffset",void 0),(0,r._)([(0,a.r)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),(0,r._)([(0,o.Cb)({value:null,type:u.Z,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),(0,r._)([(0,o.Cb)({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=(0,r._)([(0,l.j)("esri.layers.mixins.TemporalLayer")],t),t}},21432:(e,t,i)=>{"use strict";i.d(t,{u:()=>l});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=r=class extends n.wq{constructor(e){super(e),this.name=null,this.code=null}clone(){return new r({name:this.name,code:this.code})}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"name",void 0),(0,s._)([(0,o.Cb)({type:[String,Number],json:{write:!0}})],l.prototype,"code",void 0),l=r=(0,s._)([(0,a.j)("esri.layers.support.CodedValue")],l)},7767:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var r,s=i(36663),n=i(67134),o=i(81977),a=(i(7283),i(79438)),l=i(40266),c=i(21432),u=i(34225);let h=r=class extends u.Z{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some((e=>(String(e.code)===i&&(t=e.name),!!t)))}return t}clone(){return new r({codedValues:(0,n.d9)(this.codedValues),name:this.name})}};(0,s._)([(0,o.Cb)({type:[c.u],json:{write:!0}})],h.prototype,"codedValues",void 0),(0,s._)([(0,a.J)({codedValue:"coded-value"})],h.prototype,"type",void 0),h=r=(0,s._)([(0,l.j)("esri.layers.support.CodedValueDomain")],h);const d=h},34225:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r=i(36663),s=i(25709),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(79438)),l=i(40266);const c=new s.X({inherited:"inherited",codedValue:"coded-value",range:"range"});let u=class extends n.wq{constructor(e){super(e),this.name=null,this.type=null}};(0,r._)([(0,o.Cb)({type:String,json:{write:!0}})],u.prototype,"name",void 0),(0,r._)([(0,a.J)(c)],u.prototype,"type",void 0),u=(0,r._)([(0,l.j)("esri.layers.support.Domain")],u);const h=u},56397:(e,t,i)=>{"use strict";i.d(t,{G$:()=>p,Tl:()=>d}),i(91957),i(39994);var r=i(13802),s=i(61681),n=i(17321),o=i(24568),a=i(39536),l=i(53446);const c=r.Z.getLogger("esri.layers.support.ElevationSampler");class u{queryElevation(e){return p(e.clone(),this)}on(){return g}projectIfRequired(e,t){return f(e,t)}}class h extends u{constructor(e,t,i){super(),this.tile=e,this.noDataValue=i,this.extent=(0,o.HH)(e.tile.extent,t.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this.aaExtent=e.tile.extent;const r=(0,n.c9)(t.spatialReference),s=t.lodAt(e.tile.level).resolution*r;this.demResolution={min:s,max:s}}get spatialReference(){return this.extent.spatialReference}contains(e){const t=this.projectIfRequired(e,this.spatialReference);return!(0,s.Wi)(t)&&this.containsAt(t.x,t.y)}containsAt(e,t){return(0,o.jE)(this.aaExtent,e,t)}elevationAt(e,t){if(!this.containsAt(e,t)){const i=this.extent,r=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return c.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${r})`),this.noDataValue}return(0,s.Pt)(this.tile.sample(e,t),this.noDataValue)}}class d extends u{constructor(e,t,i){let r;super(),"number"==typeof t?(this.noDataValue=t,r=null):(r=t,this.noDataValue=i),this.samplers=r?e.map((e=>new h(e,r,this.noDataValue))):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:e,max:t}=s.demResolution;this.demResolution={min:e,max:t};for(let e=1;e<this.samplers.length;e++){const t=this.samplers[e];this.extent.union(t.extent),this.demResolution.min=Math.min(this.demResolution.min,t.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,t.demResolution.max)}}else this.extent=(0,o.HH)((0,o.Ue)(),r.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(e,t){for(const i of this.samplers)if(i.containsAt(e,t))return i.elevationAt(e,t);return c.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler`),this.noDataValue}}function p(e,t){const i=f(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":!function(e,t,i){e.z=i.elevationAt(t.x,t.y)}(e,i,t);break;case"polyline":!function(e,t,i){m.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let e=0;e<n.length;e++){const t=n[e],s=o[e];m.x=s[0],m.y=s[1],r&&(t[3]=t[2]),t[2]=i.elevationAt(m.x,m.y)}}e.hasZ=!0}(e,i,t);break;case"multipoint":!function(e,t,i){m.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];m.x=o[0],m.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(m.x,m.y)}e.hasZ=!0}(e,i,t)}return e}function f(e,t){if((0,s.Wi)(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=(0,a.iV)(e,t);return r||c.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}const m=new l.Z,g={remove(){}}},92150:(e,t,i)=>{"use strict";i.d(t,{Z:()=>y});var r,s=i(36663),n=i(70375),o=i(82064),a=i(61681),l=i(86745),c=i(81977),u=(i(7753),i(39994),i(7283),i(40266)),h=i(50913),d=i(15553);const p={read:{reader:h.ij},write:{writer:h.cW,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},f={read:{reader:h.ij},write:{writer:h.cW,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},m={name:"showExcludedLabels",default:!0};let g=r=class extends o.wq{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){const i=super.write(e,t);if(t?.origin){if(i.filter){const e=Object.keys(i.filter);if(e.length>1||"where"!==e[0])return t.messages?.push(new n.Z("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in i)return t.messages?.push(new n.Z("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new r({filter:(0,a.pC)(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,s._)([(0,c.Cb)({type:d.Z,json:{write:{allowNull:!0,writer(e,t,i,r){const s=e?.write({},r);s&&0!==Object.keys(s).length?(0,l.RB)(i,s,t):(0,l.RB)(i,null,t)}}}})],g.prototype,"filter",void 0),(0,s._)([(0,c.Cb)({json:{write:!0,origins:{"web-map":p,"portal-item":p}}})],g.prototype,"includedEffect",void 0),(0,s._)([(0,c.Cb)({json:{write:!0,origins:{"web-map":f,"portal-item":f}}})],g.prototype,"excludedEffect",void 0),(0,s._)([(0,c.Cb)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":m,"portal-item":m}}})],g.prototype,"excludedLabelsVisible",void 0),g=r=(0,s._)([(0,u.j)("esri.layers.support.FeatureEffect")],g);const y=g},15553:(e,t,i)=>{"use strict";i.d(t,{Z:()=>y});var r,s=i(36663),n=i(91957),o=i(37956),a=i(25709),l=i(82064),c=i(67134),u=i(61681),h=i(81977),d=(i(7283),i(40266)),p=i(14136);const f=new a.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),m=new a.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let g=r=class extends l.wq{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new p.Z({geometry:(0,c.d9)(i),objectIds:(0,c.d9)(n),spatialRelationship:r,timeExtent:(0,c.d9)(s),where:t,units:o,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new r({geometry:(0,c.d9)(t),objectIds:(0,c.d9)(n),spatialRelationship:i,timeExtent:(0,c.d9)(s),where:e,units:o,distance:a})}};(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],g.prototype,"where",void 0),(0,s._)([(0,h.Cb)({types:n.qM,json:{write:!0}})],g.prototype,"geometry",void 0),(0,s._)([(0,h.Cb)({type:f.apiValues,json:{name:"spatialRel",read:{reader:f.read},write:{allowNull:!1,writer:f.write,overridePolicy(){return{enabled:(0,u.pC)(this.geometry)}}}}})],g.prototype,"spatialRelationship",void 0),(0,s._)([(0,h.Cb)({type:Number,json:{write:{overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],g.prototype,"distance",void 0),(0,s._)([(0,h.Cb)({type:[Number],json:{write:!0}})],g.prototype,"objectIds",void 0),(0,s._)([(0,h.Cb)({type:m.apiValues,json:{read:m.read,write:{writer:m.write,overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],g.prototype,"units",void 0),(0,s._)([(0,h.Cb)({type:o.Z,json:{write:!0}})],g.prototype,"timeExtent",void 0),g=r=(0,s._)([(0,d.j)("esri.layers.support.FeatureFilter")],g);const y=g},48257:(e,t,i)=>{"use strict";i.d(t,{B:()=>a});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266));let a=class extends s.wq{constructor(){super(...arguments),this.type=null}};(0,r._)([(0,n.Cb)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.layers.support.FeatureReduction")],a)},69766:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(48257);let l=r=class extends a.B{constructor(e){super(e),this.type="selection"}clone(){return new r}};(0,s._)([(0,n.Cb)({type:["selection"]})],l.prototype,"type",void 0),l=r=(0,s._)([(0,o.j)("esri.layers.support.FeatureReductionSelection")],l);const c=l},60822:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r=i(36663),s=i(41151),n=i(25709),o=i(82064),a=i(81977),l=(i(7753),i(39994),i(7283),i(40266));const c=new n.X({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let u=class extends((0,s.J)(o.wq)){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};(0,r._)([(0,a.Cb)({json:{write:!0}})],u.prototype,"name",void 0),(0,r._)([(0,a.Cb)({json:{write:!0}})],u.prototype,"description",void 0),(0,r._)([(0,a.Cb)({json:{read:c.read,write:c.write}})],u.prototype,"drawingTool",void 0),(0,r._)([(0,a.Cb)({json:{write:!0}})],u.prototype,"prototype",void 0),(0,r._)([(0,a.Cb)({json:{write:!0}})],u.prototype,"thumbnail",void 0),u=(0,r._)([(0,l.j)("esri.layers.support.FeatureTemplate")],u);const h=u},18160:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r=i(36663),s=i(41151),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(34248)),l=i(40266),c=i(39835),u=i(12795),h=i(60822);let d=class extends((0,s.J)(n.wq)){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i of Object.keys(e))t[i]=(0,u.im)(e[i]);return t}writeDomains(e,t){const i={};for(const t of Object.keys(e))e[t]&&(i[t]=e[t]?.toJSON());t.domains=i}};(0,r._)([(0,o.Cb)({json:{write:!0}})],d.prototype,"id",void 0),(0,r._)([(0,o.Cb)({json:{write:!0}})],d.prototype,"name",void 0),(0,r._)([(0,o.Cb)({json:{write:!0}})],d.prototype,"domains",void 0),(0,r._)([(0,a.r)("domains")],d.prototype,"readDomains",null),(0,r._)([(0,c.c)("domains")],d.prototype,"writeDomains",null),(0,r._)([(0,o.Cb)({type:[h.Z],json:{write:!0}})],d.prototype,"templates",void 0),d=(0,r._)([(0,l.j)("esri.layers.support.FeatureType")],d);const p=d},31906:(e,t,i)=>{"use strict";i.d(t,{W:()=>u});var r=i(88256),s=i(66341),n=i(61681),o=i(78668),a=i(45955),l=i(26869),c=i(53110);class u{constructor(e,t,i,r){this.parsedUrl=e,this.portalItem=t,this.apiKey=i,this.signal=r,this.rootDocument=null;const s=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);s&&(this.urlParts={root:s[1],layerId:parseInt(s[2],10)})}async fetch(){if(!this.urlParts)return null;const e=this.portalItem??await this._portalItemFromServiceItemId();if((0,n.Wi)(e))return this._loadFromUrl();const t=await this._findAndLoadRelatedPortalItem(e);return(0,n.Wi)(t)?null:this._loadFeatureLayerFromPortalItem(t)}async fetchPortalItem(){if(!this.urlParts)return null;const e=this.portalItem??await this._portalItemFromServiceItemId();return(0,n.Wi)(e)?null:this._findAndLoadRelatedPortalItem(e)}async _fetchRootDocument(){if((0,n.pC)(this.rootDocument))return this.rootDocument;if((0,n.Wi)(this.urlParts))return this.rootDocument={},{};const e={query:{f:"json",token:this.apiKey},responseType:"json",signal:this.signal},t=`${this.urlParts.root}/SceneServer`;try{const i=await(0,s.default)(t,e);this.rootDocument=i.data}catch{this.rootDocument={}}return this.rootDocument}async _fetchServiceOwningPortalUrl(){const e=r.id?.findServerInfo(this.parsedUrl.path);if(e?.owningSystemUrl)return e.owningSystemUrl;const t=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const e=(await(0,s.default)(t,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(e)return e}catch(e){(0,o.r9)(e)}return null}async _findAndLoadRelatedPortalItem(e){try{return(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find((e=>"Feature Service"===e.type))||null}catch(e){return(0,o.r9)(e),null}}async _loadFeatureLayerFromPortalItem(e){await e.load({signal:this.signal});const t=await this._findMatchingAssociatedSublayerUrl(e.url);return new a.default({url:t,portalItem:e}).load({signal:this.signal})}async _loadFromUrl(){const e=await this._findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);return new a.default({url:e}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(e){const t=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),i={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},r=this.urlParts.layerId,n=this._fetchRootDocument(),o=(0,s.default)(t,i),[a,l]=await Promise.all([o,n]),c=l&&l.layers,u=a.data&&a.data.layers;if(!Array.isArray(u))throw new Error("expected layers array");if(Array.isArray(c)){for(let e=0;e<Math.min(c.length,u.length);e++)if(c[e].id===r)return`${t}/${u[e].id}`}else if(r<u.length)return`${t}/${u[r].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const e=(await this._fetchRootDocument()).serviceItemId;if(!e)return null;const t=new c.default({id:e,apiKey:this.apiKey}),i=await this._fetchServiceOwningPortalUrl();(0,n.pC)(i)&&(t.portal=new l.Z({url:i}));try{return t.load({signal:this.signal})}catch(e){return(0,o.r9)(e),null}}}},12512:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r,s=i(36663),n=i(25709),o=i(82064),a=i(81977),l=(i(7753),i(39994),i(7283)),c=i(79438),u=i(34248),h=i(40266),d=i(12795),p=i(86349);const f=new n.X({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let m=r=class extends o.wq{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch(e){}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch(e){}return i?f.fromJSON(i.fieldValueType):null}clone(){return new r({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],m.prototype,"alias",void 0),(0,s._)([(0,a.Cb)({type:[String,Number],json:{write:{allowNull:!0}}})],m.prototype,"defaultValue",void 0),(0,s._)([(0,a.Cb)()],m.prototype,"description",void 0),(0,s._)([(0,u.r)("description")],m.prototype,"readDescription",null),(0,s._)([(0,a.Cb)({types:d.V5,json:{read:{reader:d.im},write:!0}})],m.prototype,"domain",void 0),(0,s._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"editable",void 0),(0,s._)([(0,a.Cb)({type:l.z8,json:{write:!0}})],m.prototype,"length",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],m.prototype,"name",void 0),(0,s._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"nullable",void 0),(0,s._)([(0,c.J)(p.v)],m.prototype,"type",void 0),(0,s._)([(0,a.Cb)()],m.prototype,"valueType",void 0),(0,s._)([(0,u.r)("valueType",["description"])],m.prototype,"readValueType",null),m=r=(0,s._)([(0,h.j)("esri.layers.support.Field")],m);const g=m},28790:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var r=i(17095);function s(e){return"oid"===e.type||"esriFieldTypeOID"===e.type}function n(e){return"global-id"===e.type||"esriFieldTypeGlobalID"===e.type}class o{constructor(e){if(this.fields=e,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;const t=[];for(const o of e){const e=o&&o.name;if(e){const l=a(e);this._fieldsMap.set(e,o),this._fieldsMap.set(l,o),t.push(l),"date"===(i=o).type||"esriFieldTypeDate"===i.type?(this.dateFields.push(o),this._dateFieldsSet.add(o)):(0,r.H7)(o)&&(this._numericFieldsSet.add(o),this.numericFields.push(o)),s(o)||n(o)||(o.editable=null==o.editable||!!o.editable,o.nullable=null==o.nullable||!!o.nullable)}}var i;t.sort(),this.uid=t.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)s(e)||n(e)||e.nullable||void 0!==(0,r.os)(e)||this._requiredFields.push(e)}return this._requiredFields}has(e){return null!=this.get(e)}get(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(a(e)):void 0}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const t=this.get(e);if(t)return t.name}}function a(e){return e.toLowerCase().trim()}},40909:(e,t,i)=>{"use strict";i.d(t,{T:()=>o});var r=i(66341),s=i(70375),n=i(61681);async function o(e,t,i,o,a,l){let c=null;if((0,n.pC)(i)){const t=`${e}/nodepages/`,s=t+Math.floor(i.rootIndex/i.nodesPerPage);try{return{type:"page",rootPage:(await(0,r.default)(s,{query:{f:"json",token:o},responseType:"json",signal:l})).data,rootIndex:i.rootIndex,pageSize:i.nodesPerPage,lodMetric:i.lodSelectionMetricType,urlPrefix:t}}catch(e){(0,n.pC)(a)&&a.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",s,e),c=e}}if(!t)return null;const u=`${e}/nodes/`,h=u+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await(0,r.default)(h,{query:{f:"json",token:o},responseType:"json",signal:l})).data,urlPrefix:u}}catch(e){throw new s.Z("sceneservice:root-node-missing","Root node missing.",{pageError:c,nodeError:e,url:h})}}},97304:(e,t,i)=>{"use strict";i.d(t,{H3:()=>y,QI:()=>h,U4:()=>l,Yh:()=>p});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(79438)),a=i(40266);let l=class extends s.wq{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};(0,r._)([(0,n.Cb)({type:Number})],l.prototype,"nodesPerPage",void 0),(0,r._)([(0,n.Cb)({type:Number})],l.prototype,"rootIndex",void 0),(0,r._)([(0,n.Cb)({type:String})],l.prototype,"lodSelectionMetricType",void 0),l=(0,r._)([(0,a.j)("esri.layer.support.I3SNodePageDefinition")],l);let c=class extends s.wq{constructor(){super(...arguments),this.factor=1}};(0,r._)([(0,n.Cb)({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],c.prototype,"id",void 0),(0,r._)([(0,n.Cb)({type:Number})],c.prototype,"factor",void 0),c=(0,r._)([(0,a.j)("esri.layer.support.I3SMaterialTexture")],c);let u=class extends s.wq{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};(0,r._)([(0,n.Cb)({type:[Number]})],u.prototype,"baseColorFactor",void 0),(0,r._)([(0,n.Cb)({type:c})],u.prototype,"baseColorTexture",void 0),(0,r._)([(0,n.Cb)({type:c})],u.prototype,"metallicRoughnessTexture",void 0),(0,r._)([(0,n.Cb)({type:Number})],u.prototype,"metallicFactor",void 0),(0,r._)([(0,n.Cb)({type:Number})],u.prototype,"roughnessFactor",void 0),u=(0,r._)([(0,a.j)("esri.layer.support.I3SMaterialPBRMetallicRoughness")],u);let h=class extends s.wq{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};(0,r._)([(0,o.J)({opaque:"opaque",mask:"mask",blend:"blend"})],h.prototype,"alphaMode",void 0),(0,r._)([(0,n.Cb)({type:Number})],h.prototype,"alphaCutoff",void 0),(0,r._)([(0,n.Cb)({type:Boolean})],h.prototype,"doubleSided",void 0),(0,r._)([(0,o.J)({none:"none",back:"back",front:"front"})],h.prototype,"cullFace",void 0),(0,r._)([(0,n.Cb)({type:c})],h.prototype,"normalTexture",void 0),(0,r._)([(0,n.Cb)({type:c})],h.prototype,"occlusionTexture",void 0),(0,r._)([(0,n.Cb)({type:c})],h.prototype,"emissiveTexture",void 0),(0,r._)([(0,n.Cb)({type:[Number]})],h.prototype,"emissiveFactor",void 0),(0,r._)([(0,n.Cb)({type:u})],h.prototype,"pbrMetallicRoughness",void 0),h=(0,r._)([(0,a.j)("esri.layer.support.I3SMaterialDefinition")],h);let d=class extends s.wq{};(0,r._)([(0,n.Cb)({type:String,json:{read:{source:["name","index"],reader:(e,t)=>null!=e?e:`${t.index}`}}})],d.prototype,"name",void 0),(0,r._)([(0,o.J)({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],d.prototype,"format",void 0),d=(0,r._)([(0,a.j)("esri.layer.support.I3STextureFormat")],d);let p=class extends s.wq{constructor(){super(...arguments),this.atlas=!1}};(0,r._)([(0,n.Cb)({type:[d]})],p.prototype,"formats",void 0),(0,r._)([(0,n.Cb)({type:Boolean})],p.prototype,"atlas",void 0),p=(0,r._)([(0,a.j)("esri.layer.support.I3STextureSetDefinition")],p);let f=class extends s.wq{};(0,r._)([(0,o.J)({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],f.prototype,"type",void 0),(0,r._)([(0,n.Cb)({type:Number})],f.prototype,"component",void 0),f=(0,r._)([(0,a.j)("esri.layer.support.I3SGeometryAttribute")],f);let m=class extends s.wq{};(0,r._)([(0,o.J)({draco:"draco"})],m.prototype,"encoding",void 0),(0,r._)([(0,n.Cb)({type:[String]})],m.prototype,"attributes",void 0),m=(0,r._)([(0,a.j)("esri.layer.support.I3SGeometryCompressedAttributes")],m);let g=class extends s.wq{constructor(){super(...arguments),this.offset=0}};(0,r._)([(0,n.Cb)({type:Number})],g.prototype,"offset",void 0),(0,r._)([(0,n.Cb)({type:f})],g.prototype,"position",void 0),(0,r._)([(0,n.Cb)({type:f})],g.prototype,"normal",void 0),(0,r._)([(0,n.Cb)({type:f})],g.prototype,"uv0",void 0),(0,r._)([(0,n.Cb)({type:f})],g.prototype,"color",void 0),(0,r._)([(0,n.Cb)({type:f})],g.prototype,"uvRegion",void 0),(0,r._)([(0,n.Cb)({type:f})],g.prototype,"featureId",void 0),(0,r._)([(0,n.Cb)({type:f})],g.prototype,"faceRange",void 0),(0,r._)([(0,n.Cb)({type:m})],g.prototype,"compressedAttributes",void 0),g=(0,r._)([(0,a.j)("esri.layer.support.I3SGeometryBuffer")],g);let y=class extends s.wq{};(0,r._)([(0,o.J)({triangle:"triangle"})],y.prototype,"topology",void 0),(0,r._)([(0,n.Cb)()],y.prototype,"geometryBuffers",void 0),y=(0,r._)([(0,a.j)("esri.layer.support.I3SGeometryDefinition")],y)},36253:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=(i(13802),i(7283),i(7753),i(39994),i(33156),i(79438)),o=i(40266),a=i(34225);let l=r=class extends a.Z{constructor(e){super(e),this.type="inherited"}clone(){return new r}};(0,s._)([(0,n.J)({inherited:"inherited"})],l.prototype,"type",void 0),l=r=(0,s._)([(0,o.j)("esri.layers.support.InheritedDomain")],l);const c=l},13054:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283)),l=i(40266);let c=r=class extends n.wq{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new r({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,s._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0),(0,s._)([(0,o.Cb)({type:a.z8,json:{write:!0}})],c.prototype,"level",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0),(0,s._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0),(0,s._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"rows",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],c.prototype,"scale",void 0),c=r=(0,s._)([(0,l.j)("esri.layers.support.LOD")],c);const u=c},26732:(e,t,i)=>{"use strict";i.d(t,{Z:()=>T});var r,s=i(36663),n=i(4905),o=i(25709),a=i(82064),l=i(67134),c=i(95550),u=i(81977),h=(i(7283),i(34248)),d=i(40266),p=i(39835),f=(i(7753),i(39994),i(1110));let m=r=class extends a.wq{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?(0,f.dI)(t.value):e}writeExpression(e,t,i){null!=this.value&&(e=(0,f.dI)(this.value)),null!=e&&(t[i]=e)}clone(){return new r({expression:this.expression,title:this.title,value:this.value})}};(0,s._)([(0,u.Cb)({type:String,json:{write:{writerEnsuresNonNull:!0}}})],m.prototype,"expression",void 0),(0,s._)([(0,h.r)("expression",["expression","value"])],m.prototype,"readExpression",null),(0,s._)([(0,p.c)("expression")],m.prototype,"writeExpression",null),(0,s._)([(0,u.Cb)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],m.prototype,"title",void 0),(0,s._)([(0,u.Cb)({json:{read:!1,write:!1}})],m.prototype,"value",void 0),m=r=(0,s._)([(0,d.j)("esri.layers.support.LabelExpressionInfo")],m);const g=m;var y,_=i(5310),v=i(83313);const b=new o.X({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function w(e){return!e||"service"!==e.origin&&!("map-image"===e.layer?.type)}function x(e){return!!function(e){return"map-image"===e?.type}(e)&&!!e.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}let C=y=class extends a.wq{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=_.Rz,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=(e,t,i)=>{switch(t){case"=":return e==i;case"<>":return e!=i;case">":return e>i;case">=":return e>=i;case"<":return e<i;case"<=":return e<=i}return!1};try{if(null==e)return!0;const r=e.split(" ");if(3===r.length)return i(t[r[0]],r[1],r[2]);if(7===r.length){const e=i(t[r[0]],r[1],r[2]),s=r[3],n=i(t[r[4]],r[5],r[6]);switch(s){case"AND":return e&&n;case"OR":return e||n}}return!1}catch(t){console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)e=(0,f.z7)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const t=(0,f.el)(this.labelExpressionInfo.expression);t&&(e="["+t+"]")}null!=e&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(null==e&&null!=this.labelExpression&&w(r))e=new g({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return(0,f.hV)(this)}getLabelExpressionArcade(){return(0,f.YI)(this)}getLabelExpressionSingleField(){return(0,f.UO)(this)}hash(){return JSON.stringify(this)}clone(){return new y({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:(0,l.d9)(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:(0,l.d9)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};(0,s._)([(0,u.Cb)({type:String,json:{write:!0}})],C.prototype,"name",void 0),(0,s._)([(0,u.Cb)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],C.prototype,"allowOverrun",void 0),(0,s._)([(0,u.Cb)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],C.prototype,"deconflictionStrategy",void 0),(0,s._)([(0,u.Cb)({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&"service"===i?.origin&&x(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],C.prototype,"labelExpression",void 0),(0,s._)([(0,h.r)("labelExpression")],C.prototype,"readLabelExpression",null),(0,s._)([(0,p.c)("labelExpression")],C.prototype,"writeLabelExpression",null),(0,s._)([(0,u.Cb)({type:g,json:{write:{overridePolicy:(e,t,i)=>function(e){return w(e)||x(e.layer)}(i)?{allowNull:!0}:{enabled:!1}}}})],C.prototype,"labelExpressionInfo",void 0),(0,s._)([(0,p.c)("labelExpressionInfo")],C.prototype,"writeLabelExpressionInfo",null),(0,s._)([(0,u.Cb)({type:b.apiValues,json:{type:b.jsonValues,read:b.read,write:b.write}})],C.prototype,"labelPlacement",void 0),(0,s._)([(0,u.Cb)({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],C.prototype,"labelPosition",void 0),(0,s._)([(0,u.Cb)({type:Number})],C.prototype,"maxScale",void 0),(0,s._)([(0,p.c)("maxScale")],C.prototype,"writeMaxScale",null),(0,s._)([(0,u.Cb)({type:Number})],C.prototype,"minScale",void 0),(0,s._)([(0,p.c)("minScale")],C.prototype,"writeMinScale",null),(0,s._)([(0,u.Cb)({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],C.prototype,"repeatLabel",void 0),(0,s._)([(0,u.Cb)({type:Number,cast:c.t_,json:{write:!0,origins:{"web-scene":{write:!1}}}})],C.prototype,"repeatLabelDistance",void 0),(0,s._)([(0,u.Cb)({types:n.yK,json:{origins:{"web-scene":{types:n.S6,write:v.vX,default:null}},write:v.vX,default:null}})],C.prototype,"symbol",void 0),(0,s._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],C.prototype,"useCodedValues",void 0),(0,s._)([(0,u.Cb)({type:String,json:{write:!0}})],C.prototype,"where",void 0),C=y=(0,s._)([(0,d.j)("esri.layers.support.LabelClass")],C);const T=C},94081:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(41831),o=i(82064),a=i(81977),l=(i(7753),i(39994),i(7283),i(40266));let c=r=class extends o.wq{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new n.Z}clone(){return new r({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],c.prototype,"floorField",void 0),(0,s._)([(0,a.Cb)({json:{read:!1,write:!1}})],c.prototype,"viewAllMode",void 0),(0,s._)([(0,a.Cb)({json:{read:!1,write:!1}})],c.prototype,"viewAllLevelIds",void 0),c=r=(0,s._)([(0,l.j)("esri.layers.support.LayerFloorInfo")],c);const u=c},27299:(e,t,i)=>{"use strict";i.d(t,{w:()=>a});var r=i(61681),s=i(12916);class n extends s.q{constructor(e=null){super("LercWorker","_decode",{_decode:e=>[e.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,t,i){return e&&0!==e.byteLength?this.invoke({buffer:e,options:t},i):Promise.resolve(null)}release(){--this.ref<=0&&(o.forEach(((e,t)=>{e===this&&o.delete(t)})),this.destroy())}}const o=new Map;function a(e=null){let t=o.get((0,r.Wg)(e));return t||((0,r.pC)(e)?(t=new n((t=>e.schedule(t))),o.set(e,t)):(t=new n,o.set(null,t))),++t.ref,t}},253:(e,t,i)=>{"use strict";i.d(t,{b:()=>l});var r=i(36663),s=i(53443),n=i(78668),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=class extends s.Z{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return this.running=!0,new Promise(((r,s)=>this._tasks.push(new c(r,s,e,t,i))))}unshift(e,t,i){return this.running=!0,new Promise(((r,s)=>this._tasks.unshift(new c(r,s,e,t,i))))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const i=(0,n.Hc)(t.signal);if(i&&!t.abortCallback)t.reject((0,n.zE)());else{const r=i?t.abortCallback((0,n.zE)()):t.callback(e);(0,n.y8)(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(e){t.reject(e)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=(0,n.zE)();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this.running=!1}};(0,r._)([(0,o.Cb)()],l.prototype,"running",void 0),l=(0,r._)([(0,a.j)("esri.layers.support.PromiseQueue")],l);class c{constructor(e,t,i,r,s){this.resolve=e,this.reject=t,this.callback=i,this.signal=r,this.abortCallback=s}}},24912:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(79438)),a=i(40266),l=i(34225);let c=r=class extends l.Z{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new r({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};(0,s._)([(0,n.Cb)({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],c.prototype,"maxValue",void 0),(0,s._)([(0,n.Cb)({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],c.prototype,"minValue",void 0),(0,s._)([(0,o.J)({range:"range"})],c.prototype,"type",void 0),c=r=(0,s._)([(0,a.j)("esri.layers.support.RangeDomain")],c);const u=c},81590:(e,t,i)=>{"use strict";i.d(t,{Z:()=>T});var r,s=i(36663),n=i(25709),o=i(82064),a=i(61681),l=i(17321),c=i(81977),u=(i(7753),i(39994),i(7283)),h=i(34248),d=i(40266),p=i(39835),f=i(53446),m=i(14685),g=i(24568),y=i(35925),_=i(39536),v=i(13054);const b=new n.X({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let w=r=class extends o.wq{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:i,size:s=256,spatialReference:n=m.Z.WebMercator,numLODs:o=24}=e;if(!(0,y.JY)(n)){const e=[];if(i)for(let t=0;t<i.length;t++){const r=i[t];e.push({level:t,scale:r,resolution:r})}else{let t=5e-4;for(let i=o-1;i>=0;i--)e.unshift({level:i,scale:t,resolution:t}),t*=2}return new r({dpi:96,lods:e,origin:new f.Z(0,0,n),size:[s,s],spatialReference:n})}const a=(0,y.C5)(n),c=e.origin?new f.Z({x:e.origin.x,y:e.origin.y,spatialReference:n}):new f.Z(a?{x:a.origin[0],y:a.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),u=1/(39.37*(0,l.c9)(n)*96),h=[];if(i)for(let e=0;e<i.length;e++){const t=i[e],r=t*u;h.push({level:e,scale:t,resolution:r})}else{let e=(0,y.sT)(n)?512/s*591657527.5917094:256/s*591657527.591555;const i=Math.ceil(o/t);h.push({level:0,scale:e,resolution:e*u});for(let r=1;r<i;r++){const i=e/2**t,s=i*u;h.push({level:r,scale:i,resolution:s}),e=i}}return new r({dpi:96,lods:h,origin:c,size:[s,s],spatialReference:n})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=(0,y.C5)(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return f.Z.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,i=0;const r=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach((e=>{r.push(e.scale),t=e.scale>t?e.scale:t,i=e.scale<i?e.scale:i,this._levelToLOD[e.level]=e}))),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const i=t[r],s=t[r+1];if(i<=e)return r;if(s===e)return r+1;if(i>e&&s<e)return r+Math.log(i/e)/Math.log(i/s)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,o;if("number"==typeof t)n=t,o=i;else if((0,y.fS)(t.spatialReference,this.spatialReference))n=t.x,o=t.y,r=i;else{const e=(0,_.iV)(t,this.spatialReference);if((0,a.Wi)(e))return null;n=e.x,o=e.y,r=i}const l=s.resolution*this.size[0],c=s.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:(0,g.Ue)()}),r.level=e,r.row=Math.floor((this.origin.y-o)/c+.001),r.col=Math.floor((n-this.origin.x)/l+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=r.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===r.ExtrapolateOptions.POWER_OF_TWO){const t=this.lods[this.lods.length-1];t.level<e.level&&(i=t)}if(!i)return;const s=e.level-i.level,n=i.resolution*this.size[0]/2**s,o=i.resolution*this.size[1]/2**s;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=(0,g.Ue)()),e.extent[0]=this.origin.x+e.col*n,e.extent[1]=this.origin.y-(e.row+1)*o,e.extent[2]=e.extent[0]+n,e.extent[3]=e.extent[1]+o}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return r.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(256===this.size[0]&&256===this.size[1])return 256===e?this:null;const i=[],s=this.lods.length;for(let e=0;e<s;e++){const r=this.lods[e],s=r.resolution*t;i.push(new v.Z({level:r.level,scale:r.scale,resolution:s}))}return new r({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};var x,C;(0,s._)([(0,c.Cb)({type:Number,json:{write:!0}})],w.prototype,"compressionQuality",void 0),(0,s._)([(0,c.Cb)({type:Number,json:{write:!0}})],w.prototype,"dpi",void 0),(0,s._)([(0,c.Cb)({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],w.prototype,"format",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],w.prototype,"isWrappable",null),(0,s._)([(0,c.Cb)({type:f.Z,json:{write:!0}})],w.prototype,"origin",void 0),(0,s._)([(0,h.r)("origin")],w.prototype,"readOrigin",null),(0,s._)([(0,c.Cb)({type:[v.Z],value:null,json:{write:!0}})],w.prototype,"lods",null),(0,s._)([(0,c.Cb)({readOnly:!0})],w.prototype,"minScale",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],w.prototype,"maxScale",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],w.prototype,"scales",void 0),(0,s._)([(0,c.Cb)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],w.prototype,"size",void 0),(0,s._)([(0,h.r)("size",["rows","cols"])],w.prototype,"readSize",null),(0,s._)([(0,p.c)("size",{cols:{type:u.z8},rows:{type:u.z8}})],w.prototype,"writeSize",null),(0,s._)([(0,c.Cb)({type:m.Z,json:{write:!0}})],w.prototype,"spatialReference",void 0),w=r=(0,s._)([(0,d.j)("esri.layers.support.TileInfo")],w),x=w||(w={}),(C=x.ExtrapolateOptions||(x.ExtrapolateOptions={}))[C.NONE=0]="NONE",C[C.POWER_OF_TWO=1]="POWER_OF_TWO";const T=w},84573:(e,t,i)=>{"use strict";i.d(t,{Z:()=>v});var r,s=i(36663),n=i(37956),o=i(74589),a=i(82064),l=i(67134),c=i(61681),u=i(81977),h=(i(7283),i(34248)),d=i(40266),p=i(39835);i(7753),i(39994);let f=r=class extends a.wq{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new r({respectsDaylightSaving:e,timezone:t})}};(0,s._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],f.prototype,"respectsDaylightSaving",void 0),(0,s._)([(0,h.r)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],f.prototype,"readRespectsDaylightSaving",null),(0,s._)([(0,u.Cb)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],f.prototype,"timezone",void 0),f=r=(0,s._)([(0,d.j)("esri.layers.support.TimeReference")],f);const m=f;var g,y=i(80680);let _=g=class extends a.wq{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new n.Z({start:i,end:r})}writeFullTimeExtent(e,t){e&&(0,c.pC)(e.start)&&(0,c.pC)(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new o.Z({value:t.timeInterval,unit:y.v.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new o.Z({value:t.defaultTimeInterval,unit:y.v.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:c}=this;return new g({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:(0,l.d9)(n),fullTimeExtent:(0,l.d9)(o),trackIdField:a,useTime:c})}};(0,s._)([(0,u.Cb)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],_.prototype,"cumulative",void 0),(0,s._)([(0,u.Cb)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],_.prototype,"endField",void 0),(0,s._)([(0,u.Cb)({type:n.Z,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"fullTimeExtent",void 0),(0,s._)([(0,h.r)("fullTimeExtent",["timeExtent"])],_.prototype,"readFullTimeExtent",null),(0,s._)([(0,p.c)("fullTimeExtent")],_.prototype,"writeFullTimeExtent",null),(0,s._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],_.prototype,"hasLiveData",void 0),(0,s._)([(0,u.Cb)({type:o.Z,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"interval",void 0),(0,s._)([(0,h.r)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],_.prototype,"readInterval",null),(0,s._)([(0,p.c)("interval")],_.prototype,"writeInterval",null),(0,s._)([(0,u.Cb)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],_.prototype,"startField",void 0),(0,s._)([(0,u.Cb)({type:m,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"timeReference",void 0),(0,s._)([(0,u.Cb)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"trackIdField",void 0),(0,s._)([(0,u.Cb)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],_.prototype,"useTime",void 0),_=g=(0,s._)([(0,d.j)("esri.layers.support.TimeInfo")],_);const v=_},20692:(e,t,i)=>{"use strict";i.d(t,{B5:()=>h,DR:()=>p,G:()=>b,M8:()=>g,Nm:()=>y,Qc:()=>d,XG:()=>_,a7:()=>m,ld:()=>f,wH:()=>v});var r=i(61681),s=i(3466),n=i(16641);const o={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},a=Object.values(o),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),c=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),u=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function h(e){return!!l.test(e)}function d(e){if((0,r.Wi)(e))return null;const t=(0,s.mN)(e),i=t.path.match(l)||t.path.match(c);if(!i)return null;const[,n,a,u,h]=i,d=a.indexOf("/");return{title:f(-1!==d?a.slice(d+1):a),serverType:o[u.toLowerCase()],sublayer:null!=h&&""!==h?parseInt(h,10):null,url:{path:n}}}function p(e){const t=(0,s.mN)(e).path.match(u);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function f(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function m(e,t){const i=[];if(e){const t=d(e);(0,r.pC)(t)&&t.title&&i.push(t.title)}if(t){const e=f(t);i.push(e)}if(2===i.length){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function g(e){if(!e)return!1;const t=(e=e.toLowerCase()).includes(".arcgis.com/"),i=e.includes("//services")||e.includes("//tiles")||e.includes("//features");return t&&i}function y(e,t){return e?(0,s.Qj)((0,s.Hu)(e,t)):e}function _(e){let{url:t}=e;if(!t)return{url:t};t=(0,s.Hu)(t,e.logger);const i=(0,s.mN)(t),n=d(i.path);let o;if((0,r.pC)(n))null!=n.sublayer&&null==e.layer.layerId&&(o=n.sublayer),t=n.url.path;else if(e.nonStandardUrlAllowed){const e=p(i.path);(0,r.pC)(e)&&(t=e.serviceUrl,o=e.sublayerId)}return{url:(0,s.Qj)(t),layerId:o}}function v(e,t,i,r,o){(0,n.w)(t,r,"url",o),r.url&&null!=e.layerId&&(r.url=(0,s.v_)(r.url,i,e.layerId.toString()))}function b(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return i&&(r||s||n)}},31484:(e,t,i)=>{"use strict";i.d(t,{C:()=>r});const r={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}}},51599:(e,t,i)=>{"use strict";i.d(t,{qG:()=>b,PV:()=>g,id:()=>x,iR:()=>p,rn:()=>m,rT:()=>S,u1:()=>T,rO:()=>C,Oh:()=>_,bT:()=>v,C_:()=>d,Lx:()=>y,vg:()=>w,YI:()=>h,HQ:()=>f});var r=i(37956),s=i(91772),n=i(14685),o=i(16641),a=i(61681),l=(i(78668),i(807)),c=i(74710),u=i(78621);const h={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},d={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},p={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},f={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:o.w}}},m={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},g={value:null,type:c.ZP,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function y(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const _={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},v={..._,json:{..._.json,origins:{"web-document":{..._.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&"service"!==i.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,u.b)(t.layerDefinition.drawingInfo.transparency):void 0:(0,u.b)(t.drawingInfo.transparency)}}},b={type:r.Z,readOnly:!0,get(){if(!this.layer?.timeInfo)return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:i}=this.layer,s=this.view?.timeExtent;let n=this.layer.timeExtent;e&&(n=function(e){if(!e)return e;const{start:t,end:i}=e;return new r.Z({start:(0,a.pC)(t)?(0,l.Nm)(t,t.getTimezoneOffset(),"minutes"):t,end:(0,a.pC)(i)?(0,l.Nm)(i,i.getTimezoneOffset(),"minutes"):i})}(n));let o=i?s&&n?s.intersection(n):s||n:n;if(!o||o.isEmpty||o.isAllTime)return o;t&&(o=o.offset(-t.value,t.unit)),e&&(o=function(e){if(!e)return e;const{start:t,end:i}=e;return new r.Z({start:(0,a.pC)(t)?(0,l.Nm)(t,-t.getTimezoneOffset(),"minutes"):t,end:(0,a.pC)(i)?(0,l.Nm)(i,-i.getTimezoneOffset(),"minutes"):i})}(o));const c=this._get("timeExtent");return o.equals(c)?c:o}},w={type:s.Z,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=s.Z.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(i.spatialReference=n.Z.fromJSON(t.spatialReference)),i}}}},read:!1}},x={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},C={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},T={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},S={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}}},12795:(e,t,i)=>{"use strict";i.d(t,{V5:()=>a,im:()=>l}),i(39994);var r=i(7767),s=i(34225),n=i(36253),o=i(24912);const a={key:"type",base:s.Z,typeMap:{range:o.Z,"coded-value":r.Z,inherited:n.Z}};function l(e){if(!e||!e.type)return null;switch(e.type){case"range":return o.Z.fromJSON(e);case"codedValue":return r.Z.fromJSON(e);case"inherited":return n.Z.fromJSON(e)}return null}},84465:(e,t,i)=>{"use strict";i.d(t,{d:()=>R});var r,s=i(48257),n=i(36663),o=i(80020),a=(i(86004),i(45510),i(16192),i(71297),i(878),i(22836),i(50172),i(25634),i(72506),i(54021)),l=i(67134),c=i(81977),u=(i(7283),i(79438)),h=i(40266),d=i(82064);i(7753),i(39994);let p=r=class extends d.wq{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new r({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};(0,n._)([(0,c.Cb)({type:String,json:{write:!0}})],p.prototype,"statisticType",void 0),(0,n._)([(0,c.Cb)({type:String,json:{write:!0}})],p.prototype,"onStatisticField",void 0),(0,n._)([(0,c.Cb)({type:String,json:{write:!0}})],p.prototype,"onStatisticValueExpression",void 0),p=r=(0,n._)([(0,h.j)("esri.layers.support.OutStatistic")],p);const f=p;var m;let g=m=class extends d.wq{constructor(){super(...arguments),this.name=null,this.outStatistic=null}clone(){return new m({name:this.name,outStatistic:this.outStatistic.clone()})}};(0,n._)([(0,c.Cb)({type:String,json:{write:!0}})],g.prototype,"name",void 0),(0,n._)([(0,c.Cb)({type:f,json:{write:!0}})],g.prototype,"outStatistic",void 0),g=m=(0,n._)([(0,h.j)("esri.layers.support.AggregateField")],g);const y=g;var _,v=i(51599),b=i(26732);let w=_=class extends s.B{constructor(e){super(e),this.type="binning",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}clone(){return new _({fields:(0,l.d9)(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:(0,l.d9)(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:(0,l.d9)(this.popupTemplate),renderer:(0,l.d9)(this.renderer)})}};(0,n._)([(0,u.J)({binning:"binning"})],w.prototype,"type",void 0),(0,n._)([(0,c.Cb)({type:Number,json:{write:!0}})],w.prototype,"fixedBinLevel",void 0),(0,n._)([(0,c.Cb)({type:[b.Z],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],w.prototype,"labelingInfo",void 0),(0,n._)([(0,c.Cb)(v.iR)],w.prototype,"labelsVisible",void 0),(0,n._)([(0,c.Cb)(v.C_)],w.prototype,"popupEnabled",void 0),(0,n._)([(0,c.Cb)({type:o.Z,json:{name:"popupInfo",write:!0}})],w.prototype,"popupTemplate",void 0),(0,n._)([(0,c.Cb)({type:[y],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],w.prototype,"fields",void 0),(0,n._)([(0,c.Cb)({types:a.A,json:{write:!0}})],w.prototype,"renderer",void 0),w=_=(0,n._)([(0,h.j)("esri.layers.support.FeatureReductionBinning")],w);const x=w;var C,T=i(4905),S=i(95550);let E=C=class extends d.wq{constructor(e){super(e),this.type="cluster",this.clusterRadius=(0,S.t_)("80px"),this.clusterMinSize=(0,S.t_)("12px"),this.clusterMaxSize=(0,S.t_)("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new C({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:(0,l.d9)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:(0,l.d9)(this.fields),renderer:(0,l.d9)(this.renderer),popupEnabled:this.popupEnabled,popupTemplate:(0,l.d9)(this.popupTemplate)})}};(0,n._)([(0,c.Cb)({type:["cluster"],readOnly:!0,json:{write:!0}})],E.prototype,"type",void 0),(0,n._)([(0,c.Cb)({type:Number,cast:e=>"auto"===e?e:(0,S.t_)(e),json:{write:!0}})],E.prototype,"clusterRadius",void 0),(0,n._)([(0,c.Cb)({type:Number,cast:S.t_,json:{write:!0}})],E.prototype,"clusterMinSize",void 0),(0,n._)([(0,c.Cb)({type:Number,cast:S.t_,json:{write:!0}})],E.prototype,"clusterMaxSize",void 0),(0,n._)([(0,c.Cb)(v.C_)],E.prototype,"popupEnabled",void 0),(0,n._)([(0,c.Cb)({type:o.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],E.prototype,"popupTemplate",void 0),(0,n._)([(0,c.Cb)({types:a.A,json:{write:!0}})],E.prototype,"renderer",void 0),(0,n._)([(0,c.Cb)({types:T.AH})],E.prototype,"symbol",void 0),(0,n._)([(0,c.Cb)({type:[b.Z],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],E.prototype,"labelingInfo",void 0),(0,n._)([(0,c.Cb)(v.iR)],E.prototype,"labelsVisible",void 0),(0,n._)([(0,c.Cb)({type:[y],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],E.prototype,"fields",void 0),E=C=(0,n._)([(0,h.j)("esri.layers.support.FeatureReductionCluster")],E);const A=E;var M=i(69766);const O={key:"type",base:s.B,typeMap:{selection:A}},R={types:{key:"type",base:s.B,typeMap:{selection:M.Z,cluster:A,binning:x}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:O},"portal-item":{types:O},"web-scene":{types:{key:"type",base:s.B,typeMap:{selection:M.Z}}}}}}},89076:(e,t,i)=>{"use strict";i.d(t,{v:()=>l});var r=i(13802),s=i(12512),n=i(28790),o=i(17095);const a=r.Z.getLogger("esri.layers.support.fieldProperties");function l(){return{fields:{type:[s.Z],value:null},fieldsIndex:{readOnly:!0,get(){return new n.Z(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||a.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return(0,o.Q0)(this.fieldsIndex,e)}}}}},86349:(e,t,i)=>{"use strict";i.d(t,{v:()=>r});const r=new(i(25709).X)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},17095:(e,t,i)=>{"use strict";i.d(t,{io:()=>v,vl:()=>C,ZV:()=>T,AB:()=>y,gd:()=>g,Ll:()=>S,Mu:()=>M,Qj:()=>E,R9:()=>K,Q0:()=>m,YN:()=>h,UF:()=>p,O5:()=>w,CH:()=>A,os:()=>O,y2:()=>B,H7:()=>V,Ec:()=>ee,qN:()=>z,Gm:()=>Q,Pz:()=>G,Lk:()=>_,Qc:()=>W,vP:()=>J});var r,s,n=i(70375),o=i(61681),a=i(86745);(s=r||(r={})).VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",s.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value";var l=i(30879);const c=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],u=["field","normalizationField"];function h(e,t){if(null!=e&&null!=t)for(const i of Array.isArray(e)?e:[e])if(d(c,i,t),"visualVariables"in i&&i.visualVariables)for(const e of i.visualVariables)d(u,e,t)}function d(e,t,i){if(e)for(const r of e){const e=(0,a.hS)(r,t),s=e&&"function"!=typeof e&&i.get(e);s&&(0,a.RB)(r,s.name,t)}}function p(e,t){if(null!=e&&t?.fields.length)if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i&&i.name||null,e.endField=r&&r.name||null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=r&&r.name||null}}const f=new Set;function m(e,t){return e&&t?(f.clear(),g(f,e,t),Array.from(f).sort()):[]}function g(e,t,i){if(i)if(t?.fields?.length)if(i.includes("*"))for(const{name:i}of t.fields)e.add(i);else for(const r of i)y(e,t,r);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const t of i)e.add(t)}}function y(e,t,i){if("string"==typeof i)if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function _(e,t){return(0,o.Wi)(t)||(0,o.Wi)(e)?[]:t.includes("*")?e.fields.map((e=>e.name)):t}async function v(e,t,i){if(!i)return;const{arcadeUtils:r}=await(0,l.LC)(),s=r.extractFieldNames(i,t?.fields?.map((e=>e.name)));for(const i of s)y(e,t,i)}async function b(e,t,r){if(r&&"1=1"!==r){const s=(await i.e(3362).then(i.bind(i,3362))).WhereClause.create(r,t);if(!s.isStandardized)throw new n.Z("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});g(e,t,s.fieldNames)}}function w({displayField:e,fields:t}){return e||(t&&t.length?x(t,"name-or-title")||x(t,"unique-identifier")||x(t,"type-or-category")||function(e){for(const t of e){if(!t||!t.name)continue;const e=t.name.toLowerCase();if(e.includes("name")||e.includes("title"))return t.name}return null}(t):null)}function x(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function C(e,t){if(!t)return;const i=(0,a.hS)("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function T(e,t,i){if(!t||!i||!("fields"in i))return;const r=[];if(i.popupTemplate?.expressionInfos&&r.push(...i.popupTemplate.expressionInfos.map((i=>v(e,t.fieldsIndex,i.expression)))),Array.isArray(i.popupTemplate?.content)){const s=i.popupTemplate.content;for(const i of s)"expression"===i.type&&i.expressionInfo&&r.push(v(e,t.fieldsIndex,i.expressionInfo.expression))}i.fields&&r.push(...i.fields.map((i=>async function(e,t,i){i.outStatistic.onStatisticValueExpression?v(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}(e,t.fieldsIndex,i)))),await Promise.all(r)}async function S(e,t,i){t&&(t.timeInfo&&(0,o.pC)(i)&&i.timeExtent&&g(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&g(e,t.fieldsIndex,[t.floorInfo.floorField]),(0,o.pC)(i)&&(0,o.pC)(i.where)&&await b(e,t.fieldsIndex,i.where))}async function E(e,t,i){t&&i&&await Promise.all(i.map((i=>async function(e,t,i){t&&i&&(i.valueExpression?await v(e,t.fieldsIndex,i.valueExpression):i.field&&y(e,t.fieldsIndex,i.field))}(e,t,i))))}function A(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?m(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function M(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map((t=>async function(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if("arcade"===r.type)await v(e,t,r.expression);else{const i=r.expression.match(/{[^}]*}/g);i&&i.forEach((i=>{y(e,t,i.slice(1,-1))}))}await b(e,t,s)}(e,r,t))))}function O(e){const t=e.defaultValue;return void 0!==t&&k(e,t)?t:e.nullable?null:void 0}function R(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function P(e){return null===e||R(e)}const I="isInteger"in Number?Number.isInteger:e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e;function L(e){return null===e||I(e)}function D(e){return null!=e&&"string"==typeof e}function N(e){return null===e||D(e)}function F(){return!0}function k(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?L:I;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?P:R;break;case"string":case"esriFieldTypeString":i=e.nullable?N:D;break;default:i=F}return 1===arguments.length?i:i(t)}const U=new Set(["integer","small-integer","single","double","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function V(e){return null!=e&&U.has(e.type)}function z(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function B(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}var H,j;function G(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function W(e,t){return e.nullable&&null===t?null:V(e)&&!function(e,t){const i="string"==typeof e?Z(e):e;return!!i&&(i.isInteger?I(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}(e.type,Number(t))?H.OUT_OF_RANGE:k(e,t)?e.domain?function(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,s="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>s)return r.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==e.codedValues||e.codedValues.every((e=>null==e||e.code!==t)))return r.INVALID_CODED_VALUE}return null}(e.domain,t):null:j.INVALID_TYPE}function Z(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return q;case"esriFieldTypeInteger":case"integer":return $;case"esriFieldTypeSingle":case"single":return Y;case"esriFieldTypeDouble":case"double":return X}}!function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"}(H||(H={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(j||(j={}));const q={min:-32768,max:32767,isInteger:!0},$={min:-2147483648,max:2147483647,isInteger:!0},Y={min:-34e37,max:12e37,isInteger:!1},X={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function J(e,t,i){switch(e){case r.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case r.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case j.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case H.OUT_OF_RANGE:{const{min:e,max:r}=Z(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${e} to ${r}`}}}function K(e,t){return!Q(e,t,null)}function Q(e,t,i){if(!t||!t.attributes||!e){if((0,o.pC)(i))for(const t of e)i.add(t);return!0}const r=t.attributes;let s=!1;for(const t of e)if(!(t in r)){if(s=!0,!(0,o.pC)(i))break;i.add(t)}return s}function ee(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some((t=>e.toLowerCase().startsWith(t)))}},13667:(e,t,i)=>{"use strict";i.r(t),i.d(t,{createLabelFunction:()=>p,formatField:()=>f});var r=i(70375),s=i(13802),n=i(72057),o=i(25741),a=i(17095),l=i(1110),c=i(30879);const u=s.Z.getLogger("esri.layers.support.labelFormatUtils"),h={type:"simple",evaluate:()=>null},d={getAttribute:(e,t)=>e.field(t)};async function p(e,t,s){if(!e||!e.symbol)return h;const n=e.where,o=(0,l.hV)(e),a=n?await i.e(3362).then(i.bind(i,3362)):null;let p;if("arcade"===o.type){const e=await(0,c.WW)(o.expression,s,t);p={type:"arcade",evaluate(t){try{const i=e.evaluate({$feature:"attributes"in t?e.repurposeFeature(t):t});if(null!=i)return i.toString()}catch(e){u.error(new r.Z("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:t,expression:o}))}return null},needsHydrationToEvaluate:()=>null==(0,l.el)(o.expression)}}else p={type:"simple",evaluate:e=>o.expression.replace(/{[^}]*}/g,(i=>{const r=i.slice(1,-1),s=t.get(r);if(!s)return i;let n=null;return"attributes"in e?e&&e.attributes&&(n=e.attributes[s.name]):n=e.field(s.name),null==n?"":f(n,s)}))};if(n){let e;try{e=a.WhereClause.create(n,t)}catch(e){return u.error(new r.Z("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:n,error:e})),h}const i=p.evaluate;p.evaluate=t=>{const s="attributes"in t?void 0:d;try{if(e.testFeature(t,s))return i(t)}catch(e){u.error(new r.Z("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:n,feature:t,error:e}))}return null}}return p}function f(e,t){if(null==e)return"";const i=t.domain;if(i)if("codedValue"===i.type||"coded-value"===i.type){const t=e;for(const e of i.codedValues)if(e.code===t)return e.name}else if("range"===i.type){const t=+e,r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue;if(r<=t&&t<=s)return i.name}let r=e;return"date"===t.type||"esriFieldTypeDate"===t.type?r=(0,n.p6)(r,(0,n.Ze)("short-date")):(0,a.H7)(t)&&(r=(0,o.uf)(+r)),r||""}},1110:(e,t,i)=>{"use strict";i.d(t,{UO:()=>p,YI:()=>d,dI:()=>f,el:()=>v,hV:()=>h,z7:()=>u});var r=i(21130);const s="__begin__",n="__end__",o=new RegExp(s,"ig"),a=new RegExp(n,"ig"),l=new RegExp("^"+s,"i"),c=new RegExp(n+"$","i");function u(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function h(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(e.labelExpression),t.type="conventional"),t}function d(e){const t=h(e);if(!t)return null;switch(t.type){case"conventional":return f(t.expression);case"arcade":return t.expression}return null}function p(e){const t=h(e);if(!t)return null;switch(t.type){case"conventional":return function(e){const t=e.match(m);return t&&t[1].trim()||null}(t.expression);case"arcade":return v(t.expression)}return null}function f(e){let t;return e?(t=(0,r.gx)(e,(e=>s+'$feature["'+e+'"]'+n)),t=l.test(t)?t.replace(l,""):'"'+t,t=c.test(t)?t.replace(c,""):t+'"',t=t.replace(o,'" + ').replace(a,' + "')):t='""',t}const m=/^\s*\{([^}]+)\}\s*$/i,g=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,y=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,_=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function v(e){if(!e)return null;let t=g.exec(e)||y.exec(e);return t?t[1]||t[3]:(t=_.exec(e),t?t[2]:null)}},49341:(e,t,i)=>{"use strict";i.d(t,{r:()=>n});var r=i(26732);const s=/\[([^\[\]]+)\]/gi;function n(e,t,i){return e?e.map((e=>{const n=new r.Z;if(n.read(e,i),n.labelExpression){const e=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;n.labelExpression=n.labelExpression.replace(s,((t,i)=>`[${function(e,t){if(!t)return e;const i=e.toLowerCase();for(let e=0;e<t.length;e++){const r=t[e].name;if(r.toLowerCase()===i)return r}return e}(i,e)}]`))}return n})):null}},54957:(e,t,i)=>{"use strict";function r(e){const t=e?.type;return"base-tile"===t||"tile"===t||"elevation"===t||"imagery-tile"===t||"base-elevation"===t||"open-street-map"===t||"wcs"===t||"web-tile"===t||"wmts"===t||"vector-tile"===t}function s(e){return"voxel"===e?.type}function n(e){return"imagery-tile"===e?.type}function o(e){return"esri.Basemap"===e.parent?.declaredClass&&e.parent.baseLayers.includes(e)}function a(e){return"feature"===e?.type&&!e.url&&"memory"===e.source?.type}function l(e){return"feature"===e?.type&&"feature-layer"===e.source?.type}function c(e){return!0===e.labelsVisible&&null!=e.labelingInfo&&e.labelingInfo.length>0}function u(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}i.d(t,{Am:()=>n,C6:()=>c,Tv:()=>s,iC:()=>r,mt:()=>u,rQ:()=>a,sy:()=>o,y2:()=>l})},10743:(e,t,i)=>{"use strict";i.d(t,{n:()=>I});var r,s=i(36663),n=i(25709),o=i(82064),a=i(81977),l=(i(7753),i(39994),i(69236)),c=i(79438),u=i(34248),h=i(40266),d=i(7283),p=i(3593),f=i(12512),m=i(81580),g=(i(91957),i(14685)),y=i(59659);let _=r=class extends o.wq{constructor(e){super(e),this.type="query-table"}clone(){const{workspaceId:e,query:t,oidFields:i,spatialReference:s,geometryType:n}=this,o={workspaceId:e,query:t,oidFields:i,spatialReference:s?.clone()??void 0,geometryType:n};return new r(o)}};var v;(0,s._)([(0,c.J)({queryTable:"query-table"})],_.prototype,"type",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],_.prototype,"workspaceId",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],_.prototype,"query",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],_.prototype,"oidFields",void 0),(0,s._)([(0,a.Cb)({type:g.Z,json:{write:!0}})],_.prototype,"spatialReference",void 0),(0,s._)([(0,c.J)(y.Mk)],_.prototype,"geometryType",void 0),_=r=(0,s._)([(0,h.j)("esri.layers.support.source.QueryTableDataSource")],_);let b=v=class extends o.wq{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new v({workspaceId:e,dataSourceName:t})}};var w;(0,s._)([(0,c.J)({raster:"raster"})],b.prototype,"type",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],b.prototype,"dataSourceName",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],b.prototype,"workspaceId",void 0),b=v=(0,s._)([(0,h.j)("esri.layers.support.source.RasterDataSource")],b);let x=w=class extends o.wq{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new w({workspaceId:e,gdbVersion:t,dataSourceName:i})}};var C,T;(0,s._)([(0,c.J)({table:"table"})],x.prototype,"type",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],x.prototype,"workspaceId",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],x.prototype,"gdbVersion",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],x.prototype,"dataSourceName",void 0),x=w=(0,s._)([(0,h.j)("esri.layers.support.source.TableDataSource")],x);const S=(0,n.w)()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let E=C=class extends o.wq{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return M()(e,t,i)}castLeftTableSource(e){return(0,d.N7)(R(),e)}readRightTableSource(e,t,i){return M()(e,t,i)}castRightTableSource(e){return(0,d.N7)(R(),e)}clone(){const{leftTableKey:e,rightTableKey:t,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:i?.clone()??void 0,rightTableSource:r?.clone()??void 0,joinType:s};return new C(n)}};(0,s._)([(0,c.J)({joinTable:"join-table"})],E.prototype,"type",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],E.prototype,"leftTableKey",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],E.prototype,"rightTableKey",void 0),(0,s._)([(0,a.Cb)({json:{write:!0}})],E.prototype,"leftTableSource",void 0),(0,s._)([(0,u.r)("leftTableSource")],E.prototype,"readLeftTableSource",null),(0,s._)([(0,l.p)("leftTableSource")],E.prototype,"castLeftTableSource",null),(0,s._)([(0,a.Cb)({json:{write:!0}})],E.prototype,"rightTableSource",void 0),(0,s._)([(0,u.r)("rightTableSource")],E.prototype,"readRightTableSource",null),(0,s._)([(0,l.p)("rightTableSource")],E.prototype,"castRightTableSource",null),(0,s._)([(0,c.J)(S)],E.prototype,"joinType",void 0),E=C=(0,s._)([(0,h.j)("esri.layers.support.source.JoinTableDataSource")],E);let A=null;function M(){return A||(A=(0,p.d)({types:R()})),A}let O=null;function R(){return O||(O={key:"type",base:null,typeMap:{"data-layer":I,"map-layer":m.R}}),O}const P={key:"type",base:null,typeMap:{"join-table":E,"query-table":_,raster:b,table:x}};let I=T=class extends o.wq{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new T({fields:e,dataSource:t})}};(0,s._)([(0,c.J)({dataLayer:"data-layer"})],I.prototype,"type",void 0),(0,s._)([(0,a.Cb)({type:[f.Z],json:{write:!0}})],I.prototype,"fields",void 0),(0,s._)([(0,a.Cb)({types:P,json:{write:!0}})],I.prototype,"dataSource",void 0),I=T=(0,s._)([(0,h.j)("esri.layers.support.source.DataLayerSource")],I),I.from=(0,d.se)(I)},81580:(e,t,i)=>{"use strict";i.d(t,{R:()=>u});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283)),l=i(79438),c=i(40266);let u=r=class extends n.wq{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new r({mapLayerId:e,gdbVersion:t})}};(0,s._)([(0,l.J)({mapLayer:"map-layer"})],u.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:a.z8,json:{write:!0}})],u.prototype,"mapLayerId",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],u.prototype,"gdbVersion",void 0),u=r=(0,s._)([(0,c.j)("esri.layers.support.source.MapLayerSource")],u)},76912:(e,t,i)=>{"use strict";i.d(t,{D:()=>n});var r=i(20692);const s=[];function n(e,t){if((0,r.M8)(e.url))return!0;const{wkid:i}=t;for(const t of s){if(e.version>=t[0])return!0;if("function"==typeof t[1]&&(t[1]=t[1]()),t[1].has(i))return!1}return!0}s.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),s.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),s.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),s.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),s.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),s.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),s.push([10.61,()=>new Set([102497])]),s.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),s.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),s.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}])},66311:(e,t,i)=>{"use strict";i.d(t,{W:()=>n,v:()=>o});var r=i(56803);const s={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{"-"===t.charAt(0)?e.style.setProperty(t,i):e.style[t]=i}};let n=e=>(0,r.l7)(s,e),o={create:(e,t)=>(t=n(t),(0,r.WV)(e,document.createElement("div"),void 0,t),(0,r.UQ)(e,t)),append:(e,t,i)=>(i=n(i),(0,r.WV)(t,e,void 0,i),(0,r.UQ)(t,i)),insertBefore:(e,t,i)=>(i=n(i),(0,r.WV)(t,e.parentNode,e,i),(0,r.UQ)(t,i)),merge:(e,t,i)=>(i=n(i),t.domNode=e,(0,r.Yj)(e,t,i),(0,r.UQ)(t,i)),replace:(e,t,i)=>(i=n(i),(0,r.WV)(t,e.parentNode,e,i),e.parentNode.removeChild(e),(0,r.UQ)(t,i))}},56803:(e,t,i)=>{"use strict";i.d(t,{UQ:()=>A,WV:()=>C,Yj:()=>x,l7:()=>c});var r=i(54956);const s="http://www.w3.org/",n=`${s}2000/svg`,o=`${s}1999/xlink`;let a,l=[],c=(e,t)=>{let i={};return Object.keys(e).forEach((t=>{i[t]=e[t]})),t&&Object.keys(t).forEach((e=>{i[e]=t[e]})),i},u=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),h=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},d=(e,t,i)=>{if(""!==t.vnodeSelector)for(let r=i;r<e.length;r++)if(u(e[r],t))return r;return-1},p=(e,t,i,r)=>{let s=e[t];if(""===s.vnodeSelector)return;let n=s.properties;if(!(n?void 0===n.key?n.bind:n.key:void 0))for(let n=0;n<e.length;n++)if(n!==t){let t=e[n];if(u(t,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${"added"===r?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},f=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},m=[],g=!1,y=e=>{(e.children||[]).forEach(y),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},_=()=>{g=!1,m.forEach(y),m.length=0},v=e=>{m.push(e),g||(g=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(_,{timeout:16}):setTimeout(_,16))},b=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i){t.style.pointerEvents="none";let r=()=>{t.parentNode&&(t.parentNode.removeChild(t),v(e))};return void i(t,r,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),v(e))},w=(e,t,i)=>{if(!t)return;let s=i.eventHandlerInterceptor,a=Object.keys(t),l=a.length;for(let c=0;c<l;c++){let l=a[c],u=t[l];if("className"===l)throw new Error('Property "className" is not supported, use "class".');if("class"===l)T(e,u,!0);else if("classes"===l){let t=Object.keys(u),i=t.length;for(let r=0;r<i;r++){let i=t[r];u[i]&&e.classList.add(i)}}else if("styles"===l){let t=Object.keys(u),r=t.length;for(let s=0;s<r;s++){let r=t[s],n=u[r];n&&(h(n),i.styleApplyer(e,r,n))}}else if("key"!==l&&null!=u){let a=typeof u;"function"===a?(0===l.lastIndexOf("on",0)&&(s&&(u=s(l,u,e,t)),"oninput"===l&&function(){let e=u;u=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}()),e[l]=u):i.namespace===n?"href"===l?e.setAttributeNS(o,l,u):e.setAttribute(l,u):"string"===a&&"value"!==l?"innerHTML"===l?e[l]=r.w3.sanitize(u):e.setAttribute(l,u):e[l]=u}}},x=(e,t,i)=>{((e,t,i)=>{if(t)for(let r of t)C(r,e,void 0,i)})(e,t.children,i),t.text&&(e.textContent=t.text),w(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},C=(e,t,i,r)=>{let s,o=0,a=e.vnodeSelector,l=t.ownerDocument;if(""===a)s=e.domNode=l.createTextNode(e.text),void 0!==i?t.insertBefore(s,i):t.appendChild(s);else{for(let u=0;u<=a.length;++u){let h=a.charAt(u);if(u===a.length||"."===h||"#"===h){let h=a.charAt(o-1),d=a.slice(o,u);"."===h?s.classList.add(d):"#"===h?s.id=d:("svg"===d&&(r=c(r,{namespace:n})),void 0!==r.namespace?s=e.domNode=l.createElementNS(r.namespace,d):(s=e.domNode=e.domNode||l.createElement(d),"input"===d&&e.properties&&void 0!==e.properties.type&&s.setAttribute("type",e.properties.type)),void 0!==i?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),o=u+1}}x(s,e,r)}},T=(e,t,i)=>{t&&t.split(" ").forEach((t=>{t&&e.classList.toggle(t,i)}))},S=(e,t,i,s)=>{if(!i)return;let a=!1,l=Object.keys(i),c=l.length;for(let u=0;u<c;u++){let c=l[u],d=i[c],p=t[c];if("class"===c)p!==d&&(T(e,p,!1),T(e,d,!0));else if("classes"===c){let t=e.classList,i=Object.keys(d),r=i.length;for(let e=0;e<r;e++){let r=i[e],s=!!d[r];s!==!!p[r]&&(a=!0,s?t.add(r):t.remove(r))}}else if("styles"===c){let t=Object.keys(d),i=t.length;for(let r=0;r<i;r++){let i=t[r],n=d[i];n!==p[i]&&(a=!0,n?(h(n),s.styleApplyer(e,i,n)):s.styleApplyer(e,i,""))}}else if(d||"string"!=typeof p||(d=""),"value"===c){let t=e[c];t!==d&&(e["oninput-value"]?t===e["oninput-value"]:d!==p)&&(e[c]=d,e["oninput-value"]=void 0),d!==p&&(a=!0)}else if(d!==p){let t=typeof d;"function"===t&&s.eventHandlerInterceptor||(s.namespace===n?"href"===c?e.setAttributeNS(o,c,d):e.setAttribute(c,d):"string"===t?"innerHTML"===c?e[c]=r.w3.sanitize(d):"role"===c&&""===d?e.removeAttribute(c):e.setAttribute(c,d):e[c]!==d&&(e[c]=d),a=!0)}}return a},E=(e,t,i,r,s)=>{if(i===r)return!1;r=r||l;let n,o=(i=i||l).length,c=r.length,h=0,m=0,g=!1;for(;m<c;){let l=h<o?i[h]:void 0,c=r[m];if(void 0!==l&&u(l,c))g=a(l,c,s)||g,h++;else{let l=d(i,c,h+1);if(l>=0){for(n=h;n<l;n++)b(i[n]),p(i,n,e,"removed");g=a(i[l],c,s)||g,h=l+1}else C(c,t,h<o?i[h].domNode:void 0,s),f(c),p(r,m,e,"added")}m++}if(o>h)for(n=h;n<o;n++)b(i[n]),p(i,n,e,"removed");return g};a=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let o=!1;if(""===t.vnodeSelector){if(t.text!==e.text){let e=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(e,r),t.domNode=e,s=!0,s}t.domNode=r}else 0===t.vnodeSelector.lastIndexOf("svg",0)&&(i=c(i,{namespace:n})),e.text!==t.text&&(o=!0,void 0===t.text?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,o=E(t,r,e.children,t.children,i)||o,o=S(r,e.properties,t.properties,i)||o,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return o&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let A=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,a(r,i,t)},domNode:e.domNode})},22591:(e,t,i)=>{"use strict";i.d(t,{E:()=>l});var r=i(66311);let s,n=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};s=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let o=(e,t)=>{let i=e;return t.forEach((e=>{i=i&&i.children?s(i.children,(t=>t.domNode===e)):void 0})),i},a=(e,t,i)=>{let r=function(r){i("domEvent",r);let s=t(),a=n(r.currentTarget,s.domNode);a.reverse();let l,c=o(s.getLastRender(),a);return e.scheduleRender(),c&&(l=c.properties[`on${r.type}`].apply(c.properties.bind||this,arguments)),i("domEventProcessed",r),l};return(e,t,i,s)=>r},l=e=>{let t,i,s=(0,r.W)(e),n=s.performanceLogger,o=!0,l=!1,c=[],u=[],h=(e,i,r)=>{let o;s.eventHandlerInterceptor=a(t,(()=>o),n),o=e(i,r(),s),c.push(o),u.push(r)},d=()=>{if(i=void 0,o){o=!1,n("renderStart",void 0);for(let e=0;e<c.length;e++){let t=u[e]();n("rendered",void 0),c[e].update(t),n("patched",void 0)}n("renderDone",void 0),o=!0}};return t={renderNow:d,scheduleRender:()=>{i||l||(i=requestAnimationFrame(d))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),l=!0},resume:()=>{l=!1,o=!0,t.scheduleRender()},append:(e,t)=>{h(r.v.append,e,t)},insertBefore:(e,t)=>{h(r.v.insertBefore,e,t)},merge:(e,t)=>{h(r.v.merge,e,t)},replace:(e,t)=>{h(r.v.replace,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t}},4970:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=r=class extends n.wq{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new r({title:this.title,expression:this.expression})}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,s._)([(0,o.Cb)({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"returnType",void 0),l=r=(0,s._)([(0,a.j)("esri.popup.ElementExpressionInfo")],l);const c=l},18228:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=r=class extends n.wq{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new r({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"name",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,s._)([(0,o.Cb)({type:["string","number"],json:{write:!0}})],l.prototype,"returnType",void 0),l=r=(0,s._)([(0,a.j)("esri.popup.ExpressionInfo")],l);const c=l},78213:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r,s=i(36663),n=i(25709),o=i(82064),a=i(67134),l=i(81977),c=(i(7283),i(79438)),u=i(40266),h=i(98822);let d=r=class extends o.wq{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new r({fieldName:this.fieldName,format:this.format?(0,a.d9)(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],d.prototype,"fieldName",void 0),(0,s._)([(0,l.Cb)({type:h.Z,json:{write:!0}})],d.prototype,"format",void 0),(0,s._)([(0,l.Cb)({type:Boolean,json:{write:!0,default:!1}})],d.prototype,"isEditable",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,s._)([(0,c.J)(new n.X({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],d.prototype,"stringFieldOption",void 0),(0,s._)([(0,l.Cb)({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],d.prototype,"statisticType",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],d.prototype,"tooltip",void 0),(0,s._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],d.prototype,"visible",void 0),d=r=(0,s._)([(0,u.j)("esri.popup.FieldInfo")],d);const p=d},24834:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(17814);let l=r=class extends a.Z{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new r({description:this.description,displayType:this.displayType,title:this.title})}};(0,s._)([(0,n.Cb)({type:String,json:{write:!0}})],l.prototype,"description",void 0),(0,s._)([(0,n.Cb)({type:["auto","preview","list"],json:{write:!0}})],l.prototype,"displayType",void 0),(0,s._)([(0,n.Cb)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,s._)([(0,n.Cb)({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"type",void 0),l=r=(0,s._)([(0,o.j)("esri.popup.content.AttachmentsContent")],l);const c=l},49902:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(86076),l=i(99806);let c=r=class extends a.Z{constructor(e){super(e),this.type="bar-chart"}clone(){return new r({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,s._)([(0,n.Cb)({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:l.l.write}})],c.prototype,"type",void 0),c=r=(0,s._)([(0,o.j)("esri.popup.content.BarChartMediaInfo")],c);const u=c},10367:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(86076),l=i(99806);let c=r=class extends a.Z{constructor(e){super(e),this.type="column-chart"}clone(){return new r({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,s._)([(0,n.Cb)({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:l.l.write}})],c.prototype,"type",void 0),c=r=(0,s._)([(0,o.j)("esri.popup.content.ColumnChartMediaInfo")],c);const u=c},17814:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266));let a=class extends s.wq{constructor(e){super(e),this.type=null}};(0,r._)([(0,n.Cb)({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.popup.content.Content")],a);const l=a},15902:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(67134),o=i(81977),a=(i(7283),i(40266)),l=i(17814);let c=r=class extends l.Z{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new r({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?(0,n.d9)(this.outFields):null})}};(0,s._)([(0,o.Cb)()],c.prototype,"creator",void 0),(0,s._)([(0,o.Cb)()],c.prototype,"destroyer",void 0),(0,s._)([(0,o.Cb)()],c.prototype,"outFields",void 0),(0,s._)([(0,o.Cb)({type:["custom"],readOnly:!0})],c.prototype,"type",void 0),c=r=(0,s._)([(0,a.j)("esri.popup.content.CustomContent")],c);const u=c},32776:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(4970),l=i(17814);let c=r=class extends l.Z{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){return new r({expressionInfo:this.expressionInfo?.clone()})}};(0,s._)([(0,n.Cb)({type:a.Z,json:{write:!0}})],c.prototype,"expressionInfo",void 0),(0,s._)([(0,n.Cb)({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0),c=r=(0,s._)([(0,o.j)("esri.popup.content.ExpressionContent")],c);const u=c},29893:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var r,s=i(36663),n=i(67134),o=i(81977),a=(i(7283),i(40266)),l=i(39835),c=i(78213),u=i(17814);let h=r=class extends u.Z{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map((e=>e.toJSON()))}clone(){return new r((0,n.d9)({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};(0,s._)([(0,o.Cb)({type:Object,json:{write:!0}})],h.prototype,"attributes",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],h.prototype,"description",void 0),(0,s._)([(0,o.Cb)({type:[c.Z]})],h.prototype,"fieldInfos",void 0),(0,s._)([(0,l.c)("fieldInfos")],h.prototype,"writeFieldInfos",null),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],h.prototype,"title",void 0),(0,s._)([(0,o.Cb)({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],h.prototype,"type",void 0),h=r=(0,s._)([(0,a.j)("esri.popup.content.FieldsContent")],h);const d=h},2781:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(16606),l=i(82064);let c=r=class extends l.wq{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new r({linkURL:this.linkURL,sourceURL:this.sourceURL})}};(0,s._)([(0,n.Cb)({type:String,json:{write:!0}})],c.prototype,"linkURL",void 0),(0,s._)([(0,n.Cb)({type:String,json:{write:!0}})],c.prototype,"sourceURL",void 0),c=r=(0,s._)([(0,o.j)("esri.popup.content.support.ImageMediaInfoValue")],c);const u=c;var h;let d=h=class extends a.Z{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new h({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};(0,s._)([(0,n.Cb)({type:Number,json:{write:!0}})],d.prototype,"refreshInterval",void 0),(0,s._)([(0,n.Cb)({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],d.prototype,"type",void 0),(0,s._)([(0,n.Cb)({type:u,json:{write:!0}})],d.prototype,"value",void 0),d=h=(0,s._)([(0,o.j)("esri.popup.content.ImageMediaInfo")],d);const p=d},66345:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(86076),l=i(99806);let c=r=class extends a.Z{constructor(e){super(e),this.type="line-chart"}clone(){return new r({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,s._)([(0,n.Cb)({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:l.l.write}})],c.prototype,"type",void 0),c=r=(0,s._)([(0,o.j)("esri.popup.content.LineChartMediaInfo")],c);const u=c},21363:(e,t,i)=>{"use strict";i.d(t,{Z:()=>_});var r,s=i(36663),n=i(67134),o=i(81977),a=(i(7283),i(34248)),l=i(40266),c=i(39835),u=i(49902),h=i(10367),d=i(17814),p=i(2781),f=i(66345),m=i(17097),g=i(36598);let y=r=class extends d.Z{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map((e=>"image"===e.type?p.Z.fromJSON(e):"barchart"===e.type?u.Z.fromJSON(e):"columnchart"===e.type?h.Z.fromJSON(e):"linechart"===e.type?f.Z.fromJSON(e):"piechart"===e.type?m.Z.fromJSON(e):void 0)).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map((e=>e.toJSON()))}clone(){return new r((0,n.d9)({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};(0,s._)([(0,o.Cb)()],y.prototype,"activeMediaInfoIndex",void 0),(0,s._)([(0,o.Cb)({type:Object,json:{write:!0}})],y.prototype,"attributes",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],y.prototype,"description",void 0),(0,s._)([(0,o.Cb)({types:[g.V]})],y.prototype,"mediaInfos",void 0),(0,s._)([(0,a.r)("mediaInfos")],y.prototype,"readMediaInfos",null),(0,s._)([(0,c.c)("mediaInfos")],y.prototype,"writeMediaInfos",null),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],y.prototype,"title",void 0),(0,s._)([(0,o.Cb)({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],y.prototype,"type",void 0),y=r=(0,s._)([(0,l.j)("esri.popup.content.MediaContent")],y);const _=y},17097:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(86076),l=i(99806);let c=r=class extends a.Z{constructor(e){super(e),this.type="pie-chart"}clone(){return new r({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,s._)([(0,n.Cb)({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:l.l.write}})],c.prototype,"type",void 0),c=r=(0,s._)([(0,o.j)("esri.popup.content.PieChartMediaInfo")],c);const u=c},58106:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(17814);let l=r=class extends a.Z{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new r({text:this.text})}};(0,s._)([(0,n.Cb)({type:String,json:{write:!0}})],l.prototype,"text",void 0),(0,s._)([(0,n.Cb)({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"type",void 0),l=r=(0,s._)([(0,o.j)("esri.popup.content.TextContent")],l);const c=l},86076:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(16606),l=i(82064),c=i(67134),u=i(94268);let h=r=class extends l.wq{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new r({fields:(0,c.d9)(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};(0,s._)([(0,n.Cb)({type:[String],json:{write:!0}})],h.prototype,"fields",void 0),(0,s._)([(0,n.Cb)({type:String,json:{write:!0}})],h.prototype,"normalizeField",void 0),(0,s._)([(0,n.Cb)({type:[u.Z],json:{read:!1}})],h.prototype,"series",void 0),(0,s._)([(0,n.Cb)({type:String,json:{write:!0}})],h.prototype,"tooltipField",void 0),h=r=(0,s._)([(0,o.j)("esri.popup.content.support.ChartMediaInfoValue")],h);const d=h;let p=class extends a.Z{constructor(e){super(e),this.type=null,this.value=null}};(0,s._)([(0,n.Cb)({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],p.prototype,"type",void 0),(0,s._)([(0,n.Cb)({type:d,json:{write:!0}})],p.prototype,"value",void 0),p=(0,s._)([(0,o.j)("esri.popup.content.mixins.ChartMediaInfo")],p);const f=p},16606:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266));let a=class extends s.wq{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};(0,r._)([(0,n.Cb)({type:String,json:{write:!0}})],a.prototype,"altText",void 0),(0,r._)([(0,n.Cb)({type:String,json:{write:!0}})],a.prototype,"caption",void 0),(0,r._)([(0,n.Cb)({type:String,json:{write:!0}})],a.prototype,"title",void 0),(0,r._)([(0,n.Cb)({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.popup.content.mixins.MediaInfo")],a);const l=a},94268:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(53443),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=r=class extends n.Z{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new r({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};(0,s._)([(0,o.Cb)()],l.prototype,"fieldName",void 0),(0,s._)([(0,o.Cb)()],l.prototype,"tooltip",void 0),(0,s._)([(0,o.Cb)()],l.prototype,"value",void 0),l=r=(0,s._)([(0,a.j)("esri.popup.content.support.ChartMediaInfoValueSeries")],l);const c=l},99806:(e,t,i)=>{"use strict";i.d(t,{l:()=>r});const r=(0,i(25709).w)()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"})},36598:(e,t,i)=>{"use strict";i.d(t,{V:()=>l});var r=i(49902),s=i(10367),n=i(2781),o=i(66345),a=i(17097);const l={base:i(16606).Z,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":r.Z,"column-chart":s.Z,"line-chart":o.Z,"pie-chart":a.Z,image:n.Z}}},98822:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r=i(36663);const s=(0,i(25709).w)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});s.toJSON.bind(s),s.fromJSON.bind(s);var n,o=i(82064),a=i(81977),l=(i(7753),i(39994),i(7283)),c=i(79438),u=i(40266),h=i(72057),d=i(25741);let p=n=class extends o.wq{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new n({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?(0,h.p6)(e,{...(0,h.Ze)(this.dateFormat),...this.dateTimeFormatOptions}):(0,d.uf)(e,(0,d.sh)(this))}formatRasterPixelValue(e){let t,i;return e.trim().includes(",")?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(";")?(t=";",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(" ")?(t=i=" ",this._formatDelimitedString(e,t,i,this)):this.format(Number(e))}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map((e=>this.format(Number(e)))).join(i):e}};(0,r._)([(0,c.J)(s)],p.prototype,"dateFormat",void 0),(0,r._)([(0,a.Cb)({type:Object,json:{read:!1}})],p.prototype,"dateTimeFormatOptions",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],p.prototype,"digitSeparator",void 0),(0,r._)([(0,a.Cb)({type:l.z8,json:{write:!0}})],p.prototype,"places",void 0),p=n=(0,r._)([(0,u.j)("esri.popup.support.FieldInfoFormat")],p);const f=p},79163:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=r=class extends n.wq{constructor(e){super(e),this.field=null,this.order=null}clone(){return new r({field:this.field,order:this.order})}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"field",void 0),(0,s._)([(0,o.Cb)({type:["asc","desc"],json:{write:!0}})],l.prototype,"order",void 0),l=r=(0,s._)([(0,a.j)("esri.popup.support.RelatedRecordsInfoFieldOrder")],l);const c=l},26869:(e,t,i)=>{"use strict";i.d(t,{Z:()=>M});var r=i(36663),s=i(51366),n=i(88256),o=i(66341),a=i(70375),l=i(82064),c=i(68309),u=i(61681),h=i(78668),d=i(81977),p=(i(7753),i(39994),i(7283)),f=i(34248),m=i(40266),g=i(91772),y=i(8108),_=i(58874),v=i(53443);let b=class extends v.Z{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};(0,r._)([(0,d.Cb)()],b.prototype,"nextQueryParams",void 0),(0,r._)([(0,d.Cb)()],b.prototype,"queryParams",void 0),(0,r._)([(0,d.Cb)()],b.prototype,"results",void 0),(0,r._)([(0,d.Cb)()],b.prototype,"total",void 0),b=(0,r._)([(0,m.j)("esri.portal.PortalQueryResult")],b);const w=b;var x,C=i(90298),T=i(99522);let S;const E={PortalGroup:()=>Promise.resolve().then(i.bind(i,36069)),PortalItem:()=>Promise.resolve().then(i.bind(i,53110)),PortalUser:()=>Promise.resolve().then(i.bind(i,90298))};let A=x=class extends((0,l.eC)(c.Z)){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=s.Z.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return"string"==typeof e?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)s.Z.request.trustedServers.includes(t)||s.Z.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e?e.toLowerCase():e}readUser(e){let t=null;return e&&(t=C.default.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(i.bind(i,88355)).then((({default:t})=>{(0,h.k_)(e),S=t})).then((()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e))).then((e=>{if(n.id){const e=n.id;this.credential=e.findCredential(this.restUrl),this.credential||this.authMode!==x.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=e.on("credential-create",(()=>{e.findCredential(this.restUrl)&&this._signIn()})))}this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await i.e(8558).then(i.bind(i,98558))).default;return e?e.map((e=>new t({id:e.id,url:e.url}))):[]}fetchBasemaps(e,t){const i=new _.Z;return i.query=e||(s.Z.apiKey&&(0,T.r)(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then((e=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',e.total){const r=e.results[0];return i.sortField=r.sortField||"name",i.sortOrder=r.sortOrder||"desc",r.queryItems(i,t)}return null})).then((e=>{let t;return t=e&&e.total?e.results.filter((e=>"Web Map"===e.type)).map((e=>new S({portalItem:e}))):[],t}))}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then((e=>e.categorySchema)):(0,h.Hc)(e)?Promise.reject((0,h.zE)()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new _.Z;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const e of t)r.push(`(title:"${e.title}" AND owner:${e.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then((e=>e.results))}return(0,h.Hc)(e)?Promise.reject((0,h.zE)()):Promise.resolve([])}fetchRegions(e){const t=this.user?.culture||this.culture||(0,y.Kd)();return this._request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){const t=this.user?.culture||this.culture||(0,y.Kd)();return this._request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return x._default&&!x._default.destroyed||(x._default=new x),x._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new a.Z("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new x({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new a.Z("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new a.Z("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s={authMode:e,query:{culture:(0,y.Kd)().toLowerCase()},...i};return"auto"===s.authMode&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(r,s)}_queryPortal(e,t,i,r){const s=(0,p.se)(_.Z,t),n=t=>this._request(this.restUrl+e,{...s.toRequestOptions(this),...r}).then((e=>{const i=s.clone();return i.start=e.nextStart,new w({nextQueryParams:i,queryParams:s,total:e.total,results:x._resultsToTypedArray(t,{portal:this},e,r)})})).then((e=>Promise.all(e.results.map((t=>"function"==typeof t.when?t.when():e))).then((()=>e),(t=>((0,h.r9)(t),e)))));return i&&E[i]?E[i]().then((({default:e})=>((0,h.k_)(r),n(e)))):n()}_signIn(){if(this.authMode===x.AUTH_MODE_ANONYMOUS)return Promise.reject(new a.Z("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const e=e=>Promise.resolve().then((()=>"not-loaded"===this.loadStatus?(e||(this.authMode="immediate"),this.load().then((()=>null))):"loading"===this.loadStatus?this.load().then((()=>this.credential?null:(this.credential=e,this._fetchSelf("immediate")))):this.user&&this.credential===e?null:(this.credential=e,this._fetchSelf("immediate")))).then((e=>{e&&(this.sourceJSON=e,this.read(e))}));return n.id?n.id.getCredential(this.restUrl).then((t=>e(t))):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,i){return this._request(e,t).then((e=>{const t=x._resultsToTypedArray(i,{portal:this},e);return Promise.all(t.map((t=>"function"==typeof t.when?t.when():e))).then((()=>t),(()=>t))}))}_readBasemap(e){if(e){const t=S.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const i={f:"json",...t.query},{authMode:r=(this.authMode===x.AUTH_MODE_ANONYMOUS?"anonymous":"auto"),body:s=null,cacheBust:n=!1,method:a="auto",responseType:l="json",signal:c}=t,u={authMode:r,body:s,cacheBust:n,method:a,query:i,responseType:l,timeout:0,signal:c};return(0,o.default)(this._normalizeSSL(e),u).then((e=>e.data))}static _resultsToTypedArray(e,t,i,r){let s;if(i){const n=(0,u.pC)(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map((i=>{const r=Object.assign(e?e.fromJSON(i):i,t);return"function"==typeof r.load&&r.load(n),r})))}else s=[];return s}};A.AUTH_MODE_ANONYMOUS="anonymous",A.AUTH_MODE_AUTO="auto",A.AUTH_MODE_IMMEDIATE="immediate",(0,r._)([(0,d.Cb)()],A.prototype,"access",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"allSSL",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"authMode",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"authorizedCrossOriginDomains",void 0),(0,r._)([(0,f.r)("authorizedCrossOriginDomains")],A.prototype,"readAuthorizedCrossOriginDomains",null),(0,r._)([(0,d.Cb)()],A.prototype,"basemapGalleryGroupQuery",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"bingKey",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"canListApps",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"canListData",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"canListPreProvisionedItems",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"canProvisionDirectPurchase",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"canSearchPublic",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"canShareBingPublic",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"canSharePublic",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"canSignInArcGIS",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"canSignInIDP",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"colorSetsGroupQuery",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"commentsEnabled",void 0),(0,r._)([(0,d.Cb)({type:Date})],A.prototype,"created",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"credential",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"culture",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"currentVersion",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"customBaseUrl",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"defaultBasemap",void 0),(0,r._)([(0,f.r)("defaultBasemap")],A.prototype,"readDefaultBasemap",null),(0,r._)([(0,d.Cb)()],A.prototype,"defaultDevBasemap",void 0),(0,r._)([(0,f.r)("defaultDevBasemap")],A.prototype,"readDefaultDevBasemap",null),(0,r._)([(0,d.Cb)({type:g.Z})],A.prototype,"defaultExtent",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"defaultVectorBasemap",void 0),(0,r._)([(0,f.r)("defaultVectorBasemap")],A.prototype,"readDefaultVectorBasemap",null),(0,r._)([(0,d.Cb)()],A.prototype,"description",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"devBasemapGalleryGroupQuery",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"eueiEnabled",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],A.prototype,"extraQuery",null),(0,r._)([(0,d.Cb)()],A.prototype,"featuredGroups",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"featuredItemsGroupQuery",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"galleryTemplatesGroupQuery",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"livingAtlasGroupQuery",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"hasCategorySchema",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"helpBase",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"helperServices",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"helpMap",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"homePageFeaturedContent",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"homePageFeaturedContentCount",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"httpPort",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"httpsPort",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"id",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"ipCntryCode",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],A.prototype,"isOrganization",null),(0,r._)([(0,d.Cb)()],A.prototype,"isPortal",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"isReadOnly",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"layerTemplatesGroupQuery",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"maxTokenExpirationMinutes",void 0),(0,r._)([(0,d.Cb)({type:Date})],A.prototype,"modified",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"name",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"portalHostname",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"portalMode",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"portalProperties",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"region",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],A.prototype,"restUrl",null),(0,r._)([(0,d.Cb)()],A.prototype,"rotatorPanels",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"showHomePageDescription",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"sourceJSON",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"staticImagesUrl",void 0),(0,r._)([(0,d.Cb)({json:{name:"2DStylesGroupQuery"}})],A.prototype,"stylesGroupQuery2d",void 0),(0,r._)([(0,d.Cb)({json:{name:"stylesGroupQuery"}})],A.prototype,"stylesGroupQuery3d",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"supportsHostedServices",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"symbolSetsGroupQuery",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"templatesGroupQuery",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"thumbnail",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],A.prototype,"thumbnailUrl",null),(0,r._)([(0,d.Cb)()],A.prototype,"units",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"url",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"urlKey",void 0),(0,r._)([(0,f.r)("urlKey")],A.prototype,"readUrlKey",null),(0,r._)([(0,d.Cb)()],A.prototype,"user",void 0),(0,r._)([(0,f.r)("user")],A.prototype,"readUser",null),(0,r._)([(0,d.Cb)()],A.prototype,"useStandardizedQuery",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"useVectorBasemaps",void 0),(0,r._)([(0,d.Cb)()],A.prototype,"vectorBasemapGalleryGroupQuery",void 0),A=x=(0,r._)([(0,m.j)("esri.portal.Portal")],A);const M=A},36069:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var r=i(36663),s=i(70375),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283)),l=i(40266),c=i(58874);let u=class extends n.wq{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then((t=>{const i=t.categorySchema||[];return i.some((e=>"contentCategorySetsGroupQuery.LivingAtlas"===e.source))?this._fetchCategorySchemaSet("LivingAtlas",e):i}))}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new s.Z("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=(0,a.se)(c.Z,e);return parseFloat(this.portal.currentVersion)>5?(i=i||new c.Z,this.portal._queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new c.Z,i.query="group:"+this.id+(i.query?" "+i.query:""),this.portal.queryItems(i,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then((e=>{const i=e.contentCategorySetsGroupQuery;if(i){const e=new c.Z;return e.disableExtraQuery=!0,e.num=1,e.query=i,this.portal.queryGroups(e,t)}throw new s.Z("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")})).then((i=>{if(i.total){const r=i.results[0],s=new c.Z;return s.num=1,s.query=`typekeywords:"${e}"`,r.queryItems(s,t)}throw new s.Z("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")})).then((e=>e.total?e.results[0].fetchData("json",t).then((e=>{const t=e&&e.categorySchema;return t&&t.length?t:[]})):[]))}};(0,r._)([(0,o.Cb)()],u.prototype,"access",void 0),(0,r._)([(0,o.Cb)({type:Date})],u.prototype,"created",void 0),(0,r._)([(0,o.Cb)()],u.prototype,"description",void 0),(0,r._)([(0,o.Cb)()],u.prototype,"id",void 0),(0,r._)([(0,o.Cb)()],u.prototype,"isInvitationOnly",void 0),(0,r._)([(0,o.Cb)({type:Date})],u.prototype,"modified",void 0),(0,r._)([(0,o.Cb)()],u.prototype,"owner",void 0),(0,r._)([(0,o.Cb)()],u.prototype,"portal",void 0),(0,r._)([(0,o.Cb)()],u.prototype,"snippet",void 0),(0,r._)([(0,o.Cb)()],u.prototype,"sortField",void 0),(0,r._)([(0,o.Cb)()],u.prototype,"sortOrder",void 0),(0,r._)([(0,o.Cb)()],u.prototype,"tags",void 0),(0,r._)([(0,o.Cb)()],u.prototype,"thumbnail",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],u.prototype,"thumbnailUrl",null),(0,r._)([(0,o.Cb)()],u.prototype,"title",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],u.prototype,"url",null),u=(0,r._)([(0,l.j)("esri.portal.PortalGroup")],u);const h=u},53110:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>A});var r=i(36663),s=i(36567),n=i(70375),o=i(82064),a=i(67134),l=i(68309),c=i(61681),u=i(3466),h=i(81977),d=i(7283),p=i(34248),f=i(40266),m=i(91772),g=i(26869),y=i(53443),_=i(13802),v=(i(7753),i(39994),i(69236));const b=_.Z.getLogger("esri.portal.PortalItemResource");let w=class extends y.Z{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){(0,c.pC)(e)&&(0,u.YP)(e)?b.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if((0,c.Wi)(i))throw new n.Z("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:(0,c.U2)(t,"signal")})}async update(e,t){return(await Promise.resolve().then(i.bind(i,68611))).addOrUpdateResource(this,"update",e,t)}hasPath(){return(0,c.pC)(this.path)}_normalizePath(e,t){return(0,c.Wi)(e)?e:(e=e.replace(/^\/+/,""),(0,c.pC)(t)&&(0,u.YP)(e)&&(e=(0,u.PF)(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};(0,r._)([(0,h.Cb)()],w.prototype,"portalItem",void 0),(0,r._)([(0,h.Cb)({type:String,value:null})],w.prototype,"path",null),(0,r._)([(0,v.p)("path")],w.prototype,"_castPath",null),(0,r._)([(0,h.Cb)({type:String,readOnly:!0})],w.prototype,"url",null),(0,r._)([(0,h.Cb)({type:String,readOnly:!0})],w.prototype,"itemRelativeUrl",null),w=(0,r._)([(0,f.j)("esri.portal.PortalItemResource")],w);const x=w;let C=class extends y.Z{constructor(e){super(e),this.created=null,this.rating=null}};(0,r._)([(0,h.Cb)()],C.prototype,"created",void 0),(0,r._)([(0,h.Cb)()],C.prototype,"rating",void 0),C=(0,r._)([(0,f.j)("esri.portal.PortalRating")],C);const T=C;var S;let E=S=class extends((0,o.eC)(l.Z)){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return(0,d.TJ)(S,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return"Feature Service"===e||"Feature Collection"===e?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":"Image Service"===e?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?i="Scene Layer":"Video Service"===e?i="Video Layer":"Scene Package"===e?i="Scene Layer Package":"Stream Service"===e?i="Feature Layer":"Geoprocessing Service"===e&&this.portal&&this.portal.isPortal?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geocoding Service"===e?i="Locator":"Geoenrichment Service"===e?i="GeoEnrichment Service":"Microsoft Powerpoint"===e?i="Microsoft PowerPoint":"GeoJson"===e?i="GeoJSON":"Globe Service"===e?i="Globe Layer":"Vector Tile Service"===e?i="Tile Layer":"netCDF"===e?i="NetCDF":"Map Service"===e?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?i=e.replace(/(add in)/gi,"Add-In"):"datastore catalog service"===e?i="Big Data File Share":"Compact Tile Package"===e?i="Tile Package (tpkx)":"OGCFeatureServer"===e?i="OGC Feature Layer":"web mapping application"===e&&t.includes("configurableApp")&&(i="Instant App"),i}readExtent(e){return e&&e.length?new m.Z(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[];let i,r=!1,n=!1,o=!1,a=!1,l=!1,c=!1;return e.indexOf("service")>0||"feature collection"===e||"kml"===e||"wms"===e||"wmts"===e||"wfs"===e?(r=t.includes("Hosted Service"),"feature service"===e||"feature collection"===e||"kml"===e||"wfs"===e?(n=t.includes("Table"),o=t.includes("Route Layer"),a=t.includes("Markup"),l=t.includes("Spatiotemporal"),c=t.includes("UtilityNetwork"),i=l&&n?"spatiotemporaltable":n?"table":o?"routelayer":a?"markup":l?"spatiotemporal":r?"featureshosted":c?"utilitynetwork":"features"):i="map service"===e||"wms"===e||"wmts"===e?r||t.includes("Tiled")||"wmts"===e?"maptiles":"mapimages":"scene service"===e?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===e?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===e?"streamlayer":"video service"===e?"mediaservice":"vector tile service"===e?"vectortile":"datastore catalog service"===e?"datastorecollection":"geocoding service"===e?"geocodeservice":"geoprocessing service"===e?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"geodata service"===e?"geodataservice":"layers"):i="web map"===e||"cityengine web scene"===e?"maps":"web scene"===e?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===e&&t.includes("configurableApp")?"instantapps":"web mapping application"===e||"mobile application"===e||"application"===e||"operation view"===e||"desktop application"===e?"apps":"map document"===e||"map package"===e||"published map"===e||"scene document"===e||"globe document"===e||"basemap package"===e||"mobile basemap package"===e||"mobile map package"===e||"project package"===e||"project template"===e||"pro map"===e||"layout"===e||"layer"===e&&t.includes("ArcGIS Pro")||"explorer map"===e&&t.indexOf("Explorer Document")?"mapsgray":"service definition"===e||"csv"===e||"shapefile"===e||"cad drawing"===e||"geojson"===e||"360 vr experience"===e||"netcdf"===e||"administrative report"===e?"datafiles":"explorer add in"===e||"desktop add in"===e||"windows viewer add in"===e||"windows viewer configuration"===e?"appsgray":"arcgis pro add in"===e||"arcgis pro configuration"===e?"addindesktop":"rule package"===e||"file geodatabase"===e||"sqlite geodatabase"===e||"csv collection"===e||"kml collection"===e||"windows mobile package"===e||"map template"===e||"desktop application template"===e||"gml"===e||"arcpad package"===e||"code sample"===e||"form"===e||"document link"===e||"earth configuration"===e||"operations dashboard add in"===e||"rules package"===e||"image"===e||"workflow manager package"===e||"explorer map"===e&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":"network analysis service"===e||"geoprocessing service"===e||"geodata service"===e||"geometry service"===e||"geoprocessing package"===e||"locator package"===e||"geoprocessing sample"===e||"workflow manager service"===e?"toolsgray":"layer"===e||"layer package"===e||"explorer layer"===e?"layersgray":"scene package"===e?"scenepackage":"mobile scene package"===e?"mobilescenepackage":"tile package"===e||"compact tile package"===e?"tilepackage":"task file"===e?"taskfile":"report template"===e?"report-template":"statistical data collection"===e?"statisticaldatacollection":"insights workbook"===e?"workbook":"insights model"===e?"insightsmodel":"insights page"===e?"insightspage":"insights theme"===e?"insightstheme":"hub initiative"===e?"hubinitiative":"hubpage"===e?"hubpage":"hub event"===e?"hubevent":"hub site application"===e?"hubsite":"hub project"===e?"hubproject":"relational database connection"===e?"relationaldatabaseconnection":"big data file share"===e?"datastorecollection":"image collection"===e?"imagecollection":"style"===e?"style":"desktop style"===e?"desktopstyle":"dashboard"===e?"dashboard":"raster function template"===e?"rasterprocessingtemplate":"vector tile package"===e?"vectortilepackage":"ortho mapping project"===e?"orthomappingproject":"ortho mapping template"===e?"orthomappingtemplate":"solution"===e?"solutions":"geopackage"===e?"geopackage":"deep learning package"===e?"deeplearningpackage":"real time analytic"===e?"realtimeanalytics":"big data analytic"===e?"bigdataanalytics":"feed"===e?"feed":"excalibur imagery project"===e?"excaliburimageryproject":"notebook"===e?"notebook":"storymap"===e?"storymap":"survey123 add in"===e?"survey123addin":"mission"===e?"mission":"mission report"===e?"missionreport":"quickcapture project"===e?"quickcaptureproject":"pro report"===e?"proreport":"urban model"===e?"urbanmodel":"web experience"===e?"experiencebuilder":"web experience template"===e?"webexperiencetemplate":"experience builder widget"===e?"experiencebuilderwidget":"experience builder widget package"===e?"experiencebuilderwidgetpackage":"workflow"===e?"workflow":"insights script"===e?"insightsscript":"kernel gateway connection"===e?"kernelgatewayconnection":"hub initiative template"===e?"hubinitiativetemplate":"storymap theme"===e?"storymaptheme":"knowledge graph"===e?"knowledgegraph":"native application"===e?"nativeapp":"native application installer"===e?"nativeappinstaller":"link chart"===e?"linkchart":"investigation"===e?"investigation":"ogcfeatureserver"===e?"features":"pro project"===e?"proproject":"insights workbook package"===e?"insightsworkbookpackage":"apache parquet"===e?"apacheparquet":"notebook code snippets"===e?"notebookcodesnippets":"suitability model"===e?"suitabilitymodel":"esri classifier definition"===e?"classifierdefinition":"esri classification schema"===e?"classificationschema":"insights data engineering workbook"===e?"dataengineeringworkbook":"insights data engineering model"===e?"dataengineeringmodel":"deep learning studio project"===e?"deeplearningproject":"maps",i?(0,s.V)("esri/images/portal/"+i+"16.png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const e=this.get("portal.restUrl");return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=g.Z.getDefault());const t=this.portal.load(e).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:(0,c.pC)(e)?e.signal:null,query:{token:this.apiKey}}):{})).then((e=>{this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof T&&(e=e.rating),isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then((()=>new T({rating:e,created:new Date})))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:(0,a.d9)(this.applicationProxies),avgRating:this.avgRating,categories:(0,a.d9)(this.categories),created:(0,a.d9)(this.created),culture:this.culture,description:this.description,extent:(0,a.d9)(this.extent),groupCategories:(0,a.d9)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:(0,a.d9)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:(0,a.d9)(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:(0,a.d9)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.d9)(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new S({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const t of["tags","typeKeywords","categories"])e[t]&&(e[t]=e[t].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then((()=>{}))}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e}).then((e=>null!=e.rating?(e.created=new Date(e.created),new T(e)):null))}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},S)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then((e=>(this.sourceJSON=e,this.read(e),this)))}update(e){return this.id?this.load().then((()=>this.portal._signIn())).then((()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const e in i.query)null===i.query[e]&&(i.query[e]="");return i.query.clearEmptyFields=!0,null!=t&&("string"==typeof t?i.query.text=t:"object"==typeof t&&(i.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,i).then((()=>this.reload()))})):Promise.reject(new n.Z("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then((()=>this.portal._signIn())).then((()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if("string"==typeof t)(0,u.HK)(t)?r.query={data:t}:r.query={url:(0,u.hF)(t)},(0,c.pC)(i)&&(r.query.filename=i);else{const e=new FormData;(0,c.pC)(i)?e.append("file",t,i):e.append("file",t),r.body=e}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,r).then((()=>this.reload()))})):Promise.reject(new n.Z("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await Promise.resolve().then(i.bind(i,68611))).fetchResources(this,e,t)}async addResource(e,t,r){const s=await Promise.resolve().then(i.bind(i,68611));return e.portalItem=this,s.addOrUpdateResource(e,"add",t,r)}async removeResource(e,t){const r=await Promise.resolve().then(i.bind(i,68611));if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new n.Z("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r.removeResource(this,e,t)}async removeAllResources(e){return(await Promise.resolve().then(i.bind(i,68611))).removeAllResources(this,e)}resourceFromPath(e){return new x({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:(0,a.d9)(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:(0,a.d9)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.d9)(this.typeKeywords),url:this.url};return(0,a.yd)(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new S({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};(0,r._)([(0,h.Cb)({type:["private","shared","org","public"]})],E.prototype,"access",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"accessInformation",void 0),(0,r._)([(0,h.Cb)({type:String})],E.prototype,"apiKey",void 0),(0,r._)([(0,h.Cb)({json:{read:{source:"appProxies"}}})],E.prototype,"applicationProxies",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"avgRating",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"categories",void 0),(0,r._)([(0,h.Cb)({type:Date})],E.prototype,"created",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"culture",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"description",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],E.prototype,"displayName",null),(0,r._)([(0,h.Cb)({type:m.Z})],E.prototype,"extent",void 0),(0,r._)([(0,p.r)("extent")],E.prototype,"readExtent",null),(0,r._)([(0,h.Cb)()],E.prototype,"groupCategories",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],E.prototype,"iconUrl",null),(0,r._)([(0,h.Cb)()],E.prototype,"id",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],E.prototype,"isLayer",null),(0,r._)([(0,h.Cb)()],E.prototype,"itemControl",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],E.prototype,"itemUrl",null),(0,r._)([(0,h.Cb)()],E.prototype,"licenseInfo",void 0),(0,r._)([(0,h.Cb)({type:Date})],E.prototype,"modified",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"name",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"numComments",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"numRatings",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"numViews",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"owner",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"ownerFolder",void 0),(0,r._)([(0,h.Cb)({type:g.Z})],E.prototype,"portal",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"screenshots",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"size",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"snippet",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"sourceJSON",void 0),(0,r._)([(0,h.Cb)({type:String})],E.prototype,"spatialReference",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"tags",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"thumbnail",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],E.prototype,"thumbnailUrl",null),(0,r._)([(0,h.Cb)()],E.prototype,"title",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"type",void 0),(0,r._)([(0,h.Cb)()],E.prototype,"typeKeywords",void 0),(0,r._)([(0,h.Cb)({type:String,json:{read(e,t){if("KML"!==t.type)return e;const i=this.portal?.restUrl;return e||(e=i&&this.id?`${i}/content/items/${this.id}/data`:null),e}}})],E.prototype,"url",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],E.prototype,"userItemUrl",null),E=S=(0,r._)([(0,f.j)("esri.portal.PortalItem")],E);const A=E},58874:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r,s=i(36663),n=i(53443),o=i(25709),a=i(67134),l=i(61681),c=i(81977),u=(i(7283),i(40266)),h=i(91772),d=i(14685),p=i(39536);const f=new o.X({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let m=r=class extends n.Z{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){"asc"!==e&&"desc"!==e||this._set("sortOrder",e)}clone(){return new r({categories:this.categories?(0,a.d9)(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i,r;if(this.categories&&(i=this.categories.map((e=>Array.isArray(e)?JSON.stringify(e):e))),this.extent){const e=(0,p.iV)(this.extent,d.Z.WGS84);(0,l.pC)(e)&&(r=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map((e=>f.toJSON(e.trim()))).join(","),n.sortOrder=this.sortOrder),{query:{...t,...n}}}};(0,s._)([(0,c.Cb)()],m.prototype,"categories",void 0),(0,s._)([(0,c.Cb)()],m.prototype,"disableExtraQuery",void 0),(0,s._)([(0,c.Cb)({type:h.Z})],m.prototype,"extent",void 0),(0,s._)([(0,c.Cb)()],m.prototype,"filter",void 0),(0,s._)([(0,c.Cb)()],m.prototype,"num",void 0),(0,s._)([(0,c.Cb)()],m.prototype,"query",void 0),(0,s._)([(0,c.Cb)()],m.prototype,"sortField",void 0),(0,s._)([(0,c.Cb)()],m.prototype,"sortOrder",null),(0,s._)([(0,c.Cb)()],m.prototype,"start",void 0),m=r=(0,s._)([(0,u.j)("esri.portal.PortalQueryParams")],m);const g=m},90298:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var r=i(36663),s=i(70375),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=class extends n.wq{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new s.Z("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};(0,r._)([(0,o.Cb)({type:Date})],l.prototype,"created",void 0),(0,r._)([(0,o.Cb)()],l.prototype,"id",void 0),(0,r._)([(0,o.Cb)()],l.prototype,"portal",void 0),(0,r._)([(0,o.Cb)()],l.prototype,"title",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],l.prototype,"url",null),(0,r._)([(0,o.Cb)()],l.prototype,"username",void 0),l=(0,r._)([(0,a.j)("esri.portal.PortalFolder")],l);const c=l;var u,h=i(36069);let d=u=class extends n.wq{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),null!=i&&("string"==typeof i?s.query.text=i:"object"==typeof i&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+("string"==typeof r?r:r.id)),this.portal._request(n+"/addItem",s).then((e=>(t.id=e.id,t.portal=this.portal,t.loaded?t.reload():t.load())))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then((()=>{e.id=null,e.portal=null}))}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map((e=>e.id));if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal._request(t,r).then((()=>{e.forEach((e=>{e.id=null,e.portal=null}))}))}return Promise.resolve(void 0)}fetchFolders(){return this.portal._request(this.userContentUrl,{query:{num:1}}).then((e=>{let t;return t=e&&e.folders?e.folders.map((e=>{const t=c.fromJSON(e);return t.portal=this.portal,t})):[],t}))}fetchGroups(){return this.portal._request(this.url).then((e=>{let t;return t=e&&e.groups?e.groups.map((e=>{const t=h.default.fromJSON(e);return t.portal=this.portal,t})):[],t}))}fetchItems(e){e||(e={});let t,r=this.userContentUrl;return e.folder&&(r+="/"+e.folder.id),Promise.resolve().then(i.bind(i,53110)).then((({default:i})=>{t=i;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(r,{query:s})})).then((e=>{let i;return e&&e.items?(i=e.items.map((e=>{const i=t.fromJSON(e);return i.portal=this.portal,i})),Promise.all(i.map((e=>e.load()))).catch((e=>e)).then((()=>({items:i,nextStart:e.nextStart,total:e.total})))):{items:[],nextStart:-1,total:0}}))}fetchTags(){return this.portal._request(this.url+"/tags").then((e=>e.tags))}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new h.default({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new s.Z("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new s.Z("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new u;return t.sourceJSON=e,t.read(e),t}};(0,r._)([(0,o.Cb)()],d.prototype,"access",void 0),(0,r._)([(0,o.Cb)({type:Date})],d.prototype,"created",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"culture",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"description",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"email",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"favGroupId",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"fullName",void 0),(0,r._)([(0,o.Cb)({type:Date})],d.prototype,"modified",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"orgId",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"portal",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"preferredView",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"privileges",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"region",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"role",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"roleId",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"sourceJSON",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"thumbnail",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],d.prototype,"thumbnailUrl",null),(0,r._)([(0,o.Cb)()],d.prototype,"units",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],d.prototype,"userContentUrl",null),(0,r._)([(0,o.Cb)({readOnly:!0})],d.prototype,"url",null),(0,r._)([(0,o.Cb)()],d.prototype,"username",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"userType",void 0),d=u=(0,r._)([(0,a.j)("esri.portal.PortalUser")],d);const p=d},8060:(e,t,i)=>{"use strict";i.r(t),i.d(t,{getGeometryServiceURL:()=>l,projectGeometry:()=>c});var r=i(51366),s=i(70375),n=i(26869),o=i(73630),a=i(41268);async function l(e=null,t){if(r.Z.geometryServiceUrl)return r.Z.geometryServiceUrl;if(!e)throw new s.Z("internal:geometry-service-url-not-configured");let i;i="portal"in e?e.portal||n.Z.getDefault():e,await i.load({signal:t});const o=i.helperServices?.geometry?.url;if(!o)throw new s.Z("internal:geometry-service-url-not-configured");return o}async function c(e,t,i=null,r){const n=await l(i,r),c=new a.Z;c.geometries=[e],c.outSpatialReference=t;const u=await(0,o.i)(n,c,{signal:r});if(u&&Array.isArray(u)&&1===u.length)return u[0];throw new s.Z("internal:geometry-service-projection-failed")}},68611:(e,t,i)=>{"use strict";i.r(t),i.d(t,{addOrUpdateResource:()=>l,contentToBlob:()=>p,fetchResources:()=>a,getSiblingOfSameType:()=>f,getSiblingOfSameTypeI:()=>m,removeAllResources:()=>u,removeResource:()=>c,splitPrefixFileNameAndExtension:()=>d});var r=i(66341),s=i(70375),n=i(61681),o=i(3466);async function a(e,t={},i){await e.load(i);const r=(0,o.v_)(e.itemUrl,"resources"),{start:s=1,num:a=10,sortOrder:l="asc",sortField:c="created"}=t,u={query:{start:s,num:a,sortOrder:l,sortField:c,token:e.apiKey},signal:(0,n.U2)(i,"signal")},h=await e.portal._request(r,u);return{total:h.total,nextStart:h.nextStart,resources:h.resources.map((({created:t,size:i,resource:r})=>({created:new Date(t),size:i,resource:e.resourceFromPath(r)})))}}async function l(e,t,i,r){if(!e.hasPath())throw new s.Z(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const a=e.portalItem;await a.load(r);const l=(0,o.v_)(a.userItemUrl,"add"===t?"addResources":"updateResources"),[c,u]=h(e.path),d=await p(i),f=new FormData;return c&&"."!==c&&f.append("resourcesPrefix",c),f.append("fileName",u),f.append("file",d,u),f.append("f","json"),(0,n.pC)(r)&&r.access&&f.append("access",r.access),await a.portal._request(l,{method:"post",body:f,signal:(0,n.U2)(r,"signal")}),e}async function c(e,t,i){if(!t.hasPath())throw new s.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(i);const r=(0,o.v_)(e.userItemUrl,"removeResources");await e.portal._request(r,{method:"post",query:{resource:t.path},signal:(0,n.U2)(i,"signal")}),t.portalItem=null}async function u(e,t){await e.load(t);const i=(0,o.v_)(e.userItemUrl,"removeResources");return e.portal._request(i,{method:"post",query:{deleteAll:!0},signal:(0,n.U2)(t,"signal")})}function h(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function d(e){const[t,i]=function(e){const t=(0,o.Ml)(e);return(0,n.Wi)(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[r,s]=h(t);return[r,s,i]}async function p(e){return e instanceof Blob?e:(await(0,r.default)(e.url,{responseType:"blob"})).data}function f(e,t){if(!e.hasPath())return null;const[i,,r]=d(e.path);return e.portalItem.resourceFromPath((0,o.v_)(i,t+r))}function m(e,t){if(!e.hasPath())return null;const[i,,r]=d(e.path);return e.portalItem.resourceFromPath((0,o.v_)(i,t+r))}},80680:(e,t,i)=>{"use strict";i.d(t,{v:()=>r});const r=(0,i(25709).w)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},86004:(e,t,i)=>{"use strict";i.d(t,{Z:()=>R});var r,s=i(36663),n=i(4905),o=i(25709),a=i(67134),l=i(13802),c=i(61681),u=i(81977),h=i(69236),d=i(79438),p=i(34248),f=i(40266),m=i(39835),g=i(7283),y=i(17095),_=i(22836),v=i(68411),b=i(24326),w=i(99520),x=i(24794),C=i(30879);const T=l.Z.getLogger("esri.renderers.ClassBreaksRenderer"),S="percent-of-total",E="field",A=new o.X({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:S,esriNormalizeByField:E}),M=(0,g.se)(b.Z);let O=r=class extends((0,v.W)(_.Z)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map((e=>{const t=new b.Z;return t.read(e,i),null==t.minValue&&(t.minValue=r),null==t.maxValue&&(t.maxValue=t.minValue),r=t.maxValue,t}))}writeClassBreakInfos(e,t,i,r){const s=e.map((e=>e.write({},r)));this._areClassBreaksConsecutive()&&s.forEach((e=>delete e.classMinValue)),t[i]=s}castField(e){return null==e?e:"function"==typeof e?(T.error(".field: field must be a string value"),null):(0,g.Zs)(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=null!=this.normalizationTotal;return t||i?(e=(t?E:i&&S)||null,t&&i&&T.warn("warning: both normalizationField and normalizationTotal are set!")):e!==E&&e!==S||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r="number"==typeof e?new b.Z({minValue:e,maxValue:t,symbol:(0,n.se)(i)}):M((0,a.d9)(e)),this.classBreakInfos.push(r),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]===e&&i[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&((0,c.Wi)(t)||(0,c.Wi)(t.arcade))&&T.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&((0,c.Wi)(t)||(0,c.Wi)(t.arcade))&&(i={...i,arcade:await(0,C.LC)()});const r=this.getBreakIndex(e,i);return-1!==r?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&((0,c.Wi)(t)||(0,c.Wi)(t.arcade)))return void T.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&((0,c.Wi)(t)||(0,c.Wi)(t.arcade))){const e=await(0,C.LC)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),i={...i,arcade:e}}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new r({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:(0,a.d9)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:(0,a.d9)(this.visualVariables),legendOptions:(0,a.d9)(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map((i=>i.collectRequiredFields(e,t))),(0,y.io)(e,t,this.valueExpression)];(0,y.AB)(e,t,this.field),(0,y.AB)(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=(0,c.Pt)(t,{});let o=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=(0,c.Wg)(n).arcadeUtils;if(!o){const e=a.createSyntaxTree(this.valueExpression);o=a.createFunction(e),this._compiledValueExpression.compiledFunction=o}this._compiledValueExpression.valueExpression=this.valueExpression;const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const e=this.normalizationTotal,t=parseFloat(i[this.normalizationField]);if("log"===r)s=Math.log(s)*Math.LOG10E;else if(r!==S||isNaN(e)){if(r===E&&!isNaN(t)){if(isNaN(s)||isNaN(t))return-1;s/=t}}else s=s/e*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};(0,s._)([(0,u.Cb)(w.K)],O.prototype,"backgroundFillSymbol",void 0),(0,s._)([(0,u.Cb)({type:[b.Z]})],O.prototype,"classBreakInfos",void 0),(0,s._)([(0,p.r)("classBreakInfos")],O.prototype,"readClassBreakInfos",null),(0,s._)([(0,m.c)("classBreakInfos")],O.prototype,"writeClassBreakInfos",null),(0,s._)([(0,u.Cb)({type:String,json:{write:!0}})],O.prototype,"defaultLabel",void 0),(0,s._)([(0,u.Cb)(w.G)],O.prototype,"defaultSymbol",void 0),(0,s._)([(0,u.Cb)({type:String,json:{write:!0}})],O.prototype,"field",void 0),(0,s._)([(0,h.p)("field")],O.prototype,"castField",null),(0,s._)([(0,u.Cb)({type:Boolean})],O.prototype,"isMaxInclusive",void 0),(0,s._)([(0,u.Cb)({type:x.I,json:{write:!0}})],O.prototype,"legendOptions",void 0),(0,s._)([(0,u.Cb)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],O.prototype,"minValue",null),(0,s._)([(0,u.Cb)({type:String,json:{write:!0}})],O.prototype,"normalizationField",void 0),(0,s._)([(0,u.Cb)({type:Number,cast:e=>(0,g.q9)(e),json:{write:!0}})],O.prototype,"normalizationTotal",void 0),(0,s._)([(0,u.Cb)({type:A.apiValues,value:null,json:{type:A.jsonValues,read:A.read,write:A.write}})],O.prototype,"normalizationType",null),(0,s._)([(0,d.J)({classBreaks:"class-breaks"})],O.prototype,"type",void 0),(0,s._)([(0,u.Cb)({type:String,json:{write:!0}})],O.prototype,"valueExpression",void 0),(0,s._)([(0,u.Cb)({type:String,json:{write:!0}})],O.prototype,"valueExpressionTitle",void 0),O=r=(0,s._)([(0,f.j)("esri.renderers.ClassBreaksRenderer")],O);const R=O},45510:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r,s=i(36663),n=i(67134),o=i(81977),a=(i(7283),i(40266)),l=i(39835),c=i(17095),u=i(22836),h=i(68411),d=i(47597);let p=r=class extends((0,h.W)(u.Z)){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new d.DictionaryLoader(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){r?.origin||super.writeVisualVariables(e,t,i,r)}clone(){return new r({config:(0,n.d9)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:(0,n.d9)(this.fieldMap),url:(0,n.d9)(this.url),visualVariables:(0,n.d9)(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await(0,c.io)(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};(0,s._)([(0,o.Cb)({type:d.DictionaryLoader})],p.prototype,"_loader",null),(0,s._)([(0,o.Cb)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],p.prototype,"config",void 0),(0,s._)([(0,o.Cb)({type:Object,json:{write:!0}})],p.prototype,"fieldMap",void 0),(0,s._)([(0,o.Cb)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],p.prototype,"scaleExpression",void 0),(0,s._)([(0,l.c)("scaleExpression")],p.prototype,"writeData",null),(0,s._)([(0,o.Cb)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],p.prototype,"scaleExpressionTitle",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],p.prototype,"url",void 0),(0,s._)([(0,l.c)("visualVariables")],p.prototype,"writeVisualVariables",null),p=r=(0,s._)([(0,a.j)("esri.renderers.DictionaryRenderer")],p);const f=p},16192:(e,t,i)=>{"use strict";i.d(t,{Z:()=>x});var r,s=i(36663),n=i(30936),o=i(67134),a=i(42730),l=(i(7283),i(79438)),c=i(81977),u=i(40266),h=i(17095),d=i(22836),p=i(68411),f=i(41344),m=i(82064);i(7753),i(39994);let g=r=class extends m.wq{constructor(){super(...arguments),this.unit=null}clone(){return new r({unit:this.unit})}};(0,s._)([(0,c.Cb)({type:String,json:{write:!0}})],g.prototype,"unit",void 0),g=r=(0,s._)([(0,u.j)("esri.renderers.support.DotDensityLegendOptions")],g);const y=g;var _,v=i(43411),b=i(15498);let w=_=class extends((0,p.W)(d.Z)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new n.Z([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new b.Z,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new v.Z({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new _({attributes:(0,o.d9)(this.attributes),backgroundColor:(0,o.d9)(this.backgroundColor),dotBlendingEnabled:(0,o.d9)(this.dotBlendingEnabled),dotShape:(0,o.d9)(this.dotShape),dotSize:(0,o.d9)(this.dotSize),dotValue:(0,o.d9)(this.dotValue),legendOptions:(0,o.d9)(this.legendOptions),outline:(0,o.d9)(this.outline),referenceScale:(0,o.d9)(this.referenceScale),visualVariables:(0,o.d9)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map((e=>e.field||e.valueExpression||""))}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await(0,h.io)(e,t,i.valueExpression),i.field&&e.add(i.field)}};(0,s._)([(0,c.Cb)({type:[f.Z],json:{write:!0}})],w.prototype,"attributes",void 0),(0,s._)([(0,c.Cb)({type:n.Z,json:{write:!0}})],w.prototype,"backgroundColor",void 0),(0,s._)([(0,c.Cb)({type:Boolean}),(0,a.B)("dotBlendingEnabled")],w.prototype,"blendDots",void 0),(0,s._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],w.prototype,"dotBlendingEnabled",void 0),(0,s._)([(0,c.Cb)({type:String,json:{write:!1}})],w.prototype,"dotShape",void 0),(0,s._)([(0,c.Cb)({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],w.prototype,"dotSize",void 0),(0,s._)([(0,c.Cb)({type:y,json:{write:!0}})],w.prototype,"legendOptions",void 0),(0,s._)([(0,c.Cb)({type:b.Z,json:{default:null,write:!0}})],w.prototype,"outline",void 0),(0,s._)([(0,c.Cb)({type:Number,json:{write:!0}})],w.prototype,"dotValue",void 0),(0,s._)([(0,c.Cb)({type:Number}),(0,a.B)("dotValue")],w.prototype,"referenceDotValue",void 0),(0,s._)([(0,c.Cb)({type:Number,json:{write:!0}})],w.prototype,"referenceScale",void 0),(0,s._)([(0,c.Cb)({type:Number,json:{write:!0}})],w.prototype,"seed",void 0),(0,s._)([(0,l.J)({dotDensity:"dot-density"})],w.prototype,"type",void 0),w=_=(0,s._)([(0,u.j)("esri.renderers.DotDensityRenderer")],w);const x=w},71297:(e,t,i)=>{"use strict";i.d(t,{Z:()=>A});var r=i(36663),s=i(30936),n=(i(4905),i(59801)),o=i(67134),a=i(13802),l=i(17262),c=i(95550),u=i(81977),h=i(95620),d=(i(7283),i(79438)),p=i(40266),f=i(17095),m=i(22836),g=i(95187),y=i(7541),_=i(41151),v=i(82064);i(7753),i(39994);let b=class extends((0,_.J)(v.wq)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};(0,r._)([(0,u.Cb)({type:String,json:{write:!0}})],b.prototype,"minLabel",void 0),(0,r._)([(0,u.Cb)({type:String,json:{write:!0}})],b.prototype,"maxLabel",void 0),(0,r._)([(0,u.Cb)({type:String,json:{write:!0}})],b.prototype,"title",void 0),b=(0,r._)([(0,p.j)("esri.renderers.support.HeatmapLegendOptions")],b);var w,x=i(94672),C=i(1759);const T=a.Z.getLogger("esri.renderers.HeatmapRenderer");function S(e){if(null!=e){const{maxDensity:t,minDensity:i,radius:r}=e;if(null!=t||null!=i||null!=r){const{blurRadius:t,maxPixelIntensity:i,minPixelIntensity:r,...s}=e;return s}}return e}let E=w=class extends m.Z{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new y.Z({ratio:0,color:new s.Z("rgba(255, 140, 0, 0)")}),new y.Z({ratio:.75,color:new s.Z("rgba(255, 140, 0, 1)")}),new y.Z({ratio:.9,color:new s.Z("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return S(e)}get blurRadius(){return(0,x.AJ)(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",(0,x.k0)(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(x.nu**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||"user"===(0,h.vw)(this).getDefaultOrigin()&&(this._warnedProps[e]=!0,(0,l.Os)((()=>{(0,n.Mr)(T,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})})))}read(e,t){e=S(e),super.read(e,t)}getSymbol(){const e=0!==this.referenceScale?5:1,t=Math.min(this.radius*e,(0,c.Wz)(256));return new C.Z({size:t})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,r=this.valueExpression;i&&"string"==typeof i&&await(0,f.AB)(e,t,i),r&&"string"==typeof r&&await(0,f.io)(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new w({colorStops:(0,o.d9)(this.colorStops),field:this.field,legendOptions:(0,o.d9)(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,r._)([(0,u.Cb)({type:g.Z,json:{write:!1}})],E.prototype,"authoringInfo",void 0),(0,r._)([(0,u.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],E.prototype,"blurRadius",null),(0,r._)([(0,u.Cb)({type:[y.Z],json:{write:!0}})],E.prototype,"colorStops",void 0),(0,r._)([(0,u.Cb)({type:String,json:{write:!0}})],E.prototype,"field",void 0),(0,r._)([(0,u.Cb)({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:null==i})},origins:{"web-scene":{write:!1}}}})],E.prototype,"fieldOffset",void 0),(0,r._)([(0,u.Cb)({type:b,json:{write:!0}})],E.prototype,"legendOptions",void 0),(0,r._)([(0,u.Cb)({type:Number,json:{write:!0}})],E.prototype,"maxDensity",void 0),(0,r._)([(0,u.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],E.prototype,"maxPixelIntensity",null),(0,r._)([(0,u.Cb)({type:Number,json:{write:!0}})],E.prototype,"minDensity",void 0),(0,r._)([(0,u.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],E.prototype,"minPixelIntensity",null),(0,r._)([(0,u.Cb)({type:Number,cast:c.t_,json:{write:!0}})],E.prototype,"radius",void 0),(0,r._)([(0,u.Cb)({type:Number,range:{min:0},json:{default:0,write:!0}})],E.prototype,"referenceScale",void 0),(0,r._)([(0,d.J)({heatmap:"heatmap"})],E.prototype,"type",void 0),(0,r._)([(0,u.Cb)({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],E.prototype,"valueExpression",void 0),(0,r._)([(0,u.Cb)({type:String})],E.prototype,"valueExpressionTitle",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],E.prototype,"_pixelIntensityToDensity",null),E=w=(0,r._)([(0,p.j)("esri.renderers.HeatmapRenderer")],E);const A=E},878:(e,t,i)=>{"use strict";i.d(t,{Z:()=>w});var r=i(36663),s=i(30936),n=(i(4905),i(41151)),o=i(95550),a=i(81977),l=(i(7753),i(39994),i(7283),i(79438)),c=i(40266),u=i(17095),h=i(22836),d=i(68411),p=i(41344),f=i(82064);let m=class extends((0,n.J)(f.wq)){constructor(){super(...arguments),this.color=new s.Z([0,0,0,0]),this.label=null,this.threshold=0}};(0,r._)([(0,a.Cb)({type:s.Z,json:{write:!0}})],m.prototype,"color",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],m.prototype,"label",void 0),(0,r._)([(0,a.Cb)({type:Number,range:{min:0,max:1},json:{write:!0}})],m.prototype,"threshold",void 0),m=(0,r._)([(0,c.j)("esri.renderers.support.OthersCategory")],m);let g=class extends((0,n.J)(f.wq)){constructor(){super(...arguments),this.title=null}};(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],g.prototype,"title",void 0),g=(0,r._)([(0,c.j)("esri.renderers.support.PieChartLegendOptions")],g);var y=i(1759),_=i(43411),v=i(15498);let b=class extends((0,d.W)((0,n.J)(h.Z))){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new s.Z([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new m,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new y.Z({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await(0,u.io)(e,t,i.valueExpression),i.field&&e.add(i.field)}};(0,r._)([(0,a.Cb)({type:[p.Z],json:{write:!0}})],b.prototype,"attributes",void 0),(0,r._)([(0,a.Cb)({type:_.Z,json:{default:null,write:!0}})],b.prototype,"backgroundFillSymbol",void 0),(0,r._)([(0,a.Cb)({type:s.Z,json:{write:!0}})],b.prototype,"defaultColor",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],b.prototype,"defaultLabel",void 0),(0,r._)([(0,a.Cb)({type:Number,range:{min:0,max:1},json:{write:!0}})],b.prototype,"holePercentage",void 0),(0,r._)([(0,a.Cb)({type:m,json:{write:!0}})],b.prototype,"othersCategory",void 0),(0,r._)([(0,a.Cb)({type:g,json:{write:!0}})],b.prototype,"legendOptions",void 0),(0,r._)([(0,a.Cb)({type:v.Z,json:{default:null,write:!0}})],b.prototype,"outline",void 0),(0,r._)([(0,a.Cb)({type:Number,cast:o.t_,json:{write:!0}})],b.prototype,"size",void 0),(0,r._)([(0,l.J)({pieChart:"pie-chart"})],b.prototype,"type",void 0),b=(0,r._)([(0,c.j)("esri.renderers.PieChartRenderer")],b);const w=b},22836:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r=i(36663),s=i(25709),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(95187);const c=new s.X({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let u=class extends n.wq{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};(0,r._)([(0,o.Cb)({type:l.Z,json:{write:!0}})],u.prototype,"authoringInfo",void 0),(0,r._)([(0,o.Cb)({type:c.apiValues,readOnly:!0,json:{type:c.jsonValues,read:!1,write:{writer:c.write,ignoreOrigin:!0}}})],u.prototype,"type",void 0),u=(0,r._)([(0,a.j)("esri.renderers.Renderer")],u);const h=u},50172:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r,s=i(36663),n=i(67134),o=i(81977),a=(i(7283),i(79438)),l=i(40266),c=i(22836),u=i(68411),h=i(99520);let d=r=class extends((0,u.W)(c.Z)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map((i=>i.collectRequiredFields(e,t))))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new r({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:(0,n.d9)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],d.prototype,"description",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,s._)([(0,o.Cb)(h.G)],d.prototype,"symbol",void 0),(0,s._)([(0,a.J)({simple:"simple"})],d.prototype,"type",void 0),d=r=(0,s._)([(0,l.j)("esri.renderers.SimpleRenderer")],d);const p=d},25634:(e,t,i)=>{"use strict";i.d(t,{Z:()=>L});var r,s=i(36663),n=i(4905),o=i(70375),a=i(67134),l=i(13802),c=i(61681),u=i(86745),h=i(81977),d=i(69236),p=i(79438),f=i(34248),m=i(40266),g=i(39835),y=i(27281),_=i(7283),v=i(17095),b=i(26869),w=i(22836),x=i(68411),C=i(99520),T=i(24794),S=i(19946),E=i(30879),A=i(16641),M=i(11644),O=i(27948);const R=l.Z.getLogger("esri.renderers.UniqueValueRenderer"),P=(0,_.se)(S.Z);let I=r=class extends((0,x.W)(w.Z)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let i=!1;const r={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<t.length;s++){const n=e.find((e=>e.value===t[s].value));n?(0,y.Hg)(n,t[s])?(r.changed.push({type:"complete",oldValue:n,newValue:t[s]}),i=!0):r.unchanged.push({oldValue:n,newValue:t[s]}):(r.added.push(t[s]),i=!0)}for(let s=0;s<e.length;s++)t.find((t=>t.value===e[s].value))||(r.removed.push(e[s]),i=!0);return i?r:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return null==e||"function"==typeof e?e:(0,_.Zs)(e)}writeField(e,t,i,r){"string"==typeof e?t[i]=e:r&&r.messages?r.messages.push(new o.Z("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):R.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,i){return i.portal||b.Z.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=(0,A.f)(t.styleUrl,i);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=(0,A.t)(e.styleUrl,r))}set uniqueValueInfos(e){this.styleOrigin?R.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void R.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i="object"==typeof e?P(e):new S.Z({value:e,symbol:(0,n.se)(t)}),this.uniqueValueInfos.push(i),this._valueInfoMap[i.value]=i}removeUniqueValueInfo(e){if(this.styleOrigin)R.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&((0,c.Wi)(t)||(0,c.Wi)(t.arcade))&&(i={...i,arcade:await(0,E.LC)()}),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&((0,c.Wi)(t)||(0,c.Wi)(t.arcade)))return void R.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&((0,c.Wi)(i)||(0,c.Wi)(i.arcade))){const e=await(0,E.LC)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),i={...i,arcade:e}}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new r({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:(0,a.d9)(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:(0,a.d9)(this.visualVariables),legendOptions:(0,a.d9)(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:(0,a.d9)(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=(0,a.d9)(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze((0,a.d9)(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map((i=>i.collectRequiredFields(e,t))),(0,v.io)(e,t,this.valueExpression)];(0,v.AB)(e,t,this.field),(0,v.AB)(e,t,this.field2),(0,v.AB)(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return(0,M.n2)(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach((i=>{const r=new O.Z({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new S.Z({value:i.name,symbol:r});t.push(s),this._valueInfoMap[i.name]=s})),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach((e=>this._valueInfoMap[e.value+""]=e))}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=(0,c.Pt)(t,{});let o=this._cache.compiledFunc;const a=(0,c.Wg)(n).arcadeUtils;if(!o){const e=a.createSyntaxTree(this.valueExpression);o=a.createFunction(e),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if("function"!=typeof t&&this.field2){const e=this.field2,s=this.field3,n=[];t&&n.push(i[t]),e&&n.push(i[e]),s&&n.push(i[s]),r=n.join(this.fieldDelimiter||"")}else"function"==typeof t?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new r(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||b.Z.getDefault());const s=i.populateFromStyle();return s.catch((t=>{R.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),s}static fromStyleUrl(e,t){const i=new r(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const s=i.populateFromStyle();return s.catch((t=>{R.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),s}};(0,s._)([(0,h.Cb)({readOnly:!0})],I.prototype,"_cache",null),(0,s._)([(0,p.J)({uniqueValue:"unique-value"})],I.prototype,"type",void 0),(0,s._)([(0,h.Cb)(C.K)],I.prototype,"backgroundFillSymbol",void 0),(0,s._)([(0,h.Cb)({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],I.prototype,"field",void 0),(0,s._)([(0,d.p)("field")],I.prototype,"castField",null),(0,s._)([(0,g.c)("field")],I.prototype,"writeField",null),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],I.prototype,"field2",void 0),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],I.prototype,"field3",void 0),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],I.prototype,"valueExpression",void 0),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],I.prototype,"valueExpressionTitle",void 0),(0,s._)([(0,h.Cb)({type:T.I,json:{write:!0}})],I.prototype,"legendOptions",void 0),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],I.prototype,"defaultLabel",void 0),(0,s._)([(0,h.Cb)((0,u.RH)({...C.G},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],I.prototype,"defaultSymbol",null),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],I.prototype,"fieldDelimiter",void 0),(0,s._)([(0,h.Cb)({type:b.Z,readOnly:!0})],I.prototype,"portal",void 0),(0,s._)([(0,f.r)("portal",["styleName"])],I.prototype,"readPortal",null),(0,s._)([(0,h.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],I.prototype,"styleOrigin",void 0),(0,s._)([(0,f.r)("styleOrigin",["styleName","styleUrl"])],I.prototype,"readStyleOrigin",null),(0,s._)([(0,g.c)("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],I.prototype,"writeStyleOrigin",null),(0,s._)([(0,h.Cb)({type:[S.Z],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],I.prototype,"uniqueValueInfos",null),I=r=(0,s._)([(0,m.j)("esri.renderers.UniqueValueRenderer")],I);const L=I},68411:(e,t,i)=>{"use strict";i.d(t,{W:()=>F});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283)),a=i(34248),l=i(40266),c=i(39835),u=i(17095),h=i(24810),d=i(68844);let p=r=class extends h.Z{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new r({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,s._)([(0,n.Cb)({readOnly:!0})],p.prototype,"cache",null),(0,s._)([(0,n.Cb)({type:["color"],json:{type:["colorInfo"]}})],p.prototype,"type",void 0),(0,s._)([(0,n.Cb)({type:String,json:{write:!0}})],p.prototype,"normalizationField",void 0),(0,s._)([(0,n.Cb)({type:[d.Z],json:{write:!0}})],p.prototype,"stops",null),p=r=(0,s._)([(0,l.j)("esri.renderers.visualVariables.ColorVariable")],p);const f=p;var m,g=i(82064),y=i(78621);let _=m=class extends g.wq{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return(0,y.b)(t.transparency)}writeOpacity(e,t,i){t[i]=(0,y.a)(e)}clone(){return new m({label:this.label,opacity:this.opacity,value:this.value})}};(0,s._)([(0,n.Cb)({type:String,json:{write:!0}})],_.prototype,"label",void 0),(0,s._)([(0,n.Cb)({type:Number,json:{type:o.z8,write:{target:"transparency"}}})],_.prototype,"opacity",void 0),(0,s._)([(0,a.r)("opacity",["transparency"])],_.prototype,"readOpacity",null),(0,s._)([(0,c.c)("opacity")],_.prototype,"writeOpacity",null),(0,s._)([(0,n.Cb)({type:Number,json:{write:!0}})],_.prototype,"value",void 0),_=m=(0,s._)([(0,l.j)("esri.renderers.visualVariables.support.OpacityStop")],_);const v=_;var b;let w=b=class extends h.Z{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new b({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,s._)([(0,n.Cb)({readOnly:!0})],w.prototype,"cache",null),(0,s._)([(0,n.Cb)({type:["opacity"],json:{type:["transparencyInfo"]}})],w.prototype,"type",void 0),(0,s._)([(0,n.Cb)({type:String,json:{write:!0}})],w.prototype,"normalizationField",void 0),(0,s._)([(0,n.Cb)({type:[v],json:{write:!0}})],w.prototype,"stops",null),w=b=(0,s._)([(0,l.j)("esri.renderers.visualVariables.OpacityVariable")],w);const x=w;var C=i(76880),T=i(96243),S=i(53443),E=i(25709),A=i(13802),M=i(96863);const O=A.Z.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),R={color:f,size:T.Z,opacity:x,rotation:C.Z},P=new E.X({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),I=/^\[([^\]]+)\]$/i;let L=class extends S.Z{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter((e=>!!e)))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some((e=>!!e.target))&&e.sort(((e,t)=>{let i=null;return i=e.target===t.target?0:e.target?1:-1,i}));for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match(I),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map((e=>{const t=P.read(e.type),r=R[t];r||(O.warn(`Unknown variable type: ${t}`),i&&i.messages&&i.messages.push(new M.Z("visual-variable:unsupported",`visualVariable of type '${t}' is not supported`,{definition:e,context:i})));const s=new r;return s.read(e,i),s}))}writeVariables(e,t){const i=[];for(const r of e){const e=r.toJSON(t);e&&i.push(e)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};(0,s._)([(0,n.Cb)()],L.prototype,"visualVariables",null),L=(0,s._)([(0,l.j)("esri.renderers.visualVariables.VisualVariableFactory")],L);const D=L,N={base:h.Z,key:"type",typeMap:{opacity:x,color:f,rotation:C.Z,size:T.Z}},F=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new D}set visualVariables(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(e,t,i){return this._vvFactory.readVariables(e,t,i)}writeVisualVariables(e,t,i,r){t[i]=this._vvFactory.writeVariables(e,r)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const e of this.visualVariables)if(e.arcadeRequired)return!0;return!1}hasVisualVariables(e,t){return e?this.getVisualVariablesForType(e,t).length>0:this.getVisualVariablesForType("size",t).length>0||this.getVisualVariablesForType("color",t).length>0||this.getVisualVariablesForType("opacity",t).length>0||this.getVisualVariablesForType("rotation",t).length>0}getVisualVariablesForType(e,t){const i=this.visualVariables;return i?i.filter((i=>i.type===e&&("string"==typeof t?i.target===t:!1!==t||!i.target))):[]}async collectVVRequiredFields(e,t){let i=[];this.visualVariables&&(i=i.concat(this.visualVariables));for(const r of i)r&&(r.field&&(0,u.AB)(e,t,r.field),r.normalizationField&&(0,u.AB)(e,t,r.normalizationField),r.valueExpression&&await(0,u.io)(e,t,r.valueExpression))}};return(0,s._)([(0,n.Cb)({types:[N],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),(0,s._)([(0,a.r)("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),(0,s._)([(0,c.c)("visualVariables")],t.prototype,"writeVisualVariables",null),t=(0,s._)([(0,l.j)("esri.renderers.mixins.VisualVariablesMixin")],t),t}},41344:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r,s=i(36663),n=i(30936),o=i(82064),a=i(13802),l=i(81977),c=(i(7753),i(39994),i(69236)),u=i(40266),h=i(7283);const d=a.Z.getLogger("esri.renderers.support.AttributeColorInfo");let p=r=class extends o.wq{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(d.error(".field: field must be a string value"),null):(0,h.Zs)(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new r({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,s._)([(0,l.Cb)({type:n.Z,json:{type:[Number],write:!0}})],p.prototype,"color",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],p.prototype,"field",void 0),(0,s._)([(0,c.p)("field")],p.prototype,"castField",null),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],p.prototype,"label",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],p.prototype,"valueExpression",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],p.prototype,"valueExpressionTitle",void 0),p=r=(0,s._)([(0,u.j)("esri.renderers.support.AttributeColorInfo")],p);const f=p},95187:(e,t,i)=>{"use strict";i.d(t,{Z:()=>I});var r,s=i(36663),n=i(25709),o=i(82064),a=i(67134),l=i(81977),c=i(7283),u=i(34248),h=i(40266);i(7753),i(39994);let d=r=class extends o.wq{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new r({minValue:this.minValue,maxValue:this.maxValue})}};var p;(0,s._)([(0,l.Cb)({type:Number,json:{write:!0}})],d.prototype,"minValue",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{write:!0}})],d.prototype,"maxValue",void 0),d=r=(0,s._)([(0,h.j)("esri.renderer.support.AuthoringInfoClassBreakInfo")],d);let f=p=class extends o.wq{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new p({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:(0,a.d9)(this.classBreakInfos)})}};(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],f.prototype,"field",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],f.prototype,"normalizationField",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],f.prototype,"label",void 0),(0,s._)([(0,l.Cb)({type:[d],json:{write:!0}})],f.prototype,"classBreakInfos",void 0),f=p=(0,s._)([(0,h.j)("esri.renderers.support.AuthoringInfoFieldInfo")],f);var m,g=i(69236);const y=new n.X({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),_=new n.X({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),v={key:e=>"number"==typeof e?"number":"string",typeMap:{number:Number,string:String},base:null},b=["high-to-low","above-and-below","centered-on","extremes"],w=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],x=["seconds","minutes","hours","days","months","years"];let C=m=class extends o.wq{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return"string"==typeof e||"number"==typeof e?e:null}castStartTime(e){return"string"==typeof e||"number"==typeof e?e:null}get style(){return"color"===this.type?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new m({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};(0,s._)([(0,l.Cb)({types:v,json:{write:!0}})],C.prototype,"endTime",void 0),(0,s._)([(0,g.p)("endTime")],C.prototype,"castEndTime",null),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],C.prototype,"field",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{write:!0}})],C.prototype,"maxSliderValue",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{write:!0}})],C.prototype,"minSliderValue",void 0),(0,s._)([(0,l.Cb)({types:v,json:{write:!0}})],C.prototype,"startTime",void 0),(0,s._)([(0,g.p)("startTime")],C.prototype,"castStartTime",null),(0,s._)([(0,l.Cb)({type:y.apiValues,value:null,json:{type:y.jsonValues,read:y.read,write:y.write}})],C.prototype,"style",null),(0,s._)([(0,l.Cb)({type:w,value:null,json:{type:w,origins:{"web-scene":{type:b,write:{writer:(e,t)=>{b.includes(e)&&(t.theme=e)}}}},write:!0}})],C.prototype,"theme",null),(0,s._)([(0,l.Cb)({type:_.apiValues,json:{type:_.jsonValues,read:_.read,write:_.write}})],C.prototype,"type",void 0),(0,s._)([(0,l.Cb)({type:x,json:{type:x,write:!0}})],C.prototype,"units",void 0),C=m=(0,s._)([(0,h.j)("esri.renderers.support.AuthoringInfoVisualVariable")],C);const T=C;var S,E=i(81657);const A=new n.X({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),M=new n.X({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),O=new n.X({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),R=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"];let P=S=class extends o.wq{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return(0,E.i)(e)}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new S({classificationMethod:this.classificationMethod,colorRamp:(0,a.d9)(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:(0,a.d9)(this.field1),field2:(0,a.d9)(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((e=>e.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};(0,s._)([(0,l.Cb)({type:A.apiValues,value:null,json:{type:A.jsonValues,read:A.read,write:A.write,origins:{"web-document":{default:"manual",type:A.jsonValues,read:A.read,write:A.write}}}})],P.prototype,"classificationMethod",null),(0,s._)([(0,l.Cb)({types:E.V,json:{write:!0}})],P.prototype,"colorRamp",void 0),(0,s._)([(0,u.r)("colorRamp")],P.prototype,"readColorRamp",null),(0,s._)([(0,l.Cb)({type:[String],value:null,json:{write:!0}})],P.prototype,"fields",null),(0,s._)([(0,l.Cb)({type:f,value:null,json:{write:!0}})],P.prototype,"field1",null),(0,s._)([(0,l.Cb)({type:f,value:null,json:{write:!0}})],P.prototype,"field2",null),(0,s._)([(0,l.Cb)({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],P.prototype,"flowTheme",null),(0,s._)([(0,l.Cb)({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],P.prototype,"focus",null),(0,s._)([(0,l.Cb)({type:Number,value:null,json:{type:c.z8,write:!0}})],P.prototype,"numClasses",null),(0,s._)([(0,l.Cb)({type:R,json:{type:R,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],P.prototype,"lengthUnit",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],P.prototype,"maxSliderValue",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],P.prototype,"minSliderValue",void 0),(0,s._)([(0,l.Cb)({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],P.prototype,"statistics",null),(0,s._)([(0,l.Cb)({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],P.prototype,"standardDeviationInterval",null),(0,s._)([(0,l.Cb)({type:M.apiValues,value:null,json:{type:M.jsonValues,read:M.read,write:M.write,origins:{"web-scene":{type:O.jsonValues,write:{writer:O.write,overridePolicy:e=>({enabled:"flow"!==e})}}}}})],P.prototype,"type",null),(0,s._)([(0,l.Cb)({type:[T],json:{write:!0}})],P.prototype,"visualVariables",void 0),(0,s._)([(0,l.Cb)({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],P.prototype,"univariateSymbolStyle",null),(0,s._)([(0,l.Cb)({type:["high-to-low","above-and-below","above","below","90-10"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],P.prototype,"univariateTheme",null),P=S=(0,s._)([(0,h.j)("esri.renderers.support.AuthoringInfo")],P);const I=P},24326:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(99520);let c=r=class extends n.wq{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new r({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"description",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],c.prototype,"minValue",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],c.prototype,"maxValue",void 0),(0,s._)([(0,o.Cb)(l.G)],c.prototype,"symbol",void 0),c=r=(0,s._)([(0,a.j)("esri.renderers.support.ClassBreakInfo")],c);const u=c},47597:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DictionaryLoader:()=>m});var r=i(30936),s=i(66341),n=i(70375),o=i(13802),a=i(55854),l=i(61681),c=i(78668),u=i(21130),h=i(30879),d=i(62589);const p=o.Z.getLogger("esri.renderers.support.DictionaryLoader"),f={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class m{constructor(e,t,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new a.Z(100),this.url=e,this.config=t,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,t){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{i=await this._dictionaryPromise}catch(e){if((0,c.D_)(e))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const t of this._symbolFields){const i=this.fieldMap[t];if(i&&null!=e.attributes[i]){const r=""+e.attributes[i];s[t]=r}else s[t]=""}const n=i(s,t);if(!n||"string"!=typeof n)return null;const o=(0,u.hP)(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch((()=>{this._symbolCache.pop(o)})),a;const h=n.split(";"),d=[],p=[];for(const e of h)if(e)if(e.includes("po:")){const t=e.substr(3).split("|");if(3===t.length){const e=t[0],i=t[1];let s=t[2];if("DashTemplate"===i)s=s.split(" ").map((e=>Number(e)));else if("Color"===i){const e=new r.Z(s).toRgba();s=[e[0],e[1],e[2],255*e[3]]}else s=Number(s);p.push({primitiveName:e,propertyName:i,value:s})}}else if(e.includes("|")){for(const t of e.split("|"))if(this._itemNames.has(t)){d.push(t);break}}else this._itemNames.has(e)&&d.push(e);const f=!(0,l.pC)(e.geometry)||!e.geometry.hasZ&&"point"===e.geometry.type,m=this._cimPartsToCIMSymbol(d,p,f,t);return this._symbolCache.put(o,m,1),m}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void p.error("no valid URL!");const t=(0,s.default)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:(0,l.pC)(e)?e.signal:null}),[{data:i}]=await Promise.all([t,(0,h.LC)()]);if(!i)throw this._dictionaryPromise=null,new n.Z("esri.renderers.DictionaryRenderer","Bad dictionary data!");const r=i.expression,o=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=o.symbol;const a={};if(this.config){const e=this.config;for(const t in e)a[t]=e[t]}if(o.configuration)for(const e of o.configuration)a.hasOwnProperty(e.name)||(a[e.name]=e.value);const c=[];if((0,l.pC)(e)&&e.fields&&this.fieldMap)for(const t of this._symbolFields){const i=this.fieldMap[t],r=e.fields.filter((e=>e.name===i));r.length>0&&c.push({...r[0],name:t})}return this._dictionaryPromise=(0,h.pp)(r,(0,l.pC)(e)?e.spatialReference:null,c,a).then((e=>{const t={scale:0};return(i,r)=>{const s=e.repurposeFeature({geometry:null,attributes:i});return t.scale=(0,l.pC)(r)?r.scale:void 0,e.evaluate({$feature:s,$view:t})}})).catch((e=>(p.error("Creating dictinoary expression failed:",e),null))),this._dictionaryPromise}async _cimPartsToCIMSymbol(e,t,i,r){const s=new Array(e.length);for(let t=0;t<e.length;t++)s[t]=this._getSymbolPart(e[t],r);const n=await Promise.all(s),o=this.fieldMap;for(const e of n)g(e,o);return new d.Z({data:this._combineSymbolParts(n,t,i)})}async _getSymbolPart(e,t){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const i=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),r=(0,s.default)(i,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,r);try{return(await r).data}catch(t){throw this._ongoingRequests.delete(e),t}}_combineSymbolParts(e,t,i){if(!e||0===e.length)return null;const r={...e[0]};if(e.length>1){r.symbolLayers=[];for(const t of e){const e=t;r.symbolLayers.unshift(...e.symbolLayers)}}return i&&(r.callout=f),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:t}}}function g(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const e=i[r];e&&!1!==e.enable&&"CIMVectorMarker"===e.type&&y(e,t)}}function y(e,t){const i=e.markerGraphics;if(i)for(const e of i){if(!e)continue;const i=e.symbol;if(i)switch(i.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":g(i,t);break;case"CIMTextSymbol":i.fieldMap=t}}}},7541:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r,s=i(36663),n=i(30936),o=i(82064),a=i(81977),l=(i(7753),i(39994),i(7283)),c=i(40266);let u=r=class extends o.wq{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new r({color:this.color,ratio:this.ratio})}};(0,s._)([(0,a.Cb)({type:n.Z,json:{type:[l.z8],default:null,write:!0}})],u.prototype,"color",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],u.prototype,"ratio",void 0),u=r=(0,s._)([(0,c.j)("esri.renderers.support.HeatmapColorStop")],u);const h=u},24794:(e,t,i)=>{"use strict";i.d(t,{I:()=>l});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=r=class extends n.wq{constructor(){super(...arguments),this.title=null}clone(){return new r({title:this.title})}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=r=(0,s._)([(0,a.j)("esri.renderers.support.LegendOptions")],l)},19946:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(69236)),l=i(40266),c=i(99520);let u=r=class extends n.wq{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return null==e||"string"==typeof e||"number"==typeof e?e:`${e}`}clone(){return new r({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],u.prototype,"description",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],u.prototype,"label",void 0),(0,s._)([(0,o.Cb)(c.G)],u.prototype,"symbol",void 0),(0,s._)([(0,o.Cb)({json:{type:String,write:{writer:(e,t)=>{t.value=e?.toString()}}}})],u.prototype,"value",void 0),(0,s._)([(0,a.p)("value")],u.prototype,"castValue",null),u=r=(0,s._)([(0,l.j)("esri.renderers.support.UniqueValueInfo")],u);const h=u},99520:(e,t,i)=>{"use strict";i.d(t,{G:()=>l,K:()=>c});var r=i(4905),s=i(3593),n=i(83313),o=i(18251),a=i(57770);const l={types:r.QT,json:{write:{writer:n.cW},origins:{"web-scene":{types:r.f_,write:{writer:n.cW},read:{reader:(0,s.d)({types:r.f_})}}}}},c={types:{base:o.Z,key:"type",typeMap:{"simple-fill":r.LB.typeMap["simple-fill"],"picture-fill":r.LB.typeMap["picture-fill"],"polygon-3d":r.LB.typeMap["polygon-3d"]}},json:{write:{writer:n.cW},origins:{"web-scene":{type:a.Z,write:{writer:n.cW}}}}}},94672:(e,t,i)=>{"use strict";i.d(t,{AJ:()=>c,If:()=>p,QM:()=>d,k0:()=>l,nu:()=>a,uI:()=>h,wx:()=>f});var r=i(19431),s=i(95550),n=i(88589),o=i(1983);const a=2.4;function l(e){return(0,s.Wz)(e*a)}function c(e){return(0,s.F2)(e)/a}function u(e,t,i,s){let{color:o,ratio:a}=t,{color:l,ratio:c}=i;if(c===a){const e=1e-6;1===c?a-=e:c+=e}const u=(0,r.uZ)((s-a)/(c-a),0,1);(0,n.l)(e,o.toArray(),l.toArray(),u)}function h(e){const t=new Uint8ClampedArray(2048);if((e=e.filter((({ratio:e})=>e>=0&&e<=1)).sort(((e,t)=>e.ratio-t.ratio)).map((({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)})))).length<1)return t;let i=e[0],r=e[0],s=1;const n=(0,o.c)();for(let o=0;o<512;o++){const a=(o+.5)/512;for(;a>r.ratio&&s<e.length;)i=r,r=e[s++];u(n,i,r,a),t.set(n,4*o)}return t}function d(e,t,i,r){const{radius:n,fieldOffset:o,field:a}=t,l=Math.round((0,s.F2)(n)),c=new Float64Array(i*r);let u,h=Number.NEGATIVE_INFINITY;const d=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):i=>+i.readAttribute(e)+t:e=>1}(a,o),f=new Set;for(const t of e){const e=t.getCursor();for(;e.next();){const t=e.getObjectId();if(f.has(t))continue;f.add(t);const s=e.readLegacyPointGeometry(),n=128;if(s.x<-n||s.x>=i+n||s.y<-n||s.y>r+n)continue;const o=+d(e),a=Math.max(0,Math.round(s.x)-l),m=Math.max(0,Math.round(s.y)-l),g=Math.min(r,Math.round(s.y)+l),y=Math.min(i,Math.round(s.x)+l);for(let e=m;e<g;e++)for(let t=a;t<y;t++){const r=e*i+t,n=p(s.x-t,s.y-e,l);u=c[r]+=n*o,u>h&&(h=u)}}}return{matrix:c.buffer,max:h}}function p(e,t,i){const r=Math.sqrt(e**2+t**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function f(e,t){return"function"==typeof e?e:e?"string"==typeof t?t=>-1*+t[e]:i=>+i[e]+t:()=>1}},72506:(e,t,i)=>{"use strict";i.d(t,{a:()=>l,i:()=>o});var r=i(96863),s=i(3593),n=i(54021);function o(e,t){return l(e,null,t)}const a=(0,s.d)({types:n.A});function l(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(i&&i.messages&&i.messages.push(new r.Z("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):a(e,t,i):null}},6923:(e,t,i)=>{"use strict";i.d(t,{a:()=>n});var r=i(17321),s=i(14260);const n={inches:(0,r.En)(1,"meters","inches"),feet:(0,r.En)(1,"meters","feet"),"us-feet":(0,r.En)(1,"meters","us-feet"),yards:(0,r.En)(1,"meters","yards"),miles:(0,r.En)(1,"meters","miles"),"nautical-miles":(0,r.En)(1,"meters","nautical-miles"),millimeters:(0,r.En)(1,"meters","millimeters"),centimeters:(0,r.En)(1,"meters","centimeters"),decimeters:(0,r.En)(1,"meters","decimeters"),meters:(0,r.En)(1,"meters","meters"),kilometers:(0,r.En)(1,"meters","kilometers"),"decimal-degrees":1/(0,r.ty)(1,"meters",s.sv.radius)}},21758:(e,t,i)=>{"use strict";i.d(t,{D2:()=>l,NM:()=>u,WU:()=>d,f1:()=>c}),i(87090);var r=i(25741);const s=/^-?(\d+)(\.(\d+))?$/i;function n(e,t){return e-t}function o(e,t){let i,r;return i=Number(e.toFixed(t)),i<e?r=i+1/10**t:(r=i,i-=1/10**t),i=Number(i.toFixed(t)),r=Number(r.toFixed(t)),[i,r]}function a(e,t,i,r,s){const n=c(e,t,i,r),o=null==n.previous||n.previous<=s,a=null==n.next||n.next<=s;return o&&a||n.previous+n.next<=2*s}function l(e){const t=String(e),i=t.match(s);if(i&&i[1])return{integer:i[1].split("").length,fractional:i[3]?i[3].split("").length:0};if(t.toLowerCase().includes("e")){const e=t.split("e"),i=e[0],r=e[1];if(i&&r){const e=Number(i);let t=Number(r);const s=t>0;s||(t=Math.abs(t));const n=l(e);return s?(n.integer+=t,t>n.fractional?n.fractional=0:n.fractional-=t):(n.fractional+=t,t>n.integer?n.integer=1:n.integer-=t),n}}return{integer:0,fractional:0}}function c(e,t,i,r){const s={previous:null,next:null};if(null!=i){const r=e-i,n=t-i-r;s.previous=Math.floor(Math.abs(100*n/r))}if(null!=r){const i=r-e,n=r-t-i;s.next=Math.floor(Math.abs(100*n/i))}return s}function u(e,t={}){const i=e.slice(0),{tolerance:r=2,strictBounds:s=!1,indexes:c=i.map(((e,t)=>t))}=t;c.sort(n);for(let e=0;e<c.length;e++){const t=c[e],n=i[t],u=0===t?null:i[t-1],h=t===i.length-1?null:i[t+1],d=l(n).fractional;if(d){let l,c=0,p=!1;for(;c<=d&&!p;){const t=o(n,c);l=s&&0===e?t[1]:t[0],p=a(n,l,u,h,r),c++}p&&(i[t]=l)}}return i}const h={maximumFractionDigits:20};function d(e){return(0,r.uf)(e,h)}},67905:(e,t,i)=>{"use strict";i.d(t,{Kb:()=>a,o2:()=>u,sV:()=>c,xn:()=>l});var r=i(30936),s=i(61681),n=i(36496);function o(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&(0,s.pC)(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function a(e,t){const i=o(e,t),r=function(e,t){if((0,s.pC)(e.symbol))return e.symbol;const i=o(e,t);return(0,s.pC)(i)&&"dot-density"!==i.type?i.getSymbol(e,t):null}(e,t);if((0,s.Wi)(r))return null;const a={renderer:i,symbol:r};if((0,s.Wi)(i)||!("visualVariables"in i)||!i.visualVariables)return a;const l=(0,n.getVisualVariableValues)(i,e,t),c=["proportional","proportional","proportional"];for(const{variable:e,value:t}of l)switch(e.type){case"color":a.color=t.toRgba();break;case"size":if("outline"===e.target)a.outlineSize=t;else{const i=e.axis,r=e.useSymbolValue?"symbol-value":t;switch(i){case"width":c[0]=r;break;case"depth":c[1]=r;break;case"height":c[2]=r;break;case"width-and-depth":c[0]=c[1]=r;break;default:c[0]=c[1]=c[2]=r}}break;case"opacity":a.opacity=t;break;case"rotation":switch(e.axis){case"tilt":a.tilt=t;break;case"roll":a.roll=t;break;default:a.heading=t}}return"proportional"===c[0]&&"proportional"===c[1]&&"proportional"===c[2]||(a.size=c),a}async function l(e,t){const i=o(e,t),a=await async function(e,t){if((0,s.pC)(e.symbol))return e.symbol;const i=o(e,t);return(0,s.pC)(i)&&i.getSymbolAsync(e,t)}(e,t);if(!a)return null;const l={renderer:i,symbol:a};if(!i||!("visualVariables"in i)||!i.visualVariables)return l;const c=(0,n.getVisualVariableValues)(i,e,t),u=["proportional","proportional","proportional"];for(const{variable:e,value:t}of c)if("color"===e.type)l.color=r.Z.toUnitRGBA(t);else if("size"===e.type)if("outline"===e.target)l.outlineSize=t;else{const i=e.axis,r=e.useSymbolValue?"symbol-value":t;"width"===i?u[0]=r:"depth"===i?u[1]=r:"height"===i?u[2]=r:u[0]=u[1]="width-and-depth"===i?r:u[2]=r}else"opacity"===e.type?l.opacity=t:"rotation"===e.type&&"tilt"===e.axis?l.tilt=t:"rotation"===e.type&&"roll"===e.axis?l.roll=t:"rotation"===e.type&&(l.heading=t);return(isFinite(u[0])||isFinite(u[1])||isFinite(u[2]))&&(l.size=u),l}function c(e,t=0){const i=e[t];return"number"==typeof i&&isFinite(i)?i:null}function u(e){for(let t=0;t<3;t++){const i=e[t];if("number"==typeof i)return isFinite(i)?i:0}return 0}},16603:(e,t,i)=>{"use strict";i.d(t,{y:()=>o});var r=i(67979),s=i(78668),n=i(96863);async function o(e,t,i){const o=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(o&&"unique-value"===o.type&&o.styleOrigin){const a=await(0,r.q6)(o.populateFromStyle());if((0,s.k_)(i),!1===a.ok){const i=a.error;t&&t.messages&&t.messages.push(new n.Z("renderer:style-reference",`Failed to create unique value renderer from style reference: ${i.message}`,{error:i,context:t})),e.clear("renderer",t.origin)}}}},54021:(e,t,i)=>{"use strict";i.d(t,{A:()=>h,o:()=>d});var r=i(86004),s=i(45510),n=i(16192),o=i(71297),a=i(878),l=i(22836),c=i(50172),u=i(25634);const h={key:"type",base:l.Z,typeMap:{heatmap:o.Z,simple:c.Z,"unique-value":u.Z,"class-breaks":r.Z,"dot-density":n.Z,dictionary:s.Z,"pie-chart":a.Z},errorContext:"renderer"},d={key:"type",base:l.Z,typeMap:{simple:c.Z,"unique-value":u.Z,"class-breaks":r.Z,heatmap:o.Z},errorContext:"renderer"}},77669:(e,t,i)=>{"use strict";i.d(t,{zB:()=>h});var r=i(7753),s=i(13802),n=i(86114),o=i(72057),a=(i(21758),i(68844),i(59672)),l=i(31129),c=i(25803);function u(e,t,i){(0,n.s1)(e,t,(()=>[])).push(...i)}async function h(e){const t=new Map;if("visualVariables"in e&&e.visualVariables){const i=e.visualVariables.filter((e=>"color"===e.type));for(const e of i){const i=e.field||e.valueExpression,r=(await(0,l.pO)(e)).map((e=>e.color));u(t,i,r)}}if("heatmap"===e.type){const i=(0,c.h)(e).map((e=>e.color));u(t,e.field,i)}else if("pie-chart"===e.type){for(const i of e.attributes)u(t,i.field,[i.color]);u(t,null,[e?.othersCategory?.color,(0,a._h)(e.backgroundFillSymbol,null)])}else if("dot-density"===e.type){for(const i of e.attributes)u(t,i.field,[i.color]);u(t,null,[e.backgroundColor])}else if("unique-value"===e.type)if("predominance"===e.authoringInfo?.type)for(const i of e.uniqueValueInfos)u(t,i.value.toString(),[(0,a._h)(i.symbol,null)]);else{const i=e.uniqueValueInfos.map((e=>(0,a._h)(e.symbol,null))),{field:r,field2:s,field3:n,valueExpression:o}=e;(r||o)&&u(t,r||o,i),s&&u(t,s,i),n&&u(t,n,i)}else if("class-breaks"===e.type){const i=e.classBreakInfos.map((e=>(0,a._h)(e.symbol,null)));u(t,e.field||e.valueExpression,i)}else"simple"===e.type&&u(t,null,[(0,a._h)(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&u(t,null,[(0,a._h)(e.defaultSymbol,null)]),t.forEach(((e,i)=>{const s=(0,r.Tw)(e.filter(Boolean),((e,t)=>JSON.stringify(e)===JSON.stringify(t)));t.set(i,s)})),t}s.Z.getLogger("esri.renderers.support.utils"),(0,o.Ze)("short-date")},76880:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r,s=i(36663),n=i(70375),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(39835),c=i(24810);let u=r=class extends c.Z{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const e=`visualVariables[${this.index}]`;r.messages.push(new n.Z("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:e+".valueExpressionTitle",context:r}))}}clone(){return new r({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};(0,s._)([(0,o.Cb)({readOnly:!0})],u.prototype,"cache",null),(0,s._)([(0,o.Cb)({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],u.prototype,"axis",void 0),(0,s._)([(0,o.Cb)({type:["rotation"],json:{type:["rotationInfo"]}})],u.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],u.prototype,"rotationType",void 0),(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],u.prototype,"valueExpressionTitle",void 0),(0,s._)([(0,l.c)("web-scene","valueExpressionTitle")],u.prototype,"writeValueExpressionTitleWebScene",null),u=r=(0,s._)([(0,a.j)("esri.renderers.visualVariables.RotationVariable")],u);const h=u},96243:(e,t,i)=>{"use strict";i.d(t,{Z:()=>M});var r,s=i(36663),n=i(70375),o=i(25709),a=i(13802),l=i(95550),c=i(81977),u=(i(7753),i(39994),i(69236)),h=i(34248),d=i(40266),p=i(39835),f=i(24810),m=i(82064);i(7283);let g=r=class extends m.wq{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new r({label:this.label,size:this.size,value:this.value})}};(0,s._)([(0,c.Cb)({type:String,json:{write:!0}})],g.prototype,"label",void 0),(0,s._)([(0,c.Cb)({type:Number,cast:l.t_,json:{write:!0}})],g.prototype,"size",void 0),(0,s._)([(0,c.Cb)({type:Number,json:{write:!0}})],g.prototype,"value",void 0),g=r=(0,s._)([(0,d.j)("esri.renderers.visualVariables.support.SizeStop")],g);const y=g;var _,v=i(76204),b=i(67272),w=i(36496);const x=a.Z.getLogger("esri.renderers.visualVariables.SizeVariable"),C=new o.X({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),T=new o.X({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function S(e){if(null!=e)return"string"==typeof e||"number"==typeof e?(0,l.t_)(e):"size"===e.type?(0,b.iY)(e)?e:(delete(e={...e}).type,new A(e)):void 0}function E(e,t,i){if("object"!=typeof e)return e;const r=new A;return r.read(e,i),r}let A=_=class extends f.Z{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:w.viewScaleRE.test(this.valueExpression)}}set expression(e){x.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),"view.scale"===e?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){(0,b.iY)(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),(0,b.iY)(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return(0,b.PS)(this)}set maxDataValue(e){e&&this.stops&&(x.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(x.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return S(e)}readMaxSize(e,t,i){return E(e,0,i)}set minDataValue(e){e&&this.stops&&(x.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(x.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return S(e)}readMinSize(e,t,i){return E(e,0,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)):e&&(x.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return(0,b.QW)(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if("$view.scale"===e){if(r&&r.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;r.messages.push(new n.Z("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?T.read(e):null}clone(){return new _({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,b.iY)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,b.iY)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===b.hL.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===b.hL.Stops){const e=this.stops,t=e.map((e=>e.size)).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,s._)([(0,c.Cb)({readOnly:!0})],A.prototype,"cache",null),(0,s._)([(0,c.Cb)({type:C.apiValues,json:{type:C.jsonValues,origins:{"web-map":{read:!1}},read:C.read,write:C.write}})],A.prototype,"axis",void 0),(0,s._)([(0,c.Cb)({type:String,value:null,json:{read:!1}})],A.prototype,"expression",null),(0,s._)([(0,c.Cb)()],A.prototype,"index",null),(0,s._)([(0,c.Cb)({type:String,readOnly:!0})],A.prototype,"inputValueType",null),(0,s._)([(0,c.Cb)({type:v.Z,json:{write:!0}})],A.prototype,"legendOptions",void 0),(0,s._)([(0,c.Cb)({type:Number,value:null,json:{write:!0}})],A.prototype,"maxDataValue",null),(0,s._)([(0,c.Cb)({type:Number,value:null,json:{write:!0}})],A.prototype,"maxSize",null),(0,s._)([(0,u.p)("maxSize")],A.prototype,"castMaxSize",null),(0,s._)([(0,h.r)("maxSize")],A.prototype,"readMaxSize",null),(0,s._)([(0,c.Cb)({type:Number,value:null,json:{write:!0}})],A.prototype,"minDataValue",null),(0,s._)([(0,c.Cb)({type:Number,value:null,json:{write:!0}})],A.prototype,"minSize",null),(0,s._)([(0,u.p)("minSize")],A.prototype,"castMinSize",null),(0,s._)([(0,h.r)("minSize")],A.prototype,"readMinSize",null),(0,s._)([(0,c.Cb)({type:String,json:{write:!0}})],A.prototype,"normalizationField",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],A.prototype,"arcadeRequired",null),(0,s._)([(0,c.Cb)({type:String})],A.prototype,"scaleBy",void 0),(0,s._)([(0,c.Cb)({type:[y],value:null,json:{write:!0}})],A.prototype,"stops",null),(0,s._)([(0,c.Cb)({type:["outline"],json:{write:!0}})],A.prototype,"target",void 0),(0,s._)([(0,c.Cb)({type:String,readOnly:!0})],A.prototype,"transformationType",null),(0,s._)([(0,c.Cb)({type:["size"],json:{type:["sizeInfo"]}})],A.prototype,"type",void 0),(0,s._)([(0,c.Cb)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],A.prototype,"useSymbolValue",void 0),(0,s._)([(0,c.Cb)({type:String,json:{write:!0}})],A.prototype,"valueExpression",void 0),(0,s._)([(0,h.r)("valueExpression",["valueExpression","expression"])],A.prototype,"readValueExpression",null),(0,s._)([(0,p.c)("web-scene","valueExpression")],A.prototype,"writeValueExpressionWebScene",null),(0,s._)([(0,c.Cb)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],A.prototype,"valueRepresentation",void 0),(0,s._)([(0,c.Cb)({type:T.apiValues,json:{write:T.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],A.prototype,"valueUnit",void 0),(0,s._)([(0,h.r)("valueUnit")],A.prototype,"readValueUnit",null),A=_=(0,s._)([(0,d.j)("esri.renderers.visualVariables.SizeVariable")],A);const M=A},24810:(e,t,i)=>{"use strict";i.d(t,{Z:()=>m});var r=i(36663),s=i(25709),n=i(82064),o=i(13802),a=i(81977),l=(i(7753),i(39994),i(69236)),c=i(40266),u=i(7283),h=i(63329);const d=o.Z.getLogger("esri.renderers.visualVariables.VisualVariable"),p=new s.X({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let f=class extends n.wq{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(d.error(".field: field must be a string value"),null):(0,u.Zs)(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};(0,r._)([(0,a.Cb)()],f.prototype,"index",void 0),(0,r._)([(0,a.Cb)({type:p.apiValues,readOnly:!0,json:{read:p.read,write:p.write}})],f.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],f.prototype,"field",void 0),(0,r._)([(0,l.p)("field")],f.prototype,"castField",null),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],f.prototype,"valueExpression",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],f.prototype,"valueExpressionTitle",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],f.prototype,"arcadeRequired",null),(0,r._)([(0,a.Cb)({type:h.Z,json:{write:!0}})],f.prototype,"legendOptions",void 0),f=(0,r._)([(0,c.j)("esri.renderers.visualVariables.VisualVariable")],f);const m=f},68844:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var r,s=i(36663),n=i(30936),o=i(82064),a=i(81977),l=(i(7753),i(39994),i(7283)),c=i(40266),u=i(39835);let h=r=class extends o.wq{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=null==e?0:e}clone(){return new r({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};(0,s._)([(0,a.Cb)({type:n.Z,json:{type:[l.z8],write:!0}})],h.prototype,"color",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],h.prototype,"value",void 0),(0,s._)([(0,u.c)("value")],h.prototype,"writeValue",null),h=r=(0,s._)([(0,c.j)("esri.renderers.visualVariables.support.ColorStop")],h);const d=h},76204:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(63329);let l=r=class extends a.Z{constructor(){super(...arguments),this.customValues=null}clone(){return new r({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};(0,s._)([(0,n.Cb)({type:[Number],json:{write:!0}})],l.prototype,"customValues",void 0),l=r=(0,s._)([(0,o.j)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],l);const c=l},63329:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(24794);let l=r=class extends a.I{constructor(){super(...arguments),this.showLegend=null}clone(){return new r({title:this.title,showLegend:this.showLegend})}};(0,s._)([(0,n.Cb)({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),l=r=(0,s._)([(0,o.j)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l);const c=l},67272:(e,t,i)=>{"use strict";var r,s;function n(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function o(e){return null!=e&&!isNaN(e)&&isFinite(e)}function a(e){return e.valueExpression?r.Expression:e.field&&"string"==typeof e.field?r.Field:r.Unknown}function l(e,t){const i=t||a(e),n=e.valueUnit||"unknown";return i===r.Unknown?s.Constant:e.stops?s.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?s.ClampedLinear:"unknown"===n?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?s.Proportional:s.Additive:s.Identity:s.RealWorldSize}i.d(t,{PS:()=>a,QW:()=>l,RY:()=>r,hL:()=>s,iY:()=>n,qh:()=>o}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(r||(r={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(s||(s={}))},36496:(e,t,i)=>{"use strict";i.r(t),i.d(t,{getAllSizes:()=>T,getColor:()=>f,getOpacity:()=>m,getRotationAngle:()=>g,getSize:()=>y,getSizeForValue:()=>b,getSizeFromNumberOrVariable:()=>_,getSizeRangeAtScale:()=>w,getVisualVariableValues:()=>x,viewScaleRE:()=>p});var r=i(30936),s=i(80085),n=i(27755),o=i(13802),a=i(61681),l=i(6923),c=i(67272);const u=o.Z.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),h=new s.Z,d=Math.PI,p=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function f(e,t,i){const s="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!s)return;if("esri.renderers.visualVariables.ColorVariable"!==s.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n="number"==typeof t,o=n?null:t,l=o&&o.attributes;let c=n?t:null;const h=s.field,{ipData:d,hasExpression:p}=s.cache;let f=s.cache.compiledFunc;if(!h&&!p){const e=s.stops;return e&&e[0]&&e[0].color}if("number"!=typeof c)if(p){if((0,a.Wi)(i)||(0,a.Wi)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,r=t.getViewInfo(e),n=t.createExecContext(o,r);if(!f){const e=t.createSyntaxTree(s.valueExpression);f=t.createFunction(e),s.cache.compiledFunc=f}c=t.executeFunction(f,n)}else l&&(c=l[h]);const m=s.normalizationField,g=l?parseFloat(l[m]):void 0;if(null!=c&&(!m||n||!isNaN(g)&&0!==g)){isNaN(g)||n||(c/=g);const e=C(c,d);if(e){const t=e[0],n=e[1],o=t===n?s.stops[t].color:r.Z.blendColors(s.stops[t].color,s.stops[n].color,e[2],(0,a.pC)(i)?i.color:void 0);return new r.Z(o)}}}function m(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.OpacityVariable"!==r.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s="number"==typeof t,n=s?null:t,o=n&&n.attributes;let l=s?t:null;const c=r.field,{ipData:h,hasExpression:d}=r.cache;let p=r.cache.compiledFunc;if(!c&&!d){const e=r.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof l)if(d){if((0,a.Wi)(i)||(0,a.Wi)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,s=t.getViewInfo(e),o=t.createExecContext(n,s);if(!p){const e=t.createSyntaxTree(r.valueExpression);p=t.createFunction(e),r.cache.compiledFunc=p}l=t.executeFunction(p,o)}else o&&(l=o[c]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(null!=l&&(!f||s||!isNaN(m)&&0!==m)){isNaN(m)||s||(l/=m);const e=C(l,h);if(e){const t=e[0],i=e[1];if(t===i)return r.stops[t].opacity;{const s=r.stops[t].opacity;return s+(r.stops[i].opacity-s)*e[2]}}}}function g(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.RotationVariable"!==r.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n="heading"===s&&"arithmetic"===r.rotationType?90:0,o="heading"===s&&"arithmetic"===r.rotationType?-1:1,l="number"==typeof t?null:t,c=l&&l.attributes,h=r.field,{hasExpression:d}=r.cache;let p=r.cache.compiledFunc,f=0;if(!h&&!d)return f;if(d){if((0,a.Wi)(i)||(0,a.Wi)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,s=t.getViewInfo(e),n=t.createExecContext(l,s);if(!p){const e=t.createSyntaxTree(r.valueExpression);p=t.createFunction(e),r.cache.compiledFunc=p}f=t.executeFunction(p,n)}else c&&(f=c[h]||0);return f="number"!=typeof f||isNaN(f)?null:n+o*f,f}function y(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.SizeVariable"!==r.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=b(function(e,t,i){const r="number"==typeof t,s=r?null:t,n=s&&s.attributes;let o=r?t:null;const{isScaleDriven:l}=e.cache;let h=e.cache.compiledFunc;if(l){const t=(0,a.pC)(i)?i.scale:void 0,r=(0,a.pC)(i)?i.view:void 0;o=null==t||"3d"===r?function(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}(e):t}else if(!r)switch(e.inputValueType){case c.RY.Expression:{if((0,a.Wi)(i)||(0,a.Wi)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const t={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},r=i.arcade.arcadeUtils,n=r.getViewInfo(t),l=r.createExecContext(s,n);if(!h){const t=r.createSyntaxTree(e.valueExpression);h=r.createFunction(t),e.cache.compiledFunc=h}o=r.executeFunction(h,l);break}case c.RY.Field:n&&(o=n[e.field]);break;case c.RY.Unknown:o=null}if(!(0,c.qh)(o))return null;if(r||!e.normalizationField)return o;const d=n?parseFloat(n[e.normalizationField]):null;return(0,c.qh)(d)&&0!==d?o/d:null}(r,t,i),r,t,i,r.cache.ipData);return null==s||isNaN(s)?0:s}function _(e,t,i){return null==e?null:(0,c.iY)(e)?y(e,t,i):(0,c.qh)(e)?e:null}function v(e,t,i){return(0,c.qh)(i)&&e>i?i:(0,c.qh)(t)&&e<t?t:e}function b(e,t,i,r,s){switch(t.transformationType){case c.hL.Additive:return function(e,t,i,r){return e+(_(t.minSize,i,r)||t.minDataValue)}(e,t,i,r);case c.hL.Constant:return function(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return null==s&&(s=e.minSize),_(s,t,i)}(t,i,r);case c.hL.ClampedLinear:return function(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=_(t.minSize,i,r),o=_(t.maxSize,i,r),l=(0,a.pC)(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if("area"===t.scaleBy&&l){const e="circle"===l,t=e?d*(n/2)**2:n*n,i=t+s*((e?d*(o/2)**2:o*o)-t);return e?2*Math.sqrt(i/d):Math.sqrt(i)}return n+s*(o-n)}(e,t,i,r);case c.hL.Proportional:return function(e,t,i,r){const s=(0,a.pC)(r)?r.shape:void 0,n=e/t.minDataValue,o=_(t.minSize,i,r),l=_(t.maxSize,i,r);let c=null;return c="circle"===s?2*Math.sqrt(n*(o/2)**2):"square"===s||"diamond"===s||"image"===s?Math.sqrt(n*o**2):n*o,v(c,o,l)}(e,t,i,r);case c.hL.Stops:return function(e,t,i,r,s){const[n,o,a]=C(e,s);if(n===o)return _(t.stops[n].size,i,r);{const e=_(t.stops[n].size,i,r);return e+(_(t.stops[o].size,i,r)-e)*a}}(e,t,i,r,s);case c.hL.RealWorldSize:return function(e,t,i,r){const s=((0,a.pC)(r)&&r.resolution?r.resolution:1)*l.a[t.valueUnit],n=_(t.minSize,i,r),o=_(t.maxSize,i,r),{valueRepresentation:c}=t;let u=null;return u="area"===c?2*Math.sqrt(e/d)/s:"radius"===c||"distance"===c?2*e/s:e/s,v(u,n,o)}(e,t,i,r);case c.hL.Identity:return e;case c.hL.Unknown:return null}}function w(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&"3d"===i||t))return null;const s={scale:t,view:i};let n=_(e.minSize,h,s),o=_(e.maxSize,h,s);if(null!=n||null!=o){if(n>o){const e=o;o=n,n=e}return{minSize:n,maxSize:o}}}function x(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const t of e.visualVariables)switch(t.type){case"color":s.push(t);break;case"opacity":n.push(t);break;case"rotation":a.push(t);break;case"size":o.push(t)}return s.forEach((e=>{const s=f(e,t,i);r.push({variable:e,value:s})})),n.forEach((e=>{const s=m(e,t,i);r.push({variable:e,value:s})})),a.forEach((e=>{const s=g(e,t,i);r.push({variable:e,value:s})})),o.forEach((e=>{const s=y(e,t,i);r.push({variable:e,value:s})})),r.filter((e=>null!=e.value))}function C(e,t){if(!t)return;let i=0,r=t.length-1;return t.some(((t,s)=>e<t?(r=s,!0):(i=s,!1))),[i,r,(e-t[i])/(t[r]-t[i])]}function T(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const e=s.useSymbolValue?"symbol-value":y(s,t,i);switch(s.axis){case"width":r[0]=e;break;case"depth":r[1]=e;break;case"height":r[2]=e;break;case"width-and-depth":r[0]=e,r[1]=e;break;case"all":case void 0:case null:r[0]=e,r[1]=e,r[2]=e;break;default:(0,n.Bg)(s.axis)}}return r}},66341:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var r=i(51366),s=i(88256),n=i(70375),o=i(39994),a=i(67134),l=i(61681),c=i(78668),u=i(3466),h=i(99522),d=i(73401);async function p(e,t){const a=(0,u.HK)(e),y=(0,u.jc)(e);y||a||(e=(0,u.Fv)(e));const _={url:e,requestOptions:{...(0,l.Wg)(t)}};let v=(0,u.oh)(e);if(v){const e=await async function(e,t){if(null!=e.responseData)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let i,r;try{r=await e.before(t)}catch(e){i=C("request:interceptor",e,t)}if((r instanceof Error||r instanceof n.Z)&&(i=C("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}(v,_);if(null!=e)return{data:e,getHeader:b,requestOptions:_.requestOptions,url:_.url};v.after||v.error||(v=null)}if(e=_.url,"image"===(t=_.requestOptions).responseType){if((0,o.Z)("host-webworker")||(0,o.Z)("host-node"))throw C("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),_)}else if(a)throw C("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),_);if("head"===t.method){if(t.body)throw C("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),_);if(a||y)throw C("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),_)}if(await async function(){(0,o.Z)("host-webworker")?f||(f=await i.e(3714).then(i.bind(i,53714))):p._abortableFetch||(p._abortableFetch=globalThis.fetch.bind(globalThis))}(),f)return f.execute(e,t);const w=new AbortController;(0,c.fu)(t,(()=>w.abort()));const x={controller:w,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:v,params:_,redoRequest:!1,useIdentity:m.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},A=await async function(e){let t,i;await async function(e){const t=e.params.url,i=e.params.requestOptions,n=e.controller.signal,o=i.body;let a=null,l=null;if(g&&"HTMLFormElement"in globalThis&&(o instanceof FormData?a=o:o instanceof HTMLFormElement&&(a=new FormData(o))),"string"==typeof o&&(l=o),e.fetchOptions={cache:i.cacheBust&&!p._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:"head"===i.method?"HEAD":"GET",mode:"cors",priority:m.priority,redirect:"follow",signal:n},(a||l)&&(e.fetchOptions.body=a||l),"anonymous"===i.authMode&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||i.query?.token||a?.get("token")),!e.hasToken&&r.Z.apiKey&&(0,h.r)(t)&&(i.query||(i.query={}),i.query.token=r.Z.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!S(t)&&!(0,c.Hc)(n)){let r;"immediate"===i.authMode?(await T(),r=await s.id.getCredential(t,{signal:n}),e.credential=r):"no-prompt"===i.authMode?(await T(),r=await s.id.getCredential(t,{prompt:!1,signal:n}).catch((()=>{})),e.credential=r):s.id&&(r=s.id.findCredential(t)),r&&(e.credentialToken=r.token,e.useSSL=!!r.ssl)}}(e);try{do{[t,i]=await E(e)}while(!await M(e,t,i))}catch(i){const r=C("request:server",i,e.params,t);throw r.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(r),r}const n=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(n)){if(!e.hasToken&&!e.credentialToken&&i.user?.username&&!(0,u.kl)(n)){const e=(0,u.P$)(n,!0);e&&m.trustedServers.push(e)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&(0,d.Hu)(i.authorizedCrossOriginNoCorsDomains)}const o=e.credential;if(o&&s.id){const e=s.id.findServerInfo(o.server);let t=e&&e.owningSystemUrl;if(t){t=t.replace(/\/?$/,"/sharing");const e=s.id.findCredential(t,o.userId);e&&-1===s.id._getIdenticalSvcIdx(t,e)&&e.resources.unshift(t)}}return{data:i,getHeader:t?e=>t.headers.get(e):b,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}(x);return v?.after?.(A),A}let f;const m=r.Z.request,g="FormData"in globalThis,y=[499,498,403,401],_=["COM_0056","COM_0057","SB_0008"],v=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],b=()=>null,w=Symbol();function x(e){const t=(0,u.P$)(e);return!t||t.endsWith(".arcgis.com")||p._corsServers.includes(t)||(0,u.kl)(t)}function C(e,t,i,r){let s="Error";const o={url:i.url,requestOptions:i.requestOptions,getHeader:b,ssl:!1};if(t instanceof n.Z)return t.details?(t.details=(0,a.d9)(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=o,t;if(t){const e=r&&(e=>r.headers.get(e)),i=r&&r.status,n=t.message;n&&(s=n),e&&(o.getHeader=e),o.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||i||0,o.subCode=t.subcode,o.messageCode=t.messageCode,"string"==typeof t.details?o.messages=[t.details]:o.messages=t.details,o.raw=w in t?t[w]:t}return(0,c.D_)(t)?(0,c.zE)():new n.Z(e,s,o)}async function T(){s.id||await i.e(2968).then(i.bind(i,92968))}function S(e){return v.some((t=>t.test(e)))}async function E(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions,n=(0,u.jc)(t)||(0,u.HK)(t),a=i.responseType||"json",l=n?0:null!=i.timeout?i.timeout:m.timeout;let h=!1;if(!n){e.useSSL&&(t=(0,u.hO)(t)),i.cacheBust&&"default"===r.cache&&(t=(0,u.ZN)(t,"request.preventCache",Date.now()));let n={...i.query};e.credentialToken&&(n.token=e.credentialToken);let a=(0,u.B7)(n);(0,o.Z)("esri-url-encodes-apostrophe")&&(a=a.replace(/'/g,"%27"));const l=t.length+1+a.length;let c;h="delete"===i.method||"post"===i.method||"put"===i.method||!!i.body||l>m.maxUrlLength;const p=i.useProxy||!!(0,u.ed)(t);if(p){const e=(0,u.b7)(t);c=e.path,!h&&c.length+1+l>m.maxUrlLength&&(h=!0),e.query&&(n={...e.query,...n})}if("HEAD"===r.method&&(h||p)){if(h){if(l>m.maxUrlLength)throw C("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params);throw C("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params)}if(p)throw C("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(h?(r.method="delete"===i.method?"DELETE":"put"===i.method?"PUT":"POST",i.body?t=(0,u.fl)(t,n):(r.body=(0,u.B7)(n),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=(0,u.fl)(t,n),p&&(e.useProxy=!0,t=`${c}?${t}`),n.token&&g&&r.body instanceof FormData&&!/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)&&r.body.set("token",n.token),i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!(0,u.D6)(t,(0,u.TI)()))if((0,u.kl)(t))e.withCredentials=!0;else if(s.id){const i=s.id.findServerInfo(t);i&&i.webTierAuth&&(e.withCredentials=!0)}e.withCredentials&&(r.credentials="include",(0,d.jH)(t)&&await(0,d.jz)(h?(0,u.fl)(t,n):t))}let f,y,_=0,v=!1;l>0&&(_=setTimeout((()=>{v=!0,e.controller.abort()}),l));try{if("native-request-init"===i.responseType)y=r,y.url=t;else if("image"!==i.responseType||"default"!==r.cache||"GET"!==r.method||h||function(e){if(e)for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0;return!1}(i.headers)||!n&&!e.useProxy&&m.proxyUrl&&!x(t)){if(f=await p._abortableFetch(t,r),e.useProxy||function(e){const t=(0,u.P$)(e);t&&!p._corsServers.includes(t)&&p._corsServers.push(t)}(t),"native"===i.responseType)y=f;else if("HEAD"!==r.method)if(f.ok){switch(a){case"array-buffer":y=await f.arrayBuffer();break;case"blob":case"image":y=await f.blob();break;default:y=await f.text()}if(_&&(clearTimeout(_),_=0),"json"===a||"xml"===a||"document"===a)if(y)switch(a){case"json":y=JSON.parse(y);break;case"xml":y=A(y,"application/xml");break;case"document":y=A(y,"text/html")}else y=null;if(y){if("array-buffer"===a||"blob"===a){const e=f.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(e)&&y["blob"===a?"size":"byteLength"]<=750)try{const e=await new Response(y).json();e.error&&(y=e)}catch{}}"image"===a&&y instanceof Blob&&(y=await O(URL.createObjectURL(y),e,!0))}}else y=await f.text()}else y=await O(t,e)}catch(r){if("AbortError"===r.name){if(v)throw new Error("Timeout exceeded");throw(0,c.zE)("Request canceled")}if(!(!f&&r instanceof TypeError&&m.proxyUrl)||i.body||"delete"===i.method||"head"===i.method||"post"===i.method||"put"===i.method||e.useProxy||x(t))throw r;e.redoRequest=!0,(0,u.tD)({proxyUrl:m.proxyUrl,urlPrefix:(0,u.P$)(t)})}finally{_&&clearTimeout(_)}return[f,y]}function A(e,t){let i;try{i=(new DOMParser).parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function M(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||"native"===r.responseType||"native-request-init"===r.responseType)return!0;let n,o,a,l;if(!t.ok)throw n=new Error(`Unable to load ${t.url} status: ${t.status}`),n[w]=i,n;i?.error&&(n=i.error),n&&(o=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,l=n.messageCode,l=l&&l.toUpperCase());const c=r.authMode;if(403===o&&(4===a||n.message&&n.message.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&("no-prompt"!==c||498===o)&&y.includes(o)&&!S(e.params.url)&&(403!==o||!_.includes(l)&&(null==a||2===a&&e.credentialToken))){await T();try{const t=await s.id.getCredential(e.params.url,{error:C("request:server",n,e.params),prompt:"no-prompt"!==c,signal:e.controller.signal,token:e.credentialToken});return e.credential=t,e.credentialToken=t.token,e.useSSL=e.useSSL||t.ssl,!1}catch(t){if("no-prompt"===c)return e.credential=null,e.credentialToken=null,!1;n=t}}if(n)throw n;return!0}function O(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=m.priority,s.src=e,(0,d.fY)(s,e,i,r)}p._abortableFetch=null,p._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"]},73630:(e,t,i)=>{"use strict";i.d(t,{i:()=>c});var r=i(66341),s=i(7283),n=i(53736),o=i(84238),a=i(41268);const l=(0,s.se)(a.Z);async function c(e,t,i){t=l(t);const s=(0,o.en)(e),a={...s.query,f:"json",...t.toJSON()},c=t.outSpatialReference,u=(0,n.Ji)(t.geometries[0]),h=(0,o.lA)(a,i);return(0,r.default)(s.path+"/project",h).then((({data:{geometries:e}})=>function(e,t,i){const r=(0,n.q9)(t);return e.map((e=>{const t=r.fromJSON(e);return t.spatialReference=i,t}))}(e,u,c)))}},27707:(e,t,i)=>{"use strict";function r(e){const t={};for(const i in e){if("declaredClass"===i)continue;const s=e[i];if(null!=s&&"function"!=typeof s)if(Array.isArray(s)){t[i]=[];for(let e=0;e<s.length;e++)t[i][e]=r(s[e])}else"object"==typeof s?s.toJSON&&(t[i]=JSON.stringify(s)):t[i]=s}return t}i.d(t,{A:()=>r})},96027:(e,t,i)=>{"use strict";i.d(t,{F:()=>l,e:()=>a});var r=i(84238),s=i(28500),n=i(51211),o=i(14136);async function a(e,t,i){const r=await l(e,t,i);return n.default.fromJSON(r)}async function l(e,t,i){const n=(0,r.en)(e),a={...i},l=o.Z.from(t),{data:c}=await(0,s.executeQuery)(n,l,l.sourceSpatialReference,a);return c}},66565:(e,t,i)=>{"use strict";i.d(t,{P:()=>a});var r=i(61681),s=i(17321),n=i(35925);function o(e,t,i){if(null==e.hasM||e.hasZ)for(const e of t)for(const t of e)t.length>2&&(t[2]*=i)}function a(e,t,i){if(!e&&!t||!i)return;const r=(0,s._R)(i);l(e,i,r),l(t,i,r)}function l(e,t,i){if(e)for(const r of e)c(r.geometry,t,i)}function c(e,t,i){if((0,r.Wi)(e)||!e.spatialReference||(0,n.fS)(e.spatialReference,t))return;const a=(0,s._R)(e.spatialReference)/i;if(1!==a)if("x"in e)null!=e.z&&(e.z*=a);else if("rings"in e)o(e,e.rings,a);else if("paths"in e)o(e,e.paths,a);else if("points"in e&&(null==e.hasM||e.hasZ))for(const t of e.points)t.length>2&&(t[2]*=a)}},81500:(e,t,i)=>{"use strict";i.d(t,{G$:()=>T,K9:()=>O,O7:()=>h});var r=i(70375),s=i(61681),n=i(76480),o=i(15540),a=i(21425);const l=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],c=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],u=["upperLeft","lowerLeft"];function h(e){return e>=l.length?null:l[e]}function d(e){return e>=c.length?null:c[e]}function p(e){return e>=u.length?null:u[e]}function f(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function m(e,t,i){const r=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const i=e.getUInt32(),s=e.pos()+i;let n=0;for(;e.pos()<s;)t.addCoordinatePoint(r,e.getSInt64(),n++);break}default:e.skip()}return r}function g(e,t,i){const r=t.createGeometry(i),s=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const i=e.getUInt32(),s=e.pos()+i;let n=0;for(;e.pos()<s;)t.addLength(r,e.getUInt32(),n++);break}case 3:{const i=e.getUInt32(),n=e.pos()+i;let o=0;for(t.allocateCoordinates(r);e.pos()<n;)t.addCoordinate(r,e.getSInt64(),o),o++,o===s&&(o=0);break}default:e.skip()}return r}function y(e){const t=new o.Z;let i="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const i=e.getUInt32(),r=e.pos()+i;for(;e.pos()<r;)t.lengths.push(e.getUInt32());break}case 3:{const i=e.getUInt32(),r=e.pos()+i;for(;e.pos()<r;)t.coords.push(e.getSInt64());break}case 1:i=a.A[e.getEnum()];break;default:e.skip()}return{queryGeometry:t,queryGeometryType:i}}function _(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function v(e){const t={type:h(0)};for(;e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=h(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=d(e.getEnum());break;case 5:default:e.skip();break;case 6:t.defaultValue=e.getString()}return t}function b(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.isSystemMaintained=e.getBool();break;default:e.skip()}return t}function w(e,t,i,r){const s=t.createFeature(i);let n=0;for(;e.next();)switch(e.tag()){case 1:{const t=r[n++].name;s.attributes[t]=e.processMessage(_);break}case 2:s.geometry=e.processMessageWithArgs(g,t,i);break;case 4:s.centroid=e.processMessageWithArgs(m,t,i);break;default:e.skip()}return s}function x(e){const t=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function C(e){const t=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function T(e){const t={originPosition:p(0)};for(;e.next();)switch(e.tag()){case 1:t.originPosition=p(e.getEnum());break;case 2:t.scale=e.processMessage(x);break;case 3:t.translate=e.processMessage(C);break;default:e.skip()}return t}function S(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function E(e,t){const i=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:i.wkid=e.getUInt32();break;case 5:i.wkt=e.getString();break;case 2:i.latestWkid=e.getUInt32();break;case 3:i.vcsWkid=e.getUInt32();break;case 4:i.latestVcsWkid=e.getUInt32();break;default:e.skip()}return i}function A(e,t){const i=t.createFeatureResult();i.geometryType=f(t,0);let r=!1;for(;e.next();)switch(e.tag()){case 1:i.objectIdFieldName=e.getString();break;case 3:i.globalIdFieldName=e.getString();break;case 4:i.geohashFieldName=e.getString();break;case 5:i.geometryProperties=e.processMessage(S);break;case 7:i.geometryType=f(t,e.getEnum());break;case 8:i.spatialReference=e.processMessageWithArgs(E,t);break;case 10:i.hasZ=e.getBool();break;case 11:i.hasM=e.getBool();break;case 12:i.transform=e.processMessage(T);break;case 9:{const t=e.getBool();i.exceededTransferLimit=t;break}case 13:t.addField(i,e.processMessage(v));break;case 15:r||(t.prepareFeatures(i),r=!0),t.addFeature(i,e.processMessageWithArgs(w,t,i,i.fields));break;case 2:i.uniqueIdField=e.processMessage(b);break;default:e.skip()}return t.finishFeatureResult(i),i}function M(e,t){const i={};let r=null;for(;e.next();)switch(e.tag()){case 4:r=e.processMessageWithArgs(y);break;case 1:i.featureResult=e.processMessageWithArgs(A,t);break;default:e.skip()}return(0,s.pC)(r)&&i.featureResult&&t.addQueryGeometry(i,r),i}function O(e,t){try{const i=2,r=new n.Z(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)r.tag()===i?s.queryResult=r.processMessageWithArgs(M,t):r.skip();return s}catch(e){throw new r.Z("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}}},21425:(e,t,i)=>{"use strict";i.d(t,{A:()=>l,J:()=>c});var r=i(17321),s=i(35925),n=i(59958),o=i(61619),a=i(15540);const l=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class c{constructor(e){this.options=e,this.geometryTypes=l,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new o.Z}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e||!e.features||!e.hasZ||!this.options.sourceSpatialReference||!e.spatialReference||(0,s.fS)(e.spatialReference,this.options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const t=(0,r._R)(this.options.sourceSpatialReference)/(0,r._R)(e.spatialReference);if(1!==t)for(const i of e.features){if(!(0,n.S6)(i))continue;const e=i.geometry.coords;for(let i=2;i<e.length;i+=3)e[i]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new n.u_}createSpatialReference(){return{wkid:0}}createGeometry(){return new a.Z}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new a.Z}}},75844:(e,t,i)=>{"use strict";i.d(t,{C:()=>s});var r=i(81500);function s(e,t){const i=(0,r.K9)(e,t),s=i.queryResult.featureResult,n=i.queryResult.queryGeometry,o=i.queryResult.queryGeometryType;if(s&&s.features&&s.features.length&&s.objectIdFieldName){const e=s.objectIdFieldName;for(const t of s.features)t.attributes&&(t.objectId=t.attributes[e])}return s&&(s.queryGeometry=n,s.queryGeometryType=o),s}},28500:(e,t,i)=>{"use strict";i.r(t),i.d(t,{encodeGeometry:()=>d,executeQuery:()=>f,executeQueryForCount:()=>_,executeQueryForExtent:()=>v,executeQueryForIds:()=>y,executeQueryPBF:()=>m,executeQueryPBFBuffer:()=>g,queryToQueryStringParameters:()=>p,runQuery:()=>b});var r=i(66341),s=i(61681),n=i(3466),o=i(53736),a=i(49756),l=i(27707),c=i(75844),u=i(13097);const h="Layer does not support extent calculation.";function d(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function p(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const n=r;let a,l,c;if((0,s.pC)(i)&&(l=i.spatialReference,c=i.spatialReference.wkid||JSON.stringify(i.spatialReference),n.geometryType=(0,o.Ji)(i),n.geometry=d(i,e.compactGeometryEnabled),n.inSR=c),r.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(n.objectIds=r.objectIds.join(",")),r.orderByFields&&(n.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete n.outFields:r.outFields.includes("*")?n.outFields="*":n.outFields=r.outFields.join(","),r.outSR?(n.outSR=r.outSR.wkid||JSON.stringify(r.outSR),a=e.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(n.outSR=n.inSR,a=l),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(n.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(n.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&(0,s.pC)(l)&&(0,s.pC)(e.quantizationParameters)&&(0,s.pC)(e.quantizationParameters.extent)&&l.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,n.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(n.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(n.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(n.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const e=r.timeExtent,{start:t,end:i}=e;null==t&&null==i||(n.time=t===i?t:`${null==t?"null":t},${null==i?"null":i}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&(0,s.pC)(l)&&(0,s.pC)(a)&&l.equals(a)&&(n.defaultSR=n.inSR,delete n.inSR,delete n.outSR),n}async function f(e,t,i,r){const n=(0,s.pC)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await b(e,t,"json",r);return(0,u.p)(t,i,n.data),n}async function m(e,t,i,r){if((0,s.pC)(t.timeExtent)&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const n=await g(e,t,r),o=n;return o.data=(0,c.C)(n.data,i),o}function g(e,t,i){return b(e,t,"pbf",i)}function y(e,t,i){return(0,s.pC)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):b(e,t,"json",i,{returnIdsOnly:!0})}function _(e,t,i){return(0,s.pC)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):b(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function v(e,t,i){return(0,s.pC)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):b(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then((e=>{const t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(h);if(t.hasOwnProperty("count"))throw new Error(h);return e}))}function b(e,t,i,o={},c={}){const u="string"==typeof e?(0,n.mN)(e):e,h=t.geometry?[t.geometry]:[];return o.responseType="pbf"===i?"array-buffer":"json",(0,a.aX)(h,null,o).then((e=>{const a=e&&e[0];(0,s.pC)(a)&&((t=t.clone()).geometry=a);const h=(0,l.A)({...u.query,f:i,...c,...p(t,c)});return(0,r.default)((0,n.v_)(u.path,"query"),{...o,query:{...h,...o.query}})}))}},13097:(e,t,i)=>{"use strict";i.d(t,{p:()=>n});var r=i(61681),s=i(95247);function n(e,t,i){if(!i||!i.features||!i.hasZ)return;const n=(0,s.k)(i.geometryType,t,e.outSpatialReference);if(!(0,r.Wi)(n))for(const e of i.features)n(e.geometry)}},42544:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283)),l=i(40266);const c={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let u=r=class extends n.wq{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=function(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find((e=>e.name===i));return s?function(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find((e=>e.name===t));return r&&r.value||null}({tagName:r,tags:s.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return c[t]||null}clone(){return new r({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,s._)([(0,o.Cb)({type:String})],u.prototype,"contentType",void 0),(0,s._)([(0,o.Cb)()],u.prototype,"exifInfo",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],u.prototype,"orientationInfo",null),(0,s._)([(0,o.Cb)({type:a.z8})],u.prototype,"id",void 0),(0,s._)([(0,o.Cb)({type:String})],u.prototype,"globalId",void 0),(0,s._)([(0,o.Cb)({type:String})],u.prototype,"keywords",void 0),(0,s._)([(0,o.Cb)({type:String})],u.prototype,"name",void 0),(0,s._)([(0,o.Cb)({json:{read:!1}})],u.prototype,"parentGlobalId",void 0),(0,s._)([(0,o.Cb)({json:{read:!1}})],u.prototype,"parentObjectId",void 0),(0,s._)([(0,o.Cb)({type:a.z8})],u.prototype,"size",void 0),(0,s._)([(0,o.Cb)({json:{read:!1}})],u.prototype,"url",void 0),u=r=(0,s._)([(0,l.j)("esri.layers.support.AttachmentInfo")],u);const h=u},27661:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r,s=i(36663),n=i(30936),o=i(67134),a=i(81977),l=i(7283),c=i(79438),u=i(40266),h=i(85905);let d=r=class extends h.Z{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new r({fromColor:(0,o.d9)(this.fromColor),toColor:(0,o.d9)(this.toColor),algorithm:this.algorithm})}};(0,s._)([(0,c.J)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],d.prototype,"algorithm",void 0),(0,s._)([(0,a.Cb)({type:n.Z,json:{type:[l.z8],write:!0}})],d.prototype,"fromColor",void 0),(0,s._)([(0,a.Cb)({type:n.Z,json:{type:[l.z8],write:!0}})],d.prototype,"toColor",void 0),(0,s._)([(0,a.Cb)({type:["algorithmic"]})],d.prototype,"type",void 0),d=r=(0,s._)([(0,u.j)("esri.rest.support.AlgorithmicColorRamp")],d);const p=d},67692:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var r,s=i(36663),n=i(82064),o=i(67134),a=i(81977),l=i(7283),c=i(40266),u=i(39835);let h=r=class extends n.wq{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new r((0,o.d9)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};(0,s._)([(0,a.Cb)({type:[String],json:{write:!0}})],h.prototype,"attachmentTypes",void 0),(0,s._)([(0,a.Cb)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],h.prototype,"attachmentsWhere",void 0),(0,s._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],h.prototype,"cacheHint",void 0),(0,s._)([(0,a.Cb)({type:[String],json:{write:!0}})],h.prototype,"keywords",void 0),(0,s._)([(0,a.Cb)({type:[Number],json:{write:!0}})],h.prototype,"globalIds",void 0),(0,s._)([(0,a.Cb)({json:{write:!0}})],h.prototype,"name",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],h.prototype,"num",void 0),(0,s._)([(0,a.Cb)({type:[Number],json:{write:!0}})],h.prototype,"objectIds",void 0),(0,s._)([(0,a.Cb)({type:Boolean,json:{default:!1,write:!0}})],h.prototype,"returnMetadata",void 0),(0,s._)([(0,a.Cb)({type:[Number],json:{write:!0}})],h.prototype,"size",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],h.prototype,"start",void 0),(0,s._)([(0,u.c)("start"),(0,u.c)("num")],h.prototype,"writeStart",null),(0,s._)([(0,a.Cb)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],h.prototype,"where",void 0),h=r=(0,s._)([(0,c.j)("esri.rest.support.AttachmentQuery")],h),h.from=(0,l.se)(h);const d=h},85905:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266));let a=class extends s.wq{constructor(e){super(e),this.type=null}};(0,r._)([(0,n.Cb)({readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.rest.support.ColorRamp")],a);const l=a},51211:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>b});var r,s=i(36663),n=i(91957),o=i(80085),a=i(25709),l=i(82064),c=i(67134),u=i(61681),h=i(81977),d=(i(7283),i(34248)),p=i(40266),f=i(39835),m=i(14685),g=i(53736),y=i(12512);const _=new a.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let v=r=class extends l.wq{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const i=m.Z.fromJSON(t.spatialReference),r=[];for(let t=0;t<e.length;t++){const s=e[t],n=o.Z.fromJSON(s),a=s.geometry&&s.geometry.spatialReference;(0,u.pC)(n.geometry)&&!a&&(n.geometry.spatialReference=i);const l=s.aggregateGeometries,c=n.aggregateGeometries;if(l&&(0,u.pC)(c))for(const e in c){const t=c[e],r=l[e]?.spatialReference;(0,u.pC)(t)&&!r&&(t.spatialReference=i)}r.push(n)}return r}writeGeometryType(e,t,i,r){if(e)return void _.write(e,t,i,r);const{features:s}=this;if(s)for(const e of s)if(e&&(0,u.pC)(e.geometry))return void _.write(e.geometry.type,t,i,r)}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=(0,g.im)(e);return!i&&t.spatialReference&&(r.spatialReference=m.Z.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i)for(const e of i)if(e&&(0,u.pC)(e.geometry)&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new r(this.cloneProperties())}cloneProperties(){return(0,c.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const t=e&&e[i];r.geometry=t&&t.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=this.features,o=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-r)/t)),(e=>Math.round((s-e)/i)));for(let e=0,t=n.length;e<t;e++)o((0,u.Wg)(n[e].geometry))||(n.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=this._getHydrationFunction(e,(e=>e*n+r),(e=>s-e*o));for(const{geometry:e}of t)(0,u.pC)(e)&&a(e);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let o=0,a=e.length;o<a;o++){const a=e[o];if(o>0){const e=t(a[0]),o=i(a[1]);e===r&&o===s||(n.push([e-r,o-s]),r=e,s=o)}else r=t(a[0]),s=i(a[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return"point"===e?e=>(e.x=t(e.x),e.y=i(e.y),e):"polyline"===e||"polygon"===e?e=>{const r=(0,g.oU)(e)?e.rings:e.paths,s=[];for(let e=0,n=r.length;e<n;e++){const n=r[e],o=this._quantizePoints(n,t,i);o&&s.push(o)}return s.length>0?((0,g.oU)(e)?e.rings=s:e.paths=s,e):null}:"multipoint"===e?e=>{const r=this._quantizePoints(e.points,t,i);return r.length>0?(e.points=r,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,i){return"point"===e?e=>{e.x=t(e.x),e.y=i(e.y)}:"polyline"===e||"polygon"===e?e=>{const r=(0,g.oU)(e)?e.rings:e.paths;let s,n;for(let e=0,o=r.length;e<o;e++){const o=r[e];for(let e=0,r=o.length;e<r;e++){const r=o[e];e>0?(s+=r[0],n+=r[1]):(s=r[0],n=r[1]),r[0]=t(s),r[1]=i(n)}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=i(e.ymin),e.xmax=t(e.xmax),e.ymax=i(e.ymax)}:"multipoint"===e?e=>{const r=e.points;let s,n;for(let e=0,o=r.length;e<o;e++){const o=r[e];e>0?(s+=o[0],n+=o[1]):(s=o[0],n=o[1]),o[0]=t(s),o[1]=i(n)}}:void 0}};(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],v.prototype,"displayFieldName",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],v.prototype,"exceededTransferLimit",void 0),(0,s._)([(0,h.Cb)({type:[o.Z],json:{write:!0}})],v.prototype,"features",void 0),(0,s._)([(0,d.r)("features")],v.prototype,"readFeatures",null),(0,s._)([(0,h.Cb)({type:[y.Z],json:{write:!0}})],v.prototype,"fields",void 0),(0,s._)([(0,h.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:_.read}}})],v.prototype,"geometryType",void 0),(0,s._)([(0,f.c)("geometryType")],v.prototype,"writeGeometryType",null),(0,s._)([(0,h.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],v.prototype,"hasM",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],v.prototype,"hasZ",void 0),(0,s._)([(0,h.Cb)({types:n.qM,json:{write:!0}})],v.prototype,"queryGeometry",void 0),(0,s._)([(0,d.r)("queryGeometry")],v.prototype,"readQueryGeometry",null),(0,s._)([(0,h.Cb)({type:m.Z,json:{write:!0}})],v.prototype,"spatialReference",void 0),(0,s._)([(0,f.c)("spatialReference")],v.prototype,"writeSpatialReference",null),(0,s._)([(0,h.Cb)({json:{write:!0}})],v.prototype,"transform",void 0),v=r=(0,s._)([(0,p.j)("esri.rest.support.FeatureSet")],v),v.prototype.toJSON.isDefaultToJSON=!0;const b=v},38651:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r,s=i(36663),n=i(67134),o=i(81977),a=(i(7283),i(40266)),l=i(27661),c=i(85905);let u=r=class extends c.Z{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new r({colorRamps:(0,n.d9)(this.colorRamps)})}};(0,s._)([(0,o.Cb)({type:[l.Z],json:{write:!0}})],u.prototype,"colorRamps",void 0),(0,s._)([(0,o.Cb)({type:["multipart"]})],u.prototype,"type",void 0),u=r=(0,s._)([(0,a.j)("esri.rest.support.MultipartColorRamp")],u);const h=u},41268:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(53736);let l=class extends s.wq{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((e=>e.toJSON())),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:(0,a.Ji)(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(i.transformForward=this.transformForward),i}};(0,r._)([(0,n.Cb)()],l.prototype,"geometries",void 0),(0,r._)([(0,n.Cb)({json:{read:{source:"outSR"}}})],l.prototype,"outSpatialReference",void 0),(0,r._)([(0,n.Cb)()],l.prototype,"transformation",void 0),(0,r._)([(0,n.Cb)()],l.prototype,"transformForward",void 0),l=(0,r._)([(0,o.j)("esri.rest.support.ProjectParameters")],l);const c=l},56836:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r,s=i(36663),n=(i(91957),i(25709)),o=i(82064),a=i(67134),l=i(81977),c=(i(7283),i(40266)),u=i(91772);const h=new n.X({upperLeft:"upper-left",lowerLeft:"lower-left"});let d=r=class extends o.wq{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new r((0,a.d9)({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};(0,s._)([(0,l.Cb)({type:u.Z,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],d.prototype,"extent",void 0),(0,s._)([(0,l.Cb)({type:["view","edit"],json:{write:!0}})],d.prototype,"mode",void 0),(0,s._)([(0,l.Cb)({type:String,json:{read:h.read,write:h.write}})],d.prototype,"originPosition",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],d.prototype,"tolerance",void 0),d=r=(0,s._)([(0,c.j)("esri.rest.support.QuantizationParameters")],d);const p=d},14136:(e,t,i)=>{"use strict";i.d(t,{Z:()=>E});var r,s=i(36663),n=i(91957),o=i(37956),a=i(25709),l=i(82064),c=i(67134),u=i(61681),h=i(81977),d=i(69236),p=i(79438),f=i(40266),m=i(39835),g=i(7283),y=i(53736),_=i(10743),v=i(56836),b=i(53631),w=i(14685),x=i(53446);const C=new a.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),T=new a.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let S=r=class extends l.wq{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return(0,g.TJ)(r,e)}castDatumTransformation(e){return"number"==typeof e||"object"==typeof e?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const t in e){const r=e[t];Array.isArray(r)?i[t]=r.map((e=>e instanceof Date?e.getTime():e)):r instanceof Date?i[t]=r.getTime():i[t]=r}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new r((0,c.d9)({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:(0,u.pC)(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};S.MAX_MAX_RECORD_COUNT_FACTOR=5,(0,s._)([(0,h.Cb)({json:{write:!0}})],S.prototype,"aggregateIds",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{write:!0}})],S.prototype,"cacheHint",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"compactGeometryEnabled",void 0),(0,s._)([(0,h.Cb)({json:{write:!0}})],S.prototype,"datumTransformation",void 0),(0,s._)([(0,d.p)("datumTransformation")],S.prototype,"castDatumTransformation",null),(0,s._)([(0,h.Cb)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"defaultSpatialReferenceEnabled",void 0),(0,s._)([(0,h.Cb)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],S.prototype,"distance",void 0),(0,s._)([(0,h.Cb)({type:_.n,json:{write:!0}})],S.prototype,"dynamicDataSource",void 0),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],S.prototype,"formatOf3DObjects",void 0),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],S.prototype,"gdbVersion",void 0),(0,s._)([(0,h.Cb)({types:n.qM,json:{read:y.im,write:!0}})],S.prototype,"geometry",void 0),(0,s._)([(0,h.Cb)({type:Number,json:{write:!0}})],S.prototype,"geometryPrecision",void 0),(0,s._)([(0,h.Cb)({type:[String],json:{write:!0}})],S.prototype,"groupByFieldsForStatistics",void 0),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],S.prototype,"having",void 0),(0,s._)([(0,h.Cb)({type:Date})],S.prototype,"historicMoment",void 0),(0,s._)([(0,m.c)("historicMoment")],S.prototype,"writeHistoricMoment",null),(0,s._)([(0,h.Cb)({type:Number,json:{write:!0}})],S.prototype,"maxAllowableOffset",void 0),(0,s._)([(0,h.Cb)({type:Number,cast:e=>e<1?1:e>r.MAX_MAX_RECORD_COUNT_FACTOR?r.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],S.prototype,"maxRecordCountFactor",void 0),(0,s._)([(0,h.Cb)({type:["xyFootprint"],json:{write:!0}})],S.prototype,"multipatchOption",void 0),(0,s._)([(0,h.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],S.prototype,"num",void 0),(0,s._)([(0,h.Cb)({json:{write:!0}})],S.prototype,"objectIds",void 0),(0,s._)([(0,h.Cb)({type:[String],json:{write:!0}})],S.prototype,"orderByFields",void 0),(0,s._)([(0,h.Cb)({type:[String],json:{write:!0}})],S.prototype,"outFields",void 0),(0,s._)([(0,h.Cb)({type:w.Z,json:{name:"outSR",write:!0}})],S.prototype,"outSpatialReference",void 0),(0,s._)([(0,h.Cb)({type:[b.Z],json:{write:{enabled:!0,overridePolicy(){return{enabled:(0,u.pC)(this.outStatistics)&&this.outStatistics.length>0}}}}})],S.prototype,"outStatistics",void 0),(0,s._)([(0,h.Cb)({json:{write:!0}})],S.prototype,"parameterValues",void 0),(0,s._)([(0,m.c)("parameterValues")],S.prototype,"writeParameterValues",null),(0,s._)([(0,h.Cb)({type:x.Z,json:{write:!0}})],S.prototype,"pixelSize",void 0),(0,s._)([(0,h.Cb)({type:v.Z,json:{write:!0}})],S.prototype,"quantizationParameters",void 0),(0,s._)([(0,h.Cb)({type:[Object],json:{write:!0}})],S.prototype,"rangeValues",void 0),(0,s._)([(0,h.Cb)({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],S.prototype,"relationParameter",void 0),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],S.prototype,"resultType",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"returnCentroid",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"returnDistinctValues",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{default:!0,write:!0}})],S.prototype,"returnExceededLimitFeatures",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{write:!0}})],S.prototype,"returnGeometry",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"returnQueryGeometry",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"returnM",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],S.prototype,"returnZ",void 0),(0,s._)([(0,h.Cb)({type:w.Z,json:{write:!0}})],S.prototype,"sourceSpatialReference",void 0),(0,s._)([(0,p.J)(C,{ignoreUnknown:!1,name:"spatialRel"})],S.prototype,"spatialRelationship",void 0),(0,s._)([(0,h.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],S.prototype,"start",void 0),(0,s._)([(0,m.c)("start"),(0,m.c)("num")],S.prototype,"writeStart",null),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],S.prototype,"sqlFormat",void 0),(0,s._)([(0,h.Cb)({type:String,json:{write:!0}})],S.prototype,"text",void 0),(0,s._)([(0,h.Cb)({type:o.Z,json:{write:!0}})],S.prototype,"timeExtent",void 0),(0,s._)([(0,h.Cb)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"timeReferenceUnknownClient",void 0),(0,s._)([(0,p.J)(T,{ignoreUnknown:!1}),(0,h.Cb)({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],S.prototype,"units",void 0),(0,s._)([(0,h.Cb)({type:String,json:{write:{overridePolicy(e){return{enabled:null!=e||this.start>0}}}}})],S.prototype,"where",void 0),(0,s._)([(0,m.c)("where")],S.prototype,"writeWhere",null),S=r=(0,s._)([(0,f.j)("esri.rest.support.Query")],S);const E=S},8284:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r,s=i(36663),n=(i(91957),i(82064)),o=i(67134),a=i(81977),l=i(7283),c=i(40266),u=i(39835),h=i(10743),d=i(14685);let p=r=class extends n.wq{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&null==this.where&&(t.definitionExpression="1=1")}clone(){return new r((0,o.d9)({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};(0,s._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],p.prototype,"cacheHint",void 0),(0,s._)([(0,a.Cb)({type:h.n,json:{write:!0}})],p.prototype,"dynamicDataSource",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],p.prototype,"gdbVersion",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],p.prototype,"geometryPrecision",void 0),(0,s._)([(0,a.Cb)({type:Date})],p.prototype,"historicMoment",void 0),(0,s._)([(0,u.c)("historicMoment")],p.prototype,"_writeHistoricMoment",null),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],p.prototype,"maxAllowableOffset",void 0),(0,s._)([(0,a.Cb)({type:[Number],json:{write:!0}})],p.prototype,"objectIds",void 0),(0,s._)([(0,a.Cb)({type:[String],json:{write:!0}})],p.prototype,"orderByFields",void 0),(0,s._)([(0,a.Cb)({type:[String],json:{write:!0}})],p.prototype,"outFields",void 0),(0,s._)([(0,a.Cb)({type:d.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],p.prototype,"outSpatialReference",void 0),(0,s._)([(0,a.Cb)({json:{write:!0}})],p.prototype,"relationshipId",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],p.prototype,"start",void 0),(0,s._)([(0,u.c)("start"),(0,u.c)("num")],p.prototype,"writeStart",null),(0,s._)([(0,a.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],p.prototype,"num",void 0),(0,s._)([(0,a.Cb)({json:{write:!0}})],p.prototype,"returnGeometry",void 0),(0,s._)([(0,a.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],p.prototype,"returnM",void 0),(0,s._)([(0,a.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],p.prototype,"returnZ",void 0),(0,s._)([(0,a.Cb)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],p.prototype,"where",void 0),p=r=(0,s._)([(0,c.j)("esri.rest.support.RelationshipQuery")],p),p.from=(0,l.se)(p);const f=p},53631:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r,s=i(36663),n=i(25709),o=i(82064),a=i(67134),l=i(81977),c=(i(7283),i(40266)),u=i(39835);const h=new n.X({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let d=r=class extends o.wq{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(t.statisticParameters=(0,a.d9)(e))}clone(){return new r({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:(0,a.d9)(this.statisticParameters)})}};(0,s._)([(0,l.Cb)({type:Number,json:{write:!0}})],d.prototype,"maxPointCount",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{write:!0}})],d.prototype,"maxRecordCount",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{write:!0}})],d.prototype,"maxVertexCount",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],d.prototype,"onStatisticField",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],d.prototype,"outStatisticFieldName",void 0),(0,s._)([(0,l.Cb)({type:String,json:{read:{source:"statisticType",reader:h.read},write:{target:"statisticType",writer:h.write}}})],d.prototype,"statisticType",void 0),(0,s._)([(0,l.Cb)({type:Object})],d.prototype,"statisticParameters",void 0),(0,s._)([(0,u.c)("statisticParameters")],d.prototype,"writeStatisticParameters",null),d=r=(0,s._)([(0,c.j)("esri.rest.support.StatisticDefinition")],d);const p=d},12621:(e,t,i)=>{"use strict";i.d(t,{Z:()=>x});var r,s=i(36663),n=i(91957),o=i(37956),a=i(25709),l=i(82064),c=i(67134),u=i(81977),h=i(7283),d=i(40266),p=i(39835),f=i(53736);i(7753),i(39994);let m=r=class extends l.wq{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new r({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};(0,s._)([(0,u.Cb)({type:[String],json:{write:!0}})],m.prototype,"groupByFields",void 0),(0,s._)([(0,u.Cb)({type:Number,json:{write:!0}})],m.prototype,"topCount",void 0),(0,s._)([(0,u.Cb)({type:[String],json:{write:!0}})],m.prototype,"orderByFields",void 0),m=r=(0,s._)([(0,d.j)("esri.rest.support.TopFilter")],m);const g=m;var y,_=i(14685);const v=new a.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),b=new a.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let w=y=class extends l.wq{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new y((0,c.d9)({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};(0,s._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],w.prototype,"cacheHint",void 0),(0,s._)([(0,u.Cb)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],w.prototype,"distance",void 0),(0,s._)([(0,u.Cb)({types:n.qM,json:{read:f.im,write:!0}})],w.prototype,"geometry",void 0),(0,s._)([(0,u.Cb)({type:Number,json:{write:!0}})],w.prototype,"geometryPrecision",void 0),(0,s._)([(0,u.Cb)({type:Number,json:{write:!0}})],w.prototype,"maxAllowableOffset",void 0),(0,s._)([(0,u.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],w.prototype,"num",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],w.prototype,"objectIds",void 0),(0,s._)([(0,u.Cb)({type:[String],json:{write:!0}})],w.prototype,"orderByFields",void 0),(0,s._)([(0,u.Cb)({type:[String],json:{write:!0}})],w.prototype,"outFields",void 0),(0,s._)([(0,u.Cb)({type:_.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],w.prototype,"outSpatialReference",void 0),(0,s._)([(0,u.Cb)({type:String,json:{write:!0}})],w.prototype,"resultType",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],w.prototype,"returnGeometry",void 0),(0,s._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"returnM",void 0),(0,s._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"returnZ",void 0),(0,s._)([(0,u.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],w.prototype,"start",void 0),(0,s._)([(0,p.c)("start"),(0,p.c)("num")],w.prototype,"writeStart",null),(0,s._)([(0,u.Cb)({type:String,json:{read:{source:"spatialRel",reader:v.read},write:{target:"spatialRel",writer:v.write}}})],w.prototype,"spatialRelationship",void 0),(0,s._)([(0,u.Cb)({type:o.Z,json:{write:!0}})],w.prototype,"timeExtent",void 0),(0,s._)([(0,u.Cb)({type:g,json:{write:!0}})],w.prototype,"topFilter",void 0),(0,s._)([(0,u.Cb)({type:String,json:{read:b.read,write:{writer:b.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],w.prototype,"units",void 0),(0,s._)([(0,u.Cb)({type:String,json:{write:!0}})],w.prototype,"where",void 0),w=y=(0,s._)([(0,d.j)("esri.rest.support.TopFeaturesQuery")],w),w.from=(0,h.se)(w);const x=w},81657:(e,t,i)=>{"use strict";i.d(t,{V:()=>o,i:()=>a});var r=i(27661),s=i(85905),n=i(38651);const o={key:"type",base:s.Z,typeMap:{algorithmic:r.Z,multipart:n.Z}};function a(e){return e&&e.type?"algorithmic"===e.type?r.Z.fromJSON(e):"multipart"===e.type?n.Z.fromJSON(e):null:null}},75855:(e,t,i)=>{"use strict";i.d(t,{q:()=>r});const r={type:String,json:{read:{source:"token"},write:{target:"token"}}}},84238:(e,t,i)=>{"use strict";i.d(t,{cv:()=>a,en:()=>o,lA:()=>n});var r=i(67134),s=i(3466);function n(e,t){return t?{...t,query:{...e,...t.query}}:{query:e}}function o(e){return"string"==typeof e?(0,s.mN)(e):(0,r.d9)(e)}function a(e,t,i){const r={};for(const s in e){if("declaredClass"===s)continue;const n=e[s];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[s]=[];for(let e=0;e<n.length;e++)r[s][e]=a(n[e])}else if("object"==typeof n)if(n.toJSON){const e=n.toJSON(i&&i[s]);r[s]=t?e:JSON.stringify(e)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}},94449:(e,t,i)=>{"use strict";i.d(t,{J:()=>c});var r=i(36663),s=i(80085),n=(i(13802),i(7283)),o=(i(7753),i(39994),i(33156),i(2107)),a=i(40266),l=i(4637);let c=class extends l.a{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};(0,r._)([(0,o.c)({Type:s.Z,ensureType:(0,n.se)(s.Z)})],c.prototype,"itemType",void 0),c=(0,r._)([(0,a.j)("esri.support.GraphicsCollection")],c)},9008:(e,t,i)=>{"use strict";i.d(t,{K:()=>p});var r=i(36663),s=i(41831),n=i(58811),o=i(13802),a=i(78668),l=i(81977),c=(i(7753),i(39994),i(7283),i(40266)),u=i(38481);function h(e,t,i){let r,s;if(e)for(let n=0,o=e.length;n<o;n++){if(r=e.getItemAt(n),r[t]===i)return r;if("group"===r?.type&&(s=h(r.layers,t,i),s))return s}}const d=o.Z.getLogger("esri.support.LayersMixin"),p=e=>{let t=class extends e{constructor(...e){super(...e),this.layers=new s.Z;const t=e=>{e.parent=this,this.layerAdded(e),"elevation"!==e.type&&"base-elevation"!==e.type||d.error(`Layer 'title:${e.title}, id:${e.id}' of type '${e.type}' is not supported as an operational layer and will therefore be ignored.`)},i=e=>{e.parent=null,this.layerRemoved(e)};this.layers.on("before-add",(e=>(e=>{e.parent&&"remove"in e.parent&&e.parent.remove(e)})(e.item))),this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>i(e.item)))}destroy(){const e=this.layers.removeAll();for(const t of e)this.layerRemoved(t),t.destroy();this.layers.destroy()}set layers(e){this._set("layers",(0,n.Z)(e,this._get("layers")))}add(e,t){const i=this.layers;if(t=i.getNextIndex(t),e instanceof u.Z){const r=e;r.parent===this?this.reorder(r,t):i.add(r,t)}else(0,a.y8)(e)?e.then((e=>{this.destroyed||this.add(e,t)})):d.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const i=this.layers;t=i.getNextIndex(t),e.slice().forEach((e=>{e.parent!==this?(i.add(e,t),t+=1):this.reorder(e,t)}))}findLayerById(e){return h(this.layers,"id",e)}findLayerByUid(e){return h(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return(0,r._)([(0,l.Cb)()],t.prototype,"layers",null),t=(0,r._)([(0,c.j)("esri.support.LayersMixin")],t),t}},98234:(e,t,i)=>{"use strict";i.d(t,{Q:()=>d});var r=i(36663),s=i(41831),n=i(58811),o=i(13802),a=i(81977),l=(i(7753),i(39994),i(7283),i(40266));const c="esri.support.TablesMixin",u=o.Z.getLogger(c);function h(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const s=e.getItemAt(r);if(s[t]===i)return s;if("group"===s?.type){const e=h(s.tables,t,i);if(e)return e}}}const d=e=>{let t=class extends e{constructor(...e){super(...e),this.tables=new s.Z,this.tables.on("after-add",(e=>{const t=e.item;t.parent&&t.parent!==this&&"tables"in t.parent&&t.parent.tables.remove(t),t.parent=this,"feature"!==t.type&&u.error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as a table and will therefore be ignored.`)})),this.tables.on("after-remove",(e=>{e.item.parent=null}))}destroy(){const e=this.tables.removeAll();for(const t of e)t.destroy();this.tables.destroy()}set tables(e){this._set("tables",(0,n.Z)(e,this._get("tables")))}findTableById(e){return h(this.tables,"id",e)}findTableByUid(e){return h(this.tables,"uid",e)}};return(0,r._)([(0,a.Cb)()],t.prototype,"tables",null),t=(0,r._)([(0,l.j)(c)],t),t}},83258:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(53443),o=i(86618),a=i(81977),l=(i(7753),i(39994),i(7283),i(40266));let c=r=class extends((0,o.IG)(n.Z)){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new r({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};(0,s._)([(0,a.Cb)()],c.prototype,"active",void 0),(0,s._)([(0,a.Cb)()],c.prototype,"className",void 0),(0,s._)([(0,a.Cb)()],c.prototype,"disabled",void 0),(0,s._)([(0,a.Cb)()],c.prototype,"id",void 0),(0,s._)([(0,a.Cb)()],c.prototype,"indicator",void 0),(0,s._)([(0,a.Cb)()],c.prototype,"title",void 0),(0,s._)([(0,a.Cb)()],c.prototype,"type",void 0),(0,s._)([(0,a.Cb)()],c.prototype,"visible",void 0),c=r=(0,s._)([(0,l.j)("esri.support.actions.ActionBase")],c);const u=c},97837:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(83258);let l=r=class extends a.Z{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new r({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};(0,s._)([(0,n.Cb)()],l.prototype,"image",void 0),l=r=(0,s._)([(0,o.j)("esri.support.Action.ActionButton")],l);const c=l},15600:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(83258);let l=r=class extends a.Z{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new r({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};(0,s._)([(0,n.Cb)()],l.prototype,"image",void 0),(0,s._)([(0,n.Cb)()],l.prototype,"value",void 0),l=r=(0,s._)([(0,o.j)("esri.support.Action.ActionToggle")],l);const c=l},99522:(e,t,i)=>{"use strict";i.d(t,{r:()=>n});var r=i(3466);const s=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function n(e){const t=(0,r.P$)(e,!0);return t&&t.endsWith(".arcgis.com")&&!s.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}},30879:(e,t,i)=>{"use strict";i.d(t,{LC:()=>o,WW:()=>a,Yi:()=>l,mz:()=>u,pp:()=>c}),i(91957);var r=i(61681),s=i(14685);let n;function o(){return n||(n=(async()=>{const e=await i.e(1050).then(i.bind(i,61050));return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),n}const a=(e,t,i)=>u.create(e,t,i,null,["$feature"]),l=(e,t,i)=>u.create(e,t,i,null,["$feature","$view"]),c=(e,t,i,r)=>u.create(e,t,i,r,["$feature","$view"]);class u{constructor(e,t,i,r,s,n,o,a){this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=r,this._arcade=t,this._arcadeDictionary=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=t.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,t,i,n,a,l){const{arcade:c,Feature:h,Dictionary:d}=await o(),p=s.Z.fromJSON(t),f=c.parseScript(e,l),m=a.reduce(((e,t)=>({...e,[t]:null})),{});let g=null;(0,r.pC)(n)&&(g=new d(n),g.immutable=!0,m.$config=null);const y=c.scriptUsesGeometryEngine(f)&&c.enableGeometrySupport(),_=c.scriptUsesFeatureSet(f)&&c.enableFeatureSetSupport(),v=c.scriptIsAsync(f)&&c.enableAsyncSupport(),b={vars:m,spatialReference:p,useAsync:!!v},w=new d;w.immutable=!1,w.setField("scale",0);const x=c.compileScript(f,b);return await Promise.all([y,_,v]),new u(e,c,d,f,(e=>("$view"in e&&e.$view&&(w.setField("scale",e.$view.scale),e.$view=w),g&&(e.$config=g),x({vars:e,spatialReference:p}))),new h,i,p)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(e){return this._arcade.referencesMember(this._syntaxTree,e)}referencesFunction(e){return this._arcade.referencesFunction(this._syntaxTree,e)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}},2725:(e,t,i)=>{"use strict";i.d(t,{g:()=>n,s:()=>o});var r=i(36567),s=i(60720);async function n(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,i=await(0,s.ME)("esri/t9n/basemaps");return i[e]||i[t]}const o={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return(0,r.V)("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return(0,r.V)("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return(0,r.V)("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return(0,r.V)("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return(0,r.V)("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return(0,r.V)("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}}},42228:(e,t,i)=>{"use strict";i.d(t,{a:()=>s});var r=i(81739);function s(e){return new r.Z({getCollections:()=>[e.tables,e.layers],getChildrenFunction:e=>{const t=[];return"tables"in e&&t.push(e.tables),"layers"in e&&t.push(e.layers),t},itemFilterFunction:e=>{const t=e.parent;return t&&"tables"in t&&t.tables.includes(e)}})}},51622:(e,t,i)=>{"use strict";i.d(t,{K:()=>s,h:()=>n});var r=i(39994);const s=()=>!!(0,r.Z)("enable-feature:force-wosr"),n=()=>!!(0,r.Z)("enable-feature:direct-3d-object-feature-layer-display")},10171:(e,t,i)=>{"use strict";i.d(t,{eZ:()=>h});var r=i(80020),s=i(17095),n=i(24834),o=(i(17814),i(15902),i(32776),i(29893)),a=(i(21363),i(58106),i(78213)),l=i(98822);const c=["oid","global-id"],u=["oid","global-id","guid"];function h({displayField:e,editFieldsInfo:t,fields:i,objectIdField:l,title:c},u){if(!i)return null;const h=function({editFieldsInfo:e,fields:t,objectIdField:i},r){return function(e,t){const i=e;return t&&(e=e.filter((e=>!t.includes(e.type)))),e===i&&(e=e.slice()),e.sort(f),e}(t,r?.ignoreFieldTypes||v).map((t=>new a.Z({fieldName:t.name,isEditable:g(t,e),label:t.alias,format:y(t),visible:p(t,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r?.visibleFieldNames})})))}({editFieldsInfo:t,fields:i,objectIdField:l},u);if(!h.length)return null;const d=function(e){const t=(0,s.O5)(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}({titleBase:c,fields:i,displayField:e}),m=[new o.Z,new n.Z];return new r.Z({title:d,content:m,fieldInfos:h})}const d=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],p=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!(m(e.name,t)||i&&e.name===i||c.includes(e.type)||d.some((t=>t.test(e.name))));function f(e,t){return"oid"===e.type?-1:"oid"===t.type?1:_(e)?-1:_(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function m(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function g(e,t){return e.editable&&!u.includes(e.type)&&!m(e.name,t)}function y(e){switch(e.type){case"small-integer":case"integer":case"single":return new l.Z({digitSeparator:!0,places:0});case"double":return new l.Z({digitSeparator:!0,places:2});case"date":return new l.Z({dateFormat:"long-month-day-year"});default:return"string"===e.type&&(0,s.Ec)(e.name)?new l.Z({digitSeparator:!0,places:0}):null}}function _(e){return"name"===(e.name&&e.name.toLowerCase())||"name"===(e.alias&&e.alias.toLowerCase())||void 0}const v=["geometry","blob","raster","guid","xml"]},44883:(e,t,i)=>{"use strict";i.d(t,{t:()=>s});var r=i(66341);async function s(e,t){const{data:i}=await(0,r.default)(e,{responseType:"image",...t});return i}},73401:(e,t,i)=>{"use strict";i.d(t,{Hu:()=>u,fY:()=>l,jH:()=>h,jz:()=>d});var r=i(51366),s=i(39994),n=i(61681),o=i(78668),a=i(3466);function l(e,t,i=!1,r){return new Promise(((a,l)=>{if((0,o.Hc)(r))return void l(c());let u=()=>{p(),l(new Error(`Unable to load ${t}`))},h=()=>{const t=e;p(),a(t)},d=()=>{if(!e)return;const t=e;p(),t.src="",l(c())};const p=()=>{(0,s.Z)("esri-image-decode")||(e.removeEventListener("error",u),e.removeEventListener("load",h)),u=null,h=null,e=null,(0,n.pC)(r)&&r.removeEventListener("abort",d),d=null,i&&URL.revokeObjectURL(t)};(0,n.pC)(r)&&r.addEventListener("abort",d),(0,s.Z)("esri-image-decode")?e.decode().then(h,u):(e.addEventListener("error",u),e.addEventListener("load",h))}))}function c(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function u(e){r.Z.request.crossOriginNoCorsDomains||(r.Z.request.crossOriginNoCorsDomains={});const t=r.Z.request.crossOriginNoCorsDomains;for(let i of e)i=i.toLowerCase(),/^https?:\/\//.test(i)?t[(0,a.P$)(i)]=0:(t[(0,a.P$)("http://"+i)]=0,t[(0,a.P$)("https://"+i)]=0)}function h(e){const t=r.Z.request.crossOriginNoCorsDomains;if(t){let i=(0,a.P$)(e);if(i)return i=i.toLowerCase(),!(0,a.D6)(i,(0,a.TI)())&&t[i]<Date.now()-36e5}return!1}async function d(e){const t=r.Z.request.crossOriginNoCorsDomains;t&&(t[(0,a.P$)(e).toLowerCase()]=Date.now());const i=(0,a.mN)(e);e=i.path,"json"===i.query?.f&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}},9870:(e,t,i)=>{"use strict";i.d(t,{$:()=>s,r:()=>r});const r="20220708",s="7fd01dbc0e83d753fcf101c8ff2a8d215430252d"},3368:(e,t,i)=>{"use strict";i.d(t,{$o:()=>s,V$:()=>o});const r="calcite-theme-";function s(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"").startsWith("dark")}function n(){return`${r}${s()?"dark":"light"}`}function o(e){a(e),e.classList.add(n())}function a(e){Array.from(e.classList).forEach((t=>{t.startsWith(r)&&e.classList.remove(t)}))}},4905:(e,t,i)=>{"use strict";i.d(t,{se:()=>U,cT:()=>O,dU:()=>R,S9:()=>L,LB:()=>P,AH:()=>I,yK:()=>N,S6:()=>k,QT:()=>D,f_:()=>F});var r,s=i(7283),n=i(3593),o=i(62589),a=(i(61914),i(7842)),l=(i(88283),i(5975),i(80419),i(63295)),c=i(62063),u=(i(60076),i(54734),i(83849)),h=(i(25463),i(22162),i(36663)),d=i(67134),p=i(95550),f=i(81977),m=i(79438),g=i(40266),y=i(59551);let _=r=class extends a.Z{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&"string"!=typeof e&&null==e.imageData)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),null!=i&&(s.width=(0,p.t_)(i)),null!=r&&(s.height=(0,p.t_)(r)),s}clone(){const e=new r({color:(0,d.d9)(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",(0,d.d9)(this.source)),e}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};(0,h._)([(0,m.J)({esriPFS:"picture-fill"},{readOnly:!0})],_.prototype,"type",void 0),(0,h._)([(0,f.Cb)(y.KA)],_.prototype,"url",void 0),(0,h._)([(0,f.Cb)({type:Number,json:{write:!0}})],_.prototype,"xscale",void 0),(0,h._)([(0,f.Cb)({type:Number,json:{write:!0}})],_.prototype,"yscale",void 0),(0,h._)([(0,f.Cb)({type:Number,cast:p.t_,json:{write:!0}})],_.prototype,"width",void 0),(0,h._)([(0,f.Cb)({type:Number,cast:p.t_,json:{write:!0}})],_.prototype,"height",void 0),(0,h._)([(0,f.Cb)({type:Number,cast:p.t_,json:{write:!0}})],_.prototype,"xoffset",void 0),(0,h._)([(0,f.Cb)({type:Number,cast:p.t_,json:{write:!0}})],_.prototype,"yoffset",void 0),(0,h._)([(0,f.Cb)(y.Ds)],_.prototype,"source",void 0),_=r=(0,h._)([(0,g.j)("esri.symbols.PictureFillSymbol")],_);const v=_;var b=i(86036),w=i(60378),x=i(57770),C=i(43411),T=i(15498),S=i(1759),E=i(18251),A=(i(59834),i(87560),i(27624)),M=(i(69996),i(60171),i(27948));function O(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function R(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}i(62179),i(52331);const P={base:E.Z,key:"type",typeMap:{"simple-fill":C.Z,"picture-fill":v,"picture-marker":b.Z,"simple-line":T.Z,"simple-marker":S.Z,text:A.Z,"label-3d":l.Z,"line-3d":c.Z,"mesh-3d":u.Z,"point-3d":w.Z,"polygon-3d":x.Z,"web-style":M.Z,cim:o.Z},errorContext:"symbol"},I={base:E.Z,key:"type",typeMap:{"picture-marker":b.Z,"simple-marker":S.Z,text:A.Z,"web-style":M.Z,cim:o.Z},errorContext:"symbol"},L=(0,n.d)({types:P}),D={base:E.Z,key:"type",typeMap:{"simple-fill":C.Z,"picture-fill":v,"picture-marker":b.Z,"simple-line":T.Z,"simple-marker":S.Z,text:A.Z,"line-3d":c.Z,"mesh-3d":u.Z,"point-3d":w.Z,"polygon-3d":x.Z,"web-style":M.Z,cim:o.Z},errorContext:"symbol"},N={base:E.Z,key:"type",typeMap:{text:A.Z,"label-3d":l.Z},errorContext:"symbol"},F=(E.Z,l.Z,c.Z,u.Z,w.Z,x.Z,M.Z,{base:E.Z,key:"type",typeMap:{"line-3d":c.Z,"mesh-3d":u.Z,"point-3d":w.Z,"polygon-3d":x.Z,"web-style":M.Z,cim:o.Z},errorContext:"symbol"}),k={base:E.Z,key:"type",typeMap:{"label-3d":l.Z},errorContext:"symbol"},U=(0,s.N7)(P)},62589:(e,t,i)=>{"use strict";i.d(t,{Z:()=>m});var r,s=i(36663),n=i(67134),o=i(21130),a=i(81977),l=(i(7283),i(79438)),c=i(34248),u=i(40266),h=i(39835),d=i(17095),p=i(18251);let f=r=class extends p.Z{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){if("CIMSymbolReference"===this.data.type){const i=this.data.primitiveOverrides;if(i){const r=i.map((i=>{const r=i.valueExpressionInfo;return(0,d.io)(e,t,r.expression)}));await Promise.all(r)}}}clone(){return new r({data:(0,n.d9)(this.data)})}hash(){return(0,o.hP)(JSON.stringify(this.data)).toString()}};(0,s._)([(0,a.Cb)({json:{write:!1}})],f.prototype,"color",void 0),(0,s._)([(0,a.Cb)({json:{write:!0}})],f.prototype,"data",void 0),(0,s._)([(0,c.r)("data",["symbol"])],f.prototype,"readData",null),(0,s._)([(0,h.c)("data",{})],f.prototype,"writeData",null),(0,s._)([(0,l.J)({CIMSymbolReference:"cim"},{readOnly:!0})],f.prototype,"type",void 0),f=r=(0,s._)([(0,u.j)("esri.symbols.CIMSymbol")],f);const m=f},61914:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r,s=i(36663),n=i(61681),o=i(81977),a=(i(7753),i(39994),i(7283),i(79438)),l=i(40266),c=i(87560),u=i(44874),h=i(57403);let d=r=class extends c.Z{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new r({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:(0,n.pC)(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};(0,s._)([(0,a.J)({Extrude:"extrude"},{readOnly:!0})],d.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],d.prototype,"size",void 0),(0,s._)([(0,o.Cb)({type:h.b,json:{write:!0}})],d.prototype,"material",void 0),(0,s._)([(0,o.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],d.prototype,"castShadows",void 0),(0,s._)([(0,o.Cb)(u.Z)],d.prototype,"edges",void 0),d=r=(0,s._)([(0,l.j)("esri.symbols.ExtrudeSymbol3DLayer")],d);const p=d},7842:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r=i(36663),s=i(81977),n=(i(7753),i(39994),i(7283),i(40266)),o=i(15498),a=i(18251);let l=class extends a.Z{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};(0,r._)([(0,s.Cb)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":o.Z}},json:{default:null,write:!0}})],l.prototype,"outline",void 0),(0,r._)([(0,s.Cb)({type:["simple-fill","picture-fill"],readOnly:!0})],l.prototype,"type",void 0),l=(0,r._)([(0,n.j)("esri.symbols.FillSymbol")],l);const c=l},88283:(e,t,i)=>{"use strict";i.d(t,{Z:()=>E});var r,s=i(36663),n=i(61681),o=i(81977),a=(i(7753),i(39994),i(7283),i(79438)),l=i(40266),c=i(87560),u=i(44874),h=i(17615),d=i(93935),p=i(42871),f=i(86342),m=(i(13802),i(33156),i(57403));let g=r=class extends m.b{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:(0,n.pC)(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new r(e)}};(0,s._)([(0,a.J)({multiply:"multiply",replace:"replace",tint:"tint"})],g.prototype,"colorMixMode",void 0),g=r=(0,s._)([(0,l.j)("esri.symbols.support.Symbol3DFillMaterial")],g);var y,_=i(30936),v=i(82064),b=i(95550),w=i(50264),x=i(19049);let C=y=class extends v.wq{constructor(e){super(e),this.color=new _.Z([0,0,0,1]),this.size=(0,b.Wz)(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:(0,n.pC)(this.color)?this.color.clone():null,size:this.size,pattern:(0,n.pC)(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new y(e)}};var T;(0,s._)([(0,o.Cb)(w.a)],C.prototype,"color",void 0),(0,s._)([(0,o.Cb)(w.y)],C.prototype,"size",void 0),(0,s._)([(0,o.Cb)(p.D)],C.prototype,"pattern",void 0),(0,s._)([(0,o.Cb)({type:x.Hc,json:{default:"butt",write:{overridePolicy(){return{enabled:(0,n.pC)(this.pattern)}}}}})],C.prototype,"patternCap",void 0),C=y=(0,s._)([(0,l.j)("esri.symbols.support.Symbol3DOutline")],C);let S=T=class extends c.Z{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:(0,n.pC)(this.edges)?this.edges.clone():null,enabled:this.enabled,material:(0,n.pC)(this.material)?this.material.clone():null,pattern:(0,n.pC)(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:(0,n.pC)(this.outline)?this.outline.clone():null};return new T(e)}static fromSimpleFillSymbol(e){const t=e.outline&&e.outline.style&&"inside-frame"!==e.outline.style&&"solid"!==e.outline.style?new h.Z({style:e.outline.style}):null,i={size:e.outline?.width??0,color:(e.outline?.color??f.ix).clone(),pattern:t};return t&&e.outline?.cap&&(i.patternCap=e.outline.cap),new T({material:new g({color:(e.color??f.l9).clone()}),pattern:e.style&&"solid"!==e.style?new d.Z({style:e.style}):null,outline:i})}};(0,s._)([(0,a.J)({Fill:"fill"},{readOnly:!0})],S.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:g,json:{write:!0}})],S.prototype,"material",void 0),(0,s._)([(0,o.Cb)(p.q)],S.prototype,"pattern",void 0),(0,s._)([(0,o.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],S.prototype,"castShadows",void 0),(0,s._)([(0,o.Cb)({type:C,json:{write:!0}})],S.prototype,"outline",void 0),(0,s._)([(0,o.Cb)(u.Z)],S.prototype,"edges",void 0),S=T=(0,s._)([(0,l.j)("esri.symbols.FillSymbol3DLayer")],S);const E=S},5975:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var r,s=i(36663),n=i(82064),o=i(95550),a=i(81977),l=(i(7753),i(39994),i(69236)),c=i(40266),u=i(63659);let h=r=class extends n.wq{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return(0,o.t_)(e)}clone(){return new r({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};(0,s._)([(0,a.Cb)({type:u.JT,json:{default:"none",write:!0}})],h.prototype,"decoration",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],h.prototype,"family",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],h.prototype,"size",void 0),(0,s._)([(0,l.p)("size")],h.prototype,"castSize",null),(0,s._)([(0,a.Cb)({type:u.g6,json:{default:"normal",write:!0}})],h.prototype,"style",void 0),(0,s._)([(0,a.Cb)({type:u.vC,json:{default:"normal",write:!0}})],h.prototype,"weight",void 0),h=r=(0,s._)([(0,c.j)("esri.symbols.Font")],h);const d=h},80419:(e,t,i)=>{"use strict";i.d(t,{Z:()=>M});var r,s=i(36663),n=i(13802),o=i(61681),a=i(3466),l=i(81977),c=(i(7753),i(39994),i(7283),i(79438)),u=i(40266),h=i(87560),d=i(86342),p=i(52285),f=i(50264),m=i(37939),g=i(30936),y=i(82064),_=i(95550);let v=r=class extends y.wq{constructor(e){super(e),this.color=new g.Z([0,0,0,1]),this.size=(0,_.Wz)(1)}clone(){const e={color:(0,o.pC)(this.color)?this.color.clone():null,size:this.size};return new r(e)}};(0,s._)([(0,l.Cb)(f.a)],v.prototype,"color",void 0),(0,s._)([(0,l.Cb)(f.y)],v.prototype,"size",void 0),v=r=(0,s._)([(0,u.j)("esri.symbols.support.Symbol3DIconOutline")],v);var b,w=i(57403);const x=n.Z.getLogger("esri.symbols.IconSymbol3DLayer");let C=b=class extends h.Z{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new b({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:(0,o.pC)(this.material)?this.material.clone():null,outline:(0,o.pC)(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||d.ix,i=T(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||d.ix).clone()}:null;return new b({size:e.size,resource:{primitive:A(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||(0,d.rx)(e.color)?d.ix:e.color,i=T(e);return new b({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new b({resource:{href:(0,a._l)({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function T(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=S(e.xoffset),s=S(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function S(e){return isFinite(e)?e:0}(0,s._)([(0,l.Cb)({type:w.b,json:{write:!0}})],C.prototype,"material",void 0),(0,s._)([(0,l.Cb)({type:p.b,json:{write:!0}})],C.prototype,"resource",void 0),(0,s._)([(0,c.J)({Icon:"icon"},{readOnly:!0})],C.prototype,"type",void 0),(0,s._)([(0,l.Cb)(f.y)],C.prototype,"size",void 0),(0,s._)([(0,c.J)({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),(0,l.Cb)({json:{default:"center"}})],C.prototype,"anchor",void 0),(0,s._)([(0,l.Cb)({type:m.e,json:{type:[Number],read:{reader:e=>new m.e({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],C.prototype,"anchorPosition",void 0),(0,s._)([(0,l.Cb)({type:v,json:{write:!0}})],C.prototype,"outline",void 0),C=b=(0,s._)([(0,u.j)("esri.symbols.IconSymbol3DLayer")],C);const E={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function A(e){return E[e]||(x.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const M=C},63295:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r,s=i(36663),n=i(41831),o=i(67134),a=i(81977),l=(i(7283),i(79438)),c=i(40266),u=i(59834),h=i(69996),d=i(94984),p=i(2571);const f=n.Z.ofType({base:null,key:"type",typeMap:{text:h.Z}});let m=r=class extends u.Z{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new f,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return(0,d.gv)(this)}hasVisibleVerticalOffset(){return(0,d.Uy)(this)}clone(){return new r({styleOrigin:(0,o.d9)(this.styleOrigin),symbolLayers:(0,o.d9)(this.symbolLayers),thumbnail:(0,o.d9)(this.thumbnail),callout:(0,o.d9)(this.callout),verticalOffset:(0,o.d9)(this.verticalOffset)})}static fromTextSymbol(e){return new r({symbolLayers:[h.Z.fromTextSymbol(e)]})}};(0,s._)([(0,a.Cb)({type:p._,json:{write:!0}})],m.prototype,"verticalOffset",void 0),(0,s._)([(0,a.Cb)(d.Y2)],m.prototype,"callout",void 0),(0,s._)([(0,a.Cb)({json:{read:!1,write:!1}})],m.prototype,"styleOrigin",void 0),(0,s._)([(0,a.Cb)({type:f})],m.prototype,"symbolLayers",void 0),(0,s._)([(0,l.J)({LabelSymbol3D:"label-3d"},{readOnly:!0})],m.prototype,"type",void 0),m=r=(0,s._)([(0,c.j)("esri.symbols.LabelSymbol3D")],m);const g=m},62063:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r,s=i(36663),n=i(41831),o=i(67134),a=i(81977),l=(i(7283),i(79438)),c=i(40266),u=i(60076),h=i(22162),d=i(59834);const p=n.Z.ofType({base:null,key:"type",typeMap:{line:u.Z,path:h.Z}}),f=n.Z.ofType({base:null,key:"type",typeMap:{line:u.Z,path:h.Z}});let m=r=class extends d.Z{constructor(e){super(e),this.symbolLayers=new p,this.type="line-3d"}clone(){return new r({styleOrigin:(0,o.d9)(this.styleOrigin),symbolLayers:(0,o.d9)(this.symbolLayers),thumbnail:(0,o.d9)(this.thumbnail)})}static fromSimpleLineSymbol(e){return new r({symbolLayers:[u.Z.fromSimpleLineSymbol(e)]})}};(0,s._)([(0,a.Cb)({type:p,json:{type:f}})],m.prototype,"symbolLayers",void 0),(0,s._)([(0,l.J)({LineSymbol3D:"line-3d"},{readOnly:!0})],m.prototype,"type",void 0),m=r=(0,s._)([(0,c.j)("esri.symbols.LineSymbol3D")],m);const g=m},60076:(e,t,i)=>{"use strict";i.d(t,{Z:()=>S});var r=i(36663),s=i(61681),n=i(95550),o=i(81977),a=(i(7753),i(39994),i(7283)),l=i(79438),c=i(40266),u=i(30936),h=i(41151),d=i(82064),p=i(4142);let f=class extends((0,h.J)(d.wq)){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return(0,s.pC)(e)&&e.placement===this.placement&&e.style===this.style&&((0,s.Wi)(this.color)&&(0,s.Wi)(e.color)||(0,s.pC)(this.color)&&(0,s.pC)(e.color)&&this.color.toJSON()===e.color.toJSON())}};(0,r._)([(0,o.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],f.prototype,"type",void 0),(0,r._)([(0,o.Cb)({type:p.J,json:{default:"begin-end",write:!0}})],f.prototype,"placement",void 0),(0,r._)([(0,o.Cb)({type:p.k,json:{default:"arrow",write:!0}})],f.prototype,"style",void 0),(0,r._)([(0,o.Cb)({type:u.Z,json:{type:[a.z8],default:null,write:!0}})],f.prototype,"color",void 0),f=(0,r._)([(0,c.j)("esri.symbols.LineStyleMarker3D")],f);const m=f;var g,y=i(87560),_=i(17615),v=i(42871),b=i(86342),w=i(50264),x=i(57403),C=i(19049);let T=g=class extends y.Z{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=(0,n.Wz)(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:(0,s.pC)(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:(0,s.pC)(this.pattern)?this.pattern.clone():null,marker:(0,s.pC)(this.marker)?this.marker.clone():null};return new g(e)}static fromSimpleLineSymbol(e){const t={enabled:!0,size:e.width??(0,n.Wz)(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&"inside-frame"!==e.style?new _.Z({style:e.style}):null,material:new x.b({color:(e.color||b.ix).clone()}),marker:e.marker?new m({placement:e.marker.placement,style:e.marker.style,color:e.marker.color?.clone()??null}):null};return new g(t)}};(0,r._)([(0,o.Cb)({type:x.b,json:{write:!0}})],T.prototype,"material",void 0),(0,r._)([(0,l.J)({Line:"line"},{readOnly:!0})],T.prototype,"type",void 0),(0,r._)([(0,o.Cb)({type:C.w2,json:{write:!0,default:"miter"}})],T.prototype,"join",void 0),(0,r._)([(0,o.Cb)({type:C.Hc,json:{write:!0,default:"butt"}})],T.prototype,"cap",void 0),(0,r._)([(0,o.Cb)(w.y)],T.prototype,"size",void 0),(0,r._)([(0,o.Cb)(v.D)],T.prototype,"pattern",void 0),(0,r._)([(0,o.Cb)({types:{key:"type",base:m,typeMap:{style:m}},json:{write:!0}})],T.prototype,"marker",void 0),T=g=(0,r._)([(0,c.j)("esri.symbols.LineSymbol3DLayer")],T);const S=T},54734:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r=i(36663),s=i(95550),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(18251);let l=class extends a.Z{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};(0,r._)([(0,n.Cb)({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],l.prototype,"angle",void 0),(0,r._)([(0,n.Cb)({type:["simple-marker","picture-marker"],readOnly:!0})],l.prototype,"type",void 0),(0,r._)([(0,n.Cb)({type:Number,cast:s.t_,json:{write:!0}})],l.prototype,"xoffset",void 0),(0,r._)([(0,n.Cb)({type:Number,cast:s.t_,json:{write:!0}})],l.prototype,"yoffset",void 0),(0,r._)([(0,n.Cb)({type:Number,cast:e=>"auto"===e?e:(0,s.t_)(e),json:{write:!0}})],l.prototype,"size",void 0),l=(0,r._)([(0,o.j)("esri.symbols.MarkerSymbol")],l);const c=l},83849:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r,s=i(36663),n=i(41831),o=i(67134),a=i(81977),l=(i(7283),i(79438)),c=i(40266),u=i(88283),h=i(59834);const d=n.Z.ofType({base:null,key:"type",typeMap:{fill:u.Z}});let p=r=class extends h.Z{constructor(e){super(e),this.symbolLayers=new d,this.type="mesh-3d"}clone(){return new r({styleOrigin:(0,o.d9)(this.styleOrigin),symbolLayers:(0,o.d9)(this.symbolLayers),thumbnail:(0,o.d9)(this.thumbnail)})}};(0,s._)([(0,a.Cb)({type:d})],p.prototype,"symbolLayers",void 0),(0,s._)([(0,l.J)({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],p.prototype,"type",void 0),p=r=(0,s._)([(0,c.j)("esri.symbols.MeshSymbol3D")],p);const f=p},25463:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r,s=i(36663),n=i(61681),o=i(81977),a=(i(7753),i(39994),i(7283),i(79438)),l=i(40266),c=i(87560),u=i(4125),h=i(53443);let d=r=class extends h.Z{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new r({x:this.x,y:this.y,z:this.z})}};(0,s._)([(0,o.Cb)({type:Number})],d.prototype,"x",void 0),(0,s._)([(0,o.Cb)({type:Number})],d.prototype,"y",void 0),(0,s._)([(0,o.Cb)({type:Number})],d.prototype,"z",void 0),d=r=(0,s._)([(0,l.j)("esri.symbols.support.Symbol3DAnchorPosition3D")],d);var p,f=i(57403);let m=p=class extends c.Z{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new p({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:(0,n.pC)(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||"string"!=typeof this.resource.href}};(0,s._)([(0,o.Cb)({type:f.b,json:{write:!0}})],m.prototype,"material",void 0),(0,s._)([(0,o.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],m.prototype,"castShadows",void 0),(0,s._)([(0,o.Cb)({type:u.k,json:{write:!0}})],m.prototype,"resource",void 0),(0,s._)([(0,a.J)({Object:"object"},{readOnly:!0})],m.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],m.prototype,"width",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],m.prototype,"height",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],m.prototype,"depth",void 0),(0,s._)([(0,a.J)({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),(0,o.Cb)({json:{default:"origin"}})],m.prototype,"anchor",void 0),(0,s._)([(0,o.Cb)({type:d,json:{type:[Number],read:{reader:e=>new d({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],m.prototype,"anchorPosition",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],m.prototype,"heading",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],m.prototype,"tilt",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],m.prototype,"roll",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],m.prototype,"isPrimitive",null),m=p=(0,s._)([(0,l.j)("esri.symbols.ObjectSymbol3DLayer")],m);const g=m},22162:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r,s=i(36663),n=i(61681),o=i(81977),a=(i(7753),i(39994),i(7283),i(79438)),l=i(34248),c=i(40266),u=i(87560),h=i(57403),d=i(19049);let p=r=class extends u.Z{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return null!=e?e:null==t.height&&null!=t.size?t.size:void 0}readHeight(e,t){return null!=e?e:null==t.width&&null!=t.size?t.size:void 0}clone(){return new r({enabled:this.enabled,material:(0,n.pC)(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};(0,s._)([(0,o.Cb)({type:h.b,json:{write:!0}})],p.prototype,"material",void 0),(0,s._)([(0,o.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],p.prototype,"castShadows",void 0),(0,s._)([(0,a.J)({Path:"path"},{readOnly:!0})],p.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:["circle","quad"],json:{write:!0,default:"circle"}})],p.prototype,"profile",void 0),(0,s._)([(0,o.Cb)({type:d.w2,json:{write:!0,default:"miter"}})],p.prototype,"join",void 0),(0,s._)([(0,o.Cb)({type:d.KW,json:{write:!0,default:"butt"}})],p.prototype,"cap",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],p.prototype,"width",void 0),(0,s._)([(0,l.r)("width",["width","size","height"])],p.prototype,"readWidth",null),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],p.prototype,"height",void 0),(0,s._)([(0,l.r)("height",["height","size","width"])],p.prototype,"readHeight",null),(0,s._)([(0,o.Cb)({type:["center","bottom","top"],json:{write:!0,default:"center"}})],p.prototype,"anchor",void 0),(0,s._)([(0,o.Cb)({type:["heading","all"],json:{write:!0,default:"all"}})],p.prototype,"profileRotation",void 0),p=r=(0,s._)([(0,c.j)("esri.symbols.PathSymbol3DLayer")],p);const f=p},86036:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r,s=i(36663),n=i(67134),o=i(95550),a=i(81977),l=(i(7283),i(79438)),c=i(34248),u=i(40266),h=i(54734),d=i(59551);let p=r=class extends h.Z{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&"string"!=typeof e&&null==e.imageData)return e;const r={};return e&&(r.url=e),null!=t&&(r.width=(0,o.t_)(t)),null!=i&&(r.height=(0,o.t_)(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new r({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",(0,n.d9)(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};(0,s._)([(0,a.Cb)({json:{write:!1}})],p.prototype,"color",void 0),(0,s._)([(0,l.J)({esriPMS:"picture-marker"},{readOnly:!0})],p.prototype,"type",void 0),(0,s._)([(0,a.Cb)(d.KA)],p.prototype,"url",void 0),(0,s._)([(0,a.Cb)(d.Ds)],p.prototype,"source",void 0),(0,s._)([(0,a.Cb)({type:Number,cast:o.t_,json:{write:!0}})],p.prototype,"height",void 0),(0,s._)([(0,c.r)("height",["height","size"])],p.prototype,"readHeight",null),(0,s._)([(0,a.Cb)({type:Number,cast:o.t_,json:{write:!0}})],p.prototype,"width",void 0),(0,s._)([(0,a.Cb)({json:{write:!1}})],p.prototype,"size",void 0),p=r=(0,s._)([(0,u.j)("esri.symbols.PictureMarkerSymbol")],p);const f=p},60378:(e,t,i)=>{"use strict";i.d(t,{Z:()=>_});var r,s=i(36663),n=i(41831),o=i(67134),a=i(81977),l=(i(7283),i(79438)),c=i(40266),u=i(80419),h=i(25463),d=i(59834),p=i(69996),f=i(94984),m=i(2571);const g=n.Z.ofType({base:null,key:"type",typeMap:{icon:u.Z,object:h.Z,text:p.Z}});let y=r=class extends d.Z{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new g,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return(0,f.gv)(this)}hasVisibleVerticalOffset(){return(0,f.Uy)(this)}clone(){return new r({verticalOffset:(0,o.d9)(this.verticalOffset),callout:(0,o.d9)(this.callout),styleOrigin:(0,o.d9)(this.styleOrigin),symbolLayers:(0,o.d9)(this.symbolLayers),thumbnail:(0,o.d9)(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new r({symbolLayers:[u.Z.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new r({symbolLayers:[u.Z.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){const t=e.data?.symbol?.type;return"CIMPointSymbol"!==t?null:e.data.symbol.callout?new r({symbolLayers:[u.Z.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new r({symbolLayers:[u.Z.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new r({symbolLayers:[p.Z.fromTextSymbol(e)]})}};(0,s._)([(0,a.Cb)({type:m._,json:{write:!0}})],y.prototype,"verticalOffset",void 0),(0,s._)([(0,a.Cb)(f.Y2)],y.prototype,"callout",void 0),(0,s._)([(0,a.Cb)({type:g,json:{origins:{"web-scene":{write:!0}}}})],y.prototype,"symbolLayers",void 0),(0,s._)([(0,l.J)({PointSymbol3D:"point-3d"},{readOnly:!0})],y.prototype,"type",void 0),y=r=(0,s._)([(0,c.j)("esri.symbols.PointSymbol3D")],y);const _=y},57770:(e,t,i)=>{"use strict";i.d(t,{Z:()=>w});var r,s=i(36663),n=i(41831),o=i(67134),a=i(61681),l=i(81977),c=(i(7283),i(79438)),u=i(40266),h=i(61914),d=i(88283),p=i(80419),f=i(60076),m=i(25463),g=i(59834),y=i(69996),_=i(60171);const v=n.Z.ofType({base:null,key:"type",typeMap:{extrude:h.Z,fill:d.Z,icon:p.Z,line:f.Z,object:m.Z,text:y.Z,water:_.Z}});let b=r=class extends g.Z{constructor(e){super(e),this.symbolLayers=new v,this.type="polygon-3d"}clone(){return new r({styleOrigin:(0,o.d9)(this.styleOrigin),symbolLayers:(0,o.d9)(this.symbolLayers),thumbnail:(0,o.d9)(this.thumbnail)})}static fromJSON(e){const t=new r;if(t.read(e),2===t.symbolLayers.length&&"fill"===t.symbolLayers.getItemAt(0).type&&"line"===t.symbolLayers.getItemAt(1).type){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&!1===e.symbolLayers[1].enable||(i.outline={size:r.size,color:(0,a.pC)(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new r({symbolLayers:[d.Z.fromSimpleFillSymbol(e)]})}};(0,s._)([(0,l.Cb)({type:v,json:{write:!0}})],b.prototype,"symbolLayers",void 0),(0,s._)([(0,c.J)({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],b.prototype,"type",void 0),b=r=(0,s._)([(0,u.j)("esri.symbols.PolygonSymbol3D")],b);const w=b},43411:(e,t,i)=>{"use strict";i.d(t,{Z:()=>m});var r,s=i(36663),n=i(30936),o=i(25709),a=i(67134),l=i(81977),c=(i(7283),i(79438)),u=i(40266),h=i(7842),d=i(15498);const p=new o.X({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let f=r=class extends h.Z{constructor(...e){super(...e),this.color=new n.Z([0,0,0,.25]),this.outline=new d.Z,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&"string"!=typeof e)return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new r({color:(0,a.d9)(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};(0,s._)([(0,l.Cb)()],f.prototype,"color",void 0),(0,s._)([(0,l.Cb)()],f.prototype,"outline",void 0),(0,s._)([(0,c.J)({esriSFS:"simple-fill"},{readOnly:!0})],f.prototype,"type",void 0),(0,s._)([(0,l.Cb)({type:p.apiValues,json:{read:p.read,write:p.write}})],f.prototype,"style",void 0),f=r=(0,s._)([(0,u.j)("esri.symbols.SimpleFillSymbol")],f);const m=f},15498:(e,t,i)=>{"use strict";i.d(t,{Z:()=>T});var r=i(36663),s=i(25709),n=i(67134),o=i(95550),a=i(81977),l=(i(7283),i(79438)),c=i(40266),u=(i(7753),i(39994),i(18251));let h=class extends u.Z{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};(0,r._)([(0,l.J)({esriSLS:"simple-line"},{readOnly:!0})],h.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:Number,cast:o.t_,json:{write:!0}})],h.prototype,"width",void 0),h=(0,r._)([(0,c.j)("esri.symbols.LineSymbol")],h);const d=h;var p,f=i(30936),m=i(82064),g=i(34248),y=i(39835),_=i(4142);let v=p=class extends m.wq{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){t[i]="web-map"===r?.origin?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){"web-map"===r?.origin||(t[i]=e)}clone(){return new p({color:(0,n.d9)(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};(0,r._)([(0,a.Cb)({type:["begin","end","begin-end"],json:{write:!0}})],v.prototype,"placement",void 0),(0,r._)([(0,l.J)({"line-marker":"line-marker"},{readOnly:!0}),(0,a.Cb)({json:{origins:{"web-map":{write:!1}}}})],v.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:_.k})],v.prototype,"style",void 0),(0,r._)([(0,y.c)("style")],v.prototype,"writeStyle",null),(0,r._)([(0,a.Cb)({type:f.Z,value:null,json:{write:{allowNull:!0}}})],v.prototype,"color",null),(0,r._)([(0,g.r)("color")],v.prototype,"readColor",null),(0,r._)([(0,y.c)("color")],v.prototype,"writeColor",null),v=p=(0,r._)([(0,c.j)("esri.symbols.LineSymbolMarker")],v);const b=v;var w;const x=new s.X({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let C=w=class extends d{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&"string"!=typeof e)return e;const a={};return null!=e&&(a.style=e),null!=t&&(a.color=t),null!=i&&(a.width=(0,o.t_)(i)),null!=r&&(a.cap=r),null!=s&&(a.join=s),null!=n&&(a.miterLimit=(0,o.t_)(n)),a}clone(){return new w({color:(0,n.d9)(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};(0,r._)([(0,l.J)({esriSLS:"simple-line"},{readOnly:!0})],C.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:x.apiValues,json:{read:x.read,write:x.write}})],C.prototype,"style",void 0),(0,r._)([(0,a.Cb)({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:"round"!==e&&(null==i||null==i.origin)})}}})],C.prototype,"cap",void 0),(0,r._)([(0,a.Cb)({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:"round"!==e&&(null==i||null==i.origin)})}}})],C.prototype,"join",void 0),(0,r._)([(0,a.Cb)({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":b}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],C.prototype,"marker",void 0),(0,r._)([(0,a.Cb)({type:Number,json:{read:!1,write:!1}})],C.prototype,"miterLimit",void 0),C=w=(0,r._)([(0,c.j)("esri.symbols.SimpleLineSymbol")],C);const T=C},1759:(e,t,i)=>{"use strict";i.d(t,{Z:()=>y});var r,s=i(36663),n=i(30936),o=i(25709),a=i(67134),l=i(95550),c=i(81977),u=(i(7283),i(79438)),h=i(40266),d=i(39835),p=i(54734),f=i(15498);const m=new o.X({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let g=r=class extends p.Z{constructor(...e){super(...e),this.color=new n.Z([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new f.Z}normalizeCtorArgs(e,t,i,r){if(e&&"string"!=typeof e)return e;const s={};return e&&(s.style=e),null!=t&&(s.size=(0,l.t_)(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&"x"!==this.style&&"cross"!==this.style&&(t.color=e.toJSON()),null===e&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new r({angle:this.angle,color:(0,a.d9)(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};(0,s._)([(0,c.Cb)()],g.prototype,"color",void 0),(0,s._)([(0,d.c)("color")],g.prototype,"writeColor",null),(0,s._)([(0,u.J)({esriSMS:"simple-marker"},{readOnly:!0})],g.prototype,"type",void 0),(0,s._)([(0,c.Cb)()],g.prototype,"size",void 0),(0,s._)([(0,c.Cb)({type:m.apiValues,json:{read:m.read,write:m.write}})],g.prototype,"style",void 0),(0,s._)([(0,c.Cb)({type:String,json:{write:!0}})],g.prototype,"path",null),(0,s._)([(0,c.Cb)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":f.Z}},json:{default:null,write:!0}})],g.prototype,"outline",void 0),g=r=(0,s._)([(0,h.j)("esri.symbols.SimpleMarkerSymbol")],g);const y=g},18251:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r=i(36663),s=i(30936),n=i(25709),o=i(82064),a=i(81977),l=(i(7753),i(39994),i(7283),i(34248)),c=i(40266);const u=new n.X({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let h=0,d=class extends o.wq{constructor(e){super(e),this.id="sym"+h++,this.type=null,this.color=new s.Z([0,0,0,1])}readColor(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};(0,r._)([(0,a.Cb)({type:u.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:u.write}}})],d.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:s.Z,json:{write:{allowNull:!0}}})],d.prototype,"color",void 0),(0,r._)([(0,l.r)("color")],d.prototype,"readColor",null),d=(0,r._)([(0,c.j)("esri.symbols.Symbol")],d);const p=d},59834:(e,t,i)=>{"use strict";i.d(t,{Z:()=>I});var r=i(36663),s=i(41831),n=i(58811),o=i(13802),a=i(3466),l=i(96863),c=i(81977),u=(i(7753),i(39994),i(69236)),h=i(34248),d=i(40266),p=i(39835),f=i(26869),m=i(16641),g=i(61914),y=i(88283),_=i(80419),v=i(60076),b=i(25463),w=i(22162),x=i(18251),C=i(87560),T=i(69996),S=i(60171),E=i(85068),A=i(3032);const M={icon:_.Z,object:b.Z,line:v.Z,path:w.Z,fill:y.Z,extrude:g.Z,text:T.Z,water:S.Z},O=s.Z.ofType({base:C.Z,key:"type",typeMap:M,errorContext:"symbol-layer"}),R=o.Z.getLogger("esri.symbols.Symbol3D");let P=class extends x.Z{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||s.Z;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.initialized&&R.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){(0,n.Z)(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const t=(0,m.f)(e.styleUrl,i);return new E.Z({styleUrl:t,name:e.name})}if(e.styleName&&e.name)return new E.Z({portal:i&&i.portal||f.Z.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new l.Z("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let i=(0,m.t)(e.styleUrl,r);(0,a.YP)(i)&&(i=(0,a.Fv)(i)),t.styleOrigin={styleUrl:i,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!(0,a.tm)(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new l.Z("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof C.Z||e&&M[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};(0,r._)([(0,c.Cb)({json:{read:!1,write:!1}})],P.prototype,"color",null),(0,r._)([(0,c.Cb)({type:O,nonNullable:!0,json:{write:!0}}),(0,u.p)(n.R)],P.prototype,"symbolLayers",null),(0,r._)([(0,c.Cb)({type:E.Z})],P.prototype,"styleOrigin",void 0),(0,r._)([(0,h.r)("styleOrigin")],P.prototype,"readStyleOrigin",null),(0,r._)([(0,p.c)("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],P.prototype,"writeStyleOrigin",null),(0,r._)([(0,c.Cb)({type:A.p,json:{read:!1}})],P.prototype,"thumbnail",void 0),(0,r._)([(0,c.Cb)({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],P.prototype,"type",void 0),P=(0,r._)([(0,d.j)("esri.symbols.Symbol3D")],P);const I=P},87560:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(39835);let l=class extends s.wq{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};(0,r._)([(0,n.Cb)({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],l.prototype,"enabled",void 0),(0,r._)([(0,a.c)("enabled")],l.prototype,"writeEnabled",null),(0,r._)([(0,n.Cb)({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],l.prototype,"type",void 0),l=(0,r._)([(0,o.j)("esri.symbols.Symbol3DLayer")],l);const c=l},27624:(e,t,i)=>{"use strict";i.d(t,{Z:()=>y});var r,s=i(36663),n=i(30936),o=i(67134),a=i(95550),l=i(81977),c=i(69236),u=i(79438),h=i(40266),d=i(39835),p=i(5975),f=i(18251),m=i(63659);let g=r=class extends f.Z{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new p.Z,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&"string"!=typeof e)return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&"string"!=typeof r?r.origin:t[i]=e}castLineWidth(e){return(0,a.t_)(e)}writeLineHeight(e,t,i,r){r&&"string"!=typeof r?r.origin:t[i]=e}clone(){return new r({angle:this.angle,backgroundColor:(0,o.d9)(this.backgroundColor),borderLineColor:(0,o.d9)(this.borderLineColor),borderLineSize:this.borderLineSize,color:(0,o.d9)(this.color),font:this.font&&this.font.clone(),haloColor:(0,o.d9)(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};(0,s._)([(0,l.Cb)({type:n.Z,json:{write:!0}})],g.prototype,"backgroundColor",void 0),(0,s._)([(0,l.Cb)({type:n.Z,json:{write:!0}})],g.prototype,"borderLineColor",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{write:!0}})],g.prototype,"borderLineSize",void 0),(0,s._)([(0,l.Cb)({type:p.Z,json:{write:!0}})],g.prototype,"font",void 0),(0,s._)([(0,l.Cb)({...m.x0,json:{write:!0}})],g.prototype,"horizontalAlignment",void 0),(0,s._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],g.prototype,"kerning",void 0),(0,s._)([(0,l.Cb)({type:n.Z,json:{write:!0}})],g.prototype,"haloColor",void 0),(0,s._)([(0,l.Cb)({type:Number,cast:a.t_,json:{write:!0}})],g.prototype,"haloSize",void 0),(0,s._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],g.prototype,"rightToLeft",void 0),(0,s._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],g.prototype,"rotated",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],g.prototype,"text",void 0),(0,s._)([(0,u.J)({esriTS:"text"},{readOnly:!0})],g.prototype,"type",void 0),(0,s._)([(0,l.Cb)({...m.Nj,json:{write:!0}})],g.prototype,"verticalAlignment",void 0),(0,s._)([(0,l.Cb)({type:Number,cast:a.t_,json:{write:!0}})],g.prototype,"xoffset",void 0),(0,s._)([(0,l.Cb)({type:Number,cast:a.t_,json:{write:!0}})],g.prototype,"yoffset",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],g.prototype,"angle",void 0),(0,s._)([(0,l.Cb)({type:Number,json:{write:!0}})],g.prototype,"width",void 0),(0,s._)([(0,l.Cb)({type:Number})],g.prototype,"lineWidth",void 0),(0,s._)([(0,d.c)("lineWidth")],g.prototype,"writeLineWidth",null),(0,s._)([(0,c.p)("lineWidth")],g.prototype,"castLineWidth",null),(0,s._)([(0,l.Cb)(m.Ck)],g.prototype,"lineHeight",void 0),(0,s._)([(0,d.c)("lineHeight")],g.prototype,"writeLineHeight",null),g=r=(0,s._)([(0,h.j)("esri.symbols.TextSymbol")],g);const y=g},69996:(e,t,i)=>{"use strict";i.d(t,{Z:()=>T});var r,s=i(36663),n=i(67134),o=i(61681),a=i(81977),l=(i(7283),i(79438)),c=i(40266),u=i(39835),h=i(5975),d=i(87560),p=i(50264),f=i(30936),m=i(82064);let g=r=class extends m.wq{constructor(){super(...arguments),this.color=new f.Z([0,0,0,1]),this.size=0}clone(){const e={color:(0,n.d9)(this.color),size:this.size};return new r(e)}};(0,s._)([(0,a.Cb)(p.a)],g.prototype,"color",void 0),(0,s._)([(0,a.Cb)(p.y)],g.prototype,"size",void 0),g=r=(0,s._)([(0,c.j)("esri.symbols.support.Symbol3DHalo")],g);var y=i(57403),_=i(41151);i(7753),i(39994);let v=class extends((0,_.J)(m.wq)){constructor(e){super(e),this.color=null}};(0,s._)([(0,a.Cb)(p.a)],v.prototype,"color",void 0),v=(0,s._)([(0,c.j)("esri.symbols.support.Symbol3DTextBackground")],v);var b,w=i(63659);let x=b=class extends d.Z{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){(0,o.pC)(e)&&(0,o.pC)(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s={...r,textSymbol3D:!0};t.font=e.write({},s),delete t.font.size}get size(){return(0,o.pC)(this._userSize)?this._userSize:(0,o.pC)(this.font)&&null!=this.font.size?this.font.size:9}set size(e){this._userSize=e,(0,o.pC)(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new b({enabled:this.enabled,font:this.font&&(0,n.d9)(this.font),halo:this.halo&&(0,n.d9)(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:(0,o.pC)(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:(0,n.d9)(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new b({font:(0,o.pC)(e.font)?e.font.clone():new h.Z,halo:C(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new y.b({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new v({color:e.backgroundColor.clone()}):null})}};function C(e,t){return e&&t>0?new g({color:(0,n.d9)(e),size:t}):null}(0,s._)([(0,a.Cb)({type:h.Z,json:{write:!0}})],x.prototype,"font",null),(0,s._)([(0,u.c)("font")],x.prototype,"writeFont",null),(0,s._)([(0,a.Cb)({type:g,json:{write:!0}})],x.prototype,"halo",void 0),(0,s._)([(0,a.Cb)({...w.x0,json:{default:"center",write:!0}})],x.prototype,"horizontalAlignment",void 0),(0,s._)([(0,a.Cb)({...w.Ck,json:{default:1,write:!0}})],x.prototype,"lineHeight",void 0),(0,s._)([(0,a.Cb)({type:y.b,json:{write:!0}})],x.prototype,"material",void 0),(0,s._)([(0,a.Cb)({type:v,json:{write:!0}})],x.prototype,"background",void 0),(0,s._)([(0,a.Cb)(p.y)],x.prototype,"size",null),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],x.prototype,"text",void 0),(0,s._)([(0,l.J)({Text:"text"},{readOnly:!0})],x.prototype,"type",void 0),(0,s._)([(0,a.Cb)({...w.Nj,json:{default:"baseline",write:!0}})],x.prototype,"verticalAlignment",void 0),x=b=(0,s._)([(0,c.j)("esri.symbols.TextSymbol3DLayer")],x);const T=x},60171:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r,s=i(36663),n=i(30936),o=i(67134),a=i(81977),l=i(7283),c=i(79438),u=i(40266),h=i(87560);let d=r=class extends h.Z{constructor(e){super(e),this.color=p.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new r({color:(0,o.d9)(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};(0,s._)([(0,a.Cb)({type:n.Z,nonNullable:!0,json:{type:[l.z8],write:(e,t,i)=>t[i]=e.toArray(n.Z.AlphaMode.UNLESS_OPAQUE),default:()=>p.clone(),defaultEquals:e=>e.toCss(!0)===p.toCss(!0)}})],d.prototype,"color",void 0),(0,s._)([(0,c.J)({Water:"water"},{readOnly:!0})],d.prototype,"type",void 0),(0,s._)([(0,a.Cb)({type:["small","medium","large"],json:{write:!0,default:"medium"}})],d.prototype,"waterbodySize",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0,default:null}})],d.prototype,"waveDirection",void 0),(0,s._)([(0,a.Cb)({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],d.prototype,"waveStrength",void 0),d=r=(0,s._)([(0,u.j)("esri.symbols.WaterSymbol3DLayer")],d);const p=new n.Z([0,119,190]),f=d},27948:(e,t,i)=>{"use strict";i.d(t,{Z:()=>y});var r,s=i(36663),n=i(13802),o=i(61681),a=i(78668),l=i(81977),c=(i(7753),i(39994),i(7283),i(79438)),u=i(40266),h=i(26869),d=i(16641),p=i(18251),f=i(3032);const m=n.Z.getLogger("esri.symbols.WebStyleSymbol");let g=r=class extends p.Z{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get fetchCacheKey(){const e=(0,o.pC)(this.portal)?this.portal:h.Z.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new r({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const r=(0,o.pC)(t)?t.cache:null,s=r?this.fetchCacheKey:null;if((0,o.pC)(r)){const e=r.get(s);if(e)return e.clone()}const n=await i.e(7710).then(i.bind(i,77710));(0,a.k_)(t);const l=n.resolveWebStyleSymbol(this,{portal:this.portal},e,t);l.catch((e=>{m.error("#fetchSymbol()","Failed to create symbol from style",e)}));const c=await l;return"webRef"===e&&"point-3d"===c.type||"cimRef"===e&&"cim"===c.type?((0,o.pC)(r)&&r.set(s,c.clone()),c):null}};(0,s._)([(0,l.Cb)({json:{write:!1}})],g.prototype,"color",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],g.prototype,"styleName",void 0),(0,s._)([(0,l.Cb)({type:h.Z,json:{write:!1}})],g.prototype,"portal",void 0),(0,s._)([(0,l.Cb)({type:String,json:{read:d.r,write:d.w}})],g.prototype,"styleUrl",void 0),(0,s._)([(0,l.Cb)({type:f.p,json:{read:!1}})],g.prototype,"thumbnail",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],g.prototype,"name",void 0),(0,s._)([(0,c.J)({styleSymbolReference:"web-style"},{readOnly:!0})],g.prototype,"type",void 0),(0,s._)([(0,l.Cb)()],g.prototype,"fetchCacheKey",null),g=r=(0,s._)([(0,u.j)("esri.symbols.WebStyleSymbol")],g);const y=g},56378:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266));let a=class extends s.wq{constructor(e){super(e),this.visible=!0}clone(){}};(0,r._)([(0,n.Cb)({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],a.prototype,"type",void 0),(0,r._)([(0,n.Cb)({readOnly:!0})],a.prototype,"visible",void 0),a=(0,r._)([(0,o.j)("esri.symbols.callouts.Callout3D")],a);const l=a},62179:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r,s=i(36663),n=i(30936),o=i(67134),a=i(61681),l=i(95550),c=i(81977),u=(i(7283),i(79438)),h=i(40266),d=i(56378),p=i(52331),f=i(50264);let m=r=class extends d.Z{constructor(e){super(e),this.type="line",this.color=new n.Z([0,0,0,1]),this.size=(0,l.Wz)(1),this.border=null}get visible(){return this.size>0&&(0,a.pC)(this.color)&&this.color.a>0}clone(){return new r({color:(0,o.d9)(this.color),size:this.size,border:(0,o.d9)(this.border)})}};(0,s._)([(0,u.J)({line:"line"},{readOnly:!0})],m.prototype,"type",void 0),(0,s._)([(0,c.Cb)(f.a)],m.prototype,"color",void 0),(0,s._)([(0,c.Cb)(f.y)],m.prototype,"size",void 0),(0,s._)([(0,c.Cb)({type:p.a,json:{write:!0}})],m.prototype,"border",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],m.prototype,"visible",null),m=r=(0,s._)([(0,h.j)("esri.symbols.callouts.LineCallout3D")],m);const g=m},94984:(e,t,i)=>{"use strict";i.d(t,{Pd:()=>a,Uy:()=>n,Y2:()=>c,as:()=>l,gv:()=>o});var r=i(56378),s=i(62179);function n(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function o(e){if(!e)return!1;if(!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!n(e)}function a(e){return"point-3d"===e.type||"label-3d"===e.type}function l(e){return"center"===e.horizontalAlignment}const c={types:{key:"type",base:r.Z,typeMap:{line:s.Z}},json:{write:!0}}},60789:(e,t,i)=>{"use strict";function r(e,t,i,r){return"function"==typeof e?e(t,i,r):e}function s(e){return[e.r,e.g,e.b,e.a]}function n(e,t,i){const r=e=>{let t=e.length;for(;t--;)if(!" /-,\n".includes(e.charAt(t)))return!1;return!0},s=[];let n=0,a=-1;do{if(a=t.indexOf("[",n),a>=n){if(a>n){const e=t.substr(n,a-n);s.push([e,null,r(e)])}if(n=a+1,a=t.indexOf("]",n),a>=n){if(a>n){const i=e[t.substr(n,a-n)];i&&s.push([null,i,!1])}n=a+1}}}while(-1!==a);if(n<t.length-1){const e=t.substr(n);s.push([e,null,r(e)])}return e=>{let t="",r=null;for(const i of s){const[s,n,o]=i;if(s)o?r=s:(r&&(t+=r,r=null),t+=s);else{const i=e.attributes[n];i&&(r&&(t+=r,r=null),t+=i)}}return o(t,i)}}function o(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function a(e,t,i,r,s,n,o=!0){const a=t/s,l=i/n,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let i=0;i<n;i++)for(let h=0;h<s;h++){const d=4*(h+(o?n-i-1:i)*s);let p=0,f=0,m=0,g=0,y=0,_=0,v=0;const b=(i+.5)*l;for(let r=Math.floor(i*l);r<(i+1)*l;r++){const i=Math.abs(b-(r+.5))/u,s=(h+.5)*a,n=i*i;for(let i=Math.floor(h*a);i<(h+1)*a;i++){let o=Math.abs(s-(i+.5))/c;const a=Math.sqrt(n+o*o);a>=-1&&a<=1&&(p=2*a*a*a-3*a*a+1,p>0&&(o=4*(i+r*t),v+=p*e[o+3],m+=p,e[o+3]<255&&(p=p*e[o+3]/250),g+=p*e[o],y+=p*e[o+1],_+=p*e[o+2],f+=p))}}r[d]=g/f,r[d+1]=y/f,r[d+2]=_/f,r[d+3]=v/m}}function l(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function c(e){return e.data?.symbol}function u(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function h(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function d(e){return"CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type}function p(e){return"CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type}i.d(t,{Cc:()=>m,NA:()=>f,NO:()=>l,Qs:()=>n,RI:()=>g,TT:()=>a,X3:()=>o,be:()=>c,gJ:()=>p,hf:()=>r,k5:()=>d,nn:()=>s,yL:()=>h,zL:()=>u});const f=e=>isNaN(e)||!e?0:e,m=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function g(){return Promise.all([i.e(9067),i.e(3296)]).then(i.bind(i,8923))}},81713:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var r=i(36663),s=i(30936),n=i(82064),o=i(67134),a=i(95550),l=i(81977),c=(i(7283),i(40266)),u=i(50264);let h=class extends n.wq{constructor(e){super(e),this.color=new s.Z([0,0,0,1]),this.extensionLength=0,this.size=(0,a.Wz)(1)}clone(){}cloneProperties(){return{color:(0,o.d9)(this.color),size:this.size,extensionLength:this.extensionLength}}};(0,r._)([(0,l.Cb)({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],h.prototype,"type",void 0),(0,r._)([(0,l.Cb)(u.a)],h.prototype,"color",void 0),(0,r._)([(0,l.Cb)({...u.y,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],h.prototype,"extensionLength",void 0),(0,r._)([(0,l.Cb)(u.y)],h.prototype,"size",void 0),h=(0,r._)([(0,c.j)("esri.symbols.edges.Edges3D")],h);const d=h},25545:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=(i(13802),i(7283),i(7753),i(39994),i(33156),i(79438)),o=i(40266),a=i(81713);let l=r=class extends a.Z{constructor(e){super(e),this.type="solid"}clone(){return new r(this.cloneProperties())}};(0,s._)([(0,n.J)({solid:"solid"},{readOnly:!0})],l.prototype,"type",void 0),l=r=(0,s._)([(0,o.j)("esri.symbols.support.SolidEdges3D")],l);const c=l},44874:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r,s=i(81713),n=i(36663),o=(i(13802),i(7283),i(7753),i(39994),i(33156),i(79438)),a=i(40266);let l=r=class extends s.Z{constructor(e){super(e),this.type="sketch"}clone(){return new r(this.cloneProperties())}};(0,n._)([(0,o.J)({sketch:"sketch"},{readOnly:!0})],l.prototype,"type",void 0),l=r=(0,n._)([(0,a.j)("esri.symbols.edges.SketchEdges3D")],l);const c=l;var u=i(25545);const h={types:{key:"type",base:s.Z,typeMap:{solid:u.Z,sketch:c}},json:{write:!0}}},32576:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266));let a=class extends s.wq{constructor(e){super(e)}clone(){}};(0,r._)([(0,n.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.symbols.patterns.LinePattern3D")],a);const l=a},17615:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var r,s=i(36663),n=i(25709),o=i(81977),a=(i(7753),i(39994),i(7283),i(79438)),l=i(40266),c=i(32576);const u=(0,n.w)()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let h=r=class extends c.Z{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new r(e)}};(0,s._)([(0,o.Cb)({type:["style"]})],h.prototype,"type",void 0),(0,s._)([(0,a.J)(u),(0,o.Cb)({type:["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"]})],h.prototype,"style",void 0),h=r=(0,s._)([(0,l.j)("esri.symbols.patterns.LineStylePattern3D")],h);const d=h},50126:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(36663),s=i(82064),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266));let a=class extends s.wq{constructor(e){super(e)}clone(){}};(0,r._)([(0,n.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.symbols.patterns.Pattern3D")],a);const l=a},93935:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var r,s=i(36663),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266)),a=i(50126);let l=r=class extends a.Z{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new r(e)}};(0,s._)([(0,n.Cb)({type:["style"]})],l.prototype,"type",void 0),(0,s._)([(0,n.Cb)({type:["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"],json:{read:!0,write:!0}})],l.prototype,"style",void 0),l=r=(0,s._)([(0,o.j)("esri.symbols.patterns.StylePattern3D")],l);const c=l},42871:(e,t,i)=>{"use strict";i.d(t,{D:()=>l,q:()=>a});var r=i(32576),s=i(17615),n=i(50126),o=i(93935);const a={types:{key:"type",base:n.Z,typeMap:{style:o.Z}},json:{write:!0}},l={types:{key:"type",base:r.Z,typeMap:{style:s.Z}},json:{write:!0}}},74710:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>b});var r,s=i(36663),n=i(25709),o=i(82064),a=i(61681),l=i(81977),c=(i(7753),i(39994),i(7283),i(34248)),u=i(40266),h=i(39835),d=i(17095);let p=r=class extends o.wq{async collectRequiredFields(e,t){return(0,d.io)(e,t,this.expression)}clone(){return new r({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],p.prototype,"expression",void 0),(0,s._)([(0,l.Cb)({type:String,json:{write:!0}})],p.prototype,"title",void 0),p=r=(0,s._)([(0,u.j)("esri.layers.support.FeatureExpressionInfo")],p);const f=p;var m,g=i(91478);const y=(0,n.w)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),_=new n.X({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let v=m=class extends o.wq{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):(0,a.pC)(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new m({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&(0,a._W)(this.featureExpressionInfo,e.featureExpressionInfo)}};(0,s._)([(0,l.Cb)({type:f,json:{write:!0}})],v.prototype,"featureExpressionInfo",void 0),(0,s._)([(0,c.r)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],v.prototype,"readFeatureExpressionInfo",null),(0,s._)([(0,h.c)("featureExpressionInfo",{featureExpressionInfo:{type:f},"featureExpression.value":{type:[0]}})],v.prototype,"writeFeatureExpressionInfo",null),(0,s._)([(0,l.Cb)({type:y.apiValues,nonNullable:!0,json:{type:y.jsonValues,read:y.read,write:{writer:y.write,isRequired:!0}}})],v.prototype,"mode",null),(0,s._)([(0,l.Cb)({type:Number,json:{write:!0}})],v.prototype,"offset",void 0),(0,s._)([(0,l.Cb)({type:g.f9,json:{type:String,read:_.read,write:_.write}})],v.prototype,"unit",null),v=m=(0,s._)([(0,u.j)("esri.layers.support.ElevationInfo")],v);const b=v},52285:(e,t,i)=>{"use strict";i.d(t,{S:()=>g,b:()=>m});var r,s=i(36663),n=i(25709),o=i(82064),a=i(3466),l=i(81977),c=(i(7753),i(39994),i(7283),i(79438)),u=i(34248),h=i(40266),d=i(39835),p=i(16641);const f=(0,n.w)()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let m=r=class extends o.wq{constructor(e){super(e)}readHref(e,t,i){return e?(0,p.f)(e,i):t.dataURI}writeHref(e,t,i,r){e&&((0,a.HK)(e)?t.dataURI=e:(t.href=(0,p.t)(e,r),(0,a.YP)(t.href)&&(t.href=(0,a.Fv)(t.href))))}clone(){return new r({href:this.href,primitive:this.primitive})}};(0,s._)([(0,l.Cb)({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],m.prototype,"href",void 0),(0,s._)([(0,u.r)("href")],m.prototype,"readHref",null),(0,s._)([(0,d.c)("href",{href:{type:String},dataURI:{type:String}})],m.prototype,"writeHref",null),(0,s._)([(0,c.J)(f)],m.prototype,"primitive",void 0),m=r=(0,s._)([(0,h.j)("esri.symbols.support.IconSymbol3DLayerResource")],m);const g="circle"},4125:(e,t,i)=>{"use strict";i.d(t,{S:()=>p,k:()=>d});var r,s=i(36663),n=i(25709),o=i(82064),a=i(81977),l=(i(7753),i(39994),i(7283),i(79438)),c=i(40266),u=i(16641);const h=(0,n.w)()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let d=r=class extends o.wq{clone(){return new r({href:this.href,primitive:this.primitive})}};(0,s._)([(0,a.Cb)({type:String,json:{read:u.r,write:u.w}})],d.prototype,"href",void 0),(0,s._)([(0,l.J)(h)],d.prototype,"primitive",void 0),d=r=(0,s._)([(0,c.j)("esri.symbols.support.ObjectSymbol3DLayerResource")],d);const p="sphere"},85068:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r,s=i(36663),n=i(53443),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(26869);let c=r=class extends n.Z{constructor(){super(...arguments),this.portal=null}clone(){return new r({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};(0,s._)([(0,o.Cb)({type:String})],c.prototype,"name",void 0),(0,s._)([(0,o.Cb)({type:String})],c.prototype,"styleUrl",void 0),(0,s._)([(0,o.Cb)({type:String})],c.prototype,"styleName",void 0),(0,s._)([(0,o.Cb)({type:l.Z})],c.prototype,"portal",void 0),c=r=(0,s._)([(0,a.j)("esri.symbols.support.StyleOrigin")],c);const u=c},37939:(e,t,i)=>{"use strict";i.d(t,{e:()=>l});var r,s=i(36663),n=i(53443),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=r=class extends n.Z{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new r({x:this.x,y:this.y})}};(0,s._)([(0,o.Cb)({type:Number})],l.prototype,"x",void 0),(0,s._)([(0,o.Cb)({type:Number})],l.prototype,"y",void 0),l=r=(0,s._)([(0,a.j)("esri.symbols.support.Symbol3DAnchorPosition2D")],l)},57403:(e,t,i)=>{"use strict";i.d(t,{b:()=>u});var r,s=i(36663),n=i(82064),o=i(61681),a=i(81977),l=(i(7753),i(39994),i(7283),i(40266)),c=i(50264);let u=r=class extends n.wq{constructor(e){super(e),this.color=null}clone(){const e={color:(0,o.pC)(this.color)?this.color.clone():null};return new r(e)}};(0,s._)([(0,a.Cb)(c.a)],u.prototype,"color",void 0),u=r=(0,s._)([(0,l.j)("esri.symbols.support.Symbol3DMaterial")],u)},2571:(e,t,i)=>{"use strict";i.d(t,{_:()=>c});var r,s=i(36663),n=i(82064),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266)),l=i(50264);let c=r=class extends n.wq{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new r({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};(0,s._)([(0,o.Cb)(l.y)],c.prototype,"screenLength",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0,default:0}})],c.prototype,"minWorldLength",void 0),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],c.prototype,"maxWorldLength",void 0),c=r=(0,s._)([(0,a.j)("esri.symbols.support.Symbol3DVerticalOffset")],c)},3032:(e,t,i)=>{"use strict";i.d(t,{p:()=>l});var r,s=i(36663),n=i(53443),o=i(81977),a=(i(7753),i(39994),i(7283),i(40266));let l=r=class extends n.Z{clone(){return new r({url:this.url})}};(0,s._)([(0,o.Cb)({type:String})],l.prototype,"url",void 0),l=r=(0,s._)([(0,a.j)("esri.symbols.support.Thumbnail")],l)},97500:(e,t,i)=>{"use strict";i.d(t,{FW:()=>l,PI:()=>o,ZB:()=>p,iW:()=>u,kW:()=>n});var r=i(30936),s=i(60789);function n(e){const t=(0,s.be)(e);if("CIMTextSymbol"===t.type)return t.height;let i=0;if(t.symbolLayers)for(const e of t.symbolLayers)(0,s.zL)(e)&&e.size>i?i=e.size:(0,s.yL)(e)&&e.width>i?i=e.width:(0,s.k5)(e);return i}function o(e,t,i){const r=(0,s.be)(e),o=n(e);0!==o?a(r,t/o,!1,i):function(e,t){if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(const i of e.symbolLayers)switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":i.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":i.width=t}}else e.height=t}(r,t)}function a(e,t,i,r){if("CIMTextSymbol"!==e.type){if(i&&e.effects)for(const i of e.effects)c(i,t);if(e.symbolLayers)for(const i of e.symbolLayers)switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":l(i,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!r?.preserveOutlineWidth&&i.width&&(i.width*=t);break;case"CIMPictureFill":i.height&&(i.height*=t),i.offsetX&&(i.offsetX*=t),i.offsetY&&(i.offsetY*=t);break;case"CIMHatchFill":a(i.lineSymbol,t,!0,{...r,preserveOutlineWidth:!1}),i.offsetX&&(i.offsetX*=t),i.offsetY&&(i.offsetY*=t),i.separation&&(i.separation*=t)}}else e.height*=t}function l(e,t,i){if(e.markerPlacement&&function(e,t){switch((0,s.gJ)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map((e=>e*t));e.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map((e=>e*t));e.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,"CIMVectorMarker"===e.type&&e.markerGraphics)for(const r of e.markerGraphics)e.scaleSymbolsProportionally||a(r.symbol,t,!0,i)}function c(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const i=e.dashTemplate.map((e=>e*t));e.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function u(e){const t=[];return h((0,s.be)(e),t),t.length?new r.Z((0,s.NO)(t[0])):null}function h(e,t){let i;i="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===e.type;if(i.symbolLayers)for(const e of i.symbolLayers)if(!(e.colorLocked||r&&((0,s.yL)(e)||(0,s.zL)(e)&&e.markerPlacement&&(0,s.gJ)(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&d(t,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics.forEach((e=>{h(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":d(t,e.color);break;case"CIMHatchFill":h(e.lineSymbol,t)}}function d(e,t){for(const i of e)if(i.join(".")===t.join("."))return;e.push(t)}function p(e,t,i){t instanceof r.Z||(t=new r.Z(t));const n=(0,s.be)(e);n&&f(n,t,i)}function f(e,t,i){let r;r="CIMTextSymbol"===e.type?e.symbol:e;const n="CIMPolygonSymbol"===r.type;if(r.symbolLayers)for(const e of r.symbolLayers){if(e.colorLocked)continue;if(n)if(i){const{layersToColor:t}=i;if(((0,s.yL)(e)||(0,s.zL)(e)&&e.markerPlacement&&(0,s.gJ)(e.markerPlacement))&&"fill"===t||(0,s.k5)(e)&&"outline"===t)continue}else if((0,s.yL)(e)||(0,s.zL)(e)&&e.markerPlacement&&(0,s.gJ)(e.markerPlacement))continue;const r=t.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=r;break;case"CIMVectorMarker":e.markerGraphics.forEach((e=>{f(e.symbol,t,i)}));break;case"CIMSolidStroke":case"CIMSolidFill":e.color=r;break;case"CIMHatchFill":f(e.lineSymbol,t,i)}}}},86342:(e,t,i)=>{"use strict";i.d(t,{ix:()=>s,l9:()=>n,rx:()=>o});var r=i(30936);const s=new r.Z("white"),n=(new r.Z("black"),new r.Z([255,255,255,0]));function o(e){return 0===e.r&&0===e.g&&0===e.b}},5310:(e,t,i)=>{"use strict";i.d(t,{CJ:()=>c,Rz:()=>h,xA:()=>l,z3:()=>u}),i(39994);var r=i(43411),s=i(15498),n=i(1759),o=i(27624),a=i(86094);const l=n.Z.fromJSON(a.I4),c=s.Z.fromJSON(a.ET),u=r.Z.fromJSON(a.lF),h=o.Z.fromJSON(a.qP);n.Z.fromJSON(a.eG),s.Z.fromJSON(a.wW),r.Z.fromJSON(a.lj)},86094:(e,t,i)=>{"use strict";i.d(t,{ET:()=>o,I4:()=>n,SQ:()=>r,X1:()=>s,eG:()=>c,lF:()=>a,lj:()=>h,qP:()=>l,wW:()=>u});const r=[252,146,31,255],s=[153,153,153,255],n={type:"esriSMS",style:"esriSMSCircle",size:6,color:r,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:r},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},c={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},u={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},h={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},89298:(e,t,i)=>{"use strict";i.d(t,{Ne:()=>y,Od:()=>f,Sp:()=>g,_M:()=>p,mx:()=>m});var r=i(36567),s=i(30936),n=i(66341),o=i(77234),a=i(95550),l=i(97500);const c="picture-fill",u="simple-fill",h="simple-marker",d=new o.Z(1e3);function p(e){const t=e.style;let i=null;if(e)switch(e.type){case h:"cross"!==t&&"x"!==t&&(i=e.color);break;case u:"solid"===t?i=e.color:"none"!==t&&(i={type:"pattern",x:0,y:0,src:(0,r.V)(`esri/symbols/patterns/${t}.png`),width:5,height:5});break;case c:i={type:"pattern",src:e.url,width:(0,a.F2)(e.width)*e.xscale,height:(0,a.F2)(e.height)*e.yscale,x:(0,a.F2)(e.xoffset),y:(0,a.F2)(e.yoffset)};break;case"text":i=e.color;break;case"cim":i=(0,l.iW)(e)}return i}function f(e,t){const i=e+"-"+t;return void 0!==d.get(i)?Promise.resolve(d.get(i)):(0,n.default)(e,{responseType:"image"}).then((e=>{const r=e.data,s=r.naturalWidth,n=r.naturalHeight,o=document.createElement("canvas");o.width=s,o.height=n;const a=o.getContext("2d");a.fillStyle=t,a.fillRect(0,0,s,n),a.globalCompositeOperation="destination-in",a.drawImage(r,0,0);const l=o.toDataURL();return d.put(i,l),l}))}function m(e){if(!e)return null;let t;switch(e.type){case u:case c:case h:t=m(e.outline);break;case"simple-line":{const i=(0,a.F2)(e.width);"none"!==e.style&&0!==i&&(t={color:e.color,style:g(e.style),width:i,cap:e.cap,join:"miter"===e.join?(0,a.F2)(e.miterLimit):e.join});break}default:t=null}return t}const g=(()=>{const e={};return t=>{if(e[t])return e[t];const i=t.replace(/-/g,"");return e[t]=i,i}})(),y=new s.Z([128,128,128])},83313:(e,t,i)=>{"use strict";i.d(t,{cW:()=>u,im:()=>f,vX:()=>h});var r=i(4905),s=i(70375),n=i(61681),o=i(59834),a=i(37193),l=i(27948);const c=["building-scene","integrated-mesh","point-cloud","scene"];function u(e,t,i,r){const s=p(e,{},{context:r,isLabelSymbol:!1});(0,n.pC)(s)&&(t[i]=s)}function h(e,t,i,r){const s=p(e,{},{context:r,isLabelSymbol:!0});(0,n.pC)(s)&&(t[i]=s)}function d(e){return e instanceof o.Z||e instanceof l.Z}function p(e,t,i){if((0,n.Wi)(e))return null;const{context:r,isLabelSymbol:o}=i,l=r?.origin,u=r?.messages;if("web-scene"===l&&!d(e)){const i=(0,a.q)(e,{retainCIM:!0,hasLabelingContext:o});return(0,n.pC)(i.symbol)?i.symbol.write(t,r):(u?.push(new s.Z("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:i.error})),null)}return("web-map"===l||"portal-item"===l&&!c.includes(r?.layer?.type))&&d(e)?(u?.push(new s.Z("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:r})),null):e.write(t,r)}function f(e,t){return(0,r.S9)(e,null,t)}},4142:(e,t,i)=>{"use strict";i.d(t,{J:()=>r,k:()=>s});const r=["begin","end","begin-end"],s=["arrow","circle","square","diamond","cross","x"]},50264:(e,t,i)=>{"use strict";i.d(t,{a:()=>a,y:()=>l});var r=i(30936),s=i(95550),n=i(7283),o=i(78621);const a={type:r.Z,json:{type:[n.z8],default:null,read:{source:["color","transparency"],reader:function(e,t){const i=null!=t.transparency?(0,o.b)(t.transparency):1,s=t.color;return s&&Array.isArray(s)?new r.Z([s[0]||0,s[1]||0,s[2]||0,i]):null}},write:{target:{color:{type:[n.z8]},transparency:{type:n.z8}},writer:function(e,t){t.color=e.toJSON().slice(0,3);const i=(0,o.a)(e.a);0!==i&&(t.transparency=i)}}}},l={type:Number,cast:s.t_,json:{write:!0}}},83773:(e,t,i)=>{"use strict";i.d(t,{DY:()=>p,EB:()=>h,EV:()=>l,JZ:()=>o,Pc:()=>u,TE:()=>d,XX:()=>f,b_:()=>r,dc:()=>y,eb:()=>a,ht:()=>c,tp:()=>m,uH:()=>g});var r,s,n=i(30936);(s=r||(r={}))[s.size=22]="size",s[s.lineWidth=50]="lineWidth",s[s.maxSize=120]="maxSize",s[s.maxOutlineSize=80]="maxOutlineSize",s[s.tallSymbolWidth=20]="tallSymbolWidth";const o={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function a(e,t,i){const s=r.size;let n=s,o=s;e<1?n*=.75:e>1&&(o*=1.25);let a=s,l=s;return t&&i&&(n=o=a=l=0),[{type:"path",path:[{command:"M",values:[a,0]},{command:"L",values:[i?a:.875*a,0]},{command:"L",values:[i?n-.5*a:0,o-.5*l]},{command:"L",values:[n-.5*a,o-.5*l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[a,0]},{command:"L",values:[a,t?0:.125*l]},{command:"L",values:[n-.5*a,t?o-.5*l:l]},{command:"L",values:[n-.5*a,o-.5*l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n-.5*a,o-.5*l]},{command:"L",values:[i?n-.5*a:0,o-.5*l]},{command:"L",values:[i?n-.5*a:0,t?o-.5*l:l]},{command:"L",values:[n-.5*a,t?o-.5*l:l]},{command:"Z",values:[]}]}]}function l(e){const t=r.size,i=.5*e;return[{type:"path",path:[{command:"M",values:[0,.7*t*.5]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+i]},{command:"L",values:[0,.7*t+i-.7*t*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+i]},{command:"L",values:[t,i]},{command:"L",values:[t,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,0]},{command:"L",values:[t,0]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[0,.7*t*.5]},{command:"Z",values:[]}]}]}function c(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function u(e,t){let i=t?r.tallSymbolWidth:e;const s=e,n=t?4:6;i<=r.size?i-=.5*n:i-=n;const o=t?.35*i:.5*i;return[{type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,.5*o]},{command:"L",values:[.5*i,o]},{command:"L",values:[0,.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[.5*i,o]},{command:"L",values:[.5*i,s]},{command:"L",values:[0,s-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*i,o]},{command:"L",values:[.5*i,s]},{command:"L",values:[i,s-.5*o]},{command:"L",values:[i,.5*o]},{command:"Z",values:[]}]}]}function h(e,t){let i=t?r.tallSymbolWidth:e;const s=e,n=t?4:6;i<=r.size?i-=.5*n:i-=n;const o=.5*i,a=.15*i,l=s-a;return[{type:"ellipse",cx:.5*i,cy:l,rx:o,ry:a},{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,l]},{command:"L",values:[i,l]},{command:"L",values:[i,a]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*i,cy:a,rx:o,ry:a}]}function d(e,t){let i=t?r.tallSymbolWidth:e;const s=e,n=t?4:6;i<=r.size?i-=.5*n:i-=n;const o=.15*i,a=s-o;return[{type:"ellipse",cx:.5*i,cy:a,rx:.5*i,ry:o},{type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,a]},{command:"L",values:[0,a]},{command:"Z",values:[]}]}]}function p(e){let t=e;const i=e;t<r.size?t-=3:t-=6;const s=.15*t;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[.5*t,i-s]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:0,rx:.5*t,ry:s}]}function f(e){let t=e;const i=e;t<r.size?t-=2:t-=4;const s=t,n=i,o=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*s,0]},{command:"L",values:[s,.5*n-o]},{command:"L",values:[.45*s-o,.5*n+o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*s,0]},{command:"L",values:[.45*s-o,.5*n+o]},{command:"L",values:[0,.5*n-o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*n-o]},{command:"L",values:[.45*s-o,.5*n+o]},{command:"L",values:[.45*s,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*s,i]},{command:"L",values:[s,.5*n-o]},{command:"L",values:[.45*s-o,.5*n+o]},{command:"Z",values:[]}]}]}function m(e){const t=e;let i=e;return i<r.size?i-=1:i-=2,[{type:"path",path:[{command:"M",values:[.45*t,0]},{command:"L",values:[t,i]},{command:"L",values:[.45*t,.6*i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*t,0]},{command:"L",values:[.45*t,.6*i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,i]},{command:"L",values:[.45*t,.6*i]},{command:"L",values:[t,i]},{command:"Z",values:[]}]}]}function g(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}function y(e,t){if("type"in e&&("linear"===e.type||"pattern"===e.type))return e;const i=new n.Z(e);return new n.Z([g(i.r,t),g(i.g,t),g(i.b,t),i.a])}},5840:(e,t,i)=>{"use strict";i.d(t,{r:()=>f,w:()=>d});var r=i(88256),s=i(66341),n=i(39043),o=i(70375),a=i(39994),l=(i(56803),i(22591)),c=i(13266),u=i(59672);const h=(0,l.E)();function d(e,t,i){const r=Math.ceil(t[0]),s=Math.ceil(t[1]);if(!e.some((e=>!!e.length)))return null;const n=i&&i.node||document.createElement("div");return null!=i.opacity&&(n.style.opacity=i.opacity.toString()),null!=i.effectView&&(n.style.filter=(0,u.wJ)(i.effectView)),h.append(n,c.KB.bind(null,e,r,s,i)),n}function p(e,t,i,r,s){switch(s){case"multiply":e[t+0]*=i[0],e[t+1]*=i[1],e[t+2]*=i[2],e[t+3]*=i[3];break;default:{const s=(0,n._Y)({r:e[t+0],g:e[t+1],b:e[t+2]});s.h=r.h,s.s=r.s,s.v=s.v/100*r.v;const o=(0,n.xr)(s);e[t+0]=o.r,e[t+1]=o.g,e[t+2]=o.b,e[t+3]*=i[3];break}}}function f(e,t,i,l,c){return function(e,t,i){return e?(0,s.default)(e,{responseType:"image"}).then((e=>{const r=e.data,s=r.width,n=r.height,o=s/n;let a=t;if(i){const e=Math.max(s,n);a=Math.min(a,e)}return{image:r,width:o<=1?Math.ceil(a*o):a,height:o<=1?a:Math.ceil(a/o)}})):Promise.reject(new o.Z("renderUtils: imageDataSize","href not provided."))}(e,t,c).then((s=>{const o=s.width?s.width:t,c=s.height?s.height:t;if(s.image&&function(e,t){return!(!e||"ignore"===t||"multiply"===t&&255===e.r&&255===e.g&&255===e.b&&1===e.a)}(i,l)){let t=s.image.width,r=s.image.height;(0,a.Z)("edge")&&/\.svg$/i.test(e)&&(t-=1,r-=1);const u=function(e,t){e=Math.ceil(e),t=Math.ceil(t);const i=document.createElement("canvas");i.width=e,i.height=t,i.style.width=e+"px",i.style.height=t+"px";const r=i.getContext("2d");return r.clearRect(0,0,e,t),r}(o,c);u.drawImage(s.image,0,0,t,r,0,0,o,c);const h=u.getImageData(0,0,o,c),d=[i.r/255,i.g/255,i.b/255,i.a],f=(0,n._Y)(i);for(let e=0;e<h.data.length;e+=4)p(h.data,e,d,f,l);u.putImageData(h,0,0),e=u.canvas.toDataURL("image/png")}else{const t=r.id&&r.id.findCredential(e);if(t&&t.token){const i=e.includes("?")?"&":"?";e=`${e}${i}token=${t.token}`}}return{url:e,width:o,height:c}})).catch((()=>({url:e,width:t,height:t})))}},11644:(e,t,i)=>{"use strict";i.d(t,{EJ:()=>m,KV:()=>p,n2:()=>d,v9:()=>f,wm:()=>_});var r=i(66341),s=i(70375),n=i(61681),o=i(78668),a=i(3466),l=i(26869),c=i(58874),u=i(51622);const h={};function d(e,t,i){return e.styleUrl?async function(e,t){try{return{data:(await m(e,t)).data,baseUrl:(0,a.Yd)(e),styleUrl:e}}catch(e){return(0,o.r9)(e),null}}(e.styleUrl,i):e.styleName?function(e,t,i){const r=(0,n.pC)(t.portal)?t.portal:l.Z.getDefault();let o;const a=`${r.url} - ${r.user&&r.user.username} - ${e}`;return h[a]||(h[a]=function(e,t,i){return t.load(i).then((()=>{const r=new c.Z({disableExtraQuery:!0,query:`owner:${g} AND type:${y} AND typekeywords:"${e}"`});return t.queryItems(r,i)})).then((({results:t})=>{let r=null;const n=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t)if(e.typeKeywords.some((e=>e.toLowerCase()===n))&&e.type===y&&e.owner===g){r=e;break}if(!r)throw new s.Z("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return r.load(i)}))}(e,r,i).then((e=>(o=e,e.fetchData()))).then((t=>({data:t,baseUrl:o.itemUrl,styleName:e})))),h[a]}(e.styleName,t,i):Promise.reject(new s.Z("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function p(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function f(e,t){if("cimRef"===t)return e.cimRef;if(e.formatInfos&&!(0,u.K)())for(const t of e.formatInfos)if("gltf"===t.type)return t.href;return e.webRef}function m(e,t){const i={responseType:"json",query:{f:"json"},...t};return(0,r.default)((0,a.Fv)(e),i)}const g="esri_en",y="Style",_="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},13266:(e,t,i)=>{"use strict";i.d(t,{A5:()=>I,KB:()=>N,al:()=>L,ch:()=>S,iL:()=>D,jA:()=>x,kQ:()=>C,vq:()=>w});var r=i(30936),s=i(39994),n=i(59566),o=i(40278),a=(i(54956),i(26451));let l=0,c=0;const u=(0,s.Z)("android"),h=(0,s.Z)("chrome")||u&&u>=4?"auto":"optimizeLegibility",d={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},p=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let f={},m={};const g={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},y=Math.PI;let _=1;function v(e,t){const i=e*(y/180);return Math.abs(t*Math.sin(i))+Math.abs(t*Math.cos(i))}function b(e){return e.map((e=>`${e.command} ${e.values.join(" ")}`)).join(" ").trim()}function w(e,t,i,r){if(e){if("circle"===e.type)return(0,a.u)("circle",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-dashoffset":i.dashOffset,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,r:e.r});if("ellipse"===e.type)return(0,a.u)("ellipse",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry});if("rect"===e.type)return(0,a.u)("rect",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",x:e.x,y:e.y,width:e.width,height:e.height});if("image"===e.type)return(0,a.u)("image",{href:e.src,x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:"none"});if("path"===e.type){const r="string"!=typeof e.path?b(e.path):e.path;return(0,a.u)("path",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",d:r})}if("text"===e.type)return(0,a.u)("text",{"alignment-baseline":r.alignBaseline,fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4","text-anchor":r.align,"text-decoration":r.decoration,kerning:r.kerning,rotate:r.rotate,"text-rendering":h,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,"font-size":r.font.size,"font-family":r.font.family,x:e.x,y:e.y},e.text)}return null}function x(e){const t={fill:"none",pattern:null,linearGradient:null};if(e)if("type"in e&&"pattern"===e.type){const i="patternId-"+ ++l;t.fill=`url(#${i})`,t.pattern={id:i,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&"linear"===e.type){const i="linearGradientId-"+ ++c;t.fill=`url(#${i})`,t.linearGradient={id:i,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map((e=>({offset:e.offset,color:e.color&&new r.Z(e.color).toString()})))}}else if(e){const i=new r.Z(e);t.fill=i.toString()}return t}function C(e){const t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(e&&(null!=e.width&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=new r.Z(e.color).toString()),e.dashArray&&(t.dashArray=e.dashArray),e.dashArray&&(t.dashOffset=e.dashoffset),e.style)){let i=null;if(e.style in g&&(i=g[e.style]),Array.isArray(i)){i=i.slice(0);for(let t=0;t<i.length;++t)i[t]*=e.width;if("butt"!==e.cap){for(let t=0;t<i.length;t+=2)i[t]-=e.width,i[t]<1&&(i[t]=1);for(let t=1;t<i.length;t+=2)i[t]+=e.width}i=i.join(",")}t.dashArray=i}return t}function T(e,t){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return e&&(i.align=e.align,i.alignBaseline=e.alignBaseline,i.decoration=e.decoration,i.kerning=e.kerning?"auto":"0",i.rotate=e.rotated?"90":"0",i.font.style=t.style||"normal",i.font.variant=t.variant||"normal",i.font.weight=t.weight||"normal",i.font.size=t.size&&t.size.toString()||"10pt",i.font.family=t.family||"serif"),i}function S(e){const{pattern:t,linearGradient:i}=e;if(t)return(0,a.u)("pattern",{id:t.id,patternUnits:"userSpaceOnUse",x:t.x,y:t.y,width:t.width,height:t.height},(0,a.u)("image",{x:t.image.x,y:t.image.y,width:t.image.width,height:t.image.height,href:t.image.href}));if(i){const e=i.stops.map(((e,t)=>(0,a.u)("stop",{key:`${t}-stop`,offset:e.offset,"stop-color":e.color})));return(0,a.u)("linearGradient",{id:i.id,gradientUnits:"userSpaceOnUse",x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},e)}return null}function E(e,t){if(!e)return null;const i=[];for(const t of e){const{shape:e,fill:r,stroke:s,font:n}=t,o=x(r),a=C(s),l="text"===e.type?T(e,n):null;i.push(w(e,o.fill,a,l))}return(0,a.u)("mask",{id:t,maskUnits:"userSpaceOnUse"},(0,a.u)("g",null,i))}function A(e,t,i){return(0,o.t)(e,(0,o.i)(e),[t,i])}function M(e,t,i,r,s){return(0,o.s)(e,(0,o.i)(e),[t,i]),e[4]=e[4]*t-r*t+r,e[5]=e[5]*i-s*i+s,e}function O(e,t){f&&"left"in f?(f.left>e&&(f.left=e),f.right<e&&(f.right=e),f.top>t&&(f.top=t),f.bottom<t&&(f.bottom=t)):f={left:e,bottom:t,right:e,top:t}}function R(e){const t=e.args,i=t.length;let r;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<i;r+=2)O(t[r],t[r+1]);m.x=t[i-2],m.y=t[i-1];break;case"H":for(r=0;r<i;++r)O(t[r],m.y);m.x=t[i-1];break;case"V":for(r=0;r<i;++r)O(m.x,t[r]);m.y=t[i-1];break;case"m":{let e=0;"x"in m||(O(m.x=t[0],m.y=t[1]),e=2);for(r=e;r<i;r+=2)O(m.x+=t[r],m.y+=t[r+1]);break}case"l":case"t":for(r=0;r<i;r+=2)O(m.x+=t[r],m.y+=t[r+1]);break;case"h":for(r=0;r<i;++r)O(m.x+=t[r],m.y);break;case"v":for(r=0;r<i;++r)O(m.x,m.y+=t[r]);break;case"c":for(r=0;r<i;r+=6)O(m.x+t[r],m.y+t[r+1]),O(m.x+t[r+2],m.y+t[r+3]),O(m.x+=t[r+4],m.y+=t[r+5]);break;case"s":case"q":for(r=0;r<i;r+=4)O(m.x+t[r],m.y+t[r+1]),O(m.x+=t[r+2],m.y+=t[r+3]);break;case"A":for(r=0;r<i;r+=7)O(t[r+5],t[r+6]);m.x=t[i-2],m.y=t[i-1];break;case"a":for(r=0;r<i;r+=7)O(m.x+=t[r+5],m.y+=t[r+6])}}function P(e,t,i){const r=d[e.toLowerCase()];let s;"number"==typeof r&&(r?t.length>=r&&(s={action:e,args:t.slice(0,t.length-t.length%r)},i.push(s),R(s)):(s={action:e,args:[]},i.push(s),R(s)))}function I(e){const t={x:0,y:0,width:0,height:0};if("circle"===e.type)t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if("ellipse"===e.type)t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if("image"===e.type||"rect"===e.type)t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if("path"===e.type){const i=function(e){const t=("string"!=typeof e.path?b(e.path):e.path).match(p),i=[];if(f={},m={},!t)return null;let r="",s=[];const n=t.length;for(let e=0;e<n;++e){const n=t[e],o=parseFloat(n);isNaN(o)?(r&&P(r,s,i),s=[],r=n):s.push(o)}P(r,s,i);const o={x:0,y:0,width:0,height:0};return f&&"left"in f&&(o.x=f.left,o.y=f.top,o.width=f.right-f.left,o.height=f.bottom-f.top),o}(e);t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height}return t}function L(e){const t={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const n of e)i?(i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),r=Math.max(r,n.x+n.width),s=Math.max(s,n.y+n.height)):(i=t,i.x=n.x,i.y=n.y,r=n.x+n.width,s=n.y+n.height);return i&&(i.width=r-i.x,i.height=s-i.y),i}function D(e,t,i,r,s,a,l,c,u){let h=(l&&a?v(a,t):t)/2,d=(l&&a?v(a,i):i)/2;if(u){const e=u[0],t=u[1];h=(l&&a?v(a,e):e)/2,d=(l&&a?v(a,t):t)/2}const p=e.width+r,f=e.height+r,m=(0,n.c)(),g=(0,n.c)();let y=!1;if(s&&0!==p&&0!==f){const e=t!==i?t/i:p/f,r=t>i?t:i;let s=1,n=1;isNaN(r)||(e>1?(s=r/p,n=r/e/f):(n=r/f,s=r*e/p)),(0,o.m)(g,g,M(m,s,n,h,d)),y=!0}const _=e.x+(p-r)/2,b=e.y+(f-r)/2;if((0,o.m)(g,g,A(m,h-_,d-b)),!y&&(p>t||f>i)){const e=p/t>f/i,r=(e?t:i)/(e?p:f);(0,o.m)(g,g,M(m,r,r,_,b))}return a&&(0,o.m)(g,g,function(e,t,i,r){const s=t%360*Math.PI/180;(0,o.r)(e,(0,o.i)(e),s);const n=Math.cos(s),a=Math.sin(s),l=e[4],c=e[5];return e[4]=l*n-c*a+r*a-i*n+i,e[5]=c*n+l*a-i*a-r*n+r,e}(m,a,_,b)),c&&(0,o.m)(g,g,A(m,c[0],c[1])),`matrix(${g[0]},${g[1]},${g[2]},${g[3]},${g[4]},${g[5]})`}function N(e,t,i,r={}){const s=[],n=[],o=++_,l=function(e,t,i){const r=e?.effects.find((e=>"bloom"===e.type));if(!r)return null;const{strength:s,radius:n}=r,o=s>0?n:0,l=(s+o)*t,c=4*s+1;return(0,a.u)("filter",{id:`bloom${i}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},(0,a.u)("feMorphology",{operator:"dilate",radius:(s+.5*o)*(5**(t/100)*(.4+t/100)),in:"SourceGraphic",result:"dilate"}),(0,a.u)("feGaussianBlur",{in:"dilate",stdDeviation:l/25,result:"blur"}),(0,a.u)("feGaussianBlur",{in:"blur",stdDeviation:l/50,result:"intensityBlur"}),(0,a.u)("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},(0,a.u)("feFuncR",{type:"linear",slope:c}),(0,a.u)("feFuncG",{type:"linear",slope:c}),(0,a.u)("feFuncB",{type:"linear",slope:c})),(0,a.u)("feMerge",null,(0,a.u)("feMergeNode",{in:"intensityBlur"}),(0,a.u)("feMergeNode",{in:"intensityBrightness"}),(0,a.u)("feGaussianBlur",{stdDeviation:s/10})))}(r.effectView,t,o);let c=null;if(l){const e=r.effectView?.effects.find((e=>"bloom"===e.type)),s=(e.strength?e.strength+e.radius/2:0)/3,n=t+t*s,o=i+i*s;c=[Math.max(n,10),Math.max(o,10)]}for(let o=0;o<e.length;o++){const l=e[o],u=[],h=[];let d=0,p=0,f=0;for(const e of l){const{shape:t,fill:i,stroke:n,font:o,offset:a}=e;r.ignoreStrokeWidth||(d+=n&&n.width||0);const l=x(i),c=C(n),m="text"===t.type?T(t,o):null;s.push(S(l)),u.push(w(t,l.fill,c,m)),h.push(I(t)),a&&(p+=a[0],f+=a[1])}const m=D(L(h),t,i,d,r.scale,r.rotation,r.useRotationSize,[p,f],c);let g=null;if(r.masking){const e=`mask-${o}`,t=r.masking[o];s.push(E(t,e)),g=`url(#${e})`}n.push(g?(0,a.u)("g",{mask:g},(0,a.u)("g",{transform:m},u)):(0,a.u)("g",{transform:m},u))}return r.useRotationSize&&r.rotation&&(t=v(r.rotation,t),i=v(r.rotation,i)),l&&(t=c[0],i=c[1]),(0,a.u)("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:i,style:"display: block;"},l,(0,a.u)("defs",null,s),l?(0,a.u)("g",{filter:`url(#bloom${o})`},n):n)}},37193:(e,t,i)=>{"use strict";i.d(t,{q:()=>g});var r=i(4905),s=i(70375),n=i(27948),o=i(60378),a=i(15498),l=i(62063),c=i(1759),u=i(86036),h=i(43411),d=i(57770),p=i(27624),f=i(63295);const m={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function g(e,t=m){if(!e)return{symbol:null};const{retainId:i=m.retainId,ignoreDrivers:g=m.ignoreDrivers,hasLabelingContext:y=m.hasLabelingContext,retainCIM:_=m.retainCIM}=t;let v;if((0,r.dU)(e)||e instanceof n.Z)v=e.clone();else if("cim"===e.type){const t=e.data?.symbol?.type;if("CIMPointSymbol"!==t)return{error:new s.Z("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${t||"unknown"}' is unsupported in 3D`,{symbol:e})};v=_?e.clone():o.Z.fromCIMSymbol(e)}else if(e instanceof a.Z)v=l.Z.fromSimpleLineSymbol(e);else if(e instanceof c.Z)v=o.Z.fromSimpleMarkerSymbol(e);else if(e instanceof u.Z)v=o.Z.fromPictureMarkerSymbol(e);else if(e instanceof h.Z)v=d.Z.fromSimpleFillSymbol(e);else{if(!(e instanceof p.Z))return{error:new s.Z("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};v=y?f.Z.fromTextSymbol(e):o.Z.fromTextSymbol(e)}if(i&&"cim"!==v.type&&(v.id=e.id),g&&(0,r.dU)(v))for(let e=0;e<v.symbolLayers.length;++e)v.symbolLayers.getItemAt(e)._ignoreDrivers=!0;return{symbol:v}}},19049:(e,t,i)=>{"use strict";i.d(t,{$K:()=>n,Hc:()=>u,KW:()=>h,Uz:()=>c,w2:()=>d}),i(39994);var r=i(8909),s=i(37116);function n(e,{isPrimitive:t,width:i,depth:s,height:n}){const o=t?10:1;if(null==i&&null==n&&null==s)return[o*e[0],o*e[1],o*e[2]];const a=(0,r.f)(i,s,n);let l;for(let t=0;t<3;t++){const i=a[t];if(null!=i){l=i/e[t];break}}for(let t=0;t<3;t++)null==a[t]&&(a[t]=e[t]*l);return a}const o=(0,s.al)(-.5,-.5,-.5,.5,.5,.5),a=(0,s.al)(-.5,-.5,0,.5,.5,1),l=(0,s.al)(-.5,-.5,0,.5,.5,.5);function c(e){switch(e){case"sphere":case"cube":case"diamond":return o;case"cylinder":case"cone":case"inverted-cone":return a;case"tetrahedron":return l;default:return}}const u=["butt","square","round"],h=[...u,"none"],d=["miter","bevel","round"]},43198:(e,t,i)=>{"use strict";i.d(t,{LC:()=>p,jT:()=>f,k:()=>d,l3:()=>m,zd:()=>y}),i(39994);var r=i(61681),s=i(30879),n=i(89298),o=i(83773),a=i(5840),l=i(59672);let c=null;const u=[255,255,255];function h(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function d(e,t,i){const{backgroundColor:r,outline:s,dotSize:n}=e,a=i&&i.swatchSize||o.b_.size,l=Math.round(a*a/n**2*.8),u=window.devicePixelRatio,d=document.createElement("canvas"),p=a*u;d.width=p,d.height=p,d.style.width=d.width/u+"px",d.style.height=d.height/u+"px";const f=d.getContext("2d");if(r&&(f.fillStyle=r.toCss(!0),f.fillRect(0,0,p,p),f.fill()),f.fillStyle=t.toCss(!0),c&&c.length/2===l)for(let e=0;e<2*l;e+=2){const t=c[e],i=c[e+1];f.fillRect(t,i,n*u,n*u),f.fill()}else{c=[];for(let e=0;e<2*l;e+=2){const e=h(0,p),t=h(0,p);c.push(e,t),f.fillRect(e,t,n*u,n*u),f.fill()}}s&&(s.color&&(f.strokeStyle=s.color.toCss(!0)),f.lineWidth=s.width,f.strokeRect(0,0,p,p));const m=new Image(a,a);return m.src=d.toDataURL(),m}function p(e,t={}){const i=t.radius||40,r=2*Math.PI*i,s=e.length,o=r/s,l=[],c=(0,n.mx)(t.outline);c&&(c.width*=2),(c||t.backgroundColor)&&l.push({shape:{type:"circle",cx:i,cy:i,r:i},fill:t.backgroundColor,stroke:c,offset:[0,0]});const h=t.values,d=h&&h.length===s&&100===h.reduce(((e,t)=>e+t),0),p=[0];for(let t=0;t<s;t++){const s=d?h[t]*r/100:null;d&&p.push(s+p[t]),l.push({shape:{type:"circle",cx:i,cy:i,r:i/2},fill:[0,0,0,0],stroke:{width:i,dashArray:`${s||o} ${r}`,dashoffset:"-"+(d?p[t]/2:t*(o/2)),color:e[t]},offset:[0,0]})}let f=null;const m=2*i+(c?.width||0),g=t.holePercentage;if(g){c&&l.push({shape:{type:"circle",cx:i,cy:i,r:i*g},fill:null,stroke:c,offset:[0,0]});const e=m/2;f=[[{shape:{type:"circle",cx:e,cy:e,r:e},fill:u,stroke:c?{...c,color:u}:null,offset:[0,0]},{shape:{type:"circle",cx:e,cy:e,r:i*g},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return(0,a.w)([l],[m,m],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:f,rotation:-90})}function f(e,t={}){const i="horizontal"===t.align,r=i?75:24,s=i?24:75,{width:n=r,height:o=s,gradient:a=!0}=t,c=window.devicePixelRatio,u=n*c,h=o*c,d=document.createElement("canvas");d.width=u,d.height=h,d.style.width=`${n}px`,d.style.height=`${o}px`;const p=d.getContext("2d"),f=i?u:0,m=i?0:h;if(a){const t=p.createLinearGradient(0,0,f,m),i=e.length,r=1===i?0:1/(i-1);e.forEach(((e,i)=>t.addColorStop(i*r,e.toString()))),p.fillStyle=t,p.fillRect(0,0,u,h)}else{const t=i?u/e.length:u,r=i?h:h/e.length;let s=0,n=0;for(const o of e)p.fillStyle=o.toString(),p.fillRect(s,n,t,r),s=i?s+t:0,n=i?0:n+r}const g=document.createElement("div");return g.style.width=`${n}px`,g.style.height=`${o}px`,function(e,t){if(!t)return;e.style.filter=(0,l.wJ)(t);const i=t.effects;if(i)for(const t of i)if("drop-shadow"===t?.type){t.offsetX<0?e.style.marginLeft=`${Math.abs(t.offsetX)}px`:e.style.marginRight=`${t.offsetX}px`;break}}(g,t?.effectList),g.appendChild(d),g}async function m(e,t){switch(e.type){case"web-style":{const{previewWebStyleSymbol:r}=await i.e(5009).then(i.bind(i,35009));return r(e,m,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:r}=await i.e(2084).then(i.bind(i,52084));return r(e,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:r}=await i.e(8648).then(i.bind(i,8648));return r(e,t)}case"cim":{const{previewCIMSymbol:r}=await Promise.all([i.e(1775),i.e(9404),i.e(9027)]).then(i.bind(i,90810));return r(e,t)}default:return}}function g(e){return e&&"opacity"in e?e.opacity*g(e.parent):1}async function y(e,t){if(!e)return;const n=e.sourceLayer,o=((0,r.pC)(t)&&t.useSourceLayer?n:e.layer)??n,a=g(o);if((0,r.pC)(e.symbol)&&(!(0,r.pC)(t)||!0!==t.ignoreGraphicSymbol)){const i="web-style"===e.symbol.type?await e.symbol.fetchSymbol({...t,cache:(0,r.pC)(t)?t.webStyleCache:null}):e.symbol.clone();return(0,l.tb)(i,null,a),i}const c=(0,r.pC)(t)&&t.renderer||o&&"renderer"in o&&o.renderer;let u=c&&"getSymbolAsync"in c?await c.getSymbolAsync(e,t):null;if(!u)return;if(u="web-style"===u.type?await u.fetchSymbol({...t,cache:(0,r.pC)(t)?t.webStyleCache:null}):u.clone(),!("visualVariables"in c)||!c.visualVariables||!c.visualVariables.length)return(0,l.tb)(u,null,a),u;if("arcadeRequiredForVisualVariables"in c&&c.arcadeRequiredForVisualVariables&&((0,r.Wi)(t)||(0,r.Wi)(t.arcade))){const e={...(0,r.Wg)(t)};e.arcade=await(0,s.LC)(),t=e}const h=await Promise.resolve().then(i.bind(i,36496)),d=[],p=[],f=[],m=[];for(const e of c.visualVariables)switch(e.type){case"color":d.push(e);break;case"opacity":p.push(e);break;case"rotation":m.push(e);break;case"size":e.target||f.push(e)}const y=!!d.length&&d[d.length-1],_=y?h.getColor(y,e,t):null,v=!!p.length&&p[p.length-1];let b=v?h.getOpacity(v,e,t):null;if(null!=a&&(b=null!=b?b*a:a),(0,l.tb)(u,_,b),f.length){const i=h.getAllSizes(f,e,t);await(0,l.e3)(u,i)}for(const i of m)(0,l.BR)(u,h.getRotationAngle(i,e,t),i.axis);return u}},63659:(e,t,i)=>{"use strict";i.d(t,{Ck:()=>l,JT:()=>n,Nj:()=>u,g6:()=>o,vC:()=>a,x0:()=>c});var r=i(19431),s=i(7283);const n=["none","underline","line-through"],o=["normal","italic","oblique"],a=["normal","lighter","bold","bolder"],l={type:Number,cast:e=>{const t=(0,s.q9)(e);return 0===t?1:(0,r.uZ)(t,.1,4)},nonNullable:!0},c={type:["left","right","center"],nonNullable:!0},u={type:["baseline","top","middle","bottom"],nonNullable:!0}},91478:(e,t,i)=>{"use strict";i.d(t,{Z7:()=>n,f9:()=>o,lt:()=>s});var r=i(6923);function s(e){return null!=r.a[e]}function n(e){return 1/(r.a[e]||1)}const o=function(){const e=Object.keys(r.a);return e.sort(),e}()},59551:(e,t,i)=>{"use strict";i.d(t,{Ds:()=>a,KA:()=>o});var r=i(3466),s=i(16641);function n(e,t){return function(e){return e&&("service"===e.origin||"portal-item"===e.origin)&&e.layer&&("feature"===e.layer.type||"stream"===e.layer.type)}(t)&&!(0,r.YP)(e)&&t.layer.parsedUrl?(0,r.v_)(t.layer.parsedUrl.path,"images",e):(0,s.f)(e,t)}const o={json:{read:{source:["imageData","url"],reader:function(e,t,i){return t.imageData?(0,r._l)({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):n(t.url,i)}},write:{writer(e,t,i,n){!function(e,t,i,n){if((0,r.HK)(e)){const o=(0,r.sJ)(e);t.contentType=o.mediaType,t.imageData=o.data,i&&i.imageData===t.imageData&&i.url&&(0,s.w)(i.url,t,"url",n)}else(0,s.w)(e,t,"url",n)}(e,t,this.source,n)}}}},a={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=n(t.url,i)),r}}}}},59672:(e,t,i)=>{"use strict";i.d(t,{BR:()=>S,Y6:()=>m,YW:()=>g,_h:()=>_,e3:()=>T,nf:()=>y,tb:()=>b,wJ:()=>E});var r=i(30936),s=i(4905),n=i(67979),o=i(39994),a=i(61681),l=i(95550),c=i(8909),u=i(50913),h=i(89298),d=i(57403);const p=/\/resource\/(.*?)\.svg$/,f=new r.Z("white");function m(e){if(!e)return 0;if((0,s.dU)(e)){const t=function(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1);return"outline"in i?(0,a.U2)(i,"outline","size"):void 0}(e);return(0,a.pC)(t)?t:0}const t=(0,h.mx)(e);return t&&(0,l.Wz)(t.width)||0}function g(e){if((0,a.Wi)(e)||!("symbolLayers"in e)||(0,a.Wi)(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function y(e,t){const i=t.resource.href;return!(0,o.Z)("esri-canvas-svg-support")&&e.styleOrigin&&p.test(i)?i.replace(p,"/resource/png/$1.png"):i}function _(e,t){if(!e)return null;let i=null;return(0,s.dU)(e)?i=function(e){const t=e.symbolLayers;if(!t)return null;let i=null;return t.forEach((e=>{"object"===e.type&&null!=e.resource.href||(i="water"===e.type?(0,a.Wg)(e.color):(0,a.pC)(e.material)?(0,a.Wg)(e.material.color):null)})),i?new r.Z(i):null}(e):(0,s.cT)(e)&&(i=e.color?new r.Z(e.color):null),i?v(i,t):null}function v(e,t){if(null==t)return e;const i=e.toRgba();return i[3]=i[3]*t,new r.Z(i)}function b(e,t,i){var n,o,l;e&&(t||null!=i)&&(t&&(t=new r.Z(t)),(0,s.dU)(e)?function(e,t,i){const r=e.symbolLayers;if(!r)return;const s=e=>{const r=(0,a.pC)(e)?e:null;return v(t=t||r||null!=i&&f,i)};r.forEach((e=>{if("object"!==e.type||null==e.resource.href||t)if("water"===e.type)e.color=s(e.color);else{const t=(0,a.pC)(e.material)?e.material.color:null,r=s(t);(0,a.Wi)(e.material)?e.material=new d.b({color:r}):e.material.color=r,null!=i&&"outline"in e&&(0,a.pC)(e.outline)&&(0,a.pC)(e.outline.color)&&(e.outline.color=v(e.outline.color,i))}}))}(e,t,i):(0,s.cT)(e)&&(n=e,l=i,(o=(o=t)||n.color)&&(n.color=v(o,l)),null!=l&&"outline"in n&&n.outline&&n.outline.color&&(n.outline.color=v(n.outline.color,l))))}function w(e){for(const t of e)if("number"==typeof t)return t;return null}function x(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return null!=i[r]?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}function C(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return null!=t?t:i;default:return e}}async function T(e,t){if(e&&t)return(0,s.dU)(e)?async function(e,t){const r=e.symbolLayers;r&&await(0,n.Ed)(r,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const i=w(t);(0,a.pC)(i)&&(e.size=i)}(e,t);break;case"path":!function(e,t){const i=x(t,c.O,[e.width,void 0,e.height]);e.width=C(t[0],e.width,1,i),e.height=C(t[2],e.height,1,i)}(e,t);break;case"object":await async function(e,t){const{resourceSize:r,symbolSize:s}=await async function(e){const t=await i.e(2901).then(i.bind(i,62901)),r=await t.computeObjectLayerResourceSize(e,10),{width:s,height:n,depth:o}=e,a=[s,o,n];let l=1;for(let e=0;e<3;e++)if(null!=a[e]){l=a[e]/r[e];break}for(let e=0;e<3;e++)null==a[e]&&(a[e]=r[e]*l);return{resourceSize:r,symbolSize:a}}(e),n=x(t,r,s);e.width=C(t[0],s[0],r[0],n),e.depth=C(t[1],s[1],r[1],n),e.height=C(t[2],s[2],r[2],n)}(e,t)}}(e,t)))}(e,t):void((0,s.cT)(e)&&function(e,t){const i=w(t);if(!(0,a.Wi)(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=i,e.height=i*t):(e.width=i*t,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}(e,t))}function S(e,t,i){if(e&&null!=t)if((0,s.dU)(e)){const r=e.symbolLayers;r&&r.forEach((e=>{if(e&&"object"===e.type)switch(i){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else(0,s.cT)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}function E(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,u.rM)(t)}},28432:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var r=i(70375),s=i(13802),n=i(7505);function o(e,t,i,r,n){const o=e.referencesGeometry()&&n?l(t,r,n):t,a=e.repurposeFeature(o);try{return e.evaluate({...i,$feature:a})}catch(e){return s.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}const a=new Map;function l(e,t,i){const{transform:o,hasZ:l,hasM:c}=i;a.has(t)||a.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,i,r,s)=>(0,n.U1)(i,t,e,r,s);case"esriGeometryPolygon":return(e,i,r,s)=>(0,n.Ie)(i,t,e,r,s);case"esriGeometryPolyline":return(e,i,r,s)=>(0,n.G6)(i,t,e,r,s);case"esriGeometryMultipoint":return(e,i,r,s)=>(0,n.J9)(i,t,e,r,s);default:return s.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new r.Z("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const u=a.get(t)(e.geometry,o,l,c);return{...e,geometry:u}}},51118:(e,t,i)=>{"use strict";i.d(t,{s:()=>l});var r=i(31355),s=i(39994),n=i(61681),o=i(78668);const a=1/(0,s.Z)("mapview-transitions-duration");class l extends r.Z{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return(0,n.Wi)(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=(0,o.hh)(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=(0,o.hh)(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,t){if(this.fadeTransitionEnabled){const t=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===t)this.computedVisible=this.visible;else{const r=e*a;this.computedOpacity=i>t?Math.max(t,i-r):Math.min(t,i+r),this.computedVisible=this.computedOpacity>0;const s=t===this.computedOpacity;this.inFadeTransition=!s,s||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}},84342:(e,t,i)=>{"use strict";var r,s;i.d(t,{H:()=>s,U:()=>r}),function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(s||(s={}))},54135:(e,t,i)=>{"use strict";i.d(t,{i:()=>b,K:()=>x});var r=i(61681),s=i(1662),n=i(19710),o=i(43405),a=i(84099),l=i(78951),c=i(91907),u=i(29620);class h{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this.data=e,this.memoryUsed=e.byteLength;let i=1;const r=new Uint32Array(e);this.layerUIDs=[];const s=r[i++];for(let e=0;e<s;e++)this.layerUIDs[e]=r[i++];this.bufferDataOffset=i,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return(0,r.Wi)(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){(0,r.Wi)(this.data)||(this.doPrepareForRendering(e,this.data,this.bufferDataOffset),this.data=null)}}class d extends h{constructor(e,t){super(e,t),this.type=o.al.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let r=this.bufferDataOffset;this.lineIndexStart=i[r++],this.lineIndexCount=i[r++];const s=i[r++];if(s>0){const e=new Map;for(let t=0;t<s;t++){const t=i[r++],s=i[r++],n=i[r++];e.set(t,[s,n])}this.patternMap=e}this.bufferDataOffset=r}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){(0,r.pC)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),(0,r.pC)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),(0,r.pC)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,i){const r=new Uint32Array(t),s=new Int32Array(r.buffer),n=r[i++];this.lineVertexBuffer=l.f.createVertex(e,c.l1.STATIC_DRAW,new Int32Array(s.buffer,4*i,n)),i+=n;const o=r[i++];this.lineIndexBuffer=l.f.createIndex(e,c.l1.STATIC_DRAW,new Uint32Array(r.buffer,4*i,o)),i+=o;const a=this.layer.lineMaterial;this.lineVertexArrayObject=new u.U(e,a.getAttributeLocations(),a.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class p extends h{constructor(e,t){super(e,t),this.type=o.al.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let r=this.bufferDataOffset;this.fillIndexStart=i[r++],this.fillIndexCount=i[r++],this.outlineIndexStart=i[r++],this.outlineIndexCount=i[r++];const s=i[r++];if(s>0){const e=new Map;for(let t=0;t<s;t++){const t=i[r++],s=i[r++],n=i[r++];e.set(t,[s,n])}this.patternMap=e}this.bufferDataOffset=r}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){(0,r.pC)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),(0,r.pC)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),(0,r.pC)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,(0,r.pC)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),(0,r.pC)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),(0,r.pC)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,i){const r=new Uint32Array(t),s=new Int32Array(r.buffer),n=r[i++];this.fillVertexBuffer=l.f.createVertex(e,c.l1.STATIC_DRAW,new Int32Array(s.buffer,4*i,n)),i+=n;const o=r[i++];this.fillIndexBuffer=l.f.createIndex(e,c.l1.STATIC_DRAW,new Uint32Array(r.buffer,4*i,o)),i+=o;const a=r[i++];this.outlineVertexBuffer=l.f.createVertex(e,c.l1.STATIC_DRAW,new Int32Array(s.buffer,4*i,a)),i+=a;const h=r[i++];this.outlineIndexBuffer=l.f.createIndex(e,c.l1.STATIC_DRAW,new Uint32Array(r.buffer,4*i,h)),i+=h;const d=this.layer,p=d.fillMaterial,f=d.outlineMaterial;this.fillVertexArrayObject=new u.U(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new u.U(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class f extends h{constructor(e,t,i){super(e,t),this.type=o.al.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const r=new Uint32Array(e),s=new Int32Array(e),n=new Float32Array(e);let l=this.bufferDataOffset;this.isIconSDF=!!r[l++];const c=r[l++];for(let e=0;e<c;e++){const e=r[l++],t=r[l++],i=r[l++];this.iconPerPageElementsMap.set(e,[t,i])}const u=r[l++];for(let e=0;e<u;e++){const e=r[l++],t=r[l++],i=r[l++];this.glyphPerPageElementsMap.set(e,[t,i])}const h=r[l++],d=r[l++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(d),l=(0,a.wB)(r,s,n,l,this.symbols,i),this.bufferDataOffset=l}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[t,i]of this.iconPerPageElementsMap)e+=i[1];for(const[t,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){(0,r.pC)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),(0,r.pC)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),(0,r.pC)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),(0,r.pC)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,(0,r.pC)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),(0,r.pC)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),(0,r.pC)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),(0,r.pC)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=(0,r.Wg)(this.iconOpacity),t=(0,r.Wg)(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);const i=(0,r.Wg)(this.textOpacity),s=(0,r.Wg)(this.textOpacityBuffer);i.length>0&&i.byteLength===s.size&&s.setSubData(i)}doPrepareForRendering(e,t,i){const s=new Uint32Array(t),n=new Int32Array(s.buffer),o=s[i++];this.iconVertexBuffer=l.f.createVertex(e,c.l1.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.iconIndexBuffer=l.f.createIndex(e,c.l1.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const h=s[i++];this.textVertexBuffer=l.f.createVertex(e,c.l1.STATIC_DRAW,new Int32Array(n.buffer,4*i,h)),i+=h;const d=s[i++];this.textIndexBuffer=l.f.createIndex(e,c.l1.STATIC_DRAW,new Uint32Array(s.buffer,4*i,d)),i+=d,this.iconOpacityBuffer=l.f.createVertex(e,c.l1.STATIC_DRAW,(0,r.Wg)(this.iconOpacity).buffer),this.textOpacityBuffer=l.f.createVertex(e,c.l1.STATIC_DRAW,(0,r.Wg)(this.textOpacity).buffer);const p=this.layer,f=p.iconMaterial,m=p.textMaterial;this.iconVertexArrayObject=new u.U(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new u.U(e,m.getAttributeLocations(),m.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class m extends h{constructor(e,t){super(e,t),this.type=o.al.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let r=this.bufferDataOffset;this.circleIndexStart=i[r++],this.circleIndexCount=i[r++],this.bufferDataOffset=r}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){(0,r.pC)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),(0,r.pC)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),(0,r.pC)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,i){const r=new Uint32Array(t),s=new Int32Array(r.buffer),n=r[i++];this.circleVertexBuffer=l.f.createVertex(e,c.l1.STATIC_DRAW,new Int32Array(s.buffer,4*i,n)),i+=n;const o=r[i++];this.circleIndexBuffer=l.f.createIndex(e,c.l1.STATIC_DRAW,new Uint32Array(r.buffer,4*i,o)),i+=o;const a=this.layer.circleMaterial;this.circleVertexArrayObject=new u.U(e,a.getAttributeLocations(),a.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}var g=i(2509),y=i(51118),_=i(87241);class v extends y.s{constructor(e,t,i,r,s,n=r,o=s){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new _.Z(e),this.x=t,this.y=i,this.width=r,this.height=s,this.rangeX=n,this.rangeY=o}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e,t){const i=t/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,o]=e.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*i,l=this.height/this.rangeY*i;(0,s.s)(r,a,0,0,0,l,0,n,o,1),(0,s.m)(this.transforms.dvs,e.displayViewMat3,r)}}class b extends v{constructor(e,t,i,r,s,n,o=null){super(e,t,i,r,s,4096,4096),this._memCache=o,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=n,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<g.nN}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<g.nN)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let t=!1;for(const i of e)if(this.layerData.has(i)){const e=this.layerData.get(i);this._memoryUsedByLayerData-=e.memoryUsed,e.type===o.al.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),t=!0),e.destroy(),this.layerData.delete(i),this.layerCount--}(0,r.pC)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),t&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){"unloaded"!==this.status&&(w.delete(this),b._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let t=!1;if(e){const{bucketsWithData:i,emptyBuckets:s}=e,n=this._createRenderBuckets(i);if(s&&s.byteLength>0){const e=new Uint32Array(s);for(const t of e)this._deleteLayerData(t)}for(const[e,i]of n)this._deleteLayerData(e),i.type===o.al.SYMBOL&&(this.symbols.set(e,i.symbols),t=!0),this._memoryUsedByLayerData+=i.memoryUsed,this.layerData.set(e,i),this.layerCount++;(0,r.pC)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[e,t]of this.layerData)t.type===o.al.SYMBOL&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e,t){super.setTransform(e,t);const i=t/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,n=this.height/this.rangeY*i,o=[0,0];e.toScreen(o,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;(0,s.b)(a),(0,s.c)(a,a,o),(0,s.r)(a,a,Math.PI*e.rotation/180),(0,s.d)(a,a,[r,n,1])}_createTransforms(){return{dvs:(0,n.c)(),tileMat3:(0,n.c)(),tileUnitsToPixels:(0,n.c)()}}static _destroyRenderBuckets(e){if(!e)return;const t=new Set;e.forEach((e=>{t.has(e)||(e.destroy(),t.add(e))})),e.clear()}_createRenderBuckets(e){const t=new Map,i=new Map;for(const r of e){const e=this._deserializeBucket(r,i);for(const i of e.layerUIDs)t.set(i,e)}return t}_deserializeBucket(e,t){let i=t.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case o.al.FILL:i=new p(e,this.styleRepository);break;case o.al.LINE:i=new d(e,this.styleRepository);break;case o.al.SYMBOL:i=new f(e,this.styleRepository,this);break;case o.al.CIRCLE:i=new m(e,this.styleRepository)}return t.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const t=this.layerData.get(e);this._memoryUsedByLayerData-=t.memoryUsed,t.destroy(),this.layerData.delete(e),this.layerCount--}}const w=new Map;function x(){w.forEach(((e,t)=>{console.log(`\n${t.key}:`),e[0].forEach((e=>console.log(e))),console.log("========"),e[1].forEach((e=>console.log(e)))}))}},2509:(e,t,i)=>{"use strict";i.d(t,{Bf:()=>r,PF:()=>s,nN:()=>n});const r=!0,s=32,n=200},11069:(e,t,i)=>{"use strict";i.d(t,{J:()=>s,a:()=>r});class r{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}}class s{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}},84099:(e,t,i)=>{"use strict";i.d(t,{C$:()=>l,HX:()=>o,co:()=>n,wB:()=>a});var r=i(43405),s=i(11069);function n(e,t,i,r,s,n){const o=i-s;if(o>=0)return(t>>o)+(r-(n<<o))*(e>>o);const a=-o;return t-(n-(r<<a))*(e>>a)<<a}class o{constructor(e,t,i){this._rows=Math.ceil(t/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let e=0;e<this._rows;e++){this.cells[e]=new Array(this._columns);for(let t=0;t<this._columns;t++)this.cells[e][t]=[]}}getCell(e,t){const i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][r]||null}getCellSpan(e,t,i,r){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function a(e,t,i,r,n,o){const a=t[r++];for(let l=0;l<a;l++){const a=new s.a(o);a.xTile=t[r++],a.yTile=t[r++],a.hash=t[r++],a.priority=t[r++];const l=t[r++];for(let e=0;e<l;e++){const e=t[r++],s=t[r++],n=t[r++],o=t[r++],l=!!t[r++],c=t[r++],u=i[r++],h=i[r++],d=t[r++],p=t[r++];a.colliders.push({xTile:e,yTile:s,dxPixels:n,dyPixels:o,hard:l,partIndex:c,width:d,height:p,minLod:u,maxLod:h})}const c=e[r++];for(let t=0;t<c;t++)a.textVertexRanges.push([e[r++],e[r++]]);const u=e[r++];for(let t=0;t<u;t++)a.iconVertexRanges.push([e[r++],e[r++]]);n.push(a)}return r}function l(e,t,i){for(const[r,s]of e.symbols)c(e,t,i,s,r)}function c(e,t,i,s,n){const o=e.layerData.get(n);if(o.type===r.al.SYMBOL){for(const t of s){const r=t.unique;let s;if(t.selectedForRendering){const t=r.parts[0],n=t.startOpacity,o=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===o;const a=i?Math.floor(127*n)|o<<7:o?255:0;s=a<<24|a<<16|a<<8|a}else s=0;for(const[e,i]of t.iconVertexRanges)for(let t=e;t<e+i;t+=4)o.iconOpacity[t/4]=s;if(t.selectedForRendering){const t=r.parts[1],n=t.startOpacity,o=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===o;const a=i?Math.floor(127*n)|o<<7:o?255:0;s=a<<24|a<<16|a<<8|a}else s=0;for(const[e,i]of t.textVertexRanges)for(let t=e;t<e+i;t+=4)o.textOpacity[t/4]=s}o.lastOpacityUpdate=t,o.opacityChanged=!0}}},43405:(e,t,i)=>{"use strict";var r,s,n,o,a;i.d(t,{Fr:()=>a,_K:()=>o,al:()=>s}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"}(r||(r={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(s||(s={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(n||(n={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(o||(o={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(a||(a={}))},27894:(e,t,i)=>{"use strict";i.d(t,{cD:()=>o,sy:()=>n});var r=i(91907),s=i(41163);const n={geometry:[new s.G("a_pos",2,r.g.BYTE,0,2)]},o=(new s.G("a_pos",2,r.g.BYTE,0,4),new s.G("a_tex",2,r.g.BYTE,2,4),{geometry:[new s.G("a_pos",2,r.g.UNSIGNED_SHORT,0,4)]})},87241:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var r=i(34596);class s{constructor(e,t,i,r){this.set(e,t,i,r)}static getId(e,t,i,r){return"object"==typeof e?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${t}/${i}/${r}`}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,t=4095&this.col,i=63&this.level;return(3&this.world)<<30|t<<22|e<<8|i}acquire(e,t,i,r){this.set(e,t,i,r)}contains(e){const t=e.level-this.level;return this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new s(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,t,i,r){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){const[t,i,r,s]=e.split("/");this.level=parseFloat(t),this.row=parseFloat(i),this.col=parseFloat(r),this.world=parseFloat(s)}else this.level=+e,this.row=+t,this.col=+i,this.world=+r||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new s(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,t=this.row<<1,i=this.col<<1,r=this.world;return[new s(e,t,i,r),new s(e,t,i+1,r),new s(e,t+1,i,r),new s(e,t+1,i+1,r)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}s.pool=new r.Z(s,null,null,25,50)},57425:(e,t,i)=>{"use strict";i.d(t,{YF:()=>r,co:()=>s,hZ:()=>n,yl:()=>c});var r,s,n,o,a=i(39100),l=i(8909);class c{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,l.c)(),this.parallax={anchorPointClouds:(0,l.c)(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:(0,a.c)()},this.parallaxNew={anchorPointClouds:(0,l.c)(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:(0,a.c)()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:s.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:r.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:n.FINISHED,factor:-1}}}(o=r||(r={}))[o.FINISHED=0]="FINISHED",o[o.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",o[o.FADE_IN=2]="FADE_IN",function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(s||(s={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(n||(n={}))},25853:(e,t,i)=>{"use strict";i.d(t,{p:()=>r,t:()=>a});var r,s,n=i(36663),o=i(67197);(s=r||(r={}))[s.SIXTEEN=0]="SIXTEEN",s[s.HUNDRED=1]="HUNDRED",s[s.TWOHUNDRED=2]="TWOHUNDRED",s[s.COUNT=3]="COUNT";class a extends o.m{constructor(){super(...arguments),this.steps=r.SIXTEEN}}(0,n._)([(0,o.o)({count:r.COUNT})],a.prototype,"steps",void 0)},13696:(e,t,i)=>{"use strict";i.d(t,{i:()=>a,u:()=>r});var r,s,n=i(36663),o=i(67197);(s=r||(r={}))[s.Full=0]="Full",s[s.WeatherMap=1]="WeatherMap",s[s.COUNT=2]="COUNT";class a extends o.m{constructor(){super(...arguments),this.mode=r.Full}}(0,n._)([(0,o.o)({count:r.COUNT})],a.prototype,"mode",void 0)},43175:(e,t,i)=>{"use strict";i.d(t,{A:()=>l,IQ:()=>o,I_:()=>r,QZ:()=>c,iZ:()=>a,jy:()=>n,kR:()=>s});const r=(0,i(39994).Z)("esri-mobile")?64:128,s=r/128,n=Math.ceil(Math.sqrt(r)),o=(r+2)*n,a=1e5,l=128,c=o/1560},15396:(e,t,i)=>{"use strict";i.d(t,{H:()=>r,Y:()=>a});var r,s,n=i(36663),o=i(67197);(s=r||(r={}))[s.Rain=0]="Rain",s[s.Snow=1]="Snow",s[s.COUNT=2]="COUNT";class a extends o.m{constructor(){super(...arguments),this.type=r.Rain}}(0,n._)([(0,o.o)({count:r.COUNT})],a.prototype,"type",void 0)},28876:(e,t,i)=>{"use strict";i.d(t,{f:()=>a,n:()=>r});var r,s,n=i(36663),o=i(67197);(s=r||(r={}))[s.Cone=0]="Cone",s[s.Cylinder=1]="Cylinder",s[s.Underground=2]="Underground",s[s.COUNT=3]="COUNT";class a extends o.m{constructor(){super(...arguments),this.geometry=r.Cone}}(0,n._)([(0,o.o)({count:r.COUNT})],a.prototype,"geometry",void 0)},91420:(e,t,i)=>{"use strict";i.d(t,{C:()=>c});var r=i(66341),s=i(67979),n=i(70375),o=i(61681),a=i(78668),l=i(3466);class c{constructor(e){this.streamDataRequester=e}async loadJSON(e,t){return this._load("json",e,t)}async loadBinary(e,t){return(0,l.HK)(e)?((0,a.k_)(t),(0,l.AH)(e)):this._load("binary",e,t)}async loadImage(e,t){return this._load("image",e,t)}async _load(e,t,i){if((0,o.Wi)(this.streamDataRequester))return(await(0,r.default)(t,{responseType:u[e]})).data;const l=await(0,s.q6)(this.streamDataRequester.request(t,e,i));if(!0===l.ok)return l.value;throw(0,a.r9)(l.error),new n.Z("",`Request for resource failed: ${l.error}`)}}const u={image:"image",binary:"array-buffer",json:"json"}},1731:(e,t,i)=>{"use strict";i.d(t,{DA:()=>o,jX:()=>a,nh:()=>n});var r=i(86098),s=i(36620);function n(e,t=s.p){return"number"==typeof e?t(e):(0,r.Uc)(e)||(0,r.lq)(e)?new Uint32Array(e):e}function o(e){const t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if("number"==typeof e){let e=0;for(let t=0;t<i;t+=1)t%2==0?(r[e++]=t,r[e++]=t+1,r[e++]=t+2):(r[e++]=t+1,r[e++]=t,r[e++]=t+2)}else{let t=0;for(let s=0;s<i;s+=1)if(s%2==0){const i=e[s],n=e[s+1],o=e[s+2];r[t++]=i,r[t++]=n,r[t++]=o}else{const i=e[s+1],n=e[s],o=e[s+2];r[t++]=i,r[t++]=n,r[t++]=o}}return r}function a(e){const t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if("number"==typeof e){let e=0;for(let t=0;t<i;++t)r[e++]=0,r[e++]=t+1,r[e++]=t+2;return r}{const t=e[0];let s=e[1],n=0;for(let o=0;o<i;++o){const i=e[o+2];r[n++]=t,r[n++]=s,r[n++]=i,s=i}return r}}},40462:(e,t,i)=>{"use strict";i.d(t,{z:()=>F});var r=i(61681),s=i(39100),n=i(70375);const o=i(13802).Z.getLogger("esri.views.3d.glTF");var a,l,c=i(91907),u=i(27755),h=i(86114),d=i(3466),p=i(26139),f=i(24455),m=i(10663),g=i(61044),y=i(81936),_=i(15642);class v{constructor(e){this.data=e,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const e=this.offset4;return this.offset4+=1,this.dataUint32[e]}readUint8Array(e){const t=4*this.offset4;return this.offset4+=e/4,new Uint8Array(this.data,t,e)}remainingBytes(){return this.data.byteLength-4*this.offset4}}!function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"}(a||(a={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(l||(l={}));const b={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},w={pbrMetallicRoughness:b,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},x={ESRI_externalColorMixMode:"tint"},C=(e={})=>{const t={...b,...e.pbrMetallicRoughness},i=function(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:(0,u.Bg)(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return e}({...x,...e.extras});return{...w,...e,pbrMetallicRoughness:t,extras:i}},T={magFilter:c.cw.LINEAR,minFilter:c.cw.LINEAR_MIPMAP_LINEAR,wrapS:c.e8.REPEAT,wrapT:c.e8.REPEAT},S=e=>({...T,...e}),E=1179937895;class A{constructor(e,t,i,r,s){this.context=e,this.errorContext=t,this.uri=i,this.json=r,this.glbBuffer=s,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=function(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,((e,r,s)=>(t=r||"",i=s||"",""))),{dirPart:t,filePart:i}}(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),t.errorUnsupportedIf(null==r.scenes,"Scenes must be defined."),t.errorUnsupportedIf(null==r.meshes,"Meshes must be defined"),t.errorUnsupportedIf(null==r.nodes,"Nodes must be defined."),this._computeNodeParents()}static async load(e,t,i,r){if((0,d.HK)(i)){const r=(0,d.sJ)(i);if("model/gltf-binary"!==r.mediaType)try{const s=JSON.parse(r.isBase64?atob(r.data):r.data);return new A(e,t,i,s)}catch{}const s=(0,d.AH)(i);if(A._isGLBData(s))return this._fromGLBData(e,t,i,s)}if(i.endsWith(".gltf")){const s=await e.loadJSON(i,r);return new A(e,t,i,s)}const s=await e.loadBinary(i,r);if(A._isGLBData(s))return this._fromGLBData(e,t,i,s);const n=await e.loadJSON(i,r);return new A(e,t,i,n)}static _isGLBData(e){const t=new v(e);return t.remainingBytes()>=4&&t.readUint32()===E}static async _fromGLBData(e,t,i,r){const s=await A._parseGLBData(t,r);return new A(e,t,i,s.json,s.binaryData)}static async _parseGLBData(e,t){const i=new v(t);e.assert(i.remainingBytes()>=12,"GLB binary data is insufficiently large.");const r=i.readUint32(),s=i.readUint32(),n=i.readUint32();e.assert(r===E,"Magic first 4 bytes do not fit to expected GLB value."),e.assert(t.byteLength>=n,"GLB binary data is smaller than header specifies."),e.errorUnsupportedIf(2!==s,"An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const t=i.readUint32(),r=i.readUint32();0===l?(e.assert(1313821514===r,"First GLB chunk must be JSON."),e.assert(t>=0,"No JSON data found."),o=await L(i.readUint8Array(t))):1===l?(e.errorUnsupportedIf(5130562!==r,"Second GLB chunk expected to be BIN."),a=i.readUint8Array(t)):e.warnUnsupported("More than 2 GLB chunks detected. Skipping."),l+=1}return o||e.error("No GLB JSON chunk detected."),{json:o,binaryData:a}}async getBuffer(e,t){const i=this.json.buffers[e],r=this.errorContext;if(null==i.uri)return r.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer;const s=await this._getBufferLoader(e,t);return r.assert(s.byteLength===i.byteLength,"Buffer byte lengths should match."),s}async _getBufferLoader(e,t){const i=this.bufferLoaders.get(e);if(i)return i;const r=this.json.buffers[e],s=this.context.loadBinary(this._resolveUri(r.uri),t).then((e=>new Uint8Array(e)));return this.bufferLoaders.set(e,s),s}async getAccessor(e,t){const i=this.errorContext;i.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const r=this.json.accessors[e];i.errorUnsupportedIf(null==r?.bufferView,"Some accessor does not specify a bufferView."),i.errorUnsupportedIf(r.type in[a.MAT2,a.MAT3,a.MAT4],`AttributeType ${r.type} is not supported`);const s=this.json.bufferViews[r.bufferView],n=await this.getBuffer(s.buffer,t),o=P[r.type],l=I[r.componentType],c=o*l,u=s.byteStride||c;return{raw:n.buffer,byteStride:u,byteOffset:n.byteOffset+(s.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:u===c,componentCount:o,componentByteSize:l,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,t){if(null==e.indices)return null;const i=await this.getAccessor(e.indices,t);if(i.isDenselyPacked)switch(i.componentType){case c.g.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case c.g.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case c.g.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case c.g.UNSIGNED_BYTE:return(0,_.m)(this._wrapAccessor(y.D_,i));case c.g.UNSIGNED_SHORT:return(0,_.m)(this._wrapAccessor(y.av,i));case c.g.UNSIGNED_INT:return(0,_.m)(this._wrapAccessor(y.Nu,i))}}async getPositionData(e,t){const i=this.errorContext;i.errorUnsupportedIf(null==e.attributes.POSITION,"No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,t);return i.errorUnsupportedIf(r.componentType!==c.g.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+D[r.componentType]),i.errorUnsupportedIf(3!==r.componentCount,"POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed()),this._wrapAccessor(y.ct,r)}async getNormalData(e,t){const i=this.errorContext;i.assert(null!=e.attributes.NORMAL,"No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,t);return i.errorUnsupportedIf(r.componentType!==c.g.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+D[r.componentType]),i.errorUnsupportedIf(3!==r.componentCount,"NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed()),this._wrapAccessor(y.ct,r)}async getTangentData(e,t){const i=this.errorContext;i.assert(null!=e.attributes.TANGENT,"No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,t);return i.errorUnsupportedIf(r.componentType!==c.g.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+D[r.componentType]),i.errorUnsupportedIf(4!==r.componentCount,"TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed()),new y.ek(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,t){const i=this.errorContext;i.assert(null!=e.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,t);return i.errorUnsupportedIf(2!==r.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed()),r.componentType===c.g.FLOAT?this._wrapAccessor(y.Eu,r):(i.errorUnsupportedIf(!r.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),function(e){switch(e.componentType){case c.g.BYTE:return new y.Vs(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case c.g.UNSIGNED_BYTE:return new y.xA(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case c.g.SHORT:return new y.or(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case c.g.UNSIGNED_SHORT:return new y.TS(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case c.g.UNSIGNED_INT:return new y.qt(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case c.g.FLOAT:return new y.Eu(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(0,u.Bg)(e.componentType)}}(r))}async getVertexColors(e,t){const i=this.errorContext;i.assert(null!=e.attributes.COLOR_0,"No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,t);if(i.errorUnsupportedIf(4!==r.componentCount&&3!==r.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed()),4===r.componentCount){if(r.componentType===c.g.FLOAT)return this._wrapAccessor(y.ek,r);if(r.componentType===c.g.UNSIGNED_BYTE)return this._wrapAccessor(y.mc,r);if(r.componentType===c.g.UNSIGNED_SHORT)return this._wrapAccessor(y.v6,r)}else if(3===r.componentCount){if(r.componentType===c.g.FLOAT)return this._wrapAccessor(y.ct,r);if(r.componentType===c.g.UNSIGNED_BYTE)return this._wrapAccessor(y.ne,r);if(r.componentType===c.g.UNSIGNED_SHORT)return this._wrapAccessor(y.mw,r)}i.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+D[r.componentType])}hasPositions(e){return void 0!==e.attributes.POSITION}hasNormals(e){return void 0!==e.attributes.NORMAL}hasVertexColors(e){return void 0!==e.attributes.COLOR_0}hasTextureCoordinates(e){return void 0!==e.attributes.TEXCOORD_0}hasTangents(e){return void 0!==e.attributes.TANGENT}async getMaterial(e,t,i){let r=this.materialCache.get(e.material);if(!r){const s=null!=e.material?C(this.json.materials[e.material]):C(),n=s.pbrMetallicRoughness,o=this.hasVertexColors(e),a=this.getTexture(n.baseColorTexture,t),l=this.getTexture(s.normalTexture,t),c=i?this.getTexture(s.occlusionTexture,t):null,u=i?this.getTexture(s.emissiveTexture,t):null,h=i?this.getTexture(n.metallicRoughnessTexture,t):null,d=null!=e.material?e.material:-1;r={alphaMode:s.alphaMode,alphaCutoff:s.alphaCutoff,color:n.baseColorFactor,doubleSided:!!s.doubleSided,colorTexture:await a,normalTexture:await l,name:s.name,id:d,occlusionTexture:await c,emissiveTexture:await u,emissiveFactor:s.emissiveFactor,metallicFactor:n.metallicFactor,roughnessFactor:n.roughnessFactor,metallicRoughnessTexture:await h,hasVertexColors:o,ESRI_externalColorMixMode:s.extras.ESRI_externalColorMixMode}}return r}async getTexture(e,t){if(!e)return null;this.errorContext.errorUnsupportedIf(0!==(e.texCoord||0),"Only TEXCOORD with index 0 is supported.");const i=e.index,r=this.errorContext,s=this.json.textures[i],n=S(null!=s.sampler?this.json.samplers[s.sampler]:{});r.errorUnsupportedIf(null==s.source,"Source is expected to be defined for a texture.");const o=this.json.images[s.source],a=await this._loadTextureImageData(i,s,t);return(0,h.s1)(this.textureCache,i,(()=>{const e=e=>33071===e||33648===e||10497===e,t=e=>(r.error(`Unexpected TextureSampler WrapMode: ${e}. Using default REPEAT(10497).`),10497);return{data:a,wrapS:e(n.wrapS)?n.wrapS:t(n.wrapS),wrapT:e(n.wrapT)?n.wrapT:t(n.wrapT),minFilter:n.minFilter,name:o.name,id:i}}))}getNodeTransform(e){if(void 0===e)return O;let t=this.nodeTransformCache.get(e);if(!t){const i=this.getNodeTransform(this._getNodeParent(e)),r=this.json.nodes[e];r.matrix?t=(0,f.m)((0,s.c)(),i,r.matrix):r.translation||r.rotation||r.scale?(t=(0,s.b)(i),r.translation&&(0,f.j)(t,t,r.translation),r.rotation&&(R[3]=(0,m.g)(R,r.rotation),(0,f.e)(t,t,R[3],R)),r.scale&&(0,f.h)(t,t,r.scale)):t=i,this.nodeTransformCache.set(e,t)}return t}_wrapAccessor(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}_resolveUri(e){return(0,d.hF)(e,this.baseUri)}_getNodeParent(e){return this.nodeParentMap.get(e)}_checkVersionSupported(){const e=p.G.parse(this.json.asset.version,"glTF");M.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach(((e,t)=>{e.children&&e.children.forEach((e=>{this.nodeParentMap.set(e,t)}))}))}async _loadTextureImageData(e,t,i){const r=this.textureLoaders.get(e);if(r)return r;const s=this._createTextureLoader(t,i);return this.textureLoaders.set(e,s),s}async _createTextureLoader(e,t){const i=this.json.images[e.source];if(i.uri)return this.context.loadImage(this._resolveUri(i.uri),t);const r=this.errorContext;r.errorUnsupportedIf(null==i.bufferView,"Image bufferView must be defined."),r.errorUnsupportedIf(null==i.mimeType,"Image mimeType must be defined.");const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,t);return r.errorUnsupportedIf(null!=s.byteStride,"byteStride not supported for image buffer"),async function(e,t){return new Promise(((i,r)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image;o.addEventListener("load",(()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then((()=>i(o)),(()=>i(o))):i(o)})),o.addEventListener("error",(e=>{URL.revokeObjectURL(n),r(e)})),o.src=n}))}(new Uint8Array(n.buffer,n.byteOffset+(s.byteOffset||0),s.byteLength),i.mimeType)}}const M=new p.G(2,0,"glTF"),O=(0,f.z)((0,s.c)(),Math.PI/2),R=(0,g.a)(),P={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},I={[c.g.BYTE]:1,[c.g.UNSIGNED_BYTE]:1,[c.g.SHORT]:2,[c.g.UNSIGNED_SHORT]:2,[c.g.FLOAT]:4,[c.g.UNSIGNED_INT]:4};async function L(e){return new Promise(((t,i)=>{const r=new Blob([e]),s=new FileReader;s.onload=()=>{const e=s.result;t(JSON.parse(e))},s.onerror=e=>{i(e)},s.readAsText(r)}))}const D={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let N=0;async function F(e,t,i={},n=!0){const o=await A.load(e,B,t,i),a="gltf_"+N++,l={lods:[],materials:new Map,textures:new Map,meta:k(o)},u=!(!o.json.asset.extras||"symbolResource"!==o.json.asset.extras.ESRI_type),h=new Map;await U(o,(async(e,t,u,d)=>{const p=h.get(u)??0;h.set(u,p+1);const f=void 0!==e.mode?e.mode:c.MX.TRIANGLES,m=f===c.MX.TRIANGLES||f===c.MX.TRIANGLE_STRIP||f===c.MX.TRIANGLE_FAN?f:null;if((0,r.Wi)(m))return void B.warnUnsupported("Unsupported primitive mode ("+j[f]+"). Skipping primitive.");if(!o.hasPositions(e))return void B.warn("Skipping primitive without POSITION vertex attribute.");const g=o.getPositionData(e,i),y=o.getMaterial(e,i,n),_=o.hasNormals(e)?o.getNormalData(e,i):null,v=o.hasTangents(e)?o.getTangentData(e,i):null,b=o.hasTextureCoordinates(e)?o.getTextureCoordinates(e,i):null,w=o.hasVertexColors(e)?o.getVertexColors(e,i):null,x=o.getIndexData(e,i),C={transform:(0,s.b)(t),attributes:{position:await g,normal:_?await _:null,texCoord0:b?await b:null,color:w?await w:null,tangent:v?await v:null},indices:await x,primitiveType:m,material:z(l,await y,a)};let T=null;(0,r.pC)(l.meta)&&(0,r.pC)(l.meta.ESRI_lod)&&"screenSpaceRadius"===l.meta.ESRI_lod.metric&&(T=l.meta.ESRI_lod.thresholds[u]),l.lods[u]=l.lods[u]||{parts:[],name:d,lodThreshold:T},l.lods[u].parts[p]=C}));for(const e of l.lods)e.parts=e.parts.filter((e=>!!e));return{model:l,meta:{isEsriSymbolResource:u,uri:o.uri},customMeta:{}}}function k(e){const t=e.json;let i=null;return t.nodes.forEach((e=>{const t=e.extras;(0,r.pC)(t)&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(i=t)})),i}async function U(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const e of r){const t=i.nodes[e];n.push(o(e,0)),V(t)&&!s&&t.extensions.MSFT_lod.ids.forEach(((e,t)=>o(e,t+1)))}async function o(r,s){const a=i.nodes[r],l=e.getNodeTransform(r);if(B.warnUnsupportedIf(null!=a.weights,"Morph targets are not supported."),null!=a.mesh){const e=i.meshes[a.mesh];for(const i of e.primitives)n.push(t(i,l,s,e.name))}for(const e of a.children||[])n.push(o(e,s))}await Promise.all(n)}function V(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function z(e,t,i){const r=t=>{const r=`${i}_tex_${t&&t.id}${t&&t.name?"_"+t.name:""}`;if(t&&!e.textures.has(r)){const i=function(e,t={}){return{data:e,parameters:{wrap:{s:c.e8.REPEAT,t:c.e8.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}(t.data,{wrap:{s:t.wrapS,t:t.wrapT},mipmap:H.includes(t.minFilter),noUnpackFlip:!0});e.textures.set(r,i)}return r},s=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const i=function(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,i)}return s}const B=new class{error(e){throw new n.Z("gltf-loader-error",e)}errorUnsupported(e){throw new n.Z("gltf-loader-unsupported-feature",e)}errorUnsupportedIf(e,t){e&&this.errorUnsupported(t)}assert(e,t){e||this.error(t)}warn(e){o.warn(e)}warnUnsupported(e){this.warn("[Unsupported Feature] "+e)}warnUnsupportedIf(e,t){e&&this.warnUnsupported(t)}},H=[c.cw.LINEAR_MIPMAP_LINEAR,c.cw.LINEAR_MIPMAP_NEAREST],j=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"]},87076:(e,t,i)=>{"use strict";i.d(t,{Lz:()=>_,RX:()=>y,Wf:()=>f,j3:()=>m});var r=i(61681),s=i(24455),n=i(39100),o=i(6766),a=i(8909),l=i(90472),c=i(63669),u=i(14923),h=i(3289),d=i(66143),p=i(21414);function f(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;for(const e of n){const{update:n,averageGeometrySampledElevation:a}=E(e,t,i,r);o+=a,n&&s.geometryVertexAttrsUpdated(e)}return o/n.length}function m(e,t,i,r){const n=e.stageObject,a=t.centerPointInElevationSR;let d=0;n.metadata.usesVerticalDistanceToGround?((0,c.qZ)(a,i,t,r,S),(0,u.CV)(n,S.verticalDistanceToGround),d=S.sampledElevation):((0,c.qZ)(a,i,t,r,S),"absolute-height"!==t.mode&&(d=S.sampledElevation));const p=(0,s.c)(g,n.transformation),f=(0,o.s)(T,p[12],p[13],p[14]);h.Z.TESTS_DISABLE_OPTIMIZATIONS?(b[0]=a.x,b[1]=a.y,b[2]=S.z,(0,l.Bm)(a.spatialReference,b,p,r.spatialReference)&&(n.transformation=p)):r.setAltitudeOfTransformation(S.z,p);const m=v/r.unitInMeters;return(Math.abs(p[12]-f[0])>=m||Math.abs(p[13]-f[1])>=m||Math.abs(p[14]-f[2])>=m)&&(n.transformation=p),d}const g=(0,n.c)();function y(e,t,i,s){const n=e.graphics3DSymbolLayer.lodRenderer;if((0,r.Wi)(n))return 0;const a=t.centerPointInElevationSR;(0,c.qZ)(a,i,t,s,S);const u="absolute-height"!==t.mode?S.sampledElevation:0,d=n.instanceData,p=e.instanceIndex,f=C;d.getGlobalTransform(p,f);const m=(0,o.s)(T,f[12],f[13],f[14]);h.Z.TESTS_DISABLE_OPTIMIZATIONS?(b[0]=a.x,b[1]=a.y,b[2]=S.z,(0,l.Bm)(a.spatialReference,b,f,s.spatialReference)&&d.setGlobalTransform(p,f)):s.setAltitudeOfTransformation(S.z,f);const g=v/s.unitInMeters;return(h.Z.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(f[12]-m[0])>=g||Math.abs(f[13]-m[1])>=g||Math.abs(f[14]-m[2])>=g)&&d.setGlobalTransform(p,f),u}function _(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;if(0===n.length)return 0;let o=0,a=null,l=0,c=!1;for(const e of n){const n=e.geometry.vertexAttributes.get(p.T.POSITION);if(n!==a){const{update:s,averageGeometrySampledElevation:o}=E(e,t,i,r);l=o,a=n,c=s}c&&s.geometryVertexAttrsUpdated(e),o+=l}return o/n.length}const v=.01,b=(0,a.c)(),w=(0,a.c)(),x=(0,a.c)(),C=(0,n.c)(),T=(0,a.c)(),S=new c.Lm;function E(e,t,i,r){let s=!1;const n=i.spatialReference,o=e.geometry,a=e.getShaderTransformation(),u=t.requiresSampledElevationInfo;w[0]=a[12],w[1]=a[13],w[2]=a[14],o.invalidateBoundingInfo();const f=o.getMutableAttribute(p.T.POSITION),m=f.data,g=o.vertexAttributes.get(p.T.MAPPOS).data,y=f.size,_=m.length/y,C=new d.sb(g,n);let T=0,E=0;for(let e=0;e<_;e++){if(x[0]=m[T],x[1]=m[T+1],x[2]=m[T+2],(0,c.qZ)(C,i,t,r,S),u&&(E+=S.sampledElevation),h.Z.TESTS_DISABLE_OPTIMIZATIONS)m[T]=C.array[C.offset],m[T+1]=C.array[C.offset+1],m[T+2]=S.z,(0,l.CM)(m,n,T,m,r.spatialReference,T,1),m[T]-=w[0],m[T+1]-=w[1],m[T+2]-=w[2],s=!0;else{b[0]=m[T]+w[0],b[1]=m[T+1]+w[1],b[2]=m[T+2]+w[2],r.setAltitude(b,S.z),m[T]=b[0]-w[0],m[T+1]=b[1]-w[1],m[T+2]=b[2]-w[2];const e=v/r.unitInMeters;(Math.abs(x[0]-m[T])>=e||Math.abs(x[1]-m[T+1])>=e||Math.abs(x[2]-m[T+2])>=e)&&(s=!0)}T+=y,C.offset+=3}return E/=_,{update:s,averageGeometrySampledElevation:E}}},29642:(e,t,i)=>{"use strict";i.d(t,{o:()=>o});var r=i(61681),s=i(91478),n=i(64487);class o{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,s.Z7)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=(0,n.ht)(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,s.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=(0,r.Pt)(e.offset,0)}updateFeatureExpressionInfoContext(e,t,i){if((0,r.Wi)(e))return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&(0,r.pC)(t)&&(0,r.pC)(i)?(this._featureExpressionInfoContext=(0,n.d9)(e),(0,n.aO)(this._featureExpressionInfoContext,(0,n.Tz)(s.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new o;return(0,r.pC)(e)&&t.setFromElevationInfo(e),t}}},89301:(e,t,i)=>{"use strict";i.d(t,{K:()=>c,Y:()=>l}),i(91957);var r=i(7753),s=i(61681),n=i(78668),o=i(22167),a=i(74304);class l{constructor(e,t){this.spatialReference=e,this.view=t}getElevation(e,t,i){return this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,i)}async queryElevation(e,t,i,r,s){return this.view.elevationProvider.queryElevation(e,t,0,this.spatialReference,s,i,r)}}class c{constructor(e,t,i,r){this.spatialReference=t,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...r,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(o.T8.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,t,i,s=0){return new Promise(((o,a)=>{const l={x:e,y:t,minDemResolution:s,result:{resolve:o,reject:a},signal:i};this._queries.push(l),(0,n.fu)(i,(()=>{(0,r.Od)(this._queries,l),a((0,n.zE)())}))}))}get running(){return this._queries.length>0}runTask(){const e=this._queries;this._queries=[];const t=this._getElevationQueryProvider();if(!t)return void e.forEach((e=>e.result.reject()));const i=e.map((e=>[e.x,e.y])),r=e.reduce(((e,t)=>Math.min(e,t.minDemResolution)),1/0),o=new a.Z({points:i,spatialReference:this.spatialReference}),l=e.length>1&&e.some((e=>!!e.signal))?new AbortController:null,c=(0,s.pC)(l)?l.signal:e[0].signal;if((0,s.pC)(l)){let t=0;e.forEach((i=>(0,n.fu)(i.signal,(()=>{t++,i.result.reject((0,n.zE)()),t===e.length&&l.abort()}))))}const u={...this._queryOptions,minDemResolution:r,signal:c};t.queryElevation(o,u).then((t=>{e.forEach(((e,i)=>{(0,s.pC)(e.signal)&&e.signal.aborted?e.result.reject((0,n.zE)()):e.result.resolve(t.geometry.points[i][2])}))})).catch((t=>{e.forEach((e=>e.result.reject(t)))}))}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask()}}}},63630:(e,t,i)=>{"use strict";i.d(t,{S:()=>Q});var r=i(13802),s=i(94984),n=i(30936),o=i(61681),a=i(95550),l=i(69666),c=i(87076),u=i(63669),h=i(29642),d=i(85274),p=i(17905),f=i(14923),m=i(63593),g=i(19214),y=i(70984),_=i(47562),v=i(7358),b=i(21414),w=i(55542),x=i(44685),C=i(25714),T=i(21737),S=i(5079),E=i(46378),A=i(21123),M=i(65684),O=i(9969),R=i(52756),P=i(5474),I=i(95194),L=i(1485),D=i(91907),N=i(17346);class F extends R.A{initializeConfiguration(e,t){t.spherical=e.viewingMode===M.JY.Global}initializeProgram(e){const t=F.shader.get().build(this.configuration);return new I.$(e.rctx,t,P.i)}setPipelineState(e){const t=e?D.wb.ALWAYS:D.wb.LESS;return this.configuration.depthHudEnabled?(0,N.sm)({depthTest:{func:t},depthWrite:N.LZ}):(0,N.sm)({blending:(0,N.wK)(D.zi.ONE,D.zi.SRC_ALPHA,D.zi.ONE_MINUS_SRC_ALPHA,D.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:t},colorWrite:N.BK})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}F.shader=new O.J(L.L,(()=>i.e(3003).then(i.bind(i,23003))));var k=i(36663),U=i(67197),V=i(86942);class z extends V.W{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=T.d.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}(0,k._)([(0,U.o)({count:T.d.COUNT})],z.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,k._)([(0,U.o)()],z.prototype,"spherical",void 0),(0,k._)([(0,U.o)()],z.prototype,"occlusionTestEnabled",void 0),(0,k._)([(0,U.o)()],z.prototype,"hasVerticalOffset",void 0),(0,k._)([(0,U.o)()],z.prototype,"hasScreenSizePerspective",void 0),(0,k._)([(0,U.o)()],z.prototype,"depthHudEnabled",void 0),(0,k._)([(0,U.o)()],z.prototype,"depthHudAlignStartEnabled",void 0),(0,k._)([(0,U.o)()],z.prototype,"hasSlicePlane",void 0),(0,k._)([(0,U.o)()],z.prototype,"hasMultipassGeometry",void 0),(0,k._)([(0,U.o)({constValue:!0})],z.prototype,"hasSliceInVertexProgram",void 0),(0,k._)([(0,U.o)({constValue:!1})],z.prototype,"isDraped",void 0);class B extends v.F5{constructor(e){super(e,new j),this.techniqueConfig=new z,this._uniqueMaterialIdentifier=B.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(e,t){const i=t?.slot!==E.r.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=(0,o.pC)(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=(0,o.pC)(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=i,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?T.d.Screen:T.d.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!t&&t.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(e){switch(e){case E.r.LINE_CALLOUTS:case E.r.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return e.output===C.H.Color?new H(e):null}createBufferWriter(){return new Z}validateParameters(e){const t=B.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}}class H extends S.Z{beginSlot(e){return this.ensureTechnique(F,e)}}class j extends v.Mt{constructor(){super(...arguments),this.screenOffset=l.Z,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const G=(0,x.U$)().vec3f(b.T.POSITION).vec3f(b.T.NORMAL).vec2f(b.T.UV0).vec4f(b.T.AUXPOS1),W=[(0,w.f)(0,0),(0,w.f)(1,0),(0,w.f)(0,1),(0,w.f)(1,0),(0,w.f)(1,1),(0,w.f)(0,1)];class Z{constructor(){this.vertexBufferLayout=G}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(b.T.POSITION).length}write(e,t,i,r){(0,A.ho)(t.indices.get(b.T.POSITION),t.vertexAttributes.get(b.T.POSITION).data,e.transformation,i.position,r,6),(0,A.s5)(t.indices.get(b.T.NORMAL),t.vertexAttributes.get(b.T.NORMAL).data,e.invTranspTransformation,i.normal,r,6),(0,A.SW)(t.indices.get(b.T.AUXPOS1),t.vertexAttributes.get(b.T.AUXPOS1).data,i.auxpos1,r,6);for(let e=0;e<W.length;++e)i.uv0.setVec(r+e,W[e])}}class q extends p.k{constructor(e,t){super(e,null,t,J),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new B(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const t=this.materialParameters;return t.screenOffset=e.screenOffset||l.Z,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get materialParameters(){const e=this.symbol,t=e.callout,i=(0,o.pC)(t.color)?n.Z.toUnitRGBA(t.color):[0,0,0,0];i[3]*=this._getLayerOpacity();const r=(0,a.F2)(t.size||0);let s=null;if(e.verticalOffset){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e.verticalOffset;s={screenLength:(0,a.F2)(t),minWorldLength:i||0,maxWorldLength:null!=r?r:1/0}}const l=(0,o.pC)(t.border)&&(0,o.pC)(t.border.color)?n.Z.toUnitRGBA(t.border.color):null,c="object"===e.symbolLayers.getItemAt(0).type,u=!c,h=c?0:void 0,d="label-3d"===e.type;return{color:i,size:r,verticalOffset:s,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:l,occlusionTest:u,shaderPolygonOffset:h,depthHUDAlignStart:d,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:v.yD.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return X}createGraphics3DGraphic(e){const t=e.renderingInfo,i=e.graphic,r=this.setGraphicElevationContext(i,new h.o,t.elevationOffset||0),n=t.symbol,a="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some((e=>"object"===e.type||"text"===e.type)));if("label-3d"!==n.type&&a)return null;if("point-3d"===n.type&&n.symbolLayers.every((e=>"text"===e.type&&!(0,s.as)(e))))return null;const l=(0,f.zE)(i.geometry);return(0,o.Wi)(l)?null:this._createAs3DShape(l,r,t,i.uid)}layerOpacityChanged(){return(0,o.Wi)(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,s=(0,u.GC)(q.elevationModeChangeTypes,i,r);return s!==u.lO.UPDATE||e.forEach((e=>{const i=t(e);(0,o.pC)(i)&&this.updateGraphicElevationContext(e.graphic,i)})),s}slicePlaneEnabledChanged(){return(0,o.Wi)(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(e,t,i=0){const r=super.setGraphicElevationContext(e,t);return r.addOffsetRenderUnits(i),r}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=(0,u.Xf)(t.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:g.WU.memory}}_createVertexData(e){const{translation:t,centerOffset:i}=e,r=t?{size:3,data:[t[0],t[1],t[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},s=i?{size:4,data:[i[0],i[1],i[2],i[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[b.T.POSITION,r],[b.T.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[b.T.AUXPOS1,s]]}_getOrCreateMaterial(e){const t=this._perInstanceMaterialParameters(e),i=B.uniqueMaterialIdentifier(t);if((0,o.pC)(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection){let r=e.materialCollection.get(i);return(0,o.Wi)(r)&&(r=new B(t),e.materialCollection.add(i,r)),{material:r,isUnique:!1}}return{material:new B(t),isUnique:!0}}_createAs3DShape(e,t,i,r){const s=[new _.Z(this._createVertexData(i),Y,y.MX.Point)],n=this._getOrCreateMaterial(i),o=(0,m.km)(this._context,e,s,[n.material],t,this._context.layer.uid,r);if(null===o)return null;const a=new d.z(this,o.object,s,n.isUnique?[n.material]:null,null,c.j3,t);return a.metadata={elevationOffset:i.elevationOffset||0},a.alignedSampledElevation=o.sampledElevation,a.needsElevationUpdates=(0,u.Xf)(t.mode),(0,m.dO)(a,e,this._context.elevationProvider),a}}q.elevationModeChangeTypes={definedChanged:u.lO.UPDATE,staysOnTheGround:u.lO.UPDATE,onTheGroundChanged:u.lO.RECREATE};const $=new Uint16Array([0]),Y=[[b.T.POSITION,$],[b.T.NORMAL,$],[b.T.AUXPOS1,$]],X={mode:"relative-to-ground",offset:0},J={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},K=r.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Q(e,t){if(!(0,s.Pd)(e))return K.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=ee[e.callout.type];return i?new i(e,t):(K.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const ee={line:q}},51555:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});class r{constructor(e,t,i){this.graphic=e,this.renderingInfo=t,this.layer=i}}},85274:(e,t,i)=>{"use strict";i.d(t,{z:()=>d});var r=i(61681),s=i(6766),n=i(8909),o=i(37116),a=i(91917),l=i(64487),c=i(14923),u=i(70984),h=i(75427);class d{constructor(e,t,i,r,s,n,o,a=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=i,this._uniqueMaterials=r,this._sharedResource=s,this.elevationAligner=n,this.elevationContext=o,this._edgeState=a,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=e,this.stageObject=t}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(e,t){this._stageLayer=t,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const t=this._stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)&&t.removeObject(this.stageObject),this.stageObject.dispose(),(0,r.pC)(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,t){if((0,r.Wi)(this._edgeState))return;const i=p(this._edgeState.baseMaterial);let s=!1;for(const e of this._edgeState.edgeMaterials)e.objectTransparency!==i&&(e.objectTransparency=i,s=!0);s&&this._resetEdgeObject(t),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,t){(0,r.Wi)(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!t),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(null!=this._stage&&this._visible!==e&&(this._visible=e,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),(0,r.pC)(this._edgeState))){const t=this._stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)?t.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(t,!1)}}get visible(){return this._visible}alignWithElevation(e,t,i,s){null!=this.elevationAligner&&((0,r.pC)(i)&&(0,l.aO)(this.elevationContext.featureExpressionInfoContext,i),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e,t),this._resetEdgeObject(s))}getCenterObjectSpace(e=(0,n.c)()){return(0,s.c)(e,(0,a.g)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=(0,o.Ue)()){const t=this.stageObject.boundingVolumeObjectSpace;return(0,o.op)(e,t.min),(0,o.Tn)(e,t.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const t=this.stageObject.transformation;e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++}else for(const t of this.stageObject.geometryRecords)t.computeAttachmentOrigin(g)&&((0,s.m)(g,g,this.stageObject.transformation),(0,s.a)(e.render.origin,e.render.origin,g),e.render.num++)}async getProjectedBoundingBox(e,t,i,n,a){const l=this.getBoundingBoxObjectSpace(a),u=y,h=(0,o.wp)(l)?1:u.length;for(let e=0;e<h;e++){const t=u[e];m[0]=l[t[0]],m[1]=l[t[1]],m[2]=l[t[2]],(0,s.m)(m,m,this.stageObject.transformation),f[3*e+0]=m[0],f[3*e+1]=m[1],f[3*e+2]=m[2]}if(!e(f,0,h))return null;(0,o.cS)(l);let d=null;this.calculateRelativeScreenBounds&&(d=this.calculateRelativeScreenBounds());for(let e=0;e<3*h;e+=3){for(let t=0;t<3;t++)l[t]=Math.min(l[t],f[e+t]),l[t+3]=Math.max(l[t+3],f[e+t]);d&&i.push({location:f.slice(e,e+3),screenSpaceBoundingRect:d})}if(t&&t.service&&"absolute-height"!==this.elevationContext.mode){(0,o.be)(l,g);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let i=0;if(t.useViewElevation)i=(0,r.Pt)(t.service.getElevation(g[0],g[1],e),0);else try{const s=(0,c.Si)(l,t);i=(0,r.Pt)(await t.service.queryElevation(g[0],g[1],n,s,e),0)}catch(e){}(0,o.cv)(l,0,0,-this.alignedSampledElevation+i)}return l}addObjectState(e,t){e===u.V_.Highlight&&t.addObject(this.stageObject,this.stageObject.highlight()),e===u.V_.MaskOccludee&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}_resetEdgeObject(e){if((0,r.Wi)(this._edgeState))return;const t=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(t,e):t.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,t){const i=this._edgeState;if((0,r.Wi)(i))return;const s=p(i.baseMaterial);for(const e of i.edgeMaterials)e.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!t).then((()=>this._stageLayer?.sync()))}}function p(e){return e.isVisible?e.parameters.transparent?h.i.TRANSPARENT:h.i.OPAQUE:h.i.INVISIBLE}const f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=(0,n.c)(),g=(0,n.c)(),y=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},37753:(e,t,i)=>{"use strict";i.d(t,{Z:()=>fo});var r=i(67979),s=i(61681),n=i(78668),o=i(4745),a=i(34596),l=i(55709),c=i(69666),u=i(6766),h=i(8909),d=i(89542),p=i(90472),f=i(37116),m=i(24568),g=i(48358),y=i(12065),_=i(12391),v=i(64487);const b=new a.Z(Array,(e=>(0,f.t8)(e,f.xE)),null,10,5),w=(0,m.Ue)();class x{constructor(e,t,i,r,n){this.graphic=e,this.graphics3DSymbol=t,this.graphics=i,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=function(e,t){const i=new Array(e);for(let e=0;e<i.length;e++)i[e]=new Array(t);return i}(_.E._COUNT,_.P._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++t.referenced,this._featureExpressionFeature=n?(0,v.Tz)(n,e,r):null;for(const e of i)(0,s.pC)(e)&&(this.isElevationSource=this.isElevationSource||e.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(e,t){this._layer=t,this._stage=e,this._forEachSymbolLayerGraphic((i=>{i.initialize(e,t),i.setVisibility(this.isVisible())}))}destroy(){this._forEachSymbolLayerGraphic((e=>e.destroy())),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.graphics}clearLabelGraphics(){this._forEachLabelGraphic((e=>e.destroy())),this._labelGraphics.length=0}addLabelGraphic(e,t,i){this._labelGraphics.push(e),e.initialize(t,i),e.setVisibility(this.isVisible(_.E.LABEL))}addAuxiliaryGraphic(e){this._auxiliaryGraphics.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic((t=>{"draped"===t.type&&(e=!0)})),e}isVisible(e=_.E.GRAPHIC,t){for(let i=0;i<=e;i++){const e=this._visibilityFlags[i];for(let i=0;i<e.length;++i)if(!1===e[i]&&i!==t)return!1}return!0}hasVisibilityFlag(e,t){return null!=this._visibilityFlags[t][e]}setVisibilityFlag(e,t,i){const r=this.isVisible(i);this._visibilityFlags[i][e]=t;const s=this.isVisible(i);if(r===s)return!1;if(i===_.E.LABEL)this._forEachLabelGraphic((e=>e.setVisibility(s)));else{this._forEachSymbolLayerGraphic((e=>e.setVisibility(s)));const e=this.isVisible(_.E.LABEL);this._forEachLabelGraphic((t=>t.setVisibility(e)))}return!0}clearVisibilityFlag(e,t=_.E.GRAPHIC){return this.setVisibilityFlag(e,void 0,t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if((0,s.Wi)(t))return!1;this._extent=(0,m.Ue)(),(0,g.TF)(t,this._extent);const i=t.spatialReference;if(!i.equals(e)&&!(0,p.dH)(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return(0,s.pC)(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===t||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=t),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,t,i){let r=e.geometry;return"mesh"!==r.type&&"extent"!==r.type||(r=d.Z.fromExtent("mesh"===r.type?r.extent:r)),(0,y.GH)(r,t,i)}get usedMemory(){let e=(0,o.f2)(this.graphic.attributes);return this._forEachSymbolLayerGraphic((t=>{const i=t.graphics3DSymbolLayer.complexity;if((0,s.Wi)(i))return;const r="draped"===t.type?i.memory.draped:i.memory;e+=r.bytesPerFeature,r.bytesPerCoordinate&&(e+=(0,g.R3)(this.graphic.geometry)*r.bytesPerCoordinate)})),e}computeAttachmentOrigin(){const e={render:{origin:(0,h.c)(),num:0},draped:{origin:(0,c.a)(),num:0}};for(const t of this.graphics)(0,s.Wi)(t)||t.computeAttachmentOrigin(e);return e.render.num&&(0,u.g)(e.render.origin,e.render.origin,1/e.render.num),e.draped.num&&(0,l.f)(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,i,n,o){return o||(o={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),o.boundingBox?(0,f.cS)(o.boundingBox):o.boundingBox=(0,f.cS)(),o.requiresDrapedElevation=!1,await(0,r.Ed)(this.graphics,(async r=>{if((0,s.Wi)(r))return;const a="draped"===r.type?t:e,l=b.acquire(),c=await r.getProjectedBoundingBox(a,i,o.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(o.requiresDrapedElevation=!0),c&&(0,f.TC)(o.boundingBox,l),b.release(l)})),(0,f.sU)(o.boundingBox)||(0,m.sU)((0,f.y8)(o.boundingBox,w))?o:null}needsElevationUpdates(){for(const e of this.graphics)if((0,s.pC)(e)&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;for(const e of this._labelGraphics)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,t,i){this._forEachRenderedGraphic((r=>{"object3d"!==r.type&&"lod-instance"!==r.type||r.alignWithElevation(e,t,this._featureExpressionFeature,i)}))}addObjectStateSet(e,t){this._forEachSymbolLayerGraphic((i=>i.addObjectState(e,t)))}removeObjectState(e){this._forEachSymbolLayerGraphic((t=>t.removeObjectState(e)))}_forEachGraphicList(e,t){e.forEach((e=>e&&t(e)))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.graphics,e),this._forEachGraphicList(this._auxiliaryGraphics,e)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelGraphics,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}}var C=i(85274),T=i(13802),S=i(70375),E=i(5992),A=i(1662),M=i(34344),O=i(24455),R=i(39100),P=i(81936),I=i(86717),L=i(67905),D=i(65684),N=i(63669),F=i(29642),k=i(17905),U=i(14923),V=i(4357),z=(i(91957),i(35413)),B=i(99608),H=i(47562),j=i(21414),G=i(91772);function W(e){const t=[[j.T.POSITION,e.indices]],i=[[j.T.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return(0,s.pC)(e.attributeData.color)&&(i.push([j.T.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([j.T.COLOR,new Uint32Array(e.indices.length)])),(0,s.pC)(e.attributeData.uvMapSpace)&&(i.push([j.T.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([j.T.UVMAPSPACE,e.indices])),(0,s.pC)(e.attributeData.boundingRect)&&(i.push([j.T.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([j.T.BOUNDINGRECT,e.indices])),(0,s.pC)(e.attributeData.mapPosition)&&(i.push([j.T.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([j.T.MAPPOS,e.indices])),new H.Z(i,t)}function Z(e){const t=[[j.T.POSITION,e.indices],[j.T.UV0,e.indices]],i=[[j.T.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[j.T.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return(0,s.pC)(e.attributeData.mapPosition)&&(i.push([j.T.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([j.T.MAPPOS,e.indices])),new H.Z(i,t)}function q(e){switch(e.type){case"extent":if(e instanceof G.Z)return d.Z.fromExtent(e);break;case"polygon":return e}return null}function $(e,t,i,r){const s=(0,z.Mk)(e.rings,e.hasZ,z.ZI.CCW_IS_HOLE),n=new Float64Array(s.position.length),o=(0,N.rR)(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,i,r),a=null!=o;return{position:s.position,mapPosition:n,polygons:J(s.polygons,s.position,n),outlines:X(s.outlines,s.position,n),projectionSuccess:a,sampledElevation:o}}function Y(e,t){const i=(0,z.Mk)(e.rings,!1,z.ZI.CCW_IS_HOLE),r=(0,p.CM)(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let e=2;e<i.position.length;e+=3)i.position[e]=B.Rn;return{position:i.position,polygons:J(i.polygons,i.position),outlines:X(i.outlines,i.position),projectionSuccess:r}}function X(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const e=3*s,o=e+3*n;r.push({index:s,count:n,position:t.subarray(e,o),mapPosition:i?i.subarray(e,o):void 0})}return r}function J(e,t,i){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const e=3*s,l=e+3*n,c=o.map((e=>e-s));r.push({index:s,count:n,holeIndices:c,pathLengths:a,position:t.subarray(e,l),mapPosition:i?i.subarray(e,l):void 0})}return r}var K=i(57180),Q=i(3289),ee=i(66143),te=i(70984),ie=i(49394),re=i(46151);const se=["polygon","extent"];class ne extends k.k{constructor(e,t,i,r){super(e,t,i,r),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,U.bh)(this._getSymbolSize());if(e)throw new S.Z("graphics3dextrudesymbollayer:invalid-size",e)}const e=(0,s.U2)(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e),i=(0,h.d)(t),r=t[3],n=r<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:r,transparent:n,cullFace:n?te.Vr.None:te.Vr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new re.Gp(o),this._bottomMaterial=new re.Gp({...o,cullFace:te.Vr.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,se,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),r=this.setGraphicElevationContext(t,new F.o);return this._createAs3DShape(t,e.renderingInfo,i,r,t.uid)}layerOpacityChanged(e,t){const i=(0,s.U2)(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i),n=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:n}),this._bottomMaterial.setParameters({opacity:r,transparent:n});const o=this._getLayerOpacity();return e.forEach((e=>{const i=t(e);(0,s.pC)(i)&&i.layerOpacityChanged(o,this._context.isAsync)})),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,N.B5)}slicePlaneEnabledChanged(e,t){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach((e=>{const i=t(e);(0,s.pC)(i)&&i.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(e){let t;return t=e.size&&this._drivenProperties.size?(0,L.sV)(e.size,2)??0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(e,t){return this._drivenPropertiesChanged(t)?V.W.Recreate_Symbol:V.W.Recreate_Graphics}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,t,i,r,n){const o=q(e.geometry);if((0,s.Wi)(o))return null;const a=$(o,this._context.elevationProvider,this._context.renderCoordsHelper,r);if(this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer"),0===o.rings.length||!o.rings.some((e=>e.length>0)))return null;const l=(0,U.zE)(o);if((0,s.Wi)(l))return null;const c=new Array,u=new Array,d=new Array,m=(0,f.Ue)(),g=(0,R.c)(),y=(0,h.c)(),_=this._context.renderCoordsHelper.viewingMode===D.JY.Global;_||this._context.renderCoordsHelper.worldUpAtPosition(null,y),(0,p.Bm)(o.spatialReference,[l.x,l.y,0],g,this._context.renderCoordsHelper.spatialReference);const v=(0,R.c)();(0,O.a)(v,g);const b=(0,M.c)();(0,A.a)(b,v);const{polygons:w,mapPosition:x,position:T}=a,S=T.length/3,L=new Float64Array(3*S*6),F=new Float64Array(3*S*6),k=new Float64Array(3*S*6),V=new Float64Array(1*S*6);let z=0;for(let e=0;e<w.length;++e){const r=w[e],s=r.count;if(this._context.clippingExtent&&((0,f.cS)(m),(0,f.G1)(m,r.mapPosition),!(0,f.Zp)(m,this._context.clippingExtent)))continue;const n=(0,E.e)(r.mapPosition,r.holeIndices,3);if(0===n.length)continue;const o=3*s*2+n.length,a=new Uint32Array(o),l=new Uint32Array(n.length),h=6*s,p=3*L.BYTES_PER_ELEMENT,g=new P.fP(L.buffer,z*p,p,(z+h)*p),C=3*F.BYTES_PER_ELEMENT,S=new P.fP(F.buffer,z*C,C,(z+h)*C),A=new Float64Array(k.buffer,3*z*k.BYTES_PER_ELEMENT,3*h),M=new Float64Array(V.buffer,1*z*V.BYTES_PER_ELEMENT,1*h),O=this._getExtrusionSize(t);ae(T,x,n,r,g.typedBuffer,A,S.typedBuffer,M,0,a,l,O,y,_),(0,I.t)(g,g,v),(0,I.a)(S,S,b),z+=6*s;const D=oe(a,a.length-l.length,{positions:g.typedBuffer,elevation:A,normals:S.typedBuffer,heights:M},i);c.push(D),u.push(this._material),d.push(R.I);const N=oe(l,0,{positions:g.typedBuffer,elevation:A,normals:S.typedBuffer,heights:M},i);c.push(N),u.push(this._bottomMaterial),d.push(R.I)}if(0===c.length)return null;const B=new ie.T({geometries:c,materials:u,transformations:d,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});B.transformation=g;const H=(0,K.hM)(this.symbolLayer,{opacity:this._getLayerOpacity()}),j=(0,s.pC)(H)?{baseMaterial:this._material,edgeMaterials:[H],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,G=new C.z(this,B,c,null,null,_e,r,j);return G.alignedSampledElevation=a.sampledElevation,G.needsElevationUpdates=(0,N.B5)(r.mode),G}}function oe(e,t,i,r){const s=new Uint32Array(e.length),n=[[j.T.POSITION,{size:3,data:i.positions,exclusive:!0}],[j.T.NORMAL,{size:3,data:i.normals,exclusive:!0}],[j.T.COLOR,{size:4,data:r,exclusive:!0}],[j.T.SIZE,{size:1,data:i.heights,exclusive:!0}]],o=[[j.T.POSITION,e],[j.T.NORMAL,e],[j.T.COLOR,s]];return i.elevation&&(n.push([j.T.MAPPOS,{size:3,data:i.elevation}]),o.push([j.T.MAPPOS,e])),new H.Z(n,o,te.MX.Triangle,t)}function ae(e,t,i,r,s,n,o,a,l,c,h,d,p,f){const m=i.length/3;let g=0,y=2*r.count;(function(e,t,i,r,s,n,o,a,l,c,h,d,p,f,m,g,y,_){(0,u.c)(be,y);const v=g>0?1:-1;let b=3*i,w=d,x=3*w,C=d+r,T=3*C;for(let i=0;i<r;++i)_&&(be[0]=e[b+0],be[1]=e[b+1],be[2]=e[b+2],(0,u.n)(be,be)),a[x+0]=e[b+0],a[x+1]=e[b+1],a[x+2]=e[b+2],l[x+0]=t[b+0],l[x+1]=t[b+1],l[x+2]=t[b+2],c[x+0]=-v*be[0],c[x+1]=-v*be[1],c[x+2]=-v*be[2],h[w]=0,a[T+0]=e[b+0]+g*be[0],a[T+1]=e[b+1]+g*be[1],a[T+2]=e[b+2]+g*be[2],l[T+0]=t[b+0],l[T+1]=t[b+1],l[T+2]=t[b+2],c[T+0]=v*be[0],c[T+1]=v*be[1],c[T+2]=v*be[2],h[C]=g,x+=3,T+=3,b+=3,w+=1,C+=1;b=0,x=0,T=3*m;const S=g<0?Ce:xe,E=g<0?xe:Ce;for(let e=0;e<o;++e)f[x+0]=s[b+S[0]],f[x+1]=s[b+S[1]],f[x+2]=s[b+S[2]],p[T+0]=s[b+E[0]]+r,p[T+1]=s[b+E[1]]+r,p[T+2]=s[b+E[2]]+r,x+=3,T+=3,b+=3})(e,t,r.index,r.count,i,0,m,s,n,o,a,l,c,h,y,d,p,f),l+=2*r.count,y=0,ue(s,n,a,o,g,r.pathLengths[0],r.count,l,c,y,d),l+=4*r.pathLengths[0],y+=2*r.pathLengths[0],g+=r.pathLengths[0];for(let e=1;e<r.pathLengths.length;++e)ue(s,n,a,o,g,r.pathLengths[e],r.count,l,c,y,d),l+=4*r.pathLengths[e],y+=2*r.pathLengths[e],g+=r.pathLengths[e]}function le(e,t,i,r,s,n,o){r[n]=r[o],o*=3,e[0+(n*=3)]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const ce=(0,h.c)();function ue(e,t,i,r,s,n,o,a,l,c,u){let h=s,d=s+1,p=s+o,f=s+o+1,m=a,g=a+1,y=a+2*n,_=a+2*n+1;u<0&&(h=s+o+1,f=s),c*=3;for(let a=0;a<n;++a)a===n-1&&(u>0?(d=s,f=s+o):(d=s,h=s+o)),ge(e,h,d,p,ce),le(e,t,r,i,ce,m,h),le(e,t,r,i,ce,g,d),le(e,t,r,i,ce,y,p),le(e,t,r,i,ce,_,f),l[c++]=m,l[c++]=y,l[c++]=_,l[c++]=m,l[c++]=_,l[c++]=g,h++,d++,p++,f++,m+=2,g+=2,y+=2,_+=2}const he=(0,h.c)(),de=(0,h.c)(),pe=(0,h.c)(),fe=(0,h.c)(),me=(0,h.c)();function ge(e,t,i,r,s){t*=3,i*=3,r*=3,(0,u.s)(he,e[t++],e[t++],e[t++]),(0,u.s)(de,e[i++],e[i++],e[i++]),(0,u.s)(pe,e[r++],e[r++],e[r++]),(0,u.b)(fe,de,he),(0,u.b)(me,pe,he),(0,u.f)(s,me,fe),(0,u.n)(s,s)}const ye=(0,h.c)();function _e(e,t,i,r){const s=e.stageObject,n=s.geometryRecords,o=n.length,a="absolute-height"!==t.mode;let l=0;const c=s.transformation,h=(0,O.a)((0,R.c)(),c);for(let e=0;e<o;e+=2){const o=n[e].geometry,d=o.getMutableAttribute(j.T.POSITION).data,p=o.vertexAttributes.get(j.T.SIZE).data,f=o.vertexAttributes.get(j.T.MAPPOS).data,m=new ee.sb(f),g=d.length/3;let y=0,_=!1,v=0;const b=i.spatialReference;for(let e=0;e<g;e++){ye[0]=d[y],ye[1]=d[y+1],ye[2]=d[y+2],(0,N.qZ)(m,i,t,r,we),a&&(v+=we.sampledElevation),Q.Z.TESTS_DISABLE_OPTIMIZATIONS?((0,u.s)(ve,m.array[m.offset+0],m.array[m.offset+1],we.z+p[y/3]),r.toRenderCoords(ve,b,ve),(0,u.m)(ve,ve,h)):((0,u.s)(ve,d[y+0],d[y+1],d[y+2]),(0,u.m)(ve,ve,c),r.setAltitude(ve,we.z+p[y/3]),(0,u.m)(ve,ve,h)),d[y]=ve[0],d[y+1]=ve[1],d[y+2]=ve[2];const e=Te/r.unitInMeters;(Math.abs(ye[0]-d[y])>=e||Math.abs(ye[1]-d[y+1])>=e||Math.abs(ye[2]-d[y+2])>=e)&&(_=!0),m.offset+=3,y+=3}_&&(o.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[e]),n[e+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[e+1])),l+=v/g}return l/o}const ve=(0,h.c)(),be=(0,h.c)(),we=new N.Lm,xe=[0,2,1],Ce=[0,1,2],Te=.01;var Se=i(30936),Ee=(i(4905),i(39994)),Ae=i(95550),Me=i(3466),Oe=i(88589),Re=i(1983),Pe=i(30879),Ie=i(52285),Le=i(59672),De=i(28432),Ne=i(9423),Fe=i(87076),ke=i(79341);class Ue{constructor(e,t,i,r){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=i,this._drapeSourceRenderer=r,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e}setVisibility(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,ke.$.Geometry.ADD);if(e||this._addedToStage){for(const e of this.renderGeometries)e.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ke.$.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,ke.$.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=(0,h.c)()){return(0,u.s)(e,0,0,0)}getBoundingBoxObjectSpace(e=(0,f.Ue)()){return(0,f.cS)(e)}addObjectState(e,t){e===te.V_.Highlight&&(this.renderGeometries.forEach((e=>{const i=e.addHighlight();t.addRenderGeometry(e,i,this)})),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ke.$.State.HIGHLIGHTS))}removeObjectState(e){this.renderGeometries.forEach((t=>{e.removeRenderGeometry(t)}))}removeRenderGeometryObjectState(e,t){e.removeHighlight(t),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ke.$.State.HIGHLIGHTS)}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.computeAttachmentOrigin(Be)&&(e.draped.origin[0]+=Be[0],e.draped.origin[1]+=Be[1],e.draped.num++)}async getProjectedBoundingBox(e,t,i,r,n){(0,f.cS)(n);for(let t=0;t<this.renderGeometries.length;t++){const r=this.renderGeometries[t];this._getRenderGeometryProjectedBoundingRect(r,e,Ve,i),(0,f.VK)(n,Ve)}if(t){let e;(0,f.be)(n,Be);const i=(0,U.Si)(n,t);try{e=await t.service.queryElevation(Be[0],Be[1],r,i,"ground")}catch(e){}(0,s.pC)(e)&&(n[2]=Math.min(n[2],e),n[5]=Math.max(n[5],e))}return n}_getRenderGeometryProjectedBoundingRect(e,t,i,r){if(this.boundingBox)(0,f.t8)(ze,this.boundingBox);else{const t=e.boundingSphere,i=t[3];ze[0]=t[0]-i,ze[1]=t[1]-i,ze[2]=t[2]-i,ze[3]=t[0]+i,ze[4]=t[1]+i,ze[5]=t[2]+i}return t(ze,0,2),this.calculateRelativeScreenBounds&&r.push({location:(0,f.be)(ze),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),(0,f.y8)(ze,i)}}const Ve=(0,m.Ue)(),ze=(0,f.Ue)(),Be=(0,h.c)();var He,je,Ge,We,Ze=i(89160),qe=i(63593),$e=i(57741),Ye=i(19431),Xe=i(6923);function Je(e){return null!=e}function Ke(e){return"number"==typeof e}function Qe(e){return"string"==typeof e}function et(e,t){e&&e.push(t)}function tt(e,t,i,r,s){const n=e.minSize,o=e.maxSize;if(e.expression)return et(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const e=r.symbolSize[i];return t.minSize[i]=e,t.maxSize[i]=e,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=He.DefinedSize,!0}if(Je(e.field))return Je(e.stops)?2===e.stops.length&&Ke(e.stops[0].size)&&Ke(e.stops[1].size)?(it(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=He.DefinedSize,!0):(et(s,"Could not convert size info: stops only supported with 2 elements"),!1):Ke(n)&&Ke(o)&&Je(e.minDataValue)&&Je(e.maxDataValue)?(it(n,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=He.DefinedSize,!0):null!=Xe.a[e.valueUnit]?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/Xe.a[e.valueUnit],t.type[i]=He.DefinedSize,!0):"unknown"===e.valueUnit?(et(s,"Could not convert size info: proportional size not supported"),!1):(et(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!Je(e.field)){if(e.stops&&e.stops[0]&&Ke(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=He.DefinedSize,!0;if(Ke(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=He.DefinedSize,!0}return et(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function it(e,t,i,r,s,n){const o=Math.abs(r-i)>0?(t-e)/(r-i):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-i*o,s.factor[n]=o}function rt(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function st(e,t,i){const r=2===i&&"arithmetic"===e.rotationType;t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function nt(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce(((e,a)=>{if(!e)return e;if(a.valueExpression)return et(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(a.type){case"size":return r?function(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return et(r,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||Qe(e)}(e.field))return et(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return et(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[He.Undefined,He.Undefined,He.Undefined]};let s;switch(e.axis){case"width":return s=tt(e,t.size,0,i,r),s?t:null;case"height":return s=tt(e,t.size,2,i,r),s?t:null;case"depth":return s=tt(e,t.size,1,i,r),s?t:null;case"width-and-depth":return s=tt(e,t.size,0,i,r),s&&tt(e,t.size,1,i,r),s?t:null;case null:case void 0:case"all":return s=tt(e,t.size,0,i,r),s=s&&tt(e,t.size,1,i,r),s=s&&tt(e,t.size,2,i,r),s?t:null;default:return et(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}(a,e,t,i):e;case"color":return s?function(e,t,i){if(e.normalizationField)return et(i,"Could not convert color info: unsupported property"),null;if(Qe(e.field)){if(!e.stops)return et(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return et(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.color.values[e]=i.value,rt(t.color.colors,e,i.color)}}}else{if(!(e.stops&&e.stops.length>=0))return et(i,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,rt(t.color.colors,e,i)}}return t}(a,e,i):e;case"opacity":return o?function(e,t,i){if(e.normalizationField)return et(i,"Could not convert opacity info: unsupported property"),null;if(Qe(e.field)){if(!e.stops)return et(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return et(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.opacity.values[e]=i.value,t.opacity.opacityValues[e]=i.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return et(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=i}}return t}(a,e,i):null;case"rotation":return n?function(e,t,i){if(!Qe(e.field))return et(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return et(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return st(e,t.rotation,0),t;case"roll":return st(e,t.rotation,1),t;case null:case void 0:case"heading":return st(e,t.rotation,2),t;default:return et(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(a,e,i):e;default:return null}}),{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!function(e,t,i){for(let i=0;i<3;++i){let r=t.unitInMeters;e.type[i]===He.DefinedSize&&(r*=t.modelSize[i],e.type[i]=He.DefinedScale),e.minSize[i]=e.minSize[i]/r,e.maxSize[i]=e.maxSize[i]/r,e.offset[i]=e.offset[i]/r,e.factor[i]=e.factor[i]/r}let r;if(e.type[0]!==He.Undefined)r=0;else if(e.type[1]!==He.Undefined)r=1;else{if(e.type[2]===He.Undefined)return et(i,"No size axis contains a valid size or scale"),!1;r=2}for(let t=0;t<3;++t)e.type[t]===He.Undefined&&(e.minSize[t]=e.minSize[r],e.maxSize[t]=e.maxSize[r],e.offset[t]=e.offset[r],e.factor[t]=e.factor[r],e.type[t]=e.type[r]);return!0}(a.size,t,i)?null:a:null}function ot(e){return e&&null!=e.size}function at(e,t){if(!e)return{enabled:!1};if(Q.Z.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=nt(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:ut(i,t),requiresShaderTransformation:ot(i)}:{enabled:!1}}function lt(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,s=nt(t.visualVariables,i);return!!s&&!!(ct(r.size,s.size,"size")&&ct(r.color,s.color,"color")&&ct(r.rotation,s.rotation,"rotation")&&ct(r.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=ut(s,i),e.requiresShaderTransformation=ot(s),!0)}function ct(e,t,i){if(!!e!=!!t)return!1;if(e&&e.field!==t.field)return!1;if(e&&"rotation"===i){const i=e,r=t;for(let e=0;e<3;e++)if(i.type[e]!==r.type[e]||i.offset[e]!==r.offset[e]||i.factor[e]!==r.factor[e])return!1}return!0}function ut(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=ot(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=(0,M.c)(),(0,O.i)(ht),function(e,t,i,r=(0,R.c)()){const s=e||0,n=t||0,o=i||0;0!==s&&(0,O.g)(r,r,-s/180*Math.PI),0!==n&&(0,O.r)(r,r,n/180*Math.PI),0!==o&&(0,O.o)(r,r,o/180*Math.PI)}(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],ht),(0,A.f)(i.vvSymbolRotationMatrix,ht)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}(We=He||(He={}))[We.Undefined=0]="Undefined",We[We.DefinedSize=1]="DefinedSize",We[We.DefinedScale=2]="DefinedScale",function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(je||(je={})),function(e){const t=(0,R.c)(),i=(0,h.c)();e.evaluateModelTransform=function(e,r,s){if(!e.vvSizeEnabled)return s;(0,O.c)(t,s);const n=e.vvSymbolRotationMatrix;(0,O.s)(ht,n[0],n[1],n[2],0,n[3],n[4],n[5],0,n[6],n[7],n[8],0,0,0,0,1),(0,O.m)(t,t,ht);for(let t=0;t<3;++t){const s=e.vvSizeOffset[t]+r[0]*e.vvSizeFactor[t];i[t]=(0,Ye.uZ)(s,e.vvSizeMinSize[t],e.vvSizeMaxSize[t])}return(0,O.h)(t,t,i),(0,O.j)(t,t,e.vvSymbolAnchor),t},e.evaluateModelTransformScale=function(e,t,i){if(!t.vvSizeEnabled)return(0,u.s)(e,1,1,1);for(let r=0;r<3;++r){const s=t.vvSizeOffset[r]+i[0]*t.vvSizeFactor[r];e[r]=(0,Ye.uZ)(s,t.vvSizeMinSize[r],t.vvSizeMaxSize[r])}return e}}(Ge||(Ge={}));const ht=(0,R.c)(),dt=Ge.evaluateModelTransform,pt=Ge.evaluateModelTransformScale;var ft=i(6087),mt=i(96047),gt=i(44101),yt=i(98166),_t=i(62589);const vt=(0,R.c)(),bt=(0,h.f)(0,0,1),wt=$e.Ns,xt=[wt/2,wt/2,1-wt/2,1-wt/2],Ct=[$e.Ph*wt,$e.Ph*wt];class Tt extends k.k{constructor(e,t,i,r){super(e,t,i,r),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),i=this._getPrimitive();if((0,s.pC)(i))this._prepareResourcesPrimitive(t,i);else{const i=(0,Le.nf)(this.symbol,this.symbolLayer),r=(0,Me.sJ)(i);r&&"application/json"===r.mediaType?await this._prepareResourcesCIM(t,JSON.parse(r.data),e):await this._prepareResourcesHref(t,i,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=(0,U.bh)(this._getIconSize());if(e)throw new S.Z("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(null!=e.size?(0,Ae.F2)(e.size):16);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){const t=this._getGraphicHash(e);let i=""===t?null:this._cimSymbolTextures.get(t);if(!i){const r={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,e,"esriGeometryPoint",r,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const n={width:s.imageData.width,height:s.imageData.height,powerOfTwoResizeMode:te.CE.PAD};i=new gt.x(s.imageData,n),this._cimSymbolTextures.set(t,i),this._context.stage.add(i)}return i}_computeSize(e,t){const i=e.width/e.height;return i>1?[t,Math.round(t/i)]:[Math.round(t*i),t]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(function(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}(t)){const{screenLength:i,minWorldLength:r,maxWorldLength:s}=t.verticalOffset;e.verticalOffset={screenLength:(0,Ae.F2)(i),minWorldLength:r||0,maxWorldLength:null!=s?s:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const i=this._getOutlineSize();if(St(t)&&0===i)throw new Error("Nothing to render");this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize;const r=this._context.sharedResources.textures.fromData(t,(()=>(0,$e.cU)(t)));this._texture=r.texture,this._releaseTexture=r,e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=xt,e.textureId=this._texture.id;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/wt,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,t,i){if(!(0,Ee.Z)("esri-canvas-svg-support")&&(0,Me.zd)(t))throw new S.Z("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),o=s*this._context.graphicsCoreOwner.view.state.pixelRatio,a=await(0,r.q6)(this._context.sharedResources.textures.fromUrl(t,o,{signal:i}));if(!1===a.ok)throw(0,n.r9)(a.error),new S.Z("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${t})`);this._releaseTexture=a.value;const l=a.value.texture,c=l.params;this._size=this._computeSize(c,s),e.textureId=l.id,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,t,r){const s=new _t.Z({data:t});if(!this._context.sharedResources.cimSymbolRasterizer){const e=(await Promise.all([i.e(1775),i.e(9404),i.e(5017)]).then(i.bind(i,86741))).CIMSymbolRasterizer;(0,n.k_)(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new e(this._context.renderCoordsHelper.spatialReference,!0))}const o=this._context.layer.fields?this._context.layer.fields.map((e=>e.toJSON())):null;let a,l;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,o,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const e=this._context.renderer;if(isNaN(e.scaleExpression)){const t=e.scaleExpression,i=await(0,Pe.Yi)(t,this._context.layer.spatialReference,o);l=(e,t,r)=>{const s=(0,De.Z)(i,e,{$view:r},"esriGeometryPoint",t);return null!==s?s:1}}else a=Number(e.scaleExpression)}this._cimScaleFactorOrFunction=a||l||1;const c=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];(0,n.k_)(r);const u=this._context.layer.fieldsIndex;this._cimRequiredFields=c.map((e=>u.get(e).name)),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||Ie.S}_getOutlineSize(){let e=0;const t=this.symbolLayer;return(0,s.pC)(t.outline)&&null!=t.outline.size?Math.max((0,Ae.F2)(t.outline.size),0):(e=St(this._getPrimitive())?1.5:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),t=this.symbolLayer,i=(0,s.U2)(t,"outline","color");if((0,s.pC)(i)){const t=Se.Z.toUnitRGB(i),r=i.a*e;return[t[0],t[1],t[2],r]}return[0,0,0,0]}_getFillColor(){if(St(this._getPrimitive()))return Ne.rD;const e=(0,s.Wi)(this._getPrimitive()),t=(0,s.U2)(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_getAnchorPos(e,t){return"relative"===e?(0,c.f)((t.x||0)+.5,.5-(t.y||0)):e in Ze.yY?Ze.yY[e]:Ze.yY.center}_createMaterialAndAddToStage(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=at(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let i=(0,s.pC)(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new yt.A(e),this._cimSymbolMaterials.set((0,s.Pt)(e.textureId,0),i),t.add(i)),i}return this._material=new yt.A(e),t.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial((e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})})),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial((e=>this._context.stage.remove(e))),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((e=>this._context.stage.remove(e))),this._cimSymbolTextures.clear(),this._releaseTexture=(0,s.RY)(this._releaseTexture)}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){for(let t=0;t<3;t++){const i=e.size[t];i&&"symbol-value"!==i&&"proportional"!==i&&(e.size[t]=(0,Ae.F2)(i))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let i,r;if(this._cimLayers){if(!this._cimLayers.length)return null;const e=this._generateTextureCIM(t),s={textureId:e.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(s,this._context.stage),i=[e.params.width,e.params.height]}else i=this._size,r=(0,s.Wg)(this._material);const n=(0,qe.S_)(t.geometry);if((0,s.Wi)(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const e=i[0]>i[1]?i[0]:i[1];l=this._getScaleFactor(o,e)}l*=this._symbolTextureRatio;const c=[i[0]*l,i[1]*l],u=this.setGraphicElevationContext(t,new F.o);return this.ensureDrapedStatus("on-the-ground"===u.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,n,r,a,c,e.layer.uid):this._createAs3DShape(t,n,r,a,c,u,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();return this._forEachMaterial((i=>{i.setParameters({color:e}),i.setParameters({outlineColor:t})})),!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,s=(0,N.GC)(Tt.elevationModeChangeTypes,i,r);if(s!==N.lO.UPDATE)return s;const n=(0,N.Xf)(r)||"absolute-height"===r;return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>n))}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial((e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return V.W.Recreate_Symbol;if(!lt(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return V.W.Recreate_Symbol;(0,s.pC)(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return V.W.Fast_Update}_defaultElevationInfoNoZ(){return Et}_createAs3DShape(e,t,i,r,s,n,o){const a=this.getFastUpdateAttrValues(e),l=a?e=>dt(this._fastUpdates.materialParameters,a,e):null,c=[ft.Z.createPointGeometry(bt,null,r,s,At,null,a)],u=(0,qe.km)(this._context,t,c,[i],n,this._context.layer.uid,o,l);if(null===u)return null;const h=new C.z(this,u.object,c,null,null,Fe.j3,n);return h.alignedSampledElevation=u.sampledElevation,h.needsElevationUpdates=(0,N.Xf)(n.mode)||"absolute-height"===n.mode,h.getScreenSize=this._createScreenSizeGetter(s,l),h.calculateRelativeScreenBounds=e=>i.calculateRelativeScreenBounds(h.getScreenSize(),1,e),(0,qe.dO)(h,t,this._context.elevationProvider),h}_createAsOverlay(e,t,i,r,n,o){i.renderPriority=this._renderPriority;const a=(0,Re.c)();(0,p.KC)(t,a,this._context.overlaySR),a[2]=B.Rn;const l=this._context.clippingExtent;if((0,s.pC)(l)&&!(0,f.BD)(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=c?e=>dt(this._fastUpdates.materialParameters,c,e):null,h=ft.Z.createPointGeometry(bt,a,r,n,null,null,c),d=new mt.z(h,i,{layerUid:o,graphicUid:e.uid,calculateShaderTransformation:u});a[3]=0,(0,Oe.c)(d.boundingSphere,a);const m=new Ue(this,[d],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(n,u),m.calculateRelativeScreenBounds=e=>i.calculateRelativeScreenBounds(m.getScreenSize(),1,e),m}_createScreenSizeGetter(e,t){const i=this._outlineSize+2;if(this._fastUpdates.enabled){const r=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return(e=(0,c.a)())=>{const n=t(vt);return e[0]=n[0]*r+i,e[1]=n[5]*s+i,e}}{const t=e[0]/this._symbolTextureRatio+i,r=e[1]/this._symbolTextureRatio+i;return(e=(0,c.a)())=>(e[0]=t,e[1]=r,e)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=(0,h.f)(e,e,e),i=(0,Ae.Wz)(1),r=e*i;return{modelSize:t,symbolSize:(0,h.f)(r,r,r),unitInMeters:i,transformation:{anchor:h.Z,scale:h.O,rotation:h.Z}}}_getGraphicHash(e){let t="";for(const i of this._cimRequiredFields)t+=i+e.attributes[i];return t}_forEachMaterial(e){(0,s.pC)(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}}function St(e){return!(0,s.Wi)(e)&&("cross"===e||"x"===e)}Tt.PRIMITIVE_SIZE=Ct,Tt.elevationModeChangeTypes={definedChanged:N.lO.UPDATE,staysOnTheGround:N.lO.NONE,onTheGroundChanged:N.lO.RECREATE};const Et={mode:"relative-to-ground",offset:0},At=(0,Re.f)(0,0,0,1);var Mt=i(69341),Ot=i(59225),Rt=i(44685),Pt=i(25714),It=i(71399),Lt=i(80776),Dt=i(7358),Nt=i(46378),Ft=i(67874),kt=i(9969),Ut=i(52756),Vt=i(12045),zt=i(95194),Bt=i(79040),Ht=i(25625),jt=i(17346);const Gt=new Map([[j.T.POSITION,0],[j.T.UV0,2],[j.T.AUXPOS1,3],[j.T.SIZE,6],[j.T.SIZEFEATUREATTRIBUTE,6],[j.T.COLOR,5],[j.T.COLORFEATUREATTRIBUTE,5],[j.T.OPACITYFEATUREATTRIBUTE,7]]);class Wt extends Ut.A{initializeProgram(e){const t=Wt.shader.get().build(this.configuration);return new zt.$(e.rctx,t,Gt)}_makePipelineState(e,t){const i=this.configuration,r=e===te.Am.NONE;return(0,jt.sm)({blending:i.output===Pt.H.Color||i.output===Pt.H.Alpha?r?Vt.wu:(0,Vt.j7)(e):null,depthTest:{func:(0,Vt.Bh)(e)},depthWrite:r?i.writeDepth&&jt.LZ:(0,Vt.K5)(e),colorWrite:jt.BK,stencilWrite:i.hasOccludees?Bt.s3:null,stencilTest:i.hasOccludees?t?Bt.eD:Bt.RY:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=(0,jt.sm)({blending:Vt.wu,depthTest:Bt.zV,depthWrite:null,colorWrite:jt.BK,stencilWrite:null,stencilTest:Bt.YD}),this._occluderPipelineOpaque=(0,jt.sm)({blending:Vt.wu,depthTest:Bt.zV,depthWrite:null,colorWrite:jt.BK,stencilWrite:Bt.P7,stencilTest:Bt.ii}),this._occluderPipelineMaskWrite=(0,jt.sm)({blending:null,depthTest:Bt.JN,depthWrite:null,colorWrite:null,stencilWrite:Bt.s3,stencilTest:Bt.eD})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===Nt.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Nt.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}Wt.shader=new kt.J(Ht.L,(()=>i.e(5465).then(i.bind(i,15465))));var Zt=i(36663),qt=i(67197),$t=i(86942);class Yt extends $t.W{constructor(){super(...arguments),this.output=Pt.H.Color,this.transparencyPassType=te.Am.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,Zt._)([(0,qt.o)({count:Pt.H.COUNT})],Yt.prototype,"output",void 0),(0,Zt._)([(0,qt.o)({count:te.Am.COUNT})],Yt.prototype,"transparencyPassType",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"occluder",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"hasSlicePlane",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"writeDepth",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"draped",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"hasCap",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"vvSize",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"vvColor",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"vvOpacity",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"hasOccludees",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"hasMultipassTerrain",void 0),(0,Zt._)([(0,qt.o)()],Yt.prototype,"cullAboveGround",void 0),(0,Zt._)([(0,qt.o)({constValue:!0})],Yt.prototype,"hasVvInstancing",void 0),(0,Zt._)([(0,qt.o)({constValue:!0})],Yt.prototype,"hasSliceTranslatedView",void 0);var Xt=i(26531);class Jt extends Dt.F5{constructor(e){super(e,new Qt),this._vertexAttributeLocations=Gt,this.techniqueConfig=new Yt,this.layout=this.createLayout()}dispose(){}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.draped=t.slot===Nt.r.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==Xt.R.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===Dt.yD.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const e=(0,Rt.U$)().vec3f(j.T.POSITION).vec2f(j.T.UV0).vec3f(j.T.AUXPOS1);return this.parameters.vvSizeEnabled?e.f32(j.T.SIZEFEATUREATTRIBUTE):e.f32(j.T.SIZE),this.parameters.vvColorEnabled?e.f32(j.T.COLORFEATUREATTRIBUTE):e.vec4f(j.T.COLOR),this.parameters.vvOpacityEnabled&&e.f32(j.T.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new ei(this.layout,this.parameters)}requiresSlot(e,t){if(e===Nt.r.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===Dt.yD.OccludeAndTransparentStencil)return e===Nt.r.OPAQUE_MATERIAL||e===Nt.r.OCCLUDER_MATERIAL||e===Nt.r.TRANSPARENT_OCCLUDER_MATERIAL;const i=(0,It.S)(t);return i===Pt.H.Color||i===Pt.H.Alpha?e===(this.parameters.writeDepth?Nt.r.TRANSPARENT_MATERIAL:Nt.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Nt.r.OPAQUE_MATERIAL}createGLMaterial(e){return e.output===Pt.H.Color||e.output===Pt.H.Alpha||e.output===Pt.H.Highlight||e.output===Pt.H.Depth?new Kt(e):null}}class Kt extends Lt.F{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Wt,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==Pt.H.Color&&this._output!==Pt.H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class Qt extends Ft.n{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Xt.R.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class ei{constructor(e,t){this.vertexBufferLayout=e,this.parameters=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return"begin-end"===this.parameters.placement?12:6}write(e,t,i,r){const s=t.vertexAttributes.get(j.T.POSITION).data,n=s.length/3;let o=1,a=0;this.parameters.vvSizeEnabled?a=t.vertexAttributes.get(j.T.SIZEFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(j.T.SIZE)&&(o=t.vertexAttributes.get(j.T.SIZE).data[0]);let l=[1,1,1,1],c=0;this.parameters.vvColorEnabled?c=t.vertexAttributes.get(j.T.COLORFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(j.T.COLOR)&&(l=t.vertexAttributes.get(j.T.COLOR).data);let h=0;this.parameters.vvOpacityEnabled&&(h=t.vertexAttributes.get(j.T.OPACITYFEATUREATTRIBUTE).data[0]);const d=e.transformation,p=new Float32Array(i.buffer);let f=r*(this.vertexBufferLayout.stride/4);const m=(e,t,i,r)=>{if(p[f++]=e[0],p[f++]=e[1],p[f++]=e[2],p[f++]=i[0],p[f++]=i[1],p[f++]=t[0],p[f++]=t[1],p[f++]=t[2],this.parameters.vvSizeEnabled?p[f++]=a:p[f++]=o,this.parameters.vvColorEnabled)p[f++]=c;else{const e=Math.min(4*r,l.length-4);p[f++]=l[e+0],p[f++]=l[e+1],p[f++]=l[e+2],p[f++]=l[e+3]}this.parameters.vvOpacityEnabled&&(p[f++]=h)};let g;!function(e){e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=-1]="DESCENDING"}(g||(g={}));const y=(e,t)=>{const i=(0,u.s)(ti,s[3*e],s[3*e+1],s[3*e+2]),r=ii;let o=e+t;do{(0,u.s)(r,s[3*o],s[3*o+1],s[3*o+2]),o+=t}while((0,u.z)(i,r)&&o>=0&&o<n);d&&((0,u.m)(i,i,d),(0,u.m)(r,r,d)),m(i,r,[-1,-1],e),m(i,r,[1,-1],e),m(i,r,[1,1],e),m(i,r,[-1,-1],e),m(i,r,[1,1],e),m(i,r,[-1,1],e)},_=this.parameters.placement;"begin"!==_&&"begin-end"!==_||y(0,g.ASCENDING),"end"!==_&&"begin-end"!==_||y(n-1,g.DESCENDING)}}const ti=(0,h.c)(),ii=(0,h.c)();var ri=i(66962),si=i(65392);const ni=["polyline","polygon","extent"];class oi extends k.k{constructor(e,t,i,r){super(e,t,i,r),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=at(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const e=null!=this.symbolLayer.size?this.symbolLayer.size:(0,Ae.Wz)(1);if(e<0)throw new S.Z("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=e}this._markerTexture=(0,Ot.uM)(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(e,t=!1){const i=this._getCombinedOpacityAndColor(t&&this._markerColor||this._materialColor);this._patternHidesLine&&!t&&(i[3]=0);const r={width:this._computeMaterialWidth(this.symbolLayer?.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:(0,Mt.u9)(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:(0,ri.Dp)(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...r,...this._fastUpdates.materialParameters}:r}get _materialColor(){return(0,s.yw)(this.symbolLayer.material,(e=>e.color))}get _markerColor(){return(0,s.yw)(this.symbolLayer.marker,(e=>e.color))}get lineMaterial(){return(0,s.Wi)(this._lineMaterial)&&(this._lineMaterial=new si.U(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return(0,s.Wi)(this._ringMaterial)&&(this._ringMaterial=new si.U(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return(0,s.Wi)(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new si.U({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return(0,s.Wi)(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new si.U({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return(0,s.Wi)(this._markerMaterial)&&(0,s.pC)(this.symbolLayer.marker)&&(0,s.pC)(this._markerTexture)&&(this._markerMaterial=new Jt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial((e=>this._context.stage.remove(e))),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=(0,s.RY)(this._markerTexture)}_getDrivenSize(e){return this._drivenProperties.size&&e.size?(0,Ae.F2)((0,L.o2)(e.size)):1}_getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?(0,k.d)(this._fastUpdates.visualVariables.size.field,e):null}_getDrivenColor(e){const t=(0,Re.f)(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}_getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?(0,k.d)(this._fastUpdates.visualVariables.color.field,e):null}_getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?(0,k.d)(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,ni,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t,new F.o);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,t.uid)}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return V.W.Recreate_Symbol;if(!lt(this._fastUpdates,t,this._vvConvertOptions))return V.W.Recreate_Symbol;this._forEachMaterial((e=>e.setParameters(this._fastUpdates.materialParameters)))}return V.W.Fast_Update}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff,i={};"complete"===t.size?.type&&(i.width=this._computeMaterialWidth(t.size.newValue),delete t.size),"complete"===t.cap?.type&&(i.cap=(0,Mt.u9)((0,s.Pt)(t.cap.newValue,"butt")),delete t.cap);const r=this._prepareMarkerPatch(e,t);this._prepareMaterialPatch(e,t,r),e.symbolLayerStatePatches.push((()=>this._forEachMaterial((e=>e.setParameters(i)))))}layerOpacityChanged(){return this._forEachMaterial(((e,t)=>this._updateMaterialLayerOpacity(e,t))),!0}_forEachMaterial(e){(0,s.pC)(this._lineMaterial)&&e(this._lineMaterial),(0,s.pC)(this._ringMaterial)&&e(this._ringMaterial),(0,s.pC)(this._wireframeLineMaterial)&&e(this._wireframeLineMaterial),(0,s.pC)(this._wireframeRingMaterial)&&e(this._wireframeRingMaterial),(0,s.pC)(this._markerMaterial)&&e(this._markerMaterial,!0)}_updateMaterialLayerOpacity(e,t=!1){const i=e.parameters.color,r=(0,s.U2)(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!t?0:this._getCombinedOpacity(r),o=(0,Re.f)(i[0],i[1],i[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,s=(0,N.GC)(oi.elevationModeChangeTypes,i,r);if(s!==N.lO.UPDATE)return s;const n=(0,N.Xf)(r);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>n))}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial((t=>t.setParameters(e))),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof G.Z)return d.Z.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,t,i){const r=e.graphic,n=this._getGeometryAsPolygonOrPolyline(r.geometry),o="polygon"===n.type?n.rings:n.paths,a=new Array,l=new Array,c=new Array,u=(0,f.Ue)(),h=(0,Mt.VP)(n,this._context.elevationProvider,this._context.renderCoordsHelper,t),d="polygon"===n.type?"rings":"paths";this._logGeometryCreationWarnings(h,o,d,"LineSymbol3DLayer");for(let t=0;t<h.lines.length;t++){const{position:i,mapPosition:r}=h.lines[t];if((0,s.pC)(this._context.clippingExtent)&&((0,f.cS)(u),(0,f.G1)(u,r),!(0,f.Zp)(u,this._context.clippingExtent)))continue;const o=this._createGeometry(e,i,r,n.type,ai.ELEVATED);a.push(o),l.push("polygon"===n.type?this.ringMaterial:this.lineMaterial),c.push(R.I),Q.Z.LINE_WIREFRAMES&&(a.push(o.cloneShallow()),l.push("polygon"===n.type?this.wireframeRingMaterial:this.wireframeLineMaterial),c.push(R.I));const d=this.markerMaterial;(0,s.pC)(d)&&(a.push(o.cloneShallow()),l.push(d),c.push(R.I))}if(0===a.length)return null;const p=new ie.T({geometries:a,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),m=new C.z(this,p,a,null,null,Fe.Lz,t);return m.alignedSampledElevation=h.sampledElevation,m.needsElevationUpdates=(0,N.Xf)(t.mode),m}_createGeometry(e,t,i,r,s){const n="polygon"===r?Mt.NW.REMOVE:Mt.NW.KEEP,o=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return(0,Mt.YU)({overlayInfo:s===ai.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:n,uniformSize:this._uniformSize,attributeData:{position:t,mapPosition:i,size:a?null:this._getDrivenSize(e.renderingInfo),color:o?null:this._getDrivenColor(e.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(e.graphic),colorFeature:this._getColorFeatureAttributeData(e.graphic),opacityFeature:this._getOpacityFeatureAttributeData(e.graphic)}})}_createAsOverlay(e,t){const i=e.graphic,r=this._getGeometryAsPolygonOrPolyline(i.geometry),n="polygon"===r.type?r.rings:r.paths,o="polygon"===r.type?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;const a=Q.Z.LINE_WIREFRAMES?"polygon"===r.type?this.wireframeRingMaterial:this.wireframeLineMaterial:null,l=this.markerMaterial;(0,s.pC)(a)&&(a.renderPriority=this._renderPriority-.001),(0,s.pC)(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=(0,f.Ue)(),h=(0,f.cS)(),d=(0,Mt.rm)(r,this._context.overlaySR),p="polygon"===r.type?"rings":"paths";this._logGeometryCreationWarnings(d,n,p,"LineSymbol3DLayer");for(const n of d.lines){if((0,f.cS)(u),(0,f.G1)(u,n.position),!(0,f.Zp)(u,this._context.clippingExtent))continue;(0,f.TC)(h,u);const d=this._createGeometry(e,n.position,null,r.type,ai.DRAPED),p=e=>{const r=new mt.z(d,e,{layerUid:t,graphicUid:i.uid});return c.push(r),r};if((0,s.pC)(l)){const e=p(l),t=(0,s.Wg)(this.symbolLayer.marker).placement;"begin"!==t&&"begin-end"!==t||(0,f.G1)(u,n.position,0,1),"end"!==t&&"begin-end"!==t||(0,f.G1)(u,n.position,n.position.length-3,1),this._updateBoundingSphere(e,u)}const m=p(o);if(this._updateBoundingSphere(m,u),Q.Z.LINE_WIREFRAMES){const e=p(a);this._updateBoundingSphere(e,u)}}return new Ue(this,c,h,this._context.drapeSourceRenderer)}_updateBoundingSphere(e,t){(0,Oe.s)(e.boundingSphere,.5*(t[0]+t[3]),.5*(t[1]+t[4]),0,.5*Math.sqrt((t[3]-t[0])*(t[3]-t[0])+(t[4]-t[1])*(t[4]-t[1])))}get _patternHidesLine(){const e=this.symbolLayer.pattern;return(0,s.pC)(e)&&"style"===e.type&&"none"===e.style}_computeMaterialWidth(e){return e=(0,s.Pt)(e,(0,Ae.Wz)(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?(0,Ae.F2)(1):1:(0,Ae.F2)(e)}_prepareMaterialPatch(e,t,i){const r=t.material;if((0,s.Wi)(r))return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,e));if("collection"===r.type)return;const n="complete"===r.type?(0,s.yw)(r.newValue,(e=>e.color)):"complete"===r.diff.color.type?r.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor((0,Re.d)(o),this._markerMaterial,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterial,e),delete t.material}_prepareMarkerPatch(e,t){const i=t.marker;if((0,s.Wi)(i)||"partial"!==i.type||(0,s.pC)(i.diff.style)||(0,s.pC)(i.diff.placement)||(0,s.pC)(i.diff.color)&&"complete"!==i.diff.color.type)return{changed:!1,useMaterialColor:(0,s.Wi)(this._markerColor)};const r=i.diff.color;if((0,s.Wi)(r))return delete t.marker,{changed:!1,useMaterialColor:(0,s.Wi)(this._markerColor)};const n=(0,s.Wg)(r.newValue);return(0,s.Wi)(n)?(delete t.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,e),delete t.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,t,i){(0,s.Wi)(t)||i.symbolLayerStatePatches.push((()=>t.setParameters({color:e})))}}var ai;oi.elevationModeChangeTypes={definedChanged:N.lO.RECREATE,staysOnTheGround:N.lO.NONE,onTheGroundChanged:N.lO.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(ai||(ai={}));var li=i(77727),ci=i(1680),ui=i(49921),hi=i(66352),di=i(36620),pi=i(9434),fi=i(91907);const mi=["mesh"];class gi extends k.k{constructor(e,t,i,r){super(e,t,i,r),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Q.Z.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new pi.Y({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new pi.Y({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),(e=>e.material))),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,mi,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(t,new F.o),r=e.renderingInfo;return this._createAs3DShape(t,r,i,t.uid)}layerOpacityChanged(e,t){const i=this._getLayerOpacity();return this._materials.forEach((e=>{e.material.setParameters({layerOpacity:i});const t=e.material.parameters;this._setMaterialTransparentParameter(t,e),e.material.setParameters({transparent:t.transparent})})),e.forEach((e=>{const r=t(e);(0,s.pC)(r)&&r.layerOpacityChanged(i,this._context.isAsync)})),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,N.B5)}slicePlaneEnabledChanged(e,t){return this._materials.forEach((e=>{e.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),e.forEach((e=>{const i=t(e);(0,s.pC)(i)&&i.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach((t=>t.material.setParameters({usePBR:e}))),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return(0,s.Wi)(e)?"-":e instanceof Se.Z?e.toHex():e.contentHash}_materialPropertiesDefault(e,t){const i=this._requiresSymbolVertexColors(),r=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:r,hasVertexTangents:s,uid:`vc:${r},vt:${s},vct${t},svc:${i}`}}_materialProperties(e,t,i){const r=this._materialPropertiesDefault(e,i);if(!t.material)return r;const{color:s,colorTexture:n,normalTexture:o,doubleSided:a,alphaCutoff:l,alphaMode:c}=t.material,u=this._colorOrTextureUid(s),h=this._colorOrTextureUid(n),d=this._colorOrTextureUid(o);if(r.color=s,r.colorTexture=n,r.normalTexture=o,r.uid=`${r.uid},cmuid:${u},ctmuid:${h},ntmuid:${d},ds:${a},ac:${l},am:${c}`,t.material instanceof ci.Z){const{metallic:e,roughness:i,metallicRoughnessTexture:s,emissiveColor:n,emissiveTexture:o,occlusionTexture:a}=t.material,l=this._colorOrTextureUid(s),c=this._colorOrTextureUid(n),u=this._colorOrTextureUid(o),h=this._colorOrTextureUid(a);r.metallic=e,r.roughness=i,r.metallicRoughnessTexture=s,r.emissiveColor=n,r.emissiveTexture=o,r.occlusionTexture=a,r.uid=`${r.uid},mrm:${e},mrr:${i},mrt:${l},emuid:${c},etmuid:${u},otmuid:${h}`}return r}_setInternalColorValueParameters(e,t){t.diffuse=Se.Z.toUnitRGB(e),t.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const t=this._getInternalTexture(e,te.JJ.Opaque);return(0,s.pC)(t)?t.id:null}_getInternalTexture(e,t){const i=this._getLoadableTextureResource(e);if(!i)return null;const r=`${e.contentHash}/${t}`;let s=this._textures.get(r);return s||(s=new gt.x(i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:t!==te.JJ.Opaque}),this._textures.set(r,s),this._context.stage.add(s),this._context.stage.loadImmediate(s)),s}_castTextureWrap(e="repeat"){if("string"==typeof e){const t=this._castTextureWrapIndividual(e);return{s:t,t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return fi.e8.CLAMP_TO_EDGE;case"mirror":return fi.e8.MIRRORED_REPEAT;default:return fi.e8.REPEAT}}_setInternalMaterialParameters(e,t){if((0,s.pC)(e.color)&&this._setInternalColorValueParameters(e.color,t),(0,s.pC)(e.colorTexture)){const i=this._getInternalTexture(e.colorTexture,t.textureAlphaMode);(0,s.pC)(i)?(t.textureId=i.id,t.textureAlphaPremultiplied=!!i.params.preMultiplyAlpha):t.textureId=void 0}(0,s.pC)(e.normalTexture)&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),(0,s.pC)(e.emissiveColor)&&(t.emissiveFactor=Se.Z.toUnitRGB(e.emissiveColor)),(0,s.pC)(e.emissiveTexture)&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),(0,s.pC)(e.occlusionTexture)&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),(0,s.pC)(e.metallicRoughnessTexture)&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture))}_setExternalMaterialParameters(e){const t=this._drivenProperties.color;let i=(0,s.pC)(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(t)e.externalColor=Re.O;else{const t=(0,s.pC)(this.symbolLayer.material)?this.symbolLayer.material.color:null;(0,s.pC)(t)?e.externalColor=Se.Z.toUnitRGBA(t):(i=null,e.externalColor=Re.O)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const t=e.vertexAttributes.color;if((0,s.Wi)(t))return!1;for(let e=3;e<t.length;e+=4)if(255!==t[e])return!0;return!1}_getOrCreateMaterial(e,t){const i=t.material?.color,r=t.material?.colorTexture,n=t.material?.alphaMode,o="blend"===n,a=!("opaque"===n)&&(this._hasTransparentVertexColors(e)||(0,s.pC)(i)&&i.a<1||(0,s.pC)(r)&&r.transparent||o),l=this._materialProperties(e,t,a),c=this._materials.get(l.uid);if(c)return c.material;const u={material:null,isComponentTransparent:a,alphaMode:t.material?t.material.alphaMode:"opaque"},d=null==l.metallicRoughnessTexture&&null==l.metallic&&null==l.roughness,p={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:h.Z,diffuse:h.O,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:te.Vr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};d||(p.mrrFactors=[null!=l.metallic?l.metallic:1,null!=l.roughness?l.roughness:1,.5]),t.material&&(p.doubleSided=t.material.doubleSided,p.cullFace=t.material.doubleSided?te.Vr.None:te.Vr.Back,p.textureAlphaCutoff=t.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const f=new re.Gp(p);return u.material=f,this._materials.set(l.uid,u),this._context.stage.add(f),f}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?te.JJ.MaskBlend:te.JJ.Opaque:e.textureAlphaMode="opaque"===t.alphaMode?te.JJ.Opaque:"mask"===t.alphaMode?te.JJ.Mask:te.JJ.Blend}_addDebugNormals(e,t,i,r){const s=t.length,n=e.spatialReference.isGeographic?20015077/180:1,o=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),a=[],l=[],c=[],h=[];for(let e=0;e<s;e++){const i=t[e],r=i.vertexAttributes.get(j.T.POSITION),s=i.vertexAttributes.get(j.T.NORMAL),n=i.indices.get(j.T.POSITION),d=i.indices.get(j.T.NORMAL),p=r.data,f=s.data;for(let e=0;e<n.length;e++){const t=3*n[e],i=3*d[e];for(let e=0;e<3;e++)a.push(p[t+e]);for(let e=0;e<3;e++)a.push(p[t+e]+f[i+e]*o);if(l.push(l.length),l.push(l.length),e%3==0){this._calculateFaceNormal(p,n,e,wi),this._getFaceVertices(p,n,e,_i,vi,bi),(0,u.a)(_i,_i,vi),(0,u.a)(_i,_i,bi),(0,u.g)(_i,_i,1/3);for(let e=0;e<3;e++)c.push(_i[e]);for(let e=0;e<3;e++)c.push(_i[e]+wi[e]*o);h.push(h.length),h.push(h.length)}}}const d=new H.Z([[j.T.POSITION,{data:a,size:3,exclusive:!0}]],[[j.T.POSITION,new Uint32Array(l)]],te.MX.Line);t.push(d),i.push(this._debugVertexNormalMaterial),r.push((0,R.b)(r[0]));const p=new H.Z([[j.T.POSITION,{data:c,size:3,exclusive:!0}]],[[j.T.POSITION,new Uint32Array(h)]],te.MX.Line);t.push(p),i.push(this._debugFaceNormalMaterial),r.push((0,R.b)(r[0]))}_createAs3DShape(e,t,i,r){const n=e.geometry;if("mesh"!==n.type)return null;const o=this._createGeometryInfo(n,t);if(!o)return null;const{geometries:a,materials:l,transformations:c,objectTransformation:u}=o;Q.Z.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a,l,c);const h=new ie.T({geometries:a,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:r}});h.transformation=u;const d=this._createEdgeMaterial(),p=(0,s.pC)(d)?{baseMaterial:l[0],edgeMaterials:[d],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,f=new C.z(this,h,a,null,null,Fe.j3,i,p);return f.needsElevationUpdates=(0,N.B5)(i.mode),f.useObjectOriginAsAttachmentOrigin=!0,f.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(h),f.alignedSampledElevation=(0,Fe.j3)(f,f.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),f}_getCenterPointInElevationSR(e){const t=(0,g.Tx)(0,0,0,this._context.elevationProvider.spatialReference);return(0,p.MT)([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,t),t}_createComponentNormals(e,t,i,r){switch(i.shading||"flat"){case"source":return this._createComponentNormalsSource(e,t,i,r);case"flat":return this._createComponentNormalsFlat(e,r);case"smooth":return this._createComponentNormalsSmooth(e,r);default:return}}_createComponentNormalsSource(e,t,i,r){if((0,s.Wi)(t))return this._createComponentNormalsFlat(e,r);let n=!1;if(!i.trustSourceNormals)for(let i=0;i<r.length;i+=3){this._calculateFaceNormal(e,r,i,wi);for(let e=0;e<3;e++){const s=3*r[i+e];_i[0]=t[s+0],_i[1]=t[s+1],_i[2]=t[s+2],(0,u.e)(wi,_i)<0&&(t[s+0]=-t[s+0],t[s+1]=-t[s+1],t[s+2]=-t[s+2],n=!0)}}return{normals:t,indices:r,didFlipNormals:n}}_createComponentNormalsFlat(e,t){const i=new Float32Array(t.length),r=new Uint32Array(3*t.length);for(let s=0;s<t.length;s+=3){const n=this._calculateFaceNormal(e,t,s,wi);for(let e=0;e<3;e++)i[s+e]=n[e],r[s+e]=s/3}return{normals:i,indices:r,didFlipNormals:!1}}_createComponentNormalsSmooth(e,t){const i={};for(let r=0;r<t.length;r+=3){const s=this._calculateFaceNormal(e,t,r,wi);for(let e=0;e<3;e++){const n=t[r+e];let o=i[n];o||(o={normal:(0,h.c)(),count:0},i[n]=o),(0,u.a)(o.normal,o.normal,s),o.count++}}const r=new Float32Array(3*t.length),s=new Uint32Array(3*t.length);for(let e=0;e<t.length;e++){const n=i[t[e]];1!==n.count&&((0,u.n)(n.normal,n.normal),n.count=1);for(let t=0;t<3;t++)r[3*e+t]=n.normal[t];s[e]=e}return{normals:r,indices:s,didFlipNormals:!1}}_getFaceVertices(e,t,i,r,s,n){const o=3*t[i+0],a=3*t[i+1],l=3*t[i+2];r[0]=e[o+0],r[1]=e[o+1],r[2]=e[o+2],s[0]=e[a+0],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l+0],n[1]=e[l+1],n[2]=e[l+2]}_calculateFaceNormal(e,t,i,r){return this._getFaceVertices(e,t,i,_i,vi,bi),(0,u.b)(vi,vi,_i),(0,u.b)(bi,bi,_i),(0,u.f)(_i,vi,bi),(0,u.n)(r,_i),r}_getOrCreateComponents(e){return(0,s.Pt)(e.components,Si)}_createPositionBuffer(e,t){let i=e.vertexAttributes.position;const r=t.reprojection===Ei.ECEF?t.transformBeforeProject:null;if((0,s.pC)(r)&&(i=(0,ui.zZ)(i,new Float64Array(i.length),r)),t.reprojection===Ei.NONE)return t.needsBufferCopy?new Float64Array(i):i;const n=(0,s.pC)(r)?i:new Float64Array(i.length);return(0,p.CM)(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,t,i){let r=e.vertexAttributes.normal;if((0,s.Wi)(r))return null;const n=i.reprojection===Ei.ECEF?i.transformBeforeProject:null;if((0,s.pC)(n)&&(r=(0,ui.w9)(r,new Float32Array(r.length),n)),"local"===this._context.graphicsCoreOwner.view.viewingMode||i.reprojection===Ei.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===r?new Float32Array(r):r;const o=e.vertexAttributes.position,a=(0,s.pC)(n)?r:new Float32Array(r.length);return(0,ui.Iz)(r,o,t,e.spatialReference,a)}_createTangentBuffer(e,t,i){let r=e.vertexAttributes.tangent;if((0,s.Wi)(r))return null;const n=i.reprojection===Ei.ECEF?i.transformBeforeProject:null;if((0,s.pC)(n)&&(r=(0,ui.VS)(r,new Float32Array(r.length),n)),"local"===this._context.graphicsCoreOwner.view.viewingMode||i.reprojection===Ei.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===r?new Float32Array(r):r;const o=e.vertexAttributes.position,a=(0,s.pC)(n)?r:new Float32Array(r.length);return(0,ui.wi)(r,o,t,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),i=(0,hi.F5)((0,s.U2)(this.symbolLayer,"material","colorMixMode")),r=new Uint8Array(4);return(0,hi.HB)(t,i,r),r}return null}_createBuffers(e,t){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const r=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if((0,s.pC)(r)&&r.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if((0,s.pC)(o)&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if((0,s.pC)(n)&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(t),h=this._createNormalBuffer(e,l,a),d=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:h,tangentBuffer:d,uvBuffer:n,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===Ei.NONE&&(0,s.pC)(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(e,l,h,d),geometryTransformation:a.reprojection===Ei.NONE&&(0,s.pC)(a.geometryTransformation)?a.geometryTransformation:(0,R.c)()}}_computeReprojectionInfo(e){const t=(0,s.pC)(e.transform),i=t&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===D.JY.Local?Ei.NONE:Ei.ECEF;if(t){if(i===Ei.NONE){const t=(0,R.c)();return(0,p.Bm)(e.spatialReference,e.transform.origin,t,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:t,geometryTransformation:(0,R.b)(e.transform.localMatrix),needsBufferCopy:!1}}const t=(0,O.f)((0,R.c)(),e.transform.origin);return(0,O.m)(t,t,e.transform.localMatrix),{reprojection:i,transformBeforeProject:t,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(e,t,i,r){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;yi[0]=o.x,yi[1]=o.y,yi[2]=o.z;const a=(0,R.c)();(0,p.Bm)(e.spatialReference,yi,a,n);const l=P.fP.fromTypedArray(t);if((0,O.a)(xi,a),(0,I.t)(l,l,xi),(0,s.pC)(i)||(0,s.pC)(r)){if((0,A.f)(Ci,a),(0,A.t)(Ci,Ci),(0,s.pC)(i)){const e=P.ct.fromTypedArray(i);(0,I.a)(e,e,Ci)}if((0,s.pC)(r)){const e=P.ct.fromTypedArray(r,4*r.BYTES_PER_ELEMENT);(0,I.a)(e,e,Ci)}}return a}_validateFaces(e,t){const i=e.vertexAttributes.position.length/3,r=t.faces;if(r){let e=-1;for(let t=0;t<r.length;t++){const i=r[t];i>e&&(e=i)}if(i<=e)return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,t){return t.faces?t.faces:(0,di.p)(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;const i=this._context.elevationProvider.spatialReference;let r;const s=t.length/3;return e.spatialReference.equals(i)?r=t:(r=new Float64Array(t.length),(0,p.CM)(e.vertexAttributes.position,e.spatialReference,0,r,i,0,s)),(0,f.cS)(Ti),(0,f.G1)(Ti,r,0,s),!(0,f.Zp)(Ti,this._context.clippingExtent)}_createGeometryInfo(e,t){if(!(0,p.Up)(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const i=this._createBuffers(e,t);if((0,s.Wi)(i))return null;const{positionBuffer:r,uvBuffer:n,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:u,geometryTransformation:h}=i,d=this._getOrCreateComponents(e),f=[],m=[],g=[];let y=!1;for(const t of d){if(!this._validateFaces(e,t))return null;const i=this._getOrCreateFaces(e,t);if(0===i.length)continue;const u=this._createComponentNormals(r,l,t,i);u.didFlipNormals&&(y=!0);const d=[[j.T.POSITION,{size:3,data:r,exclusive:!0}],[j.T.NORMAL,{size:3,data:u.normals,exclusive:!0}]],p=[[j.T.POSITION,i],[j.T.NORMAL,u.indices]];(0,s.pC)(o)&&(d.push([j.T.COLOR,{size:4,data:o,exclusive:!0}]),p.push([j.T.COLOR,i])),(0,s.pC)(a)&&(d.push([j.T.SYMBOLCOLOR,{size:4,data:a,exclusive:!0}]),p.push([j.T.SYMBOLCOLOR,new Uint16Array(i.length)])),(0,s.pC)(n)&&(d.push([j.T.UV0,{size:2,data:n,exclusive:!0}]),p.push([j.T.UV0,i])),(0,s.pC)(c)&&(d.push([j.T.TANGENT,{size:4,data:c,exclusive:!0}]),p.push([j.T.TANGENT,i]));const _=new H.Z(d,p);f.push(_),m.push(h),g.push(this._getOrCreateMaterial(e,t))}return y&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:f,transformations:m,materials:g,objectTransformation:u}}_createEdgeMaterial(){const e={opacity:this._getLayerOpacity()};return(0,K.hM)(this.symbolLayer,e)}}const yi=(0,h.c)(),_i=(0,h.c)(),vi=(0,h.c)(),bi=(0,h.c)(),wi=(0,h.c)(),xi=(0,R.c)(),Ci=(0,M.c)(),Ti=(0,f.Ue)(),Si=[new li.Z];var Ei;!function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"}(Ei||(Ei={}));var Ai=i(4125),Mi=i(19049),Oi=i(31248);class Ri{constructor(e,t,i,r){this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=i,this.elevationContext=r,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const t=this.lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}destroy(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,t,i){if(this.elevationAligner){(0,v.aO)(this.elevationContext.featureExpressionInfoContext,i);const r=this.elevationAligner(this,this.elevationContext,e,t);(0,s.pC)(r)&&(this.alignedSampledElevation=r)}}getCenterObjectSpace(e=(0,h.c)()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Ni),(0,u.m)(e,this.lodRenderer.baseBoundingSphere.center,Ni)}getBoundingBoxObjectSpace(e=(0,f.Ue)()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Ni);const t=this.lodRenderer.baseBoundingBox;(0,f.cS)(e);for(let i=0;i<8;++i)(0,u.s)(Ii,0==(1&i)?t[0]:t[3],0==(2&i)?t[1]:t[4],0==(4&i)?t[2]:t[5]),(0,u.m)(Ii,Ii,Ni),(0,f.pp)(e,Ii);return e}computeAttachmentOrigin(e){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Ni),e.render.origin[0]+=Ni[12],e.render.origin[1]+=Ni[13],e.render.origin[2]+=Ni[14],e.render.num++}async getProjectedBoundingBox(e,t,i,r,n){const o=this.getBoundingBoxObjectSpace(n),a=Di,l=(0,f.wp)(o)?1:a.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Ni);for(let e=0;e<l;e++){const t=a[e];Ii[0]=o[t[0]],Ii[1]=o[t[1]],Ii[2]=o[t[2]],(0,u.m)(Ii,Ii,Ni),Pi[3*e+0]=Ii[0],Pi[3*e+1]=Ii[1],Pi[3*e+2]=Ii[2]}if(!e(Pi,0,l))return null;(0,f.cS)(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let e=0;e<3*l;e+=3){for(let t=0;t<3;t++)o[t]=Math.min(o[t],Pi[e+t]),o[t+3]=Math.max(o[t+3],Pi[e+t]);c&&i.push({location:Pi.slice(e,e+3),screenSpaceBoundingRect:c})}if(t&&((0,f.be)(o,Li),"absolute-height"!==this.elevationContext.mode)){let e;const i=(0,U.Si)(o,t);try{e=await t.service.queryElevation(Li[0],Li[1],r,i,"ground")}catch(e){}(0,s.pC)(e)&&(0,f.cv)(o,0,0,-this.alignedSampledElevation+e)}return o}addObjectState(e,t){if(e===te.V_.Highlight){const i=new Oi.O(e);this._addHighlightId(i),t.addExternal((e=>{this._removeHighlightId(e)}),i)}}removeObjectState(e){this._highlights.forEach((t=>e.remove(t)))}_addHighlightId(e){this._highlights.add(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const Pi=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ii=(0,h.c)(),Li=(0,h.c)(),Di=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Ni=(0,R.c)();var Fi=i(53266),ki=i(3248);const Ui=.05;var Vi,zi,Bi=i(66007),Hi=i(60910),ji=i(19214),Gi=i(95397),Wi=i(18435),Zi=i(5474),qi=i(20757),$i=i(20766),Yi=i(38208),Xi=i(15095),Ji=i(31355),Ki=i(35369);(zi=Vi||(Vi={}))[zi.ALLOCATED=1]="ALLOCATED",zi[zi.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",zi[zi.VISIBLE=4]="VISIBLE",zi[zi.HIGHLIGHT=8]="HIGHLIGHT",zi[zi.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",zi[zi.REMOVE=32]="REMOVE",zi[zi.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",zi[zi.ACTIVE=18]="ACTIVE";class Qi{constructor(e){this.localTransform=e.getField(j.T.LOCALTRANSFORM,P.O1),this.globalTransform=e.getField(j.T.GLOBALTRANSFORM,P.O1),this.modelOrigin=e.getField(j.T.MODELORIGIN,P.fP),this.model=e.getField(j.T.MODEL,P.gK),this.modelNormal=e.getField(j.T.MODELNORMAL,P.gK),this.modelScaleFactors=e.getField(j.T.MODELSCALEFACTORS,P.Eu),this.boundingSphere=e.getField(j.T.BOUNDINGSPHERE,P.Cd),this.color=e.getField(j.T.COLOR,P.ek),this.featureAttribute=e.getField(j.T.FEATUREATTRIBUTE,P.ek),this.state=e.getField(j.T.STATE,P.D_),this.lodLevel=e.getField(j.T.LODLEVEL,P.D_)}}class er extends Ji.Z{constructor(e,t){super(),this._capacity=0,this._size=0,this._next=0,this._layout=function(e){let t=(0,Rt.U$)().mat4f64(j.T.LOCALTRANSFORM).mat4f64(j.T.GLOBALTRANSFORM).vec4f64(j.T.BOUNDINGSPHERE).vec3f64(j.T.MODELORIGIN).mat3f(j.T.MODEL).mat3f(j.T.MODELNORMAL).vec2f(j.T.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(j.T.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(j.T.FEATUREATTRIBUTE)),t=t.u8(j.T.STATE).u8(j.T.LODLEVEL).alignTo(8),t}(e),this._shaderTransformation=t}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Vi.ALLOCATED),this._size++,this.emit("instance-added",{index:e}),e}removeInstance(e){const t=this._view.state;(0,Xi.hu)(e>=0&&e<this._capacity&&t.get(e)&Vi.ALLOCATED,"invalid instance handle"),this._getStateFlag(e,Vi.ACTIVE)?this._setStateFlags(e,Vi.REMOVE):this.freeInstance(e),this.emit("instance-removed",{index:e})}freeInstance(e){const t=this._view.state;(0,Xi.hu)(e>=0&&e<this._capacity&&t.get(e)&Vi.ALLOCATED,"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,i=!0){this._view.localTransform.setMat(e,t),i&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,i=!0){this._view.globalTransform.setMat(e,t),i&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,i=rr,r=sr;t.localTransform.getMat(e,nr),t.globalTransform.getMat(e,or);const s=(0,O.m)(or,or,nr);(0,u.s)(i,s[12],s[13],s[14]),t.modelOrigin.setVec(e,i),(0,A.f)(r,s),t.model.setMat(e,r);const n=(0,Ki.mw)(rr,s);n.sort(),t.modelScaleFactors.set(e,0,n[1]),t.modelScaleFactors.set(e,1,n[2]),(0,A.e)(r,r),(0,A.t)(r,r),t.modelNormal.setMat(e,r),this._setStateFlags(e,Vi.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const i=this._view;i.model.getMat(e,sr),i.modelOrigin.getVec(e,rr),t[0]=sr[0],t[1]=sr[1],t[2]=sr[2],t[3]=0,t[4]=sr[3],t[5]=sr[4],t[6]=sr[5],t[7]=0,t[8]=sr[6],t[9]=sr[7],t[10]=sr[8],t[11]=0,t[12]=rr[0],t[13]=rr[1],t[14]=rr[2],t[15]=1}applyShaderTransformation(e,t){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){return this._view.localTransform.getMat(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(rr,this,e);t*=Math.max(i[0],i[1],i[2])}return t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(rr,this,e);i.sort(),t*=i[1]}return t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}getColor(e,t){this._view.color.getVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,Vi.VISIBLE,t),this.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Vi.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this._setStateFlag(e,Vi.HIGHLIGHT,t),this.emit("instance-highlight-changed",{index:e}))}getHighlight(e){return this._getStateFlag(e,Vi.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++t;return t}_setStateFlags(e,t){const i=this._view.state;t=i.get(e)|t,i.set(e,t)}_clearStateFlags(e,t){const i=this._view.state;t=i.get(e)&~t,i.set(e,t)}_setStateFlag(e,t,i){i?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){const e=Math.max(tr,Math.floor(this._capacity*ir)),t=this._layout.createBuffer(e);if(this._buffer){const e=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(e)}this._capacity=e,this._buffer=t,this._view=new Qi(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&Vi.ALLOCATED;)t=(t+1)%this._capacity;return this._next=(t+1)%this._capacity,t}}const tr=1024,ir=2,rr=(0,h.c)(),sr=(0,M.c)(),nr=(0,R.c)(),or=(0,R.c)();var ar=i(91917);class lr extends $i.Z{constructor(e,t){super((e=>(0,ar.w)(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere))),{maximumDepth:25}),this._tmpSphere=(0,ar.c)(),this._tmpMat4=(0,R.c)(),this._instanceData=e,this._boundingSphere=t}addInstance(e){const t=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);(0,u.m)(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*(0,Ki.u1)(i),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}}class cr{constructor(e,t){this.thresholdScale=1,this._camera=new Wi.V,this._worldSpaceRadius=e,this._thresholds=t.map((e=>e))}updateCamera(e){this._camera.copyFrom(e)}selectLevel(e,t){const i=this._camera.computeScreenPixelSizeAt(e),r=this._worldSpaceRadius*t/i,s=this._thresholds;let n=-1;for(let e=0;e<s.length;++e)r>=s[e]*this.thresholdScale&&(n=e);return n}}var ur=i(8927),hr=i(78951),dr=i(29620);class pr{constructor(e,t){const i=e.renderContext.rctx,{geometry:r,material:s}=t;this._materialRepository=e.materialRep,s.setParameters({instancedDoublePrecision:!0});const n=s.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(r),l=n.allocate(a);n.write({},r,l,0),this.geometry=r,this.material=s,this.glMaterials=new It.p(s,this._materialRepository),this.vertexBufferLayout=o,this.vbo=hr.f.createVertex(i,fi.l1.STATIC_DRAW,l.buffer),this.vao=new dr.U(i,Zi.i,{geometry:(0,Gi.K)(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,i,r,s,n,o,a){const l=this.geometry.id;this.material.intersect(this.geometry,null,e.transform.transform,e,i,r,((i,r,c,u,h)=>{if(i>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,i))return;const u={layerUid:n.layerUid,graphicUid:n.graphicUid(s),geometryId:l,triangleNr:c,baseBoundingSphere:o,numLodLevels:a};if((null==e.results.min.drapedLayerOrder||h>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||i<e.results.min.dist)&&e.results.min.set(qi.q7.LOD,u,i,r,e.transform.transform,h),e.options.store!==qi.eC.MIN&&(null==e.results.max.drapedLayerOrder||h>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||i>e.results.max.dist)&&e.results.max.set(qi.q7.LOD,u,i,r,e.transform.transform,h),e.options.store===qi.eC.ALL){const t=(0,ur.LP)(e.results.min.ray);t.set(qi.q7.LOD,u,i,r,e.transform.transform,h),e.results.all.push(t)}}}))}}class fr{constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}static async create(e,t,i){const r=await Promise.allSettled(t.components.map((t=>e.schedule((()=>new pr(e,t)),i)))),s=r.map((e=>"fulfilled"===e.status?e.value:null)).filter((e=>e));if((0,n.Hc)(i)||s.length!==r.length){s.forEach((e=>e.destroy())),(0,n.k_)(i);for(const e of r)if("rejected"===e.status)throw e.reason}return new fr(t.minScreenSpaceRadius,s)}destroy(){this.components.forEach((e=>e.destroy()))}intersect(e,t,i,r,s,n,o){this.components.forEach((a=>a.intersect(e,t,i,r,s,n,this.boundingSphere,o)))}get boundingBox(){if((0,s.Wi)(this._boundingBox)){const e=(0,f.cS)();this.components.forEach((t=>{(0,s.pC)(t.boundingInfo)&&((0,f.pp)(e,t.boundingInfo.bbMin),(0,f.pp)(e,t.boundingInfo.bbMax))})),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if((0,s.Wi)(this._boundingSphere)){const e=this.boundingBox,t=(0,h.c)();(0,f.be)(e,t),this._boundingSphere={center:t,radius:.5*(0,f.wz)(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((e,t)=>e+t.triangleCount),0)}}class mr{constructor(e,t,i){this._elementSize=t,this._buffer=hr.f.createVertex(e,fi.l1.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,t,i,r=0){const s=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(i.array,r*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const i=e*this._elementSize,r=t*this._elementSize;this._buffer.setSubData(this._array,i,i,r)}resize(e){const t=e*this._elementSize,i=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(t),this._capacity=e}}class gr{constructor(e){this.modelOriginHi=e.getField(j.T.MODELORIGINHI,P.ct),this.modelOriginLo=e.getField(j.T.MODELORIGINLO,P.ct),this.model=e.getField(j.T.MODEL,P.gK),this.modelNormal=e.getField(j.T.MODELNORMAL,P.gK),this.color=e.getField(j.T.INSTANCECOLOR,P.ek),this.featureAttribute=e.getField(j.T.INSTANCEFEATUREATTRIBUTE,P.ek)}}class yr{constructor(e,t){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=t,this._elementSize=t.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){(0,Xi.hu)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){(0,Xi.hu)(this._updating,"not updating"),this.size<br*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){(0,Xi.hu)(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),(0,Xi.hu)(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){(0,Xi.hu)(this._updating,"not updating"),(0,Xi.hu)(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(_r,Math.floor(this._capacity*vr));this._resize(e)}_shrink(){const e=Math.max(_r,Math.floor(this._capacity*wr));this._resize(e)}_resize(e){if((0,Xi.hu)(this._updating,"not updating"),e===this._capacity)return;const t=new mr(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,i=this._compactInstances(t);(0,Xi.hu)(i===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=i,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new gr(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const t=this._headIndex,i=this._tailIndex;return i<t?(this._buffer.copyRange(i,t,e),t-i):i>t?(this._buffer.copyRange(i,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-i),t+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}const _r=1024,vr=2,br=.3,wr=.5;var xr=i(25584),Cr=i(73622),Tr=i(28541),Sr=i(62486);class Er{constructor(e,t,i,r){this.type=qi.q7.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new Wi.V,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Nt.r.OPAQUE_MATERIAL,Nt.r.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=e,this._optionalFields=t,this._metadata=i,this._instanceBufferLayout=(0,re.RL)({instancedDoublePrecision:!0,instanced:t}),this._glInstanceBufferLayout=(0,Gi.K)(this._instanceBufferLayout,1),this._instanceData=new er(this._optionalFields,r),this._instanceData.on("instance-added",(()=>this._requestUpdateCycle())),this._instanceData.on("instance-removed",(()=>this._requestUpdateCycle())),this._instanceData.on("instance-transform-changed",(e=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(e.index)})),this._instanceData.on("instance-visibility-changed",(e=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(e.index)})),this._instanceData.on("instance-highlight-changed",(()=>this._requestUpdateCycle(!0))),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach((t=>{const i=t.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu})),this._highlightRenderInstanceData.forEach((t=>{const i=t.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu})),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach(((e,i)=>{const r=this._defaultRenderInstanceData[i],s=this._highlightRenderInstanceData[i],n=r.size+s.size,o=e.triangleCount;t.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})})),{totalInstances:e,renderedInstances:t.reduce(((e,t)=>e+t.renderedInstances),0),renderedTriangles:t.reduce(((e,t)=>e+t.renderedTriangles),0),levels:t}}async initializeRenderContext(e,t){this._context=e;const i=e.renderContext.rctx,r=await Promise.allSettled(this._symbol.levels.map((r=>(this._defaultRenderInstanceData.push(new yr(i,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new yr(i,this._instanceBufferLayout)),fr.create(e,r,t))))),s=r.map((e=>"fulfilled"===e.status?e.value:null)).filter((e=>e));if((0,n.Hc)(t)||s.length!==r.length){s.forEach((e=>e.destroy())),(0,n.k_)(t);for(const e of r)if("rejected"===e.status)throw e.reason}this._levels=s,this._levelSelector=(e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map((e=>e.minScreenSpaceRadius));return new cr(t,i)})(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((e=>e.destroy())),this._defaultRenderInstanceData.forEach((e=>e.destroy())),this._highlightRenderInstanceData.forEach((e=>e.destroy()))}get needsTransparentPass(){return this._levels.some((e=>e.components.some((e=>e.material.requiresSlot(Nt.r.TRANSPARENT_MATERIAL)))))}get needsHighlight(){return this._highlightRenderInstanceData.some((e=>e.size>0))}prepareRender(e){if(Q.Z.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const t=e.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}const t=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(e.bindParameters.contentCamera,t),this.needsUpdates&&this._context.requestRender()}render(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(e.pass))return;e.rctx.bindVAO();const t=e.pass!==Yi.C.MATERIAL_HIGHLIGHT&&e.pass!==Yi.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,i=e.pass!==Yi.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;t&&this._renderComponents(e,this._defaultRenderInstanceData),i&&this._renderComponents(e,this._highlightRenderInstanceData)}intersect(e,t,i,r){if(!this.baseMaterial.isVisible())return;const s=(0,h.c)();(0,u.b)(s,r,i);const n=s=>{this._instanceData.getCombinedModelTransform(s,Rr),e.transform.set(Rr),(0,u.m)(Pr,i,e.transform.inverse),(0,u.m)(Ir,r,e.transform.inverse);const n=this._instanceData.getState(s),o=this._instanceData.getLodLevel(s),a=this._levels.length;(0,Xi.hu)(n&Vi.ACTIVE,"invalid instance state"),(0,Xi.hu)(o>=0&&o<a,"invaid lod level"),this._levels[o].intersect(e,t,Pr,Ir,s,this._metadata,a)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(n):this.octree.forEachAlongRay(i,s,n)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,e&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const e=new lr(this._instanceData,this.baseBoundingSphere),t=this._instanceData,i=t.view?t.view.state:null;for(let t=0;t<this._instanceData.capacity;++t)i.get(t)&Vi.ACTIVE&&e.addInstance(t);return e}_queryDepthRangeOctree(e){const t=e.eye,i=e.viewForward,r=this.octree.findClosest(i,$i.Z.DepthOrder.FRONT_TO_BACK,e.frustum),s=this.octree.findClosest(i,$i.Z.DepthOrder.BACK_TO_FRONT,e.frustum);if(null!=r&&null!=s){this._instanceData.view.boundingSphere.getVec(r,Or),(0,u.b)(Or,Or,t);const n=(0,u.e)(Or,i)-Or[3];this._instanceData.view.boundingSphere.getVec(s,Or),(0,u.b)(Or,Or,t);const o=(0,u.e)(Or,i)+Or[3];return{near:Math.max(e.near,n),far:Math.min(e.far,o)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach((e=>{e.startUpdateCylce()})),this._highlightRenderInstanceData.forEach((e=>{e.startUpdateCylce()})),this.needsUpdates&&this._context.requestRender()}_updateInstances(e,t){const i=this._enableLevelSelection,r=this._levelSelector;r.updateCamera(e),this._defaultRenderInstanceData.forEach((e=>{e.beginUpdate()})),this._highlightRenderInstanceData.forEach((e=>{e.beginUpdate()}));const s=this._instanceData,n=this._instanceData.view,o=s.size,a=s.capacity;let l=this._instanceIndex;t=Math.min(o,t);for(let e=0;e<t;++e){0===l&&this._startUpdateCycle();const e=n.state.get(l);let o=0;if(!(e&Vi.ALLOCATED)){l=(l+1)%a,t++;continue}const c=n.lodLevel.get(l);if(e&Vi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[c].freeTail(),e&Vi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[c].freeTail(),e&Vi.REMOVE)s.freeInstance(l);else if(e&Vi.VISIBLE){let t=0;i&&(n.modelOrigin.getVec(l,Mr),t=r.selectLevel(Mr,s.getCombinedMedianScaleFactor(l))),o=e&~(Vi.ACTIVE|Vi.TRANSFORM_CHANGED),t>=0&&(e&Vi.HIGHLIGHT?(Ar(this._highlightRenderInstanceData[t],n,l),o|=Vi.HIGHLIGHT_ACTIVE):(Ar(this._defaultRenderInstanceData[t],n,l),o|=Vi.DEFAULT_ACTIVE)),n.state.set(l,o),n.lodLevel.set(l,t)}else o=e&~(Vi.ACTIVE|Vi.TRANSFORM_CHANGED),n.state.set(l,o);if(this._octree){const t=!!(e&Vi.ACTIVE),i=!!(o&Vi.ACTIVE);!t&&i?this._octree.addInstance(l):t&&!i?this._octree.removeInstance(l):t&&i&&e&Vi.TRANSFORM_CHANGED&&(this._octree.removeInstance(l),this._octree.addInstance(l))}l=(l+1)%a}this._instanceIndex=l,this._defaultRenderInstanceData.forEach((e=>{e.endUpdate()})),this._highlightRenderInstanceData.forEach((e=>{e.endUpdate()}))}_renderComponents(e,t){this.levels.forEach(((i,r)=>{i.components.forEach((i=>{this._renderComponent(e,t[r],i,r)}))}))}_renderComponent(e,t,i,r){const n=e.bindParameters;if(0===t.size||!i.material.requiresSlot(n.slot))return;const{rctx:o,pass:a}=e,l=i.glMaterials.load(o,a);if((0,s.Wi)(l))return;const c=l.beginSlot(n),u=o.bindTechnique(c,i.material.parameters,n);o.bindVAO(i.vao),c.ensureAttributeLocations(i.vao),c.bindDraw(Dr,n),Q.Z.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.pass===Yi.C.MATERIAL&&(u.setUniform4fv("externalColor",Lr[Math.min(r,Lr.length-1)]),u.setUniform1i("colorMixMode",xr.FZ.replace));const h=o.capabilities.instancing,d=t.capacity,p=t.headIndex,f=t.tailIndex,m=t.firstIndex,g=this._glInstanceBufferLayout,y=(e,r)=>{(0,Sr.XP)(o,Zi.i,t.buffer,g,e),h.drawArraysInstanced(c.primitiveType,0,i.vertexCount,r-e),(0,Sr.UF)(o,Zi.i,t.buffer,g)};i.material.parameters.transparent&&null!=m?p>f?((0,Xi.hu)(m>=f&&m<=p,"invalid firstIndex"),y(m,p),y(f,m)):p<f&&(m<=p?((0,Xi.hu)(m>=0&&m<=p,"invalid firstIndex"),y(m,p),y(f,d),y(0,m)):((0,Xi.hu)(m>=f&&m<=d,"invalid firstIndex"),y(m,d),y(0,p),y(f,m))):p>f?y(f,p):p<f&&(y(0,p),y(f,d)),o.bindVAO(null)}}function Ar(e,t,i){const r=e.allocateHead();!function(e,t,i,r){(0,Cr.EE)(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}(t,i,e.view,r)}const Mr=(0,h.c)(),Or=(0,Re.c)(),Rr=(0,R.c)(),Pr=(0,h.c)(),Ir=(0,h.c)(),Lr=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],Dr=new Tr.Qm;class Nr extends k.k{constructor(e,t,i,r){super(e,t,i,r),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}getCachedSize(){const[e,t,i]=(0,s.pC)(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:t,height:i}}async doLoad(e){if(!this._drivenProperties.size&&(0,U.bh)(this.symbolLayer))throw new Error;const t=this.symbolLayer;if(this.isPrimitive){const i=t.resource?t.resource.primitive:Ai.S;this._resources=await this._createResourcesForPrimitive(i,e)}else this._resources=await this._createResourcesForUrl(t.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return(0,s.pC)(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return(0,s.U2)(this._resources,"lodRenderer")}_setMaterialTransparencyParams(e,t=(0,s.U2)(this.symbolLayer,"material","color")){const i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return e.transparent=r,e.opacity=i,e.cullFace=r?te.Vr.None:te.Vr.Back,e}async _createResourcesForPrimitive(e,t){if(!(0,Hi.F)(e))throw new Error(`Unknown object symbol primitive: ${e}`);const i=this.symbolLayer,r=(0,f.Ue)((0,Mi.Uz)(e)),n=(0,h.d)((0,f.dp)(r)),o=(0,h.d)((0,Mi.$K)(n,i)),a=(0,u.l)(o),l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:h.O,diffuse:h.O,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},c=l.usePBR;this._setMaterialTransparencyParams(l);const d=this.symbol;if("point-3d"===d.type&&d.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:i}=d.verticalOffset;l.verticalOffset={screenLength:(0,Ae.F2)(e),minWorldLength:t||0,maxWorldLength:null!=i?i:1/0},l.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(l.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)l.externalColor=Re.O;else{const e=(0,s.pC)(i.material)&&i.material.color,t=(0,s.pC)(e)?Se.Z.toUnitRGBA(e):Re.O;l.externalColor=t}this._fastUpdates=at(this._context.renderer,this._fastVisualVariableConvertOptions(r,o,n,s.YP)),l.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(l,this._fastUpdates.materialParameters),l.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(l.instanced.push("color"),this._optionalFields.push("color"));const p=new re.Gp(l),m=(0,Hi.t)(e,p);if(!m)throw new Error(`Unknown object symbol primitive: ${e}`);const g=(0,ki.aH)(m).map((e=>({opacity:1,transparent:e.parameters.transparent}))),y=await this._createStageResources(m,c);return{lodResources:m,lodRenderer:await this._createLodRenderer(m,t),stageResources:y,symbolSize:o,extentPadding:a,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:g,physicalBasedRenderingEnabled:c,resourceBoundingBox:r,resourceSize:n,pivotOffset:s.YP}}async _createResourcesForUrl(e,t){const i=["transformation"],r={materialParamsMixin:{instanced:i,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=at(this._context.renderer,this._fastVisualVariableConvertOptions(s.YP,s.YP,s.YP,s.YP)),this._fastUpdates.enabled?(Object.assign(r.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color"));const n=this.symbol;if("point-3d"===n.type&&n.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:i}=n.verticalOffset;r.materialParamsMixin.verticalOffset={screenLength:(0,Ae.F2)(e),minWorldLength:t||0,maxWorldLength:null!=i?i:1/0},r.materialParamsMixin.castShadows=!1}r.signal=t,r.usePBR=this._context.physicalBasedRenderingEnabled;const o=r.usePBR,a=await(0,Bi.fetch)(e,r),l=a.isEsriSymbolResource,c=a.isWosr;this._addDisposeResource((()=>a.remove()));const d=function(e){return{levels:e.map((e=>function(e){const t=[];return e.stageResources.geometries.forEach(((i,r)=>{const s=e.stageResources.materials[r],n=e.stageResources.textures;t.push({material:s,geometry:i,textures:n})})),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}(e)))}}(a.lods);(function(e){e.levels.forEach((e=>{e.minScreenSpaceRadius||(e.minScreenSpaceRadius=function(e,t=Ui){const i=(0,ki.HI)(e);return Math.sqrt(i/(t*Math.PI))}(e))}))})(d),d.levels.sort(((e,t)=>e.minScreenSpaceRadius-t.minScreenSpaceRadius)),d.levels[0].minScreenSpaceRadius=Math.min(2,d.levels[0].minScreenSpaceRadius);const p=this._context,m=this.symbolLayer.material,g=this._getExternalColorParameters(m),y=(0,s.U2)(this.symbolLayer,"material","color"),_=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),v=this.needsDrivenTransparentPass,b=(0,ki.aH)(d),w=(0,ki.aH)(d).map((e=>({opacity:e.parameters.opacity||1,transparent:e.parameters.transparent})));b.forEach((e=>{const t=e.parameters;e.setParameters(g);const i=t.opacity*_,r=i<1||v||t.transparent;e.setParameters({opacity:i,transparent:r}),p.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})}));const x=a.referenceBoundingBox,C=(0,h.d)((0,f.dp)(x)),T=(0,h.d)(d.levels[0].pivotOffset),S=(0,h.d)((0,Mi.$K)(C,this.symbolLayer)),E=(0,u.l)(S);lt(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(x,S,C,T))&&b.forEach((e=>e.setParameters(this._fastUpdates.materialParameters)));const A=await this._createStageResources(d,o);return{lodResources:d,lodRenderer:await this._createLodRenderer(d,t),stageResources:A,symbolSize:S,extentPadding:E,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:w,physicalBasedRenderingEnabled:o,resourceBoundingBox:x,resourceSize:C,pivotOffset:T}}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,t){const i=this._context.stage,r=(0,ki.aH)(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(r),this._addDisposeResource((()=>i.removeMany(r)));const s=(0,ki.VQ)(e);i.addMany(s),this._addDisposeResource((()=>i.removeMany(s))),await i.load(s);const n=(0,ki.ci)(e);return i.addMany(n),this._addDisposeResource((()=>i.removeMany(n))),{materials:r,textures:s,geometries:n}}async _createLodRenderer(e,t){const i=this._context.stage,r={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},s=this._fastUpdates.enabled?{applyTransform:(e,t,i)=>{e.getFeatureAttribute(t,Vr),(0,O.c)(i,dt(this._fastUpdates.materialParameters,Vr,i))},scaleFactor:(e,t,i)=>(t.getFeatureAttribute(i,Vr),pt(e,this._fastUpdates.materialParameters,Vr))}:null,n=new Er(e,this._optionalFields,r,s);return n.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource((()=>{i.removeRenderPlugin(n)})),await i.addRenderPlugin(n.slots,n,t),n}_getExternalColorParameters(e){const t={};return this._drivenProperties.color?t.externalColor=Re.O:(0,s.pC)(e)&&(0,s.pC)(e.color)?t.externalColor=Se.Z.toUnitRGBA(e.color):(t.externalColor=Re.O,t.colorMixMode="ignore"),t}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach((e=>e())),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const i=(0,qe.S_)(t.geometry);if((0,s.Wi)(i))return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const r=this.setGraphicElevationContext(t,new F.o),n=e.renderingInfo;return this._createAs3DShape(t,i,n,r,t.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if((0,s.Wi)(this._resources))return!0;const e=this._drivenProperties.opacity,t=!this.isPrimitive,i=this._resources.stageResources.materials,r=this._resources.originalMaterialParameters;for(let n=0;n<i.length;n++){const o=i[n],a=(0,s.U2)(this.symbolLayer,"material","color"),l=r[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:t})*l.opacity,u=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:u}),this.isPrimitive&&o.setParameters({cullFace:u?te.Vr.None:te.Vr.Back})}return!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,N.B5)}slicePlaneEnabledChanged(){if((0,s.Wi)(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if((0,s.Wi)(this._resources))return!0;const{stageResources:e,isWosr:t}=this._resources;for(const i of e.materials)this.isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this.hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(e,t){if((0,s.Wi)(this._resources))return V.W.Recreate_Symbol;const{stageResources:{materials:i},lodRenderer:r,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const s in e.diff){if("visualVariables"!==s)return V.W.Recreate_Symbol;if(!lt(this._fastUpdates,t,this._fastVisualVariableConvertOptions(n,o,a,l)))return V.W.Recreate_Symbol;for(const e of i)e.setParameters(this._fastUpdates.materialParameters);r.notifyShaderTransformationChanged()}return V.W.Fast_Update}computeComplexity(){return(0,s.Wi)(this._resources)?super.computeComplexity():{primitivesPerFeature:(0,ki.VV)(this._resources.lodResources.levels[0]).reduce(((e,t)=>e+t.indices.get(j.T.POSITION).length),0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:(0,ji.BN)(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return(0,s.pC)(this._resources)}_createAs3DShape(e,t,i,r,n){if(!this._hasLodRenderer()||(0,s.Wi)(this._resources))return null;const o=this.getFastUpdateAttrValues(e),a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?(0,U.Uu)(i.color,i.opacity):null,l=this._context.clippingExtent;if((0,p.KC)(t,Fr,this._context.elevationProvider.spatialReference),(0,s.pC)(l)&&!(0,f.BD)(l,Fr))return null;const c=this._requiresTerrainElevation(r),u=this._computeGlobalTransform(t,r,Ur,zr),h=this._computeLocalTransform(this._resources,this.symbolLayer,i,kr),d=this._resources.lodRenderer.instanceData,m=d.addInstance();this._instanceIndexToGraphicUid.set(m,n),d.setLocalTransform(m,h,!1),d.setGlobalTransform(m,u),o&&d.setFeatureAttribute(m,o),a&&d.setColor(m,a);const g=new Ri(this,m,Fe.RX,r);return c&&(g.alignedSampledElevation=zr.sampledElevation),g.needsElevationUpdates=(0,N.B5)(r.mode),(0,qe.dO)(g,t,this._context.elevationProvider),g}_computeGlobalTransform(e,t,i,r){return(0,N.qZ)(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,r),Fr[0]=e.x,Fr[1]=e.y,Fr[2]=r.z,(0,p.Bm)(e.spatialReference,Fr,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,t,i,r){return(0,O.i)(r),this._applyObjectRotation(i,!1,r),this._applyObjectRotation(t,!0,r),this._applyObjectScale(e,i,r),this._applyAnchor(e,t,r),r}_applyObjectScale(e,t,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const r=this._drivenProperties.size&&t.size?t.size:e.symbolSize,s=(0,U.bD)(r,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===s[0]&&1===s[1]&&1===s[2]||(0,O.h)(i,i,s)}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if((0,s.Wi)(this._resources))return!0;const i=t&&(0,qe.S_)(t);if((0,s.Wi)(i))return!1;const r=this.getGeometryElevationMode(t);return e.elevationContext.mode===r&&(this._computeGlobalTransform(i,e.elevationContext,Ur,zr),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=zr.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,Ur,!0),(0,qe.dO)(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if((0,s.Wi)(this._resources))return;const i=(e,t,i)=>(0,s.Pt)(null!=e&&"complete"===e.type?e.newValue:t,i),r=i(t.heading,this.symbolLayer.heading,0),n=i(t.tilt,this.symbolLayer.tilt,0),o=i(t.roll,this.symbolLayer.roll,0),a=i(t.width,this.symbolLayer.width,void 0),l=i(t.height,this.symbolLayer.height,void 0),c=i(t.depth,this.symbolLayer.depth,void 0),u=i(t.anchor,this.symbolLayer.anchor,void 0),d=i(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const p={heading:r,tilt:n,roll:o,anchor:u,anchorPosition:d},f=this._resources;this.loadStatus===Fi.P.LOADED&&e.symbolLayerStatePatches.push((()=>{f.symbolSize=(0,h.d)((0,Mi.$K)(f.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push(((e,t)=>{const i=this._computeLocalTransform(f,p,t,kr),r=e.instanceIndex;f.lodRenderer.instanceData.setLocalTransform(r,i,!0)}))}_preparePatchColor(e,t){if(!t.material||"partial"!==t.material.type)return;const i=t.material.diff;if(!i.color||"complete"!==i.color.type||null==i.color.newValue||null==i.color.oldValue)return;const r=i.color.newValue,n=(0,s.pC)(r)?Se.Z.toUnitRGBA(r):Re.O;delete i.color;const o=this._resources;(0,s.Wi)(o)||e.graphics3DGraphicPatches.push((e=>{let t;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(e.instanceIndex,n),t=this._setMaterialTransparencyParams({},r)):t=this._setMaterialTransparencyParams({externalColor:n},r);for(const e of o.stageResources.materials)e.setParameters(t)}))}_requiresTerrainElevation(e){return"absolute-height"!==e.mode}_applyObjectRotation(e,t,i){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return(0,U._Z)(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,t,i){const r=(0,h.c)();switch(i.anchor){case"center":(0,u.c)(r,(0,f.be)(e)),(0,u.o)(r,r);break;case"top":{const t=(0,f.be)(e);(0,u.s)(r,-t[0],-t[1],-e[5]);break}case"bottom":{const t=(0,f.be)(e);(0,u.s)(r,-t[0],-t[1],-e[2]);break}case"relative":{const t=(0,f.be)(e),s=(0,f.dp)(e),n=i.anchorPosition,o=n?(0,h.f)(n.x,n.y,n.z):h.Z;(0,u.E)(r,s,o),(0,u.a)(r,r,t),(0,u.o)(r,r);break}default:(0,s.pC)(t)?(0,u.o)(r,t):(0,u.c)(r,h.Z)}return r}_applyAnchor(e,t,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const r=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,t);r&&(0,O.j)(i,i,r)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,t,i,r){const n=(0,s.pC)(e)?(0,h.d)((0,f.dp)(e)):h.O,o=(0,s.pC)(e)?this._computeAnchor(e,r,this.symbolLayer):h.Z,a=this._context.renderCoordsHelper.unitInMeters,l=(0,U.bD)((0,s.pC)(t)?t:void 0,t,i,a),c=(0,h.f)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:(0,s.pC)(t)?t:h.O,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const Fr=(0,h.c)(),kr=(0,R.c)(),Ur=(0,R.c)(),Vr=(0,Re.c)(),zr=new N.Lm;var Br=i(93011);function Hr(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function jr(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=r*a+n*l,e[1]=s*a+o*l,e[2]=r*c+n*u,e[3]=s*c+o*u,e}function Gr(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}const Wr=jr,Zr=Gr;Object.freeze(Object.defineProperty({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},set:Hr,transpose:function(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*n-s*r;return o?(o=1/o,e[0]=n*o,e[1]=-r*o,e[2]=-s*o,e[3]=i*o,e):null},adjoint:function(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:jr,rotate:function(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=s*l+o*a,e[2]=r*-a+n*l,e[3]=s*-a+o*l,e},scale:function(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1];return e[0]=r*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e},fromRotation:function(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)},LDU:function(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},subtract:Gr,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Br.E*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Br.E*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Br.E*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Br.E*Math.max(1,Math.abs(n),Math.abs(c))},multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},mul:Wr,sub:Zr},Symbol.toStringTag,{value:"Module"}));var qr=i(79912);class $r extends H.Z{constructor(e,t,i,r,s,n){super(e,t),this.path=i,this.geometrySR=r,this.upVectorAlignment=s,this.stencilWidth=n}}function Yr(e){return"upVectorAlignment"in e}Object.freeze(Object.defineProperty({__proto__:null,create:function(){return[1,0,0,1]},clone:function(e){return[e[0],e[1],e[2],e[3]]},fromValues:function(e,t,i,r){return[e,t,i,r]},createView:function(e,t){return new Float64Array(e,t,4)}},Symbol.toStringTag,{value:"Module"}));var Xr=i(69430),Jr=i(97537);function Kr(){return{up:(0,h.c)(),right:(0,h.c)()}}function Qr(e,t,i){(0,u.m)(e.up,t.up,i),(0,u.m)(e.right,t.right,i)}function es(e,t,i){(0,l.a)(e,(0,u.e)(i,t.right),(0,u.e)(i,t.up))}class ts{constructor(){this.pos=(0,h.c)(),this.posES=(0,h.c)(),this.posGS=(0,h.c)(),this.vRight=(0,h.c)(),this.vLeft=(0,h.c)(),this.frame=Kr(),this.rotationFrame=Kr(),this.rotationRight=(0,c.a)(),this.rotationAngle=0,this.miterStretch=[1,0,0,1]}setFrameFromUpVector(e){(0,u.c)(this.frame.up,e),(0,u.a)(bs,this.vLeft,this.vRight),(0,u.n)(bs,bs),(0,u.g)(vs,this.frame.up,(0,u.e)(bs,this.frame.up)),(0,u.b)(Cs,bs,vs),(0,u.n)(Cs,Cs),(0,u.f)(this.frame.right,Cs,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){(0,u.c)(this.rotationFrame.up,this.frame.up),(0,u.c)(this.rotationFrame.right,this.frame.right),(0,l.a)(this.rotationRight,1,0),(0,u.g)(vs,this.frame.up,(0,u.e)(this.frame.up,this.vLeft)),(0,u.b)(vs,this.vLeft,vs),(0,u.o)(vs,vs),(0,u.n)(vs,vs),(0,u.g)(bs,this.frame.up,(0,u.e)(this.frame.up,this.vRight)),(0,u.b)(bs,this.vRight,bs),(0,u.n)(bs,bs),(0,u.f)(ws,this.rotationFrame.up,this.vLeft);const e=Math.sign((0,u.e)(ws,this.vRight));if(this.rotationAngle=e*(Math.PI-(0,Ye.ZF)((0,u.e)(vs,bs))),Math.abs(this.rotationAngle)>0){const e=(0,Ye.b_)(Math.cos(.5*this.rotationAngle));Hr(this.miterStretch,e-1+1,0,0,1)}const t=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*t))}}class is{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(e,t){return this.vertices.push((0,c.d)(e)),this.vertexNormals.push((0,c.d)(t)),this.vertices.length-1}addUV(e){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(e),this.uvs.length-1}addPole(e,t=null){return this.poles.push({position:(0,c.d)(e),normal:t?(0,c.d)(t):null}),this.poles.length-1}addSegment(e,t=null,i=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),t&&(this.uvIndices.push(t.v0),this.uvIndices.push(t.v1)),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return null!=this.uvs}translate(e,t){for(const i of this.vertices)i[0]+=e,i[1]+=t;for(const i of this.poles)i.position[0]+=e,i.position[1]+=t}static circle(e=20){const t=new is,i={v0:0,v1:0};t.addPole((0,c.f)(0,0));for(let i=0;i<e;++i){const r=2*i*Math.PI/e,s=Math.cos(r),n=Math.sin(r),o=(0,c.f)(.5*s,.5*n),a=(0,c.f)(s,n);t.addVertex(o,a),t.addUV(i/e)}t.addUV(1);for(let r=0;r<e-1;++r){const e={v0:r,v1:r+1},s=e;t.addSegment(e,s,i)}const r={v0:e-1,v1:0},s={v0:e-1,v1:e};return t.addSegment(r,s,i),t}static rect(){const e=new is,t=(0,c.f)(-.5,-.5),i=(0,c.f)(.5,-.5),r=(0,c.f)(.5,.5),s=(0,c.f)(-.5,.5),n=(0,c.f)(0,-1),o=(0,c.f)(1,0),a=(0,c.f)(0,1),l=(0,c.f)(-1,0);e.addUV(0),e.addUV(1),e.addPole((0,c.f)(0,.5),a),e.addPole((0,c.f)(0,.5)),e.addPole((0,c.f)(0,-.5)),e.addPole((0,c.f)(0,-.5),n);const u={v0:0,v1:1};return e.addVertex(t,n),e.addVertex(i,n),e.addSegment({v0:0,v1:1},u,{v0:3,v1:3}),e.addVertex(i,o),e.addVertex(r,o),e.addSegment({v0:2,v1:3},u,{v0:2,v1:1}),e.addVertex(r,a),e.addVertex(s,a),e.addSegment({v0:4,v1:5},u,{v0:0,v1:0}),e.addVertex(s,l),e.addVertex(t,l),e.addSegment({v0:6,v1:7},u,{v0:1,v1:2}),e}}class rs{constructor(e){this.vertices=[],this.offset=(0,h.c)(),this.xform=(0,R.c)(),this.vertices=e;const t=Math.floor((e.length-1)/2);(0,u.c)(this.offset,this.vertices[t].pos);for(const e of this.vertices)(0,u.b)(e.pos,e.pos,this.offset);(0,O.j)(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length;let t=this.vertices[0];t.index=0,(0,u.s)(t.vLeft,0,0,0),t.vLeftLength=0,(0,u.b)(t.vRight,this.vertices[1].pos,t.pos),t.vRightLength=(0,u.l)(t.vRight),(0,u.n)(t.vRight,t.vRight);let i=t;for(let r=1;r<e;++r)t=this.vertices[r],t.index=r,(0,u.c)(t.vLeft,i.vRight),t.vLeftLength=i.vRightLength,r<e-1?((0,u.b)(t.vRight,this.vertices[r+1].pos,t.pos),t.vRightLength=(0,u.l)(t.vRight),(0,u.n)(t.vRight,t.vRight)):((0,u.c)(t.vRight,t.vLeft),t.vRightLength=t.vLeftLength),i=t}}class ss{numProfilesPerJoin(){return 1}extrude(e,t,i){for(let r=0;r<t.vertices.length;++r)i(e.index,e.frame,t.vertices[r],t.vertexNormals[r],!1)}}class ns{constructor(e=.8*Math.PI,t=1){this.cutoffAngle=e,this.numBendSubdivisions=t}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,t,i){const r=Ts;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let s=0;s<this.numBendSubdivisions+1;++s){(0,O.d)(Ss,.5*-e.rotationAngle+s*e.rotationAngle/this.numBendSubdivisions,e.rotationFrame.up),Qr(r,e.frame,Ss);for(let s=0;s<t.vertices.length;++s)(0,l.h)(t.vertices[s],e.rotationRight)*e.rotationAngle>=0?i(e.index,r,t.vertices[s],t.vertexNormals[s],!1):((0,l.p)(gs,t.vertices[s],e.miterStretch),i(e.index,e.frame,gs,t.vertexNormals[s],!0))}else for(let r=0;r<this.numBendSubdivisions+1;++r)for(let r=0;r<t.vertices.length;++r){const s=(0,l.h)(t.vertices[r],e.rotationRight)*e.rotationAngle>=0;(0,l.p)(gs,t.vertices[r],e.miterStretch),i(e.index,e.frame,gs,t.vertexNormals[r],!s)}}}const os={generateUV:!1};class as{rebuildConnectingProfileGeometry(e,t,i){for(let r=0;r<t.vertices.length;++r)i(e.index,e.frame,t.vertices[r],t.vertexNormals[r],0,0)}}class ls extends as{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class cs extends as{constructor(e,t=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=t,this.flip=i}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,t,i){for(let r=0;r<t.vertices.length;++r)i(e.index,e.frame,t.vertices[r],t.vertexNormals[r],this.profilePlaneOffset,0)}rebuildCapGeometry(e,t){const i=ys;(0,l.a)(i,0,0);const r=this.flip?1:-1;for(let s=0;s<this.profile.vertices.length;++s)t(e.index,e.frame,this.profile.vertices[s],i,this.profilePlaneOffset,r)}buildTopology(e,t){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let e=1;e<this.profile.numSegments;++e){const r=this.profile.vertexIndices[2*e+0],s=this.profile.vertexIndices[2*e+1],n=this.vertexBufferStart+r,o=this.vertexBufferStart+s;this.flip?t(o,n,i):t(i,n,o)}}}class us extends as{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let t=0;t<this.profile.numSegments;++t){const i=this.profile.vertexIndices[2*t+0],r=this.profile.vertexIndices[2*t+1];this.profile.poleIndices[i]===this.profile.poleIndices[r]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,t){const i=e.frame,r=.5*this.sign,s=gs,n=ys;(0,l.a)(n,0,0);for(let s=0;s<this.profile.poles.length;++s){const o=this.profile.poles[s];o.normal?t(e.index,i,o.position,o.normal,r,0):t(e.index,i,o.position,n,r,this.sign)}if(this.breakNormals)for(let r=0;r<this.profile.vertices.length;++r)t(e.index,i,this.profile.vertices[r],this.profile.vertexNormals[r],0,0);for(let o=0;o<this.numSegments-1;++o){const a=(1-(o+1)/this.numSegments)*Math.PI*.5,c=Math.sin(a),u=Math.cos(a);for(let o=0;o<this.profile.vertices.length;++o){const a=this.profile.poles[this.profile.poleIndices[o]];(0,l.g)(s,this.profile.vertices[o],a.position),(0,l.f)(s,s,c),a.normal?((0,l.b)(s,s,a.position),t(e.index,i,s,a.normal,r*u,0)):((0,l.i)(n,s),(0,l.f)(n,n,c),(0,l.b)(s,s,a.position),t(e.index,i,s,n,r*u,this.sign*u))}}}buildTopology(e,t){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let e=0;e<this.profile.numSegments;++e){const s=this.profile.vertexIndices[2*e+0],n=this.profile.vertexIndices[2*e+1],o=this.vertexBufferStart+this.profile.poleIndices[s],a=this.vertexBufferStart+this.profile.poleIndices[n];let l=i+s,c=i+n;for(let e=0;e<this.numSegments-1;++e){const i=r+e*this.profile.vertices.length+s,o=r+e*this.profile.vertices.length+n;this.flip?(t(i,c,l),t(c,i,o)):(t(l,c,i),t(o,i,c)),l=i,c=o}this.flip?(t(o,c,l),o!==a&&t(o,a,c)):(t(l,c,o),o!==a&&t(c,a,o))}}}class hs{constructor(e,t,i,r,s,n=os){this.options=n,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=t,this.path=e,this.extruder=i,this.startCap=r,this.endCap=s;const o=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*o+2,this.numVerticesTotal=t.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const a=this.startCap.getNumVertices();this.numVerticesTotal+=a,this.numNormalsTotal+=a,this.endCap.vertexBufferStart=this.numVerticesTotal;const l=this.endCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,t,i,r,s){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=r[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const t=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=t.rotationRight[0]*t.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=t.rotationRight[1]*t.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,t,i,r,s,n){this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=r[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=s,this.profileUpAxisData[4*this._extrusionVertexCount+3]=n,++this._extrusionVertexCount}emitTriangle(e,t,i){this.vertexIndices[3*this._triangleCount+0]=e,this.vertexIndices[3*this._triangleCount+1]=t,this.vertexIndices[3*this._triangleCount+2]=i,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[e],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[i],this.normalIndices[3*this._triangleCount+0]=e,this.normalIndices[3*this._triangleCount+1]=t,this.normalIndices[3*this._triangleCount+2]=i,++this._triangleCount}_rebuildGeometry(){const e=(e,t,i,r,s)=>this.emitVertex(e,t,i,r,s),t=(e,t,i,r,s,n)=>this.emitCapVertex(e,t,i,r,s,n);this._extrusionVertexCount=0;for(const e of this.path.vertices)this.originData[3*e.index+0]=e.pos[0],this.originData[3*e.index+1]=e.pos[1],this.originData[3*e.index+2]=e.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,t);for(let t=1;t<this.path.vertices.length-1;++t)this.extruder.extrude(this.path.vertices[t],this.profile,e);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,t),this.startCap.rebuildCapGeometry(this.path.vertices[0],t),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],t),this.profile.hasUV()&&this.options.generateUV)for(let e=0;e<this.profile.uvs.length;++e)this.uvData[2*e+0]=this.profile.uvs[e],this.uvData[2*e+1]=0}buildTopology(){const e=(e,t,i)=>this.emitTriangle(e,t,i);this._triangleCount=0;const t=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let s=i*r*2*3;this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1),s+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(s),this.normalIndices=new Uint32Array(s),this.pathVertexIndices=new Uint32Array(s),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(s));for(let s=0;s<i;++s){const i=this.profile.vertexIndices[2*s],n=this.profile.vertexIndices[2*s+1];for(let s=0;s<r;++s){const r=s*t+i,o=(s+1)*t+n,a=s*t+n;e(r,(s+1)*t+i,o),e(r,o,a)}}this.startCap.buildTopology(this.path.vertices[0],e),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],e)}onPathChanged(){this._rebuildGeometry()}}class ds{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class ps extends ds{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let t=0;t<this.builder.numVerticesTotal;++t){let i=this.builder.pathVertexData[t];const r=0===i||i===this.builder.path.vertices.length-1;i*=3;const s=ms;(0,u.s)(s,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const n=4*t,o=vs,a=gs,c=bs,h=ws,d=xs;let p=0,f=0;if((0,u.s)(h,this.builder.profileRightAxisData[n],this.builder.profileRightAxisData[n+1],this.builder.profileRightAxisData[n+2]),(0,u.s)(d,this.builder.profileUpAxisData[n],this.builder.profileUpAxisData[n+1],this.builder.profileUpAxisData[n+2]),(0,l.a)(a,this.builder.profileVertexAndNormalData[n]*e[0],this.builder.profileVertexAndNormalData[n+1]*e[1]),r)(0,u.f)(c,d,h),p=this.builder.profileRightAxisData[n+3]*e[0],f=this.builder.profileUpAxisData[n+3];else{const e=ys,t=_s;(0,l.a)(e,this.builder.profileRightAxisData[n+3],this.builder.profileUpAxisData[n+3]);const i=(0,l.o)(e);(0,l.i)(e,e);const r=(0,l.h)(a,e);if(Math.abs(r)>i){(0,l.a)(t,-e[1],e[0]);const s=(0,l.h)(a,t);(0,l.f)(e,e,i*Math.sign(r)),(0,l.f)(t,t,s),(0,l.b)(a,e,t)}(0,u.s)(c,0,0,0)}(0,u.s)(o,h[0]*a[0]+d[0]*a[1],h[1]*a[0]+d[1]*a[1],h[2]*a[0]+d[2]*a[1]),this.vertexAttributePosition[3*t+0]=s[0]+o[0]+c[0]*p,this.vertexAttributePosition[3*t+1]=s[1]+o[1]+c[1]*p,this.vertexAttributePosition[3*t+2]=s[2]+o[2]+c[2]*p;const m=gs;(0,l.a)(m,this.builder.profileVertexAndNormalData[n+2],this.builder.profileVertexAndNormalData[n+3]),this.vertexAttributeNormal[3*t+0]=h[0]*m[0]+d[0]*m[1]+c[0]*f,this.vertexAttributeNormal[3*t+1]=h[1]*m[0]+d[1]*m[1]+c[1]*f,this.vertexAttributeNormal[3*t+2]=h[2]*m[0]+d[2]*m[1]+c[2]*f}}createGeometryData(){const e=[[j.T.POSITION,this.builder.vertexIndices],[j.T.NORMAL,this.builder.normalIndices]],t=[[j.T.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[j.T.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;e.push([j.T.COLOR,new Uint32Array(i)]),t.push([j.T.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:t,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,t,i){const r=this.builder.vertexIndices,s={size:3,data:this.vertexAttributePosition},n=r.length/3;(0,xr.CN)(e,t,0,n,r,s,void 0,void 0,i)}}class fs extends ds{constructor(e,t,i,r){super(e),this.sizeAttributeValue=t,this.colorAttributeValue=i,this.opacityAttributeValue=r,this.vvData=null,this.baked=new ps(e),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let e=0;e<this.builder.path.vertices.length;++e){this.vvData[4*e+0]=t,this.vvData[4*e+1]=i,this.vvData[4*e+2]=r;const s=0===e||e===this.builder.path.vertices.length-1;this.vvData[4*e+3]=s?1:0}}createGeometryData(){return{vertexAttributes:[[j.T.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[j.T.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[j.T.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[j.T.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[j.T.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[j.T.POSITION,this.builder.pathVertexIndices],[j.T.PROFILERIGHT,this.builder.vertexIndices],[j.T.PROFILEUP,this.builder.vertexIndices],[j.T.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[j.T.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const ms=(0,h.c)(),gs=(0,c.a)(),ys=(0,c.a)(),_s=(0,c.a)(),vs=(0,h.c)(),bs=(0,h.c)(),ws=(0,h.c)(),xs=(0,h.c)(),Cs=(0,h.c)(),Ts=Kr(),Ss=(0,R.c)();var Es=i(2833),As=i(5079),Ms=i(28881),Os=i(3864),Rs=i(5331),Ps=i(68490);const Is=new Map([[j.T.POSITION,0],[j.T.PROFILERIGHT,1],[j.T.PROFILEUP,2],[j.T.PROFILEVERTEXANDNORMAL,3],[j.T.FEATUREVALUE,4]]);class Ls extends Ms.C{constructor(){super(...arguments),this.ambient=(0,h.f)(.2,.2,.2),this.diffuse=(0,h.f)(.8,.8,.8),this.specular=(0,h.f)(0,0,0),this.opacity=1}}class Ds extends Ut.A{initializeConfiguration(e,t){t.spherical=e.viewingMode===D.JY.Global,t.doublePrecisionRequiresObfuscation=(0,Rs.I)(e.rctx)}initializeProgram(e){const t=Ds.shader.get().build(this.configuration);return new zt.$(e.rctx,t,Is)}_setPipelineState(e){const t=this.configuration,i=e===te.Am.NONE,r=e===te.Am.FrontFace;return(0,jt.sm)({blending:t.output!==Pt.H.Color&&t.output!==Pt.H.Alpha||!t.transparent?null:i?Vt.wu:(0,Vt.j7)(e),culling:(e=>!e.hasSlicePlane&&!(e.transparent||e.doubleSidedMode===Es.q.None))(t)&&jt.sg,depthTest:{func:(0,Vt.Bh)(e)},depthWrite:i||r?jt.LZ:null,colorWrite:jt.BK,stencilWrite:t.hasOccludees?Bt.s3:null,stencilTest:t.hasOccludees?Bt.RY:null,polygonOffset:i||r?null:Vt.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Ds.shader=new kt.J(Ps.P,(()=>i.e(8136).then(i.bind(i,98136))));class Ns extends $t.W{constructor(){super(...arguments),this.output=Pt.H.Color,this.doubleSidedMode=Es.q.None,this.transparencyPassType=te.Am.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}(0,Zt._)([(0,qt.o)({count:Pt.H.COUNT})],Ns.prototype,"output",void 0),(0,Zt._)([(0,qt.o)({count:Es.q.COUNT})],Ns.prototype,"doubleSidedMode",void 0),(0,Zt._)([(0,qt.o)({count:te.Am.COUNT})],Ns.prototype,"transparencyPassType",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"spherical",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"receiveShadows",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"receiveAmbientOcclusion",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"vvSize",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"vvColor",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"vvOpacity",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"hasSlicePlane",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"transparent",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"hasOccludees",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"hasMultipassTerrain",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"cullAboveGround",void 0),(0,Zt._)([(0,qt.o)()],Ns.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,Zt._)([(0,qt.o)({constValue:Os.f7.Disabled})],Ns.prototype,"pbrMode",void 0),(0,Zt._)([(0,qt.o)({constValue:!0})],Ns.prototype,"hasVvInstancing",void 0),(0,Zt._)([(0,qt.o)({constValue:!1})],Ns.prototype,"useCustomDTRExponentForWater",void 0),(0,Zt._)([(0,qt.o)({constValue:!1})],Ns.prototype,"useFillLights",void 0);var Fs=i(21123);class ks extends Dt.F5{constructor(e){super(e,new Vs),this.supportsEdges=!0,this._vertexAttributeLocations=Is,this._configuration=new Ns,this.vertexBufferLayout=ks.getVertexBufferLayout(this.parameters)}getConfiguration(e,t){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==Pt.H.Color&&e!==Pt.H.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?Es.q.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?Es.q.WindingOrder:Es.q.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!t.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(e){return e!==Yi.C.MATERIAL_DEPTH_SHADOWMAP_ALL&&e!==Yi.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&e!==Yi.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const e=this.parameters;return!!super.isVisible()&&e.opacity>0}intersect(e,t,i,r,n,o,a){const l=e;if(!Yr(l))return;const c=l.path,u=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const e=this.parameters.vvSizeOffset,t=this.parameters.vvSizeFactor,i=this.parameters.vvSizeMinSize,r=this.parameters.vvSizeMaxSize,s=c.sizeAttributeValue;u[0]*=(0,Ye.uZ)(e[0]+s*t[0],i[0],r[0]),u[1]*=(0,Ye.uZ)(e[2]+s*t[2],i[2],r[2])}const h=Math.max(u[0],u[1]),d=e.boundingInfo;if((0,s.Wi)(d))return void this._intersectTriangles(c,u,n,o,a);const p=(0,f.al)(d.bbMin[0]-h,d.bbMin[1]-h,d.bbMin[2]-h,d.bbMax[0]+h,d.bbMax[1]+h,d.bbMax[2]+h),m=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],g=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),y=[g/m[0],g/m[1],g/m[2]];(0,xr.Tw)(p,n,y,r.tolerance)&&this._intersectTriangles(c,u,n,o,a)}_intersectTriangles(e,t,i,r,s){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(i,r,s)}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const r=i.get(j.T.POSITION);return(0,di.qZ)(r,null,!1,t)}createBufferWriter(){return new zs(this.vertexBufferLayout)}requiresSlot(e){return e===(this.parameters.transparent?Nt.r.TRANSPARENT_MATERIAL:Nt.r.OPAQUE_MATERIAL)||e===Nt.r.DRAPED_MATERIAL}createGLMaterial(e){return e.output===Pt.H.Color||e.output===Pt.H.Alpha||e.output===Pt.H.Depth||e.output===Pt.H.Normal||e.output===Pt.H.Highlight||e.output===Pt.H.Shadow&&this.parameters.castShadows?new Us(e):null}static getVertexBufferLayout(e){let t=(0,Rt.U$)().vec3f(j.T.POSITION).vec4f(j.T.PROFILERIGHT).vec4f(j.T.PROFILEUP).vec4f(j.T.PROFILEVERTEXANDNORMAL);return(e.vvColorEnabled||e.vvSizeEnabled||e.vvOpacityEnabled)&&(t=t.vec4f(j.T.FEATUREVALUE)),t}}class Us extends As.Z{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){((0,s.Wi)(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==Pt.H.Color&&this._output!==Pt.H.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(Ds,e)}}class Vs extends Ls{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class zs{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(j.T.POSITION).length}write(e,t,i,r){const s=e=>{if(t.vertexAttributes.has(e)){const s=t.vertexAttributes.get(e),n=t.indices.get(e);(0,Xi.hu)(4===s.size);const o=i.getField(e,P.ek);if(!o)throw new Error("unable to acquire view for "+e);(0,Fs.SW)(n,s.data,o,r)}};s(j.T.PROFILERIGHT),s(j.T.PROFILEUP),s(j.T.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(j.T.FEATUREVALUE)&&s(j.T.FEATUREVALUE),(0,Fs.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}const Bs=["polyline"];class Hs extends k.k{constructor(e,t,i,r){super(e,t,i,r),this._intrinsicSize=(0,c.f)(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=(0,s.pC)(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,t=(0,s.pC)(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,t],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=at(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const i=this.symbolLayer.anchor||"center";this.upVectorAlignment="path","heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");const r=this.symbolLayer.profile||"circle";switch(r){case"circle":default:this._profile=is.circle(tn);break;case"quad":this._profile=is.rect()}let n=[0,0];switch("center"!==i&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new ns(0,Qs);break;case"bevel":this._extruder=new ns(0,1);break;case"miter":this._extruder=new ns(.8*Math.PI,1);break;default:this._extruder=new ss}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new ls,this._endCap=new ls;break;case"butt":default:this._startCap=new cs(this._profile,0),this._endCap=new cs(this._profile,0,!0);break;case"square":this._startCap=new cs(this._profile,-.5),this._endCap=new cs(this._profile,.5,!0);break;case"round":{const e="quad"===r;this._startCap=new us({profile:this._profile,flip:!1,breakNormals:e,subdivisions:en}),this._endCap=new us({profile:this._profile,flip:!0,breakNormals:e,subdivisions:en});break}}const a=(0,s.U2)(this.symbolLayer,"material","color"),u=this._getCombinedOpacityAndColor(a),d=(0,h.d)(u),p=u[3],f=p<1||this.needsDrivenTransparentPass,m={diffuse:d,ambient:d,opacity:p,transparent:f,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:f||"none"===o?te.Vr.None:te.Vr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&((0,l.a)(this._intrinsicSize,e,t),!(0,U.ZL)(this._intrinsicSize[0])||!(0,U.ZL)(this._intrinsicSize[1])))throw new S.Z("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(0,l.f)(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const e={...m,...this._fastUpdates.materialParameters,size:(0,c.b)(this._intrinsicSize)};this._material=new ks(e)}else m.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new re.Gp(m);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Bs,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t,new F.o),r=e.renderingInfo;return this._createAs3DShape(t,r,i,t.uid)}layerOpacityChanged(){const e=(0,s.U2)(this.symbolLayer,"material","color"),t=this._getCombinedOpacity(e),i=t<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:t,transparent:i}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,N.B5)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return V.W.Recreate_Symbol;if(!lt(this._fastUpdates,t,this._vvConvertOptions))return V.W.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return V.W.Fast_Update}getVertexData(e){let t=0;const i=e.paths,r=[],s=e.spatialReference,n=this._context.elevationProvider.spatialReference,o=this._context.renderCoordsHelper.spatialReference;for(const e of i)t+=e.length;const a=new Float64Array(3*t),l=new Float64Array(3*t),c=new Float64Array(3*t);let u=0;for(const t of i){r.push({index:u,numVertices:t.length});for(const i of t)a[u++]=i[0],a[u++]=i[1],a[u++]=e.hasZ?i[2]:0}let h=!0;return s.equals(n)?this._copyVertices(a,0,l,0,t):h=(0,p.CM)(a,s,0,l,n,0,t),n.equals(o)?this._copyVertices(l,0,c,0,t):(0,p.CM)(l,n,0,c,o,0,t),{pathVertexDataInfos:r,vertexDataGS:a,vertexDataES:l,vertexDataRS:c,projectionSuccess:h,terrainElevation:0}}_copyVertices(e,t,i,r,s){t*=3,r*=3;for(let n=0;n<s;++n)i[r++]=e[t++],i[r++]=e[t++],i[r++]=e[t++]}_createAs3DShape(e,t,i,r){const n=e.geometry,o=new Array,a=new Array,l=new Array,c=n.spatialReference,h=(0,f.Ue)(),d=this._context.renderCoordsHelper;$s.spatialReference=c;const p=this.getVertexData(n);if(!p.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(p.pathVertexDataInfos.length>0){for(let r=0;r<p.pathVertexDataInfos.length;++r){const n=p.pathVertexDataInfos[r],m=n.index,g=n.numVertices;if(g<2)continue;if((0,s.pC)(this._context.clippingExtent)&&((0,f.cS)(h),(0,f.G1)(h,p.vertexDataES,3*m,g),!(0,f.Zp)(h,this._context.clippingExtent)))continue;const y=[];for(let e=m;e<m+3*g;){const t=e++,r=e++,s=e++,n=new ts;(0,u.s)(n.posGS,p.vertexDataGS[t],p.vertexDataGS[r],p.vertexDataGS[s]),(0,u.s)(n.posES,p.vertexDataES[t],p.vertexDataES[r],p.vertexDataES[s]);const o=(0,N.w7)(n.posES,this._context.elevationProvider,i,d);(0,u.s)(Ys,p.vertexDataRS[t],p.vertexDataRS[r],p.vertexDataRS[s]),d.setAltitude(Ys,o),(0,u.s)(n.pos,Ys[0],Ys[1],Ys[2]),y.push(n)}const _=new rs(y);js(_,this.upVectorAlignment,this._context.renderCoordsHelper);const v=new hs(_,this._profile,this._extruder,this._startCap,this._endCap);let b=null;if(this._fastUpdates.enabled){const t=this._fastUpdates.visualVariables,i=t.size?(0,k.d)(t.size.field,e):0,r=t.color?(0,k.d)(t.color.field,e):0,s=t.opacity?(0,k.d)(t.opacity.field,e):0;b=new fs(v,i,r,s)}else{const e=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(e[0]*=Gs(t.size[0],"symbol-value"===t.size[2]?this.symbolLayer.height||0:t.size[2],this.symbolLayer.width||0),e[1]*=Gs(t.size[2],"symbol-value"===t.size[0]?this.symbolLayer.width||0:t.size[0],this.symbolLayer.height||0));let i=null;this._drivenProperties.color&&(i=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(i=i?[i[0],i[1],i[2],t.opacity]:[1,1,1,t.opacity]);const r=new ps(v);r.bake(e),i&&r.bakeVertexColors(i),b=r}const{vertexAttributes:w,indices:x}=b.createGeometryData(),C=new $r(w,x,b,c,this.upVectorAlignment,this.stencilWidth);o.push(C),a.push(this._material),l.push(b.xform)}if(o.length>0){const e={layerUid:this._context.layer.uid,graphicUid:r},t=new ie.T({geometries:o,materials:a,transformations:l,metadata:e}),s=new C.z(this,t,o,null,null,Zs,i);return s.alignedSampledElevation=p.terrainElevation,s.needsElevationUpdates=(0,N.B5)(i.mode),s}}else 0!==n.paths.length&&n.paths.some((e=>e.length>0))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function js(e,t,i){switch(t){case"world":for(const t of e.vertices)(0,u.a)(Xs,t.pos,e.offset),i.worldUpAtPosition(Xs,Ys),t.setFrameFromUpVector(Ys),t.computeRotationAxisAndAngleFromUpVector();break;case"path":(0,u.a)(Xs,e.vertices[0].pos,e.offset),i.worldUpAtPosition(Xs,Ys),function(e,t){let i=null;const r=e.vertices.length,s=.99619469809,n=(0,h.c)(),o=(0,h.c)(),a=(0,h.c)(),l=(0,h.c)(),c=(0,h.c)(),d=(0,h.c)(),p=(0,Xr.Ue)();let f=e.vertices[0];(0,u.c)(o,t),(0,u.s)(n,0,1,0),ft.Z.makeOrthoBasisDirUpFallback(f.vRight,o,n,n,a,o,s),(0,u.c)(f.frame.up,o),(0,u.c)(f.frame.right,a),i=f;for(let t=1;t<r;++t){f=e.vertices[t],(0,u.a)(c,f.vLeft,f.vRight);let r=(0,u.l)(c);r>0?(r=1/Math.sqrt(r),c[0]=c[0]*r,c[1]=c[1]*r,c[2]=c[2]*r):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),(0,u.a)(d,i.pos,i.frame.up),(0,Xr.Yq)(f.pos,c,p),(0,Xr.BR)(p,(0,Jr.re)(d,f.vLeft),l)?((0,u.b)(l,l,f.pos),(0,u.n)(o,l),(0,u.f)(a,c,o),(0,u.n)(a,a)):ft.Z.makeOrthoBasisDirUpFallback(c,i.frame.up,i.frame.right,n,a,o,s),(0,u.c)(f.frame.up,o),(0,u.c)(f.frame.right,a),i=f}}(e,Ys);for(const t of e.vertices){const e=Math.sign((0,u.e)(t.frame.right,t.vRight));(0,u.f)(t.rotationFrame.up,t.vRight,t.vLeft),(0,u.g)(t.rotationFrame.up,t.rotationFrame.up,e),(0,u.n)(t.rotationFrame.up,t.rotationFrame.up);const i=(0,u.e)(t.rotationFrame.up,t.frame.up),r=(0,u.e)(t.rotationFrame.up,t.frame.right);if((0,u.g)(Xs,t.frame.up,-r),(0,u.g)(Js,t.frame.right,i),(0,u.a)(Xs,Xs,Js),(0,u.n)(t.rotationFrame.right,Xs),es(t.rotationRight,t.frame,t.rotationFrame.right),(0,u.o)(Xs,t.vLeft),t.rotationAngle=-e*(Math.PI-(0,Ye.ZF)((0,u.e)(Xs,t.vRight))),Math.abs(t.rotationAngle)>0){const e=(0,Ye.b_)(Math.cos(.5*t.rotationAngle));Hr(t.miterStretch,1+(e-1)*t.rotationRight[0]*t.rotationRight[0],(e-1)*t.rotationRight[0]*t.rotationRight[1],(e-1)*t.rotationRight[0]*t.rotationRight[1],1+(e-1)*t.rotationRight[1]*t.rotationRight[1])}const s=Math.PI-t.rotationAngle;t.maxStretchDistance=Math.abs(Math.min(t.vLeftLength,t.vRightLength)*(0,Ye.b_)(Math.cos(.5*s)))}}}function Gs(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function Ws(e,t,i,r){let s=0;for(const n of e.vertices)(0,N.qZ)(n.posES,i,t,r,Ks),s+=Ks.sampledElevation,(0,u.a)(Ys,n.pos,e.offset),r.setAltitude(Ys,Ks.z),(0,u.b)(n.pos,Ys,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function Zs(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;qs.spatialReference=r.spatialReference;for(const e of n){const n=e.geometry;if(!Yr(n))continue;const a=n.path,l=a.builder.path,c=n.geometrySR;$s.spatialReference=c,o+=Ws(l,t,i,r),"world"!==n.upVectorAlignment&&js(l,n.upVectorAlignment,r),a.onPathChanged(),n.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(e)}return o/n.length}const qs=(0,g.Tx)(0,0,0,null),$s=(0,g.Tx)(0,0,0,null),Ys=(0,h.c)(),Xs=(0,qr.c)(),Js=(0,qr.c)(),Ks=new N.Lm,Qs=3,en=3,tn=10;var rn=i(25726);function sn(e,t,i,r,n=1){(0,u.s)(ln,1,0,0),(0,u.s)(cn,0,1,0),(0,u.s)(un,0,0,1),function(e,t){(0,u.s)(wn,0,0,0);for(let e=0;e<t.count-1;e++)t.getVec(e,on),(0,u.a)(wn,wn,on);(0,u.g)(e,wn,1/(t.count-1))}(nn,t),function(e,t){const i=e.count-1;return(0,Xr.$I)(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}(t,an)&&function(e,t,i,r,n,o){(0,s.pC)(n)?(n.basisMatrixAtPosition(o,yn),(0,u.s)(_n,yn[0],yn[1],yn[2]),(0,u.s)(vn,yn[4],yn[5],yn[6]),(0,u.s)(bn,yn[8],yn[9],yn[10])):((0,u.s)(_n,1,0,0),(0,u.s)(vn,0,1,0),(0,u.s)(bn,0,0,1));const a=(0,Xr.mJ)(e);(0,u.e)(a,bn)<0&&(0,u.g)(a,a,-1),(0,u.c)(r,a);const l=(0,u.e)(a,vn),c=(0,u.e)(a,_n);Math.abs(l)<Math.abs(c)?((0,u.C)(t,_n,a,-c),(0,u.n)(t,t),(0,u.f)(i,t,a),(0,u.n)(i,i),(0,u.g)(i,i,-1)):((0,u.C)(i,vn,a,-l),(0,u.n)(i,i),(0,u.f)(t,i,a),(0,u.n)(t,t))}(an,ln,cn,un,i,nn),(0,l.a)(hn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),(0,l.a)(dn,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let e=0;e<t.count;e++){t.getVec(e,on);const i=(0,u.e)(ln,on),r=(0,u.e)(cn,on);hn[0]=Math.min(hn[0],i),hn[1]=Math.min(hn[1],r),dn[0]=Math.max(dn[0],i),dn[1]=Math.max(dn[1],r)}const o=(0,u.e)(un,nn);xn(fn,hn[0],hn[1],o,ln,cn,un),xn(mn,dn[0],hn[1],o,ln,cn,un),xn(gn,hn[0],dn[1],o,ln,cn,un),(0,u.b)(mn,mn,fn),(0,u.g)(mn,mn,.5),(0,u.b)(gn,gn,fn),(0,u.g)(gn,gn,.5),(0,u.a)(fn,fn,mn),(0,u.a)(fn,fn,gn);const a=hn[0]%n,c=hn[1]%n;pn[0]=hn[0]-a,pn[1]=hn[1]-c;for(let i=0;i<t.count;i++){t.getVec(i,on),e.setValues(i,((0,u.e)(ln,on)-pn[0])/n,((0,u.e)(cn,on)-pn[1])/n,pn[0]/n,pn[1]/n);for(let e=0;e<3;e++)r.set(i,e,fn[e]),r.set(i,e+3,mn[e]),r.set(i,e+6,gn[e])}}const nn=(0,h.c)(),on=(0,h.c)(),an=(0,Xr.Ue)(),ln=(0,h.c)(),cn=(0,h.c)(),un=(0,h.c)(),hn=(0,c.a)(),dn=(0,c.a)(),pn=(0,c.a)(),fn=(0,h.c)(),mn=(0,h.c)(),gn=(0,h.c)(),yn=(0,R.c)(),_n=(0,h.c)(),vn=(0,h.c)(),bn=(0,h.c)(),wn=(0,h.c)();function xn(e,t,i,r,s,n,o){(0,u.s)(e,t*s[0]+i*n[0]+r*o[0],t*s[1]+i*n[1]+r*o[1],t*s[2]+i*n[2]+r*o[2])}var Cn=i(84891),Tn=i(9066),Sn=i(89339),En=i(46076);class An extends Ut.A{initializeProgram(e){const t=An.shader.get().build(this.configuration);return new zt.$(e.rctx,t,Rn)}_setPipelineState(e,t){const i=this.configuration,r=e===te.Am.NONE,s=e===te.Am.FrontFace;return(0,jt.sm)({blending:i.output===Pt.H.Color||i.output===Pt.H.Alpha?r?Vt.wu:(0,Vt.j7)(e):null,culling:(0,jt.zp)(i.cullFace),depthTest:{func:(0,Vt.Bh)(e)},depthWrite:r?i.writeDepth&&jt.LZ:(0,Vt.K5)(e),colorWrite:jt.BK,stencilWrite:i.hasOccludees?Bt.s3:null,stencilTest:i.hasOccludees?t?Bt.eD:Bt.RY:null,polygonOffset:r||s?i.polygonOffset&&Mn:(0,Vt.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}An.shader=new kt.J(En.P,(()=>i.e(1090).then(i.bind(i,51090))));const Mn={factor:1,units:1};class On extends $t.W{constructor(){super(...arguments),this.output=Pt.H.Color,this.cullFace=te.Vr.None,this.transparencyPassType=te.Am.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,Zt._)([(0,qt.o)({count:Pt.H.COUNT})],On.prototype,"output",void 0),(0,Zt._)([(0,qt.o)({count:te.Vr.COUNT})],On.prototype,"cullFace",void 0),(0,Zt._)([(0,qt.o)({count:Tn.b.COUNT})],On.prototype,"style",void 0),(0,Zt._)([(0,qt.o)({count:te.Am.COUNT})],On.prototype,"transparencyPassType",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"hasSlicePlane",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"hasVertexColors",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"polygonOffset",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"writeDepth",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"hasOccludees",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"patternSpacing",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"lineWidth",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"enableOffset",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"draped",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"hasMultipassTerrain",void 0),(0,Zt._)([(0,qt.o)()],On.prototype,"cullAboveGround",void 0);const Rn=new Map([[j.T.POSITION,0],[j.T.COLOR,3],[j.T.UVMAPSPACE,4],[j.T.BOUNDINGRECT,5]]);class Pn extends Dt.F5{constructor(e){super(e,new Dn),this.supportsEdges=!0,this._vertexAttributeLocations=Rn,this.techniqueConfig=new On}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<Vt.ve,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,s,n,o){(0,xr.Bw)(e,t,r,s,n,void 0,o)}requiresSlot(e,t){return e===Nt.r.DRAPED_MATERIAL||((0,It.S)(t)===Pt.H.Highlight?e===Nt.r.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?Nt.r.TRANSPARENT_MATERIAL:Nt.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL))}createGLMaterial(e){return e.output===Pt.H.Color||e.output===Pt.H.Alpha||e.output===Pt.H.Highlight||e.output===Pt.H.Depth&&this.parameters.writeLinearDepth?new In(e):null}createBufferWriter(){const e=(0,Rt.U$)().vec3f(j.T.POSITION).vec4u8(j.T.COLOR).vec4f(j.T.UVMAPSPACE);return this.parameters.draped||e.mat3f(j.T.BOUNDINGRECT),new Ln(e)}}class In extends As.Z{_updateParameters(e){return this.ensureTechnique(An,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==Pt.H.Color&&this._output!==Pt.H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class Ln extends Sn.G_{write(e,t,i,r){for(const s of this.vertexBufferLayout.fieldNames){const n=t.vertexAttributes.get(s),o=t.indices.get(s);if(n&&o)switch(s){case j.T.POSITION:{(0,Xi.hu)(3===n.size);const t=i.getField(s,P.ct);t&&(0,Fs.ho)(o,n.data,e.transformation,t,r);break}case j.T.COLOR:{(0,Xi.hu)(3===n.size||4===n.size);const e=i.getField(s,P.mc);e&&(0,Fs.Vs)(o,n.data,n.size,e,r);break}case j.T.UVMAPSPACE:{(0,Xi.hu)(4===n.size);const e=i.getField(s,P.ek);e&&(0,Fs.SW)(o,n.data,e,r);break}case j.T.BOUNDINGRECT:{(0,Xi.hu)(9===n.size);const t=i.getField(s,P.gK);t&&this.writeBoundingRect(o,n.data,e.transformation,t,r);break}}}}writeBoundingRect(e,t,i,r,s){const n=i,o=r.typedBuffer,a=r.typedBufferStride,l=e.length;s*=a;for(let i=0;i<l;++i){const r=9*e[i],l=t[r],c=t[r+1],u=t[r+2];o[s]=n[0]*l+n[4]*c+n[8]*u+n[12],o[s+1]=n[1]*l+n[5]*c+n[9]*u+n[13],o[s+2]=n[2]*l+n[6]*c+n[10]*u+n[14];for(let e=3;e<9;++e)o[s+e]=t[r+e];s+=a}}}class Dn extends Dt.Mt{constructor(){super(...arguments),this.color=(0,Re.f)(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=te.Vr.None,this.hasOccludees=!1,this.style=Tn.b.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function Nn(e,t){if(function(e){return e.material instanceof Pn&&!e.material.parameters.draped}(e)){const i=e.geometry.vertexAttributes,r=i.get(j.T.POSITION).data,s=i.get(j.T.UVMAPSPACE).data,n=i.get(j.T.BOUNDINGRECT).data;sn(P.ek.fromTypedArray(s),P.fP.fromTypedArray(r),t,P.ey.fromTypedArray(n))}}function Fn(e,t,i,r){const s=(0,Fe.Wf)(e,t,i,r),n=e.stageObject.geometryRecords;for(let e=0;e<n.length;e++)Nn(n[e],r);return s}const kn=["polyline","polygon","extent"];class Un extends k.k{constructor(e,t,i,r){super(e,t,i,r),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if((0,s.pC)(this._material))return;const e=(0,s.U2)(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e);this._material=function(e,t,i){return function(e,t,i){return(0,s.pC)(e)?"none"===e.style||"solid"===e.style?("none"===e.style&&(t.color=(0,Re.f)(0,0,0,0),t.transparent=!0),new Cn.E(t)):(t.style=function(e){switch(e){case"horizontal":return Tn.b.Horizontal;case"vertical":return Tn.b.Vertical;case"cross":return Tn.b.Cross;case"forward-diagonal":return Tn.b.ForwardDiagonal;case"backward-diagonal":return Tn.b.BackwardDiagonal;case"diagonal-cross":return Tn.b.DiagonalCross;default:return}}(e.style),t.draped=i.isDraped,new Pn(t)):new Cn.E(t)}(function(e){return e&&e.pattern||null}(e),t,i)}(this.symbolLayer,{color:t,transparent:t[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof Pn,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;!(0,s.pC)(this._outlineMaterial)&&this._isValidOutline(e)&&(this._hasOutline=!0,this._outlineMaterial=(t=>{const i=(0,ri.Dp)(e.pattern);return new si.U({width:t,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:i,stippleScaleWithLineWidth:!0,cap:(0,Mt.u9)(e.patternCap||"butt")})})((0,Ae.F2)(e.size)),this._context.stage.add(this._outlineMaterial))}_isValidOutline(e){return(0,s.pC)(e)&&e.size&&e.size>0&&(0,s.pC)(e.color)&&((0,s.Wi)(e.pattern)||"style"!==e.pattern.type||"none"!==e.pattern.style)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,kn,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),r=this.setGraphicElevationContext(t,new F.o);return this.ensureDrapedStatus("on-the-ground"===r.mode),this._ensureMaterials(),this.draped?this._createAsOverlay(t,i):this._createAs3DShape(t,i,r)}layerOpacityChanged(){if((0,s.pC)(this._material)){const e=this._material.parameters.color,t=(0,s.U2)(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t);this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if((0,s.pC)(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,s=(0,N.GC)(Un.elevationModeChangeTypes,i,r);if(s!==N.lO.UPDATE)return s;const n=(0,N.Xf)(r);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>n))}slicePlaneEnabledChanged(){if((0,s.pC)(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(0,s.pC)(this._outlineMaterial)){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,i){const r=q(e.geometry);if((0,s.Wi)(r))return null;zn.renderData=$(r,this._context.elevationProvider,this._context.renderCoordsHelper,i),zn.color=t;const n=zn.renderData.position.length/3;if(this._needsUV&&(zn.uvMapSpace=new Float32Array(4*n),zn.boundingRect=new Float64Array(9*n)),zn.outNum=0,zn.outGeometries=[],zn.outTransforms=[],zn.outMaterials=[],this._createAs3DShapeFill(zn),this._hasOutline&&this._createAs3DShapeOutline(zn),this._logGeometryCreationWarnings(zn.renderData,r.rings,"rings","FillSymbol3DLayer"),0===zn.outNum)return null;this._needsUV&&sn(P.ek.fromTypedArray(zn.uvMapSpace),P.fP.fromTypedArray(zn.renderData.position),this._context.renderCoordsHelper,P.ey.fromTypedArray(zn.boundingRect));const o=new ie.T({geometries:zn.outGeometries,materials:zn.outMaterials,transformations:zn.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),a=new C.z(this,o,zn.outGeometries,null,null,Fn,i);return a.alignedSampledElevation=zn.renderData.sampledElevation,a.needsElevationUpdates=(0,N.Xf)(i.mode),a}_createAs3DShapeFill(e){const t=e.renderData.polygons;for(const{position:i,mapPosition:r,holeIndices:n,index:o,count:a}of t){if((0,s.pC)(this._context.clippingExtent)&&((0,f.cS)(Vn),(0,f.G1)(Vn,r),!(0,f.Zp)(Vn,this._context.clippingExtent)))continue;const t=(0,E.e)(r,n,3);if(0===t.length)continue;const l=W({indices:new Uint32Array(t),attributeData:{position:i,color:e.color,mapPosition:r,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*o*e.uvMapSpace.BYTES_PER_ELEMENT,4*a):null,boundingRect:this._needsUV?new Float64Array(e.boundingRect.buffer,9*o*e.boundingRect.BYTES_PER_ELEMENT,9*a):null}});e.outGeometries.push(l),e.outMaterials.push((0,s.Wg)(this._material)),e.outTransforms.push(R.I),e.outNum++}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let i=0;i<t.length;++i){const{mapPosition:r,position:n}=t[i];if((0,s.pC)(this._context.clippingExtent)&&((0,f.cS)(Vn),(0,f.G1)(Vn,r),!(0,f.Zp)(Vn,this._context.clippingExtent)))continue;const o=(0,Mt.YU)({overlayInfo:null,removeDuplicateStartEnd:Mt.NW.REMOVE,attributeData:{position:n,mapPosition:r}}),a=o.vertexAttributes.get(j.T.POSITION);a.data===n&&(a.data=new Float64Array(n)),e.outGeometries.push(o),e.outMaterials.push((0,s.Wg)(this._outlineMaterial)),e.outTransforms.push(R.I),e.outNum++}}_createAsOverlay(e,t){const i=q(e.geometry);if((0,s.Wi)(i))return null;(0,s.Wg)(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,(0,s.pC)(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Bn.renderData=Y(i,this._context.overlaySR),Bn.color=t;const r=Bn.renderData.position.length/3;return this._needsUV&&(Bn.uvMapSpace=new Float32Array(4*r)),Bn.outNum=0,Bn.outGeometries=[],Bn.outBoundingBox=(0,f.cS)(),Bn.layerUid=this._context.layer.uid,Bn.graphicsUid=e.uid,this._createAsOverlayFill(Bn),this._hasOutline&&this._createAsOverlayOutline(Bn),this._logGeometryCreationWarnings(Bn.renderData,i.rings,"rings","FillSymbol3DLayer"),0===Bn.outNum?null:(this._needsUV&&function(e,t,i,r,s=1){if(i.isGeographic&&r===D.JY.Global){const e=new Float64Array(t.typedBuffer.length),r=3*t.count,s=(0,rn.Iu)(i);for(let i=0;i<r;i+=3)(0,p.gH)(t.typedBuffer,i,e,i,s);t=P.fP.fromTypedArray(e)}(0,l.a)(hn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let e=0;e<t.count;e++)t.getVec(e,on),hn[0]=Math.min(hn[0],on[0]),hn[1]=Math.min(hn[1],on[1]);const n=hn[0]%s,o=hn[1]%s;pn[0]=hn[0]-n,pn[1]=hn[1]-o;for(let i=0;i<t.count;i++)t.getVec(i,on),e.setValues(i,(on[0]-pn[0])/s,(on[1]-pn[1])/s,pn[0]/s,pn[1]/s)}(P.ek.fromTypedArray(Bn.uvMapSpace),P.fP.fromTypedArray(Bn.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),Bn.outNum>0?new Ue(this,Bn.outGeometries,Bn.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(e){const t=e.renderData.polygons;for(const{position:i,holeIndices:r,index:n,count:o}of t){if((0,f.cS)(Vn),(0,f.G1)(Vn,i),!(0,f.Zp)(Vn,this._context.clippingExtent))continue;const t=(0,E.e)(i,r,3);if(0===t.length)continue;(0,f.TC)(e.outBoundingBox,Vn);const a=W({indices:new Uint32Array(t),attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*n*e.uvMapSpace.BYTES_PER_ELEMENT,4*o):null}}),l=new mt.z(a,(0,s.Wg)(this._material),{layerUid:e.layerUid,graphicUid:e.graphicsUid}),c=Vn;(0,Oe.s)(l.boundingSphere,.5*(c[0]+c[3]),.5*(c[1]+c[4]),0,.5*Math.sqrt((c[3]-c[0])*(c[3]-c[0])+(c[4]-c[1])*(c[4]-c[1]))),e.outGeometries.push(l),e.outNum++}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let i=0;i<t.length;++i){const{position:r}=t[i];if((0,f.cS)(Vn),(0,f.G1)(Vn,r),!(0,f.Zp)(Vn,this._context.clippingExtent))continue;(0,f.TC)(e.outBoundingBox,Vn);const n=(0,Mt.YU)({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:Mt.NW.REMOVE,attributeData:{position:r}}),o=new mt.z(n,(0,s.Wg)(this._outlineMaterial),{layerUid:e.layerUid,graphicUid:e.graphicsUid}),a=Vn;(0,Oe.s)(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(o),e.outNum++}}_getOutlineOpacity(){const e=(0,s.U2)(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*((0,s.pC)(e)?e.a:0)}_getOutlineColor(){const e=(0,s.U2)(this.symbolLayer,"outline","color"),t=this._getOutlineOpacity();return(0,U.Uu)((0,s.pC)(e)?Se.Z.toUnitRGB(e):null,t)}test(){return{...super.test(),createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,i)=>this._createAs3DShape(e,t,i)}}}Un.elevationModeChangeTypes={definedChanged:N.lO.RECREATE,staysOnTheGround:N.lO.NONE,onTheGroundChanged:N.lO.RECREATE};const Vn=(0,f.Ue)(),zn={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Bn={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};var Hn=i(94984),jn=i(71667),Gn=i(90670);class Wn{constructor(e,t,i){this._renderer=new Gn.tV(e,t,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=(0,Gn.GZ)(Zn,this._renderer.renderedWidth,this._renderer.renderedHeight),t=e.getContext("2d");return t.save(),this._renderer.render(t,0,0),t.restore(),new gt.x(e,{wrap:{s:fi.e8.CLAMP_TO_EDGE,t:fi.e8.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:te.CE.PAD})}}const Zn={canvas:null},qn=[0,0,1];class $n extends k.k{constructor(e,t,i,r){super(e,t,i,r),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,U.bh)(this.symbolLayer.size);if(e)throw new S.Z("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await jn.V.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const t=e.graphic,i=(0,qe.S_)(t.geometry);if((0,s.Wi)(i))return this.logger.warn(`unsupported geometry type for text symbol: ${t.geometry.type}`),null;const r=this.symbolLayer.text;if((0,s.Wi)(r)||""===r)return null;const n=(0,Hn.Pd)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if((0,s.pC)(n)&&!(0,Hn.as)(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o={...Jn,verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:(0,Ze.j1)(this.symbolLayer.verticalAlignment)};return this._createAs3DShape(t,i,r,o)}createLabel(e,t,i,r){const n=e.graphic,o=(0,qe.S_)(n.geometry);if((0,s.Wi)(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=t.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,t,i,r)}setGraphicElevationContext(e,t,i=0){const r=super.setGraphicElevationContext(e,t);return r.addOffsetRenderUnits(i),r}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,t){return Yn(e,t,((e,t)=>{this.updateGraphicElevationContext(t,e)})),N.lO.UPDATE}slicePlaneEnabledChanged(e,t){return Yn(e,t,(e=>{for(const t of e.stageObject.geometryRecords)t.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=(0,N.Xf)(t.elevationContext.mode)||"absolute-height"===t.elevationContext.mode}_defaultElevationInfoNoZ(){return Xn}_createAs3DShape(e,t,i,r,o,a){const l=this.setGraphicElevationContext(e,new F.o,r.elevationOffset),u="polyline"===(0,s.U2)(e.geometry,"type"),h=e.uid;let d=null,p=null;if((0,s.Wi)(a)){const e=(0,Ze.mq)(r.horizontalPlacement);d=new Wn(i,e,this._textRenderParameters);let t=null;p=this._context.sharedResources.textures.fromData(d.key,(()=>(0,s.Wg)(d).create()),(()=>{(0,s.pC)(t)&&t.release()}));const o=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if((0,s.Wi)(o)||(0,n.y8)(o))return p.release(),null;t=o}const f=function(e,t){if("baseline"===t.verticalPlacement){const i=Ze.$A[t.horizontalPlacement],r=(0,s.pC)(e)?e.baselineAnchorY:0;return(0,c.f)(i,r)}const i=(0,Ze.QW)(t.horizontalPlacement,t.verticalPlacement);return Ze.yY[i]}(d,r),m={occlusionTest:!0,screenOffset:r.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:r.centerOffsetUnits,debugDrawLabelBorder:r.debugDrawLabelBorder,drawInSecondSlot:!0};if((0,s.pC)(p)&&(m.textureId=p.texture.id),(0,s.pC)(a)&&(m.textureId=a.id),(0,s.pC)(r.verticalOffset)){const{screenLength:e,minWorldLength:t,maxWorldLength:i}=r.verticalOffset;m.verticalOffset={screenLength:(0,Ae.F2)(e),minWorldLength:t||0,maxWorldLength:null!=i?i:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:e,screenSizePerspectiveSettingsLabels:t}=this._context.sharedResources;m.screenSizePerspective=t.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=e}let g;if(u&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,(0,s.pC)(o)){const e=JSON.stringify(m);g=o.get(e),(0,s.Wi)(g)&&(g=new yt.A(m),o.add(e,g))}else g=new yt.A(m);const y=[g],_=r.translation,v=(0,s.pC)(d)?[d.displayWidth,d.displayHeight]:[0,0],b=r.centerOffset,w=qn,x=[ft.Z.createPointGeometry(w,_,null,v,b,[0,0],null)],T=this._context.layer.uid,S=(0,qe.km)(this._context,t,x,y,l,T,h);if(null===S)return null;const E=new C.z(this,S.object,x,(0,s.Wi)(o)?y:null,p,Fe.j3,l);E.alignedSampledElevation=S.sampledElevation,E.needsElevationUpdates=(0,N.Xf)(l.mode)||"absolute-height"===l.mode;const{displayWidth:A,displayHeight:M}=(0,s.pC)(d)?d:r;E.getScreenSize=(e=(0,c.a)())=>(e[0]=A,e[1]=M,e);const O={labelText:i,elevationOffset:r.elevationOffset};return E.metadata=O,(0,qe.dO)(E,t,this._context.elevationProvider),E}}function Yn(e,t,i){e&&e.forEach((e=>{const r=t(e);(0,s.pC)(r)&&i(r,e.graphic)}))}const Xn={mode:"relative-to-ground",offset:0},Jn={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0};var Kn=i(17321),Qn=i(60581);const eo={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},to=["polyline","polygon","extent"];class io extends k.k{constructor(e,t,i,r){super(e,t,i,r)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,to,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t,new F.o);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,i,t.uid)}ensureMaterial(){if((0,s.pC)(this._material))return;const e=new Qn.m,t=this.symbolLayer.color;(0,s.pC)(t)&&(e.color=Se.Z.toUnitRGBA(t));const i=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=(0,s.pC)(this.symbolLayer.waveDirection)?io.headingVectorFromAngle(this.symbolLayer.waveDirection):(0,c.f)(0,0);const r=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=eo[r];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new Qn.H(e),this._context.stage.add(this._material)}layerOpacityChanged(){if((0,s.Wi)(this._material))return!0;const e=this._material.parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=t<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[e[0],e[1],e[2],t],transparent:i}),!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,s=(0,N.GC)(io.elevationModeChangeTypes,i,r);if(s!==N.lO.UPDATE)return s;const n=(0,N.Xf)(r);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>n))}slicePlaneEnabledChanged(){return(0,s.pC)(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,i){const r=q(e.geometry);if((0,s.Wi)(r))return null;ao.renderData=$(r,this._context.elevationProvider,this._context.renderCoordsHelper,t);const n=ao.renderData.position.length/3;if(ao.uvCoords=new Float64Array(2*n),ao.outNum=0,ao.outGeometries=[],ao.outTransforms=[],ao.outMaterials=[],this._create3DShapeGeometries(ao),this._logGeometryCreationWarnings(ao.renderData,r.rings,"rings","WaterSymbol3DLayer"),0===ao.outNum)return null;this._createUVCoordsFromVertices(ao.uvCoords,ao.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const o=new ie.T({geometries:ao.outGeometries,materials:ao.outMaterials,transformations:ao.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),a=new C.z(this,o,ao.outGeometries,null,null,Fe.Wf,t);return a.alignedSampledElevation=ao.renderData.sampledElevation,a.needsElevationUpdates=(0,N.Xf)(t.mode),a}_createUVCoordsFromVertices(e,t,i,r){const s=(0,Kn.c9)(r);(0,m.cS)(so);for(let e=0;e<i;e++)(0,l.a)(no,t[3*e+0],t[3*e+1]),(0,m.Ho)(so,no);(0,Oe.b)(so,so,s);const n=so[0]%io.unitSizeOfTexture,o=so[1]%io.unitSizeOfTexture;ro[0]=so[0]-n,ro[1]=so[1]-o;for(let r=0;r<i;r++)e[2*r+0]=(t[3*r+0]*s-ro[0])/io.unitSizeOfTexture,e[2*r+1]=(t[3*r+1]*s-ro[1])/io.unitSizeOfTexture}_create3DShapeGeometries(e){const t=e.renderData.polygons,i=e.uvCoords;for(const{count:r,index:n,position:o,mapPosition:a,holeIndices:l}of t){if((0,s.pC)(this._context.clippingExtent)&&((0,f.cS)(oo),(0,f.G1)(oo,a),!(0,f.Zp)(oo,this._context.clippingExtent)))continue;const t=(0,E.e)(a,l,3);if(0===t.length)continue;const c=Z({indices:new Uint32Array(t),attributeData:{position:o,uv0:new Float64Array(i.buffer,2*n*i.BYTES_PER_ELEMENT,2*r),mapPosition:a}});e.outGeometries.push(c),e.outMaterials.push((0,s.Wg)(this._material)),e.outTransforms.push(R.I),e.outNum++}}_createAsOverlay(e){const t=q(e.geometry);if((0,s.Wi)(t))return null;(0,s.Wg)(this._material).renderPriority=this._renderPriority,lo.renderData=Y(t,this._context.overlaySR);const i=lo.renderData.position.length/3;return lo.uvCoords=new Float64Array(2*i),lo.outNum=0,lo.outGeometries=[],lo.outBoundingBox=(0,f.cS)(),lo.layerUid=this._context.layer.uid,lo.graphicsUid=e.uid,this._createAsOverlayWater(lo),this._logGeometryCreationWarnings(lo.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===lo.outNum?null:(this._createUVCoordsFromVertices(lo.uvCoords,lo.renderData.position,i,this._context.overlaySR),lo.outNum>0?new Ue(this,lo.outGeometries,lo.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(e){const t=e.uvCoords,i=e.renderData.polygons;for(const{position:r,holeIndices:n,index:o,count:a}of i){if((0,f.cS)(oo),(0,f.G1)(oo,r),!(0,f.Zp)(oo,this._context.clippingExtent))continue;(0,f.TC)(e.outBoundingBox,oo);const i=(0,E.e)(r,n,3);if(0===i.length)continue;const l=Z({indices:new Uint32Array(i),attributeData:{position:r,uv0:new Float64Array(t.buffer,2*o*t.BYTES_PER_ELEMENT,2*a)}}),c=new mt.z(l,(0,s.Wg)(this._material),{layerUid:e.layerUid,graphicUid:e.graphicsUid}),u=oo;(0,Oe.s)(c.boundingSphere,.5*(u[0]+u[3]),.5*(u[1]+u[4]),0,.5*Math.sqrt((u[3]-u[0])*(u[3]-u[0])+(u[4]-u[1])*(u[4]-u[1]))),e.outGeometries.push(c),e.outNum++}}static headingVectorFromAngle(e){const t=(0,c.a)(),i=(0,Br.t)(e);return t[0]=Math.sin(i),t[1]=Math.cos(i),t}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}io.unitSizeOfTexture=100,io.elevationModeChangeTypes={definedChanged:N.lO.RECREATE,staysOnTheGround:N.lO.NONE,onTheGroundChanged:N.lO.RECREATE};const ro=(0,c.a)(),so=(0,m.Ue)(),no=(0,c.a)(),oo=(0,f.Ue)(),ao={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},lo={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},co=T.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function uo(e,t,i,r){const s=po[e.type]&&po[e.type][t.type]||ho[t.type];return s?new s(e,t,i,r):(co.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const ho={icon:Tt,object:Nr,line:oi,path:Hs,fill:Un,extrude:ne,text:$n,water:io},po={"mesh-3d":{fill:gi}};class fo extends Fi.w{constructor(e,t,i){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(e){this._symbol=e;for(let t=0;t<e.symbolLayers.length;t++){const i=this.symbolLayers[t];(0,s.Wi)(i)||(i.symbol=e,i.symbolLayer=e.symbolLayers.items[t])}}get symbol(){return this._symbol}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const i=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const o=[];for(let r=0;r<i;r++){const s=t.getItemAt(r);if(!1===s.enabled)continue;mo.renderPriority=1-(1+r)/i,mo.renderPriorityStep=1/i,mo.ignoreDrivers=s._ignoreDrivers;const a=uo(this.symbol,s,this._context,mo);o.push((0,n.$F)(e,(()=>{this.symbolLayers[r]=null,a.destroy()}))),this.symbolLayers[r]=a}await(0,r.Ed)(this.symbolLayers,(async(e,t)=>{if((0,s.pC)(e))try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}}));for(const e of o)e?.remove();if(o.length=0,(0,n.k_)(e),this.symbolLayers.length&&!this.symbolLayers.some((e=>!!e)))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return(0,s.pC)(t)?t.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(e,t){const i=e.graphic,r=new Array(this.symbolLayers.length);for(let t=0;t<this.symbolLayers.length;t++){const i=this.symbolLayers[t];r[t]=(0,s.pC)(i)?i.createGraphics3DGraphic(e):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new x(i,t||this,r,e.layer,n)}get complexity(){return(0,ji.IQ)(this.symbolLayers.map((e=>(0,s.U2)(e,"complexity"))))}globalPropertyChanged(e,t){const i=this.symbolLayers.length;for(let r=0;r<i;r++){const i=this.symbolLayers[r],n=e=>{const t=e.graphics[r];return t instanceof C.z?t:null};if((0,s.pC)(i)&&!i.globalPropertyChanged(e,t,n))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==Fi.P.LOADED?V.W.Recreate_Symbol:this.symbolLayers.reduce(((i,r)=>i!==V.W.Recreate_Symbol&&(0,s.pC)(r)?Math.min(i,r.applyRendererDiff(e,t)):i),V.W.Fast_Update)}prepareSymbolPatch(e){if(this.loadStatus===Fi.P.FAILED)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const i=t.symbolLayers.diff;this.symbolLayers.forEach(((t,r)=>{if((0,s.Wi)(t))return;const n=i[r];if(n){const i={diff:n,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(i),e.symbolStatePatches.push(...i.symbolLayerStatePatches),i.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push(((e,t)=>{const n=e.graphics[r];(0,s.pC)(n)&&i.graphics3DGraphicPatches.forEach((e=>e(n,t)))}))}}))}updateGeometry(e,t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if((0,s.Wi)(r))continue;const n=e.graphics[i];if((0,s.Wi)(n)||!r.updateGeometry(n,t))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const i=this.symbolLayers[t];if((0,s.Wi)(i))continue;const r=e.graphics[t];(0,s.pC)(r)&&i.onRemoveGraphic(r)}}getFastUpdateStatus(){let e=0,t=0,i=0;return this.symbolLayers.forEach((r=>{(0,s.Wi)(r)||(r.loadStatus===Fi.P.LOADING?e++:r.isFastUpdatesEnabled()?i++:t++)})),{loading:e,slow:t,fast:i}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)(0,s.pC)(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const mo={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1}},17905:(e,t,i)=>{"use strict";i.d(t,{d:()=>y,k:()=>g});var r=i(30936),s=(i(39994),i(13802)),n=i(61681),o=i(8909),a=i(1983),l=i(63669),c=i(29642),u=i(64487),h=i(14923),d=i(4357),p=i(53266),f=i(19214);const m=s.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class g extends p.w{constructor(e,t,i,r){super(i.schedule),this._context=i,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=m,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=e,this.symbolLayer=t,this._renderPriority=r.renderPriority,this._renderPriorityStep=r.renderPriorityStep,this._elevationContext=new c.o,this.complexity=this.computeComplexity(),this._ignoreDrivers=r.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=_(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this._ignoreDrivers)return!1;const t=this._drivenProperties,i=_(e);return i.color!==t.color||i.opacity!==t.opacity||i.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||i.size!==t.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,i,r){const s=e.projectionSuccess,n="polygons"in e?e.polygons:null,o=`${r} geometry failed to be created`;let a=null;s?!t.length||1===t.length&&!t[0].length?a=`${o} (no ${i} were defined)`:Array.isArray(t)&&Array.isArray(t[0])?n&&0===n.length&&"rings"===i&&t.length>0&&t[0].length>2&&(a=`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):a=`${o} (${i} should be defined as a 2D array)`:a=`${o} (failed to project geometry to view spatial reference)`,a&&m.warnOncePerTick(a)}_validateGeometry(e,t=null,i=null){if((0,n.pC)(t)&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if("point"===e.type){const t=e;if(!isFinite(t.x)||!isFinite(t.y))return m.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return v}_defaultElevationInfoZ(){return b}_updateElevationContext(){(0,n.pC)(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t){const i=(0,n.Wg)(e.geometry),r=this.getDefaultElevationInfo(i);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:r.unit,t.mode=this.getGeometryElevationMode(i,r),t.offsetMeters=(0,n.Pt)(this._elevationContext.meterUnitOffset,(0,n.Pt)(r.offset,0));const s=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;s&&(t.mode="relative-to-ground",t.offsetMeters=0);const o=s?u.O$:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(o,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}onRemoveGraphic(e){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const e=this._context.layer.opacity;return null==e?1:e}_getCombinedOpacity(e,t=w){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||((0,n.pC)(e)?i*=e.a:t.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,t=w){const i=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return(0,h.Uu)(null,i);const s=(0,n.pC)(e)?r.Z.toUnitRGB(e):o.O;return(0,h.Uu)(s,i)}_getVertexOpacityAndColor(e,t=null){const i=this._drivenProperties.color?e.color:null,r=this._drivenProperties.opacity?e.opacity:null,s=(0,h.Uu)(i,r);return(0,n.pC)(t)&&(s[0]*=t,s[1]*=t,s[2]*=t,s[3]*=t),s}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return(0,f.u)(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,i){switch(e){case"opacity":return this.layerOpacityChanged(t,i);case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,i,e)!==l.lO.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,t,i){let r=l.lO.UPDATE;return e.forEach((e=>{const s=t(e);if((0,n.pC)(s)){const t=e.graphic;this.setGraphicElevationContext(t,s.elevationContext),s.needsElevationUpdates=i(s.elevationContext.mode)}else r=l.lO.RECREATE})),r}applyRendererDiff(e,t){return d.W.Recreate_Symbol}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const t=this._fastUpdates.visualVariables,i=t.size?y(t.size.field,e):0,r=t.color?y(t.color.field,e):0,s=t.opacity?y(t.opacity.field,e):0;return(0,a.f)(i,r,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&m.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables?.size?.field??null,color:this._fastUpdates?.visualVariables?.color?.field??null,opacity:this._fastUpdates?.visualVariables?.opacity?.field??null,rotation:this._fastUpdates?.visualVariables?.rotation?.field??null})}}}function y(e,t){const i=null!=e?t.attributes[e]:0;return null!=i&&isFinite(i)?i:0}function _(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach((e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let i=0;i<e.stops.length;i++){const r=e.stops[i].color;r&&(t.opacity=!0,r.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}})),t}const v={mode:"on-the-ground",offset:0,unit:"meters"},b={mode:"absolute-height",offset:0,unit:"meters"},w={hasIntrinsicColor:!1}},27437:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var r=i(61681),s=i(4357),n=i(53266),o=i(19214);class a extends n.w{constructor(e,t,i){super(t),this.symbol=e,this.convert=i,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return(0,r.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return(0,r.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return(0,r.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this.convert(t),(0,r.pC)(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return(0,r.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return(0,r.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:o.WU}globalPropertyChanged(e,t){return!!(0,r.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return(0,r.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,t):s.W.Recreate_Symbol}prepareSymbolPatch(e){(0,r.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return!!(0,r.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,t)}onRemoveGraphic(){}getFastUpdateStatus(){return(0,r.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){(0,r.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}},53266:(e,t,i)=>{"use strict";i.d(t,{P:()=>r,w:()=>a});var r,s,n=i(61681),o=i(78668);class a{constructor(e){this.schedule=e,this._loadStatus=r.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===r.LOADED?(e&&e(),(0,n.Wg)(this._loader)):this._loadStatus===r.FAILED?(t&&t(this._loadError),(0,n.Wg)(this._loader)):((0,n.Wi)(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then((()=>{this._abortController=null,this._loadStatus=r.LOADED}),(e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=r.FAILED,!(0,o.D_)(e)&&this.logger&&e.message&&this.logger.warn(e.message),e}))),this._loader.then(e,t).catch((()=>{})),this._loader)}abortLoad(){(0,n.pC)(this._abortController)?this._abortController=(0,n.IM)(this._abortController):this._loadStatus===r.LOADING&&(this._loadStatus=r.FAILED),this._loader=null}}(s=r||(r={}))[s.LOADING=0]="LOADING",s[s.LOADED=1]="LOADED",s[s.FAILED=2]="FAILED"},9423:(e,t,i)=>{"use strict";i.d(t,{ZF:()=>s,a1:()=>o,rD:()=>n});var r=i(1983);const s=1.2,n=r.Z,o=r.O},63669:(e,t,i)=>{"use strict";i.d(t,{B5:()=>v,GC:()=>y,Lm:()=>w,Xf:()=>_,bD:()=>b,lO:()=>r,qZ:()=>m,rR:()=>f,w7:()=>g});var r,s,n=i(27755),o=i(61681),a=i(24455),l=i(39100),c=i(8909),u=i(90472),h=i(94486),d=i(14923),p=i(66143);function f(e,t,i,r,s,n,o,a,l,c,h){const d=x[h.mode];let p,f,m=0;if((0,u.CM)(e,t,i,r,l.spatialReference,s,a))return d.requiresAlignment(h)?(m=d.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),p=n,f=o):(p=r,f=s),(0,u.CM)(p,l.spatialReference,f,n,c.spatialReference,o,a)?m:void 0}function m(e,t,i,r,s){const a=((0,h.f)(e)?e.z:(0,p.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const i=(0,o.Pt)((0,p.KO)(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=i,void(s.z=i)}case"relative-to-ground":{const n=(0,o.Pt)((0,p.KO)(t,e,"ground"),0),l=i.geometryZWithOffset(a,r);return s.verticalDistanceToGround=l,s.sampledElevation=n,void(s.z=l+n)}case"relative-to-scene":{const n=(0,o.Pt)((0,p.KO)(t,e,"scene"),0),l=i.geometryZWithOffset(a,r);return s.verticalDistanceToGround=l,s.sampledElevation=n,void(s.z=l+n)}case"absolute-height":{const n=i.geometryZWithOffset(a,r),l=(0,o.Pt)((0,p.KO)(t,e,"ground"),0);return s.verticalDistanceToGround=n-l,s.sampledElevation=l,void(s.z=n)}default:return(0,n.Bg)(i.mode),void(s.z=0)}}function g(e,t,i,r){return m(e,t,i,r,T),T.z}function y(e,t,i){return null==t||null==i?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===i?e.staysOnTheGround:t===i||"on-the-ground"!==t&&"on-the-ground"!==i?r.UPDATE:e.onTheGroundChanged}function _(e){return"relative-to-ground"===e||"relative-to-scene"===e}function v(e){return"absolute-height"!==e}function b(e,t,i,r,s){m(t,i,s,r,T),(0,d.CV)(e,T.verticalDistanceToGround);const n=T.sampledElevation,o=(0,a.c)(C,e.transformation);return S[0]=t.x,S[1]=t.y,S[2]=T.z,(0,u.Bm)(t.spatialReference,S,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}class w{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(s=r||(r={}))[s.NONE=0]="NONE",s[s.UPDATE=1]="UPDATE",s[s.RECREATE=2]="RECREATE";const x={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let n=0;n<s;++n){const s=e[t+0],n=e[t+1],o=e[t+2];i[r+0]=s,i[r+1]=n,i[r+2]=null==c?o+l:l,t+=3,r+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,s,n){let a=0;const l=n.spatialReference;t*=3,r*=3;for(let c=0;c<s;++c){const s=e[t+0],c=e[t+1],u=e[t+2],h=(0,o.Pt)(n.getElevation(s,c,u,l,"ground"),0);a+=h,i[r+0]=s,i[r+1]=c,i[r+2]=h,t+=3,r+=3}return a/s},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,s,n,a,l){let c=0;const u=l.calculateOffsetRenderUnits(a),h=l.featureExpressionInfoContext,d=n.spatialReference;t*=3,r*=3;for(let a=0;a<s;++a){const s=e[t+0],a=e[t+1],l=e[t+2],p=(0,o.Pt)(n.getElevation(s,a,l,d,"ground"),0);c+=p,i[r+0]=s,i[r+1]=a,i[r+2]=null==h?l+p+u:p+u,t+=3,r+=3}return c/s},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,i,r,s,n,a,l){let c=0;const u=l.calculateOffsetRenderUnits(a),h=l.featureExpressionInfoContext,d=n.spatialReference;t*=3,r*=3;for(let a=0;a<s;++a){const s=e[t+0],a=e[t+1],l=e[t+2],p=(0,o.Pt)(n.getElevation(s,a,l,d,"scene"),0);c+=p,i[r+0]=s,i[r+1]=a,i[r+2]=null==h?l+p+u:p+u,t+=3,r+=3}return c/s},requiresAlignment:()=>!0}},C=(0,l.c)(),T=new w,S=(0,c.c)()},12391:(e,t,i)=>{"use strict";var r,s;i.d(t,{E:()=>r,P:()=>s}),function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"}(r||(r={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(s||(s={}))},64487:(e,t,i)=>{"use strict";i.d(t,{O$:()=>f,Tz:()=>u,WI:()=>p,aO:()=>h,bw:()=>l,d9:()=>a,ht:()=>d,kr:()=>c});var r=i(13802),s=i(45043),n=i(30879);const o=r.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function a(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function l(e){const t=e&&e.expression;if("string"==typeof t){const e=g(t);if(null!=e)return{cachedResult:e}}return null}async function c(e,t,i){const r=e&&e.expression;if("string"!=typeof r)return null;const s=g(r);if(null!=s)return{cachedResult:s};const o=await(0,n.LC)(),a=o.arcadeUtils,l=a.createSyntaxTree(r);return a.dependsOnView(l)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:t}),modules:o}}}function u(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function h(e,t){if(null!=e&&!m(e)){if(!t||!e.arcade)return void o.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=(0,s.kB)(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function d(e){if(null!=e){if(m(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}function p(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||"0"===r||(i=null),i}const f={cachedResult:0};function m(e){return null!=e.cachedResult}function g(e){return"0"===e?0:null}},14923:(e,t,i)=>{"use strict";i.d(t,{$o:()=>C,CV:()=>w,Go:()=>b,Si:()=>M,Uu:()=>x,ZL:()=>E,_Z:()=>A,bD:()=>T,bh:()=>S,zE:()=>y});var r=i(61681),s=i(24455),n=i(39100),o=i(8909),a=i(88589),l=i(1983),c=i(90472),u=i(37116),h=i(24568),d=i(18449),p=i(38028),f=i(48358),m=i(45043),g=i(21414);function y(e,t){if("point"===e.type)return v(e,t,!1);if((0,m.Ou)(e))switch(e.type){case"extent":return v(e.center,t,!1);case"polygon":return v(e.centroid,t,!1);case"polyline":return v(_(e),t,!0);case"mesh":return v(e.origin,t,!1)}else switch(e.type){case"extent":return v(function(e){const t=isFinite(e.zmin);return(0,f.Tx)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return v(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=(0,d.a)(e.rings,e.hasZ);return(0,f.Tx)(i[0],i[1],i[2],e.spatialReference)}(e),t,!0);case"polyline":return v(_(e),t,!0)}}function _(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=(0,p.n8)(t,(0,p.ok)(t)/2);return(0,f.Tx)(i[0],i[1],i[2],e.spatialReference)}function v(e,t,i){const r=i?e:(0,m.WG)(e);return t&&e?(0,c.nF)(e,r,t)?r:null:r}function b(e,t,i,r=0){if(e){t||(t=(0,h.Ue)());const s=e;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),(0,a.s)(t,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),t}return null}function w(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(g.T.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function x(e,t){const i=(0,l.d)(l.O);return(0,r.pC)(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),(0,r.pC)(t)?i[3]=t:(0,r.pC)(e)&&e.length>3&&(i[3]=e[3]),i}function C(e,t,i,s,n,o=[0,0,0,0]){for(let t=0;t<3;++t)(0,r.pC)(e)&&null!=e[t]?o[t]=e[t]:(0,r.pC)(i)&&null!=i[t]?o[t]=i[t]:o[t]=n[t];return(0,r.pC)(t)?o[3]=t:(0,r.pC)(s)?o[3]=s:o[3]=n[3],o}function T(e=o.O,t,i,s=1){const n=new Array(3);if((0,r.Wi)(t)||(0,r.Wi)(i))n[0]=1,n[1]=1,n[2]=1;else{let r,s=0;for(let o=2;o>=0;o--){const a=e[o];let l;const c=null!=a,u=0===o&&!r&&!c,h=i[o];"symbol-value"===a||u?l=0!==h?t[o]/h:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==h?a/h:1),null!=l&&(n[o]=l,r=l,s=Math.max(s,Math.abs(l)))}for(let e=2;e>=0;e--)null==n[e]?n[e]=r:0===n[e]&&(n[e]=.001*s)}for(let e=2;e>=0;e--)n[e]/=s;return(0,o.d)(n)}function S(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),E(e)?null:"Symbol sizes may not be negative values"}function E(e){if(Array.isArray(e)){for(const t of e)if(!E(t))return!1;return!0}return null==e||e>=0}function A(e,t,i,r=(0,n.c)()){const o=e||0,a=t||0,l=i||0;return 0!==o&&(0,s.g)(r,r,-o/180*Math.PI),0!==a&&(0,s.r)(r,r,a/180*Math.PI),0!==l&&(0,s.o)(r,r,l/180*Math.PI),r}function M(e,t){return null!=t.minDemResolution?t.minDemResolution:(0,u.wp)(e)?t.minDemResolutionForPoints:.01*(0,u.aO)(e)}},4357:(e,t,i)=>{"use strict";var r;i.d(t,{W:()=>r}),function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"}(r||(r={}))},69341:(e,t,i)=>{"use strict";i.d(t,{NW:()=>r,VP:()=>x,YU:()=>w,rm:()=>T,u9:()=>A}),i(39994);var r,s,n=i(61681),o=i(86098),a=i(55709),l=i(6766),c=i(8909),u=i(90472),h=i(25726),d=i(35413),p=i(65684),f=i(9423),m=i(63669),g=i(99608),y=i(70984),_=i(47562),v=i(21414),b=i(26531);function w(e){const t=[],i=[];!function(e,t,i){const{attributeData:{position:s},removeDuplicateStartEnd:n}=e,a=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(s)&&n===r.REMOVE,l=s.length/3-(a?1:0),c=new Uint32Array(2*(l-1)),u=a?(0,o.tP)(s,0,s.length-3):s;let h=0;for(let e=0;e<l-1;e++)c[h++]=e,c[h++]=e+1;t.push([v.T.POSITION,{size:3,data:u,exclusive:a}]),i.push([v.T.POSITION,c])}(e,i,t);const s=i[0][1].data,c=t[0][1].length,d=new Uint16Array(c);return function(e,t,i){const r=e.attributeData.mapPosition;(0,n.Wi)(r)||(i.push([v.T.MAPPOS,i[0][1]]),t.push([v.T.MAPPOS,{size:3,data:r}]))}(e,i,t),function(e,t,i,r){if((0,n.pC)(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([v.T.COLOR,{size:4,data:(0,n.Pt)(s,f.a1)}]),i.push([v.T.COLOR,r])}(e,i,t,d),function(e,t,i,r){if((0,n.pC)(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([v.T.SIZE,{size:1,data:[(0,n.Pt)(s,1)]}]),i.push([v.T.SIZE,r])}(e,i,t,d),function(e,t,i,r){const s=e.attributeData.colorFeature;(0,n.Wi)(s)||(t.push([v.T.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([v.T.COLOR,r]))}(e,i,t,d),function(e,t,i,r){const s=e.attributeData.sizeFeature;(0,n.Wi)(s)||(t.push([v.T.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([v.T.SIZEFEATUREATTRIBUTE,r]))}(e,i,t,d),function(e,t,i,r){const s=e.attributeData.opacityFeature;(0,n.Wi)(s)||(t.push([v.T.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([v.T.OPACITYFEATUREATTRIBUTE,r]))}(e,i,t,d),function(e,t,i,r){if((0,n.Wi)(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==p.JY.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(r.length),o=(0,h.Iu)(e.overlayInfo.spatialReference);for(let e=0;e<s.length;e+=3)(0,u.gH)(r,e,s,e,o);const c=r.length/3,d=new Float32Array(c+1);let f=S,m=E,g=0,y=0;(0,l.s)(f,s[y++],s[y++],s[y++]),d[0]=0;for(let e=1;e<c+1;++e)e===c&&(y=0),(0,l.s)(m,s[y++],s[y++],s[y++]),g+=(0,a.d)(f,m),d[e]=g,[f,m]=[m,f];t.push([v.T.DISTANCETOSTART,{size:1,data:d}]),i.push([v.T.DISTANCETOSTART,i[0][1]])}(e,i,t,s),new _.Z(i,t,y.MX.Line)}function x(e,t,i,r){const s="polygon"===e.type?d.ZI.CCW_IS_HOLE:d.ZI.NONE,n="polygon"===e.type?e.rings:e.paths,{position:o,outlines:a}=(0,d.Mk)(n,e.hasZ,s),l=new Float64Array(o.length),c=(0,m.rR)(o,e.spatialReference,0,l,0,o,0,o.length/3,t,i,r),u=null!=c;return{lines:u?C(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function C(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const e=3*s,o=e+3*n;r.push({position:t.subarray(e,o),mapPosition:i?i.subarray(e,o):void 0})}return r}function T(e,t){const i="polygon"===e.type?d.ZI.CCW_IS_HOLE:d.ZI.NONE,r="polygon"===e.type?e.rings:e.paths,{position:s,outlines:n}=(0,d.Mk)(r,!1,i),o=(0,u.CM)(s,e.spatialReference,0,s,t,0,s.length/3);for(let e=2;e<s.length;e+=3)s[e]=g.Rn;return{lines:o?C(n,s):[],projectionSuccess:o}}(s=r||(r={}))[s.KEEP=0]="KEEP",s[s.REMOVE=1]="REMOVE";const S=(0,c.c)(),E=(0,c.c)();function A(e){switch(e){case"butt":return b.R.BUTT;case"square":return b.R.SQUARE;case"round":return b.R.ROUND;default:return null}}},66007:(e,t,i)=>{"use strict";i.r(t),i.d(t,{fetch:()=>R,gltfToEngineResources:()=>I,parseUrl:()=>P});var r=i(57989),s=i(61681),n=i(1662),o=i(34344),a=i(24455),l=i(39100),c=i(6766),u=i(8909),h=i(37116),d=i(81936),p=i(86717),f=i(56999),m=i(79),g=i(91420),y=i(40462),_=i(1731),v=i(1305),b=i(70984),w=i(47562),x=i(44101),C=i(21414),T=i(46151),S=i(14634),E=i(91907),A=i(385),M=i(32101),O=i(14789);async function R(e,t){const i=P((0,r.pJ)(e));if("wosr"===i.fileType){const e=await(t.cache?t.cache.loadWOSR(i.url,t):(0,v.zD)(i.url,t)),r=(0,v.p2)(e,t);return{lods:[r],referenceBoundingBox:r.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:e.remove}}const n=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):(0,y.z)(new g.C(t.streamDataRequester),i.url,t,t.usePBR)),o=(0,s.U2)(n.model.meta,"ESRI_proxyEllipsoid");n.meta.isEsriSymbolResource&&(0,s.pC)(o)&&n.meta.uri.includes("/RealisticTrees/")&&function(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const n of r.parts){const r=n.attributes.normal;if((0,s.Wi)(r))return;const o=n.attributes.position,h=o.count,p=(0,u.c)(),f=(0,u.c)(),g=(0,u.c)(),y=(0,m.gS)(d.mc,h),_=(0,m.gS)(d.ct,h),v=(0,a.a)((0,l.c)(),n.transform);for(let s=0;s<h;s++){o.getVec(s,f),r.getVec(s,p),(0,c.m)(f,f,n.transform),(0,c.b)(g,f,t.center),(0,c.G)(g,g,t.radius);const a=g[2],l=(0,c.l)(g),u=Math.min(.45+.55*l*l,1);(0,c.G)(g,g,t.radius),(0,c.m)(g,g,v),(0,c.n)(g,g),i+1!==e.model.lods.length&&e.model.lods.length>1&&(0,c.h)(g,g,p,a>-1?.2:Math.min(-4*a-3.8,1)),_.setVec(s,g),y.set(s,0,255*u),y.set(s,1,255*u),y.set(s,2,255*u),y.set(s,3,255)}n.attributes.normal=_,n.attributes.color=y}}}(n,o);const h=n.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!n.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},p={...t.materialParamsMixin,treeRendering:!!n.customMeta.esriTreeRendering};if(null!=i.specifiedLodIndex){const e=I(n,h,p,i.specifiedLodIndex);let t=e[0].boundingBox;return 0!==i.specifiedLodIndex&&(t=I(n,h,p,0)[0].boundingBox),{lods:e,referenceBoundingBox:t,isEsriSymbolResource:n.meta.isEsriSymbolResource,isWosr:!1,remove:n.remove}}const f=I(n,h,p);return{lods:f,referenceBoundingBox:f[0].boundingBox,isEsriSymbolResource:n.meta.isEsriSymbolResource,isWosr:!1,remove:n.remove}}function P(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function I(e,t,i,r){const a=e.model,l=(0,o.c)(),c=new Array,u=new Map,g=new Map;return a.lods.forEach(((e,o)=>{if(void 0!==r&&o!==r)return;const y={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:(0,s.pC)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:(0,h.cS)()};c.push(y),e.parts.forEach((e=>{const r=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),o=a.materials.get(e.material),c=(0,s.pC)(e.attributes.texCoord0),v=(0,s.pC)(e.attributes.normal),R=function(e){switch(e){case"BLEND":return b.JJ.Blend;case"MASK":return b.JJ.Mask;case"OPAQUE":case null:case void 0:return b.JJ.Opaque}}(o.alphaMode);if(!u.has(r)){if(c){if((0,s.pC)(o.textureColor)&&!g.has(o.textureColor)){const e=a.textures.get(o.textureColor),t={...e.parameters,preMultiplyAlpha:R!==b.JJ.Opaque};g.set(o.textureColor,new x.x(e.data,t))}if((0,s.pC)(o.textureNormal)&&!g.has(o.textureNormal)){const e=a.textures.get(o.textureNormal);g.set(o.textureNormal,new x.x(e.data,e.parameters))}if((0,s.pC)(o.textureOcclusion)&&!g.has(o.textureOcclusion)){const e=a.textures.get(o.textureOcclusion);g.set(o.textureOcclusion,new x.x(e.data,e.parameters))}if((0,s.pC)(o.textureEmissive)&&!g.has(o.textureEmissive)){const e=a.textures.get(o.textureEmissive);g.set(o.textureEmissive,new x.x(e.data,e.parameters))}if((0,s.pC)(o.textureMetallicRoughness)&&!g.has(o.textureMetallicRoughness)){const e=a.textures.get(o.textureMetallicRoughness);g.set(o.textureMetallicRoughness,new x.x(e.data,e.parameters))}}const n=o.color[0]**(1/S.K),l=o.color[1]**(1/S.K),h=o.color[2]**(1/S.K),d=o.emissiveFactor[0]**(1/S.K),p=o.emissiveFactor[1]**(1/S.K),f=o.emissiveFactor[2]**(1/S.K),m=(0,s.pC)(o.textureColor)&&c?g.get(o.textureColor):null;u.set(r,new T.Gp({...t,transparent:R===b.JJ.Blend,customDepthTest:b.Gv.Lequal,textureAlphaMode:R,textureAlphaCutoff:o.alphaCutoff,diffuse:[n,l,h],ambient:[n,l,h],opacity:o.opacity,doubleSided:o.doubleSided,doubleSidedType:"winding-order",cullFace:o.doubleSided?b.Vr.None:b.Vr.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normals:v?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:(0,s.pC)(m)?m.id:void 0,colorMixMode:o.colorMixMode,normalTextureId:(0,s.pC)(o.textureNormal)&&c?g.get(o.textureNormal).id:void 0,textureAlphaPremultiplied:(0,s.pC)(m)&&!!m.params.preMultiplyAlpha,occlusionTextureId:(0,s.pC)(o.textureOcclusion)&&c?g.get(o.textureOcclusion).id:void 0,emissiveTextureId:(0,s.pC)(o.textureEmissive)&&c?g.get(o.textureEmissive).id:void 0,metallicRoughnessTextureId:(0,s.pC)(o.textureMetallicRoughness)&&c?g.get(o.textureMetallicRoughness).id:void 0,emissiveFactor:[d,p,f],mrrFactors:[o.metallicFactor,o.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,...i}))}const P=function(e,t){switch(t){case E.MX.TRIANGLES:return(0,_.nh)(e);case E.MX.TRIANGLE_STRIP:return(0,_.DA)(e);case E.MX.TRIANGLE_FAN:return(0,_.jX)(e)}}(e.indices||e.attributes.position.count,e.primitiveType),I=e.attributes.position.count,L=(0,m.gS)(d.ct,I);(0,p.t)(L,e.attributes.position,e.transform);const D=[[C.T.POSITION,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]],N=[[C.T.POSITION,P]];if((0,s.pC)(e.attributes.normal)){const t=(0,m.gS)(d.ct,I);(0,n.a)(l,e.transform),(0,p.a)(t,e.attributes.normal,l),D.push([C.T.NORMAL,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),N.push([C.T.NORMAL,P])}if((0,s.pC)(e.attributes.tangent)){const t=(0,m.gS)(d.ek,I);(0,n.a)(l,e.transform),(0,f.t)(t,e.attributes.tangent,l),D.push([C.T.TANGENT,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),N.push([C.T.TANGENT,P])}if((0,s.pC)(e.attributes.texCoord0)){const t=(0,m.gS)(d.Eu,I);(0,A.n)(t,e.attributes.texCoord0),D.push([C.T.UV0,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),N.push([C.T.UV0,P])}if((0,s.pC)(e.attributes.color)){const t=(0,m.gS)(d.mc,I);if(4===e.attributes.color.elementCount)e.attributes.color instanceof d.ek?(0,f.s)(t,e.attributes.color,255):e.attributes.color instanceof d.mc?(0,M.c)(t,e.attributes.color):e.attributes.color instanceof d.v6&&(0,f.s)(t,e.attributes.color,1/256);else{(0,M.f)(t,255,255,255,255);const i=new d.ne(t.buffer,0,4);e.attributes.color instanceof d.ct?(0,p.s)(i,e.attributes.color,255):e.attributes.color instanceof d.ne?(0,O.c)(i,e.attributes.color):e.attributes.color instanceof d.mw&&(0,p.s)(i,e.attributes.color,1/256)}D.push([C.T.COLOR,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),N.push([C.T.COLOR,P])}const F=new w.Z(D,N);y.stageResources.geometries.push(F),y.stageResources.materials.push(u.get(r)),c&&((0,s.pC)(o.textureColor)&&y.stageResources.textures.push(g.get(o.textureColor)),(0,s.pC)(o.textureNormal)&&y.stageResources.textures.push(g.get(o.textureNormal)),(0,s.pC)(o.textureOcclusion)&&y.stageResources.textures.push(g.get(o.textureOcclusion)),(0,s.pC)(o.textureEmissive)&&y.stageResources.textures.push(g.get(o.textureEmissive)),(0,s.pC)(o.textureMetallicRoughness)&&y.stageResources.textures.push(g.get(o.textureMetallicRoughness))),y.numberOfVertices+=I;const k=F.boundingInfo;(0,s.pC)(k)&&((0,h.pp)(y.boundingBox,k.getBBMin()),(0,h.pp)(y.boundingBox,k.getBBMax()))}))})),c}},89160:(e,t,i)=>{"use strict";i.d(t,{$A:()=>n,EP:()=>c,QW:()=>u,j1:()=>h,mq:()=>a,yY:()=>o,zi:()=>l});var r=i(69666),s=i(90670);const n={left:0,center:.5,right:1},o={"bottom-left":(0,r.f)(0,0),bottom:(0,r.f)(.5,0),"bottom-right":(0,r.f)(1,0),left:(0,r.f)(0,.5),center:(0,r.f)(.5,.5),right:(0,r.f)(1,.5),"top-left":(0,r.f)(0,1),top:(0,r.f)(.5,1),"top-right":(0,r.f)(1,1)};function a(e){switch(e){case"left":return s.vU.Left;case"right":return s.vU.Right;default:return s.vU.Center}}function l(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function c(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function u(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}}function h(e){return"middle"===e?"center":e}},63593:(e,t,i)=>{"use strict";i.d(t,{S_:()=>g,dO:()=>m,km:()=>f});var r=i(61681),s=i(39100),n=i(8909),o=i(90472),a=i(37116),l=i(38028),c=i(48358),u=i(63669),h=i(14923),d=i(49394);const p=(0,n.c)();function f(e,t,i,n,l,c,h,f){const m=i?i.length:0,g=e.clippingExtent;if((0,o.KC)(t,p,e.elevationProvider.spatialReference),(0,r.pC)(g)&&!(0,a.BD)(g,p))return null;(0,o.KC)(t,p,e.renderCoordsHelper.spatialReference);const y=e.localOriginFactory.getOrigin(p),_=new d.T({castShadow:!1,metadata:{layerUid:c,graphicUid:h,usesVerticalDistanceToGround:!0}});for(let e=0;e<m;e++){const t=s.I;_.addGeometry(i[e],n[e],t,y,f)}return{object:_,sampledElevation:(0,u.bD)(_,t,e.elevationProvider,e.renderCoordsHelper,l)}}function m(e,t,i){const r=e.elevationContext,s=i.spatialReference;(0,o.KC)(t,p,s),r.centerPointInElevationSR=(0,c.Tx)(p[0],p[1],t.hasZ?p[2]:0,s)}function g(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,h.zE)(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const i=(0,l.n8)(t,(0,l.ok)(t)/2);return(0,c.Tx)(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}},60910:(e,t,i)=>{"use strict";i.d(t,{F:()=>s,t:()=>n}),i(39994);var r=i(6087);function s(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function n(e,t){const i=(e,i,s=!1)=>({levels:e.map((e=>{const n=i(e.tesselation);return s&&r.Z.cgToGIS(n),{components:[{geometry:n,material:t}],faceCount:n.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}}))});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(e=>r.Z.createPolySphereGeometry(.5,e,!0)));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],(()=>r.Z.createBoxGeometry(1)));case"cone":return i(o,(e=>r.Z.createConeGeometry(1,.5,e,!1)),!0);case"inverted-cone":return i(o,(e=>r.Z.createConeGeometry(1,.5,e,!0)),!0);case"cylinder":return i(o,(e=>r.Z.createCylinderGeometry(1,.5,e,[0,0,1],[0,0,.5])));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],(()=>r.Z.createTetrahedronGeometry(1)),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],(()=>r.Z.createDiamondGeometry(1)),!0);default:return}}const o=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},57741:(e,t,i)=>{"use strict";i.d(t,{Ns:()=>a,Ph:()=>o,cU:()=>l}),i(39994);var r=i(73534),s=i(44101),n=i(91907);const o=128,a=.5;function l(e,t=o,i=t*a,r=0){const l=function(e,t=o,i=t*a,r=0){switch(e){case"circle":default:return function(e,t){const i=e/2-.5;return p(e,h(i,i,t/2))}(t,i);case"square":return function(e,t){return c(e,t,!1)}(t,i);case"cross":return function(e,t,i=0){return u(e,t,!1,i)}(t,i,r);case"x":return function(e,t,i=0){return u(e,t,!0,i)}(t,i,r);case"kite":return function(e,t){return c(e,t,!0)}(t,i);case"triangle":return function(e,t){return p(e,d(e/2,t,t/2))}(t,i);case"arrow":return function(e,t){const i=t,r=t/2,s=e/2,n=.8*i,o=h(s,(e-t)/2-n,Math.sqrt(n*n+r*r)),a=d(s,i,r);return p(e,((e,t)=>Math.max(a(e,t),-o(e,t))))}(t,i)}}(e,t,i,r);return new s.x(l,{mipmap:!1,wrap:{s:n.e8.CLAMP_TO_EDGE,t:n.e8.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function c(e,t,i){return i&&(t/=Math.SQRT2),p(e,((r,s)=>{let n=r-.5*e+.25,o=.5*e-s-.75;if(i){const e=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=e}return Math.max(Math.abs(n),Math.abs(o))-.5*t}))}function u(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const s=.5*t;return p(e,((t,n)=>{let o,a=t-.5*e,l=.5*e-n-1;if(i){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),o=a>l?a>s?Math.sqrt((a-s)*(a-s)+l*l):l:l>s?Math.sqrt(a*a+(l-s)*(l-s)):a,o-=r/2,o}))}function h(e,t,i){return(r,s)=>{const n=r-e,o=s-t;return Math.sqrt(n*n+o*o)-i}}function d(e,t,i){const r=Math.sqrt(t*t+i*i);return(s,n)=>{const o=Math.abs(s-e)-i,a=n-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function p(e,t){const i=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let n=0;n<e;n++){const o=n+e*s;let a=t(n,s);a=a/e+.5,(0,r.I)(a,i,4*o)}return i}},19214:(e,t,i)=>{"use strict";i.d(t,{BN:()=>g,IQ:()=>d,V9:()=>h,WU:()=>u,bz:()=>p,u:()=>m});var r=i(27755),s=i(61681),n=i(4125),o=i(60910),a=i(57180),l=i(21414),c=i(3248);const u={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function h(e){return"web-style"===e.type?u:d(e.symbolLayers.toArray().map((t=>m(e,t))))}function d(e){let t=0,i=0,r=0,n=!1,o=0;const a={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const l of e)(0,s.Wi)(l)||(t+=l.primitivesPerFeature,i+=l.primitivesPerCoordinate,r+=l.drawCallsPerFeature,a.bytesPerFeature+=l.memory.bytesPerFeature,a.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,a.bytesPerCoordinate+=l.memory.bytesPerCoordinate,a.draped.bytesPerFeature+=l.memory.bytesPerFeature,a.draped.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,a.draped.bytesPerCoordinate+=l.memory.bytesPerCoordinate,n=n||l.estimated,++o);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:n,memory:a,numComplexities:o}}function p(e){const t=d(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const f={};function m(e,t){const i=g(e,t),o=(0,a.eU)(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:o,estimated:!1,memory:i};case"fill":return"mesh-3d"===e.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:o,estimated:!1,memory:i}:(0,s.pC)(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:{...y(t.resource&&t.resource.primitive||n.S),memory:i};case"path":{const e=3,s=3,n=10;let o=0,a=0;switch(t.profile){case"circle":o=n;break;case"quad":o=4;break;default:return void(0,r.Bg)(t.profile)}switch(t.join){case"round":a=e;break;case"miter":case"bevel":a=1;break;default:return void(0,r.Bg)(t.join)}const l=2*o,c=o*a*2;let u=-2*c-l;switch(t.cap){case"none":break;case"butt":case"square":u+=2*(o-1);break;case"round":u+=2*(o*(s-1)*2+o);break;default:return}return{primitivesPerFeature:u,primitivesPerCoordinate:c+l,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function g(e,t){const i="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?_.EXTRUDE_EDGES:_.EXTRUDE;case"fill":return(0,s.pC)(t.outline)&&t.outline.size>0?_.FILL_OUTLINE:_.FILL;case"water":return _.FILL;case"line":return"round"===t.join?_.LINE_ROUND:_.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return _.PATH_ROUND_CIRCLE;case"quad":return _.PATH_ROUND_QUAD;default:return void(0,r.Bg)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return _.PATH_MITER_CIRCLE;case"quad":return _.PATH_MITER_QUAD;default:return void(0,r.Bg)(t.profile)}default:return void(0,r.Bg)(t.join)}case"object":return i?_.OBJECT_POINT:_.OBJECT_POLYGON;case"icon":case"text":return i?_.ICON_POINT:_.ICON_POLYGON;default:return}}function y(e){let t=f[e];if(t)return t;const i=(0,o.t)(e,null);return t={primitivesPerFeature:(0,c.VV)(i.levels[0]).reduce(((e,t)=>e+t.indices.get(l.T.POSITION).length/3),0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},f[e]=t,t}const _={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}}},1305:(e,t,i)=>{"use strict";i.d(t,{p2:()=>x,zD:()=>v});var r=i(66341),s=i(67979),n=i(70375),o=i(13802),a=i(61681),l=i(78668),c=i(26139),u=i(8909),h=i(37116),d=i(44883),p=i(70984),f=i(47562),m=i(44101),g=i(46151),y=i(91907);const _=o.Z.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function v(e,t){const i=await async function(e,t){const i=(0,a.pC)(t)&&t.streamDataRequester;if(i)return async function(e,t,i){const r=await(0,s.q6)(t.request(e,"json",i));if(!0===r.ok)return r.value;(0,l.r9)(r.error),b(r.error.details.url)}(e,i,t);const n=await(0,s.q6)((0,r.default)(e,(0,a.Wg)(t)));if(!0===n.ok)return n.value.data;(0,l.r9)(n.error),b(n.error)}(e,t);return{resource:i,textures:await T(i.textureDefinitions,t)}}function b(e){throw new n.Z("",`Request for object resource failed: ${e}`)}function w(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(_.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const i in t.vertexAttributes){const t=e[i];t&&t.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(_.warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),r=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(_.warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),r=!1)):(_.warn(`Indexed geometry does not specify face indices for '${i}' attribute`),r=!1)}}else _.warn("Indexed geometries must specify faces"),r=!1;break}default:_.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(_.warn("Geometry requires material"),r=!1);const s=e.params.vertexAttributes;for(const e in s)s[e].values||(_.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function x(e,t){const i=[],r=[],s=[],n=[],o=e.resource,l=c.G.parse(o.version||"1.0","wosr");A.validate(l);const h=o.model.name,d=o.model.geometries,y=o.materialDefinitions,_=e.textures;let v=0;const b=new Map;for(let e=0;e<d.length;e++){const o=d[e];if(!w(o))continue;const l=E(o),c=o.params.vertexAttributes,h=[];for(const e in c){const t=c[e],i=t.values;h.push([e,{data:i,size:t.valuesPerElement,exclusive:!0}])}const x=[];if("PerAttributeArray"!==o.params.topology){const e=o.params.faces;for(const t in e)x.push([t,new Uint32Array(e[t].values)])}const C=_&&_[l.texture];if(C&&!b.has(l.texture)){const{image:e,params:t}=C,i=new m.x(e,t);n.push(i),b.set(l.texture,i)}const T=b.get(l.texture),A=T?T.id:void 0;let M=s[l.material]?s[l.material][l.texture]:null;if(!M){const e=y[l.material.substring(l.material.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const i=C&&C.alphaChannelUsage,r=e.transparency>0||"transparency"===i||"maskAndTransparency"===i,n=C?S(C.alphaChannelUsage):void 0,o={ambient:(0,u.d)(e.diffuse),diffuse:(0,u.d)(e.diffuse),opacity:1-(e.transparency||0),transparent:r,textureAlphaMode:n,textureAlphaCutoff:.33,textureId:A,initTextureTransparent:!0,doubleSided:!0,cullFace:p.Vr.None,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:!!C&&!!C.params.preMultiplyAlpha};(0,a.pC)(t)&&t.materialParamsMixin&&Object.assign(o,t.materialParamsMixin),M=new g.Gp(o),s[l.material]||(s[l.material]={}),s[l.material][l.texture]=M}r.push(M);const O=new f.Z(h,x);v+=x.position?x.position.length:0,i.push(O)}return{name:h,stageResources:{textures:n,materials:r,geometries:i},pivotOffset:o.model.pivotOffset,boundingBox:C(i),numberOfVertices:v,lodThreshold:null}}function C(e){const t=(0,h.cS)();return e.forEach((e=>{const i=e.boundingInfo;(0,a.pC)(i)&&((0,h.pp)(t,i.getBBMin()),(0,h.pp)(t,i.getBBMax()))})),t}async function T(e,t){const i=[];for(const r in e){const s=e[r],n=s.images[0].data;if(!n){_.warn("Externally referenced texture data is not yet supported");continue}const o=s.encoding+";base64,"+n,l="/textureDefinitions/"+r,c="rgba"===s.channels?s.alphaChannelUsage||"transparency":"none",u={noUnpackFlip:!0,wrap:{s:y.e8.REPEAT,t:y.e8.REPEAT},preMultiplyAlpha:S(c)!==p.JJ.Opaque},h=(0,a.pC)(t)&&t.disableTextures?Promise.resolve(null):(0,d.t)(o,t);i.push(h.then((e=>({refId:l,image:e,params:u,alphaChannelUsage:c}))))}const r=await Promise.all(i),s={};for(const e of r)s[e.refId]=e;return s}function S(e){switch(e){case"mask":return p.JJ.Mask;case"maskAndTransparency":return p.JJ.MaskBlend;case"none":return p.JJ.Opaque;default:return p.JJ.Blend}}function E(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const A=new c.G(1,2,"wosr")},9512:(e,t,i)=>{"use strict";i.d(t,{Es:()=>g,I_:()=>d,W7:()=>m,qM:()=>_});var r=i(70375),s=i(67134),n=i(13802),o=i(52485),a=i(21414);const l=n.Z.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function c(e,t,i){let s="",n=0;for(;n<i;){const o=e[t+n];if(o<128)s+=String.fromCharCode(o),n++;else if(o>=192&&o<224){if(n+1>=i)throw new r.Z("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const a=(31&o)<<6|63&e[t+n+1];s+=String.fromCharCode(a),n+=2}else if(o>=224&&o<240){if(n+2>=i)throw new r.Z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const a=(15&o)<<12|(63&e[t+n+1])<<6|63&e[t+n+2];s+=String.fromCharCode(a),n+=3}else{if(!(o>=240&&o<248))throw new r.Z("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(n+3>=i)throw new r.Z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const a=(7&o)<<18|(63&e[t+n+1])<<12|(63&e[t+n+2])<<6|63&e[t+n+3];if(a>=65536){const e=55296+(a-65536>>10),t=56320+(1023&a);s+=String.fromCharCode(e,t)}else s+=String.fromCharCode(a);n+=4}}}return s}function u(e,t){const i={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let s=0;s<t.length;s++){const n=t[s],o=n.valueType||n.type,a=b[o];i.fields[n.property]=a(e,r),r+=v[o].BYTES_PER_ELEMENT}return i.byteCount=r,i}function h(e,t,i){const s=[];let n,o,a=0;for(o=0;o<e;o+=1){if(n=t[o],n>0){if(s.push(c(i,a,n-1)),0!==i[a+n-1])throw new r.Z("string-array-error","Invalid string array: missing null termination.")}else s.push(null);a+=n}return s}function d(e,t){return new(0,v[t.valueType])(e,t.byteOffset,t.count*t.valuesPerElement)}function p(e,t,i){const n=null!=t.header?u(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},o={header:n,byteOffset:n.byteCount,byteCount:0,entries:Object.create(null)};let a=n.byteCount;for(let e=0;e<t.ordering.length;e++){const i=t.ordering[e],l=(0,s.d9)(t[i]);if(l.count=n.fields.count,"String"===l.valueType){if(l.byteOffset=a,l.byteCount=n.fields[i+"ByteCount"],"UTF-8"!==l.encoding)throw new r.Z("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding})}else{if(!w(l.valueType))throw new r.Z("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const e=x(l.valueType);a+=a%e!=0?e-a%e:0,l.byteOffset=a,l.byteCount=e*l.valuesPerElement*l.count}}a+=l.byteCount,o.entries[i]=l}return o.byteCount=a-o.byteOffset,o}function f(e,t,i){if(t!==e&&l.error(`Invalid ${i} buffer size\n expected: ${e}, actual: ${t})`),t<e)throw new r.Z("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function m(e,t){const i=u(e,t&&t.header);let r=i.byteCount;const s={isDraco:!1,header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:{}},n=i.fields,o=null!=n.vertexCount?n.vertexCount:n.count;for(const e of t.ordering){if(!t.vertexAttributes[e])continue;const i={...t.vertexAttributes[e],byteOffset:r,count:o},n=y[e]?y[e]:"_"+e;s.vertexAttributes[n]=i,r+=x(i.valueType)*i.valuesPerElement*o}const a=n.faceCount;if(t.faces&&a){s.faces={};for(const e of t.ordering){if(!t.faces[e])continue;const i={...t.faces[e],byteOffset:r,count:a};s.faces[e]=i,r+=x(i.valueType)*i.valuesPerElement*a}}const l=n.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){s.featureAttributes={};for(const e of t.featureAttributeOrder){if(!t.featureAttributes[e])continue;const i={...t.featureAttributes[e],byteOffset:r,count:l};s.featureAttributes[e]=i,r+=("UInt64"===i.valueType?8:x(i.valueType))*i.valuesPerElement*l}}return f(r,e.byteLength,"geometry"),s.byteCount=r-s.byteOffset,s}function g(e,t){return e&&e.compressedAttributes&&"draco"===e.compressedAttributes.encoding?function(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e)switch(i){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}(e.compressedAttributes.attributes):e?function(e){return{isDraco:!1,isLegacy:!1,color:null!=e.color,normal:null!=e.normal,uv0:null!=e.uv0,uvRegion:null!=e.uvRegion,featureIndex:null!=e.faceRange&&null!=e.featureId}}(e):function(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e.ordering)if(e.vertexAttributes[i])switch(i){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}(t)}const y={position:a.T.POSITION,normal:a.T.NORMAL,color:a.T.COLOR,uv0:a.T.UV0,region:a.T.UVREGION};function _(e,t,i){if("lepcc-rgb"===e.encoding)return(0,o.IT)(t);if("lepcc-intensity"===e.encoding)return(0,o.ti)(t);if(null!=e.encoding&&""!==e.encoding)throw new r.Z("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(l.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(l.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const s=p(t,e,i);f(s.byteOffset+s.byteCount,t.byteLength,"attribute");const n=s.entries.attributeValues||s.entries.objectIds;if(n){if("String"===n.valueType){const e=s.entries.attributeByteCounts,i=d(t,e),r=function(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}(t,n);return h(e.count,i,r)}return d(t,n)}throw new r.Z("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const v={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},b={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function w(e){return v.hasOwnProperty(e)}function x(e){return w(e)?v[e].BYTES_PER_ELEMENT:0}},49979:(e,t,i)=>{"use strict";i.d(t,{c:()=>a,n:()=>l});var r=i(39100),s=i(8909),n=i(90472),o=i(25726);function a(e,t,i,s){const o=l(e,t,i),a=(0,r.c)();return(0,n.Bm)(i,o,a,s),a}function l(e,t,i){const r=(0,s.c)(),n=e[3],a=2**(4*Math.ceil(Math.log(n)*Math.LOG2E/4)+1);if(i.isGeographic){const t=a/(0,o.Iu)(i).radius*180/Math.PI,s=Math.round(e[1]/t),n=Math.max(-90,Math.min(90,s*t)),l=t/Math.cos((Math.abs(n)-t/2)/180*Math.PI),c=Math.round(e[0]/l)*l;r[0]=c,r[1]=n}else{const t=Math.round(e[0]/a),i=Math.round(e[1]/a);r[0]=t*a,r[1]=i*a}const l=e[2]+t,c=Math.round(l/a);return r[2]=c*a,r}},78565:(e,t,i)=>{"use strict";i.d(t,{Cx:()=>be,HV:()=>ae,Jf:()=>X,Jx:()=>Z,OJ:()=>J,T2:()=>$,VL:()=>Ce,WD:()=>Te,X5:()=>L,Yb:()=>F,a7:()=>re,bf:()=>G,c$:()=>xe,cr:()=>H,e8:()=>j,ei:()=>Y,gI:()=>ce,gn:()=>Q,hv:()=>N,ix:()=>oe,jv:()=>le,ns:()=>U,p8:()=>K,pD:()=>z,tS:()=>D,tp:()=>q,uC:()=>se,vH:()=>we,yS:()=>te,zW:()=>ee});var r=i(66341),s=i(7753),n=i(70375),o=i(39994),a=i(61681),l=i(78668),c=i(86098),u=i(1662),h=i(34344),d=i(24455),p=i(39100),f=i(10663),m=i(70347),g=i(61044),y=i(6766),_=i(8909),v=i(1983),b=i(90472),w=i(25726),x=i(14685),C=i(24568),T=i(35925),S=i(14136),E=i(65684),A=i(9512),M=i(49979),O=i(57180),R=i(66352),P=i(47850);function I(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function L(e){if((0,o.Z)("disable-feature:i3s-draco")||!e)return!1;for(const t of e)for(const e of t.geometryBuffers)if("draco"===e.compressedAttributes?.encoding)return!0;return!1}function D(e,t,i,r,s,n){const o=t!==r;s.traverse(i,(i=>{let s=i.mbs;return o&&(s=V,(0,b.st)(i.mbs,r,s,t)),H(e,s)!==z.OUTSIDE&&(n(i),!0)}))}function N(e,t,i){let r=0,s=0;for(let n=0;n<t.length&&r<e.length;n++)e[r]===t[n]&&(i(n)&&(e[s]=e[r],s++),r++);e.length=s}function F(e,t,i){let r=0,n=0;for(;r<i.length;)(0,s.$A)(e,i[r])>=0===t&&(i[n]=i[r],n++),r++;i.length=n}const k=(0,C.Ue)();function U(e,t){if(0===t.rotationScale[1]&&0===t.rotationScale[2]&&0===t.rotationScale[3]&&0===t.rotationScale[5]&&0===t.rotationScale[6]&&0===t.rotationScale[7])return k[0]=(e[0]-t.position[0])/t.rotationScale[0],k[1]=(e[1]-t.position[1])/t.rotationScale[4],k[2]=(e[2]-t.position[0])/t.rotationScale[0],k[3]=(e[3]-t.position[1])/t.rotationScale[4],k}const V=(0,v.c)();var z,B;function H(e,t){const i=t[0],r=t[1],s=t[3],n=e[0]-i,o=i-e[2],a=e[1]-r,l=r-e[3],c=Math.max(n,o,0),u=Math.max(a,l,0),h=c*c+u*u;return h>s*s?z.OUTSIDE:h>0?z.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?z.INSIDE:z.INTERSECTS_CENTER_INSIDE}function j(e,t,i){const r=[],s=i&&i.missingFields,n=i&&i.originalFields;for(const i of e){const e=i.toLowerCase();let o=!1;for(const s of t)if(e===s.name.toLowerCase()){r.push(s.name),o=!0,n&&n.push(i);break}!o&&s&&s.push(i)}return r}async function G(e,t,i,o,c){if(0===t.length)return[];const u=e.attributeStorageInfo;if((0,a.pC)(e.associatedLayer))try{return await async function(e,t,i,r){t.sort(((e,t)=>e.attributes[i]-t.attributes[i]));const s=t.map((e=>e.attributes[i])),n=[],o=j(r,e.fields,{originalFields:n}),a=await W(e,s,o);for(let e=0;e<t.length;e++){const i=t[e],r=a[e],s={};if(i.attributes)for(const e in i.attributes)s[e]=i.attributes[e];for(let e=0;e<n.length;e++)s[n[e]]=r[o[e]];i.attributes=s}return t}(e.associatedLayer,t,i,o)}catch(t){if(e.associatedLayer.loaded)throw t}if(u){const h=function(e,t,i){const r=new Map,s=[],n=i();for(const i of e){const e=i.attributes[t];for(let t=0;t<n.length;t++){const o=n[t],a=o.featureIds.indexOf(e);if(a>=0){let e=r.get(o.node);e||(e={node:o.node,indices:[],graphics:[]},s.push(e),r.set(o.node,e)),e.indices.push(a),e.graphics.push(i);for(let e=t;e>0;e--)n[e]=n[e-1];n[0]=o;break}}}return s}(t,i,c);if((0,a.Wi)(h))throw new n.Z("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const d=e.parsedUrl.path,p=await Promise.all(h.map((e=>function(e,t,i,s,n){const o=[];for(const r of t)if(r&&n.includes(r.name)){const t=`${e}/nodes/${i.resources.attributes}/attributes/${r.key}/0`;o.push({url:t,storageInfo:r})}return(0,l.as)(o.map((e=>(0,r.default)(e.url,{responseType:"array-buffer"}).then((t=>(0,A.qM)(e.storageInfo,t.data)))))).then((e=>{const t=[];for(const i of s){const r={};for(let t=0;t<e.length;t++)null!=e[t].value&&(r[o[t].storageInfo.name]=Z(e[t].value,i));t.push(r)}return t}))}(d,u,e.node,e.indices,o).then((t=>{for(let i=0;i<e.graphics.length;i++){const r=e.graphics[i],s=t[i];if(r.attributes)for(const e in r.attributes)e in s||(s[e]=r.attributes[e]);r.attributes=s}return e.graphics})))));return(0,s.xH)(p)}throw new n.Z("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function W(e,t,i){const r=e.capabilities.query.maxRecordCount;if(null!=r&&t.length>r){const n=(0,s.vr)(t,r);return Promise.all(n.map((t=>W(e,t,i)))).then(s.xH)}const o=new S.Z({objectIds:t,outFields:i,orderByFields:[e.objectIdField]});return e.queryFeatures(o).then((e=>{if(e&&e.features&&e.features.length===t.length)return e.features.map((e=>e.attributes));throw new n.Z("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")}))}function Z(e,t){if(!e)return null;const i=e[t];return(0,c.z3)(e)?-32768===i?null:i:(0,c.Hx)(e)?-2147483648===i?null:i:i!=i?null:i}function q(e){const t=e.store.indexCRS||e.store.geographicCRS,i=void 0===t?e.store.indexWKT:void 0;if(i){if(!e.spatialReference)throw new n.Z("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new n.Z("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new x.Z(I(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function $(e){const t=e.store.vertexCRS||e.store.projectedCRS,i=void 0===t?e.store.vertexWKT:void 0;if(i){if(!e.spatialReference)throw new n.Z("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new n.Z("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new x.Z(I(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function Y(e,t){return(0,a.Wi)(t)?"@null":t===(0,w.rS)(t)?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null}function X(e,t,i){if(!(0,b.Up)(e,t))throw new n.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===i&&!function(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}(e,t))throw new n.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function J(e,t,i){const r=q(e),s=$(e);X(r,t,i),X(s,t,i)}function K(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n.Z("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function Q(e,t){J(e,t.spatialReference,t.viewingMode)}function ee(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n.Z("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function te(e,t){X(e.spatialReference,t.spatialReference,t.viewingMode)}function ie(e){return"mesh-3d"===e.type}function re(e){if(null==e||!function(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;const t=e.getSymbols();if(0===t.length)return!0;for(const e of t){if(!ie(e)||0===e.symbolLayers.length)return!0;for(const t of e.symbolLayers.items)if("fill"!==t.type||(0,a.Wi)(t.material)||(0,a.Wi)(t.material.color)||"replace"!==t.material.colorMixMode)return!0}return!1}(B=z||(z={}))[B.OUTSIDE=0]="OUTSIDE",B[B.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",B[B.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",B[B.INSIDE=3]="INSIDE";const se=(0,O.$s)({color:[0,0,0,0],opacity:0});class ne{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function oe(e){const t=new ne;let i=!1,r=!1;for(const s of e.symbolLayers.items)if("fill"===s.type&&s.enabled){const e=s.material,n=s.edges;if((0,a.pC)(e)&&!i){const r=e.color,n=(0,R.F5)(e.colorMixMode);(0,a.pC)(r)?t.material={color:[r.r/255,r.g/255,r.b/255],alpha:r.a,colorMixMode:n}:t.material={color:[1,1,1],alpha:1,colorMixMode:R.a9.Multiply},t.castShadows=s.castShadows,i=!0}(0,a.pC)(n)&&!r&&(t.edgeMaterial=(0,O.C8)(n,{}),r=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:R.a9.Multiply}),t}function ae(e,t){return(0|e)+(0|t)|0}function le(e,t,i,r,s=0){r===(0,w.rS)(r)?t.isGeographic?function(e,t,i,r){const s=(0,w.Iu)(i),n=1+Math.max(0,r)/(s.radius+e.center[2]);(0,y.s)(t.center,e.center[0],e.center[1],e.center[2]+r),(0,b.CM)(t.center,i,0,t.center,(0,w.rS)(i),0,1),(0,f.a)(t.quaternion,e.quaternion),(0,f.c)(Ee,e.quaternion),(0,y.s)(Pe,0,0,1),(0,y.q)(Pe,Pe,Ee),(0,y.s)(Pe,e.halfSize[0]*Math.abs(Pe[0]),e.halfSize[1]*Math.abs(Pe[1]),e.halfSize[2]*Math.abs(Pe[2])),(0,y.g)(Pe,Pe,s.inverseFlattening),(0,y.a)(t.halfSize,e.halfSize,Pe),(0,y.g)(t.halfSize,t.halfSize,n)}(e,i,t,s):function(e,t,i,r){(0,P.$e)(e,Ae),(0,y.s)(t.center,e.center[0],e.center[1],e.center[2]+r),(0,b.Bm)(i,t.center,Se,(0,w.rS)(i)),(0,y.s)(t.center,Se[12],Se[13],Se[14]);const s=2*Math.sqrt(1+Se[0]+Se[5]+Se[10]);Ee[0]=(Se[6]-Se[9])/s,Ee[1]=(Se[8]-Se[2])/s,Ee[2]=(Se[1]-Se[4])/s,Ee[3]=.25*s,(0,f.m)(t.quaternion,Ee,e.quaternion),(0,f.c)(Ee,t.quaternion);let n=0,o=0,a=0;for(const e of Ae)e[2]+=r,(0,b.CM)(e,i,0,e,(0,w.rS)(i),0,1),(0,y.v)(Pe,e,t.center),(0,y.q)(Pe,Pe,Ee),n=Math.max(n,Math.abs(Pe[0])),o=Math.max(o,Math.abs(Pe[1])),a=Math.max(a,Math.abs(Pe[2]));(0,y.s)(t.halfSize,n,o,a)}(e,i,t,s):t.isWGS84&&(r.isWebMercator||(0,T.QM)(r))?function(e,t,i,r,s){(0,y.c)(ye,t.center),ye[2]+=s;const n=(0,w.rS)(i);(0,b.CM)(ye,e,0,ye,n,0,1),ve(n,t,ye,i,r)}(t,e,r,i,s):t.isWebMercator&&(0,T.QM)(r)?function(e,t,i,r,s){(0,y.c)(ye,t.center),ye[2]+=s,ve(e,t,ye,i,r)}(t,e,r,i,s):e===i?(i.center[2]+=s,(0,b.CM)(i.center,t,0,i.center,r,0,1)):((0,y.s)(i.center,e.center[0],e.center[1],e.center[2]+s),(0,b.CM)(i.center,t,0,i.center,r,0,1),(0,f.a)(i.quaternion,e.quaternion),(0,y.c)(i.halfSize,e.halfSize))}function ce(e,t,i,r,s){if((0,f.a)(s.quaternion,e.quaternion),r===E.JY.Global){(0,f.c)(pe,e.quaternion),(0,y.q)(ue,e.center,pe),(0,y.A)(he,ue),(0,y.B)(de,he,e.halfSize),(0,y.v)(de,he,de);const r=(0,y.l)(de);(0,y.a)(de,he,e.halfSize);const n=(0,y.l)(de);if(r<i)(0,y.c)(s.center,e.center),(0,y.s)(ue,i,i,i),(0,y.a)(s.halfSize,e.halfSize,ue);else{const o=n>0?1+t/n:1,a=r>0?1+i/r:1,l=(a+o)/2,c=(a-o)/2;(0,y.g)(s.halfSize,he,c),(0,y.C)(s.halfSize,s.halfSize,e.halfSize,l),(0,y.g)(s.center,he,l),(0,y.C)(s.center,s.center,e.halfSize,c),(0,y.D)(ue,ue),(0,y.E)(s.center,s.center,ue),(0,y.q)(s.center,s.center,s.quaternion)}}else{const r=(0,y.s)(ue,0,0,1);(0,y.C)(s.center,e.center,r,(i+t)/2),(0,f.c)(pe,e.quaternion),(0,y.q)(r,r,pe),(0,y.A)(r,r),(0,y.C)(s.halfSize,e.halfSize,r,(i-t)/2)}return s}const ue=(0,_.c)(),he=(0,_.c)(),de=(0,_.c)(),pe=(0,g.a)(),fe=new Float64Array(24),me={data:fe,size:3},ge=(0,_.c)(),ye=(0,_.c)(),_e=(0,h.c)();function ve(e,t,i,r,s){const n=(0,u.g)(_e,t.quaternion);for(let e=0;e<8;++e){for(let i=0;i<3;++i)ge[i]=t.halfSize[i]*(0!=(e&1<<i)?-1:1);for(let t=0;t<3;++t){let r=i[t];for(let e=0;e<3;++e)r+=ge[e]*n[3*e+t];fe[3*e+t]=r}}(0,b.CM)(fe,e,0,fe,r,0,8),(0,P.Qb)(me,s)}function be(e,t,i,r,s,n){if(!n||0===n.length||(0,a.Wi)(t))return null;const o=(0,M.c)(e.mbs,s,i,t);let l;(0,d.a)(Le,o);const c=()=>{if(!l)if(l=Ae,(0,C.cS)(Oe),(0,a.pC)(e.serviceObb)){le(e.serviceObb,i,Re,t,s),(0,P.$e)(Re,l);for(const e of l)(0,y.m)(e,e,Le),(0,C.Ho)(Oe,e)}else{const r=e.mbs,n=r[3];(0,b.SH)(r,i,Pe,t),(0,y.m)(Pe,Pe,Le),Pe[2]+=s;for(let e=0;e<8;++e){const t=1&e?n:-n,i=2&e?n:-n,r=4&e?n:-n,s=l[e];(0,y.c)(s,[Pe[0]+t,Pe[1]+i,Pe[2]+r]),(0,C.Ho)(Oe,s)}}};let u=1/0,h=-1/0;if(n.forEach((e=>(e=>{if("replace"!==e.type)return;const i=e.geometry;if(!i.hasZ)return;(0,C.cS)(Me);const s=i.spatialReference||r,n=i.rings.reduce(((e,i)=>i.reduce(((e,i)=>((0,b.SH)(i,s,Pe,t),(0,y.m)(Pe,Pe,Le),(0,C.Ho)(Me,Pe),Math.min(Pe[2],e))),e)),1/0);c(),(0,C.kK)(Oe,Me)&&(u=Math.min(u,n),h=Math.max(h,n))})(e))),u===1/0)return null;const p=(e,t,i)=>{(0,y.m)(Pe,i,o),e[t+0]=Pe[0],e[t+1]=Pe[1],e[t+2]=Pe[2],t+=24,i[2]=u,(0,y.m)(Pe,i,o),e[t+0]=Pe[0],e[t+1]=Pe[1],e[t+2]=Pe[2],t+=24,i[2]=h,(0,y.m)(Pe,i,o),e[t+0]=Pe[0],e[t+1]=Pe[1],e[t+2]=Pe[2]};for(let e=0;e<8;++e)p(Ie.data,3*e,l[e]);return(0,P.Qb)(Ie)}function we(e){return(0,a.pC)(e)&&e.halfSize[0]>=0}function xe(e){return e[3]>=0}function Ce(e){(0,a.pC)(e)&&(e.halfSize[0]=-1)}function Te(e){(0,a.pC)(e)&&(e[3]=-1)}const Se=(0,p.c)(),Ee=(0,m.c)(),Ae=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Me=(0,C.Ue)(),Oe=(0,C.Ue)(),Re=(0,P.Ue)(),Pe=[0,0,0],Ie={data:new Array(72),size:3},Le=(0,p.c)()},94576:(e,t,i)=>{"use strict";i.d(t,{G:()=>o,a:()=>n});var r=i(20757),s=i(66218);function n(e){return(0,s.nn)(e)&&e.intersector===r.q7.PCL&&!!e.target}function o(e){return(0,s.nn)(e)&&e.intersector===r.q7.I3S&&!!e.target}},52485:(e,t,i)=>{"use strict";i.d(t,{Gi:()=>a,IT:()=>h,ti:()=>p});var r=i(70375);const s=!0;function n(e,t,i){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,i+0,10)),version:t.getUint16(i+10,s),checksum:t.getUint32(i+12,s)}}function o(e,t){return{sizeLo:e.getUint32(t+0,s),sizeHi:e.getUint32(t+4,s),minX:e.getFloat64(t+8,s),minY:e.getFloat64(t+16,s),minZ:e.getFloat64(t+24,s),maxX:e.getFloat64(t+32,s),maxY:e.getFloat64(t+40,s),maxZ:e.getFloat64(t+48,s),errorX:e.getFloat64(t+56,s),errorY:e.getFloat64(t+64,s),errorZ:e.getFloat64(t+72,s),count:e.getUint32(t+80,s),reserved:e.getUint32(t+84,s)}}function a(e){const t=new DataView(e,0);let i=0;const{identifier:s,version:a}=n(e,t,i);if(i+=16,"LEPCC     "!==s)throw new r.Z("lepcc-decode-error","Bad identifier");if(a>1)throw new r.Z("lepcc-decode-error","Unknown version");const c=o(t,i);if(i+=88,c.sizeHi*2**32+c.sizeLo!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");const u=new Float64Array(3*c.count),h=[],d=[],p=[],f=[];if(i=l(e,i,h),i=l(e,i,d),i=l(e,i,p),i=l(e,i,f),i!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad length");let m=0,g=0;for(let e=0;e<h.length;e++){g+=h[e];let t=0;for(let i=0;i<d[e];i++){t+=p[m];const e=f[m];u[3*m]=Math.min(c.maxX,c.minX+2*c.errorX*t),u[3*m+1]=Math.min(c.maxY,c.minY+2*c.errorY*g),u[3*m+2]=Math.min(c.maxZ,c.minZ+2*c.errorZ*e),m++}}return{errorX:c.errorX,errorY:c.errorY,errorZ:c.errorZ,result:u}}function l(e,t,i){const r=[];t=c(e,t,r);const s=[];for(let n=0;n<r.length;n++){s.length=0,t=c(e,t,s);for(let e=0;e<s.length;e++)i.push(s[e]+r[n])}return t}function c(e,t,i){const n=new DataView(e,t),o=n.getUint8(0),a=31&o,l=!!(32&o),c=(192&o)>>6;let u=0;if(0===c)u=n.getUint32(1,s),t+=5;else if(1===c)u=n.getUint16(1,s),t+=3;else{if(2!==c)throw new r.Z("lepcc-decode-error","Bad count type");u=n.getUint8(1),t+=2}if(l)throw new r.Z("lepcc-decode-error","LUT not implemented");const h=Math.ceil(u*a/8),d=new Uint8Array(e,t,h);let p=0,f=0,m=0;const g=-1>>>32-a;for(let e=0;e<u;e++){for(;f<a;)p|=d[m]<<f,f+=8,m+=1;i[e]=p&g,p>>>=a,f-=a,f+a>32&&(p|=d[m-1]>>8-f)}return t+m}function u(e,t){return{sizeLo:e.getUint32(t+0,s),sizeHi:e.getUint32(t+4,s),count:e.getUint32(t+8,s),colorMapCount:e.getUint16(t+12,s),lookupMethod:e.getUint8(t+14),compressionMethod:e.getUint8(t+15)}}function h(e){const t=new DataView(e,0);let i=0;const{identifier:s,version:o}=n(e,t,i);if(i+=16,"ClusterRGB"!==s)throw new r.Z("lepcc-decode-error","Bad identifier");if(o>1)throw new r.Z("lepcc-decode-error","Unknown version");const a=u(t,i);if(i+=16,a.sizeHi*2**32+a.sizeLo!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");if((2===a.lookupMethod||1===a.lookupMethod)&&0===a.compressionMethod){if(3*a.colorMapCount+a.count+i!==e.byteLength||a.colorMapCount>256)throw new r.Z("lepcc-decode-error","Bad count");const t=new Uint8Array(e,i,3*a.colorMapCount),s=new Uint8Array(e,i+3*a.colorMapCount,a.count),n=new Uint8Array(3*a.count);for(let e=0;e<a.count;e++){const i=s[e];n[3*e]=t[3*i],n[3*e+1]=t[3*i+1],n[3*e+2]=t[3*i+2]}return n}if(0===a.lookupMethod&&0===a.compressionMethod){if(3*a.count+i!==e.byteLength||0!==a.colorMapCount)throw new r.Z("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(a.lookupMethod<=2&&1===a.compressionMethod){if(i+3!==e.byteLength||1!==a.colorMapCount)throw new r.Z("lepcc-decode-error","Bad count");const s=t.getUint8(i),n=t.getUint8(i+1),o=t.getUint8(i+2),l=new Uint8Array(3*a.count);for(let e=0;e<a.count;e++)l[3*e]=s,l[3*e+1]=n,l[3*e+2]=o;return l}throw new r.Z("lepcc-decode-error","Bad method "+a.lookupMethod+","+a.compressionMethod)}function d(e,t){return{sizeLo:e.getUint32(t+0,s),sizeHi:e.getUint32(t+4,s),count:e.getUint32(t+8,s),scaleFactor:e.getUint16(t+12,s),bitsPerPoint:e.getUint8(t+14),reserved:e.getUint8(t+15)}}function p(e){const t=new DataView(e,0);let i=0;const{identifier:s,version:o}=n(e,t,i);if(i+=16,"Intensity "!==s)throw new r.Z("lepcc-decode-error","Bad identifier");if(o>1)throw new r.Z("lepcc-decode-error","Unknown version");const a=d(t,i);if(i+=16,a.sizeHi*2**32+a.sizeLo!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");const l=new Uint16Array(a.count);if(8===a.bitsPerPoint){if(a.count+i!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");const t=new Uint8Array(e,i,a.count);for(let e=0;e<a.count;e++)l[e]=t[e]*a.scaleFactor}else if(16===a.bitsPerPoint){if(2*a.count+i!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");const t=new Uint16Array(e,i,a.count);for(let e=0;e<a.count;e++)l[e]=t[e]*a.scaleFactor}else{const t=[];if(c(e,i,t)!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");for(let e=0;e<a.count;e++)l[e]=t[e]*a.scaleFactor}return l}},43977:(e,t,i)=>{"use strict";var r,s;i.d(t,{L:()=>r,a:()=>s}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(s||(s={}))},57267:(e,t,i)=>{"use strict";i.d(t,{C:()=>o,E:()=>r});var r,s,n=i(24568);class o{constructor(e,t,i,s=null){this.lij=[0,0,0],this.extent=(0,n.Ue)(),this.resolution=0,this.loadPriority=0,this.measures={visibility:r.VISIBLE_ON_SURFACE,screenRect:(0,n.Ue)(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,t,i,s)}acquire(e,t,i,r){this.tilingScheme=r,this.id=o.id(e,t,i),this.lij[0]=e,this.lij[1]=t,this.lij[2]=i,r.getExtent(e,t,i,this.extent),this.resolution=r.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const t=this.lij[0]+1,i=2*this.lij[1],r=2*this.lij[2];return e?(e[0].acquire(t,i,r,this.tilingScheme),e[1].acquire(t,i+1,r,this.tilingScheme),e[2].acquire(t,i,r+1,this.tilingScheme),e[3].acquire(t,i+1,r+1,this.tilingScheme),e):[new o(t,i,r,this.tilingScheme),new o(t,i+1,r,this.tilingScheme),new o(t,i,r+1,this.tilingScheme),new o(t,i+1,r+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,(0,n.JG)(e.measures.screenRect,this.measures.screenRect)}static id(e,t,i){return`${e}/${t}/${i}`}}(s=r||(r={}))[s.INVISIBLE=0]="INVISIBLE",s[s.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",s[s.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"},57180:(e,t,i)=>{"use strict";i.d(t,{hM:()=>c,C8:()=>u,$s:()=>h,eU:()=>l});var r=i(30936),s=(i(39994),i(61681)),n=i(95550),o=i(1983),a=i(75427);function l(e){return e&&e.enabled&&("extrude"===e.type||function(e){return"fill"===e.type}(e))&&(0,s.pC)(e.edges)}function c(e,t){return u(function(e){return e&&e.enabled&&e.edges||null}(e),t)}function u(e,t){if((0,s.Wi)(e))return null;const i=(0,s.pC)(e.color)?(0,o.b)(r.Z.toUnitRGBA(e.color)):(0,o.f)(0,0,0,0),a=(0,n.F2)(e.size),l=(0,n.F2)(e.extensionLength);switch(e.type){case"solid":return h({color:i,size:a,extensionLength:l,...t});case"sketch":return c={color:i,size:a,extensionLength:l,...t},{...p,...c,type:"sketch"};default:return}var c}function h(e){return{...d,...e,type:"solid"}}const d={color:(0,o.f)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:a.i.OPAQUE,hasSlicePlane:!1},p={color:(0,o.f)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:a.i.OPAQUE,hasSlicePlane:!1}},59225:(e,t,i)=>{"use strict";i.d(t,{CM:()=>a,uM:()=>l,vT:()=>n});var r=i(61681),s=i(57741);const n=64,o=n/2,a=o/5;function l(e,t){return(0,r.pC)(t)?c(e,"diamond"===(i=t.style)?"kite":i):null;var i}function c(e,t){return e.fromData(t,(()=>(0,s.cU)(t,n,o,a)))}},66352:(e,t,i)=>{"use strict";i.d(t,{F5:()=>a,HB:()=>l,a9:()=>r});var r,s,n=i(19431),o=i(61681);function a(e){switch(e){case"multiply":default:return r.Multiply;case"ignore":return r.Ignore;case"replace":return r.Replace;case"tint":return r.Tint}}function l(e,t,i){if((0,o.Wi)(e)||t===r.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const s=(0,n.uZ)(Math.round(e[3]*u),0,u),a=0===s||t===r.Tint?0:t===r.Replace?h:d;i[0]=(0,n.uZ)(Math.round(e[0]*c),0,c),i[1]=(0,n.uZ)(Math.round(e[1]*c),0,c),i[2]=(0,n.uZ)(Math.round(e[2]*c),0,c),i[3]=s+a}(s=r||(r={}))[s.Multiply=1]="Multiply",s[s.Ignore=2]="Ignore",s[s.Replace=3]="Replace",s[s.Tint=4]="Tint";const c=255,u=85,h=u,d=2*u},62884:(e,t,i)=>{"use strict";i.d(t,{i:()=>o});var r=i(6766),s=i(8909),n=i(59934);class o{constructor(e){this.renderCoordsHelper=e,this.frustum=(0,n.Ue)(),this._points=(0,n.Hf)(),this.lines=new Array(12),this._origin=(0,s.c)(),this._direction=(0,s.c)(),this._altitude=null;for(let e=0;e<12;e++)this.lines[e]={origin:null,direction:(0,s.c)(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(e){(0,n.q_)(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),(0,r.c)(this._origin,e.eye),(0,r.c)(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let t=0;t<this._points.length;t++)(0,r.c)(this._points[t],e[t]);(0,n.Jp)(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return(0,n.hr)(this.frustum,e)}intersectsRay(e){return(0,n.Zr)(this.frustum,e)}intersectsLineSegment(e,t){return(0,n.rN)(this.frustum,e,t)}intersectsPoint(e){return(0,n.g8)(this.frustum,e)}_updateLines(){const e=this._points;for(let t=0;t<4;t++){const i=t+4;a(this.lines[t],e[t],e[i]),a(this.lines[t+4],e[t],3===t?e[0]:e[t+1]),a(this.lines[t+8],e[i],3===t?e[4]:e[i+1])}}}function a(e,t,i){e.origin=t,e.endpoint=i,(0,r.r)(e.direction,t,i)}o.planePointIndices=n.xu,o.nearFarLineIndices=[[n.NQ.NEAR_BOTTOM_LEFT,n.NQ.FAR_BOTTOM_LEFT],[n.NQ.NEAR_BOTTOM_RIGHT,n.NQ.FAR_BOTTOM_RIGHT],[n.NQ.NEAR_TOP_RIGHT,n.NQ.FAR_TOP_RIGHT],[n.NQ.NEAR_TOP_LEFT,n.NQ.FAR_TOP_LEFT]]},66143:(e,t,i)=>{"use strict";i.d(t,{Fb:()=>o,KO:()=>a,sb:()=>n});var r=i(61681),s=i(94486);class n{constructor(e,t=null,i=0){this.array=e,this.spatialReference=t,this.offset=i}}function o(e){return"array"in e}function a(e,t,i="ground"){if((0,s.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(o(t)){let s=t.offset;return e.getElevation(t.array[s++],t.array[s++],t.array[s]||0,(0,r.Pt)(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},79981:(e,t,i)=>{"use strict";i.d(t,{q:()=>w});var r=i(27755),s=i(19431),n=i(24455),o=i(39100),a=i(6766),l=i(8909),c=i(90472),u=i(25726),h=i(37116),d=i(24568),p=i(59934),f=i(56215),m=i(69430),g=i(97537),y=i(65684),_=i(18979);const v=.5*Math.PI,b=v/Math.PI*180;class w{constructor(e){this.renderCoordsHelper=e.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:(0,l.c)(),direction:(0,l.c)()};for(let e=0;e<4;e++)this.extent[e]={origin:(0,l.c)(),direction:(0,l.c)(),cap:{next:null,direction:(0,l.c)()}},this.planes[e]=(0,m.Ue)();this.planes[p.Nu.NEAR]=(0,m.Ue)(),this.planes[p.Nu.FAR]=(0,m.Ue)(),this.planesWithoutFar=this.planes.slice(0,5)}update(e,t,i,r=!0){const s=this.extent;this._toRenderBoundingExtent(e,t,i),(0,a.a)(this.center.origin,s[0].origin,s[2].origin),(0,a.g)(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),r||(0,a.g)(this.center.direction,this.center.direction,-1);for(let e=0;e<4;e++){const t=s[e];this.renderCoordsHelper.worldUpAtPosition(t.origin,t.direction);const i=s[3===e?0:e+1];t.cap.next=i.origin,(0,a.r)(t.cap.direction,t.origin,i.origin),(0,m.my)(t.direction,t.cap.direction,t.origin,this.planes[e]),r||(0,a.g)(t.direction,t.direction,-1)}(0,m.my)(s[0].cap.direction,s[1].cap.direction,s[0].origin,this.planes[p.Nu.NEAR]),r?(0,m.tk)(this.planes[p.Nu.NEAR],this.planes[p.Nu.FAR]):((0,m.JG)(this.planes[p.Nu.FAR],this.planes[p.Nu.NEAR]),(0,m.tk)(this.planes[p.Nu.NEAR],this.planes[p.Nu.NEAR])),this.maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this.maxSpanSpatialReference=t,this.minGlobalAltitude=.9*(0,u.Iu)(this.maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,i=!1){if(null==e)return!1;if(this.renderCoordsHelper.viewingMode===y.JY.Global){const i=this.maxSpanSpatialReference.isGeographic?b:v*t;if(this.maxSpan>i)return!0;if(e.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this.maxSpan){const t=this.extent[0];return!(i||!e.intersectsRay((0,g.re)(t.origin,t.direction)))}for(let t=0;t<this.extent.length;t++){const r=this.extent[t];if(!i&&e.intersectsRay((0,g.re)(r.origin,r.direction)))return!0;if(e.intersectsLineSegment((0,f.zk)(r.origin,r.cap.next,M),r.cap.direction))return!0}const r=i?this.planes:this.planesWithoutFar;for(let t=0;t<e.lines.length;t++){const i=e.lines[t];if((0,_.kD)(r,i.origin,i.endpoint,i.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,t,i){(0,d.be)(e,C),C[2]=i,(0,c.Bm)(t,C,T,this.renderCoordsHelper.spatialReference),(0,n.a)(S,T),(0,h.cS)(E);for(const{x0:r,x1:n,y0:o,y1:l}of x)for(let u=0;u<5;u++){const d=u/4;C[0]=(0,s.t7)(e[r],e[n],d),C[1]=(0,s.t7)(e[o],e[l],d),C[2]=i,(0,c.SH)(C,t,C,this.renderCoordsHelper.spatialReference),(0,a.m)(C,C,S),(0,h.pp)(E,C)}(0,a.s)(this.extent[0].origin,E[0],E[1],E[2]),(0,a.s)(this.extent[1].origin,E[3],E[1],E[2]),(0,a.s)(this.extent[2].origin,E[3],E[4],E[2]),(0,a.s)(this.extent[3].origin,E[0],E[4],E[2]);for(let e=0;e<4;++e)(0,a.m)(this.extent[e].origin,this.extent[e].origin,T)}_toRenderBoundingExtentLocal(e,t,i){(0,c.dH)(e,t,A,this.renderCoordsHelper.spatialReference),(0,a.s)(this.extent[0].origin,A[0],A[1],i),(0,a.s)(this.extent[1].origin,A[2],A[1],i),(0,a.s)(this.extent[2].origin,A[2],A[3],i),(0,a.s)(this.extent[3].origin,A[0],A[3],i)}_toRenderBoundingExtent(e,t,i){switch(this.renderCoordsHelper.viewingMode){case y.JY.Global:this._toRenderBoundingExtentGlobal(e,t,i);break;case y.JY.Local:this._toRenderBoundingExtentLocal(e,t,i);break;default:(0,r.Bg)(this.renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(e){if((0,m.jH)(e.planes[p.Nu.NEAR],this.center.origin)<0&&(0,a.e)(this.center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const i=this.extent[t];if((0,m.jH)(e.planes[p.Nu.NEAR],i.origin)<0&&(0,a.e)(i.direction,e.direction)<0)return!0}return!1}}const x=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],C=(0,l.c)(),T=(0,o.c)(),S=(0,o.c)(),E=(0,h.Ue)(),A=(0,d.Ue)(),M=(0,f.Ue)()},90139:(e,t,i)=>{"use strict";i.d(t,{L:()=>n});var r=i(2497),s=i(81509);class n{constructor(e,t){this.owner=t,this.properties={},this.afterDispatchHandle=null;for(const t in e){const i=e[t],s=new r.e(i,null,null,2,2);this.properties[t]={pool:s,acquired:[]}}this.afterDispatchHandle=(0,s.Fs)((()=>this._release()))}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const e in this.properties){const t=this.properties[e];for(const e of t.acquired)(0,s.NC)(e)||t.pool.release(e);t.pool.destroy(),t.pool=null,t.acquired=null}this.properties=null,this.owner=null}get(e){const t=this.owner._get(e),i=this.properties[e];let r=i.pool.acquire();for(i.acquired.push(r);r===t;)i.acquired.push(r),r=i.pool.acquire();return r}_release(){for(const e in this.properties){const t=this.properties[e];let i=0;for(const e of t.acquired)(0,s.NC)(e)?t.acquired[i++]=e:t.pool.release(e);t.acquired.length=i}}}},43180:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r=i(61681),s=i(17321),n=i(24455),o=i(6766),a=i(90472),l=i(14685),c=i(19546),u=i(47190),h=i(69430),d=i(68817),p=i(94486),f=i(65684),m=i(14029);class g{constructor(e,t,i,r){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=i,this.coordinateSystem=r,this._coordinateSystem=(0,u.Ue)(r)}set extent(e){e&&(0,u.qf)(this.coordinateSystem,e,this.coordinateSystem)}getAltitude(e){return(0,u.id)(this.coordinateSystem,e)}setAltitude(e,t,i=e){return(0,u.Is)(this.coordinateSystem,i,t,e)}setAltitudeOfTransformation(e,t){(0,u.rF)(this.coordinateSystem,t,e,t)}worldUpAtPosition(e,t){return(0,u.P0)(this.coordinateSystem,e,t)}worldBasisAtPosition(e,t,i){return(0,u.Kf)(this.coordinateSystem,e,t,i)}basisMatrixAtPosition(e,t){const i=this.worldBasisAtPosition(e,c.R.X,d.WM.get()),r=this.worldBasisAtPosition(e,c.R.Y,d.WM.get()),s=this.worldBasisAtPosition(e,c.R.Z,d.WM.get());return(0,n.s)(t,i[0],i[1],i[2],0,r[0],r[1],r[2],0,s[0],s[1],s[2],0,0,0,0,1),t}intersectManifoldClosestSilhouette(e,t,i){return(0,u.NE)(this.coordinateSystem,t,this._coordinateSystem),(0,u.ej)(this._coordinateSystem,e,i),i}intersectManifold(e,t,i){(0,u.NE)(this.coordinateSystem,t,this._coordinateSystem);const r=d.WM.get();return(0,u.BR)(this._coordinateSystem,e,r)?(0,o.c)(i,r):null}intersectInfiniteManifold(e,t,i){if(this.viewingMode===f.JY.Global)return this.intersectManifold(e,t,i);(0,u.NE)(this.coordinateSystem,t,this._coordinateSystem);const r=this._coordinateSystem.value,s=d.WM.get();return(0,h.BR)(r.plane,e,s)?(0,o.c)(i,s):null}toRenderCoords(e,t,i){return(0,p.f)(e)?(0,a.KC)(e,t,this.spatialReference):(0,a.SH)(e,t,i,this.spatialReference)}fromRenderCoords(e,t,i=null){return(0,p.f)(t)?((0,r.pC)(i)&&(t.spatialReference=i),(0,a.MT)(e,this.spatialReference,t)):t instanceof l.Z?(0,a.fA)(e,this.spatialReference,t):(0,a.SH)(e,this.spatialReference,t,i)?t:null}static create(e,t){switch(e){case f.JY.Local:return new g(f.JY.Local,t,(0,s.c9)(t),(0,u.pb)());case f.JY.Global:return new g(f.JY.Global,t,1,(0,u.pt)(t))}}static renderUnitScaleFactor(e,t){return y(e)/y(t)}}function y(e){if((0,m.D)(e,f.JY.Global))return 1;const t=(0,u.E2)(!1,e);return(0,s.c9)(t)}},51091:(e,t,i)=>{"use strict";i.d(t,{nN:()=>b,wu:()=>v});var r=i(36663),s=i(66341),n=i(53443),o=i(7753),a=i(70375),l=i(67134),c=i(61681),u=i(78668),h=i(81977),d=(i(7283),i(40266)),p=i(15095);class f{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}}class m{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new g}}class g{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class y{constructor(e,t,i,r){this._workerFunc=e,this._callbackFunc=t,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=r.map((e=>new m(e)))}hasQuota(e){const t=this._clients[e];return!!t&&(this._totalNumWorkers<this._maxTotalNumWorkers||t.numWorkers+t.tasks.length<t.typeWorkerQuota)}push(e){const t=this._clients[e.client];t&&(this._totalNumWorkers<this._maxTotalNumWorkers?(t.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,((e,t)=>this._taskCallback(e,t)))):t.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(e){const t=this._clients[e.client];this._totalNumWorkers--,t.numWorkers--,t.statistics.requests++,t.statistics.size+=e.size||0,t.statistics.duration+=e.duration||0,t.statistics.speed=t.statistics.duration>0?t.statistics.size/t.statistics.duration:0,(0,p.hu)(t.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),((e,t)=>this._taskCallback(e,t))))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,t){e._cancelled||(this._callbackFunc(e,t),this._taskFinished(e))}getStatsForType(e){const t=this._clients[e];return t?{quota:t.typeWorkerQuota,workers:t.numWorkers,queueSize:t.tasks.length,requestStats:t.statistics}:null}get test(){const e=this;return{set workerFunc(t){e._workerFunc=t}}}}var _=i(22167);let v=class extends n.Z{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new y(((e,t)=>this._startLoading(e,t)),((e,t)=>this._doneLoadingCB(e,t)),e,t),i&&(this._frameTask=i.registerTask(_.T8.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=(0,c.hw)(this._frameTask),this._tasks.forEach((e=>(0,c.IM)(e.abortController))),this._loadQueue=(0,c.SC)(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const s=(0,u.hh)();s.__signal=(0,c.pC)(r)?r.signal:null;const n=this._createOrUpdateTask(e,t,i,r,s);return(0,u.fu)(r,(()=>this._cancelRequest(n,s))),s.promise}_createTask(e,t,i,r,s,n){const o=new w(e,t,i,r,s);return this._updateTask(o,n),this._tasks.set(s,o),1===this._tasks.size&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){(0,o.e$)(e.resolvers,t),t.reject((0,u.zE)()),0===e.resolvers.length&&(e.status===x.DOWNLOADING&&(e.status=x.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=x.CANCELLED,this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){const n=function(e,t,i){return`${e}:${t}:${i}`}((0,c.pC)(r)&&r.uid||e,t,i),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&((0,p.hu)(e.status===x.DOWNLOADING),e.status=x.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();(0,u.k_)(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==x.DOWNLOADED&&(t.err=t.err||(0,u.zE)()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!(0,u.D_)(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)(0,u.D_)(t)?r.reject(t):r.reject(new a.Z("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const t=i<=0?e.result:(0,l.d9)(e.result);r.resolve(t)}this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1)}_startLoading(e,t){if(e.status===x.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=x.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=(0,s.default)(e.url,{...e.options,responseType:r,timeout:i,signal:n});let o=()=>{};const a=i=>{e.duration=performance.now()-e.startTime,e.size=i instanceof ArrayBuffer?i.byteLength:e.size||0,e.result=i,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},l=i=>{e.status===x.DOWNLOADING&&t(e,i),o()};return"image+type"!==e.docType?(e.request.then((e=>a(e.data)),l),!0):(e.request.then((t=>{const c=t.data,u=function(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return 137===t[0]&&80===t[1]?"image/png":71===t[0]&&73===t[1]?"image/gif":66===t[0]&&77===t[1]?"image/bmp":255===t[0]&&216===t[1]?"image/jpeg":"unknown"}(c);if(r="image",e.size=c.byteLength,"unknown"===u)return e.request=(0,s.default)(e.url,{responseType:r,timeout:i,signal:n}),void e.request.then((e=>a(e.data)),l);const h=new Blob([c],{type:u}),d=window.URL.createObjectURL(h);o=()=>window.URL.revokeObjectURL(d),e.request=(0,s.default)(d,{responseType:r,timeout:i,signal:n}),e.request.then((e=>a(new b(e.data,u,o))),l)}),l),!0)}get test(){return{loadQueue:this._loadQueue}}};(0,r._)([(0,h.Cb)({readOnly:!0})],v.prototype,"updating",void 0),v=(0,r._)([(0,d.j)("esri.views.3d.support.StreamDataLoader")],v);class b{constructor(e,t,i){this.image=e,this.type=t,this.release=i}get isOpaque(){return"image/jpeg"===this.type}}class w extends f{constructor(e,t,i,r,s){super(r),this.url=e,this.options=t,this.docType=i,this.key=s,this.result=null,this.status=x.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=0}}var x;!function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"}(x||(x={}))},44685:(e,t,i)=>{"use strict";i.d(t,{U$:()=>a});var r=i(81936),s=i(90331);class n{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const t of e.fieldNames){const i=e.fields.get(t);this[t]=new i.constructor(this.buffer,i.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const i=this[e];return i&&i.elementCount===t.ElementCount&&i.elementType===t.ElementType?i:null}slice(e,t){return new n(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t,i,r){const s=this.stride;if(s%4==0){const n=new Uint32Array(e.buffer,t*s,r*s/4);new Uint32Array(this.buffer,i*s,r*s/4).set(n)}else{const n=new Uint8Array(e.buffer,t*s,r*s);new Uint8Array(this.buffer,i*s,r*s).set(n)}}}class o{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,t){return this._appendField(e,r.Eu,t),this}vec2f64(e,t){return this._appendField(e,r.q6,t),this}vec3f(e,t){return this._appendField(e,r.ct,t),this}vec3f64(e,t){return this._appendField(e,r.fP,t),this}vec4f(e,t){return this._appendField(e,r.ek,t),this}vec4f64(e,t){return this._appendField(e,r.Cd,t),this}mat3f(e,t){return this._appendField(e,r.gK,t),this}mat3f64(e,t){return this._appendField(e,r.ey,t),this}mat4f(e,t){return this._appendField(e,r.bj,t),this}mat4f64(e,t){return this._appendField(e,r.O1,t),this}vec4u8(e,t){return this._appendField(e,r.mc,t),this}f32(e,t){return this._appendField(e,r.ly,t),this}f64(e,t){return this._appendField(e,r.oS,t),this}u8(e,t){return this._appendField(e,r.D_,t),this}u16(e,t){return this._appendField(e,r.av,t),this}i8(e,t){return this._appendField(e,r.Hz,t),this}vec2i8(e,t){return this._appendField(e,r.Vs,t),this}vec2i16(e,t){return this._appendField(e,r.or,t),this}vec2u8(e,t){return this._appendField(e,r.xA,t),this}vec4u16(e,t){return this._appendField(e,r.v6,t),this}u32(e,t){return this._appendField(e,r.Nu,t),this}_appendField(e,t,i){const r=t.ElementCount*(0,s.n1)(t.ElementType),n=this.stride;this.fields.set(e,{size:r,constructor:t,offset:n,optional:i}),this.stride+=r,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.includes(e)}createBuffer(e){return new n(this,e)}createView(e){return new n(this,e)}clone(){const e=new o;return e.stride=this.stride,e.fields=new Map,this.fields.forEach(((t,i)=>e.fields.set(i,t))),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}}function a(){return new o}},95397:(e,t,i)=>{"use strict";i.d(t,{K:()=>n});var r=i(91907),s=i(41163);function n(e,t=0){const i=e.stride;return e.fieldNames.filter((t=>{const i=e.fields.get(t).optional;return!(i&&i.glPadding)})).map((r=>{const n=e.fields.get(r),a=n.constructor.ElementCount,l=o(n.constructor.ElementType),c=n.offset,u=!(!n.optional||!n.optional.glNormalized);return new s.G(r,a,l,c,i,u,t)}))}function o(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:r.g.UNSIGNED_BYTE,u16:r.g.UNSIGNED_SHORT,u32:r.g.UNSIGNED_INT,i8:r.g.BYTE,i16:r.g.SHORT,i32:r.g.INT,f32:r.g.FLOAT}},26691:(e,t,i)=>{"use strict";i.d(t,{HL:()=>n,aj:()=>o});var r=i(81936),s=i(44685);function n(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:a(e.layout)}}function o(e){return function(e){const t=(0,s.U$)();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach((e=>t.fields.set(e[0],{...e[1],constructor:u(e[1].constructor)}))),t}(e.layout).createView(e.buffer)}function a(e){const t=new Array;return e.fields.forEach(((e,i)=>{const r={...e,constructor:c(e.constructor)};t.push([i,r])})),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}const l=[r.ly,r.Eu,r.ct,r.ek,r.gK,r.bj,r.oS,r.q6,r.fP,r.Cd,r.ey,r.O1,r.D_,r.xA,r.ne,r.mc,r.av,r.TS,r.mw,r.v6,r.Nu,r.qt,r.G5,r.hu,r.Hz,r.Vs,r.P_,r.ir,r.o7,r.or,r.n1,r.zO,r.Jj,r.wA,r.PP,r.TN];function c(e){return`${e.ElementType}_${e.ElementCount}`}function u(e){return h.get(e)}const h=new Map;l.forEach((e=>h.set(c(e),e)))},3289:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(36663),s=i(53443),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266));let a=class extends s.Z{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,r._)([(0,n.Cb)()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"LABELS_SHOW_BORDER",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"TEXT_SHOW_BASELINE",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"TEXT_SHOW_BORDER",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"SHOW_POI",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"LINE_WIREFRAMES",void 0),a=(0,r._)([(0,o.j)("esri.views.3d.support.DebugFlags")],a);const l=new a},76557:(e,t,i)=>{"use strict";i.d(t,{G:()=>a,O:()=>o});var r=i(61681),s=i(8909),n=i(90472);function o(e,t,i){if((0,r.Wi)(e)||(0,r.Wi)(i))return!1;let s=!0;return l[0]=null!=e.xmin?e.xmin:0,l[1]=null!=e.ymin?e.ymin:0,l[2]=null!=e.zmin?e.zmin:0,s=s&&(0,n.CM)(l,e.spatialReference,0,t,i,0,1),l[0]=null!=e.xmax?e.xmax:0,l[1]=null!=e.ymax?e.ymax:0,l[2]=null!=e.zmax?e.zmax:0,s=s&&(0,n.CM)(l,e.spatialReference,0,t,i,3,1),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),s}function a(e,t,i){if((0,r.Wi)(e)||(0,r.Wi)(i))return!1;let s=!0;return l[0]=null!=e.xmin?e.xmin:0,l[1]=null!=e.ymin?e.ymin:0,l[2]=null!=e.zmin?e.zmin:0,s=s&&(0,n.CM)(l,e.spatialReference,0,l,i,0,1),t[0]=l[0],t[1]=l[1],l[0]=null!=e.xmax?e.xmax:0,l[1]=null!=e.ymax?e.ymax:0,l[2]=null!=e.zmax?e.zmax:0,s=s&&(0,n.CM)(l,e.spatialReference,0,l,i,0,1),t[2]=l[0],t[3]=l[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),s}const l=(0,s.c)()},40460:(e,t,i)=>{"use strict";i.d(t,{Bh:()=>c,eW:()=>h,iE:()=>u,u4:()=>l});var r=i(61681),s=i(95550),n=i(55709),o=i(6766),a=i(68817);function l(e,t,i){return c(e,e.screenToRender(t,(0,s.Wv)(a.WM.get())),i)}function c(e,t,i){const l=(0,s.Wv)((0,n.c)(a.WM.get(),t));if(l[2]=0,!e.unprojectFromRenderScreen(l,i.origin))return null;const c=(0,s.Wv)((0,n.c)(a.WM.get(),t));c[2]=1;const u=e.unprojectFromRenderScreen(c,a.WM.get());return(0,r.Wi)(u)?null:((0,o.b)(i.direction,u,i.origin),i)}function u(e,t,i){return h(e,e.screenToRender(t,(0,s.Wv)(a.WM.get())),i)}function h(e,t,i){(0,o.c)(i.origin,e.eye);const s=(0,o.s)(a.WM.get(),t[0],t[1],1),n=e.unprojectFromRenderScreen(s,a.WM.get());return(0,r.Wi)(n)?null:((0,o.b)(i.direction,n,i.origin),i)}},25024:(e,t,i)=>{"use strict";var r;i.d(t,{Bh:()=>r,NT:()=>n,Ty:()=>s}),function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"}(r||(r={}));const s=(()=>{const e=new Array;return e[r.ELEVATION]=10,e[r.BASEMAP]=10,e[r.I3S_INDEX]=10,e[r.I3S_DATA]=10,e[r.SYMBOLOGY]=5,e})(),n=30},18979:(e,t,i)=>{"use strict";i.d(t,{W8:()=>l,kD:()=>a});var r=i(69666),s=i(6766),n=i(8909),o=i(69430);function a(e,t,i,r){return function(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let i=0;i<e.length;i++)if(!u(e[i],t,r))return!1;return!0}(e,t,i,function(e,t,i,r){const n=c;return e?(i&&r&&(n.len=(0,s.i)(t,i)),(0,s.c)(n.dir,e)):r?(n.len=(0,s.i)(t,i),(0,s.b)(n.dir,i,t),(0,s.g)(n.dir,n.dir,1/n.len)):((0,s.b)(n.dir,i,t),(0,s.n)(n.dir,n.dir)),n}(r,t,i,!0))}function l(e,t,i,r){const n=(0,s.e)(i,(0,s.b)(e,r,t));return(0,s.a)(e,t,(0,s.g)(e,i,n))}const c={dir:(0,n.c)(),len:0,clip:(0,r.a)()};function u(e,t,i){const r=(0,s.e)((0,o.mJ)(e),i.dir),n=-(0,o.jH)(e,t);if(n<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return n>0;if((n<0||r<0)&&!(n<0&&r<0))return!0;const a=n/r;return r>0?a<i.clip[1]&&(i.clip[1]=a):a>i.clip[0]&&(i.clip[0]=a),i.clip[0]<=i.clip[1]}},35369:(e,t,i)=>{"use strict";i.d(t,{EU:()=>p,T:()=>l,ZA:()=>h,_F:()=>c,bX:()=>u,ek:()=>d,mw:()=>a,pG:()=>m,u1:()=>o,uV:()=>f});var r=i(19431),s=i(6766),n=i(8909);function o(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function a(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),n=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return(0,s.s)(e,i,r,n),e}function l(e,t,i){i=i||e;const r=(0,s.e)(e,t);(0,s.s)(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),(0,s.n)(i,i)}function c(e,t,i){Math.abs(e[0])>Math.abs(e[1])?(0,s.s)(t,0,1,0):(0,s.s)(t,1,0,0),(0,s.f)(i,e,t),(0,s.n)(t,t),(0,s.f)(t,i,e),(0,s.n)(i,i)}function u(e,t,i,r,s,n){const o=e+(t-e)*s;return o+(i+(r-i)*s-o)*n}function h(e,t,i,r=(0,n.c)()){const o=(0,s.l)(e),a=(0,s.l)(t),l=(0,s.e)(e,t)/(o*a);if(l<.9999999999999999){const n=Math.acos(l),c=((1-i)*o+i*a)/Math.sin(n),u=c/o*Math.sin((1-i)*n),h=c/a*Math.sin(i*n);return(0,s.g)(v,e,u),(0,s.g)(b,t,h),(0,s.a)(r,v,b)}return(0,s.h)(r,e,t,i)}function d(e,t,i,r=(0,n.c)(),o=(0,n.c)()){const a=(0,s.l)(e),l=(0,s.l)(t),c=(0,s.e)(e,t)/(a*l);if(c<.9999999999999999){const n=Math.acos(c),u=Math.sin(n),h=Math.sin(i*n),d=Math.sin((1-i)*n),p=(1-i)*a+i*l;{const i=p/u,n=i/l*h;(0,s.g)(v,e,i/a*d),(0,s.g)(b,t,n),(0,s.a)(r,v,b)}{const r=1/a*(-Math.cos((1-i)*n)*n*p+d*(-a+l));(0,s.g)(v,e,r);const c=1/l*(Math.cos(i*n)*n*p+h*(-a+l));(0,s.g)(b,t,c),(0,s.a)(o,v,b),(0,s.g)(o,o,1/u)}return o}return(0,s.h)(r,e,t,i),(0,s.b)(o,t,e),(0,s.n)(o,o),o}function p(e,t,i){e=(0,s.n)(v,e),t=(0,s.n)(b,t);const n=(0,r.ZF)((0,s.e)(e,t));if(i){const r=(0,s.f)(_,e,t);if((0,s.e)(r,i)<0)return-n}return n}function f(e){const t=e.length;return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const s=e[r-1][0],n=e[r][0],o=(n-i)/(n-s);return o*e[r-1][1]+(1-o)*e[r][1]}}function m(e,t,i,r){(0,s.b)(g,t,e),(0,s.b)(y,i,e),(0,s.f)(r,g,y),(0,s.n)(r,r),r[3]=-(0,s.e)(e,r)}const g=(0,n.c)(),y=(0,n.c)(),_=(0,n.c)(),v=(0,n.c)(),b=(0,n.c)()},47850:(e,t,i)=>{"use strict";i.d(t,{JF:()=>de,d9:()=>fe,Qb:()=>ge,$e:()=>Te,Ue:()=>pe,fn:()=>xe,hZ:()=>ye,pn:()=>we,n3:()=>be,JH:()=>ve,xz:()=>Ce,q0:()=>Se,t8:()=>me,mr:()=>_e});var r=i(1662),s=i(34344),n=i(10663),o=i(70347),a=i(61044),l=i(6766),c=i(79912),u=i(8909),h=(i(88589),i(1983)),d=i(37116),p=i(69430);const f=1e-6,m=[0,0,0],g=[0,0,0];function y(e,t,i,r,s,n,o,a,l,c){return function(e,t,i){let r=oe(e.maxVert[0],e.minVert[0]),s=0;for(let t=1;t<7;++t){const i=oe(e.maxVert[t],e.minVert[t]);i>r&&(r=i,s=t)}ie(t,e.minVert[s]),ie(i,e.maxVert[s])}(e,r,s),oe(r,s)<f?1:(ee(o,r,s),se(o,o),function(e,t,i,r){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let e=0;e<s.length;e+=n){A[0]=s[e]-t[0],A[1]=s[e+1]-t[1],A[2]=s[e+2]-t[2];const r=i[0]*A[0]+i[1]*A[1]+i[2]*A[2],n=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=A[0]*A[0]+A[1]*A[1]+A[2]*A[2]-r*r/n;l>o&&(o=l,a=e)}return ie(r,s,a),o}(t,r,o,n)<f?2:(ee(a,s,n),se(a,a),ee(l,n,r),se(l,l),re(i,a,o),se(i,i),N(t,i,o,a,l,c),0))}const _=[0,0,0],v=[0,0,0],b=[0,0,0],w=[0,0,0],x=[0,0,0],C=[0,0,0],T=[0,0,0],S=[0,0,0];function E(e,t,i,r,s,n,o,a,l){(function(e,t,i,r,s){!function(e,t,i,r,s){const{data:n,size:o}=e;ie(r,n),ie(s,r),i[0]=ae(F,t),i[1]=i[0];for(let e=o;e<n.length;e+=o){const o=n[e]*t[0]+n[e+1]*t[1]+n[e+2]*t[2];o<i[0]&&(i[0]=o,ie(r,n,e)),o>i[1]&&(i[1]=o,ie(s,n,e))}}(e,t,M,s,r);const n=ae(i,t);M[1]-f<=n&&(r[0]=void 0),M[0]+f>=n&&(s[0]=void 0)})(e,t,i,_,v),void 0!==_[0]&&(ee(b,_,i),se(b,b),ee(w,_,r),se(w,w),ee(x,_,s),se(x,x),re(C,w,n),se(C,C),re(T,x,o),se(T,T),re(S,b,a),se(S,S),N(e,C,n,w,b,l),N(e,T,o,x,w,l),N(e,S,a,b,x,l)),void 0!==v[0]&&(ee(b,v,i),se(b,b),ee(w,v,r),se(w,w),ee(x,v,s),se(x,x),re(C,w,n),se(C,C),re(T,x,o),se(T,T),re(S,b,a),se(S,S),N(e,C,n,w,b,l),N(e,T,o,x,w,l),N(e,S,a,b,x,l))}const A=[0,0,0],M=[0,0],O=[0,0,0],R=[0,0,0],P=[0,0,0],I=[0,0,0],L=[0,0,0],D=[0,0,0];function N(e,t,i,r,s,n){if(ne(t)<f)return;re(O,i,t),re(R,r,t),re(P,s,t),k(e,t,M),L[1]=M[0],I[1]=M[1],D[1]=I[1]-L[1];const o=[i,r,s],a=[O,R,P];for(let i=0;i<3;++i){k(e,o[i],M),L[0]=M[0],I[0]=M[1],k(e,a[i],M),L[2]=M[0],I[2]=M[1],D[0]=I[0]-L[0],D[2]=I[2]-L[2];const r=K(D);r<n.quality&&(ie(n.b0,o[i]),ie(n.b1,t),ie(n.b2,a[i]),n.quality=r)}}const F=[0,0,0];function k(e,t,i){const{data:r,size:s}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<r.length;e+=s){const s=r[e]*t[0]+r[e+1]*t[1]+r[e+2]*t[2];i[0]=Math.min(i[0],s),i[1]=Math.max(i[1],s)}}function U(e,t,i){ie(i.center,e),te(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const V=[0,0,0],z=[0,0,0],B=[0,0,0],H=[0,0,0],j=[0,0,0],G=[0,0,0];function W(e,t,i,r,s,n){k(e,t,M),s[0]=M[0],n[0]=M[1],k(e,i,M),s[1]=M[0],n[1]=M[1],k(e,r,M),s[2]=M[0],n[2]=M[1]}const Z=[0,0,0],q=[1,0,0,0,1,0,0,0,1],$=[0,0,0];function Y(e,t,i,r,s,n,o){q[0]=e[0],q[1]=e[1],q[2]=e[2],q[3]=t[0],q[4]=t[1],q[5]=t[2],q[6]=i[0],q[7]=i[1],q[8]=i[2],function(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const r=(i+1)%3,s=(i+2)%3;let n=Math.sqrt(t[3*i+i]-t[3*r+r]-t[3*s+s]+1);e[i]=.5*n,n=.5/n,e[3]=(t[3*r+s]-t[3*s+r])*n,e[r]=(t[3*r+i]+t[3*i+r])*n,e[s]=(t[3*s+i]+t[3*i+s])*n}}(o.quaternion,q),Q($,r,s),te($,$,.5),te(o.center,e,$[0]),te(Z,t,$[1]),Q(o.center,o.center,Z),te(Z,i,$[2]),Q(o.center,o.center,Z),te(o.halfSize,n,.5)}class X{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let e=0;e<7;++e)this.minVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.maxVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.minProj[e]=Number.POSITIVE_INFINITY,this.maxProj[e]=Number.NEGATIVE_INFINITY;const i=new Array(7),r=new Array(7),{data:s,size:n}=e;for(let e=0;e<s.length;e+=n){let t=s[e];t<this.minProj[0]&&(this.minProj[0]=t,i[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,r[0]=e),t=s[e+1],t<this.minProj[1]&&(this.minProj[1]=t,i[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,r[1]=e),t=s[e+2],t<this.minProj[2]&&(this.minProj[2]=t,i[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,r[2]=e),t=s[e]+s[e+1]+s[e+2],t<this.minProj[3]&&(this.minProj[3]=t,i[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,r[3]=e),t=s[e]+s[e+1]-s[e+2],t<this.minProj[4]&&(this.minProj[4]=t,i[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,r[4]=e),t=s[e]-s[e+1]+s[e+2],t<this.minProj[5]&&(this.minProj[5]=t,i[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,r[5]=e),t=s[e]-s[e+1]-s[e+2],t<this.minProj[6]&&(this.minProj[6]=t,i[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,r[6]=e)}for(let e=0;e<7;++e){let t=i[e];ie(this.minVert[e],s,t),t=r[e],ie(this.maxVert[e],s,t)}}}class J{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function K(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function Q(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function ee(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function te(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function ie(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function re(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o}function se(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function ne(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function oe(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function ae(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}const le=(0,a.a)(),ce=(0,u.c)(),ue=(0,u.c)(),he=((0,h.c)(),(0,s.c)());class de{constructor(e){const t=56*e;this.buffer=new ArrayBuffer(t),this.obbs=new Array(e);for(let t=0;t<e;t++)this.obbs[t]={center:(0,u.b)(this.buffer,56*t+0),halfSize:(0,c.b)(this.buffer,56*t+24),quaternion:(0,o.b)(this.buffer,56*t+36)}}}function pe(e=[0,0,0],t=[-1,-1,-1],i=[0,0,0,1]){return{center:(0,u.a)(e),halfSize:(0,c.a)(t),quaternion:(0,o.a)(i)}}function fe(e){return pe(e.center,e.halfSize,e.quaternion)}function me(e,t){(0,l.c)(t.center,e.center),(0,l.c)(t.halfSize,e.halfSize),(0,n.a)(t.quaternion,e.quaternion)}function ge(e,t){return function(e,t){const{data:i,size:r}=e,s=i.length/r;if(s<=0)return;const n=new X(e);Q(m,n.minProj,n.maxProj),te(m,m,.5),ee(g,n.maxProj,n.minProj);const o=K(g),a=new J;a.quality=o,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],d=[0,0,0],p=[0,0,0],_=[0,0,0];switch(y(n,e,_,l,c,u,h,d,p,a)){case 1:return void U(m,g,t);case 2:return void function(e,t,i){ie(V,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?V[0]=0:Math.abs(t[1])>Math.abs(t[2])?V[1]=0:V[2]=0,ne(V)<f&&(V[0]=V[1]=V[2]=1),re(z,t,V),se(z,z),re(B,t,z),se(B,B),W(e,t,z,B,H,j),ee(G,j,H),Y(t,z,B,H,j,G,i)}(e,h,t)}E(e,_,l,c,u,h,d,p,a),W(e,a.b0,a.b1,a.b2,H,j);const v=[0,0,0];ee(v,j,H),a.quality=K(v),a.quality<o?Y(a.b0,a.b1,a.b2,H,j,v,t):U(m,g,t)}(e,t=t||pe()),t}function ye(e,t){const i=(0,p.jH)(t,e.center),r=Ce(e,(0,p.mJ)(t));return i>r?1:i<-r?-1:0}function _e(e,t){t||(t=(0,d.Ue)());const i=(0,r.g)(he,e.quaternion),s=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),n=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),o=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-s,t[1]=e.center[1]-n,t[2]=e.center[2]-o,t[3]=e.center[0]+s,t[4]=e.center[1]+n,t[5]=e.center[2]+o,t}function ve(e,t){return(0,p.jH)(t,e.center)-Ce(e,(0,p.mJ)(t))}function be(e,t){return(0,p.jH)(t,e.center)+Ce(e,(0,p.mJ)(t))}function we(e,t){return ye(e,t[0])<=0&&ye(e,t[1])<=0&&ye(e,t[2])<=0&&ye(e,t[3])<=0&&ye(e,t[4])<=0&&ye(e,t[5])<=0}function xe(e,t,i,r=0){(0,n.c)(le,e.quaternion),(0,l.b)(ce,t,e.center);const s=(0,l.q)(ce,ce,le),o=(0,l.q)(ue,i,le);let a=-1/0,c=1/0;for(let t=0;t<3;t++)if(Math.abs(o[t])>1e-6){const i=(r+e.halfSize[t]-s[t])/o[t],n=(-r-e.halfSize[t]-s[t])/o[t];a=Math.max(a,Math.min(i,n)),c=Math.min(c,Math.max(i,n))}else if(s[t]>e.halfSize[t]+r||s[t]<-e.halfSize[t]-r)return!1;return a<=c}function Ce(e,t){(0,n.c)(le,e.quaternion),(0,l.q)(ce,t,le);const i=e.halfSize;return Math.abs(ce[0]*i[0])+Math.abs(ce[1]*i[1])+Math.abs(ce[2]*i[2])}function Te(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],(0,l.q)(r,r,e.quaternion),(0,l.a)(r,r,e.center)}}function Se(e){return(0,l.u)(e.halfSize)}(()=>{const e=new Int8Array(162);let t=0;const i=i=>{for(let r=0;r<i.length;r++)e[t+r]=i[r];t+=6};i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4])})()},57686:(e,t,i)=>{"use strict";i.d(t,{V:()=>r,q:()=>s});const r={value:.5,readOnly:!0},s={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}}},87564:(e,t,i)=>{"use strict";i.d(t,{T:()=>n,j:()=>o});var r=i(20757),s=i(66218);function n(e){return(0,s.nn)(e)&&e.intersector===r.q7.TERRAIN&&!!e.target}function o(e){return(0,s.nn)(e)&&e.intersector===r.q7.OVERLAY&&!!e.target}},62093:(e,t,i)=>{"use strict";i.d(t,{$e:()=>r,Jk:()=>h,aV:()=>u});var r,s,n=i(19431),o=i(24568),a=i(9812),l=i(70984),c=i(58781);(s=r||(r={}))[s.None=0]="None",s[s.ColorAndWater=1]="ColorAndWater",s[s.Highlight=2]="Highlight",s[s.Occluded=3]="Occluded";class u{constructor(e,t){this.index=e,this.renderTargets=t,this._extent=(0,o.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,c.al)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new d,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=e===r.ColorAndWater?this.renderTargets.getTarget(a.NH.Color):e===r.Highlight?this.renderTargets.getTarget(a.NH.Highlight):this.renderTargets.getTarget(a.NH.Occluded);return t?t.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(a.NH.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(a.NH.Color):null}getNormalTexture(e){const t=e===r.ColorAndWater?this.renderTargets.getTarget(a.NH.Water):null;return t?t.getTexture():null}draw(e,t){const i=this.computeRenderTargetValidityBitfield();for(const i of this.renderTargets.renderTargets)i.type!==a.NH.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[i.type]=e.drawTarget(this,i,t):this.validTargets[i.type]=!1;return i^this.computeRenderTargetValidityBitfield()?l.Yg.CHANGED:l.Yg.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[a.NH.Color]|+e[a.NH.ColorNoRasterImage]<<1|+e[a.NH.Highlight]<<2|+e[a.NH.Water]<<3|+e[a.NH.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,o.cv)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,o.cv)(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,o.JG)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===a.fu.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function h(e,t,i){return Math.min((0,n.Sf)(Math.max(e,t)+256),i)}class d{constructor(){this.extents=[(0,o.Ue)(),(0,o.Ue)(),(0,o.Ue)()],this.numViews=0}}},99608:(e,t,i)=>{"use strict";i.d(t,{Rn:()=>te,CB:()=>Y,Qi:()=>ie});var r=i(36663),s=i(53443),n=i(31355),o=i(44584),a=i(86114),l=i(61681),c=i(17135),u=i(76868),h=i(19784),d=i(81977),p=(i(7753),i(39994),i(7283),i(40266)),f=i(24455),m=i(8909),g=i(65684),y=i(43977),_=i(3289),v=i(9812),b=i(62093),w=i(55542),x=i(91907),C=i(18567);class T{constructor(e,t){this.size=(0,w.c)(),this._fbo=null,this._fbo=new C.X(e,{colorTarget:x.Lm.TEXTURE,depthStencilTarget:x.OU.NONE},{target:x.No.TEXTURE_2D,pixelFormat:x.VI.RGBA,dataType:x.Br.UNSIGNED_BYTE,wrapMode:x.e8.CLAMP_TO_EDGE,samplingMode:x.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=(0,l.O3)(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){this._fbo?.resize(0,0)}get gpuMemoryUsage(){return this._fbo?.gpuMemoryUsage??0}}var S=i(38208);class E{constructor(e){const t=(t,i,r=!0)=>({type:i,fbo:new T(e,r),renderPass:t,valid:!1,lastUsed:1/0});this.renderTargets=[t(S.C.MATERIAL,v.NH.Color),t(S.C.MATERIAL,v.NH.ColorNoRasterImage),t(S.C.MATERIAL_HIGHLIGHT,v.NH.Highlight,!1),t(S.C.MATERIAL_NORMAL,v.NH.Water),t(S.C.MATERIAL,v.NH.Occluded)]}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,i){if(e)t.lastUsed=i;else if(i-t.lastUsed>A)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce(((e,t)=>e+t.fbo.gpuMemoryUsage),0)}}const A=1e3;var M=i(18841),O=i(93718),R=i(70984),P=i(18435),I=i(55982),L=i(62039),D=i(53464),N=i(7358),F=i(4051),k=i(46378),U=i(80876),V=i(65075),z=i(5198),B=i(22635),H=i(46240),j=i(23627),G=i(79503),W=i(42199),Z=i(22167),q=i(43487),$=i(62486);let Y=class extends((0,O.TF)(s.Z)){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new o.Z,this._frameTask=Z.sq,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new c.Z,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new n.Z,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new G.h(e.renderingContext),this._shaderTechniqueRepository=new M.M({rctx:this._rctx,viewingMode:g.JY.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new F.Y(this._rctx,new U.l(this._rctx,this.view.state.viewingMode),new z.L(this._shaderTechniqueRepository,this._rctx,(()=>{}))),this._handles.add([(0,u.YP)((()=>t.updating),(()=>this.events.emit("content-changed")),u.tX),(0,u.YP)((()=>this.spatialReference),(e=>this._localOriginFactory=new D.C(e)),u.tX),(0,u.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materialRepository=new I.h(e.textureRepository,this._shaderTechniqueRepository,(e=>{(e.renderOccluded&ie)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=k.r.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=(0,L.hf)(this._rctx),this._bindParameters.camera=ee,this._bindParameters.transparencyPassType=R.Am.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new j.Mi((0,m.f)(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(Z.T8.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach((e=>e.destroy())),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=(0,l.RY)(this._debugTextureTechnique),this._debugPatternTexture=(0,l.O3)(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=(0,l.O3)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=(0,l.O3)(this._shaderTechniqueRepository),this._temporaryFBO=(0,l.O3)(this._temporaryFBO),this._quadVAO=(0,l.O3)(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||(0,a.oE)(this._drapeSourceRenderers,(e=>e.updating))}get hasOverlays(){return(0,l.pC)(this._overlays)&&(0,l.pC)(this._overlayRenderTarget)}get gpuMemoryUsage(){return(0,l.pC)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,V.S)}createDrapeSourceRenderer(e,t,i){const r=this._drapeSourceRenderers.get(e);(0,l.pC)(r)&&r.destroy();const s=new t({...i,rendererContext:this,drapeSource:e});return this._drapeSourceRenderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add((0,u.YP)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),s}removeDrapeSourceRenderer(e){if((0,l.Wi)(e))return;const t=this._drapeSourceRenderers.get(e);(0,l.Wi)(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if((0,l.pC)(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return(0,l.Pt)(this._overlays,[])}ensureDrapeTargets(e){(0,l.pC)(this._overlays)&&this._overlays.forEach((t=>{t.hasTargetWithoutRasterImage=(0,h.f)(e,(e=>e.drapeTargetType===y.a.WithoutRasterImage))}))}ensureDrapeSources(e){(0,l.pC)(this._overlays)&&this._overlays.forEach((t=>{t.hasDrapedFeatureSource=(0,h.f)(e,(e=>e.drapeSourceType===y.L.Features)),t.hasDrapedRasterSource=(0,h.f)(e,(e=>e.drapeSourceType===y.L.RasterImage))}))}ensureOverlays(e,t){(0,l.Wi)(this._overlays)&&(this._overlayRenderTarget=new E(this._rctx),this._overlays=[new b.aV(v.fu.INNER,this._overlayRenderTarget),new b.aV(v.fu.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=(0,l.O3)(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=(()=>!0)){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let i=!1;for(const[r,s]of this._drapeSourceRenderers){if(e.done)break;(r.destroyed||t(r))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),i&&((0,l.pC)(this._overlays)&&0===this._drapeSourceRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Z.G5,(e=>e.updatePolicy===R.jq.SYNC))}isEmpty(){if(_.Z.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach((i=>t=i.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(0===r.numViews)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=t.renderPass;if(this.isEmpty()||s===S.C.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===S.C.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const c=this._rctx;ee.pixelRatio=e.pixelRatio*i,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===S.C.MATERIAL_NORMAL?k.r.DRAPED_WATER:k.r.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(c),e.index===v.fu.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(x.lk.COLOR_BUFFER_BIT));const u=t.type===v.NH.ColorNoRasterImage?X.ExcludeRasterImage:t.type===v.NH.Occluded?X.OccludedOnly:X.Normal;if(u===X.OccludedOnly&&(this._renderContext.renderOccludedMask=ie),_.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&u!==X.OccludedOnly)for(let t=0;t<r.numViews;t++)this._setViewParameters(r.extents[t],e,ee),this._drawDebugTexture(e.resolution,Q[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll((({drapeSource:t,renderer:i})=>{if(u===X.ExcludeRasterImage&&t.drapeSourceType===y.L.RasterImage)return;const{fullOpacity:h}=t,d=(0,l.pC)(h)&&h<1&&s===S.C.MATERIAL;d&&(this.bindTemporaryFramebuffer(this._rctx,o,a),c.clearSafe(x.lk.COLOR_BUFFER_BIT));for(let t=0;t<r.numViews;t++)this._setViewParameters(r.extents[t],e,ee),i.render(this._renderContext,this._bindParameters);d&&(0,l.pC)(this._temporaryFBO)&&(n.bind(c),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),W.Fv.PremultipliedAlpha,h,W.v3.OverlayWithTransparency,e.index))})),c.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){(0,l.Wi)(this._temporaryFBO)&&(this._temporaryFBO=new T(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){let s=0;for(const n of this._drapeSourceRenderers.values())s=n.intersect?.(e,t,i,r,s)??s}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty)return;if(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),0===this._drapeSourceRenderers.size)return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach(((t,i)=>{const r=e.indexOf(i.layer);this._sortedDrapeSourceRenderers.push(new K(i,t,r<0?1/0:r))})),this._sortedDrapeSourceRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,(0,f.q)(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),(0,f.f)(i.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=i}_updateHasWater(){const e=(0,a.oE)(this._drapeSourceRenderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=(0,a.oE)(this._drapeSourceRenderers,(e=>e.hasHighlights));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=(0,a.oE)(this._drapeSourceRenderers,(e=>e.rendersOccluded));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.bindTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture("tex",this._debugPatternTexture),i.bindVAO(this._quadVAO),i.drawArrays(x.MX.TRIANGLE_STRIP,0,(0,$._V)(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let s=0;s<t;s++)for(let n=0;n<e;n++){const o=Math.floor(n/10),a=Math.floor(s/10);o<2||a<2||10*o>e-20||10*a>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&o&&1&a?1&n^1&s?0:255:1&o^1&a?0:128)}this._debugPatternTexture=new q.x(this._rctx,{target:x.No.TEXTURE_2D,pixelFormat:x.VI.RGBA,dataType:x.Br.UNSIGNED_BYTE,samplingMode:x.cw.NEAREST,width:e,height:t},i);const s=new H.V;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(B.K,s),this._quadVAO=(0,L.ow)(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var X,J;(0,r._)([(0,d.Cb)()],Y.prototype,"_frameTask",void 0),(0,r._)([(0,d.Cb)()],Y.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,r._)([(0,O.gT)()],Y.prototype,"_shaderTechniqueRepository",void 0),(0,r._)([(0,O.gT)()],Y.prototype,"_stippleTextureRepository",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],Y.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],Y.prototype,"worldToPCSRatio",void 0),(0,r._)([(0,d.Cb)()],Y.prototype,"spatialReference",void 0),(0,r._)([(0,d.Cb)({type:Boolean,readOnly:!0})],Y.prototype,"updating",null),Y=(0,r._)([(0,p.j)("esri.views.3d.terrain.OverlayRenderer")],Y),(J=X||(X={}))[J.Normal=0]="Normal",J[J.OccludedOnly=1]="OccludedOnly",J[J.ExcludeRasterImage=2]="ExcludeRasterImage";class K{constructor(e,t,i){this.drapeSource=e,this.renderer=t,this.index=i}}const Q=[[1,.5,.5],[.5,.5,1]],ee=new P.V;ee.near=1,ee.far=1e4,ee.relativeElevation=null;const te=-2,ie=N.yD.OccludeAndTransparent},52003:(e,t,i)=>{"use strict";i.d(t,{H:()=>l});var r=i(61681),s=i(28624),n=i(91907),o=i(10054);const a={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class l{constructor(e,t,i=null,r=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=t,this.width=i||t.width,this.height=r||t.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=(0,r.O3)(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...a,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||a}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){(0,r.pC)(e)&&e.length>0?this._bandIds&&e.every(((e,t)=>!!this._bandIds[t]&&e===this._bandIds[t]))||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,(0,r.pC)(this._rasterTexture)){const t=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode("bilinear"===t?n.cw.LINEAR:n.cw.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=(0,r.O3)(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&(((0,r.Wi)(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(e,this.bandIds),(0,r.pC)(this._rasterTexture)&&(this._updateColormapTexture(e),this.transformGrid&&(0,r.Wi)(this._transformGridTexture)&&(this._transformGridTexture=(0,o.Br)(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:t,width:i,height:r,opacity:n}=this,a=(0,o.Tc)(t,[i,r],[this.source.width,this.source.height],n),l=(0,o.Ue)(e.colormap,e.colormapOffset),c="stretch"===this.symbolizerParameters.type?(0,o.xW)(this.symbolizerParameters):null,u="hillshade"===this.symbolizerParameters.type?(0,o.Fm)(this.symbolizerParameters):null;return new s.C(a,l,c||u,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if((0,r.Wi)(this._memoryUsed)){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map((e=>(0,r.pC)(e)?e.descriptor.width*e.descriptor.height*4:0)).reduce(((e,t)=>e+t),0)}return this._memoryUsed}release(){return this._rasterTexture=(0,r.O3)(this._rasterTexture),this._transformGridTexture=(0,r.O3)(this._transformGridTexture),this._colormapTexture=(0,r.O3)(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,t){const i=this.source?this.source.extractBands(t):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=(0,r.O3)(this._rasterTexture));const s=(0,r.Wi)(t)&&(0,r.Wi)(this.bandIds)||(0,r.pC)(t)&&(0,r.pC)(this.bandIds)&&t.join("")===this.bandIds.join("");if((0,r.pC)(this._rasterTexture)&&s)return;this._rasterTexture=(0,r.O3)(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=(0,o.s9)(e,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType}_getRasterTextureInterpolation(e){return"lut"===this.symbolizerParameters.type||"nearest"===e||"majority"===e?"nearest":"bilinear"}_updateColormapTexture(e){const t=this._colormap,i=this.symbolizerParameters.colormap;return i?t?i.length!==t.length||i.some(((e,i)=>e!==t[i]))?(this._colormapTexture=(0,r.O3)(this._colormapTexture),this._colormapTexture=(0,o.iC)(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=(0,o.iC)(e,i),void(this._colormap=i)):(this._colormapTexture=(0,r.O3)(this._colormapTexture),void(this._colormap=null))}}},54565:(e,t,i)=>{"use strict";i.d(t,{$7:()=>c,$r:()=>o,DR:()=>l,HB:()=>a,L:()=>h,Lz:()=>p,Sx:()=>u,Tg:()=>f,Vs:()=>g,cy:()=>d,iU:()=>m});var r=i(19431),s=i(24568),n=i(56545);const o=64,a=512,l=2.5,c=(0,r.oK)(r._3/10),u=4,h=e=>e<4?3:4,d=(0,s.Ue)();n.t.WebMercatorAuxiliarySphere.getExtent(0,0,0,d);const p=(0,s.Ue)([-180,-90,180,90]),f="Cannot extend surface to encompass all layers because it would result in too many root tiles.",m="Surface extent is too large for tile resolution at level 0.",g=8},56545:(e,t,i)=>{"use strict";i.d(t,{_:()=>m,t:()=>f});var r=i(70375),s=i(19431),n=i(61681),o=i(17321),a=i(91772),l=i(90472),c=i(14685),u=i(24568),h=i(35925),d=i(39536),p=i(81590);class f{constructor(e){const t=f.checkUnsupported(e);if((0,n.pC)(t))throw t;const i=(0,n.Wg)(e);this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=(0,l.jF)(this.spatialReference)||(0,h.BZ)(this.spatialReference)||(0,h.V2)(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const r=i.lods.reduce(((e,t,i)=>(t.level<e.min&&(e.min=t.level,e.minIndex=i),e.max=Math.max(e.max,t.level),e)),{min:1/0,minIndex:0,max:-1/0}),s=i.lods[r.minIndex],o=2**s.level;let a=s.resolution*o,c=s.scale*o;this.levels=new Array(r.max+1);for(let e=0;e<this.levels.length;e++)this.levels[e]={resolution:a,scale:c,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,c/=2}clone(){return new f(this.toTileInfo())}toTileInfo(){return new p.Z({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((e,t)=>({level:t,scale:e.scale,resolution:e.resolution})))})}getExtent(e,t,i,r){const s=this.levels[e],n=s.tileSize[0],o=s.tileSize[1];r[0]=this.origin[0]+i*n,r[2]=this.origin[0]+(i+1)*n,r[3]=this.origin[1]-t*o,r[1]=this.origin[1]-(t+1)*o}convertExtentToRadians(e,t){this._isWebMercator?(t[0]=(0,d.tp)(e[0]),t[1]=(0,d.mZ)(e[1]),t[2]=(0,d.tp)(e[2]),t[3]=(0,d.mZ)(e[3])):this._isGCS&&(t[0]=(0,s.Vl)(e[0]),t[1]=(0,s.Vl)(e[1]),t[2]=(0,s.Vl)(e[2]),t[3]=(0,s.Vl)(e[3]))}getExtentGeometry(e,t,i,r=new a.Z){return this.getExtent(e,t,i,g),r.spatialReference=this.spatialReference,r.xmin=g[0],r.ymin=g[1],r.xmax=g[2],r.ymax=g[3],r.zmin=void 0,r.zmax=void 0,r}ensureMaxLod(e){if(null==e)return!1;let t=!1;for(;this.levels.length<=e;){const e=this.levels[this.levels.length-1],i=e.resolution/2;this.levels.push({resolution:i,scale:e.scale/2,tileSize:[i*this.pixelSize,i*this.pixelSize]}),t=!0}return t}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof f)){if(f.checkUnsupported(e))return!1;e=new f(e)}if(!e.spatialReference.equals(this.spatialReference))return!1;if(e.pixelSize!==this.pixelSize)return!1;const t=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[t].resolution;let r=.5*i;return!(!(0,s.W8)(e.origin[0],this.origin[0],r)||!(0,s.W8)(e.origin[1],this.origin[1],r))&&(r=.5*i/2**t/this.pixelSize*12,(0,s.W8)(i,e.levels[t].resolution,r))}rootTilesInExtent(e,t=null,i=1/0){const r=new Array,s=this.levels[0].tileSize;if((0,n.Wi)(e)||0===s[0]||0===s[1])return r;f.computeRowColExtent(e,s,this.origin,g);let o=g[1],a=g[3],l=g[0],c=g[2];const u=c-l,h=a-o;if(u*h>i){const e=Math.floor(Math.sqrt(i));h>e&&(o=o+Math.floor(.5*h)-Math.floor(.5*e),a=o+e),u>e&&(l=l+Math.floor(.5*u)-Math.floor(.5*e),c=l+e)}for(let e=o;e<a;e++)for(let t=l;t<c;t++)r.push([0,e,t]);return(0,n.pC)(t)&&(t[0]=this.origin[0]+l*s[0],t[1]=this.origin[1]-a*s[1],t[2]=this.origin[0]+c*s[0],t[3]=this.origin[1]-o*s[1]),r}static computeRowColExtent(e,t,i,r){const s=.001*(e[2]-e[0]+(e[3]-e[1]));r[0]=Math.max(0,Math.floor((e[0]+s-i[0])/t[0])),r[2]=Math.max(0,Math.ceil((e[2]-s-i[0])/t[0])),r[1]=Math.max(0,Math.floor((i[1]-e[3]+s)/t[1])),r[3]=Math.max(0,Math.ceil((i[1]-e[1]-s)/t[1]))}static isPowerOfTwo(e){const t=e.lods,i=t[0].resolution*2**t[0].level;return!t.some((e=>!(0,s.Y8)(e.resolution,i/2**e.level)))}static hasGapInLevels(e){const t=e.lods.map((e=>e.level));t.sort(((e,t)=>e-t));for(let e=1;e<t.length;e++)if(t[e]!==t[0]+e)return!0;return!1}static tileSizeSupported(e){const t=e.size[1];return t===e.size[0]&&0==(t&t-1)&&t>=128&&t<=512}static hasOriginPerLODs(e){const t=e.origin;return e.lods.some((e=>null!=e.origin&&(e.origin[0]!==t.x||e.origin[1]!==t.y)))}static getMissingTileInfoError(){return new r.Z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return(0,n.Wi)(e)?m():e.lods.length<1?new r.Z("tilingscheme:generic","Tiling scheme must have at least one level"):f.isPowerOfTwo(e)?f.hasGapInLevels(e)?new r.Z("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):f.tileSizeSupported(e)?f.hasOriginPerLODs(e)?new r.Z("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new r.Z("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new r.Z("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,t){const i=e[2]-e[0],r=e[3]-e[1],s=(0,o.c9)(t),n=1.2*Math.max(i,r),a=256,l=new f(new p.Z({size:[a,a],origin:{x:e[0]-.5*(n-i),y:e[3]+.5*(n-r)},lods:[{level:0,resolution:n/a,scale:1/(a/96*.0254/(n*s))}],spatialReference:t}));return l.ensureMaxLod(20),l}static makeWebMercatorAuxiliarySphere(e){const t=new f(f.WebMercatorAuxiliarySphereTileInfo);return t.ensureMaxLod(e),t}static makeGCSWithTileSize(e,t=256,i=16){const r=256/t,s=new f(new p.Z({size:[t,t],origin:{x:-180,y:90,spatialReference:e},spatialReference:e,lods:[{level:0,resolution:.703125*r,scale:295497598.570834*r}]}));return s.ensureMaxLod(i),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function m(){return new r.Z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}f.WebMercatorAuxiliarySphereTileInfo=new p.Z({size:[256,256],origin:{x:-20037508.342787,y:20037508.342787,spatialReference:c.Z.WebMercator},spatialReference:c.Z.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527.591555}]}),f.WebMercatorAuxiliarySphere=f.makeWebMercatorAuxiliarySphere(19);const g=(0,u.Ue)()},9812:(e,t,i)=>{"use strict";var r,s,n,o,a,l;i.d(t,{NH:()=>a,Ns:()=>l,VB:()=>o,Xo:()=>n,fu:()=>r,tk:()=>s}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(r||(r={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(s||(s={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(n||(n={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(o||(o={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(a||(a={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(l||(l={}))},13809:(e,t,i)=>{"use strict";i.d(t,{XJ:()=>A,er:()=>q,RB:()=>O,E_:()=>$,Fp:()=>M,TK:()=>k,Eu:()=>ie,_1:()=>N,CY:()=>F,sR:()=>P,Ay:()=>B,GL:()=>U,Mw:()=>se,wt:()=>ee,x4:()=>R,L4:()=>G,uv:()=>re,wP:()=>V,xk:()=>z,z7:()=>j,FH:()=>I,Q:()=>L,Ke:()=>H,OD:()=>te,_0:()=>Q,cA:()=>oe,OC:()=>ne,$v:()=>J,_F:()=>K,z4:()=>W,Bu:()=>X,FZ:()=>Z,jO:()=>Y,wu:()=>E});var r=i(41831),s=i(27755),n=i(61681),o=i(35925),a=i(54957),l=i(65684),c=i(51091),u=i(9812),h=i(70375),d=i(6766),p=i(8909),f=i(90472),m=i(24568),g=i(54565),y=i(56545);const _=(0,p.c)(),v=(0,p.c)(),b=(0,p.c)(),w=(0,p.c)();function x(e,t,i,r){(0,d.c)(_,i),_[r]=t[r];const s=(0,d.b)(_,_,t),n=(0,d.b)(v,e,t),o=(0,d.e)(n,s),a=(0,d.e)(s,s);let l;l=o<=0?t:a<=o?i:(0,d.a)(_,t,(0,d.g)(s,s,o/a));const c=(0,d.b)(_,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}const C=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:function(e,t,i=0){const r=e.extent;if((0,n.Wi)(r))return!1;if(0===i)return(0,m.BD)(r,t);const s=Math.min(r[2]-r[0],r[3]-r[1]);return(0,m.Zm)(r,t,i*s)},tiltToExtentEdge:function(e,t,i){const r=e.extent;if((0,n.Wi)(r))return 0;b[0]=r[0],b[1]=r[1],b[2]=i,w[0]=r[2],w[1]=r[3],w[2]=i;let s=1/0,o=1/0;return t[0]<b[0]?s=x(t,b,w,0):t[0]>w[0]&&(s=x(t,w,b,0)),t[1]<b[1]?o=x(t,b,w,1):t[1]>w[1]&&(o=x(t,w,b,1)),Math.min(s,o)},checkIfTileInfoSupportedForViewSR:function(e,t,i){if((0,n.Wi)(e))return(0,y._)();if(e.spatialReference.isGeographic&&!(0,f.jF)(e.spatialReference))return new h.Z("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=y.t.checkUnsupported(e);if((0,n.pC)(r))return r;if((0,n.Wi)(i))return new h.Z("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=function(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,s=[r*e.size[0],r*e.size[1]],n=[e.origin.x,e.origin.y],o=(0,m.oJ)(t),a=(0,m.Ue)();y.t.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>g.$r){const t=i[0].scale*2**i[0].level;let s=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*t/r;const n=Math.floor(Math.log(s)/Math.log(10));return s=Math.ceil(s/10**n)*10**n,new h.Z("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(t).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+s.toLocaleString()+".",{level0Scale:t,suggestedLevel0Scale:s,requiredNumRootTiles:l,allowedNumRootTiles:g.$r})}return null}(e,i);if(s)return s;const o=e.spatialReference;return(0,n.pC)(t)&&!(o.equals(t)||t.isWGS84&&o.isWebMercator)?new h.Z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}},Symbol.toStringTag,{value:"Module"})),T=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:function(){return!0},tiltToExtentEdge:function(){return 0},checkIfTileInfoSupportedForViewSR:function(e,t){if((0,n.Wi)(e))return(0,y._)();const i=e.lods.length-1,r=e.spatialReference,s=(0,f.jF)(r)||(0,o.BZ)(r)||(0,o.V2)(r);if(r.isWebMercator){if(!y.t.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new h.Z("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new h.Z("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!y.t.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new h.Z("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new h.Z("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return(0,n.pC)(t)&&!e.spatialReference.equals(t)?new h.Z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}},Symbol.toStringTag,{value:"Module"})),S={[l.JY.Global]:T,[l.JY.Local]:C};function E(e,t){e||console.warn("Terrain: "+t)}let A=!1;function M(e,t){}function O(e){return P(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function R(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function P(e){return"imagery-tile-3d"===e?.type}function I(e){return"tile-3d"===e?.type}function L(e){return"vector-tile-3d"===e?.type}function D(e){return"wmts-3d"===e?.type}function N(e){return"elevation-3d"===e?.type}function F(e){return"group"===e?.type}function k(e){return e&&(I(e)||D(e)||P(e)||L(e))}function U(e){return e&&(I(e)||P(e)||L(e)||D(e))}function V(e){return U(e)||N(e)}function z(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return(0,s.Bg)(e.type),!1}}function B(e){const t=e?.sourceLayerInfo?.data;return(0,n.pC)(t)&&"type"in t&&"raster-tile"===t.type}function H(e){const t=e?.sourceLayerInfo?.data;return(0,n.pC)(t)&&"type"in t&&"vector-tile"===t.type}function j(e){const t=e?.sourceLayerInfo?.data;return(0,n.pC)(t)&&"type"in t&&"tile-texture"===t.type}function G(e){const t=e?.sourceLayerInfo?.data;return t instanceof HTMLImageElement||t instanceof c.nN||t instanceof HTMLCanvasElement||t instanceof ImageData}function W(e){return(0,n.pC)(e)&&"release"in e&&e.release(),null}function Z(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function q(e,t,i,r){return S[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function $(e,t,i){let s=null,o=null;if("wmts"===e?.type){const l=function(e,t,i){const s=(0,a.mt)(e);if((0,n.pC)(s)){if(!r.Z.isCollection(s))return{tileInfo:s.tileInfo,fullExtent:s.fullExtent};{const e=s.find((e=>null==q(e.tileInfo,e.fullExtent,t,i)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}(e,t,i);s=l.tileInfo,o=l.fullExtent}else{o=R(e)?e.getCompatibleFullExtent(t):e.fullExtent;const r=i===l.JY.Local;if(R(e))s=e.getCompatibleTileInfo(t,o,r);else if("vector-tile"===e?.type){const i=r&&!Y(t)||X.force512VTL,n=e.tileInfo.spatialReference.isGeographic;s=i?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,n?1:2)}else s=e.tileInfo}return(0,n.pC)(s)&&(0,n.pC)(o)&&null==q(s,o,t,i)?{tileInfo:s,fullExtent:o}:null}function Y(e){return e.isWGS84||e.isWebMercator||(0,o.yW)(e)||!(0,o.N$)(e)}const X={force512VTL:!1};function J(e){return e===u.Xo.NORTH_EAST?u.Xo.SOUTH_WEST:e===u.Xo.NORTH_WEST?u.Xo.SOUTH_EAST:e===u.Xo.SOUTH_WEST?u.Xo.NORTH_EAST:u.Xo.NORTH_WEST}function K(e){return e===u.Xo.NORTH?u.Xo.SOUTH:e===u.Xo.EAST?u.Xo.WEST:e===u.Xo.SOUTH?u.Xo.NORTH:u.Xo.EAST}function Q(e){return e===u.Xo.NORTH_WEST||e===u.Xo.SOUTH_WEST}function ee(e){return e===u.Xo.NORTH_WEST||e===u.Xo.NORTH_EAST}function te(e){return e===u.Xo.NORTH_WEST||e===u.Xo.WEST||e===u.Xo.SOUTH_WEST}function ie(e){return e===u.Xo.NORTH_EAST||e===u.Xo.EAST||e===u.Xo.SOUTH_EAST}function re(e){return e===u.Xo.SOUTH_EAST||e===u.Xo.SOUTH||e===u.Xo.SOUTH_WEST}function se(e){return e===u.Xo.NORTH_EAST||e===u.Xo.NORTH||e===u.Xo.NORTH_WEST}const ne=[u.Xo.NORTH,u.Xo.EAST,u.Xo.SOUTH,u.Xo.WEST],oe=[u.Xo.NORTH_EAST,u.Xo.SOUTH_EAST,u.Xo.SOUTH_WEST,u.Xo.NORTH_WEST]},30220:(e,t,i)=>{"use strict";i.d(t,{AA:()=>n,E9:()=>f,QT:()=>d,b:()=>h,dF:()=>u,rv:()=>o,t8:()=>p,yf:()=>a,zW:()=>c});var r=i(61681),s=i(17135);class n{constructor(){this._queue=new s.Z,this._last=null,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=null}reset(e=null){this._queue.clear(),(0,r.pC)(e)&&this._queue.pushArray(e),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class o{constructor(){this.q=new s.Z}get done(){return 0===this.q.length}reset(e){if(this.q.clear(),!(0,r.Wi)(e)){this.q.pushArray(e);for(let e=0;e<this.q.length;++e){const t=this.q.data[e];t.isLeaf||this.q.pushArray(t.children)}}}next(){return this.q.pop()}}function a(e,t,i){if((0,r.Wi)(t)||(0,r.Wi)(t.fullExtent))return!1;const s=t.fullExtent,n=e.extent;if(i){if(n[0]<s.xmin||n[1]<s.ymin||n[2]>s.xmax||n[3]>s.ymax)return!1}else if(s.xmin>n[2]||s.ymin>n[3]||s.xmax<n[0]||s.ymax<n[1])return!1;const o=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&o>1.00000001*t.minScale||t.maxScale>0&&o<.99999999*t.maxScale)}function l(e,t){return e.lij[0]-t.lij[0]||e.lij[1]-t.lij[1]||e.lij[2]-t.lij[2]}function c(e,t){t.sort(((t,i)=>u(t,i,e)))}function u(e,t,i){const r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:l(e,t)}function h(e,t){const i=new Map;e.forAll((e=>i.set(e.lij,e.distanceToSquared(t)))),e.sort(((e,t)=>i.get(e.lij)-i.get(t.lij)||l(e,t)))}function d(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),0==(1&e.lij[1])&&(n+=.5),null==(e=e.parent))throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function p(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let e=0;e<4;e++){const t=r.children[e];if(t&&t!==i&&t.loadable)return!0}}return!1}function f(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}},15318:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r,c:()=>a});var r,s,n=i(36663),o=i(93718);class a extends o.Xn{constructor(){super(...arguments),this.visible=r.Hidden}}(0,n._)([(0,o.gT)()],a.prototype,"renderable",void 0),(0,n._)([(0,o.gT)()],a.prototype,"components",void 0),(s=r||(r={}))[s.Hidden=0]="Hidden",s[s.Visible=1]="Visible"},68848:(e,t,i)=>{"use strict";i.d(t,{OH:()=>s,_O:()=>_});var r,s,n,o=i(36663),a=i(22919),l=i(98135),c=i(25714),u=i(90511),h=i(82082),d=i(2833),p=i(3864),f=i(94283),m=i(40017),g=i(67197),y=i(70984);(n=r||(r={}))[n.None=0]="None",n[n.Transparent=1]="Transparent",n[n.Opaque=2]="Opaque",n[n.COUNT=3]="COUNT",function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(s||(s={}));class _ extends g.m{constructor(){super(...arguments),this.output=c.H.Color,this.textureCoordinateType=h.N.None,this.componentData=a._N.Uniform,this.cullFace=y.Vr.Back,this.vertexDiscardMode=l.a.None,this.doubleSidedMode=d.q.WindingOrder,this.alphaDiscardMode=y.JJ.Opaque,this.integratedMeshMode=s.None,this.transparencyPassType=y.Am.NONE,this.ellipsoidMode=f.U.Earth,this.pbrMode=p.f7.Disabled,this.normalType=u.h.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1}}(0,o._)([(0,g.o)({count:c.H.COUNT})],_.prototype,"output",void 0),(0,o._)([(0,g.o)({count:h.N.COUNT})],_.prototype,"textureCoordinateType",void 0),(0,o._)([(0,g.o)({count:a._N.COUNT})],_.prototype,"componentData",void 0),(0,o._)([(0,g.o)({count:y.Vr.COUNT})],_.prototype,"cullFace",void 0),(0,o._)([(0,g.o)({count:l.a.COUNT})],_.prototype,"vertexDiscardMode",void 0),(0,o._)([(0,g.o)({count:d.q.COUNT})],_.prototype,"doubleSidedMode",void 0),(0,o._)([(0,g.o)({count:y.JJ.COUNT})],_.prototype,"alphaDiscardMode",void 0),(0,o._)([(0,g.o)({count:s.COUNT})],_.prototype,"integratedMeshMode",void 0),(0,o._)([(0,g.o)({count:y.Am.COUNT})],_.prototype,"transparencyPassType",void 0),(0,o._)([(0,g.o)({count:f.U.COUNT})],_.prototype,"ellipsoidMode",void 0),(0,o._)([(0,g.o)({count:p.f7.COUNT})],_.prototype,"pbrMode",void 0),(0,o._)([(0,g.o)({count:u.h.COUNT})],_.prototype,"normalType",void 0),(0,o._)([(0,g.o)()],_.prototype,"spherical",void 0),(0,o._)([(0,g.o)()],_.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasVertexColors",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasNormals",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasSlicePlane",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasBaseColorTexture",void 0),(0,o._)([(0,g.o)()],_.prototype,"receiveAmbientOcclusion",void 0),(0,o._)([(0,g.o)()],_.prototype,"receiveShadows",void 0),(0,o._)([(0,g.o)()],_.prototype,"blendingEnabled",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasScreenSpaceReflections",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasPolygonOffset",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasMetalnessAndRoughnessTexture",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasEmissionTexture",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasOcclusionTexture",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasNormalTexture",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasOccludees",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasMultipassTerrain",void 0),(0,o._)([(0,g.o)()],_.prototype,"cullAboveGround",void 0),(0,o._)([(0,g.o)()],_.prototype,"isGround",void 0),(0,o._)([(0,g.o)()],_.prototype,"hasCloudsReflections",void 0),(0,o._)([(0,g.o)()],_.prototype,"snowCover",void 0),(0,o._)([(0,g.o)({constValue:m.P.Draw})],_.prototype,"pbrTextureBindType",void 0),(0,o._)([(0,g.o)({constValue:!0})],_.prototype,"hasSliceHighlight",void 0),(0,o._)([(0,g.o)({constValue:!1})],_.prototype,"hasSliceInVertexProgram",void 0),(0,o._)([(0,g.o)({constValue:!1})],_.prototype,"useCustomDTRExponentForWater",void 0),(0,o._)([(0,g.o)({constValue:!1})],_.prototype,"hasVertexTangents",void 0),(0,o._)([(0,g.o)({constValue:!0})],_.prototype,"supportsTextureAtlas",void 0),(0,o._)([(0,g.o)({constValue:!1})],_.prototype,"highStepCount",void 0),(0,o._)([(0,g.o)({constValue:!1})],_.prototype,"instancedDoublePrecision",void 0),(0,o._)([(0,g.o)({constValue:!0})],_.prototype,"useFillLights",void 0)},22919:(e,t,i)=>{"use strict";i.d(t,{AD:()=>v,_N:()=>d,E_:()=>y,nO:()=>_});var r=i(27755),s=i(73534),n=i(78804),o=i(9794),a=i(74001),l=i(40622),c=i(91013),u=i(40017);class h extends c.x{constructor(e,t){super(e,"int",u.P.Draw,((i,r,s)=>i.setUniform1i(e,t(r,s))))}}var d,p,f=i(23410),m=i(57663),g=i(21414);(p=d||(d={}))[p.Uniform=0]="Uniform",p[p.Varying=1]="Varying",p[p.COUNT=2]="COUNT";const y=429496.7296;function _(e,t){(0,s.I)(e/y*.5+.5,t)}function v(e,t){switch(t.componentData){case d.Varying:return function(e){const{vertex:t,fragment:i}=e;t.include(o.n),t.uniforms.add([new m.Q("componentColorTex"),new a.e("componentColorTexInvDim")]),e.attributes.add(g.T.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(n.A),t.constants.add("elevationScale","float",2*y),t.code.add(f.H`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),i.code.add(f.H`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}(e);case d.Uniform:return function(e){const{vertex:t,fragment:i}=e;t.uniforms.add(new l.$("externalColor",(e=>e.componentParameters.externalColor))),i.uniforms.add(new h("externalColorMixMode",(e=>e.componentParameters.externalColorMixMode))),e.varyings.add("vExternalColor","vec4"),t.code.add(f.H`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(f.H`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}(e);case d.COUNT:return;default:(0,r.Bg)(t.componentData)}}},78804:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});var r=i(66352),s=i(23410);function n(e){e.vertex.code.add(s.H`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${s.H.int(r.a9.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${s.H.int(r.a9.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${s.H.int(r.a9.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${s.H.int(r.a9.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}},98135:(e,t,i)=>{"use strict";i.d(t,{a:()=>r,z:()=>o});var r,s,n=i(23410);function o(e,t){const i=e.vertex;switch(i.code.add(n.H`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case r.None:i.code.add(n.H`#define vertexDiscardByOpacity(_opacity_) {}`);break;case r.Opaque:i.code.add(n.H`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case r.Transparent:i.code.add(n.H`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(s=r||(r={}))[s.None=0]="None",s[s.Transparent=1]="Transparent",s[s.Opaque=2]="Opaque",s[s.COUNT=3]="COUNT"},67920:(e,t,i)=>{"use strict";i.d(t,{N:()=>o});var r=i(44685),s=i(82082),n=i(21414);function o(e){const t=(0,r.U$)().vec3f(n.T.POSITION);return e.normals&&t.vec2i16(n.T.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===s.N.Default?t.vec2f(n.T.UV0):e.textureCoordinates===s.N.Atlas&&(t.vec2f(n.T.UV0),t.vec4u16(n.T.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(n.T.COLOR,{glNormalized:!0}),t.alignTo(4)}},17e3:(e,t,i)=>{"use strict";i.d(t,{SP:()=>c,T5:()=>h,kF:()=>u,o9:()=>r,zp:()=>s});var r,s,n,o=i(8909),a=i(78549);class l extends a.d4{constructor(){super(...arguments),this.slicePlaneLocalOrigin=(0,o.c)(),this.origin=this.slicePlaneLocalOrigin}}(n=r||(r={}))[n.Material=0]="Material",n[n.ShadowMap=1]="ShadowMap",n[n.Highlight=2]="Highlight",function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(s||(s={}));class c extends l{constructor(){super(...arguments),this.identifier=r.Material,this.transparent=!1,this.integratedMesh=!1}}class u extends l{constructor(){super(...arguments),this.identifier=r.ShadowMap}}class h extends l{constructor(){super(...arguments),this.identifier=r.Highlight}}},95650:(e,t,i)=>{"use strict";i.d(t,{q:()=>a});var r=i(25714),s=i(62295),n=i(93072),o=i(23410);function a(e,t){t.output===r.H.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(o.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===r.H.Depth||t.output===r.H.Shadow?(e.include(s.up,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new n.A("nearFar",((e,t)=>t.camera.nearFar))),e.vertex.code.add(o.H`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(o.H`void forwardLinearDepth() {}`)}},57218:(e,t,i)=>{"use strict";i.d(t,{w:()=>s});var r=i(23410);function s(e){e.vertex.code.add(r.H`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},41383:(e,t,i)=>{"use strict";i.d(t,{k:()=>n});var r=i(23410),s=i(21414);function n(e,t=!0){e.attributes.add(s.T.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(r.H`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?r.H`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},25714:(e,t,i)=>{"use strict";var r;i.d(t,{H:()=>r}),function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"}(r||(r={}))},5885:(e,t,i)=>{"use strict";i.d(t,{P_:()=>d,UT:()=>h,f5:()=>p});var r=i(61681),s=i(24455),n=i(39100),o=i(6766),a=i(8909),l=i(32006),c=i(43036),u=i(23410);class h extends u.K{constructor(e){super(),this.slicePlaneLocalOrigin=e}}function d(e,t){f(e,t,[new c.J("slicePlaneOrigin",((e,i)=>_(t,e,i))),new c.J("slicePlaneBasis1",((e,i)=>v(t,e,i,(0,r.Wg)(i.slicePlane)?.basis1))),new c.J("slicePlaneBasis2",((e,i)=>v(t,e,i,(0,r.Wg)(i.slicePlane)?.basis2)))])}function p(e,t){f(e,t,[new l.B("slicePlaneOrigin",((e,i)=>_(t,e,i))),new l.B("slicePlaneBasis1",((e,i)=>v(t,e,i,(0,r.Wg)(i.slicePlane)?.basis1))),new l.B("slicePlaneBasis2",((e,i)=>v(t,e,i,(0,r.Wg)(i.slicePlane)?.basis2)))])}function f(e,t,i){if(!t.hasSlicePlane){const i=u.H`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(i),void e.fragment.code.add(i)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=u.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=u.H`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?u.H`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:u.H`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}function m(e,t,i){return e.instancedDoublePrecision?(0,o.s)(b,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function g(e,t){return(0,r.pC)(e)?(0,o.b)(w,t.origin,e):t.origin}function y(e,t,i){return e.hasSliceTranslatedView?(0,r.pC)(t)?(0,s.j)(C,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function _(e,t,i){if((0,r.Wi)(i.slicePlane))return a.Z;const s=m(e,t,i),n=g(s,i.slicePlane),l=y(e,s,i);return(0,r.pC)(l)?(0,o.m)(w,n,l):n}function v(e,t,i,s){if((0,r.Wi)(s)||(0,r.Wi)(i.slicePlane))return a.Z;const n=m(e,t,i),l=g(n,i.slicePlane),c=y(e,n,i);return(0,r.pC)(c)?((0,o.a)(x,s,l),(0,o.m)(w,l,c),(0,o.m)(x,x,c),(0,o.b)(x,x,w)):s}const b=(0,a.c)(),w=(0,a.c)(),x=(0,a.c)(),C=(0,n.c)()},4731:(e,t,i)=>{"use strict";i.d(t,{w:()=>s});var r=i(23410);function s(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(r.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(r.H`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(r.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(r.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},99163:(e,t,i)=>{"use strict";i.d(t,{f:()=>d});var r=i(6766),s=i(8909),n=i(25714),o=i(5331),a=i(32006),l=i(23410),c=i(87621),u=i(21414),h=i(30560);function d(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(u.T.MODELORIGINHI,"vec3"),e.attributes.add(u.T.MODELORIGINLO,"vec3"),e.attributes.add(u.T.MODEL,"mat3"),e.attributes.add(u.T.MODELNORMAL,"mat3"));const i=e.vertex;t.instancedDoublePrecision&&(i.include(o.$,t),i.uniforms.add(new a.B("viewOriginHi",((e,t)=>(0,h.U8)((0,r.s)(p,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),p)))),i.uniforms.add(new a.B("viewOriginLo",((e,t)=>(0,h.GB)((0,r.s)(p,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),p))))),i.code.add(l.H`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(l.H`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?l.H`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(l.H`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===n.H.Normal&&(i.uniforms.add(new c.g("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix))),i.code.add(l.H`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&i.code.add(l.H`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const p=(0,s.c)()},90511:(e,t,i)=>{"use strict";i.d(t,{O:()=>l,h:()=>n});var r=i(23410);function s(e){const t=r.H`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}var n,o,a=i(21414);function l(e,t){t.normalType===n.Attribute&&(e.attributes.add(a.T.NORMAL,"vec3"),e.vertex.code.add(r.H`vec3 normalModel() {
return normal;
}`)),t.normalType===n.CompressedAttribute&&(e.include(s),e.attributes.add(a.T.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(r.H`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===n.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(r.H`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}(o=n||(n={}))[o.Attribute=0]="Attribute",o[o.CompressedAttribute=1]="CompressedAttribute",o[o.Ground=2]="Ground",o[o.ScreenDerivative=3]="ScreenDerivative",o[o.COUNT=4]="COUNT"},28881:(e,t,i)=>{"use strict";i.d(t,{C:()=>p,W:()=>d});var r=i(69666),s=i(91636),n=i(93072),o=i(43036),a=i(36444),l=i(40335),c=i(23410),u=i(21414),h=i(67874);function d(e,t){e.attributes.add(u.T.FEATUREVALUE,"vec4");const i=e.vertex;i.code.add(c.H`bool isCapVertex() {
return featureValue.w == 1.0;
}`),i.uniforms.add(new n.A("size",(e=>e.size))),t.vvSize?(i.uniforms.add(new o.J("vvSizeMinSize",(e=>e.vvSizeMinSize))),i.uniforms.add(new o.J("vvSizeMaxSize",(e=>e.vvSizeMaxSize))),i.uniforms.add(new o.J("vvSizeOffset",(e=>e.vvSizeOffset))),i.uniforms.add(new o.J("vvSizeFactor",(e=>e.vvSizeFactor))),i.code.add(c.H`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):i.code.add(c.H`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new l.O("vvOpacityValues",(e=>e.vvOpacityValues),8),new l.O("vvOpacityOpacities",(e=>e.vvOpacityOpacities),8)]),i.code.add(c.H`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):i.code.add(c.H`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",h.x),i.uniforms.add([new l.O("vvColorValues",(e=>e.vvColorValues),h.x),new a.b("vvColorColors",(e=>e.vvColorColors),h.x)]),i.code.add(c.H`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):i.code.add(c.H`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(s.f),e.attributes.add(u.T.PROFILERIGHT,"vec4"),e.attributes.add(u.T.PROFILEUP,"vec4"),e.attributes.add(u.T.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(c.H`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(c.H`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(c.H`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(c.H`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class p extends h.n{constructor(){super(...arguments),this.size=(0,r.f)(1,1)}}},91636:(e,t,i)=>{"use strict";i.d(t,{f:()=>n});var r=i(23410),s=i(21414);function n(e){e.attributes.add(s.T.POSITION,"vec3"),e.vertex.code.add(r.H`vec3 positionModel() { return position; }`)}},65915:(e,t,i)=>{"use strict";i.d(t,{U:()=>u});var r=i(43036),s=i(36444),n=i(24603),o=i(40335),a=i(23410),l=i(21414),c=i(67874);function u(e,t){const i=e.vertex;i.uniforms.add(new n.p("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(l.T.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new r.J("vvSizeMinSize",(e=>e.vvSizeMinSize))),i.uniforms.add(new r.J("vvSizeMaxSize",(e=>e.vvSizeMaxSize))),i.uniforms.add(new r.J("vvSizeOffset",(e=>e.vvSizeOffset))),i.uniforms.add(new r.J("vvSizeFactor",(e=>e.vvSizeFactor))),i.code.add(a.H`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(l.T.SIZE,"float"),i.code.add(a.H`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(l.T.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new o.O("vvOpacityValues",(e=>e.vvOpacityValues),8),new o.O("vvOpacityOpacities",(e=>e.vvOpacityOpacities),8)]),i.code.add(a.H`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(a.H`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(l.T.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",c.x),i.uniforms.add(new o.O("vvColorValues",(e=>e.vvColorValues),c.x)),i.uniforms.add(new s.b("vvColorColors",(e=>e.vvColorColors),c.x)),i.code.add(a.H`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(l.T.COLOR,"vec4"),i.code.add(a.H`vec4 getColor(){
return applyOpacity(color);
}`))}},92835:(e,t,i)=>{"use strict";i.d(t,{R:()=>l});var r=i(78804),s=i(59842),n=i(23410),o=i(21414),a=i(25584);function l(e,t){t.hasSymbolColors?(e.include(r.A),e.attributes.add(o.T.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(n.H`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new s._("colorMixMode",(e=>a.FZ[e.colorMixMode]))),e.vertex.code.add(n.H`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}},82082:(e,t,i)=>{"use strict";i.d(t,{D:()=>l,N:()=>r});var r,s,n=i(27755),o=i(23410),a=i(21414);function l(e,t){switch(t.textureCoordinateType){case r.Default:return e.attributes.add(a.T.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(o.H`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case r.Atlas:return e.attributes.add(a.T.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(a.T.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(o.H`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case r.None:return void e.vertex.code.add(o.H`void forwardTextureCoordinates() {}`);default:(0,n.Bg)(t.textureCoordinateType);case r.COUNT:return}}(s=r||(r={}))[s.None=0]="None",s[s.Default=1]="Default",s[s.Atlas=2]="Atlas",s[s.COUNT=3]="COUNT"},6502:(e,t,i)=>{"use strict";i.d(t,{c:()=>n});var r=i(23410),s=i(21414);function n(e,t){t.hasVertexColors?(e.attributes.add(s.T.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(r.H`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(r.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(r.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},78549:(e,t,i)=>{"use strict";i.d(t,{Bb:()=>u,Pf:()=>d,d4:()=>h});var r=i(34344),s=i(1983),n=i(90511),o=i(62295),a=i(23410),l=i(55784),c=i(11125);function u(e,t){t.normalType===n.h.Attribute||t.normalType===n.h.CompressedAttribute?(e.include(n.O,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new l.j("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel)),new c.c("transformNormalViewFromGlobal",(e=>e.transformNormalViewFromGlobal))]),e.vertex.code.add(a.H`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===n.h.Ground?(e.include(o.up,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(a.H`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?a.H`normalize(vPositionWorldCameraRelative);`:a.H`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(a.H`void forwardNormal() {}`)}class h extends o.su{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,r.c)()}}class d extends o.OU{constructor(){super(...arguments),this.transformNormalGlobalFromModel=(0,r.c)(),this.toMapSpace=(0,s.c)()}}},62295:(e,t,i)=>{"use strict";i.d(t,{OU:()=>y,su:()=>g,up:()=>m});var r=i(34344),s=i(39100),n=i(79912),o=i(8909),a=i(91636),l=i(5331),c=i(32006),u=i(43036),h=i(23410),d=i(55784),p=i(11125),f=i(87621);function m(e,t){e.include(a.f);const i=e.vertex;i.include(l.$,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add([new u.J("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new u.J("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new p.c("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new f.g("transformProjFromView",(e=>e.transformProjFromView)),new d.j("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new c.B("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new c.B("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))]),i.code.add(h.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(h.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?h.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:h.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new u.J("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),i.code.add(h.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(h.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class g extends h.K{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,o.c)(),this.transformWorldFromViewTL=(0,o.c)(),this.transformViewFromCameraRelativeRS=(0,r.c)(),this.transformProjFromView=(0,s.c)()}}class y extends h.K{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,r.c)(),this.transformWorldFromModelTH=(0,n.c)(),this.transformWorldFromModelTL=(0,n.c)()}}},14140:(e,t,i)=>{"use strict";i.d(t,{M:()=>s});var r=i(23410);function s(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(r.H`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(r.H`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(r.H`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}},94352:(e,t,i)=>{"use strict";i.d(t,{i:()=>a});var r=i(27755),s=i(82082),n=i(88862),o=i(23410);function a(e,t){switch(e.include(s.D,t),e.fragment.code.add(o.H`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case s.N.Default:return void e.fragment.code.add(o.H`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case s.N.Atlas:return e.include(n.r),void e.fragment.code.add(o.H`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:(0,r.Bg)(t.textureCoordinateType);case s.N.None:case s.N.COUNT:return}}},77700:(e,t,i)=>{"use strict";i.d(t,{L:()=>c,V:()=>h});var r=i(88589),s=i(1983),n=i(76774),o=i(84614),a=i(63371),l=i(23410);function c(e,t){const i=e.vertex;t.hasVerticalOffset?(h(i),t.hasScreenSizePerspective&&(e.include(n.cK),(0,n.m8)(i),(0,o.h)(e.vertex,t)),i.code.add(l.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?l.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:l.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?l.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:l.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(l.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u=(0,s.c)();function h(e){e.uniforms.add(new a.N("verticalOffset",((e,t)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return(0,r.s)(u,n*a,o,i,s)})))}},77546:(e,t,i)=>{"use strict";i.d(t,{s:()=>y});var r=i(25714),s=i(5885),n=i(4731),o=i(90511),a=i(82082),l=i(78549),c=i(59004),u=i(55994),h=i(12664),d=i(41272),p=i(84614),f=i(93072),m=i(23410),g=i(15176);function y(e,t){const i=e.vertex.code,y=e.fragment.code,_=t.hasModelTransformation;t.output!==r.H.Depth&&t.output!==r.H.Shadow||((0,p.S)(e,t),e.include(n.w,{linearDepth:!0,hasModelTransformation:_}),e.include(a.D,t),e.include(h.k,t),e.include(c.F,t),e.include(s.f5,t),e.vertex.uniforms.add(new f.A("nearFar",((e,t)=>t.camera.nearFar))),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new g.A("tex",(e=>e.texture))),i.add(m.H`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${_?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(d.z,t),y.add(m.H`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?m.H`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===r.H.Normal&&((0,p.S)(e,t),e.include(n.w,{linearDepth:!1,hasModelTransformation:_}),e.include(o.O,t),e.include(l.Bb,t),e.include(a.D,t),e.include(h.k,t),t.hasColorTexture&&e.fragment.uniforms.add(new g.A("tex",(e=>e.texture))),e.varyings.add("vPositionView","vec3"),i.add(m.H`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===o.h.Attribute?m.H`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${_?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(s.f5,t),e.include(d.z,t),y.add(m.H`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?m.H`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===o.h.ScreenDerivative?m.H`
            vec3 normal = screenDerivativeNormal(vPositionView);`:m.H`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===r.H.Highlight&&((0,p.S)(e,t),e.include(n.w,{linearDepth:!1,hasModelTransformation:_}),e.include(a.D,t),e.include(h.k,t),t.hasColorTexture&&e.fragment.uniforms.add(new g.A("tex",(e=>e.texture))),i.add(m.H`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${_?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(s.f5,t),e.include(d.z,t),e.include(u.bA),y.add(m.H`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?m.H`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}},94728:(e,t,i)=>{"use strict";i.d(t,{H:()=>s});var r=i(23410);function s(e){const t=r.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=r.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}},21737:(e,t,i)=>{"use strict";i.d(t,{R:()=>m,d:()=>r});var r,s,n=i(77700),o=i(62912),a=i(76774),l=i(84614),c=i(63371),u=i(24603),h=i(23410),d=i(87621),p=i(15176),f=i(21414);function m(e,t){e.include(a.cK),e.attributes.add(f.T.POSITION,"vec3"),e.attributes.add(f.T.NORMAL,"vec3"),e.attributes.add(f.T.AUXPOS1,"vec4");const i=e.vertex;(0,l.S)(e,t),(0,l.h)(i,t),i.uniforms.add([new c.N("viewport",((e,t)=>t.camera.fullViewport)),new u.p("polygonOffset",(e=>e.shaderPolygonOffset)),new u.p("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1)),new u.p("renderTransparentlyOccludedHUD",((e,t)=>t.renderTransparentlyOccludedHUD===o.v.Occluded?1:t.renderTransparentlyOccludedHUD===o.v.NotOccluded?0:.75)),new p.A("hudVisibilityTexture",((e,t)=>t.hudVisibilityTexture))]),t.hasVerticalOffset&&(0,n.V)(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(h.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(h.H`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||i.uniforms.add(new d.g("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix))),t.isDraped||(i.uniforms.add(new u.p("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),i.code.add(h.H`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===r.Screen&&i.uniforms.add(new u.p("pixelRatio",((e,t)=>t.camera.pixelRatio))),t.hasScreenSizePerspective&&(0,a.m8)(i),i.code.add(h.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===r.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?h.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==r.Screen?h.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===r.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===r.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(h.H`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(s=r||(r={}))[s.World=0]="World",s[s.Screen=1]="Screen",s[s.COUNT=2]="COUNT"},74319:(e,t,i)=>{"use strict";i.d(t,{R:()=>c});var r=i(6665),s=i(32078),n=i(9794),o=i(93072),a=i(23410),l=i(15176);function c(e,t){const{vertex:i,fragment:c}=e;t.hasMultipassGeometry&&i.include(s.S),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(a.H`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?a.H`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&c.include(r.S),t.hasMultipassTerrain&&c.uniforms.add([new l.A("terrainDepthTexture",((e,t)=>t.multipassTerrain.linearDepthTexture)),new o.A("nearFar",((e,t)=>t.camera.nearFar)),new o.A("inverseViewport",((e,t)=>t.inverseViewport))]),c.include(n.n),c.code.add(a.H`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?a.H`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},62912:(e,t,i)=>{"use strict";var r;i.d(t,{v:()=>r}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}))},23998:(e,t,i)=>{"use strict";var r,s;i.d(t,{MV:()=>o,iM:()=>s,pU:()=>n}),function(e){e[e.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.COUNT=2]="COUNT"}(r||(r={})),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(s||(s={}));const n={normal:s.Normal,average:s.Average,lighten:s.Lighten,lighter:s.Lighter,screen:s.Screen,plus:s.Plus,"color-dodge":s.ColorDodge,darken:s.Darken,multiply:s.Multiply,"color-burn":s.ColorBurn,overlay:s.Overlay,"soft-light":s.SoftLight,"hard-light":s.HardLight,"vivid-light":s.VividLight,hue:s.Hue,saturation:s.Saturation,luminosity:s.Luminosity,color:s.Color,difference:s.Difference,exclusion:s.Exclusion,minus:s.Minus,invert:s.Invert,reflect:s.Reflect,"destination-over":s.DestinationOver,"destination-atop":s.DestinationAtop,"destination-in":s.DestinationIn,"destination-out":s.DestinationOut,"source-atop":s.SourceAtop,"source-in":s.SourceIn,"source-out":s.SourceOut,xor:s.Xor};function o(e){return e===s.DestinationOver||e===s.DestinationAtop||e===s.DestinationIn||e===s.DestinationOut||e===s.SourceAtop||e===s.SourceIn||e===s.SourceOut||e===s.Xor}},59004:(e,t,i)=>{"use strict";i.d(t,{F:()=>o});var r=i(25714),s=i(9794),n=i(23410);function o(e,t){e.fragment.include(s.n),t.output===r.H.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(n.H`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===r.H.Depth&&e.fragment.code.add(n.H`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}},55994:(e,t,i)=>{"use strict";i.d(t,{bA:()=>c,ck:()=>l}),i(69666);var r=i(1983),s=i(93072),n=i(23410),o=i(15176);const a=(0,r.f)(1,1,0,1),l=(0,r.f)(1,0,1,1);function c(e){e.fragment.uniforms.add(new o.A("depthTex",((e,t)=>t.highlightDepthTexture))),e.fragment.uniforms.add(new s.A("highlightViewportPixelSz",((e,t)=>t.inverseViewport))),e.fragment.constants.add("occludedHighlightFlag","vec4",a).add("unoccludedHighlightFlag","vec4",l),e.fragment.code.add(n.H`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}},6665:(e,t,i)=>{"use strict";i.d(t,{S:()=>n});var r=i(9794),s=i(23410);function n(e){e.include(r.n),e.code.add(s.H`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},35434:(e,t,i)=>{"use strict";i.d(t,{i:()=>o});var r=i(24603),s=i(23410),n=i(15176);function o(e){e.fragment.uniforms.add([new n.A("u_colormap",(e=>e.u_colormap)),new r.p("u_colormapOffset",(e=>e.colormap.u_colormapOffset)),new r.p("u_colormapMaxIndex",(e=>e.colormap.u_colormapMaxIndex)),new r.p("u_opacity",(e=>e.common.u_opacity))]),e.fragment.code.add(s.H`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)}},45979:(e,t,i)=>{"use strict";i.d(t,{G:()=>u,J:()=>c});var r=i(93072),s=i(23410),n=i(15176);function o(e){e.fragment.uniforms.add(new n.A("u_transformGrid",(e=>e.u_transformGrid))),e.fragment.uniforms.add(new r.A("u_transformSpacing",(e=>e.common.u_transformSpacing))),e.fragment.uniforms.add(new r.A("u_transformGridSize",(e=>e.common.u_transformGridSize))),e.fragment.uniforms.add(new r.A("u_targetImageSize",(e=>e.common.u_targetImageSize))),e.fragment.code.add(s.H`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}var a=i(73721),l=i(71278);class c extends a.R{constructor(e,t,i){super(),this.common=e,this.u_image=t,this.u_transformGrid=i}}function u(e){e.include(o),e.fragment.uniforms.add([new n.A("u_image",(e=>e.u_image)),new l.U("u_flipY",(e=>e.common.u_flipY)),new l.U("u_applyTransform",(e=>e.common.u_applyTransform))]),e.fragment.code.add(s.H`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}},16220:(e,t,i)=>{"use strict";i.d(t,{P:()=>l});var r=i(6502),s=i(27452),n=i(40622),o=i(90261),a=i(23410);function l(e,t){e.include(r.c,t),e.fragment.include(s.y);const i=e.fragment;i.uniforms.add(new n.$("baseColor",(e=>e.baseColor))),i.uniforms.add(new o.p("objectOpacity",(e=>e.objectOpacity))),t.hasVertexColors?i.code.add(a.H`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(a.H`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(a.H`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}},3417:(e,t,i)=>{"use strict";i.d(t,{Q:()=>h});var r=i(82082),s=i(94352),n=i(2833),o=i(23410),a=i(37649),l=i(15176),c=i(40017),u=i(21414);function h(e,t){const i=e.fragment;if(t.hasVertexTangents?(e.attributes.add(u.T.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===n.q.WindingOrder?i.code.add(o.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(o.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(o.H`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==r.N.None){e.include(s.i,t);const r=t.supportsTextureAtlas;i.uniforms.add(t.pbrTextureBindType===c.P.Pass?(0,l.J)("normalTexture",(e=>e.textureNormal),r):(0,a.F)("normalTexture",(e=>e.textureNormal),r)),i.code.add(o.H`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}},91489:(e,t,i)=>{"use strict";i.d(t,{B:()=>c});var r=i(27755),s=i(90511),n=i(78549),o=i(62295),a=i(2833),l=i(23410);function c(e,t){const i=e.fragment;switch(t.doubleSidedMode){case a.q.None:i.code.add(l.H`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case a.q.View:e.include(o.up,t),i.code.add(l.H`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case a.q.WindingOrder:i.code.add(l.H`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:(0,r.Bg)(t.doubleSidedMode);case a.q.COUNT:}switch(t.normalType){case s.h.Attribute:case s.h.CompressedAttribute:e.include(n.Bb,t),i.code.add(l.H`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case s.h.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(o.up,t),i.code.add(l.H`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case s.h.Ground:t.spherical?(e.include(o.up,t),i.code.add(l.H`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(l.H`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(l.H`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:(0,r.Bg)(t.normalType);case s.h.COUNT:}}},77787:(e,t,i)=>{"use strict";i.d(t,{_:()=>h});var r=i(6766),s=i(8909),n=i(88589),o=i(1983),a=i(3864),l=i(43036),c=i(63371),u=i(23410);function h(e,t){const i=e.fragment,s=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===s?(i.uniforms.add(new l.J("lightingAmbientSH0",((e,t)=>(0,r.s)(d,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0])))),i.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===s?(i.uniforms.add([new c.N("lightingAmbientSH_R",((e,t)=>(0,n.s)(p,t.lighting.sh.r[0],t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3]))),new c.N("lightingAmbientSH_G",((e,t)=>(0,n.s)(p,t.lighting.sh.g[0],t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3]))),new c.N("lightingAmbientSH_B",((e,t)=>(0,n.s)(p,t.lighting.sh.b[0],t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3])))]),i.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===s&&(i.uniforms.add([new l.J("lightingAmbientSH0",((e,t)=>(0,r.s)(d,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0]))),new c.N("lightingAmbientSH_R1",((e,t)=>(0,n.s)(p,t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3],t.lighting.sh.r[4]))),new c.N("lightingAmbientSH_G1",((e,t)=>(0,n.s)(p,t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3],t.lighting.sh.g[4]))),new c.N("lightingAmbientSH_B1",((e,t)=>(0,n.s)(p,t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3],t.lighting.sh.b[4]))),new c.N("lightingAmbientSH_R2",((e,t)=>(0,n.s)(p,t.lighting.sh.r[5],t.lighting.sh.r[6],t.lighting.sh.r[7],t.lighting.sh.r[8]))),new c.N("lightingAmbientSH_G2",((e,t)=>(0,n.s)(p,t.lighting.sh.g[5],t.lighting.sh.g[6],t.lighting.sh.g[7],t.lighting.sh.g[8]))),new c.N("lightingAmbientSH_B2",((e,t)=>(0,n.s)(p,t.lighting.sh.b[5],t.lighting.sh.b[6],t.lighting.sh.b[7],t.lighting.sh.b[8])))]),i.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==a.f7.Normal&&t.pbrMode!==a.f7.Schematic||i.code.add(u.H`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const d=(0,s.c)(),p=(0,o.c)()},30786:(e,t,i)=>{"use strict";i.d(t,{K:()=>l});var r=i(88589),s=i(1983),n=i(63371),o=i(23410),a=i(15176);function l(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add([new a.A("ssaoTex",((e,t)=>t.ssaoHelper.colorTexture)),new n.N("viewportPixelSz",((e,t)=>(0,r.s)(c,t.camera.fullViewport[0],t.camera.fullViewport[1],1/t.ssaoHelper.width,1/t.ssaoHelper.height)))]),i.code.add(o.H`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):i.code.add(o.H`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const c=(0,s.c)()},24623:(e,t,i)=>{"use strict";i.d(t,{X:()=>f});var r=i(77787),s=i(30786),n=i(58749),o=i(89585),a=i(3864),l=i(95509),c=i(71278),u=i(43036),h=i(24603),d=i(23410),p=i(39501);function f(e,t){const i=e.fragment;e.include(s.K,t),t.pbrMode!==a.f7.Disabled&&e.include(o.T,t),e.include(r._,t),i.constants.add("ambientBoostFactor","float",p.V),e.include(l.e),i.code.add(d.H`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===a.f7.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.uniforms.add(new u.J("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection))),i.code.add(d.H`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?d.H`normalize(vPosWorld)`:d.H`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.uniforms.add([new h.p("lightingGlobalFactor",((e,t)=>t.lighting.globalFactor)),new u.J("lightingMainIntensity",((e,t)=>t.lighting.mainLight.intensity))]),i.code.add(d.H`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===a.f7.Disabled||t.pbrMode===a.f7.WaterOnIntegratedMesh?(e.include(n.k,t),i.code.add(d.H`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==a.f7.Normal&&t.pbrMode!==a.f7.Schematic||(i.code.add(d.H`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(d.H`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new c.U("hasFillLights",((e,t)=>t.enableFillLights))):i.constants.add("hasFillLights","bool",!1),i.code.add(d.H`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new h.p("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new h.p("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))]),i.code.add(d.H`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(d.H`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===a.f7.Schematic?d.H`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:d.H`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}},98016:(e,t,i)=>{"use strict";i.d(t,{E:()=>n,K:()=>s});var r=i(23410);function s(e){e.fragment.code.add(r.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function n(e){e.fragment.code.add(r.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},76203:(e,t,i)=>{"use strict";i.d(t,{D:()=>s});var r=i(23410);function s(e){e.fragment.code.add(r.H`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}},37009:(e,t,i)=>{"use strict";i.d(t,{q:()=>m});var r=i(9794),s=i(84614),n=i(63371),o=i(24603),a=i(39820),l=i(23410),c=i(57663),u=i(61681),h=i(88589),d=i(1983);function p(e){return(0,u.Wi)(e)?d.Z:4===e.length?e:(0,h.s)(f,e[0],e[1],e[2],1)}const f=(0,d.c)();function m(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?g(e,t):function(e){e.fragment.code.add(l.H`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(e)}function g(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:u,fragment:h}=e;h.include(r.n),u.uniforms.add(new a.d("stipplePatternPixelSize")),t.draped||((0,s.h)(u,t),u.uniforms.add(new o.p("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),u.code.add(l.H`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),u.code.add(l.H`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${y};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),u.code.add(l.H`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),u.code.add(l.H`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),u.uniforms.add(new o.p("pixelRatio",((e,t)=>t.camera.pixelRatio))),u.code.add(l.H`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?l.H`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),h.uniforms.add(new c.Q("stipplePatternTexture")),h.uniforms.add(new a.d("stipplePatternSDFNormalizer")),h.uniforms.add(new a.d("stipplePatternTextureSize")),h.uniforms.add(new a.d("stipplePatternPixelSizeInv")),h.code.add(l.H`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),h.code.add(l.H`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?l.H`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:l.H`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?l.H`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?l.H`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:l.H`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?l.H`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:l.H`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(h.uniforms.add(new n.N("stippleOffColor",(e=>p(e.stippleOffColor)))),h.code.add(l.H`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):h.code.add(l.H`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}const y=l.H.float(.4)},58749:(e,t,i)=>{"use strict";i.d(t,{k:()=>o});var r=i(43036),s=i(24603),n=i(23410);function o(e,t){const i=e.fragment;t.isGround?i.uniforms.add(new s.p("lightingFixedFactor",((e,t)=>(1-t.lighting.groundLightingFactor)*(1-t.lighting.globalFactor)))):i.constants.add("lightingFixedFactor","float",0),i.uniforms.add([new r.J("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection)),new r.J("lightingMainIntensity",((e,t)=>t.lighting.mainLight.intensity))]),i.code.add(n.H`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}},32078:(e,t,i)=>{"use strict";i.d(t,{S:()=>a,_:()=>l});var r=i(6665),s=i(93072),n=i(23410),o=i(15176);function a(e){e.include(r.S),e.uniforms.add([new o.A("geometryDepthTexture",((e,t)=>t.multipassGeometry.linearDepthTexture)),new s.A("nearFar",((e,t)=>t.camera.nearFar))]),e.code.add(n.H`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class l{constructor(){this.enabled=!1}}},73393:(e,t,i)=>{"use strict";i.d(t,{a:()=>l,l:()=>a});var r=i(6665),s=i(93072),n=i(23410),o=i(15176);function a(e,t){t.hasMultipassTerrain&&(e.fragment.include(r.S),e.fragment.uniforms.add(new o.A("terrainDepthTexture",((e,t)=>t.multipassTerrain.linearDepthTexture))),e.fragment.uniforms.add(new s.A("nearFar",((e,t)=>t.camera.nearFar))),e.fragment.uniforms.add(new s.A("inverseViewport",((e,t)=>t.inverseViewport))),e.fragment.code.add(n.H`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class l{constructor(){this.enabled=!1,this.cullAboveGround=!1}}},37451:(e,t,i)=>{"use strict";i.d(t,{n:()=>s});var r=i(23410);function s(e,t){t.spherical?e.vertex.code.add(r.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(r.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(r.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(r.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},2833:(e,t,i)=>{"use strict";i.d(t,{k:()=>a,q:()=>r});var r,s,n=i(27755),o=i(23410);function a(e,t){const i=e.fragment;switch(i.code.add(o.H`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case r.None:i.code.add(o.H`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case r.View:i.code.add(o.H`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case r.WindingOrder:i.code.add(o.H`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:(0,n.Bg)(t.doubleSidedMode);case r.COUNT:}}(s=r||(r={}))[s.None=0]="None",s[s.View=1]="View",s[s.WindingOrder=2]="WindingOrder",s[s.COUNT=3]="COUNT"},89585:(e,t,i)=>{"use strict";i.d(t,{T:()=>a});var r=i(23410);function s(e){const t=e.fragment.code;t.add(r.H`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(r.H`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(r.H`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var n=i(3864),o=i(95509);function a(e,t){const i=e.fragment.code;e.include(o.e),t.pbrMode===n.f7.Water||t.pbrMode===n.f7.WaterOnIntegratedMesh?(i.add(r.H`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(r.H`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(r.H`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(r.H`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(r.H`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==n.f7.Normal&&t.pbrMode!==n.f7.Schematic||(e.include(s),i.add(r.H`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(r.H`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(r.H`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(r.H`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(r.H`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(r.H`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},3864:(e,t,i)=>{"use strict";i.d(t,{Fw:()=>h,f7:()=>d,jV:()=>f});var r=i(79912),s=i(94352),n=i(32006),o=i(43036),a=i(23410),l=i(37649),c=i(15176),u=i(40017);i(80776);const h=(0,r.f)(0,.6,.2);var d,p;function f(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===d.Normal&&r&&e.include(s.i,t),t.pbrMode!==d.Schematic)if(t.pbrMode!==d.Disabled){if(t.pbrMode===d.Normal){i.code.add(a.H`vec3 mrr;
vec3 emission;
float occlusion;`);const e=t.supportsTextureAtlas,s=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add(s===u.P.Pass?(0,c.J)("texMetallicRoughness",(e=>e.textureMetallicRoughness),e):(0,l.F)("texMetallicRoughness",(e=>e.textureMetallicRoughness),e)),i.code.add(a.H`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add(s===u.P.Pass?(0,c.J)("texEmission",(e=>e.textureEmissive),e):(0,l.F)("texEmission",(e=>e.textureEmissive),e)),i.code.add(a.H`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add(s===u.P.Pass?(0,c.J)("texOcclusion",(e=>e.textureOcclusion),e):(0,l.F)("texOcclusion",(e=>e.textureOcclusion),e)),i.code.add(a.H`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(a.H`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(s===u.P.Pass?[new o.J("emissionFactor",(e=>e.emissiveFactor)),new o.J("mrrFactors",(e=>e.mrrFactors))]:[new n.B("emissionFactor",(e=>e.emissiveFactor)),new n.B("mrrFactors",(e=>e.mrrFactors))]),i.code.add(a.H`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else i.code.add(a.H`float getBakedOcclusion() { return 1.0; }`);else i.code.add(a.H`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}(p=d||(d={}))[p.Disabled=0]="Disabled",p[p.Normal=1]="Normal",p[p.Schematic=2]="Schematic",p[p.Water=3]="Water",p[p.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",p[p.COUNT=5]="COUNT"},95509:(e,t,i)=>{"use strict";i.d(t,{e:()=>s});var r=i(23410);function s(e){e.vertex.code.add(r.H`const float PI = 3.141592653589793;`),e.fragment.code.add(r.H`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},14351:(e,t,i)=>{"use strict";i.d(t,{s:()=>l});var r=i(82082),s=i(94352),n=i(88862),o=i(23410),a=i(37649);function l(e,t){const i=e.fragment;if(t.hasBaseColorTexture){e.include(s.i,t);const l=t.textureCoordinateType===r.N.Atlas;i.uniforms.add((0,a.F)("baseColorTexture",(e=>e.texture),l)),l?(e.include(n.r),i.code.add(o.H`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):i.code.add(o.H`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(o.H`vec4 readBaseColorTexture() { return vec4(1.0); }`)}},45416:(e,t,i)=>{"use strict";i.d(t,{ry:()=>p,XE:()=>m,hb:()=>f});var r=i(8909),s=i(9794),n=i(63371),o=i(24603),a=i(59842),l=i(23410),c=i(91013),u=i(40017);class h extends c.x{constructor(e,t,i,r){switch(t){case u.P.Pass:case u.P.Draw:return void super(e,"mat4",t,((t,r,s)=>t.setUniformMatrix4fv(e,i(r,s))),r)}}}var d=i(15176);class p extends l.K{constructor(){super(...arguments),this.origin=(0,r.c)()}}function f(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new h("shadowMapMatrix",u.P.Pass,((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),g(e))}function m(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new h("shadowMapMatrix",u.P.Draw,((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),g(e))}function g(e){const t=e.fragment;t.include(s.n),t.uniforms.add([new d.A("shadowMapTex",((e,t)=>t.shadowMap.depthTexture)),new a._("numCascades",((e,t)=>t.shadowMap.numCascades)),new n.N("cascadeDistances",((e,t)=>t.shadowMap.cascadeDistances)),new o.p("depthHalfPixelSz",((e,t)=>.5/t.shadowMap.textureSize))]),t.code.add(l.H`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}},29594:(e,t,i)=>{"use strict";i.d(t,{O:()=>h,P:()=>u});var r=i(39100),s=i(6665),n=i(93072),o=i(24603),a=i(23410),l=i(87621),c=i(15176);function u(e,t){const i=e.fragment.uniforms;i.add(new n.A("nearFar",((e,t)=>t.camera.nearFar))),i.add(new c.A("depthMap",((e,t)=>t.linearDepthTexture))),i.add(new l.g("view",((e,t)=>t.ssr.camera.viewMatrix))),i.add(new l.g("proj",((e,t)=>t.ssr.camera.projectionMatrix))),i.add(new o.p("invResolutionHeight",((e,t)=>1/t.ssr.camera.height))),i.add(new c.A("lastFrameColorMap",((e,t)=>t.ssr.lastFrameColorTexture))),i.add(new l.g("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))),e.fragment.include(s.S),e.fragment.code.add(a.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class h{constructor(){this.reprojectionMatrix=(0,r.c)()}}},12664:(e,t,i)=>{"use strict";i.d(t,{k:()=>u});var r=i(43036),s=i(36444),n=i(40335),o=i(23410),a=i(11125),l=i(21414),c=i(67874);function u(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(l.T.INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new r.J("vvSizeMinSize",(e=>e.vvSizeMinSize))),i.uniforms.add(new r.J("vvSizeMaxSize",(e=>e.vvSizeMaxSize))),i.uniforms.add(new r.J("vvSizeOffset",(e=>e.vvSizeOffset))),i.uniforms.add(new r.J("vvSizeFactor",(e=>e.vvSizeFactor))),i.uniforms.add(new a.c("vvSymbolRotationMatrix",(e=>e.vvSymbolRotationMatrix))),i.uniforms.add(new r.J("vvSymbolAnchor",(e=>e.vvSymbolAnchor))),i.code.add(o.H`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(o.H`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?o.H`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(o.H`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",c.x),t.hasVvInstancing&&i.uniforms.add([new n.O("vvColorValues",(e=>e.vvColorValues),c.x),new s.b("vvColorColors",(e=>e.vvColorColors),c.x)]),i.code.add(o.H`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?o.H`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(o.H`vec4 vvColor() { return vec4(1.0); }`)}},81049:(e,t,i)=>{"use strict";i.d(t,{B:()=>u});var r=i(98016),s=i(76203),n=i(89585),o=i(29594),a=i(86589),l=i(24603),c=i(23410);function u(e,t){e.include(n.T,t),e.include(s.D),e.include(r.E),t.hasCloudsReflections&&e.include(a.j,t),t.hasScreenSpaceReflections&&e.include(o.P,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(c.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new l.p("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new l.p("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))]),i.code.add(c.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(c.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?i.code.add(c.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):i.code.add(c.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(c.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(c.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(c.H`return waterRenderedColor;
}`)}},18995:(e,t,i)=>{"use strict";i.d(t,{M:()=>d});var r=i(55709),s=i(69666),n=i(88589),o=i(1983),a=i(98016),l=i(93072),c=i(63371),u=i(23410),h=i(57663);function d(e){e.fragment.uniforms.add(new h.Q("texWaveNormal")),e.fragment.uniforms.add(new h.Q("texWavePerturbation")),e.fragment.uniforms.add([new c.N("waveParams",(e=>(0,n.s)(p,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset))),new l.A("waveDirection",(e=>(0,r.a)(f,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity)))]),e.include(a.K),e.fragment.code.add(u.H`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const p=(0,o.c)(),f=(0,s.a)()},61296:(e,t,i)=>{"use strict";i.d(t,{H:()=>s});var r=i(23410);function s(e){e.code.add(r.H`
    float lineFactorAtPosition(float value) {
      float pos = value * ${r.H.float(257)};
      if(pos < 0.5 || pos > ${r.H.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}},97582:(e,t,i)=>{"use strict";i.d(t,{Tw:()=>w,WB:()=>v,gT:()=>r,uS:()=>y,yl:()=>_});var r,s,n=i(1983),o=i(24568),a=i(9812),l=i(17e3),c=i(3864),u=i(81049),h=i(43036),d=i(40622),p=i(62869),f=i(24603),m=i(23410),g=i(15176);(s=r||(r={}))[s.Disabled=0]="Disabled",s[s.Enabled=1]="Enabled",s[s.EnabledWithWater=2]="EnabledWithWater",s[s.COUNT=3]="COUNT";class y extends m.K{constructor(){super(...arguments),this.overlayOpacity=1}}function _(e,t){e.vertex.uniforms.add([new p.y("overlayTexOffset"),new p.y("overlayTexScale")]),e.fragment.uniforms.add([new f.p("overlayOpacity",(e=>e.overlayOpacity)),new g.A("ovColorTex",((e,t)=>0===t.overlays.length?null:t.overlays[a.fu.INNER].getColorTexture(e.overlaySource)))]),b(e,t)}function v(e,t){const{vertex:i,fragment:r}=e;i.uniforms.add([new d.$("overlayTexOffset",((e,t)=>function(e,t){for(const i of t.overlays){const{index:t,extent:r}=i;(0,o.SO)(r)>0&&(x[2*t]=e.toMapSpace[0]/(0,o.bf)(r)-r[0]/(0,o.bf)(r),x[2*t+1]=e.toMapSpace[1]/(0,o.Cb)(r)-r[1]/(0,o.Cb)(r))}return x}(e,t))),new d.$("overlayTexScale",((e,t)=>function(e,t){for(const i of t.overlays){const{index:t,extent:r}=i;(0,o.SO)(r)>0&&(x[2*t]=e.toMapSpace[2]/(0,o.bf)(r),x[2*t+1]=e.toMapSpace[3]/(0,o.Cb)(r))}return x}(e,t)))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new g.A("ovColorTex",((e,t)=>w(e,t)))),b(e,t)}function b(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==c.f7.Water&&t.pbrMode!==c.f7.WaterOnIntegratedMesh||e.include(u.B,t);const{vertex:i,fragment:r}=e;e.varyings.add("vtcOverlay","vec4"),i.code.add(m.H`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(m.H`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(m.H`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==c.f7.Water&&t.pbrMode!==c.f7.WaterOnIntegratedMesh||(r.uniforms.add([new h.J("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection)),new h.J("lightingMainIntensity",((e,t)=>t.lighting.mainLight.intensity))]),r.code.add(m.H`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function w(e,t){return 0===t.overlays.length?null:e.identifier===l.o9.Material&&e.subPass===l.zp.Color?t.overlays[a.fu.INNER].getColorTextureNoRasterImage():e.identifier===l.o9.Highlight?t.overlays[a.fu.INNER].getValidTexture(a.NH.Highlight):null}const x=(0,n.c)()},47096:(e,t,i)=>{"use strict";i.d(t,{E:()=>u});var r=i(61296),s=i(52191),n=i(96371),o=i(62869),a=i(39820),l=i(23410),c=i(57663);function u(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add(new o.y("texOffsetAndScale")),e.fragment.uniforms.add(new c.Q("tex")),e.fragment.uniforms.add(new n.K("textureOpacities"));const i=t.textureFadingEnabled&&!t.renderOccluded;i&&(e.vertex.uniforms.add(new o.y("nextTexOffsetAndScale")),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add(new c.Q("texNext")),e.fragment.uniforms.add(new n.K("nextTexOpacities")),e.fragment.uniforms.add(new a.d("fadeFactor")));const u=t.tileBlendInput===s.R.ColorComposite,h=t.tileBlendInput===s.R.GridComposite;h&&e.fragment.include(r.H),u&&e.fragment.uniforms.add(new n.K("backgroundColor")),e.vertex.code.add(l.H`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${i?l.H`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:l.H``}
  }`),e.fragment.code.add(l.H`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${h||u?l.H`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${u?l.H`vec4(backgroundColor, 1.0)`:l.H`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:l.H`return color;`}
    }`),i?e.fragment.code.add(l.H`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(l.H`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}},52191:(e,t,i)=>{"use strict";var r;i.d(t,{R:()=>r}),function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"}(r||(r={}))},73721:(e,t,i)=>{"use strict";i.d(t,{R:()=>l,T:()=>c});var r=i(69666),s=i(93072),n=i(24603),o=i(23410),a=i(21414);class l extends o.K{constructor(){super(...arguments),this.scale=1,this.offset=r.Z}}function c(e){e.attributes.add(a.T.POSITION,"vec2"),e.attributes.add(a.T.UV0,"vec2"),e.vertex.uniforms.add(new n.p("scale",(e=>e.scale))),e.vertex.uniforms.add(new s.A("offset",(e=>e.offset))),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(o.H`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}},44391:(e,t,i)=>{"use strict";i.d(t,{F:()=>r,b:()=>s});const r=.1,s=.001},41272:(e,t,i)=>{"use strict";i.d(t,{o:()=>c,z:()=>l});var r=i(97706),s=i(90261),n=i(24603),o=i(23410),a=i(70984);function l(e,t){u(e,t,new n.p("textureAlphaCutoff",(e=>e.textureAlphaCutoff)))}function c(e,t){u(e,t,new s.p("textureAlphaCutoff",(e=>e.textureAlphaCutoff)))}function u(e,t,i){const s=e.fragment;switch(t.alphaDiscardMode!==a.JJ.Mask&&t.alphaDiscardMode!==a.JJ.MaskBlend||s.uniforms.add(i),t.alphaDiscardMode){case a.JJ.Blend:return e.include(r.f);case a.JJ.Opaque:s.code.add(o.H`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case a.JJ.Mask:s.code.add(o.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case a.JJ.MaskBlend:e.fragment.code.add(o.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},78541:(e,t,i)=>{"use strict";i.d(t,{d:()=>n});var r=i(23998),s=i(23410);function n(e,t){const i=t.blendMode;i!==r.iM.Normal&&(i===r.iM.Reflect&&e.code.add(s.H`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==r.iM.ColorDodge&&i!==r.iM.VividLight||e.code.add(s.H`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==r.iM.ColorBurn&&i!==r.iM.VividLight||e.code.add(s.H`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===r.iM.Overlay&&e.code.add(s.H`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===r.iM.HardLight&&e.code.add(s.H`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===r.iM.SoftLight&&e.code.add(s.H`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===r.iM.VividLight&&e.code.add(s.H`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==r.iM.Hue&&i!==r.iM.Saturation&&i!==r.iM.Color&&i!==r.iM.Luminosity||(e.code.add(s.H`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==r.iM.Hue&&i!==r.iM.Saturation||e.code.add(s.H`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(s.H`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===r.iM.Multiply?s.H`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Average?s.H`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Lighten?s.H`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Darken?s.H`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Lighter?s.H`return vec4(cl * ol + cb * ob, ol + ob);`:i===r.iM.Plus?s.H`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===r.iM.Minus?s.H`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===r.iM.Screen?s.H`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Difference?s.H`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Invert?s.H`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===r.iM.DestinationOver?s.H`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===r.iM.DestinationAtop?s.H`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===r.iM.DestinationOut?s.H`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===r.iM.SourceAtop?s.H`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===r.iM.SourceOut?s.H`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===r.iM.Xor?s.H`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===r.iM.DestinationIn?s.H`return vec4(cb * ob * ol, ol * ob);`:i===r.iM.SourceIn?s.H`return vec4(cl * ol * ob, ol * ob);`:i===r.iM.Hue?s.H`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Saturation?s.H`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Color?s.H`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Luminosity?s.H`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Exclusion?s.H`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Reflect?s.H`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.ColorDodge?s.H`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.ColorBurn?s.H`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Overlay?s.H`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.SoftLight?s.H`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.HardLight?s.H`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.VividLight?s.H`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:s.H``}
    }
  `))}},77334:(e,t,i)=>{"use strict";i.d(t,{G:()=>u,R:()=>d});var r=i(55709),s=i(69666),n=i(88589),o=i(1983),a=i(93072),l=i(63371),c=i(23410);function u(e){e.fragment.uniforms.add(new l.N("projInfo",((e,t)=>function(e){const t=e.camera.projectionMatrix;return 0===t[11]?(0,n.s)(h,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):(0,n.s)(h,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}(t)))),e.fragment.uniforms.add(new a.A("zScale",((e,t)=>d(t)))),e.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const h=(0,o.c)();function d(e){return 0===e.camera.projectionMatrix[11]?(0,r.a)(p,0,1):(0,r.a)(p,1,0)}const p=(0,s.a)()},86589:(e,t,i)=>{"use strict";i.d(t,{j:()=>_});var r=i(19431),s=i(61681),n=i(55709),o=i(69666),a=i(14260),l=i(57425),c=i(71278),u=i(93072),h=i(43036),d=i(24603),p=i(23410),f=i(87621),m=i(91013),g=i(40017);class y extends m.x{constructor(e,t){super(e,"samplerCube",g.P.Pass,((i,r,s)=>i.bindTexture(e,t(r,s))))}}function _(e){const t=e.fragment;t.uniforms.add([new f.g("rotationMatrixClouds",((e,t)=>t.clouds.parallax.transform)),new f.g("rotationMatrixCloudsCrossFade",((e,t)=>t.clouds.parallaxNew.transform)),new h.J("anchorPosition",((e,t)=>t.clouds.parallax.anchorPointClouds)),new h.J("anchorPositionCrossFade",((e,t)=>t.clouds.parallaxNew.anchorPointClouds)),new u.A("cloudVariables",((e,t)=>(0,s.pC)(t.clouds.data)?(0,n.a)(v,t.clouds.data.coverage,t.clouds.data.absorption):o.Z)),new d.p("cloudsHeight",((e,t)=>t.clouds.parallax.cloudsHeight)),new d.p("radiusCurvatureCorrectionFactor",((e,t)=>t.clouds.parallax.radiusCurvatureCorrectionFactor)),new d.p("totalFadeInOut",((e,t)=>t.clouds.fadeInOut.stage===l.co.FINISHED?t.clouds.fadeInOutHeight.factor+Math.max((0,r.uZ)(t.clouds.fadeIn.factor,0,1)):t.clouds.fadeInOutHeight.factor+Math.max((0,r.uZ)(t.clouds.fadeInOut.factor,0,1)))),new d.p("crossFadeAnchorFactor",((e,t)=>(0,r.uZ)(t.clouds.crossFade.factor,0,1))),new y("cubeMap",((e,t)=>(0,s.pC)(t.clouds.data)?t.clouds.data.cubeMap.colorTexture:null)),new c.U("crossFade",((e,t)=>t.clouds.crossFade.enabled))]),t.constants.add("planetRadius","float",a.sv.radius),t.code.add(p.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(p.H`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(p.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new h.J("lightingMainDirection",((e,t)=>t.lighting.lightingMainDirection)),new h.J("lightingMainIntensity",((e,t)=>t.lighting.mainLight.intensity))]),t.code.add(p.H`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(p.H`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(p.H`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(p.H`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(p.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const v=(0,o.a)()},32394:(e,t,i)=>{"use strict";i.d(t,{Y:()=>s});var r=i(23410);function s(e){e.code.add(r.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},97706:(e,t,i)=>{"use strict";i.d(t,{f:()=>n});var r=i(44391),s=i(23410);function n(e){e.fragment.code.add(s.H`
    #define discardOrAdjustAlpha(color) { if (color.a < ${s.H.float(r.b)}) { discard; } }
  `)}},5331:(e,t,i)=>{"use strict";i.d(t,{$:()=>n,I:()=>o});var r=i(39994),s=i(23410);function n({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(s.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(s.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function o(e){return!!(0,r.Z)("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}},94283:(e,t,i)=>{"use strict";i.d(t,{U:()=>r,j:()=>o});var r,s,n=i(35925);function o(e){return e&&(0,n.BZ)(e)?r.Mars:e&&(0,n.V2)(e)?r.Moon:r.Earth}(s=r||(r={}))[s.Earth=1]="Earth",s[s.Mars=2]="Mars",s[s.Moon=3]="Moon",s[s.COUNT=4]="COUNT"},78115:(e,t,i)=>{"use strict";i.d(t,{a:()=>o});var r=i(25714),s=i(23410),n=i(6174);function o(e,t){const i=s.H`
  /*
  *  ${t.name}
  *  ${t.output===r.H.Color?"RenderOutput: Color":t.output===r.H.Depth?"RenderOutput: Depth":t.output===r.H.Shadow?"RenderOutput: Shadow":t.output===r.H.Normal?"RenderOutput: Normal":t.output===r.H.Highlight?"RenderOutput: Highlight":""}
  */
  `;(0,n.CG)()&&(e.fragment.code.add(i),e.vertex.code.add(i))}},27452:(e,t,i)=>{"use strict";i.d(t,{y:()=>o});var r=i(66352),s=i(32394),n=i(23410);function o(e){e.include(s.Y),e.code.add(n.H`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${n.H.int(r.a9.Multiply)}) {
        return allMixed;
      }
      if (mode == ${n.H.int(r.a9.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${n.H.int(r.a9.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${n.H.int(r.a9.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${n.H.int(r.a9.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}},9794:(e,t,i)=>{"use strict";i.d(t,{n:()=>s});var r=i(23410);function s(e){e.code.add(r.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},76774:(e,t,i)=>{"use strict";i.d(t,{cK:()=>a,m8:()=>c,ww:()=>l});var r=i(88589),s=i(1983),n=i(63371),o=i(23410);function a(e){e.vertex.code.add(o.H`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(o.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(o.H`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(o.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(o.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(o.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function l(e){e.uniforms.add(new n.N("screenSizePerspective",(e=>u(e.screenSizePerspective))))}function c(e){e.uniforms.add(new n.N("screenSizePerspectiveAlignment",(e=>u(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function u(e){return(0,r.s)(h,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const h=(0,s.c)()},88862:(e,t,i)=>{"use strict";i.d(t,{r:()=>s});var r=i(23410);function s(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(r.H`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}},84614:(e,t,i)=>{"use strict";i.d(t,{S:()=>d,h:()=>h});var r=i(24455),s=i(64790),n=i(6766),o=i(8909),a=i(32006),l=i(43036),c=i(3875),u=i(87621);function h(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",o.Z):e.uniforms.add(new a.B("cameraPosition",((e,t)=>(0,n.s)(f,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2]))))}function d(e,t){if(e.vertex.uniforms.add(new u.g("proj",((e,t)=>t.camera.projectionMatrix))),t.instancedDoublePrecision){const t=(e,t)=>(0,n.s)(f,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new u.g("view",((e,i)=>(0,r.j)(p,i.camera.viewMatrix,t(e,i)))));const i=new l.J("localOrigin",t);return e.vertex.uniforms.add(i),i}e.vertex.uniforms.add(new c.K("view",((e,t)=>(0,r.j)(p,t.camera.viewMatrix,e.origin))));const i=new a.B("localOrigin",(e=>e.origin));return e.vertex.uniforms.add(i),i}const p=(0,s.c)(),f=(0,o.c)()},71278:(e,t,i)=>{"use strict";i.d(t,{U:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"bool",s.P.Pass,((i,r,s)=>i.setUniform1b(e,t(r,s))))}}},26482:(e,t,i)=>{"use strict";i.d(t,{q:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"vec2",s.P.Draw,((i,r,s)=>i.setUniform2fv(e,t(r,s))))}}},93072:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"vec2",s.P.Pass,((i,r,s)=>i.setUniform2fv(e,t(r,s))))}}},74001:(e,t,i)=>{"use strict";i.d(t,{e:()=>s});var r=i(91013);class s extends r.x{constructor(e){super(e,"vec2")}}},32006:(e,t,i)=>{"use strict";i.d(t,{B:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"vec3",s.P.Draw,((i,r,s)=>i.setUniform3fv(e,t(r,s))))}}},43036:(e,t,i)=>{"use strict";i.d(t,{J:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"vec3",s.P.Pass,((i,r,s)=>i.setUniform3fv(e,t(r,s))))}}},96371:(e,t,i)=>{"use strict";i.d(t,{K:()=>s});var r=i(91013);class s extends r.x{constructor(e){super(e,"vec3")}}},40622:(e,t,i)=>{"use strict";i.d(t,{$:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"vec4",s.P.Draw,((i,r,s)=>i.setUniform4fv(e,t(r,s))))}}},63371:(e,t,i)=>{"use strict";i.d(t,{N:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"vec4",s.P.Pass,((i,r,s)=>i.setUniform4fv(e,t(r,s))))}}},62869:(e,t,i)=>{"use strict";i.d(t,{y:()=>s});var r=i(91013);class s extends r.x{constructor(e){super(e,"vec4")}}},36444:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t,i){super(e,"vec4",s.P.Pass,((i,r,s)=>i.setUniform4fv(e,t(r,s))),i)}}},90261:(e,t,i)=>{"use strict";i.d(t,{p:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"float",s.P.Draw,((i,r,s)=>i.setUniform1f(e,t(r,s))))}}},24603:(e,t,i)=>{"use strict";i.d(t,{p:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"float",s.P.Pass,((i,r,s)=>i.setUniform1f(e,t(r,s))))}}},39820:(e,t,i)=>{"use strict";i.d(t,{d:()=>s});var r=i(91013);class s extends r.x{constructor(e){super(e,"float")}}},40335:(e,t,i)=>{"use strict";i.d(t,{O:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t,i){super(e,"float",s.P.Pass,((i,r,s)=>i.setUniform1fv(e,t(r,s))),i)}}},59842:(e,t,i)=>{"use strict";i.d(t,{_:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"int",s.P.Pass,((i,r,s)=>i.setUniform1i(e,t(r,s))))}}},55784:(e,t,i)=>{"use strict";i.d(t,{j:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"mat3",s.P.Draw,((i,r,s)=>i.setUniformMatrix3fv(e,t(r,s))))}}},11125:(e,t,i)=>{"use strict";i.d(t,{c:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"mat3",s.P.Pass,((i,r,s)=>i.setUniformMatrix3fv(e,t(r,s))))}}},3875:(e,t,i)=>{"use strict";i.d(t,{K:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"mat4",s.P.Draw,((i,r,s)=>i.setUniformMatrix4fv(e,t(r,s))))}}},87621:(e,t,i)=>{"use strict";i.d(t,{g:()=>n});var r=i(91013),s=i(40017);class n extends r.x{constructor(e,t){super(e,"mat4",s.P.Pass,((i,r,s)=>i.setUniformMatrix4fv(e,t(r,s))))}}},67948:(e,t,i)=>{"use strict";i.d(t,{B:()=>s});var r=i(91013);class s extends r.x{constructor(e){super(e,"mat4")}}},3961:(e,t,i)=>{"use strict";i.d(t,{kG:()=>l});var r=i(70375),s=i(13802),n=i(61681);const o=s.Z.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class a{constructor(){this.includedModules=new Map}include(e,t){if(this.includedModules.has(e)){const i=this.includedModules.get(e);if(i!==t){o.error("Trying to include shader module multiple times with different sets of options.");const t=new Set;for(const r of Object.keys(i))i[r]!==e[r]&&t.add(r);for(const r of Object.keys(e))i[r]!==e[r]&&t.add(r);t.forEach((t=>console.error(`  ${t}: current ${i[t]} new ${e[t]}`)))}}else this.includedModules.set(e,t),e(this.builder,t)}}class l extends a{constructor(){super(...arguments),this.vertex=new h,this.fragment=new h,this.attributes=new d,this.varyings=new p,this.extensions=new f,this.constants=new m}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const t=this.extensions.generateSource(e),i=this.attributes.generateSource(e),r=this.varyings.generateSource(),s="vertex"===e?this.vertex:this.fragment,n=s.uniforms.generateSource(),o=s.code.generateSource(),a="vertex"===e?y:g,l=this.constants.generateSource().concat(s.constants.generateSource());return`\n${t.join("\n")}\n\n${a}\n\n${l.join("\n")}\n\n${n.join("\n")}\n\n${i.join("\n")}\n\n${r.join("\n")}\n\n${o.join("\n")}`}generateBind(e,t){const i=new Map;this.vertex.uniforms.entries.forEach((t=>{const r=t.bind[e];(0,n.pC)(r)&&i.set(t.name,r)})),this.fragment.uniforms.entries.forEach((t=>{const r=t.bind[e];(0,n.pC)(r)&&i.set(t.name,r)}));const r=Array.from(i.values()),s=r.length;return(e,i)=>{for(let n=0;n<s;++n)r[n](t,e,i)}}}class c{constructor(){this._entries=new Map}add(e){if(!Array.isArray(e))return this._add(e);for(const t of e)this._add(t)}_add(e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new r.Z(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}generateSource(){return Array.from(this._entries.values()).map((e=>(0,n.pC)(e.arraySize)?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class u{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class h extends a{constructor(){super(...arguments),this.uniforms=new c,this.code=new u,this.constants=new m}get builder(){return this}}class d{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`attribute ${e[1]} ${e[0]};`))}}class p{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(){return this._entries.map((e=>`varying ${e[1]} ${e[0]};`))}}class f{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?f.ALLOWLIST_VERTEX:f.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}f.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],f.ALLOWLIST_VERTEX=[];class m{constructor(){this._entries=new Set}add(e,t,i){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":r=m._numberToFloatStr(i);break;case"int":r=m._numberToIntStr(i);break;case"bool":r=i.toString();break;case"vec2":r=`vec2(${m._numberToFloatStr(i[0])},                            ${m._numberToFloatStr(i[1])})`;break;case"vec3":r=`vec3(${m._numberToFloatStr(i[0])},                            ${m._numberToFloatStr(i[1])},                            ${m._numberToFloatStr(i[2])})`;break;case"vec4":r=`vec4(${m._numberToFloatStr(i[0])},                            ${m._numberToFloatStr(i[1])},                            ${m._numberToFloatStr(i[2])},                            ${m._numberToFloatStr(i[3])})`;break;case"ivec2":r=`ivec2(${m._numberToIntStr(i[0])},                             ${m._numberToIntStr(i[1])})`;break;case"ivec3":r=`ivec3(${m._numberToIntStr(i[0])},                             ${m._numberToIntStr(i[1])},                             ${m._numberToIntStr(i[2])})`;break;case"ivec4":r=`ivec4(${m._numberToIntStr(i[0])},                             ${m._numberToIntStr(i[1])},                             ${m._numberToIntStr(i[2])},                             ${m._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":r=`${t}(${Array.prototype.map.call(i,(e=>m._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${r};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const g="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",y="precision highp float;\nprecision highp sampler2D;"},37649:(e,t,i)=>{"use strict";i.d(t,{F:()=>u,R:()=>c});var r=i(61681),s=i(55709),n=i(69666),o=i(26482),a=i(91013),l=i(40017);class c extends a.x{constructor(e,t){super(e,"sampler2D",l.P.Draw,((i,r,s)=>i.bindTexture(e,t(r,s))))}}function u(e,t,i){const a=[new c(e,t)];if(i){const i=e+"Size";a.push(new o.q(i,((e,i)=>{const o=t(e,i);return(0,r.pC)(o)?(0,s.a)(h,o.descriptor.width,o.descriptor.height):n.Z})))}return a}const h=(0,n.a)()},15176:(e,t,i)=>{"use strict";i.d(t,{A:()=>c,J:()=>u});var r=i(61681),s=i(55709),n=i(69666),o=i(93072),a=i(91013),l=i(40017);class c extends a.x{constructor(e,t){super(e,"sampler2D",l.P.Pass,((i,r,s)=>i.bindTexture(e,t(r,s))))}}function u(e,t,i){const a=[new c(e,t)];if(i){const i=e+"Size";a.push(new o.A(i,((e,i)=>{const o=t(e,i);return(0,r.pC)(o)?(0,s.a)(h,o.descriptor.width,o.descriptor.height):n.Z})))}return a}const h=(0,n.a)()},57663:(e,t,i)=>{"use strict";i.d(t,{Q:()=>s});var r=i(91013);class s extends r.x{constructor(e){super(e,"sampler2D")}}},91013:(e,t,i)=>{"use strict";i.d(t,{x:()=>n});var r=i(61681),s=i(40017);class n{constructor(e,t,i,n,o=null){this.name=e,this.type=t,this.arraySize=o,this.bind={[s.P.Pass]:null,[s.P.Draw]:null},(0,r.pC)(i)&&(0,r.pC)(n)&&(this.bind[i]=n)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}},23410:(e,t,i)=>{"use strict";i.d(t,{H:()=>s,K:()=>r});class r{}function s(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}!function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(s||(s={}))},40017:(e,t,i)=>{"use strict";var r;i.d(t,{P:()=>r}),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(r||(r={}))},9969:(e,t,i)=>{"use strict";i.d(t,{J:()=>r});class r{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},52756:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});var r=i(61681),s=i(91907);class n{constructor(e,t,i){this.release=i,t&&(this.initializeConfiguration(e,t),this._configuration=t.snapshot()),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=(0,r.O3)(this._program),this._pipeline=this._configuration=null}reload(e){(0,r.O3)(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(e,t){this.program.bindPass(e,t)}bindDraw(e,t){this.program.bindDraw(e,t),this.program.rebindTextures()}bindPipelineState(e,t=null,i){e.setPipelineState(this.getPipelineState(t,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return s.MX.TRIANGLES}getPipelineState(e,t){return this._pipeline}initializeConfiguration(e,t){}}},67197:(e,t,i)=>{"use strict";i.d(t,{m:()=>r,o:()=>s});class r{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map((()=>0)):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const i of e)t[i]=this[i];return t}}function s(e={}){return(t,i)=>{if(t._parameterNames=t._parameterNames??[],t._parameterNames.push(i),null!=e.constValue)Object.defineProperty(t,i,{get:()=>e.constValue});else{const r=t._parameterNames.length-1,s=e.count||2,n=Math.ceil(Math.log2(s)),o=t._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);t._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(t,i,{get(){return this[r]},set(e){if(this[r]!==e&&(this[r]=e,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+e<<l&c,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration value for "+i+" must be boolean or number, got "+typeof e}})}}}},18841:(e,t,i)=>{"use strict";i.d(t,{M:()=>n});var r=i(61681),s=i(22445);class n{constructor(e){this._context=e,this._perConstructorInstances=new s.r,this._frameCounter=0,this._keepAliveFrameCount=a}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e,t){const i=t.key;let s=this._perConstructorInstances.get(e,i);if((0,r.Wi)(s)){const r=new e(this._context,t,(()=>this.release(r)));s=new o(r),this._perConstructorInstances.set(e,i,s)}return++s.refCount,s.technique}releaseAndAcquire(e,t,i){if((0,r.pC)(i)){if(t.key===i.key)return i;this.release(i)}return this.acquire(e,t)}release(e){if((0,r.Wi)(e)||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);(0,r.Wi)(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==a&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,i)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,i))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,i)=>{e.push((async(e,t)=>{const i=t.shader;i&&(await i.reload(),e.forEach((e=>{e.technique.reload(this._context)})))})(t,i))})),await Promise.all(e)}}class o{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const a=-1},48978:(e,t,i)=>{"use strict";i.d(t,{d:()=>n});var r=i(61681),s=i(12928);class n{constructor(){this.enabled=!0,this._time=0}get time(){return(0,s.HA)(this._time)}advance(e){return(0,r.pC)(e.forcedTime)?this._time!==e.forcedTime&&(this._time=e.forcedTime,!0):!(!this.enabled||0===e.dt||(this._time+=e.dt,0))}}},93718:(e,t,i)=>{"use strict";i.d(t,{TF:()=>r,Xn:()=>s,gT:()=>n});const r=e=>class extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const e of this._managedDisposables??[]){const t=this[e];this[e]=null,t&&"function"==typeof t.dispose&&t.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}};class s extends(r(class{})){}function n(){return(e,t)=>{e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=e._managedDisposables?.slice()??[]),e._managedDisposables.unshift(t)}}},99416:(e,t,i)=>{"use strict";i.d(t,{fX:()=>_,pk:()=>v,$u:()=>p,_h:()=>f,$8:()=>d});var r=i(61681),s=i(36567);let n;var o;!function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"}(o||(o={}));var a=i(91907),l=i(43487),c=i(62486);let u=null,h=null;async function d(){return(0,r.Wi)(h)&&(h=function(){if((0,r.Wi)(n)){const e=e=>(0,s.V)(`esri/libs/basisu/${e}`);n=i.e(1681).then(i.bind(i,21681)).then((e=>e.b)).then((({default:t})=>t({locateFile:e}).then((e=>(e.initializeBasis(),delete e.then,e)))))}return n}(),u=await h),h}function p(e,t){if((0,r.Wi)(u))return e.byteLength;const i=new u.BasisFile(new Uint8Array(e)),s=g(i)?m(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),s}function f(e,t){if((0,r.Wi)(u))return e.byteLength;const i=new u.KTX2File(new Uint8Array(e)),s=y(i)?m(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),s}function m(e,t,i,r,s){const n=(0,c.RG)(t?a.q_.COMPRESSED_RGBA8_ETC2_EAC:a.q_.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*o)}function g(e){return e.getNumImages()>=1&&!e.isUASTC()}function y(e){return e.getFaces()>=1&&e.isETC1S()}async function _(e,t,i){(0,r.Wi)(u)&&(u=await d());const s=new u.BasisFile(new Uint8Array(i));if(!g(s))return null;s.startTranscoding();const n=b(e,t,s.getNumLevels(0),s.getHasAlpha(),s.getImageWidth(0,0),s.getImageHeight(0,0),((e,t)=>s.getImageTranscodedSizeInBytes(0,e,t)),((e,t,i)=>s.transcodeImage(i,0,e,t,0,0)));return s.close(),s.delete(),n}async function v(e,t,i){(0,r.Wi)(u)&&(u=await d());const s=new u.KTX2File(new Uint8Array(i));if(!y(s))return null;s.startTranscoding();const n=b(e,t,s.getLevels(),s.getHasAlpha(),s.getWidth(),s.getHeight(),((e,t)=>s.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,i)=>s.transcodeImage(i,e,0,0,t,0,-1,-1)));return s.close(),s.delete(),n}function b(e,t,i,r,s,n,c,u){const{compressedTextureETC:h,compressedTextureS3TC:d}=e.capabilities,[p,f]=h?r?[o.ETC2_RGBA,a.q_.COMPRESSED_RGBA8_ETC2_EAC]:[o.ETC1_RGB,a.q_.COMPRESSED_RGB8_ETC2]:d?r?[o.BC3_RGBA,a.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[o.BC1_RGB,a.q_.COMPRESSED_RGB_S3TC_DXT1_EXT]:[o.RGBA32,a.VI.RGBA],m=t.hasMipmap?i:Math.min(1,i),g=[];for(let e=0;e<m;e++)g.push(new Uint8Array(c(e,p))),u(e,p,g[e]);const y=g.length>1,_=y?a.cw.LINEAR_MIPMAP_LINEAR:a.cw.LINEAR,v={...t,samplingMode:_,hasMipmap:y,internalFormat:f,width:s,height:n};return new l.x(e,v,{type:"compressed",levels:g})}},85211:(e,t,i)=>{"use strict";i.d(t,{p:()=>u});var r=i(69666),s=i(57425),n=i(32078),o=i(73393),a=i(29594),l=i(46378),c=i(39501);class u{constructor(e,t,i){this.shadowMap=e,this.ssaoHelper=t,this.slicePlane=i,this.slot=l.r.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=(0,r.a)(),this.lighting=new c.c,this.ssr=new a.O,this.multipassTerrain=new o.a,this.multipassGeometry=new n._,this.clouds=new s.yl,this.overlays=[]}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}},34106:(e,t,i)=>{"use strict";i.d(t,{j:()=>a});var r=i(17135),s=i(6766),n=i(8909),o=i(15095);class a{constructor(e,t,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=i,this.position=r,this.center=(0,n.c)(),(0,o.hu)(e.length>=1),(0,o.hu)(i.length%this._numIndexPerPrimitive==0),(0,o.hu)(i.length>=e.length*this._numIndexPerPrimitive),(0,o.hu)(3===r.size||4===r.size);const{data:a,size:c}=r,u=e.length;let h=c*i[this._numIndexPerPrimitive*e[0]];l.clear(),l.push(h),this.bbMin=(0,n.f)(a[h],a[h+1],a[h+2]),this.bbMax=(0,n.a)(this.bbMin);for(let t=0;t<u;++t){const r=this._numIndexPerPrimitive*e[t];for(let e=0;e<this._numIndexPerPrimitive;++e){h=c*i[r+e],l.push(h);let t=a[h];this.bbMin[0]=Math.min(t,this.bbMin[0]),this.bbMax[0]=Math.max(t,this.bbMax[0]),t=a[h+1],this.bbMin[1]=Math.min(t,this.bbMin[1]),this.bbMax[1]=Math.max(t,this.bbMax[1]),t=a[h+2],this.bbMin[2]=Math.min(t,this.bbMin[2]),this.bbMax[2]=Math.max(t,this.bbMax[2])}}(0,s.h)(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let d=this.radius*this.radius;for(let e=0;e<l.length;++e){h=l.getItemAt(e);const t=a[h]-this.center[0],i=a[h+1]-this.center[1],r=a[h+2]-this.center[2],s=t*t+i*i+r*r;if(s<=d)continue;const n=Math.sqrt(s),o=.5*(n-this.radius);this.radius=this.radius+o,d=this.radius*this.radius;const c=o/n;this.center[0]+=t*c,this.center[1]+=i*c,this.center[2]+=r*c}l.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if((0,s.d)(this.bbMin,this.bbMax)>1){const e=(0,s.h)((0,n.c)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,i=new Uint8Array(t),r=new Array(8);for(let e=0;e<8;++e)r[e]=0;const{data:o,size:l}=this.position;for(let s=0;s<t;++s){let t=0;const n=this._numIndexPerPrimitive*this.primitiveIndices[s];let a=l*this.indices[n],c=o[a],u=o[a+1],h=o[a+2];for(let e=1;e<this._numIndexPerPrimitive;++e){a=l*this.indices[n+e];const t=o[a],i=o[a+1],r=o[a+2];t<c&&(c=t),i<u&&(u=i),r<h&&(h=r)}c<e[0]&&(t|=1),u<e[1]&&(t|=2),h<e[2]&&(t|=4),i[s]=t,++r[t]}let c=0;for(let e=0;e<8;++e)r[e]>0&&++c;if(c<2)return;const u=new Array(8);for(let e=0;e<8;++e)u[e]=r[e]>0?new Uint32Array(r[e]):void 0;for(let e=0;e<8;++e)r[e]=0;for(let e=0;e<t;++e){const t=i[e];u[t][r[t]++]=this.primitiveIndices[e]}this._children=new Array(8);for(let e=0;e<8;++e)void 0!==u[e]&&(this._children[e]=new a(u[e],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){l.prune()}}const l=new r.Z({deallocator:null})},18435:(e,t,i)=>{"use strict";i.d(t,{N:()=>A,V:()=>w});var r=i(13802),s=i(19431),n=i(61681),o=i(95550),a=i(24455),l=i(39100),c=i(55709),u=i(69666),h=i(6766),d=i(8909),p=i(88589),f=i(1983),m=i(59934),g=i(97537),y=i(5700),_=i(65684),v=i(15095);const b=r.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera");class w{constructor(e=null,t=null,i=null){this._viewUp=(0,d.c)(),this._viewForward=(0,d.c)(),this._viewRight=(0,d.c)(),this._ray=(0,g.Ue)(),this._viewport=(0,f.f)(0,0,1,1),this._padding=(0,f.f)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,u.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,l.c)(),this._projectionDirty=!0,this._projectionMatrix=(0,l.c)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,l.c)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,l.c)(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=(0,m.Ue)(),this._fullViewport=(0,f.c)(),this._pixelRatio=1,this.relativeElevation=0,(0,n.pC)(e)&&(0,h.c)(this._ray.origin,e),this._center=(0,n.pC)(t)?(0,d.a)(t):(0,d.c)(),this._up=(0,n.pC)(i)?(0,d.a)(i):(0,d.f)(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return(0,h.b)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,a.c)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[A.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[A.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[A.RIGHT]+this._padding[A.LEFT]}set fullWidth(e){this.width=e-(this._padding[A.RIGHT]+this._padding[A.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[A.TOP]+this._padding[A.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[A.TOP]+this._padding[A.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[A.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[A.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[A.TOP]===e[A.TOP]&&this._padding[A.RIGHT]===e[A.RIGHT]&&this._padding[A.BOTTOM]===e[A.BOTTOM]&&this._padding[A.LEFT]===e[A.LEFT]||(this._viewport[0]+=e[A.LEFT]-this._padding[A.LEFT],this._viewport[1]+=e[A.BOTTOM]-this._padding[A.BOTTOM],this._viewport[2]-=e[A.RIGHT]+e[A.LEFT]-(this._padding[A.RIGHT]+this._padding[A.LEFT]),this._viewport[3]-=e[A.TOP]+e[A.BOTTOM]-(this._padding[A.TOP]+this._padding[A.BOTTOM]),(0,p.c)(this._padding,e),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,a.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this.aspect;(0,a.l)(this._projectionMatrix,-r*(1+2*this._padding[A.LEFT]/e),r*(1+2*this._padding[A.RIGHT]/e),-i*(1+2*this._padding[A.BOTTOM]/t),i*(1+2*this._padding[A.TOP]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return(0,n.Wi)(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=(0,l.c)()),this._inverseProjectionDirty&&(0,a.a)(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(e){(0,a.c)(this._projectionMatrix,e),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return(0,v.tM)(this._fov,this.width,this.height)}set fovX(e){this._fov=(0,v.Kj)(e,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return(0,v.RQ)(this._fov,this.width,this.height)}set fovY(e){this._fov=(0,v.zF)(e,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,h.i)(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,a.a)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,a.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){(0,h.c)(this._ray.origin,e.eye),(0,h.c)(this._center,e.center),(0,h.c)(this._up,e.up),(0,p.c)(this._viewport,e.viewport),(0,p.c)(this._padding,e.padding),(0,c.c)(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,a.c)(this._viewMatrix,e.viewMatrix),(0,h.c)(this._viewRight,e.viewRight),(0,h.c)(this._viewUp,e.viewUp),(0,h.c)(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:((0,a.c)(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,m.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,a.c)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,p.c)(this._fullViewport,e.fullViewport),this._pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new w).copyFrom(this)}equals(e){return(0,h.k)(this.eye,e.eye)&&(0,h.k)(this._center,e.center)&&(0,h.k)(this._up,e.up)&&(0,p.g)(this._viewport,e.viewport)&&(0,p.g)(this._padding,e.padding)&&(0,c.e)(this._nearFar,e.nearFar)&&this._fov===e.fov&&this._pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this._pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4;(0,h.v)(T,e.eye,e.center),(0,h.v)(S,this.eye,this._center);const i=(0,h.e)(T,S),r=(0,h.w)(T),s=(0,h.w)(S);return i*i>=(1-1e-10)*r*s&&(0,h.x)(e.eye,this.eye)<Math.max(r,s)*t*t&&(0,p.i)(e.padding,this._padding)<.5&&(0,p.i)(e.viewport,this._viewport)<.5}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,y.SR)(this.viewForward,(0,h.b)(T,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,o.s1)()){return e[0]=(this.padding[A.LEFT]+this.width/2)/this._pixelRatio,e[1]=(this.padding[A.TOP]+this.height/2)/this._pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e[0]=this.padding[A.LEFT]+this.width*t,e[1]=this.padding[A.BOTTOM]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t){e!==x&&(0,h.c)(x,e),x[3]=1,(0,p.t)(x,x,this.projectionMatrix);const i=Math.abs(x[3]);(0,h.g)(x,x,1/i);const r=this.fullViewport;t[0]=(0,s.t7)(0,r[0]+r[2],.5+.5*x[0]),t[1]=(0,s.t7)(0,r[1]+r[3],.5+.5*x[1]),t[2]=.5*(x[2]+1),t[3]=i}unapplyProjection(e,t){const i=this.fullViewport;x[0]=(e[0]/(i[0]+i[2])*2-1)*e[3],x[1]=(e[1]/(i[1]+i[3])*2-1)*e[3],x[2]=(2*e[2]-1)*e[3],x[3]=e[3],(0,p.t)(x,x,this.inverseProjectionMatrix),t[0]=x[0],t[1]=x[1],t[2]=x[2]}projectToScreen(e,t){this.projectToRenderScreen(e,E),this.renderToScreen(E,t)}projectToRenderScreen(e,t){if(x[0]=e[0],x[1]=e[1],x[2]=e[2],x[3]=1,(0,p.t)(x,x,this.viewProjectionMatrix),0===x[3])return null;(0,h.g)(x,x,1/Math.abs(x[3]));const i=this.fullViewport;return"x"in t?(t.x=(0,s.t7)(0,i[0]+i[2],.5+.5*x[0]),t.y=(0,s.t7)(0,i[1]+i[3],.5+.5*x[1])):(t[0]=(0,s.t7)(0,i[0]+i[2],.5+.5*x[0]),t[1]=(0,s.t7)(0,i[1]+i[3],.5+.5*x[1]),t.length>2&&(t[2]=.5*(x[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,E),t)}unprojectFromRenderScreen(e,t){if((0,a.m)(C,this.projectionMatrix,this.viewMatrix),!(0,a.a)(C,C))return null;const i=this.fullViewport;return x[0]=2*(e[0]-i[0])/i[2]-1,x[1]=2*(e[1]-i[1])/i[3]-1,x[2]=2*e[2]-1,x[3]=1,(0,p.t)(x,x,C),0===x[3]?null:(t[0]=x[0]/x[3],t[1]=x[1]/x[3],t[2]=x[2]/x[3],t)}constrainWindowSize(e,t,i,r=i){const s=e*this._pixelRatio,n=t*this._pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0);return[o,a,i-l- -Math.min(this.fullWidth-s-i/2,0),r-c- -Math.min(n-r/2,0)]}computeUp(e){e===_.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const i=e[0]*this._pixelRatio,r=this.fullHeight-e[1]*this._pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this._pixelRatio,r=(this.fullHeight-e[1])/this._pixelRatio;t[0]=i,t[1]=r}_computeUpGlobal(){(0,h.b)(T,this.center,this.eye);const e=(0,h.l)(this.center);e<1?((0,h.s)(this._up,0,0,1),this._markViewDirty()):Math.abs((0,h.e)(T,this.center))>.9999*(0,h.l)(T)*e||((0,h.f)(this._up,T,this.center),(0,h.f)(this._up,this._up,T),(0,h.n)(this._up,this._up),this._markViewDirty())}_computeUpLocal(){(0,h.r)(T,this.eye,this.center),Math.abs(T[2])<=.9999&&((0,h.g)(T,T,T[2]),(0,h.s)(this._up,-T[0],-T[1],1-T[2]),(0,h.n)(this._up,this._up),this._markViewDirty())}_compareAndSetView(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,h.k)(e,t)||((0,h.c)(t,e),this._markViewDirty()):b.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,m.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,a.n)(this._viewMatrix,this.eye,this._center,this._up),(0,h.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,h.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,h.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const x=(0,f.c)(),C=(0,l.c)(),T=(0,d.c)(),S=(0,d.c)(),E=(0,o.J$)();var A,M;(M=A||(A={}))[M.TOP=0]="TOP",M[M.RIGHT=1]="RIGHT",M[M.BOTTOM=2]="BOTTOM",M[M.LEFT=3]="LEFT"},2236:(e,t,i)=>{"use strict";i.d(t,{as:()=>s,t9:()=>o});var r=i(17135);class s{constructor(){this.adds=new r.Z,this.removes=new r.Z,this.updates=new r.Z({allocator:e=>e||new n,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class n{}class o{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},10107:(e,t,i)=>{"use strict";i.d(t,{c:()=>s});var r=i(7958);class s{constructor(){this.id=(0,r.D)()}unload(){}}},95399:(e,t,i)=>{"use strict";var r;i.d(t,{U:()=>r}),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"}(r||(r={}))},5474:(e,t,i)=>{"use strict";i.d(t,{i:()=>s});var r=i(21414);const s=new Map([[r.T.POSITION,0],[r.T.NORMAL,1],[r.T.UV0,2],[r.T.COLOR,3],[r.T.SIZE,4],[r.T.TANGENT,4],[r.T.AUXPOS1,5],[r.T.SYMBOLCOLOR,5],[r.T.AUXPOS2,6],[r.T.FEATUREATTRIBUTE,6],[r.T.INSTANCEFEATUREATTRIBUTE,6],[r.T.INSTANCECOLOR,7],[r.T.MODEL,8],[r.T.MODELNORMAL,12],[r.T.MODELORIGINHI,11],[r.T.MODELORIGINLO,15]])},71299:(e,t,i)=>{"use strict";i.d(t,{Bn:()=>a,QI:()=>o});var r=i(21414),s=i(91907),n=i(41163);new n.G(r.T.POSITION,3,s.g.FLOAT,0,12),new n.G(r.T.POSITION,3,s.g.FLOAT,0,20),new n.G(r.T.UV0,2,s.g.FLOAT,12,20),new n.G(r.T.POSITION,3,s.g.FLOAT,0,32),new n.G(r.T.NORMAL,3,s.g.FLOAT,12,32),new n.G(r.T.UV0,2,s.g.FLOAT,24,32),new n.G(r.T.POSITION,3,s.g.FLOAT,0,16),new n.G(r.T.COLOR,4,s.g.UNSIGNED_BYTE,12,16);const o=[new n.G(r.T.POSITION,2,s.g.FLOAT,0,8)],a=[new n.G(r.T.POSITION,2,s.g.FLOAT,0,16),new n.G(r.T.UV0,2,s.g.FLOAT,8,16)]},5079:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var r=i(70984);class s{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(e,t,i=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(i,t),this._technique),this._technique}ensureResources(e){return r.Rw.LOADED}}},55982:(e,t,i)=>{"use strict";i.d(t,{h:()=>l});var r=i(13802),s=i(61681),n=i(22445),o=i(15095);const a=r.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class l{constructor(e,t,i,r){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new n.r}dispose(){this._textureRepository.dispose()}acquire(e,t){this._ownMaterial(e);let i=this._id2glMaterialRef.get(t,e.id);if((0,s.Wi)(i)){const r=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:t});i=new c(r),this._id2glMaterialRef.set(t,e.id,i)}return i.ref(),i.glMaterial}release(e,t){const i=this._id2glMaterialRef.get(t,e.id);(0,s.pC)(i)&&(i.unref(),i.referenced||((0,s.O3)(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){(0,s.pC)(e.repository)&&e.repository!==this&&a.error("Material is already owned by a different material repository"),e.repository=this}}class c{constructor(e){this.glMaterial=e,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,(0,o.hu)(this.refCnt>=0)}get referenced(){return this.refCnt>0}}},71399:(e,t,i)=>{"use strict";i.d(t,{S:()=>l,p:()=>a});var r=i(61681),s=i(25714),n=i(70984),o=i(38208);class a{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}destroy(){this._map.forEach(((e,t)=>{(0,r.pC)(e)&&this._repository.release(this._material,l(t))}))}load(e,t){this._map.has(t)||this._map.set(t,this._repository.acquire(this._material,l(t)));const i=this._map.get(t);if((0,r.pC)(i)){if(i.ensureResources(e)===n.Rw.LOADED)return i;this._repository.requestRender()}return null}}function l(e){switch(e){case o.C.MATERIAL:return s.H.Color;case o.C.MATERIAL_ALPHA:return s.H.Alpha;case o.C.MATERIAL_DEPTH:return s.H.Depth;case o.C.MATERIAL_NORMAL:return s.H.Normal;case o.C.MATERIAL_DEPTH_SHADOWMAP_ALL:return s.H.Shadow;case o.C.MATERIAL_HIGHLIGHT:return s.H.Highlight;case o.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case o.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return s.H.Shadow}}},80776:(e,t,i)=>{"use strict";i.d(t,{E:()=>c,F:()=>l});var r=i(61681),s=i(78668),n=i(23410),o=i(70984),a=i(5079);class l extends a.Z{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,(e=>this._texture=e)),this._acquire(e.normalTextureId,(e=>this._textureNormal=e)),this._acquire(e.emissiveTextureId,(e=>this._textureEmissive=e)),this._acquire(e.occlusionTextureId,(e=>this._textureOcclusion=e)),this._acquire(e.metallicRoughnessTextureId,(e=>this._textureMetallicRoughness=e))}dispose(){this._texture=(0,r.RY)(this._texture),this._textureNormal=(0,r.RY)(this._textureNormal),this._textureEmissive=(0,r.RY)(this._textureEmissive),this._textureOcclusion=(0,r.RY)(this._textureOcclusion),this._textureMetallicRoughness=(0,r.RY)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?o.Rw.LOADED:o.Rw.LOADING}get textureBindParameters(){return new c((0,r.pC)(this._texture)?this._texture.glTexture:null,(0,r.pC)(this._textureNormal)?this._textureNormal.glTexture:null,(0,r.pC)(this._textureEmissive)?this._textureEmissive.glTexture:null,(0,r.pC)(this._textureOcclusion)?this._textureOcclusion.glTexture:null,(0,r.pC)(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){((0,r.Wi)(this._texture)||e!==this._texture.id)&&(this._texture=(0,r.RY)(this._texture),this._textureId=e,this._acquire(this._textureId,(e=>this._texture=e)))}_acquire(e,t){if((0,r.Wi)(e))return void t(null);const i=this._textureRepository.acquire(e);if((0,s.y8)(i))return++this._numLoading,void i.then((e=>{if(this._disposed)return(0,r.RY)(e),void t(null);t(e)})).finally((()=>--this._numLoading));t(i)}}class c extends n.K{constructor(e=null,t=null,i=null,r=null,s=null){super(),this.texture=e,this.textureNormal=t,this.textureEmissive=i,this.textureOcclusion=r,this.textureMetallicRoughness=s}}},47562:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r=i(61681),s=i(70984),n=i(34106),o=i(10107),a=i(95399),l=i(36620),c=i(15095),u=i(21414);class h extends o.c{constructor(e,t=[],i=s.MX.Triangle,r=-1){super(),this._primitiveType=i,this.edgeIndicesLength=r,this.type=a.U.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[t,i]of e)i&&this._vertexAttributes.set(t,{...i});if(null==t||0===t.length){const e=function(e){const t=e.values().next().value;return null==t?0:t.data.length/t.size}(this._vertexAttributes),t=(0,l.p)(e);this.edgeIndicesLength=this.edgeIndicesLength<0?e:this.edgeIndicesLength;for(const e of this._vertexAttributes.keys())this._indices.set(e,t)}else for(const[e,i]of t)i&&(this._indices.set(e,d(i)),e===u.T.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(e).length:this.edgeIndicesLength))}cloneShallow(){const e=new h([],void 0,this._primitiveType,void 0),{_vertexAttributes:t,_indices:i}=e;return this._vertexAttributes.forEach(((e,i)=>{t.set(i,e)})),this._indices.forEach(((e,t)=>{i.set(t,e)})),e.screenToWorldRatio=this.screenToWorldRatio,e._boundingInfo=this._boundingInfo,e}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){const t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return(0,r.Wi)(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return this.primitiveType===s.MX.Triangle?this._computeAttachmentOriginTriangles(e):this._computeAttachmentOriginPoints(e)}_computeAttachmentOriginTriangles(e){const t=this.indices.get(u.T.POSITION),i=this.vertexAttributes.get(u.T.POSITION);return(0,l.cM)(i,t,e)}_computeAttachmentOriginPoints(e){const t=this.indices.get(u.T.POSITION),i=this.vertexAttributes.get(u.T.POSITION);return(0,l.NO)(i,t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(u.T.POSITION);if(0===e.length)return null;const t=this.primitiveType===s.MX.Triangle?3:1;(0,c.hu)(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);const i=(0,l.p)(e.length/t),r=this.vertexAttributes.get(u.T.POSITION);return new n.j(i,t,e,r)}}function d(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}},95607:(e,t,i)=>{"use strict";i.d(t,{k:()=>a});var r=i(61681),s=i(34596),n=i(7958),o=i(6766);class a{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,i,r,s,o){this.id=(0,n.D)(),this.geometry=e,this.material=t,this.transformation=i,this.instanceParameters=r,this.origin=s,this._shaderTransformation=o,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return(0,r.pC)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&((0,o.m)(e,e,this.getStaticTransformation()),!0)}}a.pool=new s.Z(a)},6087:(e,t,i)=>{"use strict";i.d(t,{Z:()=>w});var r,s=i(6766),n=i(79912),o=i(8909),a=i(69430),l=i(97537),c=i(70984);!function(e){e.length=function(e,t){const i=e[t],r=e[t+1],s=e[t+2];return Math.sqrt(i*i+r*r+s*s)},e.normalize=function(e,t){const i=e[t],r=e[t+1],s=e[t+2],n=1/Math.sqrt(i*i+r*r+s*s);e[t]*=n,e[t+1]*=n,e[t+2]*=n},e.scale=function(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i},e.add=function(e,t,i,r,s,n=t){(s=s||e)[n]=e[t]+i[r],s[n+1]=e[t+1]+i[r+1],s[n+2]=e[t+2]+i[r+2]},e.subtract=function(e,t,i,r,s,n=t){(s=s||e)[n]=e[t]-i[r],s[n+1]=e[t+1]-i[r+1],s[n+2]=e[t+2]-i[r+2]}}(r||(r={}));var u=i(47562),h=i(36620),d=i(15095),p=i(21414);const f=r;var m,g,y,_;!function(e){const t=.5,i=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)o[6*e+t]=e;const a=new Uint16Array(36);for(let e=0;e<6;e++)a[6*e+0]=0,a[6*e+1]=1,a[6*e+2]=2,a[6*e+3]=2,a[6*e+4]=3,a[6*e+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let r=0;r<8;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new u.Z([[p.T.POSITION,{size:3,data:t,exclusive:!0}],[p.T.NORMAL,{size:3,data:r}],[p.T.UV0,{size:2,data:s}]],[[p.T.POSITION,n],[p.T.NORMAL,o],[p.T.UV0,a]])}}(m||(m={})),function(e){const t=.5,i=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let r=0;r<6;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new u.Z([[p.T.POSITION,{size:3,data:t,exclusive:!0}],[p.T.NORMAL,{size:3,data:r}]],[[p.T.POSITION,s],[p.T.NORMAL,n]])}}(g||(g={})),function(e){const t=.5,i=(0,n.f)(-t,0,-t),r=(0,n.f)(t,0,-t),o=(0,n.f)(0,0,t),a=(0,n.f)(0,.5,0),l=(0,n.c)(),c=(0,n.c)(),h=(0,n.c)(),d=(0,n.c)(),f=(0,n.c)();(0,s.b)(l,i,a),(0,s.b)(c,i,r),(0,s.f)(h,l,c),(0,s.n)(h,h),(0,s.b)(l,r,a),(0,s.b)(c,r,o),(0,s.f)(d,l,c),(0,s.n)(d,d),(0,s.b)(l,o,a),(0,s.b)(c,o,i),(0,s.f)(f,l,c),(0,s.n)(f,f);const m=[i,r,o,a],g=[0,-1,0,h[0],h[1],h[2],d[0],d[1],d[2],f[0],f[1],f[2]],y=[0,1,2,3,1,0,3,2,1,3,0,2],_=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let i=0;i<4;i++)t[3*i]=m[i][0]*e[0],t[3*i+1]=m[i][1]*e[1],t[3*i+2]=m[i][2]*e[2];return new u.Z([[p.T.POSITION,{size:3,data:t,exclusive:!0}],[p.T.NORMAL,{size:3,data:g}]],[[p.T.POSITION,new Uint16Array(y)],[p.T.NORMAL,new Uint16Array(_)]])}}(y||(y={})),function(e){e.createBoxGeometry=m.createGeometry,e.createDiamondGeometry=g.createGeometry,e.createTetrahedronGeometry=y.createGeometry,e.createSphereGeometry=function(e,t,i,r={uv:!0}){const s=-Math.PI,n=2*Math.PI,o=-Math.PI/2,a=Math.PI,l=Math.max(3,Math.floor(t)),c=Math.max(2,Math.floor(i)),h=(l+1)*(c+1),d=new Float32Array(3*h),f=new Float32Array(3*h),m=new Float32Array(2*h),g=[];let y=0;for(let t=0;t<=c;t++){const i=[],r=t/c,u=o+r*a,h=Math.cos(u);for(let t=0;t<=l;t++){const o=t/l,a=s+o*n,c=Math.cos(a)*h,p=Math.sin(u),g=-Math.sin(a)*h;d[3*y]=c*e,d[3*y+1]=p*e,d[3*y+2]=g*e,f[3*y]=c,f[3*y+1]=p,f[3*y+2]=g,m[2*y]=o,m[2*y+1]=r,i.push(y),++y}g.push(i)}const _=new Uint32Array(2*l*(c-1)*3);y=0;for(let e=0;e<c;e++)for(let t=0;t<l;t++){const i=g[e][t],r=g[e][t+1],s=g[e+1][t+1],n=g[e+1][t];0===e?(_[y++]=i,_[y++]=s,_[y++]=n):e===c-1?(_[y++]=i,_[y++]=r,_[y++]=s):(_[y++]=i,_[y++]=r,_[y++]=s,_[y++]=s,_[y++]=n,_[y++]=i)}const v=[[p.T.POSITION,_],[p.T.NORMAL,_]],b=[[p.T.POSITION,{size:3,data:d,exclusive:!0}],[p.T.NORMAL,{size:3,data:f,exclusive:!0}]];return r.uv&&(b.push([p.T.UV0,{size:2,data:m,exclusive:!0}]),v.push([p.T.UV0,_])),r.offset&&(v[0][0]=p.T.OFFSET,b[0][0]=p.T.OFFSET,v.push([p.T.POSITION,new Uint32Array(_.length)]),b.push([p.T.POSITION,{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new u.Z(b,v)},e.createPolySphereGeometry=function(e,t,i){const r=e;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=r*(1+Math.sqrt(5))/2;s=[-r,e,0,r,e,0,-r,-e,0,r,-e,0,0,-r,e,0,r,e,0,-r,-e,0,r,-e,e,0,-r,e,0,r,-e,0,-r,-e,0,r],n=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let t=0;t<s.length;t+=3)f.scale(s,t,e/f.length(s,t));let o={};function a(t,i){t>i&&([t,i]=[i,t]);const r=t.toString()+"."+i.toString();if(o[r])return o[r];let n=s.length;return s.length+=3,f.add(s,3*t,s,3*i,s,n),f.scale(s,n,e/f.length(s,n)),n/=3,o[r]=n,n}for(let e=0;e<t;e++){const e=n.length,t=new Uint32Array(4*e);for(let i=0;i<e;i+=3){const e=n[i],r=n[i+1],s=n[i+2],o=a(e,r),l=a(r,s),c=a(s,e),u=4*i;t[u]=e,t[u+1]=o,t[u+2]=c,t[u+3]=r,t[u+4]=l,t[u+5]=o,t[u+6]=s,t[u+7]=c,t[u+8]=l,t[u+9]=o,t[u+10]=l,t[u+11]=c}n=t,o={}}const l=new Float32Array(s);for(let e=0;e<l.length;e+=3)f.normalize(l,e);const c=[[p.T.POSITION,n],[p.T.NORMAL,n]],h=[[p.T.POSITION,{size:3,data:new Float32Array(s),exclusive:!0}],[p.T.NORMAL,{size:3,data:l,exclusive:!0}]];return new u.Z(h,c)},e.createPointGeometry=function(e,t,i,r,s,n,o){const a=t?[t[0],t[1],t[2]]:[0,0,0],l=e?[e[0],e[1],e[2]]:[0,0,1];n=n||[0,0];const h=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],d=null!=r&&2===r.length?r:[1,1],f=[[p.T.POSITION,{size:3,data:a,exclusive:!0}],[p.T.NORMAL,{size:3,data:l,exclusive:!0}],[p.T.UV0,{size:n.length,data:n}],[p.T.COLOR,{size:4,data:h,exclusive:!0}],[p.T.SIZE,{size:2,data:d}]];if(null!=s){const e=new Float32Array([s[0],s[1],s[2],s[3]]);f.push([p.T.AUXPOS1,{size:4,data:e}])}if(null!=o){const e=new Float32Array([o[0],o[1],o[2],o[3]]);f.push([p.T.AUXPOS2,{size:4,data:e}])}return new u.Z(f,null,c.MX.Point)},e.updatePointGeometry=function(e,t,i,r,s,n,o,a){if(null!=e){const{data:t}=a.getMutableAttribute(p.T.NORMAL);t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=a.getMutableAttribute(p.T.POSITION);e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=i){const{data:e}=a.getMutableAttribute(p.T.COLOR);e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]}if(null!=r){const{data:e}=a.getMutableAttribute(p.T.SIZE);e[0]=r[0],e[1]=r[1]}if(null!=s){const{data:e}=a.getMutableAttribute(p.T.AUXPOS1);e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3]}if(null!=n){const{data:e}=a.getMutableAttribute(p.T.UV0);e[0]=n[0],e[1]=n[1]}if(null!=o){const{data:e}=a.getMutableAttribute(p.T.AUXPOS2);e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3]}},e.createPointArrayGeometry=function(e,t){const i=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),s=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let o=0;o<e.length;o++)i[3*o]=e[o][0],i[3*o+1]=e[o][1],i[3*o+2]=e[o][2],t&&(r[3*o]=t[o][0],r[3*o+1]=t[o][1],r[3*o+2]=t[o][2]),s[o]=o,n[o]=0;t||(r[0]=0,r[1]=1,r[2]=0);const o=[[p.T.POSITION,s],[p.T.NORMAL,t?s:n],[p.T.UV0,n]],a=[[p.T.POSITION,{size:3,data:i,exclusive:!0}],[p.T.NORMAL,{size:3,data:r,exclusive:!0}],[p.T.UV0,{size:2,data:[0,0],exclusive:!0}]];return new u.Z(a,o,c.MX.Point)},e.createTriangleGeometry=function(){const e=new Uint16Array([0,1,2]),t=new Uint16Array([0,0,0]),i=new Uint16Array([0,0,0]),r=[[p.T.POSITION,e],[p.T.NORMAL,t],[p.T.UV0,i]],s=[[p.T.POSITION,{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],[p.T.NORMAL,{size:3,data:[0,1,0],exclusive:!0}],[p.T.UV0,{size:2,data:[0,0],exclusive:!0}]];return new u.Z(s,r)};const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function i(e,t,i,r,n){return!(Math.abs((0,s.e)(t,e))>n||((0,s.f)(i,e,t),(0,s.n)(i,i),(0,s.f)(r,i,e),(0,s.n)(r,r),0))}function r(e,t,r,s,n,o,a){return i(e,t,n,o,a)||i(e,r,n,o,a)||i(e,s,n,o,a)}e.createSquareGeometry=function(e=t){const i=new Array(12);for(let t=0;t<4;t++)for(let r=0;r<3;r++)i[3*t+r]=e[t][r];const r=new Uint32Array([0,1,2,2,3,0]),s=new Uint32Array([0,0,0,0,0,0]),n=[[p.T.POSITION,r],[p.T.NORMAL,s],[p.T.UV0,r],[p.T.COLOR,s]],o=[[p.T.POSITION,{size:3,data:i,exclusive:!0}],[p.T.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[p.T.UV0,{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],[p.T.COLOR,{size:4,data:[255,255,255,255],exclusive:!0}]];return new u.Z(o,n)},e.createConeGeometry=function(e,t,i,r,s=!0,o=!0){let a=0;const l=t,c=e;let h=(0,n.f)(0,a,0),d=(0,n.f)(0,a+c,0),f=(0,n.f)(0,-1,0),m=(0,n.f)(0,1,0);r&&(a=c,d=(0,n.f)(0,0,0),h=(0,n.f)(0,a,0),f=(0,n.f)(0,1,0),m=(0,n.f)(0,-1,0));const g=[d,h],y=[f,m],_=i+2,v=Math.sqrt(c*c+l*l);if(r)for(let e=i-1;e>=0;e--){const t=e*(2*Math.PI/i),r=(0,n.f)(Math.cos(t)*l,a,Math.sin(t)*l);g.push(r);const s=(0,n.f)(c*Math.cos(t)/v,-l/v,c*Math.sin(t)/v);y.push(s)}else for(let e=0;e<i;e++){const t=e*(2*Math.PI/i),r=(0,n.f)(Math.cos(t)*l,a,Math.sin(t)*l);g.push(r);const s=(0,n.f)(c*Math.cos(t)/v,l/v,c*Math.sin(t)/v);y.push(s)}const b=new Uint32Array(2*(i+2)*3),w=new Uint32Array(2*(i+2)*3);let x=0,C=0;if(s){for(let e=3;e<g.length;e++)b[x++]=1,b[x++]=e-1,b[x++]=e,w[C++]=0,w[C++]=0,w[C++]=0;b[x++]=g.length-1,b[x++]=2,b[x++]=1,w[C++]=0,w[C++]=0,w[C++]=0}if(o){for(let e=3;e<g.length;e++)b[x++]=e,b[x++]=e-1,b[x++]=0,w[C++]=e,w[C++]=e-1,w[C++]=1;b[x++]=0,b[x++]=2,b[x++]=g.length-1,w[C++]=1,w[C++]=2,w[C++]=y.length-1}const T=new Float32Array(3*_);for(let e=0;e<_;e++)T[3*e]=g[e][0],T[3*e+1]=g[e][1],T[3*e+2]=g[e][2];const S=new Float32Array(3*_);for(let e=0;e<_;e++)S[3*e]=y[e][0],S[3*e+1]=y[e][1],S[3*e+2]=y[e][2];const E=[[p.T.POSITION,b],[p.T.NORMAL,w]],A=[[p.T.POSITION,{size:3,data:T,exclusive:!0}],[p.T.NORMAL,{size:3,data:S,exclusive:!0}]];return new u.Z(A,E)},e.createCylinderGeometry=function(e,t,i,r,o,a){const l=r?(0,n.a)(r):(0,n.f)(1,0,0),c=o?(0,n.a)(o):(0,n.f)(0,0,0);a=null==a||a;const h=(0,n.c)();(0,s.n)(h,l);const d=(0,n.c)();(0,s.g)(d,h,Math.abs(e));const f=(0,n.c)();(0,s.g)(f,d,-.5),(0,s.a)(f,f,c);const m=(0,n.f)(0,1,0);Math.abs(1-(0,s.e)(h,m))<.2&&(0,s.s)(m,0,0,1);const g=(0,n.c)();(0,s.f)(g,h,m),(0,s.n)(g,g),(0,s.f)(m,g,h);const y=2*i+(a?2:0),_=i+(a?2:0),v=new Float32Array(3*y),b=new Float32Array(3*_),w=new Float32Array(2*y),x=new Uint32Array(3*i*(a?4:2)),C=new Uint32Array(3*i*(a?4:2));a&&(v[3*(y-2)+0]=f[0],v[3*(y-2)+1]=f[1],v[3*(y-2)+2]=f[2],w[2*(y-2)]=0,w[2*(y-2)+1]=0,v[3*(y-1)+0]=v[3*(y-2)+0]+d[0],v[3*(y-1)+1]=v[3*(y-2)+1]+d[1],v[3*(y-1)+2]=v[3*(y-2)+2]+d[2],w[2*(y-1)]=1,w[2*(y-1)+1]=1,b[3*(_-2)+0]=-h[0],b[3*(_-2)+1]=-h[1],b[3*(_-2)+2]=-h[2],b[3*(_-1)+0]=h[0],b[3*(_-1)+1]=h[1],b[3*(_-1)+2]=h[2]);const T=(e,t,i)=>{x[e]=t,C[e]=i};let S=0;const E=(0,n.c)(),A=(0,n.c)();for(let e=0;e<i;e++){const r=e*(2*Math.PI/i);(0,s.g)(E,m,Math.sin(r)),(0,s.g)(A,g,Math.cos(r)),(0,s.a)(E,E,A),b[3*e+0]=E[0],b[3*e+1]=E[1],b[3*e+2]=E[2],(0,s.g)(E,E,t),(0,s.a)(E,E,f),v[3*e+0]=E[0],v[3*e+1]=E[1],v[3*e+2]=E[2],w[2*e+0]=e/i,w[2*e+1]=0,v[3*(e+i)+0]=v[3*e+0]+d[0],v[3*(e+i)+1]=v[3*e+1]+d[1],v[3*(e+i)+2]=v[3*e+2]+d[2],w[2*(e+i)+0]=e/i,w[2*e+1]=1;const n=(e+1)%i;T(S++,e,e),T(S++,e+i,e),T(S++,n,n),T(S++,n,n),T(S++,e+i,e),T(S++,n+i,n)}if(a){for(let e=0;e<i;e++){const t=(e+1)%i;T(S++,y-2,_-2),T(S++,e,_-2),T(S++,t,_-2)}for(let e=0;e<i;e++){const t=(e+1)%i;T(S++,e+i,_-1),T(S++,y-1,_-1),T(S++,t+i,_-1)}}const M=[[p.T.POSITION,x],[p.T.NORMAL,C],[p.T.UV0,x]],O=[[p.T.POSITION,{size:3,data:v,exclusive:!0}],[p.T.NORMAL,{size:3,data:b,exclusive:!0}],[p.T.UV0,{size:2,data:w,exclusive:!0}]];return new u.Z(O,M)},e.createTubeGeometry=function(t,i,r,s,n){r=r||10,s=null==s||s,(0,d.hu)(t.length>1);const o=[],a=[];for(let e=0;e<r;e++){o.push([0,-e-1,-(e+1)%r-1]);const t=e/r*2*Math.PI;a.push([Math.cos(t)*i,Math.sin(t)*i])}return e.createPathExtrusionGeometry(a,t,[[0,0,0]],o,s,n)},e.createPathExtrusionGeometry=function(e,t,i,c,h,d=(0,n.f)(0,0,0)){const f=e.length,m=new Float32Array(t.length*f*3+(6*i.length||0)),g=new Float32Array(t.length*f*3+(i?6:0)),y=(t.length-1)*f*6+3*c.length*2,_=new Uint32Array(y),b=new Uint32Array(y);let w=0,x=0,C=0,T=0;const S=(0,n.c)(),E=(0,n.c)(),A=(0,n.c)(),M=(0,n.c)(),O=(0,n.c)(),R=(0,n.c)(),P=(0,n.c)(),I=(0,o.c)(),L=(0,n.c)(),D=(0,n.c)(),N=(0,n.c)(),F=(0,n.c)(),k=(0,n.c)(),U=(0,a.Ue)();(0,s.s)(L,0,1,0),(0,s.b)(E,t[1],t[0]),(0,s.n)(E,E),h?((0,s.a)(I,t[0],d),(0,s.n)(A,I)):(0,s.s)(A,0,0,1),r(E,A,L,L,O,A,v),(0,s.c)(M,A),(0,s.c)(F,O);for(let e=0;e<i.length;e++)(0,s.g)(R,O,i[e][0]),(0,s.g)(I,A,i[e][2]),(0,s.a)(R,R,I),(0,s.a)(R,R,t[0]),m[w++]=R[0],m[w++]=R[1],m[w++]=R[2];g[x++]=-E[0],g[x++]=-E[1],g[x++]=-E[2];for(let e=0;e<c.length;e++)_[C++]=c[e][0]>0?c[e][0]:-c[e][0]-1+i.length,_[C++]=c[e][1]>0?c[e][1]:-c[e][1]-1+i.length,_[C++]=c[e][2]>0?c[e][2]:-c[e][2]-1+i.length,b[T++]=0,b[T++]=0,b[T++]=0;let V=i.length;const z=i.length-1;for(let i=0;i<t.length;i++){let n=!1;i>0&&((0,s.c)(S,E),i<t.length-1?((0,s.b)(E,t[i+1],t[i]),(0,s.n)(E,E)):n=!0,(0,s.a)(D,S,E),(0,s.n)(D,D),(0,s.a)(N,t[i-1],M),(0,a.Yq)(t[i],D,U),(0,a.BR)(U,(0,l.re)(N,S),I)?((0,s.b)(I,I,t[i]),(0,s.n)(A,I),(0,s.f)(O,D,A),(0,s.n)(O,O)):r(D,M,F,L,O,A,v),(0,s.c)(M,A),(0,s.c)(F,O)),h&&((0,s.a)(I,t[i],d),(0,s.n)(k,I));for(let r=0;r<f;r++)if((0,s.g)(R,O,e[r][0]),(0,s.g)(I,A,e[r][1]),(0,s.a)(R,R,I),(0,s.n)(P,R),g[x++]=P[0],g[x++]=P[1],g[x++]=P[2],(0,s.a)(R,R,t[i]),m[w++]=R[0],m[w++]=R[1],m[w++]=R[2],!n){const e=(r+1)%f;_[C++]=V+r,_[C++]=V+f+r,_[C++]=V+e,_[C++]=V+e,_[C++]=V+f+r,_[C++]=V+f+e;for(let e=0;e<6;e++)b[T++]=_[C-6+e]-z}V+=f}const B=t[t.length-1];for(let e=0;e<i.length;e++)(0,s.g)(R,O,i[e][0]),(0,s.g)(I,A,i[e][1]),(0,s.a)(R,R,I),(0,s.a)(R,R,B),m[w++]=R[0],m[w++]=R[1],m[w++]=R[2];const H=x/3;g[x++]=E[0],g[x++]=E[1],g[x++]=E[2];const j=V-f;for(let e=0;e<c.length;e++)_[C++]=c[e][0]>=0?V+c[e][0]:-c[e][0]-1+j,_[C++]=c[e][2]>=0?V+c[e][2]:-c[e][2]-1+j,_[C++]=c[e][1]>=0?V+c[e][1]:-c[e][1]-1+j,b[T++]=H,b[T++]=H,b[T++]=H;const G=[[p.T.POSITION,_],[p.T.NORMAL,b]],W=[[p.T.POSITION,{size:3,data:m,exclusive:!0}],[p.T.NORMAL,{size:3,data:g,exclusive:!0}]];return new u.Z(W,G)},e.createPolylineGeometry=function(e,t,i){(0,d.hu)(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,d.hu)(3===e[0].length,"createPolylineGeometry(): malformed vertex"),(0,d.hu)(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),(0,d.hu)(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const r=new Float64Array(3*e.length),s=new Uint32Array(2*(e.length-1));let n=0,o=0;for(let t=0;t<e.length;t++){for(let i=0;i<3;i++)r[n++]=e[t][i];t>0&&(s[o++]=t-1,s[o++]=t)}const a=[],l=[];if(a.push([p.T.POSITION,s]),l.push([p.T.POSITION,{size:3,data:r,exclusive:!0}]),t){const i=new Float32Array(3*t.length);let r=0;for(let s=0;s<e.length;s++)for(let e=0;e<3;e++)i[r++]=t[s][e];a.push([p.T.NORMAL,s]),l.push([p.T.NORMAL,{size:3,data:i,exclusive:!0}])}return i&&(l.push([p.T.COLOR,{size:4,data:i}]),a.push([p.T.COLOR,(0,h.p)(i.length/4)])),new u.Z(l,a,c.MX.Line)},e.createExtrudedTriangle=function(e,t,i,r,s=0){const n=new Array(18),o=[[-t,s,r/2],[i,s,r/2],[0,e+s,r/2],[-t,s,-r/2],[i,s,-r/2],[0,e+s,-r/2]],a=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let e=0;e<6;e++)n[3*e]=o[e][0],n[3*e+1]=o[e][1],n[3*e+2]=o[e][2];return new u.Z([[p.T.POSITION,{size:3,data:n,exclusive:!0}]],[[p.T.POSITION,a]])},e.transformInPlace=function(e,t){const i=e.getMutableAttribute(p.T.POSITION).data;for(let e=0;e<i.length;e+=3){const r=i[e],n=i[e+1],o=i[e+2];(0,s.s)(b,r,n,o),(0,s.m)(b,b,t),i[e]=b[0],i[e+1]=b[1],i[e+2]=b[2]}},e.cgToGIS=function(e,t=e){const i=e.vertexAttributes,r=i.get(p.T.POSITION).data,s=i.get(p.T.NORMAL).data;if(s){const e=t.getMutableAttribute(p.T.NORMAL).data;for(let t=0;t<s.length;t+=3){const i=s[t+1];e[t+1]=-s[t+2],e[t+2]=i}}if(r){const e=t.getMutableAttribute(p.T.POSITION).data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}return t},e.makeOrthoBasisDirUp=i,e.makeOrthoBasisDirUpFallback=r}(_||(_={}));const v=.99619469809,b=(0,n.c)(),w=_},53464:(e,t,i)=>{"use strict";i.d(t,{C:()=>_});var r=i(61681),s=i(7958),n=i(39100),o=i(6766),a=i(8909),l=i(1983),c=i(90472),u=i(70984),h=i(47562),d=i(58781),p=i(49394),f=i(39169),m=i(21414),g=i(26982),y=i(65392);class _{constructor(e,t=125e4){this._originSR=e,this._gridSize=t,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+(0,s.D)()}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=f.p.rootOrigin;if((0,r.pC)(t))return this._origins.set(this._rootOriginId,(0,d.al)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const i=(0,d.al)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}const i=this._gridSize,s=Math.round(e[0]/i),n=Math.round(e[1]/i),a=Math.round(e[2]/i),l=`${s}/${n}/${a}`;let c=this._origins.get(l);const u=.5*i;if((0,o.b)(v,e,t.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),v[0]<u&&v[1]<u&&v[2]<u){if(c){const t=Math.max(...v);if((0,o.b)(v,e,c.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),Math.max(...v)<t)return c}return t}return c||(c=(0,d.al)(s*i,n*i,a*i,l),this._origins.set(l,c)),c}_drawOriginBox(e,t=(0,l.f)(1,1,0,1)){const i=window.view,r=i._stage,s=t.toString();if(!this._objects.has(s)){this._material=new y.U({width:2,color:t}),r.add(this._material);const e=new g.F({isPickable:!1}),i=new p.T({castShadow:!1});r.add(i),e.add(i),r.add(e),this._objects.set(s,i)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],d=a.length,f=new Array(3*d),_=new Uint16Array(2*(d-1)),v=.5*this._gridSize;for(let t=0;t<d;t++)f[3*t+0]=e[0]+(1&a[t]?v:-v),f[3*t+1]=e[1]+(2&a[t]?v:-v),f[3*t+2]=e[2]+(4&a[t]?v:-v),t>0&&(_[2*t+0]=t-1,_[2*t+1]=t);(0,c.CM)(f,this._originSR,0,f,i.renderSpatialReference,0,d);const b=new h.Z([[m.T.POSITION,{size:3,data:f,exclusive:!0}]],[[m.T.POSITION,_]],u.MX.Line);r.add(b),o.addGeometry(b,this._material,n.I)}}const v=(0,a.c)()},8927:(e,t,i)=>{"use strict";i.d(t,{LP:()=>x,Z8:()=>_,vh:()=>g});var r=i(61681),s=i(24455),n=i(39100),o=i(6766),a=i(8909),l=i(88589),c=i(1983),u=i(97537),h=i(65684),d=i(20757),p=i(66218),f=i(5073),m=i(73622);const g=1e-5;class y{constructor(e){this.options=new d.om,this._results=new v,this.transform=new f.yn,this.tolerance=g,this.verticalOffset=null,this._ray=(0,u.Ue)(),this._rayEnd=(0,a.c)(),this._rayBeginTransformed=(0,a.c)(),this._rayEndTransformed=(0,a.c)(),this.viewingMode=null==e?h.JY.Global:e}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,i){this.resetWithRay((0,u.zk)(e,t,this._ray),i)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,u.JG)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===h.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,o.a)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,i,s,n){this.point=t,this.filterPredicate=s,this.tolerance=null==i?g:i;const o=(0,f.W9)(this.verticalOffset);if((0,r.pC)(e)&&e.length>0){const t=n?e=>{n(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const i of e){const e=i.getSpatialQueryAccelerator&&i.getSpatialQueryAccelerator();(0,r.pC)(e)?((0,r.pC)(o)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):i.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometryRecords;if(!t)return;const i=e.transformation,s=(0,f.W9)(this.verticalOffset);for(const a of t){const{geometry:t,material:l,instanceParameters:c}=a;if((0,m.PD)(c))continue;const u=t.id;this.transform.setAndInvalidateLazyTransforms(i,a.getShaderTransformation()),(0,o.m)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,o.m)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;(0,r.pC)(s)&&(s.objectTransform=this.transform),l.intersect(t,c,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,i,s,o,a,l)=>{if(t>=0){if((0,r.pC)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const c=o?this._results.hud:this._results,p=o?o=>{const c={object:e,geometryId:u,triangleNr:s,center:(0,r.pC)(l)?[l[0],l[1],l[2]]:null};o.set(d.q7.HUD,c,t,i,n.I,a)}:r=>r.set(d.q7.OBJECT,{object:e,geometryId:u,triangleNr:s},t,i,h,a);if((null==c.min.drapedLayerOrder||a>=c.min.drapedLayerOrder)&&(null==c.min.dist||t<c.min.dist)&&p(c.min),this.options.store!==d.eC.MIN&&(null==c.max.drapedLayerOrder||a<c.max.drapedLayerOrder)&&(null==c.max.dist||t>c.max.dist)&&p(c.max),this.options.store===d.eC.ALL)if(o){const e=new w(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new b(this._ray);p(e),this._results.all.push(e)}}}),a.shaderTransformation)}}sortResults(e=this._results.all){e.sort(((e,t)=>e.dist!==t.dist?(0,r.Pt)(e.dist,0)-(0,r.Pt)(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?(0,r.Pt)(e.drapedLayerOrder,Number.MAX_VALUE)-(0,r.Pt)(t.drapedLayerOrder,Number.MAX_VALUE):(0,r.Pt)(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-(0,r.Pt)(e.drapedLayerGraphicOrder,Number.MIN_VALUE)))}}function _(e){return new y(e)}class v{constructor(){this.min=new b((0,u.Ue)()),this.max=new b((0,u.Ue)()),this.hud={min:new w((0,u.Ue)()),max:new w((0,u.Ue)()),all:new Array},this.ground=new b((0,u.Ue)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class b{constructor(e){this.intersector=d.q7.OBJECT,this.normal=(0,a.c)(),this.transformation=(0,n.c)(),this._ray=(0,u.Ue)(),this.init(e)}get ray(){return this._ray}get distanceInRenderSpace(){return(0,r.pC)(this.dist)?((0,o.g)(C,this.ray.direction,this.dist),(0,o.l)(C)):null}getIntersectionPoint(e){return!!(0,p.nn)(this)&&((0,o.g)(C,this.ray.direction,this.dist),(0,o.a)(e,this.ray.origin,C),!0)}getTransformedNormal(e){return(0,o.c)(T,this.normal),T[3]=0,(0,l.t)(T,T,this.transformation),(0,o.c)(e,T),(0,o.n)(e,e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=d.q7.OBJECT,(0,u.JG)(e,this._ray)}set(e,t,i,l,c,u,h){this.intersector=e,this.dist=i,(0,o.c)(this.normal,(0,r.Pt)(l,a.U)),(0,s.c)(this.transformation,(0,r.Pt)(c,n.I)),this.target=t,this.drapedLayerOrder=u,this.drapedLayerGraphicOrder=h}copy(e){(0,u.JG)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,o.c)(this.normal,e.normal),(0,s.c)(this.transformation,e.transformation)}}class w extends b{constructor(){super(...arguments),this.intersector=d.q7.HUD}}function x(e){return new b(e)}const C=(0,a.c)(),T=(0,c.c)()},20757:(e,t,i)=>{"use strict";var r,s;i.d(t,{eC:()=>s,om:()=>n,q7:()=>r}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"}(r||(r={}));class n{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=s.ALL}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(s||(s={}))},58781:(e,t,i)=>{"use strict";i.d(t,{al:()=>n});var r=i(8909);class s{constructor(e,t){this.vec3=e,this.id=t}}function n(e,t,i,n){return new s((0,r.f)(e,t,i),n)}},7358:(e,t,i)=>{"use strict";i.d(t,{F5:()=>h,Mt:()=>d,yD:()=>r});var r,s,n=i(61681),o=i(23410),a=i(10107),l=i(95399),c=i(5474),u=i(25584);class h extends a.c{constructor(e,t){super(),this.type=l.U.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=c.i,this._parameters=(0,u.Uf)(e,t),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){(0,u.LO)(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleInPass(e.pass)&&0!=(this.renderOccluded&e.renderOccludedMask)}isVisibleInPass(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){(0,n.pC)(this.repository)&&this.repository.materialChanged(this)}}(s=r||(r={}))[s.Occlude=1]="Occlude",s[s.Transparent=2]="Transparent",s[s.OccludeAndTransparent=4]="OccludeAndTransparent",s[s.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",s[s.Opaque=16]="Opaque";class d extends o.K{constructor(){super(...arguments),this.renderOccluded=r.Occlude}}},79341:(e,t,i)=>{"use strict";var r;i.d(t,{$:()=>r}),function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"}(r||(r={}))},49394:(e,t,i)=>{"use strict";i.d(t,{T:()=>y});var r=i(61681),s=i(24455),n=i(39100),o=i(6766),a=i(8909),l=i(91917),c=i(35369),u=i(70984),h=i(10107),d=i(95399),p=i(95607),f=i(31248),m=i(15095),g=i(73622);class y extends h.c{constructor(e={}){super(),this.type=d.U.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=(0,n.c)(),this._bvObjectSpace=new v,this._bvWorldSpace=new v,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new _),this.transformation=(0,n.c)();const{geometries:t,materials:i,transformations:r,origins:s}=e;if(Array.isArray(t)){(0,m.hu)(i.length===t.length,"Object3D: materials don't match geometries"),(0,m.hu)(r.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=p.k.pool.acquire(t[e],i[e],(0,n.b)(r[e]),{highlights:null,occludees:null,visible:this._visible},s&&s[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){(0,s.c)(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,m.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e,t,i,s,o){i=i||n.I,this._geometries.push(e);const a=p.k.pool.acquire(e,t,i,{highlights:null,occludees:null,visible:this._visible},s,o);return this._geometryRecords.push(a),this._hasVolatileTransformation=this._hasVolatileTransformation||(0,r.pC)(a.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:a}),this._invalidateBoundingVolume(),a}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=(0,r.pC)(t.shaderTransformation)?this._geometryRecords.some((e=>(0,r.pC)(e.shaderTransformation))):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:e}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometryRecords)e.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new f.O(u.V_.MaskOccludee);for(const t of this._geometryRecords)t.instanceParameters.occludees=(0,g.lr)(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=(0,g.U_)(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new f.O(u.V_.Highlight);for(const t of this._geometryRecords)t.instanceParameters.highlights=(0,g.lr)(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=(0,g.U_)(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return(0,s.m)((0,r.Pt)(t,(0,n.c)()),this.transformation,e.getStaticTransformation())}_getCombinedShaderTransformation(e,t){return t=t||(0,n.c)(),(0,s.m)(t,this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let e=0;e<this._geometryRecords.length;++e){const t=this._geometries[e],i=this._geometryRecords[e],s=t.boundingInfo;(0,r.pC)(s)&&(this._calculateTransformedBoundingVolume(s,this._bvObjectSpace,i.getShaderTransformation()),this._calculateTransformedBoundingVolume(s,this._bvWorldSpace,this._getCombinedShaderTransformation(i)))}(0,o.h)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),(0,o.h)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=(0,a.c)(),t=(0,a.c)(),i=(0,c.u1)(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if((0,r.Wi)(n))continue;const a=this._geometryRecords[s].getShaderTransformation(),l=(0,c.u1)(a);(0,o.m)(e,n.getCenter(),a);const u=(0,o.i)(e,this._bvObjectSpace.bounds),h=n.getBSRadius()*l;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],u+h),(0,o.m)(t,e,this.transformation);const d=(0,o.i)(t,this._bvWorldSpace.bounds),p=h*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],d+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,i){const r=e.getBBMin(),s=e.getBBMax(),n=(0,a.a)(r),l=(0,a.a)(s);(0,o.m)(n,n,i),(0,o.m)(l,l,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],n[e],l[e]),t.max[e]=Math.max(t.max[e],n[e],l[e]);for(let e=0;e<3;++e){(0,o.c)(n,r),(0,o.c)(l,s),n[e]=s[e],l[e]=r[e],(0,o.m)(n,n,i),(0,o.m)(l,l,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],n[e],l[e]),t.max[e]=Math.max(t.max[e],n[e],l[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,(0,r.pC)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){(0,r.pC)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.includes(t),getGeometryIndex:t=>e._geometries.indexOf(t)}}}class _{constructor(){this.min=(0,a.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,a.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class v extends _{constructor(){super(...arguments),this.bounds=(0,l.c)()}init(){(0,o.s)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),(0,o.s)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),(0,l.a)(this.bounds)}}},31248:(e,t,i)=>{"use strict";i.d(t,{O:()=>s});var r=i(7958);class s{constructor(e){this.channel=e,this.id=(0,r.D)()}}},20766:(e,t,i)=>{"use strict";i.d(t,{Z:()=>V});var r,s,n=i(61681),o=i(34596),a=i(17135),l=i(6766),c=i(8909),u=i(59934),h=i(97537),d=i(91917),p=i(15095);class f{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new m,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),m.clearPool(),E[0]=null,P.prune(),k.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=m.acquire();for(let r=0;r<t;r++){const t=e[r];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}m.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=m.acquire();for(const r of e){const e=(0,n.pC)(t)?t:(0,d.b)(this._objectToBoundingSphere(r),I);x(e[3])?(i.init(this._root),this._remove(r,e,i)):this._degenerateObjects.delete(r)}m.release(i),this._shrink()}update(e,t){if(!x(t[3])&&this._isDegenerate(e))return;const i=function(e){return E[0]=e,E}(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const r=(0,h.re)(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNode(r,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,i,r){const s=(0,h.re)(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNodeWithOffset(s,e,r))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(s,e,r)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(s,e,r)&&i(e)})),!0}))}forEach(e){this._forEachNode(this._root,(t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,r=(()=>!0),s=1/0){let n=1/0,o=1/0,a=null;const c=b(e,t),h=l=>{if(--s,!r(l))return;const c=this._objectToBoundingSphere(l);if(!(0,u.hr)(i,c))return;const h=w(e,t,(0,d.g)(c)),p=h-c[3],f=h+c[3];p<n&&(n=p,o=f,a=l)};return this._forEachNodeDepthOrdered(this._root,(r=>{if(s<=0||!(0,u.hr)(i,r.bounds))return!1;if((0,l.g)(M,c,r.halfSize),(0,l.a)(M,M,r.bounds),w(e,t,M)>o)return!1;const n=r.node;return n.terminals.forAll((e=>h(e))),null!==n.residents&&n.residents.forAll((e=>h(e))),!0}),e,t),a}forEachInDepthRange(e,t,i,r,s,n,o){let a=-1/0,c=1/0;const h={setRange:e=>{i===f.DepthOrder.FRONT_TO_BACK?(a=Math.max(a,e.near),c=Math.min(c,e.far)):(a=Math.max(a,-e.far),c=Math.min(c,-e.near))}};h.setRange(r);const p=w(t,i,e),m=b(t,i),g=b(t,-i),y=e=>{if(!o(e))return;const r=this._objectToBoundingSphere(e),l=(0,d.g)(r),f=w(t,i,l)-p,m=f-r[3],g=f+r[3];m>c||g<a||!(0,u.hr)(n,r)||s(e,h)};this._forEachNodeDepthOrdered(this._root,(e=>{if(!(0,u.hr)(n,e.bounds))return!1;if((0,l.g)(M,m,e.halfSize),(0,l.a)(M,M,e.bounds),w(t,i,M)-p>c)return!1;if((0,l.g)(M,g,e.halfSize),(0,l.a)(M,M,e.bounds),w(t,i,M)-p<a)return!1;const r=e.node;return r.terminals.forAll((e=>y(e))),null!==r.residents&&r.residents.forAll((e=>y(e))),!0}),t,i)}forEachNode(e){this._forEachNode(this._root,(t=>e(t.node,t.bounds,t.halfSize)))}forEachNeighbor(e,t){const i=(0,d.d)(t),r=(0,d.g)(t),s=t=>{const s=this._objectToBoundingSphere(t),n=(0,d.d)(s),o=i+n;(0,l.d)((0,d.g)(s),r)-o*o<=0&&e(t)};this._forEachNode(this._root,(e=>{const t=(0,d.d)(e.bounds),n=i+t;if((0,l.d)((0,d.g)(e.bounds),r)-n*n>0)return!1;const o=e.node;return o.terminals.forAll((e=>s(e))),null!==o.residents&&o.residents.forAll((e=>s(e))),!0})),this.forEachDegenerateObject(s)}_intersectsNode(e,t){return _(t.bounds,2*-t.halfSize,O),_(t.bounds,2*t.halfSize,R),(0,p.yK)(e.origin,e.direction,O,R)}_intersectsNodeWithOffset(e,t,i){return _(t.bounds,2*-t.halfSize,O),_(t.bounds,2*t.halfSize,R),i.applyToMinMax(O,R),(0,p.yK)(e.origin,e.direction,O,R)}_intersectsObject(e,t){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||(0,d.i)(i,e)}_intersectsObjectWithOffset(e,t,i){const r=this._objectToBoundingSphere(t);return!(r[3]>0)||(0,d.i)(i.applyToBoundingSphere(r),e)}_forEachNode(e,t){let i=m.acquire().init(e);const r=[i];for(;0!==r.length;){if(i=r.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&r.push(m.acquire().init(i).advance(e));m.release(i)}}_forEachNodeDepthOrdered(e,t,i,r=f.DepthOrder.FRONT_TO_BACK){let s=m.acquire().init(e);const n=[s];for(function(e,t,i){if(!k.length)for(let e=0;e<8;++e)k.push({index:0,distance:0});for(let i=0;i<8;++i){const r=C[i];k.data[i].index=i,k.data[i].distance=w(e,t,r)}k.sort(((e,t)=>e.distance-t.distance));for(let e=0;e<8;++e)i[e]=k.data[e].index}(i,r,U);0!==n.length;){if(s=n.pop(),t(s)&&!s.isLeaf())for(let e=7;e>=0;--e){const t=U[e];s.node.children[t]&&n.push(m.acquire().init(s).advance(t))}m.release(s)}}_remove(e,t,i){P.clear();const r=i.advanceTo(t,((e,t)=>{P.push(e.node),P.push(t)}))?i.node.terminals:i.node.residents;if(r.removeUnordered(e),0===r.length)for(let e=P.length-2;e>=0;e-=2){const t=P.data[e],i=P.data[e+1];if(!this._purge(t,i))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new a.Z({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const r=m.acquire().init(e);this._add(t.getItemAt(i),r),m.release(r)}}_grow(e,t){if(0!==t&&(v(e,t,(e=>this._objectToBoundingSphere(e)),L),x(L[3])&&!this._fitsInsideTree(L)))if(this._nodeIsEmpty(this._root.node))(0,d.b)(L,this._root.bounds),this._root.halfSize=1.25*L[3];else{const e=this._rootBoundsForRootAsSubNode(L);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(L,e):this._growRootAsSubNode(e),m.release(e)}}_rebuildTree(e,t){(0,l.c)(D,t.bounds),D[3]=t.halfSize,v([e,D],2,(e=>e),N);const i=m.acquire().init(this._root);this._root.initFrom(null,N,1.25*N[3]),this._forEachNode(i,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),m.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,(e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth))),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let r=-1/0;const s=this._root.bounds,n=this._root.halfSize;for(let e=0;e<3;e++){const o=s[e]-n-(i[e]-t),a=i[e]+t-(s[e]+n),l=Math.max(0,Math.ceil(o/(2*n))),c=Math.max(0,Math.ceil(a/(2*n)))+1,u=2**Math.ceil(Math.log(l+c)*Math.LOG2E);r=Math.max(r,u),F[e].min=l,F[e].max=c}for(let e=0;e<3;e++){let t=F[e].min,i=F[e].max;const o=(r-(t+i))/2;t+=Math.ceil(o),i+=Math.floor(o);const a=s[e]-n-t*n*2;A[e]=a+(i+t)*n}return A[3]=r*n*S,m.acquire().initFrom(null,A,r*n,0)}_growRootAsSubNode(e){const t=this._root.node;(0,l.c)(L,this._root.bounds),L[3]=this._root.halfSize,this._root.init(e),e.advanceTo(L,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,r=0;for(;r<t.length&&null==e;)i=r++,e=t[i];for(;r<t.length;)if(t[r++])return-1;return i}_isDegenerate(e){return!x(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}}class m{constructor(){this.bounds=(0,d.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,r=this.depth){return this.node=(0,n.pC)(e)?e:m.createEmptyNode(),(0,n.pC)(t)&&(0,d.b)(t,this.bounds),this.halfSize=i,this.depth=r,this}advance(e){let t=this.node.children[e];t||(t=m.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=C[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*S,this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const r=this._childIndex(e);t&&t(this,r),this.advance(r)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new a.Z({shrink:!0}),residents:new a.Z({shrink:!0})}}static acquire(){return m._pool.acquire()}static release(e){m._pool.release(e)}static clearPool(){m._pool.prune()}}function g(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function y(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function _(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function v(e,t,i,r){if(1===t){const t=i(e[0]);(0,d.b)(t,r)}else{O[0]=1/0,O[1]=1/0,O[2]=1/0,R[0]=-1/0,R[1]=-1/0,R[2]=-1/0;for(let r=0;r<t;r++){const t=i(e[r]);x(t[3])&&(g(O,t),y(R,t))}(0,l.h)(r,O,R,.5),r[3]=Math.max(R[0]-O[0],R[1]-O[1],R[2]-O[2])/2}}function b(e,t){let i=1/0,r=null;for(let s=0;s<8;++s){const n=w(e,t,T[s]);n<i&&(i=n,r=T[s])}return r}function w(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function x(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}m._pool=new o.Z(m),r=f||(f={}),(s=r.DepthOrder||(r.DepthOrder={}))[s.FRONT_TO_BACK=1]="FRONT_TO_BACK",s[s.BACK_TO_FRONT=-1]="BACK_TO_FRONT";const C=[(0,c.f)(-1,-1,-1),(0,c.f)(1,-1,-1),(0,c.f)(-1,1,-1),(0,c.f)(1,1,-1),(0,c.f)(-1,-1,1),(0,c.f)(1,-1,1),(0,c.f)(-1,1,1),(0,c.f)(1,1,1)],T=[(0,c.f)(-1,-1,-1),(0,c.f)(-1,-1,1),(0,c.f)(-1,1,-1),(0,c.f)(-1,1,1),(0,c.f)(1,-1,-1),(0,c.f)(1,-1,1),(0,c.f)(1,1,-1),(0,c.f)(1,1,1)],S=Math.sqrt(3),E=[null],A=(0,d.c)(),M=(0,c.c)(),O=(0,c.c)(),R=(0,c.c)(),P=new a.Z,I=(0,d.c)(),L=(0,d.c)(),D=(0,d.c)(),N=(0,d.c)(),F=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],k=new a.Z,U=[0,0,0,0,0,0,0,0],V=f},12045:(e,t,i)=>{"use strict";i.d(t,{Bh:()=>f,E0:()=>d,IB:()=>l,K5:()=>u,j7:()=>c,je:()=>p,ve:()=>h,wu:()=>o});var r=i(70984),s=i(91907),n=i(17346);const o=(0,n.wK)(s.zi.SRC_ALPHA,s.zi.ONE,s.zi.ONE_MINUS_SRC_ALPHA,s.zi.ONE_MINUS_SRC_ALPHA),a=(0,n.if)(s.zi.ONE,s.zi.ONE),l=(0,n.if)(s.zi.ZERO,s.zi.ONE_MINUS_SRC_ALPHA);function c(e){return e===r.Am.FrontFace?null:e===r.Am.Alpha?l:a}function u(e){return e===r.Am.FrontFace?n.LZ:null}const h=5e5,d={factor:-1,units:-2};function p(e){return e?d:null}function f(e,t=s.wb.LESS){return e===r.Am.NONE||e===r.Am.FrontFace?t:s.wb.LEQUAL}},95194:(e,t,i)=>{"use strict";i.d(t,{$:()=>a});var r=i(61681),s=i(17135),n=i(40017),o=i(6174);class a{constructor(e,t,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new s.Z({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex"),t.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=t.generateBind(n.P.Pass,this),this.bindDraw=t.generateBind(n.P.Draw,this),this._fragmentUniforms=(0,o.hZ)()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2f(e,t,i){this._glProgram.setUniform2f(e,t,i)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3f(e,t,i,r){this._glProgram.setUniform3f(e,t,i,r)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4f(e,t,i,r,s){this._glProgram.setUniform4f(e,t,i,r,s)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if((0,r.Wi)(t)||null==t.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let i=this._textures.get(e);return null==i?(i=this._allocTextureUnit(t),this._textures.set(e,i)):i.texture=t,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(t,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),(0,r.pC)(this._fragmentUniforms)&&this._fragmentUniforms.forEach((e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},4051:(e,t,i)=>{"use strict";i.d(t,{V:()=>c,Y:()=>l});var r=i(61681),s=i(85211),n=i(18435),o=i(7358),a=i(38208);class l{constructor(e,t,i,o=null){this.rctx=e,this.sliceHelper=o,this.lastFrameCamera=new n.V,this.pass=a.C.MATERIAL,this.renderOccludedMask=u,this.bindParameters=new s.p(t,i,(0,r.pC)(o)?o.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=u}get isHighlightPass(){return this.pass===a.C.MATERIAL_HIGHLIGHT}}class c extends l{constructor(e,t,i,r,s){super(e,i,r,s),this.offscreenRenderingHelper=t,this.sliceHelper=s}}const u=o.yD.Occlude|o.yD.OccludeAndTransparent|o.yD.OccludeAndTransparentStencil},96047:(e,t,i)=>{"use strict";i.d(t,{z:()=>g});var r=i(61681),s=i(7958),n=i(24455),o=i(39100),a=i(6766),l=i(1983),c=i(35369),u=i(70984),h=i(36620);class d{constructor(){this.visible=!0}}var p=i(31248),f=i(21414),m=i(73622);class g{constructor(e,t,i={}){this.data=e,this.material=t,this.boundingSphere=(0,l.c)(),this.instanceParameters=new d,this._transformation=(0,o.c)(),this._shaderTransformationDirty=!0,this.layerUid=(0,r.Pt)(i.layerUid,null),this.graphicUid=(0,r.Pt)(i.graphicUid,null),this.id=i.id?i.id:(0,s.D)(),this.boundingInfo=(0,r.Pt)(i.boundingInfo,null),this.calculateShaderTransformation=(0,r.Pt)(i.calculateShaderTransformation,null),this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t,i=(0,c.u1)(e)){(0,r.Wi)(this.boundingInfo)||((0,a.m)(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*i)}get hasShaderTransformation(){return(0,r.pC)(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return(0,r.Wi)(this.calculateShaderTransformation)?(0,r.Pt)(this.transformation,o.I):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=(0,o.c)()),(0,n.c)(this._shaderTransformation,this.calculateShaderTransformation((0,r.Pt)(this.transformation,o.I))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&((0,r.pC)(this._transformation)&&(0,a.m)(e,e,this._transformation),!0);const t=this.indices.get(f.T.POSITION),i=this.vertexAttributes.get(f.T.POSITION);return!!(0,h.cM)(i,t,e)&&((0,r.pC)(this._transformation)&&(0,a.m)(e,e,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new p.O(u.V_.Highlight),t=this.instanceParameters;return t.highlights=(0,m.lr)(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=(0,m.U_)(t.highlights,e)}}},38208:(e,t,i)=>{"use strict";var r;i.d(t,{C:()=>r}),function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"}(r||(r={}))},46378:(e,t,i)=>{"use strict";var r;i.d(t,{r:()=>r}),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"}(r||(r={}))},52694:(e,t,i)=>{"use strict";i.d(t,{L:()=>a,f:()=>r});var r,s,n=i(36663),o=i(67197);(s=r||(r={}))[s.EdgeDetector=0]="EdgeDetector",s[s.BlendWeight=1]="BlendWeight",s[s.Blur=2]="Blur",s[s.COUNT=3]="COUNT";class a extends o.m{constructor(){super(...arguments),this.output=r.EdgeDetector}}(0,n._)([(0,o.o)({count:r.COUNT})],a.prototype,"output",void 0)},5198:(e,t,i)=>{"use strict";i.d(t,{L:()=>b});var r=i(61681),s=i(6766),n=i(44883),o=i(23410),a=i(62039),l=i(9969),c=i(52756),u=i(5474),h=i(95194),d=i(91800),p=i(17346);class f extends c.A{initializeProgram(e){const t=f.shader.get().build(this.configuration);return new h.$(e.rctx,t,u.i)}initializePipeline(){return(0,p.sm)({colorWrite:p.BK})}}f.shader=new l.J(d.S,(()=>i.e(4168).then(i.bind(i,4168))));var m=i(89158),g=i(91907),y=i(18567),_=i(43487),v=i(62486);class b{constructor(e,t,i){this._techniqueRep=e,this._rctx=t,this._requestRender=i,this._enabled=!1,this._ssaoTechniqueConfig=new m.F,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=(0,r.O3)(this.quadVAO)}disposeOffscreenBuffers(){(0,r.yw)(this._ssaoFBO,(e=>e.resize(0,0))),(0,r.yw)(this._blur0FBO,(e=>e.resize(0,0))),(0,r.yw)(this._blur1FBO,(e=>e.resize(0,0)))}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&(0,r.pC)(this._noiseTexture)&&(0,r.pC)(this._ssaoFBO)&&(0,r.pC)(this._blur0FBO)&&(0,r.pC)(this._blur1FBO)}get colorTexture(){return(0,r.pC)(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return(0,r.pC)(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return(0,r.pC)(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(e,t,i){if(!this.enabled||(0,r.Wi)(t)||(0,r.Wi)(i)||(0,r.Wi)(this._noiseTexture)||(0,r.Wi)(this._ssaoFBO)||(0,r.Wi)(this._blur0FBO)||(0,r.Wi)(this._blur1FBO))return;const n=this._rctx,o=e.camera,l=o.fullViewport,c=l[2],u=l[3],h=c/this._blurSizePx,d=u/this._blurSizePx;this._ssaoFBO.resize(c,u),this._blur0FBO.resize(h,d),this._blur1FBO.resize(h,d);const p=1*c,f=1*u;n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,c,u);const m=n.bindTechnique(this._ssaoTechnique,w,e);m.setUniform2f("rnmScale",c/this._noiseTexture.descriptor.width,u/this._noiseTexture.descriptor.height);let y=1/o.computeRenderPixelSizeAtDist(1);m.setUniform1f("projScale",1*y),m.setUniform2f("screenSize",p,f);const _=(0,s.i)(o.eye,o.center);let b=20*o.computeRenderPixelSizeAtDist(_);b=Math.max(.1,b),m.setUniform1f("radius",b),m.setUniform1f("intensity",4*this._attenuation/b**6),m.bindTexture("rnm",this._noiseTexture),m.bindTexture("normalMap",i),m.bindTexture("depthMap",t),(0,r.Wi)(this.quadVAO)&&(this.quadVAO=(0,a.ow)(this._rctx)),n.bindVAO(this.quadVAO),n.drawArrays(g.MX.TRIANGLE_STRIP,0,(0,v._V)(this.quadVAO,"geometry"));const x=n.bindTechnique(this._blurTechnique,w,e);x.bindTexture("tex",this._ssaoFBO.colorTexture),x.bindTexture("normalMap",i),x.bindTexture("depthMap",t),n.setViewport(0,0,p/this._blurSizePx,f/this._blurSizePx),n.bindFramebuffer(this._blur0FBO),x.setUniform2f("screenSize",p,f),x.setUniform2f("blurSize",0,1*this._blurSizePx/f),_>5e4&&(y=Math.max(0,y-(_-5e4))),x.setUniform1f("projScale",y),n.drawArrays(g.MX.TRIANGLE_STRIP,0,(0,v._V)(this.quadVAO,"geometry")),x.setUniform2f("blurSize",1*this._blurSizePx/p,0),n.bindFramebuffer(this._blur1FBO),x.bindTexture("tex",this._blur0FBO.colorTexture),n.drawArrays(g.MX.TRIANGLE_STRIP,0,(0,v._V)(this.quadVAO,"geometry")),n.setViewport(l[0],l[1],l[2],l[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=m.Q.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(f,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=m.Q.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(f,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources((()=>{this._enabled&&this._initialize()})))}_loadResources(e){this._data?e():i.e(174).then(i.bind(i,20174)).then((t=>{this._data=t,e()}))}_initialize(){const e={target:g.No.TEXTURE_2D,pixelFormat:g.VI.RGBA,dataType:g.Br.UNSIGNED_BYTE,samplingMode:g.cw.LINEAR,wrapMode:g.e8.CLAMP_TO_EDGE,width:0,height:0},t={colorTarget:g.Lm.TEXTURE,depthStencilTarget:g.OU.NONE};(0,n.t)(this._data.noiseTexture).then((i=>{this._enabled&&(this._ssaoFBO=new y.X(this._rctx,t,e),this._blur0FBO=new y.X(this._rctx,t,e),this._blur1FBO=new y.X(this._rctx,t,e),this._noiseTexture=new _.x(this._rctx,{target:g.No.TEXTURE_2D,pixelFormat:g.VI.RGBA,dataType:g.Br.UNSIGNED_BYTE,hasMipmap:!0,width:i.width,height:i.height},i),this._requestRender())})),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=(0,r.O3)(this._noiseTexture),this._blur1FBO=(0,r.O3)(this._blur1FBO),this._blur0FBO=(0,r.O3)(this._blur0FBO),this._ssaoFBO=(0,r.O3)(this._ssaoFBO)}get gpuMemoryUsage(){return((0,r.pC)(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+((0,r.pC)(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+((0,r.pC)(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const w=new o.K},89158:(e,t,i)=>{"use strict";i.d(t,{F:()=>a,Q:()=>r});var r,s,n=i(36663),o=i(67197);(s=r||(r={}))[s.SSAO=0]="SSAO",s[s.Blur=1]="Blur",s[s.COUNT=2]="COUNT";class a extends o.m{constructor(){super(...arguments),this.output=r.SSAO}}(0,n._)([(0,o.o)({count:r.COUNT})],a.prototype,"output",void 0)},80876:(e,t,i)=>{"use strict";i.d(t,{i:()=>r,l:()=>T});var r,s,n=i(19431),o=i(61681),a=i(34344),l=i(24455),c=i(39100),u=i(55709),h=i(69666),d=i(6766),p=i(8909),f=i(88589),m=i(1983),g=i(65684),y=i(18435),_=i(15095),v=i(91907),b=i(18567),w=i(43487),x=i(62486);(s=r||(r={}))[s.Highlight=0]="Highlight",s[s.Default=1]="Default";class C{constructor(){this.camera=new y.V,this.lightMat=(0,c.c)()}}class T{constructor(e,t,i=0){this.rctx=e,this.viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,m.c)(),this._cascades=[new C,new C,new C,new C],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=i}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return(0,f.s)(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this.maxNumCascades=(0,n.uZ)(Math.floor(e),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&(0,o.pC)(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(e){const t=this._snapshots.length;if(e>t){const i=e-t;this._snapshots.length=e;for(let e=0;e<i;++e)this._snapshots[t+e]=null}else if(e<this.snapshotCount){const i=t-e;for(let t=0;t<i;++t)this._discardSnapshot(e+t);this._snapshots.length=e}}getSnapshot(e){return this.enabled?this._snapshots[e]:null}getCascades(){for(let e=0;e<this.numCascades;++e)V[e]=this._cascades[e];return V.length=this.numCascades,V}start(e,t,i){(0,_.hu)(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:r,far:s}=this._clampNearFar(i);this._computeCascadeDistances(s,r),this._setupMatrices(e,t);const n=e.viewMatrix,o=e.projectionMatrix;for(let e=0;e<this.numCascades;++e)this._constructCascade(e,o,n,t);this.lastOrigin=null,this.clear()}finish(e){(0,_.hu)(this.enabled),this.rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this.lastOrigin||!(0,d.k)(e,this.lastOrigin)){this.lastOrigin=this.lastOrigin||(0,p.c)(),(0,d.c)(this.lastOrigin,e);for(let t=0;t<this.numCascades;++t){(0,l.j)(z,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)B[16*t+e]=z[e]}}return B}takeCascadeSnapshotTo(e,t){(0,_.hu)(this.enabled);const i=this._ensureSnapshot(t);this._bindFbo();const r=this.rctx,s=r.bindTexture(i,w.x.TEXTURE_UNIT_FOR_UPDATES);r.gl.copyTexSubImage2D(v.No.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),r.bindTexture(s,w.x.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this.rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(v.lk.COLOR_BUFFER_BIT|v.lk.DEPTH_BUFFER_BIT)}_computeTextureSize(e,t){const i=.5*Math.log(e*e+t*t)*Math.LOG2E,r=2**Math.round(i+.35);return Math.min(this.maxTextureSize,2*r)}_ensureDepthTexture(){if((0,o.pC)(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:v.No.TEXTURE_2D,pixelFormat:v.VI.RGBA,dataType:v.Br.UNSIGNED_BYTE,wrapMode:v.e8.CLAMP_TO_EDGE,samplingMode:v.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new w.x(this.rctx,e),this._fbo=new b.X(this.rctx,{colorTarget:v.Lm.TEXTURE,depthStencilTarget:v.OU.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let t=this._snapshots[e];if((0,o.pC)(t)&&t.descriptor.width===this._textureSize)return t;this._discardSnapshot(e);const i={target:v.No.TEXTURE_2D,pixelFormat:v.VI.RGBA,dataType:v.Br.UNSIGNED_BYTE,wrapMode:v.e8.CLAMP_TO_EDGE,samplingMode:v.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return t=new w.x(this.rctx,i),this._snapshots[e]=t,t}_discardDepthTexture(){this._fbo=(0,o.O3)(this._fbo),this._depthTexture=(0,o.O3)(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=(0,o.O3)(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this.snapshotCount;++e)this._discardSnapshot(e)}_bindFbo(){const e=this.rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,t,i,r){const s=this._cascades[e],n=-this._cascadeDistances[e],o=-this._cascadeDistances[e+1],a=(t[10]*n+t[14])/Math.abs(t[11]*n+t[15]),c=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]);(0,_.hu)(a<c);for(let e=0;e<8;++e){(0,f.s)(M,e%4==0||e%4==3?-1:1,e%4==0||e%4==1?-1:1,e<4?a:c,1),(0,f.t)(O[e],M,A);for(let t=0;t<3;++t)O[e][t]/=O[e][3]}(0,d.o)(U,O[0]),(0,l.j)(S,k,U),s.camera.viewMatrix=S;for(let e=0;e<8;++e)(0,d.m)(O[e],O[e],s.camera.viewMatrix);(0,d.c)(R,O[0]),(0,d.c)(P,O[0]);for(let e=1;e<8;++e)for(let t=0;t<3;++t)R[t]=Math.min(R[t],O[e][t]),P[t]=Math.max(P[t],O[e][t]);R[2]-=200,P[2]+=200,s.camera.near=-P[2],s.camera.far=-R[2],this.warp?this._constructTrapezoidalProjection(i,r,s):this._constructOrthogonalProjection(s),(0,l.m)(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const u=this._textureSize/2;s.camera.viewport[0]=e%2==0?0:u,s.camera.viewport[1]=0===Math.floor(e/2)?0:u,s.camera.viewport[2]=u,s.camera.viewport[3]=u}_constructOrthogonalProjection(e){(0,l.q)(e.camera.projectionMatrix,R[0],P[0],R[1],P[1],e.camera.near,e.camera.far)}_constructTrapezoidalProjection(e,t,i){const r=1/O[0][3],s=1/O[4][3];(0,_.hu)(r<s);let o=r+Math.sqrt(r*s);const a=Math.sin((0,n.ZF)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));o/=a,function(e,t,i,r,s,n,o,a){(0,u.a)(H,0,0);for(let t=0;t<4;++t)(0,u.b)(H,H,e[t]);(0,u.f)(H,H,.25),(0,u.a)(j,0,0);for(let t=4;t<8;++t)(0,u.b)(j,j,e[t]);(0,u.f)(j,j,.25),(0,u.l)(G[0],e[4],e[5],.5),(0,u.l)(G[1],e[5],e[6],.5),(0,u.l)(G[2],e[6],e[7],.5),(0,u.l)(G[3],e[7],e[4],.5);let l=0,c=(0,u.s)(G[0],H);for(let e=1;e<4;++e){const t=(0,u.s)(G[e],H);t<c&&(c=t,l=e)}(0,u.g)(W,G[l],e[l+4]);const h=W[0];let d,p;W[0]=-W[1],W[1]=h,(0,u.g)(Z,j,H),(0,u.h)(Z,W)<0&&(0,u.n)(W,W),(0,u.l)(W,W,Z,i),(0,u.i)(W,W),d=p=(0,u.h)((0,u.g)(q,e[0],H),W);for(let t=1;t<8;++t){const i=(0,u.h)((0,u.g)(q,e[t],H),W);i<d?d=i:i>p&&(p=i)}(0,u.c)(r,H),(0,u.f)(q,W,d-t),(0,u.b)(r,r,q);let f=-1,m=1,g=0,y=0;for(let t=0;t<8;++t){(0,u.g)($,e[t],r),(0,u.i)($,$);const i=W[0]*$[1]-W[1]*$[0];i>0?i>f&&(f=i,g=t):i<m&&(m=i,y=t)}(0,_.T)(f>0,"leftArea"),(0,_.T)(m<0,"rightArea"),(0,u.f)(Y,W,d),(0,u.b)(Y,Y,H),(0,u.f)(X,W,p),(0,u.b)(X,X,H),J[0]=-W[1],J[1]=W[0];const v=(0,_.ep)(r,e[y],X,(0,u.b)(q,X,J),1,s),b=(0,_.ep)(r,e[g],X,q,1,n),w=(0,_.ep)(r,e[g],Y,(0,u.b)(q,Y,J),1,o),x=(0,_.ep)(r,e[y],Y,q,1,a);(0,_.T)(v,"rayRay"),(0,_.T)(b,"rayRay"),(0,_.T)(w,"rayRay"),(0,_.T)(x,"rayRay")}(O,o,a,I,L,D,N,F),function(e,t,i,r,s){(0,u.g)(te,i,r),(0,u.f)(te,te,.5),ie[0]=te[0],ie[1]=te[1],ie[2]=0,ie[3]=te[1],ie[4]=-te[0],ie[5]=0,ie[6]=te[0]*te[0]+te[1]*te[1],ie[7]=te[0]*te[1]-te[1]*te[0],ie[8]=1,ie[K(0,2)]=-(0,u.h)(ee(ie,0),e),ie[K(1,2)]=-(0,u.h)(ee(ie,1),e);let n=(0,u.h)(ee(ie,0),i)+ie[K(0,2)],o=(0,u.h)(ee(ie,1),i)+ie[K(1,2)],a=(0,u.h)(ee(ie,0),r)+ie[K(0,2)],l=(0,u.h)(ee(ie,1),r)+ie[K(1,2)];n=-(n+a)/(o+l),ie[K(0,0)]+=ie[K(1,0)]*n,ie[K(0,1)]+=ie[K(1,1)]*n,ie[K(0,2)]+=ie[K(1,2)]*n,n=1/((0,u.h)(ee(ie,0),i)+ie[K(0,2)]),o=1/((0,u.h)(ee(ie,1),i)+ie[K(1,2)]),ie[K(0,0)]*=n,ie[K(0,1)]*=n,ie[K(0,2)]*=n,ie[K(1,0)]*=o,ie[K(1,1)]*=o,ie[K(1,2)]*=o,ie[K(2,0)]=ie[K(1,0)],ie[K(2,1)]=ie[K(1,1)],ie[K(2,2)]=ie[K(1,2)],ie[K(1,2)]+=1,n=(0,u.h)(ee(ie,1),t)+ie[K(1,2)],o=(0,u.h)(ee(ie,2),t)+ie[K(2,2)],a=(0,u.h)(ee(ie,1),i)+ie[K(1,2)],l=(0,u.h)(ee(ie,2),i)+ie[K(2,2)],n=-.5*(n/o+a/l),ie[K(1,0)]+=ie[K(2,0)]*n,ie[K(1,1)]+=ie[K(2,1)]*n,ie[K(1,2)]+=ie[K(2,2)]*n,n=(0,u.h)(ee(ie,1),t)+ie[K(1,2)],o=(0,u.h)(ee(ie,2),t)+ie[K(2,2)],a=-o/n,ie[K(1,0)]*=a,ie[K(1,1)]*=a,ie[K(1,2)]*=a,s[0]=ie[0],s[1]=ie[1],s[2]=0,s[3]=ie[2],s[4]=ie[3],s[5]=ie[4],s[6]=0,s[7]=ie[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=ie[6],s[13]=ie[7],s[14]=0,s[15]=ie[8]}(I,L,N,F,i.camera.projectionMatrix),i.camera.projectionMatrix[10]=2/(R[2]-P[2]),i.camera.projectionMatrix[14]=-(R[2]+P[2])/(R[2]-P[2])}_setupMatrices(e,t){(0,l.m)(E,e.projectionMatrix,e.viewMatrix),(0,l.a)(A,E);const i=this.viewingMode===g.JY.Global?e.eye:(0,d.s)(U,0,0,1);(0,l.n)(k,[0,0,0],[-t[0],-t[1],-t[2]],i)}_clampNearFar(e){let{near:t,far:i}=e;return t<2&&(t=2),i<2&&(i=2),t>=i&&(t=2,i=4),{near:t,far:i}}_computeCascadeDistances(e,t){this.numCascades=Math.min(1+Math.floor((0,_.E6)(e/t,4)),this.maxNumCascades);const i=(e-t)/this.numCascades,r=(e/t)**(1/this.numCascades);let s=t,o=t;for(let e=0;e<this.numCascades+1;++e)this._cascadeDistances[e]=(0,n.t7)(s,o,this.splitSchemeLambda),s*=r,o+=i}get gpuMemoryUsage(){return this._snapshots.reduce(((e,t)=>e+(0,x.un)(t)),this._fbo?.gpuMemoryUsage??0)}get test(){const e=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(t){e.splitSchemeLambda=t},get splitSchemeLambda(){return e.splitSchemeLambda},set warp(t){e.warp=t},get warp(){return e.warp}}}}const S=(0,c.c)(),E=(0,c.c)(),A=(0,c.c)(),M=(0,m.c)(),O=[];for(let e=0;e<8;++e)O.push((0,m.c)());const R=(0,p.c)(),P=(0,p.c)(),I=(0,h.a)(),L=(0,h.a)(),D=(0,h.a)(),N=(0,h.a)(),F=(0,h.a)(),k=(0,c.c)(),U=(0,p.c)(),V=[],z=(0,c.c)(),B=new Float32Array(64),H=(0,h.a)(),j=(0,h.a)(),G=[(0,h.a)(),(0,h.a)(),(0,h.a)(),(0,h.a)()],W=(0,h.a)(),Z=(0,h.a)(),q=(0,h.a)(),$=(0,h.a)(),Y=(0,h.a)(),X=(0,h.a)(),J=(0,h.a)();function K(e,t){return 3*t+e}const Q=(0,h.a)();function ee(e,t){return(0,u.a)(Q,e[t],e[t+3]),Q}const te=(0,h.a)(),ie=(0,a.c)()},65075:(e,t,i)=>{"use strict";i.d(t,{S:()=>y});var r=i(36663),s=i(53443),n=i(86114),o=i(61681),a=i(17135),l=i(81977),c=(i(7753),i(39994),i(7283),i(40266)),u=i(8909),h=i(2236),d=i(8927),p=i(20757),f=i(79341),m=i(74533),g=i(1055);let y=class extends s.Z{constructor(e){super(e),this._pending=new _,this._changes=new h.as,this._materialRenderers=new Map,this._sortedMaterialRenderers=new a.Z,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return(0,n.oE)(this._materialRenderers,(e=>e.rendersOccluded))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=(0,m.q)(this._changes);let t=!1,i=!1,r=!1;return e.forEach(((e,s)=>{let n=this._materialRenderers.get(s);if(!n&&e.adds.length>0&&(n=new g.A(this.rctx,this._materialRepository,s),this._materialRenderers.set(s,n),t=!0,i=!0,r=!0),!n)return;const o=i||n.hasHighlights,a=r||n.hasWater;n.modify(e),i=i||o!==n.hasHighlights,r=r||a!==n.hasWater,n.isEmpty&&(this._materialRenderers.delete(s),n.dispose(),t=!0)})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=(0,n.oE)(this._materialRenderers,(e=>e.hasHighlights))),r&&(this._hasWater=(0,n.oE)(this._materialRenderers,(e=>e.hasWater))),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const i=this._validateRenderGeometries(e);for(const e of i)this._geometries.set(e.id,e);const r=this._pending.empty;for(const e of i)this._pending.adds.add(e);r&&this.notifyChange("updating"),t===f.$.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const t of e)r.has(t)?(this._pending.removed.add(t),r.delete(t)):this._pending.removed.has(t)||this._pending.removes.add(t),this._geometries.delete((0,o.Wg)(t.id));i&&!this._pending.empty&&this.notifyChange("updating"),t===f.$.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=0===this._changes.updates.length;for(const i of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(i),e.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case f.$.State.TRANSFORMATION:case f.$.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case f.$.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((({materialRenderer:i})=>t=i.updateAnimation(e)||t)),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(e.pass,t)}}intersect(e,t,i,r,s){return this._geometries.forEach((n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,i,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,i,t,-o.range,e,s)),s++})),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach(((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})})),this._sortedMaterialRenderers.sort(((e,t)=>{const i=t.material.renderPriority-e.material.renderPriority;return 0!==i?i:e.material.insertOrder-t.material.insertOrder}))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,s,n){if(!e.instanceParameters.visible)return;let a=0;(0,o.pC)(e.transformation)&&(r+=e.transformation[12],a=e.transformation[13]),v[0]=i[0]-r,v[1]=i[1]-a,v[2]=1,b[0]=i[0]-r,b[1]=i[1]-a,b[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,v,b,((i,r,o)=>{!function(e,t,i,r,s,n,o){const a={layerUid:n,graphicUid:o,triangleNr:t},l=t=>{t.set(p.q7.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((null==s.results.min.drapedLayerOrder||i>=s.results.min.drapedLayerOrder)&&(null==s.results.min.dist||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==p.eC.MIN&&(null==s.results.max.drapedLayerOrder||i<s.results.max.drapedLayerOrder)&&(null==s.results.max.dist||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===p.eC.ALL){const e=(0,d.LP)(s.ray);l(e),s.results.all.push(e)}}(t,o,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)}),e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if((0,o.Wi)(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const e=i.graphicUid;(0,o.pC)(e)&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if((0,o.Wi)(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const e=i.graphicUid;(0,o.pC)(e)&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return(0,o.Wi)(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};(0,r._)([(0,l.Cb)()],y.prototype,"drapeSource",void 0),(0,r._)([(0,l.Cb)()],y.prototype,"updating",null),(0,r._)([(0,l.Cb)()],y.prototype,"rctx",null),(0,r._)([(0,l.Cb)()],y.prototype,"rendererContext",void 0),(0,r._)([(0,l.Cb)()],y.prototype,"_materialRepository",null),(0,r._)([(0,l.Cb)()],y.prototype,"_localOriginFactory",null),y=(0,r._)([(0,c.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],y);class _{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const v=(0,u.c)(),b=(0,u.c)()},79040:(e,t,i)=>{"use strict";i.d(t,{JN:()=>n,P7:()=>l,RY:()=>h,YD:()=>f,eD:()=>d,ec:()=>u,iV:()=>c,ii:()=>p,s3:()=>a,zV:()=>o});var r=i(70984),s=i(91907);const n={func:s.wb.LESS},o={func:s.wb.ALWAYS},a={mask:255},l={mask:0},c=e=>({function:{func:s.wb.NOTEQUAL,ref:e,mask:e},operation:{fail:s.xS.KEEP,zFail:s.xS.KEEP,zPass:s.xS.KEEP}}),u=e=>({function:{func:s.wb.ALWAYS,ref:e,mask:e},operation:{fail:s.xS.KEEP,zFail:s.xS.KEEP,zPass:s.xS.REPLACE}}),h={function:{func:s.wb.ALWAYS,ref:r.hU.OutlineVisualElementMask,mask:r.hU.OutlineVisualElementMask},operation:{fail:s.xS.KEEP,zFail:s.xS.KEEP,zPass:s.xS.ZERO}},d={function:{func:s.wb.ALWAYS,ref:r.hU.OutlineVisualElementMask,mask:r.hU.OutlineVisualElementMask},operation:{fail:s.xS.KEEP,zFail:s.xS.KEEP,zPass:s.xS.REPLACE}},p={function:{func:s.wb.EQUAL,ref:r.hU.OutlineVisualElementMask,mask:r.hU.OutlineVisualElementMask},operation:{fail:s.xS.KEEP,zFail:s.xS.KEEP,zPass:s.xS.KEEP}},f={function:{func:s.wb.NOTEQUAL,ref:r.hU.OutlineVisualElementMask,mask:r.hU.OutlineVisualElementMask},operation:{fail:s.xS.KEEP,zFail:s.xS.KEEP,zPass:s.xS.KEEP}}},71667:(e,t,i)=>{"use strict";i.d(t,{V:()=>c});var r=i(30936),s=i(13802),n=i(61681),o=i(95550),a=i(1983);const l=s.Z.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class c{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=0!==e.background.color[3]?this._colorToRGBA(e.background.color):null}fontString(e){const t=this.definition.font;return`${t.style} ${t.weight} ${e}px ${t.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()},${e[3]})`}static async fromSymbol(e,t=1){const i=(0,n.U2)(e,"material","color"),s=(0,n.R2)(i,a.Z,r.Z.toUnitRGBA),u=(0,n.R2)(e.size,12,o.F2),h=e.lineHeight,d=(0,n.pC)(e.background)?r.Z.toUnitRGBA(e.background.color):a.Z,p={family:(0,n.R2)(e.font,"sans-serif",(e=>e.family)),decoration:(0,n.R2)(e.font,"none",(e=>e.decoration)),weight:(0,n.R2)(e.font,"normal",(e=>e.weight)),style:(0,n.R2)(e.font,"normal",(e=>e.style))},f=e.halo,m=(0,n.pC)(f)&&(0,n.pC)(f.color)&&f.size>0?{size:(0,o.F2)(f.size),color:r.Z.toUnitRGBA(f.color)}:{size:0,color:a.Z},g=new c({color:s,size:u,background:{color:d,padding:(0,n.pC)(e.background)?[.65*u,.5*u]:[0,0],borderRadius:(0,n.pC)(e.background)?u*(6/16):0},lineSpacingFactor:h,font:p,halo:m,pixelRatio:t}),y=g.fontString(u);try{await document.fonts.load(y)}catch(e){l.warnOnce(`Failed to preload font '${y}'. Some text symbology may be rendered using the default browser font.`)}return g}}},90670:(e,t,i)=>{"use strict";i.d(t,{GZ:()=>u,tV:()=>o,vU:()=>l});var r=i(19431),s=i(61681),n=i(3289);class o{constructor(e,t,i,r=2048){this.text=e,this._alignment=t,this._parameters=i,this.maxSize=r,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const e=this.lineSpacing*(this._lines.length-1),t=this.lineHeight;return Math.ceil(e+t+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*d}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if((0,s.Wi)(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case l.Left:return this.backgroundHorizontalPadding;case l.Center:return(this.displayWidth-this._lineWidths[e])/2;case l.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[e]}}render(e,t=0,i=0){e.save();const r=t/=this.renderPixelRatio,s=i/=this.renderPixelRatio,o=this.haloSize,a=this.firstLineYOffset;t+=o,i+=a+this.baselinePosition;const l=this.haloSize>0;l&&this._renderHalo(e,r,s,o,a),this._setFontProperties(e,this.renderedFontSize);for(let r=0;r<this._lines.length;++r){const s=this._lines[r],n=this._getLineXOffset(r);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,s,t+n,i),this._renderLineDecoration(e,t+n,i,this._textWidths[r])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,s,t+this._getLineXOffset(r),i),this._renderLineDecoration(e,t+n,i,this._textWidths[r]),i+=this.lineSpacing}if(n.Z.TEXT_SHOW_BASELINE){e.strokeStyle=f,e.setLineDash([2,2]),e.lineWidth=1;let t=s+a;for(let i=0;i<this._lines.length;++i){const i=t+this.baselinePosition;this._drawLine(e,[r,i],[r+this.displayWidth,i]),t+=this.lineSpacing}}if(n.Z.TEXT_SHOW_BORDER&&(e.strokeStyle=f,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[r,s],[this.displayWidth,this.displayHeight])),this.hasBackground){const t=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,r,s,t),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,t,i,r,s=!1){if("none"===this._parameters.definition.font.decoration||0===r)return;const n=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":i+=2*n;break;case"line-through":i-=.33*this.baselinePosition}const o=s?this.haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(n+2*o),e.beginPath(),e.moveTo(this._toRenderUnit(t-o),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(t+r+o),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,t,i,s){t=this._toRenderUnit(t),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;0!==s?(s=(0,r.uZ)(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(t,i+s),e.arcTo(t,i,t+s,i,s),e.lineTo(t+n-s,i),e.arcTo(t+n,i,t+n,i+s,s),e.lineTo(t+n,i+o-s),e.arcTo(t+n,i+o,t+n-s,i+o,s),e.lineTo(t+s,i+o),e.arcTo(t,i+o,t,i+o-s,s),e.closePath()):e.rect(t,i,n,o)}_renderHalo(e,t,i,r,s){const n=this.renderedWidth,o=this.renderedHeight,a=u(h,Math.max(n,p),Math.max(o,p)),l=a.getContext("2d");l.clearRect(0,0,n,o),this._setFontProperties(l,this.renderedFontSize),l.fillStyle=this._parameters.haloStyle,l.strokeStyle=this._parameters.haloStyle;const c=this.renderedHaloSize<3;l.lineJoin=c?"miter":"round",c?this._renderHaloEmulated(l,r,s):this._renderHaloNative(l,r,s);let d=s+this.baselinePosition;for(let e=0;e<this._lines.length;++e){const t=this._getLineXOffset(e);this._renderLineDecoration(l,r+t,d,this._textWidths[e],!0),d+=this.lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(a,0,0,n,o,this._toRenderUnit(t),this._toRenderUnit(i),n,o),e.globalAlpha=1}_renderHaloEmulated(e,t,i){i+=this.baselinePosition;for(let r=0;r<this._lines.length;++r){const s=this._lines[r],n=this._getLineXOffset(r);for(const[r,o]of a)this._fillText(e,s,t+n+this.haloSize*r,i+this.haloSize*o);i+=this.lineSpacing}}_renderHaloNative(e,t,i){const r=2*this.haloSize;i+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s),a=5,l=.1;for(let s=0;s<a;s++){const c=1-(a-1)*l+s*l;e.lineWidth=this._toRenderUnit(c*r),this._strokeText(e,n,t+o,i)}i+=this.lineSpacing}}_setFontProperties(e,t){e.font=this._parameters.fontString(t),e.textAlign="left",e.textBaseline="alphabetic"}_ensureTextWidth(){if((0,s.pC)(this._displayWidth))return this._displayWidth;const e=u(h,p,p).getContext("2d");this._setFontProperties(e,this.fontSize);let t=2*this.haloSize;const i=this._parameters.definition.font;"italic"!==i.style&&"oblique"!==i.style&&"bold"!==i.weight&&"bolder"!==i.weight||(t+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let r=0;for(const i of this._lines){const s=e.measureText(i).width,n=s+t;this._textWidths.push(s),this._lineWidths.push(n),r=Math.max(r,n)}return this._displayWidth=r,this._displayWidth}_ensureHeightMetrics(){if((0,s.Wi)(this._heightMetrics)){const e=u(h,p,p).getContext("2d");this._setFontProperties(e,this.fontSize);const t=e.measureText(this.text+m),i=this.hasBackground?e.measureText(this._lines[0]):t,r=1===this._lines.length?i:this.hasBackground?e.measureText(this._lines[this._lines.length-1]):t,s=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent;this._heightMetrics={paddingTop:t.actualBoundingBoxAscent-i.actualBoundingBoxAscent,paddingBottom:t.actualBoundingBoxDescent-r.actualBoundingBoxDescent,lineHeight:s,baselinePosition:t.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,t,i,r){e.fillText(t,this._toRenderUnit(i),this._toRenderUnit(r))}_strokeText(e,t,i,r){e.strokeText(t,this._toRenderUnit(i),this._toRenderUnit(r))}_drawLine(e,t,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,t,i){const r=this._toRenderUnit(t[0]),s=this._toRenderUnit(t[1]),n=this._toRenderUnit(i[0]),o=this._toRenderUnit(i[1]),a=Math.floor(r)+.5,l=Math.ceil(r+n)-.5,c=Math.floor(s)+.5,u=Math.ceil(s+o)-.5;e.beginPath(),e.moveTo(a,c),e.lineTo(l,c),e.lineTo(l,u),e.lineTo(a,u),e.lineTo(a,c),e.stroke()}}const a=[];{const e=16;for(let t=0;t<360;t+=360/e)a.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var l,c;function u(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}(c=l||(l={}))[c.Left=0]="Left",c[c.Center=1]="Center",c[c.Right=2]="Right";const h={canvas:null},d=.2,p=512,f="rgb(255, 0, 255, 0.5)",m=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})()},44101:(e,t,i)=>{"use strict";i.d(t,{x:()=>L});var r=i(27755),s=i(70375),n=i(31355),o=i(19431),a=i(61681),l=i(78668),c=i(86098),u=i(3466),h=i(44883),d=i(73401),p=i(70984),f=i(99416),m=i(10107),g=i(95399),y=i(13802),_=i(91907),v=i(43487);const b=y.Z.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function w(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const x=w("DXT1"),C=w("DXT3"),T=w("DXT5");function S(e,t){const i=new Int32Array(e,0,31);if(542327876!==i[0])return b.error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return b.error("Unsupported format, must contain a FourCC code"),null;const r=i[21];let s,n;switch(r){case x:s=8,n=_.q_.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case C:s=16,n=_.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case T:s=16,n=_.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return b.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(r)),null}let a=1,l=i[4],c=i[3];0==(3&l)&&0==(3&c)||(b.warn("Rounding up compressed texture size to nearest multiple of 4."),l=l+3&-4,c=c+3&-4);const u=l,h=c;let d,p;131072&i[2]&&!1!==t&&(a=Math.max(1,i[7])),1===a||(0,o.wt)(l)&&(0,o.wt)(c)||(b.warn("Ignoring mipmaps of non power of two sized compressed texture."),a=1);let f=i[1]+4;const m=[];for(let t=0;t<a;++t)p=(l+3>>2)*(c+3>>2)*s,d=new Uint8Array(e,f,p),m.push(d),f+=p,l=Math.max(1,l>>1),c=Math.max(1,c>>1);return{textureData:{type:"compressed",levels:m},internalFormat:n,width:u,height:h}}var E,A,M=i(62039),O=i(15095),R=i(18567),P=i(62486),I=i(79193);class L extends m.c{constructor(e,t){super(),this.data=e,this.type=g.U.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new n.Z,this.params=t||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:_.e8.REPEAT,t:_.e8.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||p.CE.STRETCH,this.estimatedTexMemRequired=L._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const e=this.data;(0,a.Wi)(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!((0,u.jc)(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){(0,u.HK)(e.src)||(0,u.jc)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,t){if((0,a.Wi)(e))return 0;if((0,c.eP)(e)||(0,c.lq)(e))return t.encoding===L.KTX2_ENCODING?(0,f._h)(e,t.mipmap):t.encoding===L.BASIS_ENCODING?(0,f.$u)(e,t.mipmap):e.byteLength;const{width:i,height:r}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?L._getDataDimensions(e):t;return(t.mipmap?4/3:1)*i*r*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(e){return{target:_.No.TEXTURE_2D,pixelFormat:_.VI.RGBA,dataType:_.Br.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?_.cw.LINEAR_MIPMAP_LINEAR:_.cw.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?e.parameters.maxMaxAnisotropy:1)}}get glTexture(){return this._glTexture}load(e,t){if((0,a.pC)(this._glTexture))return this._glTexture;if((0,a.pC)(this._loadingPromise))return this._loadingPromise;const i=this.data;return(0,a.Wi)(i)?(this._glTexture=new v.x(e,this._createDescriptor(e),null),this._glTexture):"string"==typeof i?this._loadFromURL(e,t,i):i instanceof Image?this._loadFromImageElement(e,t,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,t,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i,t):((0,c.eP)(i)||(0,c.lq)(i))&&this.params.encoding===L.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(e,i)):((0,c.eP)(i)||(0,c.lq)(i))&&this.params.encoding===L.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(e,i)):((0,c.eP)(i)||(0,c.lq)(i))&&this.params.encoding===L.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(e,i)):(0,c.lq)(i)?this._loadFromPixelData(e,i):(0,c.eP)(i)?this._loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,i){if(!(this.data instanceof HTMLVideoElement)||(0,a.Wi)(this._glTexture))return i;if(this.data.readyState<E.HAVE_CURRENT_DATA||i===this.data.currentTime)return i;if((0,a.pC)(this._powerOfTwoStretchInfo)){const{framebuffer:i,vao:r,sourceTexture:s}=this._powerOfTwoStretchInfo;s.setData(this.data),this._drawStretchedTexture(e,t,i,r,s,this._glTexture)}else{const{videoWidth:e,videoHeight:t}=this.data,{width:i,height:r}=this._glTexture.descriptor;e!==i||t!==r?this._glTexture.updateData(0,0,0,Math.min(e,i),Math.min(t,r),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(e,t){return this._glTexture=function(e,t,i){const{textureData:r,internalFormat:s,width:n,height:o}=S(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?_.cw.LINEAR_MIPMAP_LINEAR:_.cw.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new v.x(e,t,r)}(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>(0,f.pk)(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>(0,f.fX)(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){(0,O.hu)(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(e);return i.pixelFormat=1===this.params.components?_.VI.LUMINANCE:3===this.params.components?_.VI.RGB:_.VI.RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new v.x(e,i,t),this._glTexture}_loadFromURL(e,t,i){return this._loadAsync((async r=>{const s=await(0,h.t)(i,{signal:r});return(0,l.k_)(r),this._loadFromImage(e,s,t)}))}_loadFromImageElement(e,t,i){return i.complete?this._loadFromImage(e,i,t):this._loadAsync((async r=>{const s=await(0,d.fY)(i,i.src,!1,r);return(0,l.k_)(r),this._loadFromImage(e,s,t)}))}_loadFromVideoElement(e,t,i){return i.readyState>=E.HAVE_CURRENT_DATA?this._loadFromImage(e,i,t):this._loadFromVideoElementAsync(e,t,i)}_loadFromVideoElementAsync(e,t,i){return this._loadAsync((r=>new Promise(((n,o)=>{const c=()=>{i.removeEventListener("loadeddata",u),i.removeEventListener("error",h),(0,a.hw)(d)},u=()=>{i.readyState>=E.HAVE_CURRENT_DATA&&(c(),n(this._loadFromImage(e,i,t)))},h=e=>{c(),o(e||new s.Z("Failed to load video"))};i.addEventListener("loadeddata",u),i.addEventListener("error",h);const d=(0,l.fu)(r,(()=>h((0,l.zE)())))}))))}_loadFromImage(e,t,i){const r=L._getDataDimensions(t);this.params.width=r.width,this.params.height=r.height;const s=this._createDescriptor(e);return s.pixelFormat=3===this.params.components?_.VI.RGB:_.VI.RGBA,!this._requiresPowerOfTwo(e,s)||(0,o.wt)(r.width)&&(0,o.wt)(r.height)?(s.width=r.width,s.height=r.height,this._glTexture=new v.x(e,s,t),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,t,r,s,i),this._glTexture)}_loadAsync(e){const t=new AbortController;this._loadingController=t;const i=e(t.signal);this._loadingPromise=i;const r=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(r,r),i}_requiresPowerOfTwo(e,t){const i=_.e8.CLAMP_TO_EDGE,r="number"==typeof t.wrapMode?t.wrapMode===i:t.wrapMode.s===i&&t.wrapMode.t===i;return!(0,I.Z)(e.gl)&&(t.hasMipmap||!r)}_makePowerOfTwoTexture(e,t,i,s,n){const{width:a,height:l}=i,c=(0,o.Sf)(a),u=(0,o.Sf)(l);let h;switch(s.width=c,s.height=u,this.params.powerOfTwoResizeMode){case p.CE.PAD:s.textureCoordinateScaleFactor=[a/c,l/u],h=new v.x(e,s),h.updateData(0,0,0,a,l,t);break;case p.CE.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(e,t,s,n());break;default:(0,r.Bg)(this.params.powerOfTwoResizeMode)}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(e,t,i,r){const s=new v.x(e,i),n=new R.X(e,{colorTarget:_.Lm.TEXTURE,depthStencilTarget:_.OU.NONE},s),o=new v.x(e,{target:_.No.TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:_.Br.UNSIGNED_BYTE,wrapMode:_.e8.CLAMP_TO_EDGE,samplingMode:_.cw.LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},t),a=(0,M.ow)(e),l=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,r,n,a,o,s),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:a,sourceTexture:o,framebuffer:n}:(a.dispose(!0),o.dispose(),n.detachColorTexture(),n.dispose()),e.bindFramebuffer(l),s}_drawStretchedTexture(e,t,i,r,s,n){e.bindFramebuffer(i);const o=e.getViewport();e.setViewport(0,0,n.descriptor.width,n.descriptor.height);const a=e.bindTechnique(t);a.setUniform4f("uColor",1,1,1,1),a.bindTexture("tex",s),e.bindVAO(r),e.drawArrays(_.MX.TRIANGLE_STRIP,0,(0,P._V)(r,"geometry")),e.bindFramebuffer(null),e.setViewport(o.x,o.y,o.width,o.height)}unload(){if((0,a.pC)(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:i}=this._powerOfTwoStretchInfo;t.dispose(!0),i.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if((0,a.pC)(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),(0,a.pC)(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}L.DDS_ENCODING="image/vnd-ms.dds",L.KTX2_ENCODING="image/ktx2",L.BASIS_ENCODING="image/x.basis",(A=E||(E={}))[A.HAVE_NOTHING=0]="HAVE_NOTHING",A[A.HAVE_METADATA=1]="HAVE_METADATA",A[A.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",A[A.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",A[A.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"},22635:(e,t,i)=>{"use strict";i.d(t,{K:()=>u});var r=i(86243),s=i(9969),n=i(52756),o=i(5474),a=i(95194),l=i(91907),c=i(17346);class u extends n.A{initializeProgram(e){const t=u.shader.get().build();return new a.$(e.rctx,t,o.i)}initializePipeline(){return this.configuration.hasAlpha?(0,c.sm)({blending:(0,c.wK)(l.zi.SRC_ALPHA,l.zi.ONE,l.zi.ONE_MINUS_SRC_ALPHA,l.zi.ONE_MINUS_SRC_ALPHA),colorWrite:c.BK}):(0,c.sm)({colorWrite:c.BK})}}u.shader=new s.J(r.T,(()=>i.e(4587).then(i.bind(i,44587))))},46240:(e,t,i)=>{"use strict";i.d(t,{V:()=>n});var r=i(36663),s=i(67197);class n extends s.m{constructor(){super(...arguments),this.hasAlpha=!1}}(0,r._)([(0,s.o)()],n.prototype,"hasAlpha",void 0)},15095:(e,t,i)=>{"use strict";i.d(t,{E6:()=>d,Kj:()=>m,RQ:()=>_,T:()=>l,ep:()=>u,hu:()=>a,iV:()=>h,kG:()=>f,tM:()=>y,u_:()=>p,yK:()=>c,zF:()=>g});var r=i(69666),s=i(88589);const n=(0,i(1983).c)();class o{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function a(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new o(t)}function l(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function c(e,t,i,r){let s,n=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],u=(r[2]-e[2])/t[2];return c>u&&(s=c,c=u,u=s),!(n>u||c>o||(u<o&&(o=u),o<0))}function u(e,t,i,s,n,o=(0,r.a)()){const a=(s[n]-i[n])*(t[0]-e[0])-(s[0]-i[0])*(t[n]-e[n]),l=(s[0]-i[0])*(e[n]-i[n])-(s[n]-i[n])*(e[0]-i[0]);if(0===a)return!1;const c=l/a;return o[0]=e[0]+c*(t[0]-e[0]),o[1]=e[n]+c*(t[n]-e[n]),!0}function h(e,t,i,r,o){o||(o=e),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1,(0,s.t)(n,n,t),o.length>2&&(o[2]=-n[2]),(0,s.t)(n,n,i),a(0!==n[3]),o[0]=n[0]/n[3],o[1]=n[1]/n[3],o[2]=n[2]/n[3],o[0]=(.5*o[0]+.5)*r[2]+r[0],o[1]=(.5*o[1]+.5)*r[3]+r[1]}function d(e,t){return Math.log(e)/Math.log(t)}function p(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function f(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}function m(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function g(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function y(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function _(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}},21414:(e,t,i)=>{"use strict";var r;i.d(t,{T:()=>r}),function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"}(r||(r={}))},26982:(e,t,i)=>{"use strict";i.d(t,{F:()=>d,e:()=>p});var r=i(31355),s=i(44584),n=i(61681),o=i(17135),a=i(70984),l=i(10107),c=i(95399);const u=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var h=i(20766);class d extends l.c{constructor(e,t=""){super(),this.apiLayerUid=t,this.type=c.U.Layer,this.events=new r.Z,this.isSliceable=!1,this._objects=new o.Z,this._stageHandles=new s.Z,this.apiLayerUid=t,this.isVisible=e?.isVisible??!0,this.isPickable=e?.isPickable??!0,this.updatePolicy=e?.updatePolicy??a.jq.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of u)this._stageHandles.add(this.events.on(t,(i=>e.handleEvent(t,i))))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),(0,n.pC)(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),(0,n.pC)(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),(0,n.pC)(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),(0,n.pC)(this._octree)&&this._octree.remove(t)}}sync(){(0,n.pC)(this._stage)&&this.updatePolicy!==a.jq.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){(0,n.pC)(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return(0,n.Wi)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=(0,n.SC)(this._octree)}_createOctree(){this._octree=new h.Z((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)}}function p(e){return(0,n.pC)(e)&&e.type===c.U.Layer}},70984:(e,t,i)=>{"use strict";var r,s,n,o,a,l,c,u,h,d,p,f,m,g;i.d(t,{Am:()=>o,CE:()=>p,C_:()=>n,Gv:()=>s,Iq:()=>g,JJ:()=>m,MX:()=>d,Rw:()=>l,V_:()=>h,Vr:()=>r,Xx:()=>a,Yg:()=>f,hU:()=>c,jq:()=>u}),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(s||(s={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(n||(n={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(o||(o={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(a||(a={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(l||(l={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(c||(c={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(u||(u={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(h||(h={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(d||(d={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(p||(p={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(f||(f={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(m||(m={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(g||(g={}))},5843:(e,t,i)=>{"use strict";i.r(t),i.d(t,{EdgeProcessingWorker:()=>h,default:()=>C,extract:()=>d,extractComponentsEdgeLocationsLayout:()=>x,extractEdgeLocationsLayout:()=>w});var r=i(67262);function s(e,t,i){const r=t/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(e,t)=>{e<t?s[e+1]++:n[t+1]++};for(let t=0;t<r;t++){const i=e[3*t],r=e[3*t+1],s=e[3*t+2];o(i,r),o(r,s),o(s,i)}let a=0,l=0;for(let e=0;e<i;e++){const t=s[e+1],i=n[e+1];s[e+1]=a,n[e+1]=l,a+=t,l+=i}const c=new Uint32Array(6*r),u=s[i],h=(e,t,i)=>{if(e<t){const r=s[e+1]++;c[2*r]=t,c[2*r+1]=i}else{const r=n[t+1]++;c[2*u+2*r]=e,c[2*u+2*r+1]=i}};for(let t=0;t<r;t++){const i=e[3*t],r=e[3*t+1],s=e[3*t+2];h(i,r,t),h(r,s,t),h(s,i,t)}const d=(e,t)=>{const i=2*e,r=t-e;for(let e=1;e<r;e++){const t=c[i+2*e],r=c[i+2*e+1];let s=e-1;for(;s>=0&&c[i+2*s]>t;s--)c[i+2*s+2]=c[i+2*s],c[i+2*s+3]=c[i+2*s+1];c[i+2*s+2]=t,c[i+2*s+3]=r}};for(let e=0;e<i;e++)d(s[e],s[e+1]),d(u+n[e],u+n[e+1]);const p=new Int32Array(3*r),f=(t,i)=>t===e[3*i]?0:t===e[3*i+1]?1:t===e[3*i+2]?2:-1,m=(e,t)=>{const i=f(e,t);p[3*t+i]=-1},g=(e,t,i,r)=>{const s=f(e,t);p[3*t+s]=r;const n=f(i,r);p[3*r+n]=t};for(let e=0;e<i;e++){let t=s[e];const i=s[e+1];let r=n[e];const o=n[e+1];for(;t<i&&r<o;){const i=c[2*t],s=c[2*u+2*r];i===s?(g(e,c[2*t+1],s,c[2*u+2*r+1]),t++,r++):i<s?(m(e,c[2*t+1]),t++):(m(s,c[2*u+2*r+1]),r++)}for(;t<i;)m(e,c[2*t+1]),t++;for(;r<o;)m(c[2*u+2*r],c[2*u+2*r+1]),r++}return p}var n=i(44685),o=i(26691),a=i(21414),l=i(82976),c=i(68083),u=i(11591);class h{async extract(e){const t=p(e),i=d(t),r=[t.data.buffer];return{result:f(i,r),transferList:r}}async extractComponentsEdgeLocations(e){const t=p(e),i=m(t.data,t.skipDeduplicate,t.indices,t.indicesLength),r=(0,u.n)(i,v,b),s=[];return{result:(0,o.HL)(r.regular.instancesData,s),transferList:s}}async extractEdgeLocations(e){const t=p(e),i=m(t.data,t.skipDeduplicate,t.indices,t.indicesLength),r=(0,u.n)(i,_,b),s=[];return{result:(0,o.HL)(r.regular.instancesData,s),transferList:s}}}function d(e){const t=m(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return g.updateSettings(e.writerSettings),y.updateSettings(e.writerSettings),(0,u.n)(t,g,y)}function p(e){return{data:l.tf.createView(e.dataBuffer),indices:"Uint32Array"===e.indicesType?new Uint32Array(e.indicesBuffer):"Uint16Array"===e.indicesType?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function f(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:(0,o.HL)(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:(0,o.HL)(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function m(e,t,i,n){if(t)return{faces:i,facesLength:n,neighbors:s(i,n,e.count),vertices:e};const o=(0,r.d)(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:n}),a=s(o.indices,n,o.uniqueCount);return{faces:o.indices,facesLength:o.indices.length,neighbors:a,vertices:l.tf.createView(o.buffer)}}const g=new c.D9,y=new c.qE,_=new class{allocate(e){return w.createBuffer(e)}trim(e,t){return e.slice(0,t)}write(e,t,i){e.position0.setVec(t,i.position0),e.position1.setVec(t,i.position1)}},v=new class{allocate(e){return x.createBuffer(e)}trim(e,t){return e.slice(0,t)}write(e,t,i){e.position0.setVec(t,i.position0),e.position1.setVec(t,i.position1),e.componentIndex.set(t,i.componentIndex)}},b={allocate:()=>null,write:()=>{},trim:()=>null},w=(0,n.U$)().vec3f(a.T.POSITION0).vec3f(a.T.POSITION1),x=(0,n.U$)().vec3f(a.T.POSITION0).vec3f(a.T.POSITION1).u16(a.T.COMPONENTINDEX).u16(a.T.U16PADDING,{glPadding:!0});function C(){return new h}},93396:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var r=i(86098),s=i(12916),n=i(26691),o=i(5843);class a extends s.q{constructor(e){super("EdgeProcessingWorker","extract",{extract:e=>[e.dataBuffer],extractComponentsEdgeLocations:e=>[e.dataBuffer],extractEdgeLocations:e=>[e.dataBuffer]},e)}async process(e,t,i){if(i)return(0,o.extract)(e);const r=this._packInput(e),s=await this.invoke(r,t);return this._unpackOutput(s)}async extractEdgeLocations(e,t){const i=this._packInput(e),r=await this.invokeMethod("extractEdgeLocations",i,t);return(0,n.aj)(r)}async extractComponentsEdgeLocations(e,t){const i=this._packInput(e),r=await this.invokeMethod("extractComponentsEdgeLocations",i,t);return(0,n.aj)(r)}_packInput(e){return{dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate,indicesBuffer:e.indices.buffer,indicesType:(0,r.ZY)(e.indices)?"Uint32Array":"Uint16Array",indicesLength:e.indicesLength}}_unpackOutput(e){return{regular:{instancesData:(0,n.aj)(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:(0,n.aj)(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}}},82976:(e,t,i)=>{"use strict";i.d(t,{Hr:()=>h,dG:()=>u,dx:()=>l,rD:()=>a,so:()=>d,tf:()=>o});var r=i(95397),s=i(44685),n=i(21414);const o=(0,s.U$)().vec3f(n.T.POSITION).u16(n.T.COMPONENTINDEX).u16(n.T.U16PADDING),a=(0,s.U$)().vec2u8(n.T.SIDENESS),l=(0,r.K)(a),c=(0,s.U$)().vec3f(n.T.POSITION0).vec3f(n.T.POSITION1).u16(n.T.COMPONENTINDEX).u8(n.T.VARIANTOFFSET,{glNormalized:!0}).u8(n.T.VARIANTSTROKE).u8(n.T.VARIANTEXTENSION,{glNormalized:!0}).u8(n.T.U8PADDING,{glPadding:!0}).u16(n.T.U16PADDING,{glPadding:!0}),u=c.clone().vec3f(n.T.NORMAL),h=c.clone().vec3f(n.T.NORMALA).vec3f(n.T.NORMALB),d=new Map([[n.T.POSITION0,0],[n.T.POSITION1,1],[n.T.COMPONENTINDEX,2],[n.T.VARIANTOFFSET,3],[n.T.VARIANTSTROKE,4],[n.T.VARIANTEXTENSION,5],[n.T.NORMAL,6],[n.T.NORMALA,6],[n.T.NORMALB,7],[n.T.SIDENESS,8]])},68083:(e,t,i)=>{"use strict";i.d(t,{D9:()=>m,qE:()=>g});var r=i(4157),s=i(6766),n=i(8909),o=i(95397),a=i(82976);class l{updateSettings(e){this.settings=e,this.edgeHashFunction=e.reducedPrecision?p:d}write(e,t,i){const r=this.edgeHashFunction(i);_.seed=r;const s=_.getIntRange(0,255),n=_.getIntRange(0,this.settings.variants-1),o=_.getFloat(),a=255*(.5*function(e,t){const i=e<0?-1:1;return Math.abs(e)**1.2*i}(-(1-Math.min(o/.7,1))+Math.max(0,o-.7)/(1-.7))+.5);e.position0.setVec(t,i.position0),e.position1.setVec(t,i.position1),e.componentIndex.set(t,i.componentIndex),e.variantOffset.set(t,s),e.variantStroke.set(t,n),e.variantExtension.set(t,a)}trim(e,t){return e.slice(0,t)}}const c=new Float32Array(6),u=new Uint32Array(c.buffer),h=new Uint32Array(1);function d(e){const t=c;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],h[0]=5381;for(let e=0;e<u.length;e++)h[0]=31*h[0]+u[e];return h[0]}function p(e){const t=c;t[0]=f(e.position0[0]),t[1]=f(e.position0[1]),t[2]=f(e.position0[2]),t[3]=f(e.position1[0]),t[4]=f(e.position1[1]),t[5]=f(e.position1[2]),h[0]=5381;for(let e=0;e<u.length;e++)h[0]=31*h[0]+u[e];return h[0]}function f(e){return Math.round(1e4*e)/1e4}class m{constructor(){this.commonWriter=new l}updateSettings(e){this.commonWriter.updateSettings(e)}allocate(e){return a.dG.createBuffer(e)}write(e,t,i){this.commonWriter.write(e,t,i),(0,s.a)(y,i.faceNormal0,i.faceNormal1),(0,s.n)(y,y),e.normal.setVec(t,y)}trim(e,t){return this.commonWriter.trim(e,t)}}m.Layout=a.dG,m.glLayout=(0,o.K)(a.dG,1);class g{constructor(){this.commonWriter=new l}updateSettings(e){this.commonWriter.updateSettings(e)}allocate(e){return a.Hr.createBuffer(e)}write(e,t,i){this.commonWriter.write(e,t,i),e.normalA.setVec(t,i.faceNormal0),e.normalB.setVec(t,i.faceNormal1)}trim(e,t){return this.commonWriter.trim(e,t)}}g.Layout=a.Hr,g.glLayout=(0,o.K)(a.Hr,1);const y=(0,n.c)(),_=new r.Z},11591:(e,t,i)=>{"use strict";i.d(t,{P:()=>c,n:()=>h});var r=i(7753),s=i(19431),n=i(86098),o=i(6766),a=i(8909);const l=-1;var c,u;function h(e,t,i,a=_){const c=e.vertices.position,u=e.vertices.componentIndex,h=(0,s.Vl)(a.anglePlanar),y=(0,s.Vl)(a.angleSignificantEdge),v=Math.cos(y),b=Math.cos(h),w=g.edge,x=w.position0,C=w.position1,T=w.faceNormal0,S=w.faceNormal1,E=m(e),A=function(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let s=0;for(let e=0;e<t;e++){const t=r[3*e+0],n=r[3*e+1],o=r[3*e+2],a=i[3*e+0],c=i[3*e+1],u=i[3*e+2];s+=t===l||a<c?1:0,s+=n===l||c<u?1:0,s+=o===l||u<a?1:0}const n=new Int32Array(4*s);let o=0;for(let e=0;e<t;e++){const t=r[3*e+0],s=r[3*e+1],a=r[3*e+2],c=i[3*e+0],u=i[3*e+1],h=i[3*e+2];(t===l||c<u)&&(n[o++]=c,n[o++]=u,n[o++]=e,n[o++]=t),(s===l||u<h)&&(n[o++]=u,n[o++]=h,n[o++]=e,n[o++]=s),(a===l||h<c)&&(n[o++]=h,n[o++]=c,n[o++]=e,n[o++]=a)}return n}(e),M=A.length/4,O=t.allocate(M);let R=0;const P=M,I=i.allocate(P);let L=0,D=0,N=0;const F=(0,r.w6)(0,M),k=new Float32Array(M);(0,n.Ed)(k,((e,t,i)=>{c.getVec(A[4*t+0],x),c.getVec(A[4*t+1],C),i[t]=(0,o.i)(x,C)})),F.sort(((e,t)=>k[t]-k[e]));const U=new Array,V=new Array;for(let e=0;e<M;e++){const r=F[e],s=k[r],n=A[4*r+0],a=A[4*r+1],m=A[4*r+2],g=A[4*r+3],y=g===l;if(c.getVec(n,x),c.getVec(a,C),y)(0,o.s)(T,E[3*m+0],E[3*m+1],E[3*m+2]),(0,o.c)(S,T),w.componentIndex=u.get(n),w.cosAngle=(0,o.e)(T,S);else{if((0,o.s)(T,E[3*m+0],E[3*m+1],E[3*m+2]),(0,o.s)(S,E[3*g+0],E[3*g+1],E[3*g+2]),w.componentIndex=u.get(n),w.cosAngle=(0,o.e)(T,S),p(w,b))continue;w.cosAngle<-.9999&&(0,o.c)(S,T)}D+=s,N++,y||d(w,v)?(t.write(O,R++,w),U.push(s)):f(w,h)&&(i.write(I,L++,w),V.push(s))}const z=new Float32Array(U.reverse()),B=new Float32Array(V.reverse());return{regular:{instancesData:t.trim(O,R),lodInfo:{lengths:z}},silhouette:{instancesData:i.trim(I,L),lodInfo:{lengths:B}},averageEdgeLength:D/N}}function d(e,t){return e.cosAngle<t}function p(e,t){return e.cosAngle>t}function f(e,t){const i=(0,s.ZF)(e.cosAngle),r=g.fwd,n=g.ortho;return(0,o.r)(r,e.position1,e.position0),i*((0,o.e)((0,o.f)(n,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function m(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,s=y.v0,n=y.v1,a=y.v2,l=new Float32Array(3*t);for(let e=0;e<t;e++){const t=r[3*e+0],c=r[3*e+1],u=r[3*e+2];i.getVec(t,s),i.getVec(c,n),i.getVec(u,a),(0,o.b)(n,n,s),(0,o.b)(a,a,s),(0,o.f)(s,n,a),(0,o.n)(s,s),l[3*e+0]=s[0],l[3*e+1]=s[1],l[3*e+2]=s[2]}return l}(u=c||(c={}))[u.SOLID=0]="SOLID",u[u.SKETCH=1]="SKETCH";const g={edge:{position0:(0,a.c)(),position1:(0,a.c)(),faceNormal0:(0,a.c)(),faceNormal1:(0,a.c)(),componentIndex:0,cosAngle:0},ortho:(0,a.c)(),fwd:(0,a.c)()},y={v0:(0,a.c)(),v1:(0,a.c)(),v2:(0,a.c)()},_={anglePlanar:4,angleSignificantEdge:35}},75427:(e,t,i)=>{"use strict";var r;i.d(t,{i:()=>r}),function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"}(r||(r={}))},36620:(e,t,i)=>{"use strict";i.d(t,{DX:()=>u,NO:()=>d,cM:()=>h,p:()=>c,qZ:()=>p});var r=i(6766),s=i(8909),n=i(42772);let o=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const a=new Uint16Array([0]),l=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function c(e){if(1===e)return a;if(e<l.length)return new Uint16Array(l.buffer,0,e);if(e>o.length){const t=Math.max(2*o.length,e);o=new Uint32Array(t);for(let e=0;e<o.length;e++)o[e]=e}return new Uint32Array(o.buffer,0,e)}function u(e){if(1===e)return new Uint16Array(a);if(e<l.length)return new Uint16Array(l.slice(0,e));if(e>o.length){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}return new Uint32Array(o.slice(0,e))}function h(e,t,i){if(!e)return!1;const{size:s,data:o}=e;(0,r.s)(i,0,0,0),(0,r.s)(y,0,0,0);let a=0,l=0;for(let e=0;e<t.length-2;e+=3){const c=t[e+0]*s,u=t[e+1]*s,h=t[e+2]*s;(0,r.s)(f,o[c+0],o[c+1],o[c+2]),(0,r.s)(m,o[u+0],o[u+1],o[u+2]),(0,r.s)(g,o[h+0],o[h+1],o[h+2]);const d=(0,n.bE)(f,m,g);d?((0,r.a)(f,f,m),(0,r.a)(f,f,g),(0,r.g)(f,f,1/3*d),(0,r.a)(i,i,f),a+=d):((0,r.a)(y,y,f),(0,r.a)(y,y,m),(0,r.a)(y,y,g),l+=3)}return!(0===l&&0===a||(0!==a?((0,r.g)(i,i,1/a),0):0===l||((0,r.g)(i,y,1/l),0)))}function d(e,t,i){if(!e||!t)return!1;const{size:s,data:n}=e;(0,r.s)(i,0,0,0);let o=-1,a=0;for(let e=0;e<t.length;e++){const r=t[e]*s;o!==r&&(i[0]+=n[r+0],i[1]+=n[r+1],i[2]+=n[r+2],a++),o=r}return a>1&&(0,r.g)(i,i,1/a),a>0}function p(e,t,i,s){if(!e)return!1;const{size:n,data:o}=e;(0,r.s)(s,0,0,0),(0,r.s)(y,0,0,0);let a=0,l=0;const c=t?t.length-1:o.length/n-1,u=c+(i?2:0);for(let e=0;e<u;e+=2){const i=e<c?e:c,u=e<c?e+1:0,h=(t?t[i]:i)*n,d=(t?t[u]:u)*n;f[0]=o[h+0],f[1]=o[h+1],f[2]=o[h+2],m[0]=o[d+0],m[1]=o[d+1],m[2]=o[d+2],(0,r.g)(f,(0,r.a)(f,f,m),.5);const p=(0,r.j)(f,m);p>0?((0,r.a)(s,s,(0,r.g)(f,f,p)),a+=p):((0,r.a)(y,y,f),l++)}return 0!==a?((0,r.g)(s,s,1/a),!0):0!==l&&((0,r.g)(s,y,1/l),!0)}const f=(0,s.c)(),m=(0,s.c)(),g=(0,s.c)(),y=(0,s.c)()},62039:(e,t,i)=>{"use strict";i.d(t,{E9:()=>u,YO:()=>d,hf:()=>p,l_:()=>h,ow:()=>c});var r=i(5474),s=i(71299),n=i(78951),o=i(91907),a=i(43487),l=i(29620);function c(e,t=s.QI,i=r.i,a=-1,c=1){let u=null;return u=t===s.Bn?new Float32Array([a,a,0,0,c,a,1,0,a,c,0,1,c,c,1,1]):new Float32Array([a,a,c,a,a,c,c,c]),new l.U(e,i,{geometry:t},{geometry:n.f.createVertex(e,o.l1.STATIC_DRAW,u)})}function u(e,t=s.QI,i=r.i){const a=new Float32Array([-1,-1,3,-1,-1,3]);return new l.U(e,i,{geometry:t},{geometry:n.f.createVertex(e,o.l1.STATIC_DRAW,a)})}function h(e,t=4){return new a.x(e,{target:o.No.TEXTURE_2D,pixelFormat:o.VI.RGBA,dataType:o.Br.UNSIGNED_BYTE,samplingMode:o.cw.NEAREST,width:t,height:t})}function d(e,t,i=4){const r=new Uint8Array(i*i*4);for(let e=0;e<r.length;e+=4)r[e+0]=255*t[0],r[e+1]=255*t[1],r[e+2]=255*t[2],r[e+3]=255*t[3];return new a.x(e,{target:o.No.TEXTURE_2D,pixelFormat:o.VI.RGBA,dataType:o.Br.UNSIGNED_BYTE,samplingMode:o.cw.NEAREST,width:i,height:i},r)}function p(e){return new a.x(e,{target:o.No.TEXTURE_2D,pixelFormat:o.VI.RGBA,dataType:o.Br.UNSIGNED_BYTE,samplingMode:o.cw.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}},66218:(e,t,i)=>{"use strict";i.d(t,{G1:()=>h,e4:()=>c,es:()=>u,nn:()=>l});var r=i(61681),s=i(6766),n=i(8909),o=i(96739),a=i(20757);function l(e){return(0,r.pC)(e)&&(0,r.pC)(e.dist)}function c(e){return(t,i,r)=>((0,s.h)(d,t,i,r),!(0,o.e)(e,d))}function u(e){return l(e)&&e.intersector===a.q7.OBJECT&&!!e.target}function h(e){return l(e)&&e.intersector===a.q7.HUD&&!!e.target&&(0,r.pC)(e.target.center)}const d=(0,n.c)()},5865:(e,t,i)=>{"use strict";i.d(t,{VB:()=>_,_s:()=>v,tB:()=>f,bK:()=>m,J4:()=>p});var r=i(61681),s=i(24455),n=i(8909),o=i(37116),a=i(91917),l=i(94576),c=i(87564),u=i(66218),h=i(20757);function d(e){return(0,u.nn)(e)&&e.intersector===h.q7.LOD&&!!e.target}function p(e,t){return(0,u.es)(e)||(0,u.G1)(e)?y(e.target.object.metadata,t):(0,c.T)(e)?t.map?.ground:(0,l.a)(e)||(0,l.G)(e)||(0,c.j)(e)?y(e.target,t):null}function f(e,t){const i=m(e,t);return(0,r.pC)(i)&&"graphic"===i.type?i.graphic:null}function m(e,t){if((0,r.Wi)(e))return null;if((0,u.es)(e)||(0,u.G1)(e))return g(e.target.object.metadata,t);if((0,l.a)(e)){const t=e.target.createGraphic();return{type:"graphic",graphic:t,layer:t.layer}}return(0,c.j)(e)||d(e)?g(e.target,t):(0,l.G)(e)?function(e,t){const i=y(e,t);if((0,r.Wi)(i))return null;const s=t.allLayerViews.find((e=>e.layer===i));return s&&!s.suspended&&"getGraphicFromIntersectorTarget"in s?(n=s.getGraphicFromIntersectorTarget(e),(0,r.pC)(n)?{type:"graphic",graphic:n,layer:n.layer}:null):null;var n}(e.target,t):null}function g(e,t){if((0,r.Wi)(e)||(0,r.Wi)(e.graphicUid))return null;const i=y(e,t);if((0,r.Wi)(i))return null;if(i===t.graphics)return(0,r.Wi)(t.graphicsView)||"number"!=typeof e.graphicUid?null:t.graphicsView.getHit(e.graphicUid);const s=t.allLayerViews.find((e=>e.layer===i));return!s||s.suspended||(0,r.Wi)(e.graphicUid)?null:"getHit"in s?s.getHit(e.graphicUid):null}function y(e,t){return(0,r.Wi)(e.layerUid)?null:(0,r.pC)(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function _(e,t){if((0,u.es)(e)||(0,u.G1)(e))return(0,a.d)(e.target.object.boundingVolumeWorldSpace.bounds);if(d(e)){(0,s.x)(b,e.transformation);const t=Math.max(b[0],b[1],b[2]);return e.target.baseBoundingSphere.radius*t}return(0,l.G)(e)?(0,r.yw)(function(e,t){const i=y(e,t);if((0,r.Wi)(i))return null;const s=t.allLayerViews.find((e=>e.layer===i));return s&&!s.suspended&&"getAABBFromIntersectorTarget"in s?s.getAABBFromIntersectorTarget(e):null}(e.target,t),(e=>.5*(0,o.wz)(e))):null}function v(e){return!(0,u.es)(e)&&!(0,u.G1)(e)&&(d(e)?e.target.numLodLevels>1:!!(0,l.G)(e))}const b=(0,n.c)()},3248:(e,t,i)=>{"use strict";i.d(t,{HI:()=>l,VQ:()=>n,VV:()=>o,aH:()=>s,ci:()=>a});var r=i(7753);function s(e){const t=[];return e.levels.forEach((e=>{e.components.forEach((e=>{t.push(e.material)}))})),(0,r.Tw)(t)}function n(e){const t=new Array;return e.levels.forEach((e=>{e.components.forEach((e=>{e.textures&&t.push(...e.textures)}))})),(0,r.Tw)(t)}function o(e){const t=[];return e.components.forEach((e=>{t.push(e.geometry)})),(0,r.Tw)(t)}function a(e){const t=[];return e.levels.forEach((e=>{e.components.forEach((e=>{t.push(e.geometry)}))})),(0,r.Tw)(t)}function l(e){return o(e).reduce(((e,t)=>e+t.indexCount/3),0)}},74533:(e,t,i)=>{"use strict";i.d(t,{q:()=>s});var r=i(2236);function s(e){const t=new Map,i=e=>{let i=t.get(e);return i||(i=new r.t9,t.set(e,i)),i};return e.removes.forAll((e=>{n(e)&&i(e.material).removes.push(e)})),e.adds.forAll((e=>{n(e)&&i(e.material).adds.push(e)})),e.updates.forAll((e=>{n(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)})),t}function n(e){return e.data.indexCount>=1}},72946:(e,t,i)=>{"use strict";i.d(t,{Gw:()=>n,PV:()=>u,TU:()=>h,bA:()=>d,n9:()=>o,sX:()=>c});var r=i(19431),s=i(65684);function n(e,t){return new p(e,f,t)}function o(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=f;return new p(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:m.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:m.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:m.minPixelSize},t)}function a(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return g.scale=Math.min(r.divisor/(t-r.offset),1),g.factor=function(e){return Math.abs(e*e*e)}(e),g.minPixelSize=r.minPixelSize,g.paddingPixels=s,g}function l(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function c(e,t){return Math.max((0,r.t7)(e*t.scale,e,t.factor),l(e,t))}function u(e,t,i,r){r.scale=function(e,t,i){const r=a(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,c(1,r)}(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function h(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,l(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function d(e,t,i,r){return c(e,a(t,i,r))}class p{constructor(e,t,i,r={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},n){this.viewingMode=e,this.description=t,this.ellipsoidRadius=i,this.parameters=r,this._paddingPixelsOverride=n,this.viewingMode===s.JY.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this._calculateParameters(e,this.ellipsoidRadius,this.parameters),0))}overridePadding(e){return e!==this.paddingPixelsOverride?new p(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,t,i){const{scaleStart:r,scaleFallOffRange:s,minPixelSize:n}=this.description,{fovY:o,distance:a}=e,l=this.calculateCurvatureDependentParameters(e,t),c=this.coverageCompensation(e,t,l),{tiltAngle:u,scaleFallOffFactor:h}=l,d=Math.sin(u)*a,p=.5*Math.PI-u-o*(.5-r*c),f=d/Math.cos(p),m=p+o*s*c,g=(f-h*(d/Math.cos(m)))/(1-h);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=g,i.divisor=f-g,i.minPixelSize=n,i}_calculateCurvatureDependentParametersLocal(e,t,i=y){return i.tiltAngle=this.description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,t,i=y){const s=this.description.curvatureDependent,n=1+e.distance/t,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=(0,r.uZ)((o-a)/(l-a),0,1),[u,h]=[s.min,s.max];return i.tiltAngle=(0,r.t7)(u.tiltAngle,h.tiltAngle,c),i.scaleFallOffFactor=(0,r.t7)(u.scaleFallOffFactor,h.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,t,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,t,i){const r=t*t,s=i.tiltAngle+.5*Math.PI,{fovY:n,distance:o}=e,a=o*o+r-2*Math.cos(s)*o*t,l=Math.sqrt(a),c=Math.sqrt(a-r);return(Math.acos(c/l)-Math.asin(t/(l/Math.sin(s)))+.5*n)/n}}const f={curvatureDependent:{min:{curvature:(0,r.Vl)(10),tiltAngle:(0,r.Vl)(12),scaleFallOffFactor:.5},max:{curvature:(0,r.Vl)(70),tiltAngle:(0,r.Vl)(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},m={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14},g={scale:0,factor:0,minPixelSize:0,paddingPixels:0},y={tiltAngle:0,scaleFallOffFactor:0}},39169:(e,t,i)=>{"use strict";i.d(t,{p:()=>s,y:()=>r});const r={orderedRepackingEnabled:!1},s={rootOrigin:null}},5073:(e,t,i)=>{"use strict";i.d(t,{W9:()=>b,cy:()=>S,iO:()=>x,lV:()=>T,yn:()=>f});var r=i(61681),s=i(1662),n=i(34344),o=i(24455),a=i(39100),l=i(10663),c=i(61044),u=i(6766),h=i(79912),d=i(8909),p=i(91917);class f{constructor(){this._transform=(0,a.c)(),this._transformInverse=new m({value:this._transform},o.a,a.c),this._transformInverseTranspose=new m(this._transformInverse,o.t,a.c),this._transformTranspose=new m({value:this._transform},o.t,a.c),this._transformInverseRotation=new m({value:this._transform},s.n,n.c)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){(0,o.c)(this._transform,e)}multiplyTransform(e){(0,o.m)(this._transform,this._transform,e)}set(e){(0,o.c)(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class m{constructor(e,t,i){this.original=e,this.update=t,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}const g=(0,d.c)(),y=(0,d.c)(),_=(0,d.c)(),v=new class{constructor(e=0){this.offset=e,this.sphere=(0,p.c)(),this.tmpVertex=(0,d.c)()}applyToVertex(e,t,i){const r=this.objectTransform.transform;let s=r[0]*e+r[4]*t+r[8]*i+r[12],n=r[1]*e+r[5]*t+r[9]*i+r[13],o=r[2]*e+r[6]*t+r[10]*i+r[14];const a=this.offset/Math.sqrt(s*s+n*n+o*o);s+=s*a,n+=n*a,o+=o*a;const l=this.objectTransform.inverse;return this.tmpVertex[0]=l[0]*s+l[4]*n+l[8]*o+l[12],this.tmpVertex[1]=l[1]*s+l[5]*n+l[9]*o+l[13],this.tmpVertex[2]=l[2]*s+l[6]*n+l[10]*o+l[14],this.tmpVertex}applyToMinMax(e,t){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function b(e){return(0,r.pC)(e)?(v.offset=e,v):null}const w=new class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=(0,d.c)(),this._mbs=(0,p.c)(),this._obb={center:(0,d.c)(),halfSize:(0,h.c)(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,i){const r=e,s=t,n=i+this.componentLocalOriginLength,o=this._totalOffset/Math.sqrt(r*r+s*s+n*n);return this._tmpVertex[0]=e+r*o,this._tmpVertex[1]=t+s*o,this._tmpVertex[2]=i+n*o,this._tmpVertex}applyToAabb(e){const t=e[0],i=e[1],r=e[2]+this.componentLocalOriginLength,s=e[3],n=e[4],o=e[5]+this.componentLocalOriginLength,a=t*s<0?0:Math.min(Math.abs(t),Math.abs(s)),l=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),u=Math.sqrt(a*a+l*l+c*c);if(u<this._totalOffset)return e[0]-=t<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=r<0?this._totalOffset:0,e[3]+=s>0?this._totalOffset:0,e[4]+=n>0?this._totalOffset:0,e[5]+=o>0?this._totalOffset:0,e;const h=Math.max(Math.abs(t),Math.abs(s)),d=Math.max(Math.abs(i),Math.abs(n)),p=Math.max(Math.abs(r),Math.abs(o)),f=Math.sqrt(h*h+d*d+p*p),m=this._totalOffset/f,g=this._totalOffset/u;return e[0]+=t*(t>0?m:g),e[1]+=i*(i>0?m:g),e[2]+=r*(r>0?m:g),e[3]+=s*(s<0?m:g),e[4]+=n*(n<0?m:g),e[5]+=o*(o<0?m:g),e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/t;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/t,this._mbs}applyToObb(e){const t=e.center,i=this._totalOffset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this._obb.center[0]=t[0]+t[0]*i,this._obb.center[1]=t[1]+t[1]*i,this._obb.center[2]=t[2]+t[2]*i,(0,u.q)(this._obb.halfSize,e.halfSize,e.quaternion),(0,u.a)(this._obb.halfSize,this._obb.halfSize,e.center);const r=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*r,this._obb.halfSize[1]+=this._obb.halfSize[1]*r,this._obb.halfSize[2]+=this._obb.halfSize[2]*r,(0,u.b)(this._obb.halfSize,this._obb.halfSize,e.center),(0,l.c)(E,e.quaternion),(0,u.q)(this._obb.halfSize,this._obb.halfSize,E),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}};function x(e){return(0,r.pC)(e)?(w.offset=e,w):null}const C=new class{constructor(e=0){this.offset=e,this.tmpVertex=(0,d.c)()}applyToVertex(e,t,i){const r=e+this.localOrigin[0],s=t+this.localOrigin[1],n=i+this.localOrigin[2],o=this.offset/Math.sqrt(r*r+s*s+n*n);return this.tmpVertex[0]=e+r*o,this.tmpVertex[1]=t+s*o,this.tmpVertex[2]=i+n*o,this.tmpVertex}applyToAabb(e){for(let t=0;t<3;++t)g[t]=e[0+t]+this.localOrigin[t],y[t]=e[3+t]+this.localOrigin[t],_[t]=g[t];const t=this.applyToVertex(g[0],g[1],g[2]);for(let i=0;i<3;++i)e[i]=t[i],e[i+3]=t[i];const i=t=>{const i=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t+0]=Math.min(e[t+0],i[t]),e[t+3]=Math.max(e[t+3],i[t])};for(let e=1;e<8;++e){for(let t=0;t<3;++t)_[t]=0==(e&1<<t)?g[t]:y[t];i(_)}let r=0;for(let e=0;e<3;++e)g[e]*y[e]<0&&(r|=1<<e);if(0!==r&&7!==r)for(let e=0;e<8;++e)if(0==(r&e)){for(let t=0;t<3;++t)r[t]?_[t]=0:_[t]=0!=(e&1<<t)?g[t]:y[t];i(_)}for(let t=0;t<3;++t)e[t+0]-=this.localOrigin[t],e[t+3]-=this.localOrigin[t];return e}};function T(e){return(0,r.pC)(e)?(C.offset=e,C):null}const S="terrain",E=(0,c.a)()},23627:(e,t,i)=>{"use strict";i.d(t,{AM:()=>n,Eg:()=>o,Mi:()=>s,Ur:()=>a});var r=i(8909);class s{constructor(e=(0,r.c)()){this.intensity=e}}class n{constructor(e=(0,r.c)(),t=(0,r.f)(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class o{constructor(e=(0,r.c)(),t=(0,r.f)(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=e,this.direction=t,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}}class a{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},39501:(e,t,i)=>{"use strict";i.d(t,{c:()=>C,V:()=>x});var r=i(6766),s=i(8909),n=i(23627),o=i(19431);function a(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function l(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function c(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function u(e){return(e+1)*(e+1)}function h(e,t,i){const r=e[0],s=e[1],n=e[2],o=i||[];return o.length=u(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function d(e,t){const i=u(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let e=0;e<i;e++)r.r[e]=r.g[e]=r.b[e]=0;return r}function p(e,t){const i=function(e){return(0,o.uZ)(Math.floor(Math.sqrt(e)-1),0,2)}(t.r.length);for(const s of e)(0,r.o)(b,s.direction),h(b,i,_),a(_,w),l(_,s.intensity[0],v),c(t.r,v),l(_,s.intensity[1],v),c(t.g,v),l(_,s.intensity[2],v),c(t.b,v);return t}function f(e,t){h(b,0,_);for(const i of e)t.r[0]+=_[0]*w[0]*i.intensity[0]*4*Math.PI,t.g[0]+=_[0]*w[0]*i.intensity[1]*4*Math.PI,t.b[0]+=_[0]*w[0]*i.intensity[2]*4*Math.PI;return t}const m=[],g=[],y=[],_=[0],v=[0],b=(0,s.c)(),w=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],x=.4;class C{constructor(){this._shOrder=2,this._oldSunlight={direction:(0,s.c)(),ambient:{color:(0,s.c)(),intensity:1},diffuse:{color:(0,s.c)(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new n.Ur,this._mainLight={intensity:(0,s.c)(),direction:(0,s.f)(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(e){(function(e,t,i,s){d(t,s),(0,r.s)(i.intensity,0,0,0);let o=!1;const a=m,l=g,u=y;a.length=0,l.length=0,u.length=0;for(const t of e)t instanceof n.Eg&&!o?((0,r.c)(i.direction,t.direction),(0,r.c)(i.intensity,t.intensity),i.specularStrength=t.specularStrength,i.environmentStrength=t.environmentStrength,i.castShadows=t.castShadows,o=!0):t instanceof n.Eg||t instanceof n.AM?a.push(t):t instanceof n.Mi?l.push(t):t instanceof n.Ur&&u.push(t);p(a,s),f(l,s);for(const e of u)c(s.r,e.r),c(s.g,e.g),c(s.b,e.b)})(e,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,r.c)(this._oldSunlight.direction,this._mainLight.direction);const t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,(0,r.g)(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),(0,r.c)(T,this._oldSunlight.diffuse.color),(0,r.g)(T,T,x*this.globalFactor),(0,r.a)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,T)}get old(){return this._oldSunlight}}const T=(0,s.c)()},84891:(e,t,i)=>{"use strict";i.d(t,{E:()=>E});var r=i(1983),s=i(25714),n=i(70984),o=i(5079),a=i(71399),l=i(7358),c=i(12045),u=i(46378),h=i(89339),d=i(25584),p=i(9969),f=i(52756),m=i(5474),g=i(95194),y=i(79040),_=i(50152),v=i(17346);class b extends f.A{initializeProgram(e){const t=b.shader.get().build(this.configuration);return new g.$(e.rctx,t,m.i)}_createPipeline(e,t){const i=this.configuration,r=e===n.Am.NONE,o=e===n.Am.FrontFace;return(0,v.sm)({blending:i.output!==s.H.Color&&i.output!==s.H.Alpha||!i.transparent?null:r?c.wu:(0,c.j7)(e),culling:(0,v.zp)(i.cullFace),depthTest:{func:(0,c.Bh)(e)},depthWrite:r||o?i.writeDepth&&v.LZ:null,colorWrite:v.BK,stencilWrite:i.hasOccludees?y.s3:null,stencilTest:i.hasOccludees?t?y.eD:y.RY:null,polygonOffset:r||o?i.polygonOffset&&w:(0,c.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}b.shader=new p.J(_.C,(()=>i.e(886).then(i.bind(i,30886))));const w={factor:1,units:1};var x=i(36663),C=i(67197),T=i(86942);class S extends T.W{constructor(){super(...arguments),this.output=s.H.Color,this.cullFace=n.Vr.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=n.Am.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,x._)([(0,C.o)({count:s.H.COUNT})],S.prototype,"output",void 0),(0,x._)([(0,C.o)({count:n.Vr.COUNT})],S.prototype,"cullFace",void 0),(0,x._)([(0,C.o)()],S.prototype,"hasSlicePlane",void 0),(0,x._)([(0,C.o)()],S.prototype,"hasVertexColors",void 0),(0,x._)([(0,C.o)()],S.prototype,"transparent",void 0),(0,x._)([(0,C.o)()],S.prototype,"polygonOffset",void 0),(0,x._)([(0,C.o)()],S.prototype,"enableOffset",void 0),(0,x._)([(0,C.o)()],S.prototype,"writeDepth",void 0),(0,x._)([(0,C.o)()],S.prototype,"hasOccludees",void 0),(0,x._)([(0,C.o)({count:n.Am.COUNT})],S.prototype,"transparencyPassType",void 0),(0,x._)([(0,C.o)()],S.prototype,"hasMultipassTerrain",void 0),(0,x._)([(0,C.o)()],S.prototype,"cullAboveGround",void 0);class E extends l.F5{constructor(e){super(e,new M),this.supportsEdges=!0,this._configuration=new S}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<c.ve,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,r,s,n,o){(0,d.Bw)(e,t,r,s,n,void 0,o)}requiresSlot(e,t){return e===u.r.DRAPED_MATERIAL||((0,a.S)(t)===s.H.Highlight?e===u.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?u.r.TRANSPARENT_MATERIAL:u.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:u.r.OPAQUE_MATERIAL))}createGLMaterial(e){return e.output===s.H.Color||e.output===s.H.Alpha||e.output===s.H.Highlight||e.output===s.H.Depth&&this.parameters.writeLinearDepth?new A(e):null}createBufferWriter(){return new h.G_(h.IM)}}class A extends o.Z{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==s.H.Color&&this._output!==s.H.Alpha||this._updateOccludeeState(e),this.ensureTechnique(b,e)}}class M extends l.Mt{constructor(){super(...arguments),this.color=r.Z,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=n.Vr.None,this.hasOccludees=!1}}},46151:(e,t,i)=>{"use strict";i.d(t,{Gp:()=>P,RL:()=>F});var r=i(61681),s=i(6766),n=i(8909),o=i(65684),a=i(44685),l=i(25714),c=i(90511),u=i(2833),h=i(3864),d=i(70984),p=i(80776),f=i(7358),m=i(12045),g=i(38208),y=i(46378),_=i(21414),v=i(5073),b=i(21123),w=i(25584),x=i(28541),C=i(36663),T=i(82082),S=i(67197),E=i(86942);class A extends E.W{constructor(){super(...arguments),this.output=l.H.Color,this.alphaDiscardMode=d.JJ.Opaque,this.doubleSidedMode=u.q.None,this.pbrMode=h.f7.Disabled,this.cullFace=d.Vr.None,this.transparencyPassType=d.Am.NONE,this.normalType=c.h.Attribute,this.textureCoordinateType=T.N.None,this.customDepthTest=d.Gv.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}(0,C._)([(0,S.o)({count:l.H.COUNT})],A.prototype,"output",void 0),(0,C._)([(0,S.o)({count:d.JJ.COUNT})],A.prototype,"alphaDiscardMode",void 0),(0,C._)([(0,S.o)({count:u.q.COUNT})],A.prototype,"doubleSidedMode",void 0),(0,C._)([(0,S.o)({count:h.f7.COUNT})],A.prototype,"pbrMode",void 0),(0,C._)([(0,S.o)({count:d.Vr.COUNT})],A.prototype,"cullFace",void 0),(0,C._)([(0,S.o)({count:d.Am.COUNT})],A.prototype,"transparencyPassType",void 0),(0,C._)([(0,S.o)({count:c.h.COUNT})],A.prototype,"normalType",void 0),(0,C._)([(0,S.o)({count:T.N.COUNT})],A.prototype,"textureCoordinateType",void 0),(0,C._)([(0,S.o)({count:d.Gv.COUNT})],A.prototype,"customDepthTest",void 0),(0,C._)([(0,S.o)()],A.prototype,"spherical",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasVertexColors",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasSymbolColors",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasVerticalOffset",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasSlicePlane",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasSliceHighlight",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasColorTexture",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasMetalnessAndRoughnessTexture",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasEmissionTexture",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasOcclusionTexture",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasNormalTexture",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasScreenSizePerspective",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasVertexTangents",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasOccludees",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasMultipassTerrain",void 0),(0,C._)([(0,S.o)()],A.prototype,"hasModelTransformation",void 0),(0,C._)([(0,S.o)()],A.prototype,"offsetBackfaces",void 0),(0,C._)([(0,S.o)()],A.prototype,"vvSize",void 0),(0,C._)([(0,S.o)()],A.prototype,"vvColor",void 0),(0,C._)([(0,S.o)()],A.prototype,"receiveShadows",void 0),(0,C._)([(0,S.o)()],A.prototype,"receiveAmbientOcclusion",void 0),(0,C._)([(0,S.o)()],A.prototype,"textureAlphaPremultiplied",void 0),(0,C._)([(0,S.o)()],A.prototype,"instanced",void 0),(0,C._)([(0,S.o)()],A.prototype,"instancedColor",void 0),(0,C._)([(0,S.o)()],A.prototype,"instancedDoublePrecision",void 0),(0,C._)([(0,S.o)()],A.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,C._)([(0,S.o)()],A.prototype,"writeDepth",void 0),(0,C._)([(0,S.o)()],A.prototype,"transparent",void 0),(0,C._)([(0,S.o)()],A.prototype,"enableOffset",void 0),(0,C._)([(0,S.o)()],A.prototype,"cullAboveGround",void 0),(0,C._)([(0,S.o)()],A.prototype,"snowCover",void 0),(0,C._)([(0,S.o)({constValue:!0})],A.prototype,"hasVvInstancing",void 0),(0,C._)([(0,S.o)({constValue:!1})],A.prototype,"useCustomDTRExponentForWater",void 0),(0,C._)([(0,S.o)({constValue:!1})],A.prototype,"supportsTextureAtlas",void 0),(0,C._)([(0,S.o)({constValue:!0})],A.prototype,"useFillLights",void 0);var M=i(9969),O=i(60926);class R extends x.tT{initializeConfiguration(e,t){super.initializeConfiguration(e,t),t.hasMetalnessAndRoughnessTexture=!1,t.hasEmissionTexture=!1,t.hasOcclusionTexture=!1,t.hasNormalTexture=!1,t.hasModelTransformation=!1,t.normalType=c.h.Attribute,t.doubleSidedMode=u.q.WindingOrder,t.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,R.shader)}}R.shader=new M.J(O.R,(()=>i.e(6353).then(i.bind(i,56353))));class P extends f.F5{constructor(e){super(e,D),this.supportsEdges=!0,this.techniqueConfig=new A,this.vertexBufferLayout=function(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=(0,a.U$)().vec3f(_.T.POSITION).vec3f(_.T.NORMAL);return e.hasVertexTangents&&i.vec4f(_.T.TANGENT),t&&i.vec2f(_.T.UV0),e.hasVertexColors&&i.vec4u8(_.T.COLOR),e.hasSymbolColors&&i.vec4u8(_.T.SYMBOLCOLOR),i}(this.parameters),this.instanceBufferLayout=e.instanced?F(this.parameters):null}isVisibleInPass(e){return e!==g.C.MATERIAL_DEPTH_SHADOWMAP_ALL&&e!==g.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&e!==g.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||0===e.layerOpacity)return!1;const{instanced:t,hasVertexColors:i,hasSymbolColors:s,vvColorEnabled:n}=e,o=(0,r.pC)(t)&&t.includes("color"),a="replace"===e.colorMixMode,l=e.opacity>0,c=e.externalColor&&e.externalColor[3]>0;return i&&(o||n||s)?!!a||l:i?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=(0,r.pC)(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=(0,r.pC)(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType="screenDerivative"===this.parameters.normals?c.h.ScreenDerivative:c.h.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,(0,r.pC)(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?d.Vr.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=(0,r.pC)(this.parameters.modelTransformation),e!==l.H.Color&&e!==l.H.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=u.q.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?u.q.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?u.q.WindingOrder:u.q.None,this.techniqueConfig.instancedColor=(0,r.pC)(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!t.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?h.f7.Schematic:h.f7.Normal:h.f7.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<m.ve,this.techniqueConfig.snowCover=this.hasSnowCover(t)),this.techniqueConfig}hasSnowCover(e){return(0,r.pC)(e.weather)&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}intersect(e,t,i,n,a,l,c){if((0,r.pC)(this.parameters.verticalOffset)){const e=n.camera;(0,s.s)(H,i[12],i[13],i[14]);let t=null;switch(n.viewingMode){case o.JY.Global:t=(0,s.n)(z,H);break;case o.JY.Local:t=(0,s.c)(z,V)}let r=0;const c=(0,s.b)(j,H,e.eye),u=(0,s.l)(c),h=(0,s.g)(c,c,1/u);let d=null;this.parameters.screenSizePerspective&&(d=(0,s.e)(t,h)),r+=(0,w.Hx)(e,u,this.parameters.verticalOffset,d,this.parameters.screenSizePerspective),(0,s.g)(t,t,r),(0,s.t)(B,t,n.transform.inverseRotation),a=(0,s.b)(k,a,B),l=(0,s.b)(U,l,B)}(0,w.Bw)(e,t,n,a,l,(0,v.W9)(n.verticalOffset),c)}requiresSlot(e){return e===(this.parameters.transparent?this.parameters.writeDepth?y.r.TRANSPARENT_MATERIAL:y.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:y.r.OPAQUE_MATERIAL)||e===y.r.DRAPED_MATERIAL}createGLMaterial(e){return e.output===l.H.Color||e.output===l.H.Alpha||e.output===l.H.Depth||e.output===l.H.Normal||e.output===l.H.Shadow||e.output===l.H.Highlight?new I(e):null}createBufferWriter(){return new N(this.vertexBufferLayout,this.instanceBufferLayout)}}class I extends p.F{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){const t=this._material.parameters;this.updateTexture(t.textureId);const i=e.camera.viewInverseTransposeMatrix;return(0,s.s)(t.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(t.treeRendering?R:x.tT,e)}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==l.H.Color&&this._output!==l.H.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this._updateParameters(e)}}class L extends x.em{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const D=new L;class N{constructor(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(_.T.POSITION).length}write(e,t,i,r){(0,b.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}function F(e){let t=(0,a.U$)();return t=e.instancedDoublePrecision?t.vec3f(_.T.MODELORIGINHI).vec3f(_.T.MODELORIGINLO).mat3f(_.T.MODEL).mat3f(_.T.MODELNORMAL):t.mat4f(_.T.MODEL).mat4f(_.T.MODELNORMAL),(0,r.pC)(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(_.T.INSTANCECOLOR)),(0,r.pC)(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(_.T.INSTANCEFEATUREATTRIBUTE)),t}const k=(0,n.c)(),U=(0,n.c)(),V=(0,n.f)(0,0,1),z=(0,n.c)(),B=(0,n.c)(),H=(0,n.c)(),j=(0,n.c)()},14634:(e,t,i)=>{"use strict";i.d(t,{K:()=>r});const r=2.1},86942:(e,t,i)=>{"use strict";i.d(t,{W:()=>o});var r=i(36663),s=i(40017),n=i(67197);class o extends n.m{}(0,r._)([(0,n.o)({constValue:!0})],o.prototype,"hasSliceHighlight",void 0),(0,r._)([(0,n.o)({constValue:!1})],o.prototype,"hasSliceInVertexProgram",void 0),(0,r._)([(0,n.o)({constValue:!1})],o.prototype,"instancedDoublePrecision",void 0),(0,r._)([(0,n.o)({constValue:!1})],o.prototype,"isGround",void 0),(0,r._)([(0,n.o)({constValue:s.P.Pass})],o.prototype,"pbrTextureBindType",void 0)},22456:(e,t,i)=>{"use strict";i.d(t,{w:()=>n});var r=i(8909),s=i(78549);class n extends s.Pf{constructor(e=(0,r.c)()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}},98166:(e,t,i)=>{"use strict";i.d(t,{A:()=>W});var r=i(19431),s=i(61681),n=i(1662),o=i(34344),a=i(24455),l=i(39100),c=i(55709),u=i(69666),h=i(6766),d=i(8909),p=i(1983);var f=i(24568),m=i(44685),g=i(25714),y=i(21737),_=i(36620),v=i(80776),b=i(7358),w=i(46378),x=i(72946),C=i(15095),T=i(21414),S=i(21123),E=i(25584),A=i(73622),M=i(56444),O=i(65684),R=i(9969),P=i(52756),I=i(70984),L=i(5474),D=i(12045),N=i(95194),F=i(91907),k=i(17346);class U extends P.A{initializeConfiguration(e,t){t.spherical=e.viewingMode===O.JY.Global}initializeProgram(e){const t=U.shader.get().build(this.configuration);return new N.$(e.rctx,t,L.i)}_setPipelineState(e){const t=this.configuration,i=e===I.Am.NONE,r=e===I.Am.FrontFace,s=this.configuration.hasPolygonOffset&&V,n=(i||r)&&t.output!==g.H.Highlight?(t.depthEnabled||t.output===g.H.Occlusion)&&k.LZ:null;return(0,k.sm)({blending:t.output===g.H.Color||t.output===g.H.Alpha||t.output===g.H.Highlight?i?z:(0,D.j7)(e):null,depthTest:{func:F.wb.LEQUAL},depthWrite:n,colorWrite:k.BK,polygonOffset:s})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===g.H.Occlusion?F.MX.POINTS:F.MX.TRIANGLES}}U.shader=new R.J(M.H,(()=>i.e(9180).then(i.bind(i,49180))));const V={factor:0,units:-4},z=(0,k.if)(F.zi.ONE,F.zi.ONE_MINUS_SRC_ALPHA);var B=i(36663),H=i(67197),j=i(86942);class G extends j.W{constructor(){super(...arguments),this.output=g.H.Color,this.screenCenterOffsetUnitsEnabled=y.d.World,this.transparencyPassType=I.Am.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,B._)([(0,H.o)({count:g.H.COUNT})],G.prototype,"output",void 0),(0,B._)([(0,H.o)({count:y.d.COUNT})],G.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,B._)([(0,H.o)({count:I.Am.COUNT})],G.prototype,"transparencyPassType",void 0),(0,B._)([(0,H.o)()],G.prototype,"spherical",void 0),(0,B._)([(0,H.o)()],G.prototype,"occlusionTestEnabled",void 0),(0,B._)([(0,H.o)()],G.prototype,"signedDistanceFieldEnabled",void 0),(0,B._)([(0,H.o)()],G.prototype,"vvSize",void 0),(0,B._)([(0,H.o)()],G.prototype,"vvColor",void 0),(0,B._)([(0,H.o)()],G.prototype,"hasVerticalOffset",void 0),(0,B._)([(0,H.o)()],G.prototype,"hasScreenSizePerspective",void 0),(0,B._)([(0,H.o)()],G.prototype,"debugDrawLabelBorder",void 0),(0,B._)([(0,H.o)()],G.prototype,"binaryHighlightOcclusionEnabled",void 0),(0,B._)([(0,H.o)()],G.prototype,"hasSlicePlane",void 0),(0,B._)([(0,H.o)()],G.prototype,"hasPolygonOffset",void 0),(0,B._)([(0,H.o)()],G.prototype,"depthEnabled",void 0),(0,B._)([(0,H.o)()],G.prototype,"pixelSnappingEnabled",void 0),(0,B._)([(0,H.o)()],G.prototype,"isDraped",void 0),(0,B._)([(0,H.o)()],G.prototype,"hasMultipassGeometry",void 0),(0,B._)([(0,H.o)()],G.prototype,"hasMultipassTerrain",void 0),(0,B._)([(0,H.o)()],G.prototype,"cullAboveGround",void 0),(0,B._)([(0,H.o)({constValue:!0})],G.prototype,"hasSliceInVertexProgram",void 0),(0,B._)([(0,H.o)({constValue:!1})],G.prototype,"hasVvInstancing",void 0);class W extends b.F5{constructor(e){super(e,new de),this.techniqueConfig=new G}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?y.d.Screen:y.d.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,e===g.H.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),e===g.H.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=t.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,n,o,a,l,c){(0,s.pC)(c)?this._intersectDrapedHudGeometry(e,o,a,l,c):this._intersectHudGeometry(e,t,i,r,a,l)}_intersectDrapedHudGeometry(e,t,i,r,n){const o=e.vertexAttributes.get(T.T.POSITION),a=e.vertexAttributes.get(T.T.SIZE),l=this.parameters,c=(0,M.c)(l);let u=1,h=1;if((0,s.pC)(r)){const e=r(ae);u=e[0],h=e[5]}u*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const d=ce*e.screenToWorldRatio;for(let r=0;r<o.data.length/o.size;r++){const s=r*o.size,p=o.data[s],f=o.data[s+1],m=r*a.size;let g;ue[0]=a.data[m]*u,ue[1]=a.data[m+1]*h,l.textureIsSignedDistanceField&&(g=l.outlineSize*e.screenToWorldRatio/2),$(t,p,f,ue,d,g,l,c)&&i(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(e,t,i,r,o,l){if(!r.options.selectionMode||!r.options.hud||(0,A.PD)(t))return;const c=this.parameters;let u=1,p=1;if((0,n.f)(ie,i),(0,s.pC)(l)){const e=l(ae);u=e[0],p=e[5],function(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+i*i+r*r),h=1/Math.sqrt(s*s+n*n+o*o),d=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*u,e[1]=i*u,e[2]=r*u,e[3]=s*h,e[4]=n*h,e[5]=o*h,e[6]=a*d,e[7]=l*d,e[8]=c*d}(ie)}const f=e.vertexAttributes.get(T.T.POSITION),m=e.vertexAttributes.get(T.T.SIZE),g=e.vertexAttributes.get(T.T.NORMAL),y=e.vertexAttributes.get(T.T.AUXPOS1);(0,C.hu)(f.size>=3);const _=r.point,v=r.camera,b=(0,M.c)(c);u*=v.pixelRatio,p*=v.pixelRatio;const w="screen"===this.parameters.centerOffsetUnits;for(let e=0;e<f.data.length/f.size;e++){const t=e*f.size;(0,h.s)(J,f.data[t],f.data[t+1],f.data[t+2]),(0,h.m)(J,J,i);const s=e*m.size;ue[0]=m.data[s]*u,ue[1]=m.data[s+1]*p,(0,h.m)(J,J,v.viewMatrix);const n=e*y.size;if((0,h.s)(ne,y.data[n+0],y.data[n+1],y.data[n+2]),!w&&(J[0]+=ne[0],J[1]+=ne[1],0!==ne[2])){const e=ne[2];(0,h.n)(ne,J),(0,h.b)(J,J,(0,h.g)(ne,ne,e))}const l=e*g.size;if((0,h.s)(K,g.data[l],g.data[l+1],g.data[l+2]),this._normalAndViewAngle(K,ie,v,oe),this._applyVerticalOffsetTransformationView(J,oe,v,Y),v.applyProjection(J,Q),Q[0]>-1){Q[0]=Math.floor(Q[0]),Q[1]=Math.floor(Q[1]),w&&(ne[0]||ne[1])&&(Q[0]+=ne[0],0!==ne[1]&&(Q[1]+=(0,x.sX)(ne[1],Y.factorAlignment)),v.unapplyProjection(Q,J)),Q[0]+=this.parameters.screenOffset[0],Q[1]+=this.parameters.screenOffset[1],(0,x.TU)(ue,Y.factor,ue);const e=le*v.pixelRatio;let t;if(c.textureIsSignedDistanceField&&(t=c.outlineSize*v.pixelRatio/2),$(_,Q[0],Q[1],ue,e,t,c,b)){const e=r.ray;if((0,h.m)(te,J,(0,a.a)(se,v.viewMatrix)),Q[0]=_[0],Q[1]=_[1],v.unprojectFromRenderScreen(Q,J)){const t=(0,d.c)();(0,h.c)(t,e.direction);const i=1/(0,h.l)(t);(0,h.g)(t,t,i),o((0,h.i)(e.origin,J)*i,t,-1,!0,1,te)}}}}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get(T.T.POSITION),s=e.indices.get(T.T.POSITION);return(0,_.NO)(r,s,t)}createBufferWriter(){return new fe(this)}_normalAndViewAngle(e,t,i,r){return function(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}(t)&&(t=(0,n.f)(re,t)),(0,h.t)(r.normal,e,t),(0,h.m)(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=(0,h.e)(ee,he),r}_updateScaleInfo(e,t,i){const r=this.parameters;(0,s.pC)(r.screenSizePerspective)?(0,x.PV)(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),(0,s.pC)(r.screenSizePerspectiveAlignment)?(0,x.PV)(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,i,r,s,n,o){const a=this._normalAndViewAngle(t,i,s,oe);return this._applyVerticalGroundOffsetView(e,a,s,o),this._applyVerticalOffsetTransformationView(o,a,s,n),this._applyPolygonOffsetView(o,a,r[3],s,o),this._applyCenterOffsetView(o,r,o),o}applyShaderOffsetsNDC(e,t,i,r,n){return this._applyCenterOffsetNDC(e,t,i,r),(0,s.pC)(n)&&(0,h.c)(n,r),this._applyPolygonOffsetNDC(r,t,i,r),r}_applyPolygonOffsetView(e,t,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);0===a&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return(0,h.c)(n,e);const c=(0,r.uZ)(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/s.viewport[2];return(0,h.g)(n,e,l>0?u:1/u),n}_applyVerticalGroundOffsetView(e,t,i,r){const s=(0,h.l)(e),n=i.aboveGround?1:-1,o=.5*i.computeRenderPixelSizeAtDist(s),a=(0,h.g)(J,t.normal,n*o);return(0,h.a)(r,e,a),r}_applyVerticalOffsetTransformationView(e,t,i,r){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const i=(0,h.l)(e);this._updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const o=(0,h.l)(e),a=(0,s.Pt)(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=(0,E.Hx)(i,o,n.verticalOffset,t.cosAngle,a);return this._updateScaleInfo(r,o,t.cosAngle),(0,h.g)(t.normal,t.normal,l),(0,h.a)(e,e,t.normal)}_applyCenterOffsetView(e,t,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,h.c)(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&((0,h.n)(K,i),(0,h.a)(i,i,(0,h.g)(K,K,t[2])))),i}_applyCenterOffsetNDC(e,t,i,r){const s="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,h.c)(r,e),s||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}_applyPolygonOffsetNDC(e,t,i,r){const s=this.parameters.shaderPolygonOffset;if(e!==r&&(0,h.c)(r,e),s){const e=i.aboveGround?1:-1,n=e*Math.sign(t[3]);r[2]-=(n||e)*s}return r}requiresSlot(e){if(e===w.r.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:t,occlusionTest:i}=this.parameters;return e===(t?w.r.LABEL_MATERIAL:w.r.HUD_MATERIAL)||i&&e===w.r.OCCLUSION_PIXELS}createGLMaterial(e){return e.output===g.H.Color||e.output===g.H.Alpha?new q(e):e.output===g.H.Highlight?new Z(e):null}calculateRelativeScreenBounds(e,t,i=(0,f.Ue)()){return function(e,t,i,r=X){(0,c.c)(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i}(this.parameters,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}class Z extends v.F{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(U,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}class q extends Z{_isOcclusionSlot(e){return e.slot===w.r.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===g.H.Color||this._output===g.H.Alpha)}selectProgram(e){return this.ensureTechnique(U,e,this._isOcclusionSlot(e)?g.H.Occlusion:this._output)}}function $(e,t,i,r,n,o,a,l){let c=t-n-(l[0]>0?r[0]*l[0]:0),u=c+r[0]+2*n,h=i-n-(l[1]>0?r[1]*l[1]:0),d=h+r[1]+2*n;const p=a.distanceFieldBoundingBox;return a.textureIsSignedDistanceField&&(0,s.pC)(p)&&(c+=r[0]*p[0],h+=r[1]*p[1],u-=r[0]*(1-p[2]),d-=r[1]*(1-p[3]),c-=o,u+=o,h-=o,d+=o),e[0]>c&&e[0]<u&&e[1]>h&&e[1]<d}const Y={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},X=(0,u.a)(),J=(0,d.c)(),K=(0,d.c)(),Q=(0,p.c)(),ee=(0,d.c)(),te=(0,d.c)(),ie=(0,o.c)(),re=(0,o.c)(),se=(0,l.c)(),ne=(0,d.c)(),oe={normal:ee,cosAngle:0},ae=(0,l.c)(),le=1,ce=2,ue=[0,0],he=(0,d.f)(0,0,1);class de extends v.E{constructor(){super(...arguments),this.renderOccluded=b.yD.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,u.f)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const pe=(0,m.U$)().vec3f(T.T.POSITION).vec3f(T.T.NORMAL).vec2f(T.T.UV0).vec4u8(T.T.COLOR).vec2f(T.T.SIZE).vec4f(T.T.AUXPOS1).vec4f(T.T.AUXPOS2);class fe{constructor(e){this.material=e,this.vertexBufferLayout=pe}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(T.T.POSITION).length}write(e,t,i,r){(0,S.ho)(t.indices.get(T.T.POSITION),t.vertexAttributes.get(T.T.POSITION).data,e.transformation,i.position,r,6),(0,S.s5)(t.indices.get(T.T.NORMAL),t.vertexAttributes.get(T.T.NORMAL).data,e.invTranspTransformation,i.normal,r,6);{const e=t.vertexAttributes.get(T.T.UV0).data;let s,n,o,a;if(null==e||e.length<4){const e=this.material.parameters;s=0,n=0,o=e.texCoordScale[0],a=e.texCoordScale[1]}else s=e[0],n=e[1],o=e[2],a=e[3];o=Math.min(1.99999,o+1),a=Math.min(1.99999,a+1);const l=t.indices.get(T.T.POSITION).length,c=i.uv0;let u=r;for(let e=0;e<l;++e)c.set(u,0,s),c.set(u,1,n),u+=1,c.set(u,0,o),c.set(u,1,n),u+=1,c.set(u,0,o),c.set(u,1,a),u+=1,c.set(u,0,o),c.set(u,1,a),u+=1,c.set(u,0,s),c.set(u,1,a),u+=1,c.set(u,0,s),c.set(u,1,n),u+=1}(0,S.Vs)(t.indices.get(T.T.COLOR),t.vertexAttributes.get(T.T.COLOR).data,4,i.color,r,6);{const e=t.indices.get(T.T.SIZE),s=t.vertexAttributes.get(T.T.SIZE).data,n=e.length,o=i.size;let a=r;for(let t=0;t<n;++t){const i=s[2*e[t]],r=s[2*e[t]+1];for(let e=0;e<6;++e)o.set(a,0,i),o.set(a,1,r),a+=1}}t.indices.get(T.T.AUXPOS1)&&t.vertexAttributes.get(T.T.AUXPOS1)&&(0,S.SW)(t.indices.get(T.T.AUXPOS1),t.vertexAttributes.get(T.T.AUXPOS1).data,i.auxpos1,r,6),t.indices.get(T.T.AUXPOS2)&&t.vertexAttributes.get(T.T.AUXPOS2)&&(0,S.SW)(t.indices.get(T.T.AUXPOS2),t.vertexAttributes.get(T.T.AUXPOS2).data,i.auxpos2,r,6)}}},9434:(e,t,i)=>{"use strict";i.d(t,{Y:()=>B});var r=i(13802),s=i(61681),n=i(95550),o=i(55709),a=i(6766),l=i(8909),c=i(1983),u=i(59934),h=i(56215),d=i(69430),p=i(81936),f=i(25714),m=i(36620),g=i(5079),y=i(7358),_=i(46378),v=i(15095),b=i(21414),w=i(21123),x=i(89339),C=i(25584),T=i(73622),S=i(9969),E=i(52756),A=i(5474),M=i(95194),O=i(79040),R=i(14179),P=i(91907),I=i(17346);class L extends E.A{constructor(e,t,i){super(e,t,i),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==f.H.Highlight}initializeProgram(e){const t=L.shader.get().build(this.configuration);return new M.$(e.rctx,t,A.i)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(this.program.bindPass(e,t),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:e,sdfNormalizer:t,pixels:i}=(0,s.pC)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",t),this.program.setUniform1f("stipplePatternTextureSize",i),this.program.setUniform1f("stipplePatternPixelSize",e),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e)}}initializePipeline(){const e=this.configuration,t=(0,I.wK)(P.zi.SRC_ALPHA,P.zi.ONE,P.zi.ONE_MINUS_SRC_ALPHA,P.zi.ONE_MINUS_SRC_ALPHA),i=(t,i=null,r=null)=>(0,I.sm)({blending:i,depthTest:O.JN,depthWrite:r,colorWrite:I.BK,stencilWrite:e.hasOccludees?O.s3:null,stencilTest:e.hasOccludees?t?O.eD:O.RY:null});return e.output===f.H.Color?(this._occludeePipelineState=i(!0,e.transparent||this.stippleEnabled?t:null,I.LZ),i(!1,e.transparent||this.stippleEnabled?t:null,I.LZ)):i(!1)}get primitiveType(){return P.MX.LINES}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}L.shader=new S.J(R.N,(()=>i.e(1308).then(i.bind(i,31308))));var D=i(36663),N=i(67197),F=i(86942);class k extends F.W{constructor(){super(...arguments),this.output=f.H.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}(0,D._)([(0,N.o)({count:f.H.COUNT})],k.prototype,"output",void 0),(0,D._)([(0,N.o)()],k.prototype,"hasSlicePlane",void 0),(0,D._)([(0,N.o)()],k.prototype,"hasVertexColors",void 0),(0,D._)([(0,N.o)()],k.prototype,"transparent",void 0),(0,D._)([(0,N.o)()],k.prototype,"draped",void 0),(0,D._)([(0,N.o)()],k.prototype,"stippleEnabled",void 0),(0,D._)([(0,N.o)()],k.prototype,"stippleOffColorEnabled",void 0),(0,D._)([(0,N.o)()],k.prototype,"stipplePreferContinuous",void 0),(0,D._)([(0,N.o)()],k.prototype,"hasOccludees",void 0),(0,D._)([(0,N.o)({constValue:!1})],k.prototype,"stippleRequiresClamp",void 0),(0,D._)([(0,N.o)({constValue:!1})],k.prototype,"stippleScaleWithLineWidth",void 0),(0,D._)([(0,N.o)({constValue:!1})],k.prototype,"stippleRequiresStretchMeasure",void 0);const U=r.Z.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var V,z;(z=V||(V={}))[z.START=0]="START",z[z.END=1]="END";class B extends y.F5{constructor(e){super(e,new G),this._techniqueConfig=new k}getConfiguration(e,t){this._techniqueConfig.output=e,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=t.slot===_.r.DRAPED_MATERIAL;const i=(0,s.pC)(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=i,this._techniqueConfig.stippleOffColorEnabled=i&&(0,s.pC)(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(e,t,i,r,n,o,a,l,c){(0,s.pC)(c)?(0,C.TT)(e,r,c,o,1,a):this._intersectLineGeometry(e,t,i,r,a)}_intersectLineGeometry(e,t,i,r,s){if(!r.options.selectionMode||(0,T.PD)(t))return;if(!(0,v.kG)(i))return void U.error("intersection assumes a translation-only matrix");const n=e.vertexAttributes.get(b.T.POSITION).data,l=r.camera,c=te;(0,o.c)(c,r.point),(0,a.s)(ie[0],c[0]-2,c[1]+2,0),(0,a.s)(ie[1],c[0]+2,c[1]+2,0),(0,a.s)(ie[2],c[0]+2,c[1]-2,0),(0,a.s)(ie[3],c[0]-2,c[1]-2,0);for(let e=0;e<4;e++)if(!l.unprojectFromRenderScreen(ie[e],re[e]))return;(0,d.zk)(l.eye,re[0],re[1],se),(0,d.zk)(l.eye,re[1],re[2],ne),(0,d.zk)(l.eye,re[2],re[3],oe),(0,d.zk)(l.eye,re[3],re[0],ae);let p=Number.MAX_VALUE,f=0;for(let e=0;e<n.length-5;e+=3){if(W[0]=n[e]+i[12],W[1]=n[e+1]+i[13],W[2]=n[e+2]+i[14],Z[0]=n[e+3]+i[12],Z[1]=n[e+4]+i[13],Z[2]=n[e+5]+i[14],(0,d.jH)(se,W)<0&&(0,d.jH)(se,Z)<0||(0,d.jH)(ne,W)<0&&(0,d.jH)(ne,Z)<0||(0,d.jH)(oe,W)<0&&(0,d.jH)(oe,Z)<0||(0,d.jH)(ae,W)<0&&(0,d.jH)(ae,Z)<0)continue;if(l.projectToRenderScreen(W,Y),l.projectToRenderScreen(Z,X),Y[2]<0&&X[2]>0){(0,a.b)(q,W,Z);const e=l.frustum,t=-(0,d.jH)(e[u.Nu.NEAR],W)/(0,a.e)(q,(0,d.mJ)(e[u.Nu.NEAR]));(0,a.g)(q,q,t),(0,a.a)(W,W,q),l.projectToRenderScreen(W,Y)}else if(Y[2]>0&&X[2]<0){(0,a.b)(q,Z,W);const e=l.frustum,t=-(0,d.jH)(e[u.Nu.NEAR],Z)/(0,a.e)(q,(0,d.mJ)(e[u.Nu.NEAR]));(0,a.g)(q,q,t),(0,a.a)(Z,Z,q),l.projectToRenderScreen(Z,X)}else if(Y[2]<0&&X[2]<0)continue;Y[2]=0,X[2]=0;const t=(0,h.Jk)((0,h.zk)(Y,X,Q),c);t<p&&(p=t,(0,a.c)(J,W),(0,a.c)(K,Z),f=e/3)}const m=r.rayBegin,g=r.rayEnd;if(p<4){let e=Number.MAX_VALUE;if((0,h.AR)((0,h.zk)(J,K,Q),(0,h.zk)(m,g,ee),$)){(0,a.b)($,$,m);const t=(0,a.l)($);(0,a.g)($,$,1/t),e=t/(0,a.i)(m,g)}s(e,$,f,!1)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get(b.T.POSITION);return(0,m.qZ)(r,null,!1,t)}requiresSlot(e){return e===_.r.OPAQUE_MATERIAL||e===_.r.DRAPED_MATERIAL}createGLMaterial(e){return e.output===f.H.Color||e.output===f.H.Highlight?new H(e):null}createBufferWriter(){const e=this.parameters.hasVertexColors?x.IM:x.wp;return(0,s.Wi)(this.parameters.stipplePattern)?new x.G_(e):new j(e.clone().vec3f(b.T.AUXPOS1).vec2f(b.T.UV0))}}class H extends g.Z{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===f.H.Color&&this._updateOccludeeState(e),this.ensureTechnique(L,e)}}class j{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(b.T.POSITION).length}write(e,t,i,r){(0,w.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this._writeAuxpos1(e,t,i,r),this._writeUV0(e,t,i,r)}_writeAuxpos1(e,t,i,r){const s=i.getField(b.T.AUXPOS1,p.ct),n=t.indices.get(b.T.POSITION),o=t.vertexAttributes.get(b.T.POSITION).data,a=e.transformation,l=s.typedBufferStride,c=s.typedBuffer;r*=l;for(let e=0;e<n.length-1;e+=2)for(const t of[1,0]){const i=3*n[e+t],s=o[i],u=o[i+1],h=o[i+2],d=a[0]*s+a[4]*u+a[8]*h+a[12],p=a[1]*s+a[5]*u+a[9]*h+a[13],f=a[2]*s+a[6]*u+a[10]*h+a[14];c[r]=d,c[r+1]=p,c[r+2]=f,r+=l}}_writeUV0(e,t,i,r){const s=i.getField(b.T.UV0,p.Eu),n=t.indices.get(b.T.POSITION),o=t.vertexAttributes.get(b.T.POSITION).data,l=t.vertexAttributes.get(b.T.DISTANCETOSTART)?.data,c=e.transformation,u=s.typedBufferStride,h=s.typedBuffer;let d=0;h[r*=u]=V.START,h[r+1]=d,r+=u;const f=3*n[0],m=(0,a.s)(W,o[f],o[f+1],o[f+2]);c&&(0,a.m)(m,m,c);const g=Z,y=n.length-1;let _=1;const v=l?(e,t,i)=>d=l[i]:(e,t,i)=>d+=(0,a.i)(e,t);for(let e=1;e<y;e+=2){const t=3*n[e];(0,a.s)(g,o[t],o[t+1],o[t+2]),c&&(0,a.m)(g,g,c),v(m,g,_++);for(let e=0;e<2;++e)h[r]=1-e,h[r+1]=d,r+=u;(0,a.c)(m,g)}const w=3*n[y];(0,a.s)(g,o[w],o[w+1],o[w+2]),c&&(0,a.m)(g,g,c),v(m,g,_),h[r]=V.END,h[r+1]=d}}class G extends y.Mt{constructor(){super(...arguments),this.color=c.O,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const W=(0,l.c)(),Z=(0,l.c)(),q=(0,l.c)(),$=(0,l.c)(),Y=(0,n.J$)(),X=(0,n.J$)(),J=(0,l.c)(),K=(0,l.c)(),Q=(0,h.Ue)(),ee=(0,h.Ue)(),te=(0,l.c)(),ie=[(0,n.J$)(),(0,n.J$)(),(0,n.J$)(),(0,n.J$)()],re=[(0,l.c)(),(0,l.c)(),(0,l.c)(),(0,l.c)()],se=(0,d.Ue)(),ne=(0,d.Ue)(),oe=(0,d.Ue)(),ae=(0,d.Ue)()},9066:(e,t,i)=>{"use strict";var r;i.d(t,{b:()=>r}),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"}(r||(r={}))},65392:(e,t,i)=>{"use strict";i.d(t,{U:()=>B});var r=i(13802),s=i(19431),n=i(61681),o=i(95550),a=i(55709),l=i(6766),c=i(8909),u=i(1983),h=i(59934),d=i(56215),p=i(69430),f=i(44685),m=i(25714),g=i(36620),y=i(5079),_=i(71399),v=i(7358),b=i(46378),w=i(15095),x=i(21414),C=i(67874),T=i(73622),S=i(2013),E=i(9969),A=i(52756),M=i(70984),O=i(12045),R=i(95194),P=i(79040),I=i(91907),L=i(17346);const D=new Map([[x.T.POSITION,0],[x.T.SUBDIVISIONFACTOR,1],[x.T.UV0,2],[x.T.AUXPOS1,3],[x.T.AUXPOS2,4],[x.T.COLOR,5],[x.T.COLORFEATUREATTRIBUTE,5],[x.T.SIZE,6],[x.T.SIZEFEATUREATTRIBUTE,6],[x.T.OPACITYFEATUREATTRIBUTE,7]]);class N extends A.A{constructor(e,t,i){super(e,t,i),this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=N.shader.get().build(this.configuration);return new R.$(e.rctx,t,D)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(this.program.bindPass(e,t),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.configuration.stippleEnabled){const{pixelSize:e,sdfNormalizer:t,pixels:i}=(0,n.pC)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",t),this.program.setUniform1f("stipplePatternTextureSize",i),this.program.setUniform1f("stipplePatternPixelSize",e),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e)}}_makePipelineState(e,t){const i=this.configuration,r=e===M.Am.NONE,s=e===M.Am.FrontFace;return(0,L.sm)({blending:i.output===m.H.Color||i.output===m.H.Alpha?r?O.wu:(0,O.j7)(e):null,depthTest:{func:(0,O.Bh)(e)},depthWrite:r?i.writeDepth&&L.LZ:(0,O.K5)(e),colorWrite:L.BK,stencilWrite:i.hasOccludees?P.s3:null,stencilTest:i.hasOccludees?t?P.eD:P.RY:null,polygonOffset:r||s?i.hasPolygonOffset&&F:O.E0})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset&&F;this._occluderPipelineTransparent=(0,L.sm)({blending:O.wu,polygonOffset:t,depthTest:P.zV,depthWrite:null,colorWrite:L.BK,stencilWrite:null,stencilTest:P.YD}),this._occluderPipelineOpaque=(0,L.sm)({blending:O.wu,polygonOffset:t,depthTest:P.zV,depthWrite:null,colorWrite:L.BK,stencilWrite:P.P7,stencilTest:P.ii}),this._occluderPipelineMaskWrite=(0,L.sm)({blending:null,polygonOffset:t,depthTest:P.JN,depthWrite:null,colorWrite:null,stencilWrite:P.s3,stencilTest:P.eD})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?I.MX.LINES:I.MX.TRIANGLE_STRIP}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===b.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===b.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}N.shader=new E.J(S.R,(()=>i.e(6615).then(i.bind(i,16615))));const F={factor:0,units:-4};var k=i(26531);const U=r.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var V,z;(z=V||(V={}))[z.LEFT_JOIN_START=-2]="LEFT_JOIN_START",z[z.LEFT_JOIN_END=-1]="LEFT_JOIN_END",z[z.LEFT_CAP_START=-4]="LEFT_CAP_START",z[z.LEFT_CAP_END=-5]="LEFT_CAP_END",z[z.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",z[z.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",z[z.RIGHT_CAP_START=4]="RIGHT_CAP_START",z[z.RIGHT_CAP_END=5]="RIGHT_CAP_END";class B extends v.F5{constructor(e){super(e,new j),this._vertexAttributeLocations=D,this.techniqueConfig=new k.G,this.layout=this.createLayout()}isClosed(e,t){return q(this.parameters,e,t)}getConfiguration(e,t){this.techniqueConfig.output=e,this.techniqueConfig.draped=t.slot===b.r.DRAPED_MATERIAL;const i=(0,n.pC)(this.parameters.stipplePattern)&&e!==m.H.Highlight;return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleOffColorEnabled=i&&(0,n.pC)(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&(0,n.pC)(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===v.yD.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(e,t,i,r,s,o,a,l,c){(0,n.pC)(c)?this._intersectDrapedLineGeometry(e,r,c,o,a):this._intersectLineGeometry(e,t,i,r,a)}_intersectDrapedLineGeometry(e,t,i,r,n){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(x.T.POSITION).data,a=e.vertexAttributes.get(x.T.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const t=e.vertexAttributes.get(x.T.SIZEFEATUREATTRIBUTE).data[0];l*=(0,s.uZ)(this.parameters.vvSizeOffset[0]+t*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(l*=a.data[0]);const c=r[0],u=r[1],h=(l/2+4)*e.screenToWorldRatio;let d=Number.MAX_VALUE,p=0;for(let e=0;e<o.length-5;e+=3){const t=o[e],i=o[e+1],r=c-t,n=u-i,a=o[e+3]-t,l=o[e+4]-i,h=(0,s.uZ)((a*r+l*n)/(a*a+l*l),0,1),f=a*h-r,m=l*h-n,g=f*f+m*m;g<d&&(d=g,p=e/3)}d<h*h&&n(i.dist,i.normal,p,!1)}_intersectLineGeometry(e,t,i,r,n){if(!r.options.selectionMode||(0,T.PD)(t))return;if(!(0,w.kG)(i))return void U.error("intersection assumes a translation-only matrix");const o=e.vertexAttributes,c=o.get(x.T.POSITION).data;let u=this.parameters.width;if(this.parameters.vvSizeEnabled){const e=o.get(x.T.SIZEFEATUREATTRIBUTE).data[0];u*=(0,s.uZ)(this.parameters.vvSizeOffset[0]+e*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(x.T.SIZE)&&(u*=o.get(x.T.SIZE).data[0]);const f=r.camera,m=K;(0,a.c)(m,r.point);const g=u*f.pixelRatio/2+4*f.pixelRatio;(0,l.s)(le[0],m[0]-g,m[1]+g,0),(0,l.s)(le[1],m[0]+g,m[1]+g,0),(0,l.s)(le[2],m[0]+g,m[1]-g,0),(0,l.s)(le[3],m[0]-g,m[1]-g,0);for(let e=0;e<4;e++)if(!f.unprojectFromRenderScreen(le[e],ce[e]))return;(0,p.zk)(f.eye,ce[0],ce[1],ue),(0,p.zk)(f.eye,ce[1],ce[2],he),(0,p.zk)(f.eye,ce[2],ce[3],de),(0,p.zk)(f.eye,ce[3],ce[0],pe);let y=Number.MAX_VALUE,_=0;const v=Z(this.parameters,o,e.indices)?c.length-2:c.length-5;for(let e=0;e<v;e+=3){$[0]=c[e]+i[12],$[1]=c[e+1]+i[13],$[2]=c[e+2]+i[14];const t=(e+3)%c.length;if(Y[0]=c[t]+i[12],Y[1]=c[t+1]+i[13],Y[2]=c[t+2]+i[14],(0,p.jH)(ue,$)<0&&(0,p.jH)(ue,Y)<0||(0,p.jH)(he,$)<0&&(0,p.jH)(he,Y)<0||(0,p.jH)(de,$)<0&&(0,p.jH)(de,Y)<0||(0,p.jH)(pe,$)<0&&(0,p.jH)(pe,Y)<0)continue;if(f.projectToRenderScreen($,Q),f.projectToRenderScreen(Y,ee),Q[2]<0&&ee[2]>0){(0,l.b)(X,$,Y);const e=f.frustum,t=-(0,p.jH)(e[h.Nu.NEAR],$)/(0,l.e)(X,(0,p.mJ)(e[h.Nu.NEAR]));(0,l.g)(X,X,t),(0,l.a)($,$,X),f.projectToRenderScreen($,Q)}else if(Q[2]>0&&ee[2]<0){(0,l.b)(X,Y,$);const e=f.frustum,t=-(0,p.jH)(e[h.Nu.NEAR],Y)/(0,l.e)(X,(0,p.mJ)(e[h.Nu.NEAR]));(0,l.g)(X,X,t),(0,l.a)(Y,Y,X),f.projectToRenderScreen(Y,ee)}else if(Q[2]<0&&ee[2]<0)continue;Q[2]=0,ee[2]=0;const r=(0,d.Jk)((0,d.zk)(Q,ee,re),m);r<y&&(y=r,(0,l.c)(te,$),(0,l.c)(ie,Y),_=e/3)}const b=r.rayBegin,C=r.rayEnd;if(y<g*g){let e=Number.MAX_VALUE;if((0,d.AR)((0,d.zk)(te,ie,re),(0,d.zk)(b,C,se),J)){(0,l.b)(J,J,b);const t=(0,l.l)(J);(0,l.g)(J,J,1/t),e=t/(0,l.i)(b,C)}n(e,J,_,!1)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const r=e.indices,s=i.get(x.T.POSITION);return(0,g.qZ)(s,r?r.get(x.T.POSITION):null,r&&Z(this.parameters,i,r),t)}createLayout(){const e=(0,f.U$)().vec3f(x.T.POSITION).f32(x.T.SUBDIVISIONFACTOR).vec2f(x.T.UV0).vec3f(x.T.AUXPOS1).vec3f(x.T.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(x.T.SIZEFEATUREATTRIBUTE):e.f32(x.T.SIZE),this.parameters.vvColorEnabled?e.f32(x.T.COLORFEATUREATTRIBUTE):e.vec4f(x.T.COLOR),this.parameters.vvOpacityEnabled&&e.f32(x.T.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new G(this.layout,this.parameters)}requiresSlot(e,t){if(e===b.r.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===v.yD.OccludeAndTransparentStencil)return e===b.r.OPAQUE_MATERIAL||e===b.r.OCCLUDER_MATERIAL||e===b.r.TRANSPARENT_OCCLUDER_MATERIAL;const i=(0,_.S)(t);return i===m.H.Color||i===m.H.Alpha?e===(this.parameters.writeDepth?b.r.TRANSPARENT_MATERIAL:b.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===b.r.OPAQUE_MATERIAL}createGLMaterial(e){return e.output===m.H.Color||e.output===m.H.Alpha||e.output===m.H.Highlight||e.output===m.H.Depth?new H(e):null}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0)}}class H extends y.Z{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==m.H.Color&&this._output!==m.H.Alpha||this._updateOccludeeState(e),this.ensureTechnique(N,e)}}class j extends C.n{constructor(){super(...arguments),this.width=0,this.color=u.O,this.join="miter",this.cap=k.R.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class G{constructor(e,t){this.parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=t.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=S.N+i}}_isClosed(e){return Z(this.parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.indices.get(x.T.POSITION).length/2+1,i=this._isClosed(e);let r=i?2:4;return r+=((i?t:t-1)-(i?0:1))*(2*this.numJoinSubdivisions+4),r+=2,this.parameters.wireframe&&(r=2+4*(r-2)),r}write(e,t,i,r){const s=ne,n=oe,o=ae,a=t.vertexAttributes.get(x.T.POSITION).data,c=t.indices&&t.indices.get(x.T.POSITION),u=t.vertexAttributes.get(x.T.DISTANCETOSTART)?.data;c&&c.length!==2*(a.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let h=1,d=0;this.parameters.vvSizeEnabled?d=t.vertexAttributes.get(x.T.SIZEFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(x.T.SIZE)&&(h=t.vertexAttributes.get(x.T.SIZE).data[0]);let p=[1,1,1,1],f=0;this.parameters.vvColorEnabled?f=t.vertexAttributes.get(x.T.COLORFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(x.T.COLOR)&&(p=t.vertexAttributes.get(x.T.COLOR).data);let m=0;this.parameters.vvOpacityEnabled&&(m=t.vertexAttributes.get(x.T.OPACITYFEATUREATTRIBUTE).data[0]);const g=a.length/3,y=e.transformation,_=new Float32Array(i.buffer),v=this.vertexBufferLayout.stride/4;let b=r*v;const w=b;let C=0;const T=u?(e,t,i)=>C=u[i]:(e,t,i)=>C+=(0,l.i)(e,t),S=(e,t,i,r,s,n,o)=>{if(_[b++]=t[0],_[b++]=t[1],_[b++]=t[2],_[b++]=r,_[b++]=o,_[b++]=s,_[b++]=e[0],_[b++]=e[1],_[b++]=e[2],_[b++]=i[0],_[b++]=i[1],_[b++]=i[2],this.parameters.vvSizeEnabled?_[b++]=d:_[b++]=h,this.parameters.vvColorEnabled)_[b++]=f;else{const e=Math.min(4*n,p.length-4);_[b++]=p[e+0],_[b++]=p[e+1],_[b++]=p[e+2],_[b++]=p[e+3]}this.parameters.vvOpacityEnabled&&(_[b++]=m)};b+=v,(0,l.s)(n,a[0],a[1],a[2]),y&&(0,l.m)(n,n,y);const E=this._isClosed(t);if(E){const e=a.length-3;(0,l.s)(s,a[e],a[e+1],a[e+2]),y&&(0,l.m)(s,s,y)}else(0,l.s)(o,a[3],a[4],a[5]),y&&(0,l.m)(o,o,y),S(n,n,o,1,V.LEFT_CAP_START,0,0),S(n,n,o,1,V.RIGHT_CAP_START,0,0),(0,l.c)(s,n),(0,l.c)(n,o);const A=E?0:1,M=E?g:g-1;for(let e=A;e<M;e++){const t=(e+1)%g*3;(0,l.s)(o,a[t+0],a[t+1],a[t+2]),y&&(0,l.m)(o,o,y),T(s,n,e),S(s,n,o,0,V.LEFT_JOIN_END,e,C),S(s,n,o,0,V.RIGHT_JOIN_END,e,C);const i=this.numJoinSubdivisions;for(let t=0;t<i;++t){const r=(t+1)/(i+1);S(s,n,o,r,V.LEFT_JOIN_END,e,C),S(s,n,o,r,V.RIGHT_JOIN_END,e,C)}S(s,n,o,1,V.LEFT_JOIN_START,e,C),S(s,n,o,1,V.RIGHT_JOIN_START,e,C),(0,l.c)(s,n),(0,l.c)(n,o)}E?((0,l.s)(o,a[3],a[4],a[5]),y&&(0,l.m)(o,o,y),C=T(s,n,M),S(s,n,o,0,V.LEFT_JOIN_END,A,C),S(s,n,o,0,V.RIGHT_JOIN_END,A,C)):(C=T(s,n,M),S(s,n,n,0,V.LEFT_CAP_END,M,C),S(s,n,n,0,V.RIGHT_CAP_END,M,C)),W(_,w+v,_,w,v),b=W(_,b-v,_,b,v),this.parameters.wireframe&&this._addWireframeVertices(i,w,b,v)}_addWireframeVertices(e,t,i,r){const s=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),n=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,i-t);let o=0;const a=e=>o=W(n,e,s,o,r);for(let e=0;e<n.length-1;e+=2*r)a(e),a(e+2*r),a(e+1*r),a(e+2*r),a(e+1*r),a(e+3*r)}}function W(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function Z(e,t,i){return q(e,t.get(x.T.POSITION).data,i?i.get(x.T.POSITION):null)}function q(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const $=(0,c.c)(),Y=(0,c.c)(),X=(0,c.c)(),J=(0,c.c)(),K=(0,c.c)(),Q=(0,o.J$)(),ee=(0,o.J$)(),te=(0,c.c)(),ie=(0,c.c)(),re=(0,d.Ue)(),se=(0,d.Ue)(),ne=(0,c.c)(),oe=(0,c.c)(),ae=(0,c.c)(),le=[(0,o.J$)(),(0,o.J$)(),(0,o.J$)(),(0,o.J$)()],ce=[(0,c.c)(),(0,c.c)(),(0,c.c)(),(0,c.c)()],ue=(0,p.Ue)(),he=(0,p.Ue)(),de=(0,p.Ue)(),pe=(0,p.Ue)()},79503:(e,t,i)=>{"use strict";i.d(t,{h:()=>a});var r=i(73534),s=i(61681),n=i(91907),o=i(43487);class a{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach((e=>e.texture=(0,s.O3)(e.texture))),this.cache.clear()}_acquire(e){if((0,s.Wi)(e))return null;const t=this._patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;const a=e.pixelRatio,{encodedData:l,sdfNormalizer:c,pixels:u,paddedPixels:h}=function(e,t){const i=e.map((e=>Math.round(e*t))),s=1/t,n=Math.floor(i.reduce(((e,t)=>e+t))),o=i.reduce(((e,t)=>Math.max(e,t))),a=(Math.floor(.5*(o-1))+.5)*s,l=[];let c=1;for(const e of i){for(let t=0;t<e;t++){const i=c*(Math.min(t,e-1-t)+.5)*s/a*.5+.5;l.push(i)}c=-c}const u=Math.round(i[0]/2),h=[...l.slice(u),...l.slice(0,u)],d=n+2,p=new Uint8Array(4*d);let f=4;for(const e of h)(0,r.I)(e,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,sdfNormalizer:a,paddedPixels:d,pixels:n}}(e.pattern,a),d=u/a,p={refCount:1,texture:null,bind:e=>((0,s.Wi)(p.texture)&&(p.texture=new o.x(this._rctx,{width:h,height:1,internalFormat:n.VI.RGBA,pixelFormat:n.VI.RGBA,dataType:n.Br.UNSIGNED_BYTE,wrapMode:n.e8.CLAMP_TO_EDGE},l)),e.bindTexture("stipplePatternTexture",p.texture),{pixelSize:d,sdfNormalizer:c,pixels:u})};return this.cache.set(t,p),p.bind}release(e){if((0,s.Wi)(e))return;const t=this._patternId(e),i=this.cache.get(t);i&&(i.refCount--,0===i.refCount&&((0,s.pC)(i.texture)&&i.texture.dispose(),this.cache.delete(t)))}swap(e,t){const i=this._acquire(t);return this.release(e),i}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}}},67874:(e,t,i)=>{"use strict";i.d(t,{n:()=>o,x:()=>a});var r=i(34344),s=i(8909),n=i(7358);class o extends n.Mt{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=(0,s.f)(1,1,1),this.vvSizeMaxSize=(0,s.f)(100,100,100),this.vvSizeOffset=(0,s.f)(0,0,0),this.vvSizeFactor=(0,s.f)(1,1,1),this.vvSizeValue=(0,s.f)(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=(0,r.c)()}}const a=8},60581:(e,t,i)=>{"use strict";i.d(t,{H:()=>I,m:()=>L});var r=i(12928),s=i(69666),n=i(1983),o=i(25714),a=i(48978),l=i(71399),c=i(7358),u=i(12045),h=i(46378),d=i(61681),p=i(70984),f=i(5079),m=i(36663),g=i(65684),y=i(3864),_=i(5331),v=i(9969),b=i(52756),w=i(67197),x=i(5474),C=i(95194),T=i(86942),S=i(18406),E=i(17346);class A extends b.A{constructor(e,t,i){super(e,t,i),this._textureRepository=e.waterTextureRepository}initializeConfiguration(e,t){t.spherical=e.viewingMode===g.JY.Global,t.doublePrecisionRequiresObfuscation=(0,_.I)(e.rctx)}initializeProgram(e){const t=A.shader.get().build(this.configuration);return new C.$(e.rctx,t,x.i)}bindPass(e,t){this.program.bindPass(e,t),this.configuration.output!==o.H.Color&&this.configuration.output!==o.H.Normal||this._textureRepository.bind(this.program)}_setPipelineState(e){const t=this.configuration,i=e===p.Am.NONE,r=e===p.Am.FrontFace;return(0,E.sm)({blending:t.output!==o.H.Normal&&t.output!==o.H.Highlight&&t.transparent?i?u.wu:(0,u.j7)(e):null,depthTest:{func:(0,u.Bh)(e)},depthWrite:i?t.writeDepth&&E.LZ:(0,u.K5)(e),colorWrite:E.BK,polygonOffset:i||r?null:(0,u.je)(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}A.shader=new v.J(S.W,(()=>i.e(8126).then(i.bind(i,78126))));class M extends T.W{constructor(){super(...arguments),this.output=o.H.Color,this.transparencyPassType=p.Am.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,m._)([(0,w.o)({count:o.H.COUNT})],M.prototype,"output",void 0),(0,m._)([(0,w.o)({count:p.Am.COUNT})],M.prototype,"transparencyPassType",void 0),(0,m._)([(0,w.o)()],M.prototype,"spherical",void 0),(0,m._)([(0,w.o)()],M.prototype,"receiveShadows",void 0),(0,m._)([(0,w.o)()],M.prototype,"hasSlicePlane",void 0),(0,m._)([(0,w.o)()],M.prototype,"transparent",void 0),(0,m._)([(0,w.o)()],M.prototype,"enableOffset",void 0),(0,m._)([(0,w.o)()],M.prototype,"writeDepth",void 0),(0,m._)([(0,w.o)()],M.prototype,"hasScreenSpaceReflections",void 0),(0,m._)([(0,w.o)()],M.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,m._)([(0,w.o)()],M.prototype,"hasCloudsReflections",void 0),(0,m._)([(0,w.o)()],M.prototype,"isDraped",void 0),(0,m._)([(0,w.o)()],M.prototype,"hasMultipassTerrain",void 0),(0,m._)([(0,w.o)()],M.prototype,"cullAboveGround",void 0),(0,m._)([(0,w.o)({constValue:y.f7.Water})],M.prototype,"pbrMode",void 0),(0,m._)([(0,w.o)({constValue:!0})],M.prototype,"useCustomDTRExponentForWater",void 0),(0,m._)([(0,w.o)({constValue:!0})],M.prototype,"highStepCount",void 0),(0,m._)([(0,w.o)({constValue:!1})],M.prototype,"useFillLights",void 0);class O extends f.Z{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const t=(0,d.pC)(e.clouds.data);t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}ensureResources(e){const t=this._techniqueRepository.constructionContext.waterTextureRepository;return t.resourceState===p.Rw.NOT_LOADED&&t.loadTextures(e),t.resourceState}beginSlot(e){return this._output===o.H.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this.ensureTechnique(A,e)}}var R=i(89339),P=i(25584);class I extends c.F5{constructor(e){super(e,new L),this._techniqueConfig=new M,this.animation=new a.d}getConfiguration(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<u.ve,this._techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this._techniqueConfig}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<D;const i=this.animation.advance(e);return this.setParameters({timeElapsed:(0,r.D9)(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}intersect(e,t,i,r,s,n,o){(0,P.Bw)(e,t,r,s,n,void 0,o)}requiresSlot(e,t){switch((0,l.S)(t)){case o.H.Normal:return e===h.r.DRAPED_WATER;case o.H.Color:if(this.parameters.isDraped)return e===h.r.DRAPED_MATERIAL;break;case o.H.Highlight:return e===h.r.OPAQUE_MATERIAL||e===h.r.DRAPED_MATERIAL}let i=h.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?h.r.TRANSPARENT_MATERIAL:h.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){if(e.output===o.H.Color&&this.parameters.isDraped)return e.output=o.H.Draped,new O(e);switch(e.output){case o.H.Color:case o.H.Normal:case o.H.Highlight:case o.H.Alpha:return new O(e)}return null}createBufferWriter(){return new R.G_(R.W1)}}class L extends c.Mt{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=(0,s.f)(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=(0,n.f)(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const D=35e3},89339:(e,t,i)=>{"use strict";i.d(t,{G_:()=>c,IM:()=>l,W1:()=>a,wp:()=>o});var r=i(44685),s=i(21414),n=i(21123);const o=(0,r.U$)().vec3f(s.T.POSITION),a=(0,r.U$)().vec3f(s.T.POSITION).vec2f(s.T.UV0),l=(0,r.U$)().vec3f(s.T.POSITION).vec4u8(s.T.COLOR);class c{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(s.T.POSITION).length}write(e,t,i,r){(0,n.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}},25584:(e,t,i)=>{"use strict";i.d(t,{Bw:()=>m,CN:()=>v,FZ:()=>P,Fw:()=>S,Hx:()=>E,LO:()=>M,Mw:()=>x,TT:()=>O,Tw:()=>T,Ue:()=>C,Uf:()=>A});var r=i(7753),s=i(19431),n=i(61681),o=i(6766),a=i(8909),l=i(37116),c=i(70984),u=i(72946),h=i(15095),d=i(21414),p=i(73622);const f=(0,l.Ue)();function m(e,t,i,r,s,n,o){if(!(0,p.PD)(t))if(e.boundingInfo){(0,h.hu)(e.primitiveType===c.MX.Triangle);const t=i.tolerance;y(e.boundingInfo,r,s,t,n,o)}else{const t=e.indices.get(d.T.POSITION),i=e.vertexAttributes.get(d.T.POSITION);v(r,s,0,t.length/3,t,i,void 0,n,o)}}const g=(0,a.c)();function y(e,t,i,r,s,o){if((0,n.Wi)(e))return;const a=C(t,i,g);if((0,l.op)(f,e.getBBMin()),(0,l.Tn)(f,e.getBBMax()),(0,n.pC)(s)&&s.applyToAabb(f),T(f,t,a,r)){const{primitiveIndices:n,indices:a,position:l}=e,c=n?n.length:a.length/3;if(c>I){const n=e.getChildren();if(void 0!==n){for(let e=0;e<8;++e)void 0!==n[e]&&y(n[e],t,i,r,s,o);return}}v(t,i,0,c,a,l,n,s,o)}}const _=(0,a.c)();function v(e,t,i,r,s,o,a,l,c){if(a)return function(e,t,i,r,s,o,a,l,c){const u=o.data,h=o.stride||o.size,d=e[0],p=e[1],f=e[2],m=t[0]-d,g=t[1]-p,y=t[2]-f;for(let e=i;e<r;++e){const t=a[e];let i=3*t,r=h*s[i++],o=u[r++],v=u[r++],b=u[r];r=h*s[i++];let w=u[r++],C=u[r++],T=u[r];r=h*s[i];let S=u[r++],E=u[r++],A=u[r];(0,n.pC)(l)&&([o,v,b]=l.applyToVertex(o,v,b,e),[w,C,T]=l.applyToVertex(w,C,T,e),[S,E,A]=l.applyToVertex(S,E,A,e));const M=w-o,O=C-v,R=T-b,P=S-o,I=E-v,L=A-b,D=g*L-I*y,N=y*P-L*m,F=m*I-P*g,k=M*D+O*N+R*F;if(Math.abs(k)<=Number.EPSILON)continue;const U=d-o,V=p-v,z=f-b,B=U*D+V*N+z*F;if(k>0){if(B<0||B>k)continue}else if(B>0||B<k)continue;const H=V*R-O*z,j=z*M-R*U,G=U*O-M*V,W=m*H+g*j+y*G;if(k>0){if(W<0||B+W>k)continue}else if(W>0||B+W<k)continue;const Z=(P*H+I*j+L*G)/k;Z>=0&&c(Z,x(M,O,R,P,I,L,_),t,!1)}}(e,t,i,r,s,o,a,l,c);const u=o.data,h=o.stride||o.size,d=e[0],p=e[1],f=e[2],m=t[0]-d,g=t[1]-p,y=t[2]-f;for(let e=i,t=3*i;e<r;++e){let i=h*s[t++],r=u[i++],o=u[i++],a=u[i];i=h*s[t++];let v=u[i++],b=u[i++],w=u[i];i=h*s[t++];let C=u[i++],T=u[i++],S=u[i];(0,n.pC)(l)&&([r,o,a]=l.applyToVertex(r,o,a,e),[v,b,w]=l.applyToVertex(v,b,w,e),[C,T,S]=l.applyToVertex(C,T,S,e));const E=v-r,A=b-o,M=w-a,O=C-r,R=T-o,P=S-a,I=g*P-R*y,L=y*O-P*m,D=m*R-O*g,N=E*I+A*L+M*D;if(Math.abs(N)<=Number.EPSILON)continue;const F=d-r,k=p-o,U=f-a,V=F*I+k*L+U*D;if(N>0){if(V<0||V>N)continue}else if(V>0||V<N)continue;const z=k*M-A*U,B=U*E-M*F,H=F*A-E*k,j=m*z+g*B+y*H;if(N>0){if(j<0||V+j>N)continue}else if(j>0||V+j<N)continue;const G=(O*z+R*B+P*H)/N;G>=0&&c(G,x(E,A,M,O,R,P,_),e,!1)}}const b=(0,a.c)(),w=(0,a.c)();function x(e,t,i,r,s,n,a){return(0,o.s)(b,e,t,i),(0,o.s)(w,r,s,n),(0,o.f)(a,b,w),(0,o.n)(a,a),a}function C(e,t,i){return(0,o.s)(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function T(e,t,i,r){return S(e,t,i,r,1/0)}function S(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-r-t[1])*i[1],u=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(c,u)),l<0)return!1;if(a=Math.max(a,Math.min(c,u)),a>l)return!1;const h=(e[2]-r-t[2])*i[2],d=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(h,d)),!(l<0)&&(a=Math.max(a,Math.min(h,d)),!(a>l)&&a<s)}function E(e,t,i,r,o){let a=(i.screenLength||0)*e.pixelRatio;(0,n.pC)(o)&&(a=(0,u.bA)(a,r,t,o));const l=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return(0,s.uZ)(l*t,i.minWorldLength||0,null!=i.maxWorldLength?i.maxWorldLength:1/0)}function A(e,t){const i=t?A(t):{};for(const t in e){let r=e[t];r&&r.forEach&&(r=R(r)),null==r&&t in i||(i[t]=r)}return i}function M(e,t){let i=!1;for(const s in t){const n=t[s];void 0!==n&&(Array.isArray(n)?null===e[s]?(e[s]=n.slice(),i=!0):(0,r.Vx)(e[s],n)&&(i=!0):e[s]!==n&&(i=!0,e[s]=n))}return i}function O(e,t,i,r,n,o){if(!t.options.selectionMode)return;const a=e.vertexAttributes.get(d.T.POSITION).data,l=e.vertexAttributes.get(d.T.SIZE),c=l&&l.data[0],u=r[0],h=r[1],p=((c+n)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let e=0;e<a.length-5;e+=3){const t=a[e],i=a[e+1],r=u-t,n=h-i,o=a[e+3]-t,l=a[e+4]-i,c=(0,s.uZ)((o*r+l*n)/(o*o+l*l),0,1),d=o*c-r,p=l*c-n,g=d*d+p*p;g<f&&(f=g,m=e/3)}f<p*p&&o(i.dist,i.normal,m,!1)}function R(e){const t=[];return e.forEach((e=>t.push(e))),t}const P={multiply:1,ignore:2,replace:3,tint:4},I=1e3},21123:(e,t,i)=>{"use strict";i.d(t,{NK:()=>m,SW:()=>u,Vs:()=>f,XW:()=>a,ho:()=>h,s5:()=>d});var r=i(24455),s=i(81936),n=i(15095),o=i(21414);function a(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,1===s)for(let i=0;i<a;++i)n[r]=t[e[i]],r+=o;else for(let i=0;i<a;++i){const a=t[e[i]];for(let e=0;e<s;e++)n[r]=a,r+=o}}function l(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=e.length;r*=n;for(let i=0;i<o;++i){const o=2*e[i];s[r]=t[o],s[r+1]=t[o+1],r+=n}}function c(e,t,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,null==s||1===s)for(let i=0;i<a;++i){const s=3*e[i];n[r]=t[s],n[r+1]=t[s+1],n[r+2]=t[s+2],r+=o}else for(let i=0;i<a;++i){const a=3*e[i];for(let e=0;e<s;++e)n[r]=t[a],n[r+1]=t[a+1],n[r+2]=t[a+2],r+=o}}function u(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,1===s)for(let i=0;i<a;++i){const s=4*e[i];n[r]=t[s],n[r+1]=t[s+1],n[r+2]=t[s+2],n[r+3]=t[s+3],r+=o}else for(let i=0;i<a;++i){const a=4*e[i];for(let e=0;e<s;++e)n[r]=t[a],n[r+1]=t[a+1],n[r+2]=t[a+2],n[r+3]=t[a+3],r+=o}}function h(e,t,i,r,s,n=1){if(!i)return void c(e,t,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=e.length,u=i[0],h=i[1],d=i[2],p=i[4],f=i[5],m=i[6],g=i[8],y=i[9],_=i[10],v=i[12],b=i[13],w=i[14];if(s*=a,1===n)for(let i=0;i<l;++i){const r=3*e[i],n=t[r],l=t[r+1],c=t[r+2];o[s]=u*n+p*l+g*c+v,o[s+1]=h*n+f*l+y*c+b,o[s+2]=d*n+m*l+_*c+w,s+=a}else for(let i=0;i<l;++i){const r=3*e[i],l=t[r],c=t[r+1],x=t[r+2],C=u*l+p*c+g*x+v,T=h*l+f*c+y*x+b,S=d*l+m*c+_*x+w;for(let e=0;e<n;++e)o[s]=C,o[s+1]=T,o[s+2]=S,s+=a}}function d(e,t,i,s,n,o=1){if(!i)return void c(e,t,s,n,o);const a=i,l=s.typedBuffer,u=s.typedBufferStride,h=e.length,d=a[0],p=a[1],f=a[2],m=a[4],g=a[5],y=a[6],_=a[8],v=a[9],b=a[10],w=!(0,r.p)(a),x=1e-6,C=1-x;if(n*=u,1===o)for(let i=0;i<h;++i){const r=3*e[i],s=t[r],o=t[r+1],a=t[r+2];let c=d*s+m*o+_*a,h=p*s+g*o+v*a,T=f*s+y*o+b*a;if(w){const e=c*c+h*h+T*T;if(e<C&&e>x){const t=1/Math.sqrt(e);c*=t,h*=t,T*=t}}l[n+0]=c,l[n+1]=h,l[n+2]=T,n+=u}else for(let i=0;i<h;++i){const r=3*e[i],s=t[r],a=t[r+1],c=t[r+2];let h=d*s+m*a+_*c,T=p*s+g*a+v*c,S=f*s+y*a+b*c;if(w){const e=h*h+T*T+S*S;if(e<C&&e>x){const t=1/Math.sqrt(e);h*=t,T*=t,S*=t}}for(let e=0;e<o;++e)l[n+0]=h,l[n+1]=T,l[n+2]=S,n+=u}}function p(e,t,i,s,n,o=1){if(!i)return void u(e,t,s,n,o);const a=i,l=s.typedBuffer,c=s.typedBufferStride,h=e.length,d=a[0],p=a[1],f=a[2],m=a[4],g=a[5],y=a[6],_=a[8],v=a[9],b=a[10],w=!(0,r.p)(a),x=1e-6,C=1-x;if(n*=c,1===o)for(let i=0;i<h;++i){const r=4*e[i],s=t[r],o=t[r+1],a=t[r+2],u=t[r+3];let h=d*s+m*o+_*a,T=p*s+g*o+v*a,S=f*s+y*o+b*a;if(w){const e=h*h+T*T+S*S;if(e<C&&e>x){const t=1/Math.sqrt(e);h*=t,T*=t,S*=t}}l[n+0]=h,l[n+1]=T,l[n+2]=S,l[n+3]=u,n+=c}else for(let i=0;i<h;++i){const r=4*e[i],s=t[r],a=t[r+1],u=t[r+2],h=t[r+3];let T=d*s+m*a+_*u,S=p*s+g*a+v*u,E=f*s+y*a+b*u;if(w){const e=T*T+S*S+E*E;if(e<C&&e>x){const t=1/Math.sqrt(e);T*=t,S*=t,E*=t}}for(let e=0;e<o;++e)l[n+0]=T,l[n+1]=S,l[n+2]=E,l[n+3]=h,n+=c}}function f(e,t,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=e.length;if(s*=a,1===n){if(4===i)for(let i=0;i<l;++i){const r=4*e[i];o[s]=t[r],o[s+1]=t[r+1],o[s+2]=t[r+2],o[s+3]=t[r+3],s+=a}else if(3===i)for(let i=0;i<l;++i){const r=3*e[i];o[s]=t[r],o[s+1]=t[r+1],o[s+2]=t[r+2],o[s+3]=255,s+=a}}else if(4===i)for(let i=0;i<l;++i){const r=4*e[i];for(let e=0;e<n;++e)o[s]=t[r],o[s+1]=t[r+1],o[s+2]=t[r+2],o[s+3]=t[r+3],s+=a}else if(3===i)for(let i=0;i<l;++i){const r=3*e[i];for(let e=0;e<n;++e)o[s]=t[r],o[s+1]=t[r+1],o[s+2]=t[r+2],o[s+3]=255,s+=a}}function m(e,t,i,r,a,c){for(const u of t.fieldNames){const t=e.vertexAttributes.get(u),m=e.indices.get(u);if(t&&m)switch(u){case o.T.POSITION:{(0,n.hu)(3===t.size);const e=a.getField(u,s.ct);e&&h(m,t.data,i,e,c);break}case o.T.NORMAL:{(0,n.hu)(3===t.size);const e=a.getField(u,s.ct);e&&d(m,t.data,r,e,c);break}case o.T.UV0:{(0,n.hu)(2===t.size);const e=a.getField(u,s.Eu);e&&l(m,t.data,e,c);break}case o.T.COLOR:{(0,n.hu)(3===t.size||4===t.size);const e=a.getField(u,s.mc);e&&f(m,t.data,t.size,e,c);break}case o.T.SYMBOLCOLOR:{(0,n.hu)(3===t.size||4===t.size);const e=a.getField(u,s.mc);e&&f(m,t.data,t.size,e,c);break}case o.T.TANGENT:{(0,n.hu)(4===t.size);const e=a.getField(u,s.ek);e&&p(m,t.data,r,e,c);break}}}}},66962:(e,t,i)=>{"use strict";i.d(t,{Dp:()=>a,z5:()=>o});var r=i(61681);const s={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},n={dash:s.dash,"dash-dot":[...s.dash,...s.dot],dot:s.dot,"long-dash":s["long-dash"],"long-dash-dot":[...s["long-dash"],...s.dot],"long-dash-dot-dot":[...s["long-dash"],...s.dot,...s.dot],none:null,"short-dash":s["short-dash"],"short-dash-dot":[...s["short-dash"],...s["short-dot"]],"short-dash-dot-dot":[...s["short-dash"],...s["short-dot"],...s["short-dot"]],"short-dot":s["short-dot"],solid:null};function o(e,t=2){return{pattern:[e,e],pixelRatio:t}}function a(e){return(0,r.pC)(e)&&"style"===e.type?function(e){return(0,r.pC)(e)?function(e,t=2){return(0,r.Wi)(e)?e:{pattern:e.slice(),pixelRatio:t}}(n[e],8):null}(e.style):null}},1055:(e,t,i)=>{"use strict";i.d(t,{A:()=>N});var r=i(86114),s=i(61681),n=i(17135),o=i(24455),a=i(39100),l=i(95397),c=i(71399),u=i(7358),h=i(79341),d=i(38208),p=i(15095),f=i(22456),m=i(60581);class g{constructor(e){this.first=e.from,this.count=e.to-e.from}}class y{constructor(e=0,t=0){this.from=e,this.to=t}}class _ extends y{constructor(e,t,i,r,s,n){super(t,i),this.id=e,this.isVisible=r,this.hasHighlights=s,this.hasOccludees=n}}function v(e){return Array.from(e.values()).sort(b)}function b(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function w(e,t){if(0===e.length)return void e.push(new g(t));const i=e[e.length-1];if(function(e,t){return e.first+e.count>=t.from}(i,t)){const e=t.from-i.first+t.to-t.from;i.count=e}else e.push(new g(t))}class x{constructor(e,t){this._pool=e,this._size=0,this._buffer=e.newBuffer(C(t))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(e){this._resize(this._size+e,!0).dispose()}alloc(e){return this._resize(e,!1)}_resize(e,t){let i;const r=T(this._buffer.length,this._size,e);if(this._buffer.length!==r){const e=this._pool.newBuffer(r);t&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,r))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.byteLength)),i=this._buffer,this._buffer=e}const s=this._size;return this._size=e,i?{dispose:()=>{i.array.fill(0,0,s),this._pool.deleteBuffer(i)},copy:(e,t,r)=>this._buffer.array.set(i.array.subarray(t,r),e),hasNewBuffer:!0}:{dispose:()=>{},copy:(e,t,i)=>{e!==t&&this._buffer.array.copyWithin(e,t,i)},hasNewBuffer:!1}}erase(e,t){this._buffer.array.fill(0,e,t)}}function C(e){return 65536*Math.ceil(e/65536)}function T(e,t,i){return t<=i?e>=i?e:C(Math.max(2*e,i)):e<=2*i?e:C(i)}var S=i(40366),E=i(7958),A=i(78951),M=i(91907),O=i(29620);class R{constructor(e,t,i,r){this.vao=new O.U(e,t,{geometry:i},{geometry:A.f.createVertex(e,M.l1.STATIC_DRAW)}),this.array=new Float32Array(r),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const P=S.an+1;class I{constructor(e,t,i){this._rctx=e,this._locations=t,this._layout=i,this._cache=e.newCache(`MergedRenderer pool ${(0,E.D)()}`,L)}dispose(){this._cache.destroy()}newBuffer(e){const t=e.toString(),i=this._cache.pop(t);if((0,s.pC)(i)){const e=i.pop();return i.length>0&&this._cache.put(t,i,e.array.byteLength*i.length,P),e}return new R(this._rctx,this._locations,this._layout,e)}deleteBuffer(e){const t=e.array.byteLength,i=e.array.length.toString(),r=this._cache.pop(i);return(0,s.pC)(r)?(r.push(e),this._cache.put(i,r,t*r.length,-1)):this._cache.put(i,[e],t,-1),null}}function L(e,t){if(t===S.lN.ALL)return void e.forEach((e=>e.dispose()));const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}var D=i(73622);class N{constructor(e,t,i){this._rctx=e,this._materialRepository=t,this._material=i,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new n.Z,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new c.p(this._material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._bufferPool=new I(e,i.vertexAttributeLocations,(0,l.K)(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach((e=>e.buffer.dispose())),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof m.H}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==u.yD.Occlude}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateRenderCommands()}_addAndRemoveGeometries(e,t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4,s=this._dataByOrigin,n=function(e,t){const i=new Map;for(const t of e)k(i,t,!0);for(const e of t)k(i,e,!1);return i}(e,t);n.forEach(((e,t)=>{n.delete(t);const o=e.toAdd.reduce(((e,t)=>e+i.elementCount(t.data)),0);let a=s.get(t);if(null==a)(0,p.hu)(0===e.toRemove.length),a=new B(e.origin,new x(this._bufferPool,o*r)),s.set(t,a);else if(0===e.toAdd.length&&a.instances.size===e.toRemove.length)return a.buffer.dispose(),void s.delete(t);let l=0;a.instances.forEach((e=>l+=e.to-e.from));const c=e.toRemove.reduce(((e,t)=>e+i.elementCount(t.data)),0),u=a.buffer.size,h=(l+o-c)*r,d=j;if(h<u/2?this._removeAndRebuild(a,e.toRemove,r,h,d):e.toRemove.length>0&&this._remove(a,e.toRemove,r,d),e.toAdd.length>0){const t=G;(0,p.u_)(t,-e.origin[0],-e.origin[1],-e.origin[2]),this._add(a,e.toAdd,r,t,d)}const f=a.buffer.vao.vertexBuffers.geometry;z(d),d.forAll((({from:e,to:t})=>{if(e<t){const i=a.buffer.array,r=4,s=e*r,n=t*r;f.setSubData(i,s,s,n)}})),d.clear(),a.drawCommandsDirty=!0}))}_updateGeometries(e){const t=this._bufferWriter,i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.renderGeometry,s=this._dataByOrigin.get(e.origin.id),n=s&&s.instances.get(e.id);if(!n)return;const o=r.updateType;if(o&h.$.State.VISIBILITIES&&(n.isVisible=e.instanceParameters.visible),o&(h.$.State.HIGHLIGHTS|h.$.State.VISIBILITIES)){const t=e.instanceParameters.visible;n.hasHighlights=!!e.instanceParameters.highlights&&t}if(o&h.$.State.OCCLUDEES&&(n.hasOccludees=!!e.instanceParameters.occludees),o&(h.$.State.VERTEXATTRS|h.$.State.TRANSFORMATION)){const{array:r,vao:o}=s.buffer;(0,D.bZ)(e,W,Z),t.write({transformation:W,invTranspTransformation:Z},e.data,t.vertexBufferLayout.createView(r.buffer),n.from),(0,p.hu)(n.from+t.elementCount(e.data)===n.to,"material VBO layout has changed"),o.vertexBuffers.geometry.setSubData(r,n.from*i*4,n.from*i*4,n.to*i*4)}s.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,(0,r.oE)(e.instances,(t=>(t.isVisible?(t.hasHighlights&&(this._hasHighlights=!0,e.hasHighlights=!0),t.hasOccludees&&(this._hasOccludees=!0,e.hasOccludees=!0)):e.hasHiddenInstances=!0,e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees)))}));const e=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,0===e.instances.size)return;if(!U(e)){const t=this._bufferWriter.vertexBufferLayout.stride,i=4*e.buffer.size/t;return void(e.drawCommandsDefault=[{first:0,count:i}])}const t=v(e.instances);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const i of t)i.isVisible&&(i.hasOccludees?w(e.drawCommandsOccludees,i):w(e.drawCommandsDefault,i),i.hasHighlights?w(e.drawCommandsHighlight,i):w(e.drawCommandsShadowHighlightRest,i))};this._dataByOrigin.forEach((t=>{t.drawCommandsDirty&&(e(t),t.drawCommandsDirty=!1)}))}updateAnimation(e){return this._material.update(e)}requiresSlot(e,t){return null==e||this._material.requiresSlot(e,t)}render(e,t){if(!this.requiresSlot(t.slot,e))return!1;const i=e===d.C.MATERIAL_HIGHLIGHT||e===d.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(i&&!this._hasHighlights)return!1;const r=e===d.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,n=!(i||r);if(this._dataByOrigin.forEach((e=>{if(i&&!e.hasHighlights)return;const t=(i?e.drawCommandsHighlight:r&&U(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,o=n&&e.drawCommandsOccludees||null;((0,s.pC)(t)||(0,s.pC)(o))&&this._renderCommandData.push(new H(e.origin,e.buffer,t,o))})),0===this._renderCommandData.length)return!1;const o=this._rctx,a=this._glMaterials.load(o,e);if((0,s.Wi)(a))return this._renderCommandData.clear(),!1;const l=a.beginSlot(t);return o.bindTechnique(l,this._material.parameters,t,!1),this._renderCommandData.forAll((e=>{l.bindDraw(e,t);const{buffer:i,renderCommands:r,occludeeCommands:n}=e;l.ensureAttributeLocations(i.vao),o.bindVAO(i.vao);const a=l.primitiveType;(0,s.pC)(r)&&this._renderCommands(o,a,r),(0,s.pC)(n)&&(l.bindPipelineState(o,t.slot,!0),this._renderCommands(o,a,n),l.bindPipelineState(o,t.slot,!1))})),this._renderCommandData.clear(),!0}_renderCommands(e,t,i){for(let r=0;r<i.length;r++)e.drawArrays(t,i[r].first,i[r].count)}_removeAndRebuild(e,t,i,r,s){for(const i of t)e.instances.delete(i.id);const n=v(e.instances);e.instances.clear();const o=e.buffer.size,a=e.buffer.alloc(r);let l=0;for(const t of n){const r=t.from*i,s=t.to*i;a.copy(l,r,s),t.from=l/i,l+=s-r,t.to=l/i,e.instances.set(t.id,t)}s.push(new y(0,a.hasNewBuffer?e.buffer.array.length:o)),a.dispose(),e.buffer.erase(l,s.back().to),e.holes.clear()}_remove(e,t,i,r){for(const s of t){const t=s.id,n=e.instances.get(t),o=n.from*i,a=n.to*i;e.buffer.erase(o,a),e.holes.push(new y(n.from,n.to)),e.instances.delete(t),r.push(new y(o,a))}z(e.holes)}_add(e,t,i,r,n){if(0===t.length)return;const a=this._bufferWriter;let l=a.vertexBufferLayout.createView(e.buffer.array.buffer);const c=e.holes.length>0;let u=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(const d of t){const t=(0,s.pC)(d.transformation)?(0,o.m)(W,r,d.transformation):r;(0,o.a)(Z,t);const f=(0,o.t)(Z,Z),m=a.elementCount(d.data),g=m*i;let v=V(e.holes,m);(0,s.Wi)(v)&&(v=e.buffer.size/i,e.buffer.grow(g),l=a.vertexBufferLayout.createView(e.buffer.array.buffer)),a.write({transformation:t,invTranspTransformation:f},d.data,l,v);const b=d.instanceParameters.visible,w=!!d.instanceParameters.highlights&&b,x=!!d.instanceParameters.occludees,C=new _(d.id,v,v+m,b,w,x);(0,p.hu)(null==e.instances.get(d.id)),e.instances.set(d.id,C),c?n.push(new y(C.from*i,C.to*i)):(u=Math.min(C.from,u),h=Math.max(C.to,h))}c||n.push(new y(u*i,h*i))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class F{constructor(e){this.origin=e,this.toAdd=new Array,this.toRemove=new Array}}function k(e,t,i){const r=t.origin;if((0,s.Wi)(r))return;let n=e.get(r.id);null==n&&(n=new F(r.vec3),e.set(r.id,n)),i?n.toAdd.push(t):n.toRemove.push(t)}function U(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function V(e,t){let i;if(!e.some((e=>!(e.to-e.from<t||(i=e,0)))))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function z(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let i=!0;for(;i;)i=!1,e.forEach((r=>{const s=t.get(r.to);s&&(r.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)}))}class B{constructor(e,t){this.origin=e,this.buffer=t,this.instances=new Map,this.holes=new n.Z({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class H extends f.w{constructor(e,t,i,r){super(e),this.buffer=t,this.renderCommands=i,this.occludeeCommands=r}}const j=new n.Z({deallocator:null}),G=(0,a.c)(),W=(0,a.c)(),Z=(0,a.c)()},73622:(e,t,i)=>{"use strict";i.d(t,{EE:()=>d,PD:()=>u,U_:()=>c,bZ:()=>h,lr:()=>l});var r=i(61681),s=i(24455),n=i(39100),o=i(15095),a=i(30560);function l(e,t){return(0,r.Wi)(e)&&(e=[]),e.push(t),e}function c(e,t){if((0,r.Wi)(e))return null;const i=e.filter((e=>e!==t));return 0===i.length?null:i}function u(e){return!!(0,r.pC)(e)&&!e.visible}function h(e,t,i){const n=e.origin.vec3;(0,o.u_)(m,-n[0],-n[1],-n[2]),(0,r.pC)(e.transformation)?(0,s.m)(t,m,e.transformation):(0,s.c)(t,m),i&&((0,s.a)(i,t),(0,s.t)(i,i))}function d(e,t,i,r,s){p[0]=e.get(t,0),p[1]=e.get(t,1),p[2]=e.get(t,2),(0,a.LF)(p,f,3),i.set(s,0,f[0]),r.set(s,0,f[1]),i.set(s,1,f[2]),r.set(s,1,f[3]),i.set(s,2,f[4]),r.set(s,2,f[5])}const p=new Float64Array(3),f=new Float32Array(6),m=(0,n.c)()},42199:(e,t,i)=>{"use strict";i.d(t,{Fv:()=>s,ZB:()=>l,v3:()=>r});var r,s,n,o=i(36663),a=i(67197);(n=r||(r={}))[n.Standard=0]="Standard",n[n.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",n[n.Transparency=2]="Transparency",n[n.OverlayWithTransparency=3]="OverlayWithTransparency",n[n.COUNT=4]="COUNT",function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(s||(s={}));class l extends a.m{constructor(){super(...arguments),this.function=r.Standard,this.alphaMode=s.None,this.hasOpacityFactor=!1}}(0,o._)([(0,a.o)({count:r.COUNT})],l.prototype,"function",void 0),(0,o._)([(0,a.o)({count:s.COUNT})],l.prototype,"alphaMode",void 0),(0,o._)([(0,a.o)()],l.prototype,"hasOpacityFactor",void 0)},28541:(e,t,i)=>{"use strict";i.d(t,{Qm:()=>T,em:()=>C,tT:()=>S});var r=i(34344),s=i(8909),n=i(1983),o=i(65684),a=i(25714),l=i(82082),c=i(78549),u=i(44391),h=i(5331),d=i(9969),p=i(52756),f=i(70984),m=i(5474),g=i(7358),y=i(12045),_=i(95194),v=i(79040),b=i(45584),w=i(91907),x=i(17346);class C extends c.d4{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=(0,s.f)(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=f.Vr.Back,this.emissiveFactor=(0,s.f)(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=(0,s.f)(.2,.2,.2),this.diffuse=(0,s.f)(.8,.8,.8),this.externalColor=(0,n.f)(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=(0,s.c)(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=(0,r.c)(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=f.Gv.Less,this.textureAlphaMode=f.JJ.Blend,this.textureAlphaCutoff=u.F,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=g.yD.Occlude}}class T extends c.Pf{constructor(){super(...arguments),this.origin=(0,s.c)(),this.slicePlaneLocalOrigin=this.origin}}class S extends p.A{initializeConfiguration(e,t){t.spherical=e.viewingMode===o.JY.Global,t.doublePrecisionRequiresObfuscation=(0,h.I)(e.rctx),t.textureCoordinateType=t.hasColorTexture||t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture||t.hasNormalTexture?l.N.Default:l.N.None}initializeProgram(e){return this._initializeProgram(e,S.shader)}_initializeProgram(e,t){const i=t.get().build(this.configuration);return new _.$(e.rctx,i,m.i)}_convertDepthTestFunction(e){return e===f.Gv.Lequal?w.wb.LEQUAL:w.wb.LESS}_setPipeline(e,t){const i=this.configuration,r=e===f.Am.NONE,s=e===f.Am.FrontFace;return(0,x.sm)({blending:i.output!==a.H.Color&&i.output!==a.H.Alpha||!i.transparent?null:r?y.wu:(0,y.j7)(e),culling:E(i)&&(0,x.zp)(i.cullFace),depthTest:{func:(0,y.Bh)(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:r||s?i.writeDepth&&x.LZ:null,colorWrite:x.BK,stencilWrite:i.hasOccludees?v.s3:null,stencilTest:i.hasOccludees?t?v.eD:v.RY:null,polygonOffset:r||s?null:(0,y.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}function E(e){return e.cullFace!==f.Vr.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}S.shader=new d.J(b.D,(()=>i.e(1180).then(i.bind(i,1180))))},26531:(e,t,i)=>{"use strict";i.d(t,{G:()=>u,R:()=>r});var r,s,n=i(36663),o=i(25714),a=i(67197),l=i(70984),c=i(86942);(s=r||(r={}))[s.BUTT=0]="BUTT",s[s.SQUARE=1]="SQUARE",s[s.ROUND=2]="ROUND",s[s.COUNT=3]="COUNT";class u extends c.W{constructor(){super(...arguments),this.output=o.H.Color,this.capType=r.BUTT,this.transparencyPassType=l.Am.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}(0,n._)([(0,a.o)({count:o.H.COUNT})],u.prototype,"output",void 0),(0,n._)([(0,a.o)({count:r.COUNT})],u.prototype,"capType",void 0),(0,n._)([(0,a.o)({count:l.Am.COUNT})],u.prototype,"transparencyPassType",void 0),(0,n._)([(0,a.o)()],u.prototype,"occluder",void 0),(0,n._)([(0,a.o)()],u.prototype,"hasSlicePlane",void 0),(0,n._)([(0,a.o)()],u.prototype,"hasPolygonOffset",void 0),(0,n._)([(0,a.o)()],u.prototype,"writeDepth",void 0),(0,n._)([(0,a.o)()],u.prototype,"draped",void 0),(0,n._)([(0,a.o)()],u.prototype,"stippleEnabled",void 0),(0,n._)([(0,a.o)()],u.prototype,"stippleOffColorEnabled",void 0),(0,n._)([(0,a.o)()],u.prototype,"stippleScaleWithLineWidth",void 0),(0,n._)([(0,a.o)()],u.prototype,"stipplePreferContinuous",void 0),(0,n._)([(0,a.o)()],u.prototype,"roundJoins",void 0),(0,n._)([(0,a.o)()],u.prototype,"vvSize",void 0),(0,n._)([(0,a.o)()],u.prototype,"vvColor",void 0),(0,n._)([(0,a.o)()],u.prototype,"vvOpacity",void 0),(0,n._)([(0,a.o)()],u.prototype,"falloffEnabled",void 0),(0,n._)([(0,a.o)()],u.prototype,"innerColorEnabled",void 0),(0,n._)([(0,a.o)()],u.prototype,"hasOccludees",void 0),(0,n._)([(0,a.o)()],u.prototype,"hasMultipassTerrain",void 0),(0,n._)([(0,a.o)()],u.prototype,"cullAboveGround",void 0),(0,n._)([(0,a.o)()],u.prototype,"wireframe",void 0),(0,n._)([(0,a.o)({constValue:!0})],u.prototype,"stippleRequiresClamp",void 0),(0,n._)([(0,a.o)({constValue:!0})],u.prototype,"stippleRequiresStretchMeasure",void 0),(0,n._)([(0,a.o)({constValue:!0})],u.prototype,"hasVvInstancing",void 0),(0,n._)([(0,a.o)({constValue:!0})],u.prototype,"hasSliceTranslatedView",void 0)},50740:(e,t,i)=>{"use strict";i.d(t,{l:()=>a,w:()=>r});var r,s,n=i(36663),o=i(67197);(s=r||(r={}))[s.Gradient=0]="Gradient",s[s.Threshold=1]="Threshold",s[s.COUNT=2]="COUNT";class a extends o.m{constructor(){super(...arguments),this.visualization=r.Gradient,this.bandsEnabled=!1}}(0,n._)([(0,o.o)({count:r.COUNT})],a.prototype,"visualization",void 0),(0,n._)([(0,o.o)()],a.prototype,"bandsEnabled",void 0)},62467:(e,t,i)=>{"use strict";i.d(t,{g:()=>h});var r=i(69666),s=i(23410);function n(e){const t=s.H`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}var o=i(93072),a=i(11125),l=i(87621),c=i(67948);const u=(0,r.f)(.5,-4e-4);function h(e,t){const i=e.vertex;i.include(n),i.constants.add("depthBias","vec2",u),i.uniforms.add(new o.A("inverseViewport",((e,t)=>t.inverseViewport))),t.legacy?(i.uniforms.add(new c.B("localView")),i.uniforms.add(new l.g("proj",((e,t)=>t.camera.projectionMatrix))),i.code.add(s.H`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new a.c("transformNormalViewFromGlobal",(e=>e.transformNormalViewFromGlobal))),i.uniforms.add(new l.g("transformProjFromView",(e=>e.transformProjFromView))),i.code.add(s.H`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(s.H`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}},57057:(e,t,i)=>{"use strict";i.d(t,{S:()=>s});var r=i(23410);function s(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(r.H`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(r.H`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}},63922:(e,t,i)=>{"use strict";i.d(t,{o:()=>s});var r=i(23410);function s(e,t){const i=e.vertex;t.silhouette?(i.code.add(r.H`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(r.H`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(r.H`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(r.H`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}},70239:(e,t,i)=>{"use strict";i.d(t,{l:()=>n});var r=i(23410),s=i(37630);function n(e,t){const i=e.vertex;switch(t.mode){case s.Jb.SKETCH:i.code.add(r.H`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case s.Jb.MIXED:i.code.add(r.H`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case s.Jb.SOLID:i.code.add(r.H`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}},37630:(e,t,i)=>{"use strict";i.d(t,{Jb:()=>r,UR:()=>_,lV:()=>v});var r,s,n=i(22919),o=i(5331),a=i(9794),l=i(74001),c=i(32006),u=i(43036),h=i(24603),d=i(23410),p=i(55784),f=i(11125),m=i(87621),g=i(57663),y=i(21414);function _(e,t){const i=e.vertex;i.include(a.n),i.uniforms.add(new h.p("distanceFalloffFactor",(e=>e.distanceFalloffFactor))),i.code.add(d.H`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new g.Q("componentDataTex")),i.uniforms.add(new l.e("componentDataTexInvDim")),e.attributes.add(y.T.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("componentTexWidth","float",4096),i.constants.add("verticalOffsetScale","float",2*n.E_),i.code.add(d.H`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),t.legacy?i.code.add(d.H`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new p.j("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel))),i.code.add(d.H`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(y.T.NORMALA,"vec3"),e.attributes.add(y.T.NORMALB,"vec3"),i.code.add(d.H`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(y.T.NORMAL,"vec3"),i.code.add(d.H`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?i.code.add(d.H`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(o.$,t),i.include(o.$,t),i.uniforms.add([new f.c("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new p.j("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new c.B("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL)),new c.B("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new u.J("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new u.J("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH))]),i.code.add(d.H`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?d.H`normalize(transformWorldFromModelTL + rotatedModelPosition);`:d.H`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new m.g("transformProjFromView",((e,t)=>t.camera.projectionMatrix))),i.code.add(d.H`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(d.H`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function v(e){return e.mode===r.SKETCH||e.mode===r.MIXED}(s=r||(r={}))[s.SOLID=0]="SOLID",s[s.SKETCH=1]="SKETCH",s[s.MIXED=2]="MIXED",s[s.COUNT=3]="COUNT"},99e3:(e,t,i)=>{"use strict";i.d(t,{B:()=>a});var r=i(39820),s=i(23410),n=i(37630),o=i(25926);function a(e,t){const i=e.vertex;switch(e.include(o.H,t),(0,n.lV)(t)&&i.uniforms.add(new r.d("strokesAmplitude")),t.mode){case n.Jb.SOLID:i.code.add(s.H`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case n.Jb.SKETCH:i.code.add(s.H`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case n.Jb.MIXED:i.code.add(s.H`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}},50297:(e,t,i)=>{"use strict";i.d(t,{N:()=>u});var r=i(9794),s=i(74001),n=i(39820),o=i(23410),a=i(57663),l=i(37630),c=i(25926);function u(e,t){const i=e.vertex;e.include(c.H,t);const u=e.fragment;switch((0,l.lV)(t)&&(i.uniforms.add(new s.e("strokesTextureScale")),i.uniforms.add(new n.d("strokesLog2Resolution")),i.uniforms.add(new n.d("strokeVariants")),e.varyings.add("vStrokeUV","vec2"),u.uniforms.add(new a.Q("strokesTexture")),u.uniforms.add(new n.d("strokesNormalizationScale")),i.code.add(o.H`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(r.n),u.code.add(o.H`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case l.Jb.SOLID:i.code.add(o.H`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),u.code.add(o.H`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case l.Jb.SKETCH:i.code.add(o.H`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),u.code.add(o.H`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case l.Jb.MIXED:e.varyings.add("vType","float"),i.code.add(o.H`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),u.code.add(o.H`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}},25926:(e,t,i)=>{"use strict";i.d(t,{H:()=>a});var r=i(27755),s=i(23410),n=i(21414),o=i(37630);function a(e,t){const i=e.vertex;switch(e.attributes.add(n.T.SIDENESS,"vec2"),t.mode===o.Jb.MIXED?i.code.add(s.H`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(s.H`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case o.Jb.MIXED:i.code.add(s.H`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case o.Jb.SKETCH:i.code.add(s.H`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case o.Jb.SOLID:i.code.add(s.H`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case o.Jb.COUNT:break;default:(0,r.Bg)(t.mode)}}},37599:(e,t,i)=>{"use strict";i.d(t,{f:()=>xr,t:()=>Cr});var r=i(36663),s=i(59183),n=i(76868),o=i(17262),a=i(81977),l=(i(7753),i(39994),i(7283),i(40266)),c=i(53443),u=i(41831),h=i(81589),d=(i(56803),i(22591));let p=class extends c.Z{constructor(){super(...arguments),this.items=new u.Z,this._watchUpdatingTracking=new h.t,this._callbacks=new Map,this._projector=(0,d.E)(),this._hiddenProjector=(0,d.E)()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange((()=>this.items),(e=>{for(const t of e.added){const e=()=>t.render();this._callbacks.set(t,e),this._projector.append(this.surface,e)}for(const t of e.removed){const e=this._projector.detach(this._callbacks.get(t));this.surface.removeChild(e.domNode),this._callbacks.delete(t)}}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const e=r.domNode.getBoundingClientRect();n.left=e.left,n.top=e.top,n.right=e.right,n.bottom=e.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}renderCanvas(e){if(!this.items.some((e=>e.visible)))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((e=>{t.save(),e.renderCanvas(t),t.restore()})),t.restore()}};(0,r._)([(0,a.Cb)({readOnly:!0})],p.prototype,"surface",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],p.prototype,"items",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],p.prototype,"needsRender",null),(0,r._)([(0,a.Cb)({readOnly:!0})],p.prototype,"_watchUpdatingTracking",void 0),(0,r._)([(0,a.Cb)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],p.prototype,"updating",void 0),p=(0,r._)([(0,l.j)("esri.views.overlay.ViewOverlay")],p);const f=p;i(87090);var m=i(49546),g=i(44584),y=i(13802),_=i(61681);function v(e,t,i,r){let s=null,n=1e3;"number"==typeof t?(n=t,r=i):(s=t??null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},c=(...e)=>{s&&s.apply(r,e),o=e,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}var b=i(42730),w=i(69236),x=i(47035),C=i(70375),T=i(90551),S=i(80085),E=i(42544),A=i(67692),M=i(21130),O=i(72057),R=i(25741),P=i(17095),I=i(98822),L=i(30879);const D=y.Z.getLogger("esri.widgets.Feature.support.featureUtils"),N=/href=(""|'')/gi,F=/(\{([^\{\r\n]+)\})/g,k=/\'/g,U=/^\s*expression\//i,V=/(\n)/gi,z=/[\u00A0-\u9999<>\&]/gim,B=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,H=/^(?:mailto:|tel:)/,j="relationships/",G=(0,O.Ze)("short-date-short-time");function W(e){if(!(0,_.Wi)(e))return e.get("sourceLayer")||e.get("layer")}async function Z(e,t){return"function"==typeof e?e.call(null,t):e}function q(e=""){if(e)return!H.test(e.trim().toLowerCase())}function $(e){return!!e&&U.test(e)}function Y(e,t){const i=function(e,t){if(!$(t)||!e)return null;const i=t.replace(U,"").toLowerCase();let r;return e.some((e=>e.name.toLowerCase()===i&&(r=e,!0))),r}(t,e?.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function X(e,t){const i=J(t,e);return i?i.name:e}function J(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function K(e){return`${e}`.trim()}function Q({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?ee({formattedAttributes:t,template:ie(r,{...t,...s,...e},i),fieldInfoMap:n}):""}function ee({formattedAttributes:e,template:t,fieldInfoMap:i}){return K(function(e){return e.replace(N,"")}((0,M.gx)((0,M.gx)(t,(e=>function(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}(e,i))),e)))}function te(e,t){return e.replace(F,((e,i,r)=>{const s=J(t,r);return s?`{${s.name}}`:i}))}function ie(e,t,i){const r=te(e,i);return r?r.replace(B,((e,i,r)=>function(e,t,i){const r=(t=K(t))&&"{"!==t[0];return(0,M.gx)(e,function(e,t=!1){const i={...e};return Object.keys(i).forEach((e=>function(e,t,i=!1){const r=t[e];if("string"==typeof r){const s="%27",n=(i?encodeURIComponent(r):r).replace(k,s);t[e]=n}}(e,i,t))),i}(i,r))}(e,i||r,t))):r}function re(e){return!!e?.layer}function se(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i||(r=e,0)))),r}function ne(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)?(r.forEach((e=>{if("fields"===e.type){const i=e&&e.fieldInfos;i&&t.push(...i)}})),t):t}function oe(e){return e.replace(z,(e=>`&#${e.charCodeAt(0)};`))}function ae(e){return"string"==typeof e?e.replace(V,'<br class="esri-text-new-line" />'):e}function le(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=e;if(null==t)return"";const a=function({fieldName:e,value:t,graphic:i,layer:r}){if(he(e))return null;if(!r||"function"!=typeof r.getFieldDomain)return null;const s=r.getFieldDomain(e,{feature:i});return s&&"coded-value"===s.type?s.getName(t):null}({fieldName:i,value:t,graphic:o,layer:n});if(a)return a;const l=function({fieldName:e,graphic:t,layer:i}){if(he(e))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return function(e,t){const i=t.fieldInfos,r=t.fieldName,s=se(i,r)?.clone(),n=t.preventPlacesFormatting,o=t.layer,a=J(o,r);if(s&&"date"===a?.type){const e=s.format||new I.Z;e.dateFormat=e.dateFormat||"short-date-short-time",e.dateTimeFormatOptions=!re(o)&&function(e){return"feature"===e?.type}(o)&&o.datesInUnknownTimezone||re(o)&&function(e){return"map-image"===e?.type}(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=e}const l=s&&s.format;return"string"==typeof e&&(0,P.Ec)(r)&&l?l.formatRasterPixelValue(e):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,l))||null==e||null==l?ae(e):n?(0,R.uf)(e,{...(0,R.sh)(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}(t,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?(0,O.p6)(t,G):ae(t)}function ce({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n?.forEach((t=>function({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((n=>de({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}))),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((n=>de({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}))))}({attributes:o,relatedInfo:t,fieldInfoMap:s,fieldInfos:e,layer:i}))),Object.keys(t).forEach((n=>{const a=t[n];o[n]=le({fieldName:n,fieldInfos:e,fieldInfoMap:s,layer:i,value:a,graphic:r})})),o}async function ue({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t)return;if("function"==typeof i.load&&await i.load(s),!e.attributes)return;const n=e.attributes[i.objectIdField];if(null==n)return;const o=[n],a=await t.getRequiredFields(i.fieldsIndex),l=(0,P.R9)(a,e),c=l?[]:a,u=t.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,L.LC)(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)}(t);if(l&&!u)return;const h=await async function(e,t){const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if("number"!=typeof l&&"string"!=typeof l){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:i,graphic:r,objectId:l,requiredFields:s};return D.warn(e,t),null}if(!i.capabilities?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return D.warn(e,t),null}const c=i.createQuery();return c.objectIds=n,c.outFields=s?.length?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,t)).features[0]}({layer:i,graphic:e,outFields:c,objectIds:o,returnGeometry:u,spatialReference:r},s);h&&(h.geometry&&(e.geometry=h.geometry),h.attributes&&(e.attributes={...e.attributes,...h.attributes}))}function he(e=""){return!!e&&e.includes(j)}function de({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){e&&t&&i&&Object.keys(t.attributes).forEach((o=>{const a=function(e){return e?`${j}${e.layerId}/${e.fieldName}`:""}({layerId:i.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=le({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:t})}))}const pe=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},fe=({layer:e,method:t,query:i,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||"attachments"===t)return;const s=(0,_.pC)(i.where)&&i.where,n=(0,_.pC)(i.geometry)&&i.geometry;pe(r)||pe(s)||"extent"===n?.type||"tile"===i.resultType||(i.cacheHint=!0)},me={editing:!1,operations:{add:!0,update:!0,delete:!0}},ge=u.Z.ofType(E.Z);let ye=class extends c.Z{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...me},this.activeAttachmentInfo=null,this.attachmentInfos=new ge,this.graphic=null,this.mode="view",this.own((0,n.YP)((()=>this.graphic),(()=>this._graphicChanged()),n.nn))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...me,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||"function"!=typeof e.queryAttachments)throw new C.Z("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new A.Z({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then((e=>e[i]||s)).catch((()=>s));this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new C.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new C.Z("invalid-abilities","addAttachment(): add abilities are required.");if(!t||"function"!=typeof t.addAttachment)throw new C.Z("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(r,e).then((e=>this._queryAttachment(e.objectId))),o=await n;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new C.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new C.Z("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new C.Z("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(r,[e.id]).then((()=>e)),o=await n;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new C.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new C.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new C.Z("invalid-abilities","updateAttachment(): Update abilities are required.");const o=r.findIndex((e=>e===t));if(!i||"function"!=typeof i.updateAttachment)throw new C.Z("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(s,t.id,e).then((e=>this._queryAttachment(e.objectId))),l=await a;return r.splice(o,1,l),l}async _queryAttachment(e){if(!e)throw new C.Z("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new A.Z({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(r).then((e=>e[i][0]))}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:e}=this,t=W(e);this._attachmentLayer=t?"scene"===t.type&&(0,_.pC)(t.associatedLayer)?t.associatedLayer:t:null}};(0,r._)([(0,a.Cb)()],ye.prototype,"abilities",void 0),(0,r._)([(0,w.p)("abilities")],ye.prototype,"castAbilities",null),(0,r._)([(0,a.Cb)()],ye.prototype,"activeAttachmentInfo",void 0),(0,r._)([(0,a.Cb)({readOnly:!0,type:ge})],ye.prototype,"attachmentInfos",void 0),(0,r._)([(0,a.Cb)({type:S.Z})],ye.prototype,"graphic",void 0),(0,r._)([(0,a.Cb)()],ye.prototype,"mode",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],ye.prototype,"state",null),(0,r._)([(0,a.Cb)({readOnly:!0})],ye.prototype,"supportsResizeAttachments",null),ye=(0,r._)([(0,l.j)("esri.widgets.Attachments.AttachmentsViewModel")],ye);const _e=ye;var ve=i(36567),be=i(54956),we=i(34236),xe=i(26451);const Ce={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Te="esri-attachments__item-button",Se="esri-attachments__form-node",Ee="esri-attachments__file-fieldset",Ae="esri-attachments__file-label",Me="esri-attachments__file-name",Oe="esri-attachments__file-input",Re="esri-attachments__metadata-fieldset",Pe="esri-button",Ie="esri-button--disabled",Le="esri-button--secondary",De="esri-button--tertiary",Ne="esri-button--third",Fe="esri-button--small",ke="esri-button--half",Ue=window.CSS;let Ve=class extends x.Z{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new _e,this.visibleElements={...Ce},this._supportsImageOrientation=Ue&&Ue.supports&&Ue.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([(0,n.on)((()=>this.viewModel?.attachmentInfos),"change",(()=>this.scheduleRender())),(0,n.YP)((()=>this.viewModel?.mode),(()=>this._modeChanged()),n.nn)])}get effectiveDisplayType(){const{displayType:e}=this;return e&&"auto"!==e?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return{...Ce,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new C.Z("attachments:add-attachment",this.messages.addErrorMessage,e)),e}))}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new C.Z("attachments:delete-attachment",this.messages.deleteErrorMessage,e)),e}))}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((e=>{throw this._set("submitting",!1),this._set("error",new C.Z("attachments:update-attachment",this.messages.updateErrorMessage,e)),e}))}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return(0,xe.u)("div",{class:this.classes("esri-attachments","esri-widget")},e?this.renderProgressBar():null,"loading"===i?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?(0,xe.u)("div",{key:"error-message",class:"esri-attachments__error-message"},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return"add"===e?this.renderAddForm():"edit"===e?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return(0,xe.u)("div",{class:"esri-attachments__loader-container",key:"loader"},(0,xe.u)("div",{class:"esri-attachments__loader"}))}renderProgressBar(){return this.visibleElements.progressBar?(0,xe.u)("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?(0,xe.u)("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Pe,De,Fe,ke,e&&Ie)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?(0,xe.u)("button",{type:"submit",disabled:i,class:this.classes(Pe,Le,Fe,ke,{[Ie]:i})},this.messages.add):null,n=t?(0,xe.u)("span",{key:"file-name",class:Me},t.name):null,o=(0,xe.u)("form",{bind:this,afterCreate:be.Yo,afterRemoved:be.pV,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,xe.u)("fieldset",{class:Ee},n,(0,xe.u)("label",{class:this.classes(Ae,Pe,Le)},t?this.messages.changeFile:this.messages.selectFile,(0,xe.u)("input",{class:Oe,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return(0,xe.u)("div",{key:"add-form-container",class:Se},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:n,size:o,url:a}=e,{abilities:l}=i,c=s||!r,u=l.editing&&l.operations.delete&&t.deleteButton?(0,xe.u)("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:t=>this._submitDeleteAttachment(t,e),class:this.classes(Pe,Fe,De,"esri-attachments__delete-button",{[Ie]:s})},this.messages.delete):null,h=l.editing&&l.operations.update&&t.updateButton?(0,xe.u)("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(Pe,Fe,Ne,{[Ie]:c})},this.messages.update):null,d=this.visibleElements.cancelUpdateButton?(0,xe.u)("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Pe,Fe,De,Ne,{[Ie]:s})},this.messages.cancel):null,p=r?(0,xe.u)("span",{key:"file-name",class:Me},r.name):null,f=l.editing&&l.operations.update?(0,xe.u)("fieldset",{key:"file",class:Ee},p,(0,xe.u)("label",{class:this.classes(Ae,Pe,Le)},this.messages.changeFile,(0,xe.u)("input",{class:Oe,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,m=(0,xe.u)("fieldset",{key:"size",class:Re},(0,xe.u)("label",null,(0,T.sS)(this.messagesUnits,o))),g=(0,xe.u)("fieldset",{key:"content-type",class:Re},(0,xe.u)("label",null,n)),y=(0,xe.u)("form",{bind:this,afterCreate:be.Yo,afterRemoved:be.pV,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},(0,xe.u)("div",{class:"esri-attachments__metadata"},m,g),f,(0,xe.u)("div",{class:"esri-attachments__actions"},u,d,h));return(0,xe.u)("div",{key:"edit-form-container",class:Se},(0,xe.u)("a",{class:"esri-attachments__item-link",href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),(0,xe.u)("div",{class:"esri-attachments__item-link-overlay"},(0,xe.u)("span",{class:"esri-attachments__item-link-overlay-icon"},(0,xe.u)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},(0,xe.u)("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),(0,xe.u)("path",{fill:"none",d:"M0 0h32v32H0z"}))))),y)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:n}=e,o=i&&function(e){const t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}(r),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},c=n.includes("?")?"&":"?",u=o?`${n}${c}w=${t}`:function(e){const t=(0,ve.V)("esri/themes/base/images/files/");return e?"text/plain"===e?`${t}text-32.svg`:"application/pdf"===e?`${t}pdf-32.svg`:"text/csv"===e?`${t}csv-32.svg`:"application/gpx+xml"===e?`${t}gpx-32.svg`:"application/x-dwf"===e?`${t}cad-32.svg`:"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?`${t}code-32.svg`:"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}(r),h={"esri-attachments__item-mask--icon":!o},d={"esri-attachments__image--resizable":i};return(0,xe.u)("div",{class:this.classes(h,"esri-attachments__item-mask")},(0,xe.u)("img",{styles:l,alt:s,src:u,class:this.classes(d,"esri-attachments__image")}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:n}=e,o=this.renderImageMask({attachmentInfo:e,size:"list"===t?48:400}),a=r.editing?(0,xe.u)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",(0,be.dZ)(this.container)?"esri-icon-left":"esri-icon-right")}):null,l=[o,(0,xe.u)("label",{class:"esri-attachments__label"},(0,xe.u)("span",{class:"esri-attachments__filename"},s||this.messages.noTitle),a)],c=r.editing?(0,xe.u)("button",{key:"details-button",bind:this,class:Te,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):(0,xe.u)("a",{key:"details-link",class:Te,href:n,target:"_blank"},l);return(0,xe.u)("li",{class:"esri-attachments__item",key:e},c)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,n=r&&r.length,o={"esri-attachments__container--list":"preview"!==e,"esri-attachments__container--preview":"preview"===e},a=s.editing&&s.operations.add&&i.addButton?(0,xe.u)("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Pe,De,"esri-attachments__add-attachment-button"),type:"button"},(0,xe.u)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null,l=n?(0,xe.u)("ul",{class:"esri-attachments__items"},r.toArray().map((t=>this.renderAttachmentInfo({attachmentInfo:t,displayType:e})))):(0,xe.u)("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return(0,xe.u)("div",{key:"attachments-container",class:this.classes("esri-attachments__container",o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};(0,r._)([(0,b.B)("viewModel.abilities")],Ve.prototype,"abilities",void 0),(0,r._)([(0,a.Cb)()],Ve.prototype,"displayType",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],Ve.prototype,"effectiveDisplayType",null),(0,r._)([(0,b.B)("viewModel.graphic")],Ve.prototype,"graphic",void 0),(0,r._)([(0,a.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ve.prototype,"label",void 0),(0,r._)([(0,a.Cb)(),(0,we.H)("esri/widgets/Attachments/t9n/Attachments")],Ve.prototype,"messages",void 0),(0,r._)([(0,a.Cb)(),(0,we.H)("esri/core/t9n/Units")],Ve.prototype,"messagesUnits",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],Ve.prototype,"selectedFile",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],Ve.prototype,"submitting",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],Ve.prototype,"error",void 0),(0,r._)([(0,a.Cb)({type:_e})],Ve.prototype,"viewModel",void 0),(0,r._)([(0,a.Cb)()],Ve.prototype,"visibleElements",void 0),(0,r._)([(0,w.p)("visibleElements")],Ve.prototype,"castVisibleElements",null),Ve=(0,r._)([(0,l.j)("esri.widgets.Attachments")],Ve);const ze=Ve;let Be=class extends _e{constructor(e){super(e),this.description=null,this.title=null}};(0,r._)([(0,a.Cb)()],Be.prototype,"description",void 0),(0,r._)([(0,a.Cb)()],Be.prototype,"title",void 0),Be=(0,r._)([(0,l.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],Be);const He=Be;var je=i(62199);let Ge=class extends x.Z{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,xe.u)("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?(0,xe.u)(je.X6,{level:this.headingLevel,class:"esri-feature-element-info__title"},e):null}renderDescription(){const{description:e}=this;return e?(0,xe.u)("div",{key:"description",class:"esri-feature-element-info__description"},e):null}};(0,r._)([(0,a.Cb)()],Ge.prototype,"description",void 0),(0,r._)([(0,a.Cb)()],Ge.prototype,"headingLevel",void 0),(0,r._)([(0,a.Cb)()],Ge.prototype,"title",void 0),Ge=(0,r._)([(0,l.j)("esri.widgets.Feature.support.FeatureElementInfo")],Ge);const We=Ge;let Ze=class extends x.Z{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new ze,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new He}initialize(){this._featureElementInfo=new We,this.own([(0,n.YP)((()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel]),(()=>this._setupFeatureElementInfo()),n.nn),(0,n.YP)((()=>this.viewModel?.graphic),(e=>this.attachmentsWidget.graphic=e),n.nn)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){const{attachmentsWidget:e}=this;return(0,xe.u)("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};(0,r._)([(0,a.Cb)({readOnly:!0})],Ze.prototype,"attachmentsWidget",void 0),(0,r._)([(0,b.B)("viewModel.description")],Ze.prototype,"description",void 0),(0,r._)([(0,b.B)("attachmentsWidget.displayType")],Ze.prototype,"displayType",void 0),(0,r._)([(0,b.B)("viewModel.graphic")],Ze.prototype,"graphic",void 0),(0,r._)([(0,a.Cb)()],Ze.prototype,"headingLevel",void 0),(0,r._)([(0,b.B)("viewModel.title")],Ze.prototype,"title",void 0),(0,r._)([(0,a.Cb)({type:He})],Ze.prototype,"viewModel",void 0),Ze=(0,r._)([(0,l.j)("esri.widgets.Feature.FeatureAttachments")],Ze);const qe=Ze;var $e=i(53280);let Ye=class extends((0,$e.p)(c.Z)){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add((0,n.YP)((()=>this.creator),(e=>{this._destroyContent(),this._createContent(e)}),n.nn))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(Z(i,{graphic:t}).catch((()=>null)),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=Z(e,{graphic:t}).catch((()=>null));this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};(0,r._)([(0,a.Cb)({readOnly:!0})],Ye.prototype,"created",void 0),(0,r._)([(0,a.Cb)()],Ye.prototype,"creator",void 0),(0,r._)([(0,a.Cb)()],Ye.prototype,"destroyer",void 0),(0,r._)([(0,a.Cb)({type:S.Z})],Ye.prototype,"graphic",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],Ye.prototype,"state",null),Ye=(0,r._)([(0,l.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Ye);const Xe=Ye;var Je=i(13509);let Ke=class extends x.Z{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll("a")).forEach((e=>{q(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))}}renderLoading(){return(0,xe.u)("div",{class:"esri-feature-content__loader-container",key:"loader"},(0,xe.u)("div",{class:"esri-feature-content__loader"}))}renderCreated(){const e=this.viewModel?.created;return e?e instanceof HTMLElement?(0,xe.u)("div",{key:e,bind:e,afterCreate:this._attachToNode}):(0,Je.Qd)(e)?(0,xe.u)("div",{key:e},!e.destroyed&&e.render()):(0,xe.u)("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){const e=this.viewModel?.state;return(0,xe.u)("div",{class:"esri-feature-content"},"loading"===e?this.renderLoading():this.renderCreated())}_attachToNode(e){e.appendChild(this)}};(0,r._)([(0,b.B)("viewModel.creator")],Ke.prototype,"creator",void 0),(0,r._)([(0,b.B)("viewModel.graphic")],Ke.prototype,"graphic",void 0),(0,r._)([(0,a.Cb)({type:Xe})],Ke.prototype,"viewModel",void 0),Ke=(0,r._)([(0,l.j)("esri.widgets.Feature.FeatureContent")],Ke);const Qe=Ke;var et=i(18228),tt=i(78213);let it=class extends c.Z{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t?.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const r=t.clone();r.label=Y(r,e),i.push(r)})),i}};(0,r._)([(0,a.Cb)()],it.prototype,"attributes",void 0),(0,r._)([(0,a.Cb)({type:[et.Z]})],it.prototype,"expressionInfos",void 0),(0,r._)([(0,a.Cb)()],it.prototype,"description",void 0),(0,r._)([(0,a.Cb)({type:[tt.Z]})],it.prototype,"fieldInfos",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],it.prototype,"formattedFieldInfos",null),(0,r._)([(0,a.Cb)()],it.prototype,"title",void 0),it=(0,r._)([(0,l.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],it);const rt=it,st=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function nt(e){let t=null;return st.some((i=>(i.pattern.test(e)&&(t=i),!!t))),t}function ot(e,t){if("string"!=typeof t||!t)return t;const i=nt(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=(0,M.gx)((0,M.gx)(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a="_blank"===i.target?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}let at=class extends x.Z{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new rt,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new We,this.own((0,n.YP)((()=>[this.viewModel?.description,this.viewModel?.title]),(()=>this._setupFeatureElementInfo()),n.nn))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?null==i[r]?"":i[r]:"",o=!(!e.format||!e.format.dateFormat),a="number"!=typeof n||o?ot(this.messagesURIUtils,n):this._forceLTR(n),l={"esri-feature-fields__field-data--date":o};return(0,xe.u)("tr",{key:`fields-element-info-row-${r}-${t}`},(0,xe.u)("th",{key:`fields-element-info-row-header-${r}-${t}`,class:"esri-feature-fields__field-header",innerHTML:s}),(0,xe.u)("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes("esri-feature-fields__field-data",l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e?.length?(0,xe.u)("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},(0,xe.u)("tbody",null,e.map(((e,t)=>this.renderFieldInfo(e,t))))):null}render(){return(0,xe.u)("div",{class:"esri-feature-fields"},this._featureElementInfo?.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};(0,r._)([(0,b.B)("viewModel.attributes")],at.prototype,"attributes",void 0),(0,r._)([(0,b.B)("viewModel.description")],at.prototype,"description",void 0),(0,r._)([(0,b.B)("viewModel.expressionInfos")],at.prototype,"expressionInfos",void 0),(0,r._)([(0,b.B)("viewModel.fieldInfos")],at.prototype,"fieldInfos",void 0),(0,r._)([(0,b.B)("viewModel.title")],at.prototype,"title",void 0),(0,r._)([(0,a.Cb)({type:rt})],at.prototype,"viewModel",void 0),(0,r._)([(0,a.Cb)(),(0,we.H)("esri/widgets/Feature/t9n/Feature")],at.prototype,"messages",void 0),(0,r._)([(0,a.Cb)(),(0,we.H)("esri/widgets/support/t9n/uriUtils")],at.prototype,"messagesURIUtils",void 0),at=(0,r._)([(0,l.j)("esri.widgets.Feature.FeatureFields")],at);const lt=at;var ct=i(77669),ut=i(94268),ht=i(66341),dt=i(78668),pt=(i(10743),i(96027)),ft=(i(3466),i(17321),i(35925),i(12065),i(91772),i(20031),i(74304),i(53446)),mt=(i(89542),i(90819),i(49756),i(76480),i(51211),i(14136)),gt=(i(88256),i(91957),i(8284)),yt=(i(12621),i(53631));const _t=y.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),vt=new Map;function bt(e){if(!he(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}const wt={chartAnimation:!0};let xt=class extends c.Z{constructor(e){super(e),this.abilities={...wt},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...wt,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:r,fieldInfoMap:s,layer:n}=this;return t?.map((t=>{const o=t?.clone();if(!o)return null;if(o.title=Q({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:o.title}),o.caption=Q({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:o.caption}),o.altText=Q({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:o.altText}),"image"===o.type){const{value:e}=o;return this._setImageValue({value:e,formattedAttributes:i,layer:n}),o.value.sourceURL?o:void 0}if("pie-chart"===o.type||"line-chart"===o.type||"column-chart"===o.type||"bar-chart"===o.type){const{value:t}=o;return this._setChartValue({value:t,chartType:o.type,attributes:e,formattedAttributes:i,layer:n}),o}return null})).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const e=te(o,s);i.sourceURL=ee({formattedAttributes:r,template:e,fieldInfoMap:t})}if(n){const e=te(n,s);i.linkURL=ee({formattedAttributes:r,template:e,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:c}=t;if(t.fields=function(e,t){return e&&e.map((e=>X(e,t)))}(l,n),c&&(t.normalizeField=X(c,n)),!l.some((e=>!!(null!=r[e]||he(e)&&a.size))))return;const u=o?.fieldInfos;l.forEach((e=>{if(he(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:u,fieldName:e,formattedAttributes:r,chartType:s,value:t})]);const n=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:e,fieldInfos:u});t.series.push(n)}))}_getRelatedChartInfos(e){const{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:n}=e,o=[],a=bt(i),{layerId:l,fieldName:c}=a,u=this.relatedInfos?.get(l.toString());if(!u)return o;const{relatedFeatures:h,relation:d}=u;if(!d||!h)return o;const{cardinality:p}=d;return h.forEach((e=>{const{attributes:a}=e;a&&Object.keys(a).forEach((e=>{e===c&&o.push(this._getChartOption({value:n,attributes:a,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:e,fieldInfos:t}))}))})),"one-to-many"===p||"many-to-many"===p?o:[o[0]]}_getTooltip({label:e,value:t,chartType:i}){return"pie-chart"===i?`${e}`:`${e}: ${t}`}_getChartOption(e){const{value:t,attributes:i,formattedAttributes:r,fieldName:s,relatedFieldName:n,fieldInfos:o,chartType:a}=e,{layer:l,fieldInfoMap:c}=this,{normalizeField:u,tooltipField:h}=t,d=u?he(u)?i[bt(u).fieldName]:i[u]:null,p=n&&void 0!==i[n]?i[n]:void 0!==i[s]?i[s]:r[s],f=new ut.Z({fieldName:s,value:void 0===p?null:p&&d?p/d:p});if(he(s)){const e=c.get(s.toLowerCase()),t=c.get(h.toLowerCase()),i=e?.fieldName??s,o=r[t?.fieldName??h]??e?.label??e?.fieldName??n,l=r[i];return f.tooltip=this._getTooltip({label:o,value:l,chartType:a}),f}const m=se(o,s),g=X(s,l),y=h&&void 0!==r[h]?r[h]:Y(m||new tt.Z({fieldName:g}),this.popupTemplate?.expressionInfos),_=r[g];return f.tooltip=this._getTooltip({label:y,value:_,chartType:a}),f}};(0,r._)([(0,a.Cb)()],xt.prototype,"abilities",void 0),(0,r._)([(0,w.p)("abilities")],xt.prototype,"castAbilities",null),(0,r._)([(0,a.Cb)()],xt.prototype,"activeMediaInfoIndex",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],xt.prototype,"activeMediaInfo",null),(0,r._)([(0,a.Cb)()],xt.prototype,"attributes",void 0),(0,r._)([(0,a.Cb)()],xt.prototype,"description",void 0),(0,r._)([(0,a.Cb)()],xt.prototype,"fieldInfoMap",void 0),(0,r._)([(0,a.Cb)()],xt.prototype,"formattedAttributes",void 0),(0,r._)([(0,a.Cb)()],xt.prototype,"expressionAttributes",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],xt.prototype,"formattedMediaInfos",null),(0,r._)([(0,a.Cb)()],xt.prototype,"layer",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],xt.prototype,"formattedMediaInfoCount",null),(0,r._)([(0,a.Cb)()],xt.prototype,"mediaInfos",void 0),(0,r._)([(0,a.Cb)()],xt.prototype,"popupTemplate",void 0),(0,r._)([(0,a.Cb)()],xt.prototype,"relatedInfos",void 0),(0,r._)([(0,a.Cb)()],xt.prototype,"title",void 0),xt=(0,r._)([(0,l.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],xt);const Ct=xt;var Tt=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],St=[{name:"default",colors:[].concat(Tt.slice(30,39),Tt.slice(28,30).reverse())},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}],Et=i(8108);const At="en-us",Mt=new Map([["ar",()=>i.e(6185).then(i.bind(i,16185)).then((e=>e.a))],["bg-bg",()=>i.e(5532).then(i.bind(i,75532)).then((e=>e.b))],["bs-ba",()=>i.e(7653).then(i.bind(i,57653)).then((e=>e.b))],["ca-es",()=>i.e(6441).then(i.bind(i,16441)).then((e=>e.c))],["cs-cz",()=>i.e(5515).then(i.bind(i,15515)).then((e=>e.c))],["da-dk",()=>i.e(2601).then(i.bind(i,2601)).then((e=>e.d))],["de-de",()=>i.e(3625).then(i.bind(i,33625)).then((e=>e.d))],["de-ch",()=>i.e(124).then(i.bind(i,30124)).then((e=>e.d))],["el-gr",()=>i.e(8229).then(i.bind(i,88229)).then((e=>e.e))],["en-us",()=>i.e(2329).then(i.bind(i,32329)).then((e=>e.e))],["en-ca",()=>i.e(3814).then(i.bind(i,43814)).then((e=>e.e))],["es-es",()=>i.e(990).then(i.bind(i,80990)).then((e=>e.e))],["et-ee",()=>i.e(7303).then(i.bind(i,17303)).then((e=>e.e))],["fi-fi",()=>i.e(2705).then(i.bind(i,2705)).then((e=>e.f))],["fr-fr",()=>i.e(791).then(i.bind(i,10791)).then((e=>e.f))],["he-il",()=>i.e(4049).then(i.bind(i,44049)).then((e=>e.h))],["hr-hr",()=>i.e(7946).then(i.bind(i,47946)).then((e=>e.h))],["hu-hu",()=>i.e(4669).then(i.bind(i,54669)).then((e=>e.h))],["id-id",()=>i.e(8243).then(i.bind(i,48243)).then((e=>e.i))],["it-it",()=>i.e(412).then(i.bind(i,20412)).then((e=>e.i))],["ja-jp",()=>i.e(3433).then(i.bind(i,53433)).then((e=>e.j))],["ko-kr",()=>i.e(5394).then(i.bind(i,29457)).then((e=>e.k))],["lt-lt",()=>i.e(6829).then(i.bind(i,56829)).then((e=>e.l))],["lv-lv",()=>i.e(9341).then(i.bind(i,39434)).then((e=>e.l))],["nb-no",()=>i.e(7660).then(i.bind(i,17660)).then((e=>e.n))],["nl-nl",()=>i.e(9547).then(i.bind(i,99547)).then((e=>e.n))],["pl-pl",()=>i.e(17).then(i.bind(i,17)).then((e=>e.p))],["pt-br",()=>i.e(7578).then(i.bind(i,97578)).then((e=>e.p))],["pt-pt",()=>i.e(3399).then(i.bind(i,63399)).then((e=>e.p))],["ro-ro",()=>i.e(5134).then(i.bind(i,55134)).then((e=>e.r))],["ru-ru",()=>i.e(134).then(i.bind(i,40134)).then((e=>e.r))],["sk-sk",()=>i.e(8718).then(i.bind(i,98718)).then((e=>e.s))],["sl-sl",()=>i.e(1352).then(i.bind(i,21352)).then((e=>e.s))],["sr-rs",()=>i.e(6802).then(i.bind(i,86802)).then((e=>e.s))],["sv-se",()=>i.e(1810).then(i.bind(i,51810)).then((e=>e.s))],["th-th",()=>i.e(4287).then(i.bind(i,84287)).then((e=>e.t))],["tr-tr",()=>i.e(8385).then(i.bind(i,28385)).then((e=>e.t))],["uk-ua",()=>i.e(3040).then(i.bind(i,43040)).then((e=>e.u))],["vi-vn",()=>i.e(5583).then(i.bind(i,51489)).then((e=>e.v))],["zh-cn",()=>i.e(5266).then(i.bind(i,15266)).then((e=>e.z))],["zh-hk",()=>i.e(9794).then(i.bind(i,99794)).then((e=>e.z))],["zh-tw",()=>i.e(9794).then(i.bind(i,99794)).then((e=>e.z))]]);let Ot,Rt;async function Pt(e=(0,Et.Kd)()){if(e=function(e){return e?Mt.has(e.toLowerCase())?e.toLowerCase():function(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const e of Mt.keys())if(e.startsWith(t)){i=e;break}return i}(e)||At:At}(e),Ot&&e===Rt)return Ot;Ot=i.e(8748).then(i.bind(i,38748)).then((e=>e.i)),Rt=e;try{const[t,i]=await Promise.all([Ot,Mt.get(Rt)()]);Rt===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return Ot=null,Rt=null,null}return Ot}function It(e,t="default"){const i=St.find((e=>e.name===t));return i?i.colors.map((t=>e.color(t))):null}var Lt=i(3368);const Dt="esri-feature-media__button",Nt="esri-feature-media__icon",Ft="esri-icon-left-triangle-arrow",kt="esri-icon-right-triangle-arrow",Ut=.05,Vt=.95,zt="color",Bt="tooltip",Ht="value",jt="default-line-value";let Gt=class extends x.Z{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new Ct,this.messages=null,this._getChartDependencies=async e=>{const t=await Pt(),{destroyed:i,viewModel:r}=this;if(i||!r||!e)return;const{activeMediaInfo:s}=r,n=await this._getRendererColors(t);this._renderChart({chartDiv:e,mediaInfo:s,chartsModule:t,colorMap:n})}}initialize(){this._featureElementInfo=new We,this.own([(0,n.YP)((()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex]),(()=>this._setupMediaRefreshTimer()),n.nn),(0,n.YP)((()=>[this.viewModel?.description,this.viewModel?.title]),(()=>this._setupFeatureElementInfo()),n.nn)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){return(0,xe.u)("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?(0,xe.u)("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:u}=s,h=q(u)?"_blank":"_self",d="_blank"===h?"noreferrer":"",p=n?t:null,f=p?p.timestamp:0,m=p?p.sourceURL:c,g=(0,xe.u)("img",{alt:o||a,key:`media-${l}-${i}-${r}-${f}`,src:m});return(u?(0,xe.u)("a",{title:a,href:u,rel:d,target:h},g):null)||g}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return(0,xe.u)("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?"image"===e.type?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?(0,xe.u)("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:e.title}):null,i=e.caption?(0,xe.u)("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:e.caption}):null;return(0,xe.u)("div",{key:"media-container",class:"esri-feature-media__item-container"},(0,xe.u)("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t="previous"===e,i=t?this.messages.previous:this.messages.next,r=t?this.classes(Dt,"esri-feature-media__previous"):this.classes(Dt,"esri-feature-media__next"),s=t?this.classes(Nt,"esri-feature-media__previous-icon",Ft):this.classes(Nt,"esri-feature-media__next-icon",kt),n=t?this.classes(Nt,"esri-feature-media__previous-icon--rtl",kt):this.classes(Nt,"esri-feature-media__next-icon--rtl",Ft),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return(0,xe.u)("button",{type:"button",key:o,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:a},(0,xe.u)("span",{"aria-hidden":"true",class:s}),(0,xe.u)("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getRendererColors(e){const{am4core:t}=e,i=this.viewModel?.layer,r=new Map;if(!i)return r;const s=await(0,ct.zB)(i.renderer);return s.delete(null),Array.from(s.values()).every((e=>1===e?.length))?(r.set(jt,t.color({r:50,g:50,b:50,a:1})),Array.from(s.keys()).forEach((e=>{e&&r.set(e,t.color(s.get(e)[0].toCss(!0)))})),r):r}_handleMediaKeyup(e){const t=(0,m.kK)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:i,chartDiv:r,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=i,c=It(l);(0,Lt.$o)()&&l.useTheme(i.am4themes_dark);const u=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!u.matches?l.useTheme(i.am4themes_animated):l.unuseTheme(i.am4themes_animated),l.useTheme((function(e){e instanceof l.ColorSet&&c&&(e.list=c)}));const h="pie-chart"===a?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",s.altText||s.title),h.data=o.series.map((e=>({[Bt]:e.tooltip,[Ht]:e.value,[zt]:n.get(e.fieldName)}))).filter((e=>"pie-chart"!==a||e.value>0))}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=(0,be.dZ)(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=Ht,o.dataFields.category=Bt,this._customizeChartTooltip(o.tooltip,r),o.slices.template.tooltipText=n.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",o.slices.template.propertyFields.fill=zt,o.slices.template.propertyFields.stroke=zt,n}_getMinSeriesValue(e){let t=0;return e.forEach((e=>t=Math.min(e.value,t))),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=Bt,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=Ut,l.renderer.maxLabelPosition=Vt,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const u=e.series.push(new o.ColumnSeries);u.dataFields.valueY=Ht,u.dataFields.categoryX=Bt,u.columns.template.propertyFields.fill=zt,u.columns.template.propertyFields.stroke=zt,e.cursor=new o.XYCursor,s.series.length>15&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=Bt,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dx=a.tooltip.contentWidth}));const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=Ut,l.renderer.maxLabelPosition=Vt,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const u=e.series.push(new o.ColumnSeries);u.dataFields.valueX=Ht,u.dataFields.categoryY=Bt,u.columns.template.propertyFields.fill=zt,u.columns.template.propertyFields.stroke=zt,e.cursor=new o.XYCursor,s.series.length>15&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r,colorMap:s}=t,{value:n}=r,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=Bt,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,o),l.tooltip.events.on("sizechanged",(()=>{l.tooltip.dy=-l.tooltip.contentHeight}));const c=e.yAxes.push(new a.ValueAxis),u=c.renderer.labels.template;c.renderer.minLabelPosition=Ut,c.renderer.maxLabelPosition=Vt,c.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(c.tooltip,o),u.wrap=!0;const h=e.series.push(new a.LineSeries);h.dataFields.categoryX=Bt,h.dataFields.valueY=Ht,h.strokeWidth=1;const d=s.get(jt);d&&(h.stroke=d);const p=h.bullets.push(new a.CircleBullet);p.propertyFields.fill=zt,p.propertyFields.stroke=zt,e.cursor=new a.XYCursor,n.series.length>15&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:o}=i,a=n.create(t,o.XYChart);return a.rtl=(0,be.dZ)(this.container),"column-chart"===s&&this._createColumnChart(a,e),"bar-chart"===s&&this._createBarChart(a,e),"line-chart"===s&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval((()=>{this._updateMediaInfoTimestamp(i.sourceURL)}),r);this._refreshTimer=s}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};(0,r._)([(0,b.B)("viewModel.attributes")],Gt.prototype,"attributes",void 0),(0,r._)([(0,b.B)("viewModel.activeMediaInfoIndex")],Gt.prototype,"activeMediaInfoIndex",void 0),(0,r._)([(0,b.B)("viewModel.description")],Gt.prototype,"description",void 0),(0,r._)([(0,b.B)("viewModel.fieldInfoMap")],Gt.prototype,"fieldInfoMap",void 0),(0,r._)([(0,b.B)("viewModel.layer")],Gt.prototype,"layer",void 0),(0,r._)([(0,b.B)("viewModel.mediaInfos")],Gt.prototype,"mediaInfos",void 0),(0,r._)([(0,b.B)("viewModel.popupTemplate")],Gt.prototype,"popupTemplate",void 0),(0,r._)([(0,b.B)("viewModel.relatedInfos")],Gt.prototype,"relatedInfos",void 0),(0,r._)([(0,b.B)("viewModel.title")],Gt.prototype,"title",void 0),(0,r._)([(0,a.Cb)({type:Ct})],Gt.prototype,"viewModel",void 0),(0,r._)([(0,a.Cb)(),(0,we.H)("esri/widgets/Feature/t9n/Feature")],Gt.prototype,"messages",void 0),Gt=(0,r._)([(0,l.j)("esri.widgets.Feature.FeatureMedia")],Gt);const Wt=Gt;var Zt=i(94837),qt=(i(24834),i(17814),i(15902),i(32776),i(29893)),$t=i(21363),Yt=i(58106),Xt=i(4970),Jt=i(45955);const Kt=["$datastore","$map","$layer","$aggregatedfeatures"],Qt=y.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function ei(e){return"string"==typeof e?ae(oe(e)):Array.isArray(e)?function(e){return`<ul class="esri-widget__list">${e.map((e=>`<li>${"string"==typeof e?ae(oe(e)):e}</li>`)).join("")}</ul>`}(e):"esri.arcade.Dictionary"===e?.declaredClass?function(e){return`<table class="esri-widget__table">${e.keys().map((t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${"string"==typeof i?ae(oe(i)):i}</td></tr>`})).join("")}</table>`}(e):e}function ti(){return i.e(1050).then(i.bind(i,61050))}async function ii({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||"2d"!==t?.type)return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function ri({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=Kt.filter((e=>t.hasVariable(a,e))),[c]=await Promise.all([ii({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),u=t.getViewInfo({spatialReference:r}),h=t.createExecContext(n,u);h.interceptor=i,h.useAsync=!0,function({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach((i=>{const l=i.toLowerCase(),c={map:n,spatialReference:s.sr,interceptor:a};if("$map"===l&&(r.vars[l]=t.convertMapToFeatureSetCollection(c)),"$layer"===l&&(r.vars[l]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:a})),"$datastore"===l&&(r.vars[l]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:a})),"$aggregatedfeatures"===l){const i=o.layer,{fields:n,objectIdField:c,geometryType:u,spatialReference:h,displayField:d}=i,p=new Jt.default({fields:n,objectIdField:c,geometryType:u,spatialReference:h,displayField:d,..."feature"===i.type?{templates:i.templates,typeIdField:i.typeIdField,types:i.types}:null,source:e});r.vars[l]=t.convertFeatureLayerToFeatureSet({layer:p,spatialReference:s.sr,interceptor:a})}}))}({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:h,viewInfo:u,map:s,graphic:n,interceptor:i});const d=t.createFunction(a,h);return t.executeAsyncFunction(d,h).catch((t=>Qt.error("arcade-execution-error",{error:t,graphic:n,expressionInfo:e})))}async function si({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n}){if(!e||!e.length)return{};const o=await ti(),a={};for(const l of e)a[`expression/${l.name}`]=ri({expressionInfo:l,arcadeUtils:o,interceptor:r,spatialReference:t,map:s,graphic:i,view:n});const l=await(0,dt.as)(a),c={};for(const e in l)c[e]=ei(l[e].value);return c}let ni=class extends((0,$e.p)(c.Z)){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:e}=this;e&&e.abort(),this._abortController=null},this._createVM=()=>{const e=this.contentElement?.type;this.contentElementViewModel?.destroy();const t="fields"===e?new rt:"media"===e?new Ct:"text"===e?new Xe:null;this._set("contentElementViewModel",t)},this._compile=async()=>{this._cancelQuery();const e=new AbortController;this._abortController=e,await this._compileExpression(),this._abortController===e&&(this._abortController=null)},this._compileThrottled=v(this._compile,1,this),this._compileExpression=async()=>{const{expressionInfo:e,graphic:t,interceptor:i,spatialReference:r,map:s,view:n,_abortController:o}=this;if(!(e&&t&&r&&s))return void this._set("contentElement",null);const a=await ti();if(o!==this._abortController)return;const l=await ri({arcadeUtils:a,expressionInfo:e,graphic:t,interceptor:i,map:s,spatialReference:r,view:n});if(!l||"esri.arcade.Dictionary"!==l.declaredClass)return void this._set("contentElement",null);const c=await(0,Zt.d)(l,o.signal),u=c?.type,h="media"===u?$t.Z.fromJSON(c):"text"===u?Yt.Z.fromJSON(c):"fields"===u?qt.Z.fromJSON(c):null;this._set("contentElement",h)},this.handles.add([(0,n.YP)((()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view]),(()=>this._compileThrottled()),n.nn),(0,n.YP)((()=>[this.contentElement]),(()=>this._createVM()),n.nn)])}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference||null}set spatialReference(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){return this.view?.map||null}set map(e){void 0!==e?this._override("map",e):this._clearOverride("map")}};(0,r._)([(0,a.Cb)()],ni.prototype,"_abortController",void 0),(0,r._)([(0,a.Cb)({type:Xt.Z})],ni.prototype,"expressionInfo",void 0),(0,r._)([(0,a.Cb)({type:S.Z})],ni.prototype,"graphic",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],ni.prototype,"contentElement",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],ni.prototype,"contentElementViewModel",void 0),(0,r._)([(0,a.Cb)()],ni.prototype,"interceptor",void 0),(0,r._)([(0,a.Cb)()],ni.prototype,"spatialReference",null),(0,r._)([(0,a.Cb)({readOnly:!0})],ni.prototype,"state",null),(0,r._)([(0,a.Cb)()],ni.prototype,"map",null),(0,r._)([(0,a.Cb)()],ni.prototype,"view",void 0),ni=(0,r._)([(0,l.j)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],ni);const oi=ni;let ai=class extends x.Z{constructor(e,t){super(e,t),this.viewModel=new oi}initialize(){this.own((0,n.YP)((()=>this.viewModel?.contentElementViewModel),(()=>this._setupExpressionWidget()),n.nn))}destroy(){this._destroyContentWidget()}renderLoading(){return(0,xe.u)("div",{key:"loading-container",class:"esri-feature__loading-container"},(0,xe.u)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}render(){const{state:e}=this.viewModel;return(0,xe.u)("div",{class:"esri-feature-expression"},"loading"===e?this.renderLoading():"disabled"===e?null:this._contentWidget?.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t?.type;this._destroyContentWidget();const r=e?"fields"===i?new lt({viewModel:e}):"media"===i?new Wt({viewModel:e}):"text"===i?new Qe({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};(0,r._)([(0,a.Cb)({type:oi})],ai.prototype,"viewModel",void 0),ai=(0,r._)([(0,l.j)("esri.widgets.Feature.FeatureExpression")],ai);const li=ai;var ci;const ui="content-view-models",hi="esri.widgets.FeatureViewModel",di=y.Z.getLogger(hi),pi={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let fi=ci=class extends c.Z{constructor(e){super(e),this._handles=new g.Z,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=v(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...pi},this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:t}=this;return"attachments"===e.type&&t.attachmentsContent||"custom"===e.type&&t.customContent||"fields"===e.type&&t.fieldsContent||"media"===e.type&&t.mediaContent||"text"===e.type&&t.textContent||"expression"===e.type&&t.expressionContent},this._handles.add((0,n.YP)((()=>[this.graphic,this._effectivePopupTemplate,this.abilities]),(()=>this.graphicChangedThrottled()),n.nn))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return(0,_.pC)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function(e,t){const i=new Map;return e&&e.forEach((e=>{const r=X(e.fieldName,t);e.fieldName=r,i.set(r.toLowerCase(),e)})),i}(ne(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return W(this.graphic)}castAbilities(e){return{...pi,...e}}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){void 0!==e?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof Ct&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof Ct&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof Ct&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(t){(0,dt.D_)(t)||(this._error=t,di.error("error","The popupTemplate could not be displayed for this feature.",{error:t,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):"expression"===e.type?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map(((e,t)=>this._compileContentElement(e,t))):"string"==typeof e?this._compileText(new Yt.Z({text:e}),0).text:e}_destroyContentViewModels(){this._handles?.remove(ui),this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:i}=this,{contentElement:r,contentElementViewModel:s}=e,n=r?.type;s&&n&&("fields"===n&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),"media"===n&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),"text"===n&&s.set(this._createTextVMParams(r)))}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:o,view:a}=this,l=new oi({expressionInfo:i,graphic:r,interceptor:ci.interceptor,map:s,spatialReference:o,view:a});return this.contentViewModels[t]=l,this._handles.add((0,n.YP)((()=>l.contentElementViewModel),(()=>this._setExpressionContentVM(l,t)),n.nn),ui),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new He({graphic:i,...this._compileTitleAndDesc({title:s,description:r})}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new Xe({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:Q({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e}),description:Q({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:t})}}_createFieldsVMParams(e,t){const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s={...r.global,...r.content[t]},n=(e?.fieldInfos||i?.fieldInfos)?.filter((({fieldName:e})=>$(e)||he(e)||s.hasOwnProperty(e))),o=i?.expressionInfos,{description:a,title:l}=e;return{attributes:s,expressionInfos:o,fieldInfos:n,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(e,t){const i=e.clone(),r=new rt(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:r,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:o,relatedInfos:a,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:u}=r,{description:h,mediaInfos:d,title:p}=e;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:u,layer:l,fieldInfoMap:s,formattedAttributes:{...n.global,...n.content[t]},expressionAttributes:c,mediaInfos:d,popupTemplate:o,relatedInfos:a,...this._compileTitleAndDesc({title:p,description:h})}}_compileMedia(e,t){const i=e.clone(),r=new Ct(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,o=this.formattedAttributes.global;e.text=Q({attributes:n,fieldInfoMap:i,globalAttributes:o,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new Xe(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=t?.editFieldsInfo;return r&&s?function(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if("number"==typeof o){const e=t[s];return{type:"edit",date:(0,O.p6)(o,G),user:e}}const a=t[r];if("number"==typeof a){const e=t[i];return{type:"create",date:(0,O.p6)(a,G),user:e}}return null}(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,{attributes:n}=r;return Q({attributes:n,fieldInfoMap:t,globalAttributes:this.formattedAttributes.global,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e?.title;return Z(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e?.content;return Z(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this,{content:{value:l},title:{value:c}}=await(0,dt.as)({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;await ue({graphic:r,popupTemplate:s,layer:i,spatialReference:n},e);const{expressionAttributes:{value:u}}=await(0,dt.as)({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:si({expressionInfos:s?.expressionInfos,spatialReference:n,graphic:r,map:o,interceptor:ci.interceptor,view:a})});t===this._featureAbortController&&r&&(this._expressionAttributes=u,this._graphicExpressionAttributes={...r.attributes,...u},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[t]=ce({fieldInfos:r?.fieldInfos,graphic:s,attributes:{...l,...e.attributes},layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[t]=ce({fieldInfos:e.fieldInfos,graphic:r,attributes:{...a,...e.attributes},layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t?.fieldInfos,l={global:ce({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&this._createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:l}),"media"===e.type&&this._createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:l})})),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,ne(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=(0,_.pC)(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!n)return;const o=t.filter((e=>e&&he(e.fieldName)));if(!o||!o.length)return;t.forEach((e=>this._configureRelatedInfo(e,n)));const a=await function({relatedInfos:e,layer:t},i){const r={};return e.forEach(((e,s)=>{const{relation:n}=e;if(!n){const e=new C.Z("relation-required","A relation is required on a layer to retrieve related records.");throw _t.error(e),e}const{relatedTableId:o}=n;if("number"!=typeof o){const e=new C.Z("A related table ID is required on a layer to retrieve related records.");throw _t.error(e),e}const a=`${t.url}/${o}`,l=vt.get(a),c=l||function(e,t){return(0,ht.default)(e,{query:{f:"json"},signal:t&&t.signal})}(a,i);l||vt.set(a,c),r[s]=c})),(0,dt.as)(r)}({relatedInfos:r,layer:n},i);Object.keys(a).forEach((e=>{const t=r.get(e.toString()),i=a[e]?.value;t&&i&&(t.layerInfo=i.data)}));const l=await function({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach(((t,n)=>{t.layerInfo&&(s[n]=async function(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:u}=t,h=function({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some((t=>(`${t.relatedTableId}`===i&&t.id===e.id&&(r=t),!!r))),r}({originRelationship:o,relationships:n.relationships,layerId:s});if(h.relationshipTableId&&h.keyFieldInRelationshipTable){const t=(await function(e,t,i,r){const s=new gt.Z;return s.outFields=["*"],s.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}(e,h,i,r))[e.attributes[i.objectIdField]];if(!t)return null;const s=t.features.map((e=>e.attributes[n.objectIdField]));if(l?.length>0&&n.supportsStatistics){const e=new mt.Z;e.where=function(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,1e3+r)})`),r+=1e3;return s.join(" OR ")}(n.objectIdField,s),e.outFields=a,e.outStatistics=l,e.sourceSpatialReference=u;const i={features:Promise.resolve(t),statsFeatures:(0,pt.e)(c,e)};return(0,dt.as)(i)}}const d=h?.keyField;if(d){const i=(0,P.H7)(function(e,t){if(null!=e){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}(n.fields,d)),s=function(e,t){const i=t.toLowerCase();for(const t in e)if(t.toLowerCase()===i)return e[t];return null}(e.attributes,o.keyField),a=i?`${d}=${s}`:`${d}='${s}'`,l=(0,pt.e)(c,new mt.Z({where:a,outFields:t.relatedFields,sourceSpatialReference:u}),r),h=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?(0,pt.e)(c,new mt.Z({where:a,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:u}),r):null,p={features:l};return h&&(p.statsFeatures=h),(0,dt.as)(p)}return null}(e,t,i,r))})),(0,dt.as)(s)}({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach((e=>{!function(e,t){if(!t)return;if(!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}(l[e]?.value,r.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=bt(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||function(e,t){const i=function(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some((t=>t.id===parseInt(e,10)&&(i=t,!0))),i}(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}(s,t);o&&(function({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new yt.Z({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};fi.interceptor=new class{constructor(e,t){this.preLayerQueryCallback=e,this.preRequestCallback=t,this.preLayerQueryCallback||(this.preLayerQueryCallback=e=>{}),this.preRequestCallback||(this.preLayerQueryCallback=e=>{})}}((({query:e,layer:t,method:i})=>{fe({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})}),(({queryPayload:e,layer:t,method:i})=>{fe({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})})),(0,r._)([(0,a.Cb)()],fi.prototype,"_error",void 0),(0,r._)([(0,a.Cb)()],fi.prototype,"_featureAbortController",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"_effectivePopupTemplate",null),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"_fieldInfoMap",null),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"_sourceLayer",null),(0,r._)([(0,a.Cb)()],fi.prototype,"abilities",void 0),(0,r._)([(0,w.p)("abilities")],fi.prototype,"castAbilities",null),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"content",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"contentViewModels",void 0),(0,r._)([(0,a.Cb)({type:Boolean})],fi.prototype,"defaultPopupTemplateEnabled",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"state",null),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"formattedAttributes",void 0),(0,r._)([(0,a.Cb)({type:S.Z,value:null})],fi.prototype,"graphic",null),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"lastEditInfo",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"relatedInfos",void 0),(0,r._)([(0,a.Cb)()],fi.prototype,"spatialReference",null),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"title",void 0),(0,r._)([(0,a.Cb)()],fi.prototype,"map",null),(0,r._)([(0,a.Cb)({readOnly:!0})],fi.prototype,"waitingForContent",null),(0,r._)([(0,a.Cb)()],fi.prototype,"view",void 0),fi=ci=(0,r._)([(0,l.j)(hi)],fi);const mi=fi;i(33156);const gi=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=e=>(0,Je.Qd)(e)&&!e.destroyed?(0,xe.u)("div",{key:e},e.render()):e instanceof HTMLElement?(0,xe.u)("div",{key:e,bind:e,afterCreate:this._attachToNode}):(0,Je.o)(e)?(0,xe.u)("div",{key:e,bind:e.domNode,afterCreate:this._attachToNode}):null}_attachToNode(e){e.appendChild(this)}};return t=(0,r._)([(0,l.j)("esri.widgets.Feature.ContentMixin")],t),t};var yi=i(61547);const _i="esri-feature__content-element",vi={title:!0,content:!0,lastEditedInfo:!0};let bi=class extends(gi(x.Z)){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...vi},this.map=null,this.view=null,this.viewModel=new mi}initialize(){this.own((0,n.YP)((()=>this.viewModel?.contentViewModels),(()=>this._setupContentWidgets()),n.nn))}loadDependencies(){return i.e(817).then(i.bind(i,50817))}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...vi,...e}}render(){const{state:e}=this.viewModel,t=(0,xe.u)("div",{class:"esri-feature__size-container",key:"container"},this.renderTitle(),"error"===e?this.renderError():"loading"===e?this.renderLoading():this.renderContentContainer());return(0,xe.u)("div",{class:this.classes("esri-feature","esri-widget")},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return(0,xe.u)("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?(0,xe.u)("div",{key:"error-title",slot:"title"},e.errorMessage):null,(0,xe.u)("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return(0,xe.u)("div",{key:"loading-container",class:"esri-feature__loading-container"},(0,xe.u)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?(0,xe.u)("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?(0,xe.u)(je.X6,{level:this.headingLevel,class:"esri-feature__title",innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?(0,xe.u)("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:(0,xe.u)("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if("boolean"!=typeof i.content&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return"loading"===i||r.length>0?(0,xe.u)("div",{key:this._buildKey("attachments-element",e),class:this.classes(_i)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,xe.u)("div",{key:this._buildKey("expression-element",e),class:_i},t.render())}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?(0,xe.u)("div",{key:this._buildKey("custom-element",t),class:_i},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,xe.u)("div",{key:this._buildKey("fields-element",e),class:_i},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,xe.u)("div",{key:this._buildKey("media-element",e),class:_i},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n="edit"===i.type?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=(0,yi.n)(n,{date:r,user:s});return(0,xe.u)("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info",_i)},o)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?(0,xe.u)("div",{key:this._buildKey("text-element",t),class:this.classes(_i,"esri-feature__text")},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach((e=>this._destroyContentWidget(e))),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach(((i,s)=>{"attachments"===i.type&&(this._contentWidgets[s]=new qe({displayType:i.displayType,headingLevel:t.title?e+1:e,viewModel:r[s]})),"fields"===i.type&&(this._contentWidgets[s]=new lt({viewModel:r[s]})),"media"===i.type&&(this._contentWidgets[s]=new Wt({viewModel:r[s]})),"text"===i.type&&(this._contentWidgets[s]=new Qe({viewModel:r[s]})),"custom"===i.type&&(this._contentWidgets[s]=new Qe({viewModel:r[s]})),"expression"===i.type&&(this._contentWidgets[s]=new li({viewModel:r[s]}))}),this);else{const e=r[0];e&&!e.destroyed&&(this._contentWidgets[0]=new Qe({viewModel:e}))}this.scheduleRender()}};(0,r._)([(0,b.B)("viewModel.graphic")],bi.prototype,"graphic",void 0),(0,r._)([(0,b.B)("viewModel.defaultPopupTemplateEnabled")],bi.prototype,"defaultPopupTemplateEnabled",void 0),(0,r._)([(0,a.Cb)()],bi.prototype,"headingLevel",void 0),(0,r._)([(0,a.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],bi.prototype,"label",void 0),(0,r._)([(0,a.Cb)(),(0,we.H)("esri/widgets/Feature/t9n/Feature")],bi.prototype,"messages",void 0),(0,r._)([(0,a.Cb)(),(0,we.H)("esri/t9n/common")],bi.prototype,"messagesCommon",void 0),(0,r._)([(0,a.Cb)(),(0,we.H)("esri/widgets/support/t9n/uriUtils")],bi.prototype,"messagesURIUtils",void 0),(0,r._)([(0,b.B)("viewModel.spatialReference")],bi.prototype,"spatialReference",void 0),(0,r._)([(0,b.B)("viewModel.title")],bi.prototype,"title",void 0),(0,r._)([(0,a.Cb)()],bi.prototype,"visibleElements",void 0),(0,r._)([(0,w.p)("visibleElements")],bi.prototype,"castVisibleElements",null),(0,r._)([(0,b.B)("viewModel.map")],bi.prototype,"map",void 0),(0,r._)([(0,b.B)("viewModel.view")],bi.prototype,"view",void 0),(0,r._)([(0,a.Cb)({type:mi})],bi.prototype,"viewModel",void 0),bi=(0,r._)([(0,l.j)("esri.widgets.Feature")],bi);const wi=bi;var xi,Ci=i(31355);const Ti=Symbol("anchorHandles");let Si=class extends Ci.Z.EventedAccessor{constructor(e){super(e),this[xi]=new g.Z,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[Ti].add([(0,n.gx)((()=>(0,_.yw)(this.screenLocationEnabled?this.view:null,(e=>[e.size,"3d"===e.type?e.camera:e.viewpoint]))),(()=>this.notifyChange("screenLocation"))),(0,n.YP)((()=>this.screenLocation),((e,t)=>{(0,_.pC)(e)&&(0,_.pC)(t)&&this.emit("view-change")}))])}destroy(){this.view=null,this[Ti]=(0,_.SC)(this[Ti])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this;return i&&(0,_.pC)(e)&&(0,_.pC)(t)&&t.ready?t.toScreen(e):null}};xi=Ti,(0,r._)([(0,a.Cb)()],Si.prototype,"location",void 0),(0,r._)([(0,a.Cb)()],Si.prototype,"screenLocation",null),(0,r._)([(0,a.Cb)()],Si.prototype,"screenLocationEnabled",void 0),(0,r._)([(0,a.Cb)()],Si.prototype,"view",void 0),Si=(0,r._)([(0,l.j)("esri.widgets.support.AnchorElementViewModel")],Si);const Ei=Si;let Ai=class extends Ei{constructor(e){super(e),this.visible=!1}};(0,r._)([(0,a.Cb)()],Ai.prototype,"visible",void 0),Ai=(0,r._)([(0,l.j)("esri.widgets.CompassViewModel")],Ai);const Mi=Ai;let Oi=class extends x.Z{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new Mi,this.visible=!1}initialize(){this.own([(0,n.YP)((()=>this.visible),(e=>this._visibleChange(e)))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0,i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r={"esri-spinner--start":e&&i,"esri-spinner--finish":!e&&i},s=this._getPositionStyles();return(0,xe.u)("div",{class:this.classes("esri-spinner",r),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=(0,dt.e4)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if((0,_.Wi)(t)||(0,_.Wi)(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};(0,r._)([(0,b.B)("viewModel.location")],Oi.prototype,"location",void 0),(0,r._)([(0,b.B)("viewModel.view")],Oi.prototype,"view",void 0),(0,r._)([(0,a.Cb)({type:Mi})],Oi.prototype,"viewModel",void 0),(0,r._)([(0,b.B)("viewModel.visible")],Oi.prototype,"visible",void 0),Oi=(0,r._)([(0,l.j)("esri.widgets.Spinner")],Oi);const Ri=Oi;i(4905);var Pi=i(39536),Ii=i(38481),Li=i(83258),Di=i(97837),Ni=i(15600),Fi=i(43198),ki=i(15331),Ui=i(42780);const Vi="esri-icon-zoom-in-magnifying-glass",zi=new Di.Z({id:"zoom-to-feature",title:"{messages.zoom}",className:Vi}),Bi=new Di.Z({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),Hi=new Di.Z({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Vi}),ji=new Di.Z({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"}),Gi=y.Z.getLogger("esri.widgets.Popup.PopupViewModel");function Wi(e){const{selectedFeature:t,location:i,view:r}=e;return r?"3d"===r.type?t||i:e.get("selectedFeature.geometry")||i:null}function Zi(e){return e?.isAggregate&&"cluster"===e?.sourceLayer?.featureReduction?.type}var qi=i(68266),$i=i(43411);const Yi=u.Z.ofType({key:"type",defaultKeyValue:"button",base:Li.Z,typeMap:{button:Di.Z,toggle:Ni.Z}}),Xi="esri.widgets.Popup.PopupViewModel",Ji=y.Z.getLogger(Xi);let Ki=class extends((0,qi._)(Ei)){constructor(e){super(e),this._handles=new g.Z,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new Yi,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new S.Z({symbol:new $i.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some((e=>e.waitingForContent))}initialize(){this._handles.add([(0,n.YP)((()=>[this.autoOpenEnabled,this.view]),(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),(0,n.YP)((()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view]),(()=>this._highlightSelectedFeature())),(0,n.YP)((()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view]),(()=>this._highlightActiveFeature())),(0,n.YP)((()=>this.view?.animation?.state),(e=>this._animationStateChange(e))),(0,n.YP)((()=>this.location),(e=>this._locationChange(e))),(0,n.YP)((()=>this.selectedFeature),(e=>this._selectedFeatureChange(e))),(0,n.YP)((()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage]),(()=>this._selectedFeatureIndexChange())),(0,n.YP)((()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels]),(()=>this._setGraphicOnFeatureViewModels())),(0,n.YP)((()=>this.featureViewModels),(()=>this._featureViewModelsChange())),this.on("trigger-action",(e=>(e=>{const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new C.Z("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new C.Z("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new C.Z("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new C.Z("trigger-action:invalid-action","Action is disabled"));if(o===zi.id)return async function(e){const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=Wi(e);if(!n){const e=new C.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw Gi.error(e),e}const o=r.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&"point"===a.type&&function(e,t){if("3d"!==t?.type||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then((e=>{t=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const t=new C.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});Gi.error(t)})),t}return!0}(i,r);zi.active=!0,zi.disabled=!0;try{await e.view.goTo({target:n,scale:l?o:void 0})}finally{zi.active=!1,zi.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}(s.viewModel).catch(dt.H9);if(o===Hi.id)return async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==i?.type){const e=new C.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw Gi.error(e),e}if(!Zi(t)){const e=new C.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Gi.error(e),e}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],Hi.active=!0,Hi.disabled=!0;const{extent:o}=await s.queryExtent(n);await i.goTo({target:o}),Hi.active=!1,Hi.disabled=!1}(s.viewModel);if(o===ji.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===Bi.id){s.close();const{selectedFeature:e}=s;if(!e)return Promise.reject(new C.Z(`trigger-action:${Bi.id}`,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):i.graphics.remove(e),Promise.resolve()}return Promise.resolve()})({event:e,view:this.view}))),(0,n.gx)((()=>!this.waitingForResult),(()=>this._waitingForResultChange()),n.Z_),(0,n.YP)((()=>[this.features,this.view?.map,this.view?.spatialReference]),(()=>this._updateFeatureVMs())),(0,n.YP)((()=>this.view?.scale),(()=>this._viewScaleChange())),(0,n.gx)((()=>!this.visible),(()=>this.browseClusterEnabled=!1)),(0,n.YP)((()=>this.browseClusterEnabled),(e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new Yi;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(t):t,a=n&&("function"==typeof n.getEffectivePopupTemplate&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach((t=>e.add(t))),e}get defaultActions(){const e=this._get("defaultActions")||new Yi;return e.removeAll(),e.addMany(Zi(this.selectedFeature)?[Hi.clone(),ji.clone()]:[zi.clone()]),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&-1===s?this.selectedFeatureIndex=0:n&&-1!==s||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=(0,Pi.$)(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((e=>{this._pendingPromises.add(e),e.then((t=>{this._pendingPromises.has(e)&&this._updateFeatures(t),this._updatePendingPromises(e)}),(()=>this._updatePendingPromises(e)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=Wi(this);if(!t){const i=new C.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return Ji.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const t=new C.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return Ji.error(t),Promise.reject(t)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const r=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const e of r)delete t[e];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){(function(e){const t=e.features.filter((e=>Zi(e)));t.length&&(e.features=t)})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;"2d"===e?.type?Zi(t)?(await async function(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(e.selectedClusterBoundaryFeature)}(this),await async function(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],ji.active=!0,ji.disabled=!0;const{features:o}=await s.queryFeatures(n);ji.active=!1,ji.disabled=!1,i.popup.open({features:[t].concat(o),featureMenuOpen:!0})}(this)):Ji.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):Ji.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(zi.disabled="waiting-for-target"===e)}_clearBrowsedClusterGraphics(){const e=this.view?.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Zi(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(null===i)return;const n=((i-1)*r+t)%t,o=n+r;s.slice(n,o).forEach(((t,i)=>{t&&!t.graphic&&(t.graphic=e[n+i])}))}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),Zi(e))return;return e.symbol=await(0,Fi.zd)(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature)}!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then((()=>{this.location=r.center.clone()})):this.location=(0,_.Wg)(this._getPointFromGeometry(e.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:i}=e,r=Promise.resolve(t),s=i.map((e=>e.promise));this.promises=[r,...s]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(Zi(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach(((t,i)=>{if(!t)return;let n=null;if(r.some(((e,i)=>(e&&e.graphic===t&&(n=e,r.splice(i,1)),!!n))),n)s[i]=n;else{const r=new mi({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:this.view?.spatialReference,graphic:t===e?t:null,map:this.view?.map,view:this.view});s[i]=r}})),r.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const i=this.view.on("click",(e=>{"mouse"===e.pointerType&&0!==e.button||this._fetchFeaturesAndOpen(e)}),ki.f.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:s,location:n}=e,o=[Promise.resolve(t),...s.map((e=>e.promise))];return r.popup.open({location:n||i,promises:o}),e}))}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return(0,_.Wi)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return"map-notes"===i?.type||"subtype-group"===i?.type?i:t}_getHighlightTarget(e,t){const i="imagery"===t.type?void 0:"objectIdField"in t&&t.objectIdField,r=e.attributes;return r&&i&&r[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&t&&s))return;const n=this._getHighlightLayer(r);if(!(n&&n instanceof Ii.Z))return;const o=this._getLayerView(i,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&(0,Ui.tl)(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(r,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof Ii.Z))return;const o=this._getLayerView(r,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&(0,Ui.tl)(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter((e=>!t.includes(e)));this.features=t.concat(i)}};(0,r._)([(0,a.Cb)()],Ki.prototype,"featurePage",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"isLoadingFeature",null),(0,r._)([(0,a.Cb)({type:Yi})],Ki.prototype,"actions",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],Ki.prototype,"active",null),(0,r._)([(0,a.Cb)()],Ki.prototype,"activeFeature",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],Ki.prototype,"allActions",null),(0,r._)([(0,a.Cb)({type:Boolean})],Ki.prototype,"defaultPopupTemplateEnabled",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"autoCloseEnabled",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"autoOpenEnabled",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"browseClusterEnabled",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"content",void 0),(0,r._)([(0,a.Cb)({type:Yi,readOnly:!0})],Ki.prototype,"defaultActions",null),(0,r._)([(0,a.Cb)({readOnly:!0})],Ki.prototype,"featureCount",null),(0,r._)([(0,a.Cb)()],Ki.prototype,"features",null),(0,r._)([(0,a.Cb)()],Ki.prototype,"featuresPerPage",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"featureViewModelAbilities",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],Ki.prototype,"featureViewModels",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"highlightEnabled",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"includeDefaultActions",void 0),(0,r._)([(0,a.Cb)({type:ft.Z})],Ki.prototype,"location",null),(0,r._)([(0,a.Cb)({readOnly:!0})],Ki.prototype,"pendingPromisesCount",null),(0,r._)([(0,a.Cb)({readOnly:!0})],Ki.prototype,"selectedClusterBoundaryFeature",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],Ki.prototype,"waitingForResult",null),(0,r._)([(0,a.Cb)({readOnly:!0})],Ki.prototype,"promiseCount",null),(0,r._)([(0,a.Cb)()],Ki.prototype,"promises",null),(0,r._)([(0,a.Cb)({value:null,readOnly:!0})],Ki.prototype,"selectedFeature",null),(0,r._)([(0,a.Cb)({value:-1})],Ki.prototype,"selectedFeatureIndex",null),(0,r._)([(0,a.Cb)({readOnly:!0})],Ki.prototype,"selectedFeatureViewModel",null),(0,r._)([(0,a.Cb)({readOnly:!0})],Ki.prototype,"state",null),(0,r._)([(0,a.Cb)()],Ki.prototype,"title",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"updateLocationEnabled",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"view",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"visible",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"zoomFactor",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"zoomToLocation",void 0),(0,r._)([(0,a.Cb)()],Ki.prototype,"centerAtLocation",null),Ki=(0,r._)([(0,l.j)(Xi)],Ki);const Qi=Ki;var er=i(92165),tr=i(31071);const ir="selected-index",rr="popup-spinner",sr="esri-icon-left-triangle-arrow",nr="esri-icon-right-triangle-arrow",or="esri-icon-loading-indicator",ar="esri-rotating",lr="esri-popup--shadow",cr="esri-popup__header-container",ur="esri-popup__button",hr="esri-popup__icon",dr={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};function pr(e,t){return void 0===t?`esri-popup__${e}`:`esri-popup__${e}-${t}`}const fr="esri.widgets.Popup",mr=y.Z.getLogger(fr),gr={closeButton:!0,featureNavigation:!0};let yr=class extends(gi(x.Z)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new g.Z,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([e])=>{e?.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=v((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new Qi,this.visible=null,this.visibleElements={...gr},this._addSelectedFeatureIndexHandle(),this.own([(0,n.YP)((()=>this.viewModel?.screenLocation),(()=>this._positionContainer())),(0,n.YP)((()=>[this.viewModel?.active,this.dockEnabled]),(()=>this._toggleScreenLocationEnabled())),(0,n.YP)((()=>this.viewModel?.screenLocation),((e,t)=>{!!e!=!!t&&this.reposition()})),(0,n.YP)((()=>[this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment]),(()=>this.reposition())),(0,n.YP)((()=>this.spinnerEnabled),(e=>this._spinnerEnabledChange(e))),(0,n.YP)((()=>this.viewModel?.view?.size),((e,t)=>this._updateDockEnabledForViewSize(e,t))),(0,n.YP)((()=>this.viewModel?.view),((e,t)=>this._viewChange(e,t))),(0,n.YP)((()=>this.viewModel?.view?.ready),((e,t)=>this._viewReadyChange(e,t))),(0,n.YP)((()=>[this.viewModel?.waitingForResult,this.viewModel?.location]),(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),(0,n.YP)((()=>[this.selectedFeatureWidget?.viewModel?.title,this.selectedFeatureWidget?.viewModel?.state]),(()=>this._setTitleFromFeatureWidget())),(0,n.YP)((()=>[this.selectedFeatureWidget?.viewModel?.content,this.selectedFeatureWidget?.viewModel?.state]),(()=>this._setContentFromFeatureWidget())),(0,n.gx)((()=>!this.collapsed),(()=>{"xsmall"===this.viewModel?.view?.widthBreakpoint&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),(0,n.on)((()=>this.viewModel?.allActions),"change",(()=>this._watchActions())),(0,n.YP)((()=>this.viewModel?.allActions),(()=>this._watchActions()),n.nn),(0,n.YP)((()=>this.viewModel?.featureViewModels),(()=>this._featureMenuViewportScrollTop()))])}destroy(){this._destroySelectedFeatureWidget(),this._destroySpinner(),this._handles?.destroy(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){return!!(this.selectedFeatureWidget?this.selectedFeatureWidget?.viewModel?.waitingForContent||"error"===this.selectedFeatureWidget?.viewModel?.state||this.selectedFeatureWidget?.viewModel?.content:this.viewModel?.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||dr}set dockOptions(e){const t={...dr},i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s={...t,...e},n={...t.breakpoint,...r},{breakpoint:o}=s;!0===o?s.breakpoint=n:"object"==typeof o&&(s.breakpoint={...n,...o}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:r}=this.viewModel,s={...t,title:!1};return r?(e?(e.viewModel=r,e.visibleElements=s):this._feature=new wi({headingLevel:i+1,viewModel:r,visibleElements:s}),this._feature):null}castVisibleElements(e){return{...gr,...e}}blur(){const{active:e}=this.viewModel;e||mr.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||mr.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){this._handles.remove(ir);const t=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:t};"xsmall"===this.viewModel?.view?.widthBreakpoint&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:i,dividedActions:r,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=r,l=o&&a.length>1&&e,c=o&&t,u=o&&!t,h=this.selectedFeature?.layer?.title,d=this.selectedFeature?.layer?.id,p={"esri-popup--aligned-top-center":"top-center"===s,"esri-popup--aligned-bottom-center":"bottom-center"===s,"esri-popup--aligned-top-left":"top-left"===s,"esri-popup--aligned-bottom-left":"bottom-left"===s,"esri-popup--aligned-top-right":"top-right"===s,"esri-popup--aligned-bottom-right":"bottom-right"===s,"esri-popup--is-docked":c,[lr]:u,"esri-popup--is-docked-top-left":"top-left"===n,"esri-popup--is-docked-top-center":"top-center"===n,"esri-popup--is-docked-top-right":"top-right"===n,"esri-popup--is-docked-bottom-left":"bottom-left"===n,"esri-popup--is-docked-bottom-center":"bottom-center"===n,"esri-popup--is-docked-bottom-right":"bottom-right"===n,"esri-popup--feature-menu-open":i,"esri-popup--actions-menu-open":l};return(0,xe.u)("div",{class:this.classes("esri-popup",p),role:"presentation","data-layer-title":h,"data-layer-id":d,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return(0,xe.u)("span",{"aria-hidden":"true",class:this.classes(hr,or,ar)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?(0,xe.u)("div",{key:pr("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=(0,be.dZ)(this.container),t={[nr]:e,"esri-popup__pagination-previous-icon--rtl":e,[sr]:!e,"esri-popup__pagination-previous-icon":!e};return(0,xe.u)("span",{"aria-hidden":"true",class:this.classes(hr,t)})}renderPreviousButton(){const{messages:e}=this;return(0,xe.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(ur,"esri-popup__pagination-previous"),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=(0,be.dZ)(this.container),t={[sr]:e,"esri-popup__pagination-next-icon--rtl":e,[nr]:!e,"esri-popup__pagination-next-icon":!e};return(0,xe.u)("span",{"aria-hidden":"true",class:this.classes(hr,t)})}renderNextButton(){const{messages:e}=this;return(0,xe.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(ur,"esri-popup__pagination-next"),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return(0,xe.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(ur,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={"esri-icon-minimize":e,"esri-popup__icon--dock-icon":!e,"esri-icon-dock-right":!e&&("top-right"===t||"bottom-right"===t),"esri-icon-dock-left":!e&&("top-left"===t||"bottom-left"===t),"esri-icon-maximize":!e&&"top-center"===t,"esri-icon-dock-bottom":!e&&"bottom-center"===t};return(0,xe.u)("span",{"aria-hidden":"true",class:this.classes(i,hr)})}renderDockButton(){const{dockEnabled:e,messages:t}=this,i=this.viewModel?.view?.widthBreakpoint,r=e?t.undock:t.dock;return"xsmall"!==i&&this.dockOptions?.buttonEnabled?(0,xe.u)("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(ur,"esri-popup__button--dock")},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={"esri-popup__header-container--button":i},o=(0,xe.u)(je.X6,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:e}),a=i?(0,xe.u)("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(cr,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed,type:"button"},o):(0,xe.u)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(cr,n)},o);return e?a:null}renderCloseIcon(){return(0,xe.u)("span",{"aria-hidden":"true",class:this.classes(hr,"esri-icon-close")})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?(0,xe.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:ur,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return(0,xe.u)("header",{class:"esri-popup__header"},this.renderTitle(),(0,xe.u)("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?(0,xe.u)("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:"esri-popup__content"},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:o}=r;return o.length?(0,xe.u)("div",{key:pr("actions-menu-button"),class:this.classes(ur,"esri-popup__actions-menu-button"),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},(0,xe.u)("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s}=r;return s.length&&i?(0,xe.u)("ul",{id:e,role:"menu","aria-labelledby":t,key:pr("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map((e=>this.renderAction({action:e,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map((e=>this.renderAction({action:e,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?(0,xe.u)("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?(0,xe.u)("section",{key:pr("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n={"esri-popup__footer--has-pagination":e,"esri-popup__footer--has-actions":s,"esri-popup__footer--has-actions-menu":!!r.length};return e||s?(0,xe.u)("div",{key:pr("feature-buttons"),class:this.classes("esri-popup__footer",n)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=(0,yi.n)(e.selectedFeatures,{total:t.length});return(0,xe.u)("section",{key:pr("menu"),class:"esri-popup__feature-menu"},(0,xe.u)("strong",{class:"esri-popup__feature-menu-header"},r),(0,xe.u)("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:be.Yo},this.renderFeatureMenu(),(0,xe.u)("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?(0,xe.u)("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:(0,xe.u)("div",{key:pr("pointer"),class:"esri-popup__pointer",role:"presentation"},(0,xe.u)("div",{class:this.classes("esri-popup__pointer-direction",lr)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,u="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===i||"top-center"===i||"top-right"===i,h="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,d={[lr]:e,"esri-popup--is-collapsible":n,"esri-popup--is-collapsed":a};return(0,xe.u)("div",{class:this.classes("esri-popup__main-container","esri-widget",d),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?r:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},u?this.renderFooter():null,u?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null)}renderContent(){const e=this.viewModel?.content;return e?"string"==typeof e?(0,xe.u)("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return(0,xe.u)("span",{key:"text",class:"esri-popup__action-text"},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[or]:e.active,[ar]:e.active,[hr]:!!t,"esri-popup__action-image":!e.active&&!!i};return t&&(r[t]=!e.active),(0,xe.u)("span",{key:"icon","aria-hidden":"true",class:this.classes(hr,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,r=this._getActionTitle(t),s={"esri-popup__action":"toggle"!==t.type,"esri-popup__action-toggle":"toggle"===t.type,"esri-popup__action-toggle--on":"toggle"===t.type&&t.value,"esri-popup__button--disabled":t.disabled},n=[this.renderActionIcon(t),this.renderActionText(r)],o="menu-item"===i?(0,xe.u)("li",{key:t.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(ur,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):(0,xe.u)("div",{key:t.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(ur,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={"esri-popup__feature-menu-item--selected":o},l=o?(0,xe.u)("span",{key:pr(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:"esri-icon-check-mark"}):null,c=(0,xe.u)("span",{innerHTML:e.title||r.untitled});return(0,xe.u)("li",{role:"menuitem",tabIndex:-1,key:pr(`feature-menu-feature-${s}`),class:this.classes(a,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},(0,xe.u)("span",{class:"esri-popup__feature-menu-title"},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?(0,xe.u)("ol",{class:"esri-popup__feature-menu-list",id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter((e=>!!e.graphic)).map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=i?.attributes,o="zoom-to-feature"===s?(0,yi.n)(e.title,{messages:t}):"remove-selected-feature"===s?(0,yi.n)(e.title,{messages:r}):"zoom-to-clustered-features"===s||"browse-clustered-features"===s?(0,yi.n)(e.title,{messages:t}):e.title;return o&&n?(0,yi.n)(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,i=t?.attributes,{className:r,image:s}=e,n=s||r?r:"esri-icon-default-action";return n&&i?(0,yi.n)(n,i):n}_getActionImage(e){const{selectedFeature:t}=this,i=t?.attributes,{image:r}=e;return r&&i?(0,yi.n)(r,i):r}_createFeatureUpdatedAnimation(){return(0,be.vU)("enter","esri-popup--feature-updated")}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add((0,n.YP)((()=>[e.uid,e.active,e.className,e.disabled,e.id,e.title,e.image,e.visible]),(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter((e=>e.visible)),i=this._getInlineActionCount(),r=null===i,s=0===i;return{inlineActions:r?t.slice(0):s?new u.Z:t.slice(0,i),menuActions:r?new u.Z:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title="error"===e.viewModel?.state?t.errorMessage:e.viewModel?.title||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){"Escape"===(0,m.kK)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===(0,m.kK)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=(0,m.kK)(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=(0,m.kK)(e),{_actionsMenuNode:i}=this,r=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex((e=>e.uid===r));if(!i)return;const o=i.querySelectorAll("li"),a=o.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=(0,m.kK)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await(0,n.N1)((()=>!0===this.viewModel?.active)),this.focus())}_addSelectedFeatureIndexHandle(){const e=(0,n.YP)((()=>this.viewModel?.selectedFeatureIndex),((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,ir)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const o=n.padding;return"right"===s&&r.x+i/2>n.width-o.right||"left"===s&&r.x-i/2<o.left||"top"===s&&r.y-t<o.top||"bottom"===s&&r.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if((0,_.Wi)(n)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,u=l?a(l.getPropertyValue("height")):0,{height:h,width:d}=i.getBoundingClientRect(),p=d+t,f=Math.max(h,c,u)+t,m=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:n,side:"right",view:o}),g=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:n,side:"left",view:o}),y=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:n,side:"top",view:o}),v=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:n,side:"bottom",view:o});return g?y?"bottom-right":"top-right":m?y?"bottom-left":"top-left":y?v?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return(0,be.dZ)(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){if("auto"!==e)return e;const t=this.viewModel?.view,i=(0,be.dZ)(this.container)?"top-left":"top-right";if(!t)return i;const r=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-r.left-r.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=r/2,a=i.height-t,l=i.width-e,{padding:c}=this.view;return"bottom-center"===s?{top:t+n-c.top,left:e-o-c.left}:"top-left"===s?{bottom:a+n-c.bottom,right:l+n-c.right}:"bottom-left"===s?{top:t+n-c.top,right:l+n-c.right}:"top-right"===s?{bottom:a+n-c.bottom,left:e+n-c.left}:"bottom-right"===s?{top:t+n-c.top,left:e+n-c.left}:"top-center"===s?{bottom:a+n-c.bottom,left:e-o-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if((0,_.Wi)(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:void 0!==n.top?`${n.top}px`:"auto",left:void 0!==n.left?`${n.left}px`:"auto",bottom:void 0!==n.bottom?`${n.bottom}px`:"auto",right:void 0!==n.right?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,o]=t,{width:a,height:l}=i;return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=e[0]-r,n[1]=e[1]-s,o[0]=t[0]-r,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){const t=e.breakpoint,i=this.viewModel?.view?.ui;if(!i)return!1;const{width:r,height:s}=i;if(isNaN(r)||isNaN(s))return!1;const n=t.hasOwnProperty("width")&&r<=t.width,o=t.hasOwnProperty("height")&&s<=t.height;return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?(0,yi.n)(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,rr),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new Ri({view:e}),e.ui.add(this._spinner,{key:rr,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,r=i.findIndex((e=>e.uid===t)),s=i.getItemAt(r);s&&"toggle"===s.type&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"actionsMenuId",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"actionsMenuButtonId",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"featureMenuId",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"titleId",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"contentId",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"hasContent",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"featureNavigationVisible",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"collapsible",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"featureMenuVisible",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"contentCollapsed",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"dividedActions",null),(0,r._)([(0,b.B)("viewModel.actions")],yr.prototype,"actions",void 0),(0,r._)([(0,a.Cb)()],yr.prototype,"actionsMenuOpen",null),(0,r._)([(0,a.Cb)()],yr.prototype,"alignment",void 0),(0,r._)([(0,b.B)("viewModel.autoCloseEnabled")],yr.prototype,"autoCloseEnabled",void 0),(0,r._)([(0,b.B)("viewModel.autoOpenEnabled")],yr.prototype,"autoOpenEnabled",void 0),(0,r._)([(0,b.B)("viewModel.defaultPopupTemplateEnabled")],yr.prototype,"defaultPopupTemplateEnabled",void 0),(0,r._)([(0,b.B)("viewModel.content")],yr.prototype,"content",void 0),(0,r._)([(0,a.Cb)()],yr.prototype,"collapsed",void 0),(0,r._)([(0,a.Cb)()],yr.prototype,"collapseEnabled",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"currentAlignment",null),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"currentDockPosition",null),(0,r._)([(0,a.Cb)()],yr.prototype,"dockOptions",null),(0,r._)([(0,a.Cb)()],yr.prototype,"dockEnabled",void 0),(0,r._)([(0,b.B)("viewModel.featureCount")],yr.prototype,"featureCount",void 0),(0,r._)([(0,a.Cb)()],yr.prototype,"featureMenuOpen",void 0),(0,r._)([(0,b.B)("viewModel.features")],yr.prototype,"features",void 0),(0,r._)([(0,b.B)("viewModel.goToOverride")],yr.prototype,"goToOverride",void 0),(0,r._)([(0,a.Cb)()],yr.prototype,"headingLevel",void 0),(0,r._)([(0,b.B)("viewModel.highlightEnabled")],yr.prototype,"highlightEnabled",void 0),(0,r._)([(0,b.B)("viewModel.location")],yr.prototype,"location",void 0),(0,r._)([(0,a.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],yr.prototype,"label",void 0),(0,r._)([(0,a.Cb)()],yr.prototype,"maxInlineActions",void 0),(0,r._)([(0,a.Cb)(),(0,we.H)("esri/widgets/Popup/t9n/Popup")],yr.prototype,"messages",void 0),(0,r._)([(0,a.Cb)(),(0,we.H)("esri/t9n/common")],yr.prototype,"messagesCommon",void 0),(0,r._)([(0,b.B)("viewModel.promises")],yr.prototype,"promises",void 0),(0,r._)([(0,b.B)("viewModel.selectedFeature")],yr.prototype,"selectedFeature",void 0),(0,r._)([(0,b.B)("viewModel.selectedFeatureIndex")],yr.prototype,"selectedFeatureIndex",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],yr.prototype,"selectedFeatureWidget",null),(0,r._)([(0,a.Cb)()],yr.prototype,"spinnerEnabled",void 0),(0,r._)([(0,b.B)("viewModel.title")],yr.prototype,"title",void 0),(0,r._)([(0,b.B)("viewModel.updateLocationEnabled")],yr.prototype,"updateLocationEnabled",void 0),(0,r._)([(0,b.B)("viewModel.view")],yr.prototype,"view",void 0),(0,r._)([(0,a.Cb)({type:Qi}),(0,tr.s)(["triggerAction","trigger-action"])],yr.prototype,"viewModel",void 0),(0,r._)([(0,b.B)("viewModel.visible")],yr.prototype,"visible",void 0),(0,r._)([(0,a.Cb)()],yr.prototype,"visibleElements",void 0),(0,r._)([(0,w.p)("visibleElements")],yr.prototype,"castVisibleElements",null),(0,r._)([(0,er.h)()],yr.prototype,"_close",null),(0,r._)([(0,er.h)()],yr.prototype,"_toggleDockEnabled",null),(0,r._)([(0,er.h)()],yr.prototype,"_toggleFeatureMenu",null),(0,r._)([(0,er.h)()],yr.prototype,"_toggleActionsMenu",null),(0,r._)([(0,er.h)()],yr.prototype,"_triggerAction",null),(0,r._)([(0,er.h)()],yr.prototype,"_selectFeature",null),(0,r._)([(0,er.h)()],yr.prototype,"_next",null),(0,r._)([(0,er.h)()],yr.prototype,"_previous",null),yr=(0,r._)([(0,l.j)(fr)],yr);const _r=yr,vr=[0,0];function br(e){e&&((0,s.cS)(e),e.parentNode&&e.parentNode.removeChild(e))}const wr=750,xr=e=>{let t=class extends e{constructor(...e){super(...e),this._freqInfo={freq:16,time:wr},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([(0,n.YP)((()=>this.cursor),(e=>{const{surface:t}=this;t&&t.setAttribute("data-cursor",e)})),(0,n.YP)((()=>this.interacting),(e=>{const{surface:t}=this;t&&t.setAttribute("data-interacting",e.toString())}))])}initialize(){this.handles.add((0,n.YP)((()=>this.ui),((e,t)=>this._handleUIChange(e,t)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(e){const t=this._get("container");if(t===e)return;const i="dom-size";if(this.handles.remove(i),this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),br(this.root),this._set("root",null),(0,s.YD)(this.userContent,t),br(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");const t=document.createElement("div");t.className="esri-view-user-storage",(0,s.YD)(e,t),e.appendChild(t),this._set("userContent",t);const r=document.createElement("div");r.className="esri-view-root",e.insertBefore(r,e.firstChild),this._set("root",r);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,r.appendChild(a),this._set("surface",a);const l=new f;r.appendChild(l.surface),this._set("overlay",l),(0,n.YP)((()=>l.needsRender),(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=(0,o.A)({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add((0,n.YP)((()=>this.size),(e=>{const[t,i]=e,r="esri-view-surface--inset-outline";t>=document.body.clientWidth||i>=document.body.clientHeight?a.classList.add(r):a.classList.remove(r)}),n.nn),i),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get popup(){return this._get("popup")||new _r({view:this})}set popup(e){const t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(e,t,i){const r=this.position;return e-=r[0],t-=r[1],i?(i[0]=e,i[1]=t):i=[e,t],i}containerToPage(e,t,i){const r=this.position;return e+=r[0],t+=r[1],i?(i[0]=e,i[1]=t):i=[e,t],i}_handleUIChange(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}_wireUI(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([(0,n.YP)((()=>this.root),(t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null}),n.nn),(0,n.YP)((()=>this.popup),((t,i)=>{const r="popup";i&&e.remove(i,r),t&&(t.view=e.view,e.add(t,{key:r,position:"manual"}))}),n.nn)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=16,e.time=wr,this.handles.add([(()=>{const t=()=>{e.freq=16,e.time=wr};return window.addEventListener("resize",t),{remove(){window.removeEventListener("resize",t)}}})(),(0,o.A)({prepare:e=>{const t=this._measure(),i=this._freqInfo;if(i.time+=e.deltaTime,t&&(i.freq=16,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const r=this._position();i.freq=r||t?16:Math.min(wr,2*i.freq),!t&&i.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,i=e?e.clientHeight:0;if(0===t||0===i)return this.suspended||this._set("suspended",!0),!1;const r=this.width,s=this.height;return t===r&&i===s?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:r,oldHeight:s,width:t,height:i}),!0)}_position(){const e=this.container,t=this.position,i=function(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return vr[0]=i.left+t.pageXOffset,vr[1]=i.top+t.pageYOffset,vr}(e);return!(t&&i[0]===t[0]&&i[1]===t[1]||(this._set("position",[i[0],i[1]]),0))}forceDOMReadyCycle(){}};return(0,r._)([(0,a.Cb)({value:null,cast:e=>(0,s.L7)(e)})],t.prototype,"container",null),(0,r._)([(0,a.Cb)({readOnly:!0})],t.prototype,"focused",null),(0,r._)([(0,a.Cb)({readOnly:!0})],t.prototype,"height",void 0),(0,r._)([(0,a.Cb)({type:_r})],t.prototype,"popup",null),(0,r._)([(0,a.Cb)({type:f})],t.prototype,"overlay",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],t.prototype,"position",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],t.prototype,"resizing",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],t.prototype,"root",void 0),(0,r._)([(0,a.Cb)({value:null,readOnly:!0})],t.prototype,"size",null),(0,r._)([(0,a.Cb)({readOnly:!0})],t.prototype,"surface",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],t.prototype,"suspended",void 0),(0,r._)([(0,a.Cb)()],t.prototype,"ui",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],t.prototype,"userContent",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],t.prototype,"width",void 0),(0,r._)([(0,a.Cb)()],t.prototype,"widthBreakpoint",void 0),t=(0,r._)([(0,l.j)("esri.views.DOMContainer")],t),t};function Cr(e){return e&&"focus"in e}},65684:(e,t,i)=>{"use strict";var r;function s(e){return"global"===e?r.Global:r.Local}function n(e){return e===r.Global?"global":"local"}i.d(t,{JY:()=>r,M7:()=>n,wg:()=>s}),function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"}(r||(r={}))},51986:(e,t,i)=>{"use strict";var r;i.d(t,{t:()=>r}),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(r||(r={}))},41649:(e,t,i)=>{"use strict";i.d(t,{a:()=>o});var r=i(13802);class s{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const e of this.keyModifiers)if(!t.has(e))return!1;return!0}}const n=r.Z.getLogger("esri.views.input.InputHandler");class o{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?n.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let r;"function"==typeof t?(i=t,r=[]):r=t||[];const n="string"==typeof e?new s(e,r):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},l=e=>{const t=this._incoming[e.match.eventType];if(t){const i=t.indexOf(e);t.splice(i,1),o(),this._manager&&this._manager.updateDependencies()}},c=new a(n,i,{onPause:l,onRemove:l,onResume:e=>{const t=this._incoming[e.match.eventType];t&&!t.includes(e)&&(t.push(e),o(),this._manager&&this._manager.updateDependencies())}});let u=this._incoming[n.eventType];return u||(u=[],this._incoming[n.eventType]=u),u.push(c),o(),this._manager&&this._manager.updateDependencies(),c}registerOutgoing(e){if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new l(e,{onEmit:(e,t,i,r)=>{this._manager.emit(e.eventType,t,i,r)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):n.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const i of t)if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}class a{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class l{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}},15331:(e,t,i)=>{"use strict";i.d(t,{$:()=>m,f:()=>v});var r=i(36663),s=i(53443),n=i(13802),o=i(61681),a=i(58713),l=i(81977),c=(i(7753),i(39994),i(7283),i(40266)),u=i(90139),h=i(79622),d=i(41649);class p extends d.a{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse",e.data.x,e.data.y)}))}_setValue(e,t,i){e===this._value&&this._x===t&&this._y===i||(this._value=e,this._x=t,this._y=i,this._onChange(e,t,i))}}const f=n.Z.getLogger("esri.views.input.InputManager");let m=class extends s.Z{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=h.CK,this.latestPointerType="mouse",this._propertiesPool=new u.L({latestPointerLocation:b},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}installHandlers(e,t,i=v.INTERNAL){if(this._nameToGroup[e])return void f.error("There is already an InputHandler group registered under the name `"+e+"`");if(0===t.length)return void f.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=r;for(let e=r.handlers.length-1;e>=0;e--){const t=r.handlers[e];this._handlers.push(t),t.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(e,i,r,s,n)=>{this._emitInputEvent(t.priorityIndex+1,e,i,r,n,s)},setPointerCapture:(e,i)=>{this._setPointerCapture(r,t,e,i)},setEventCallback:e=>{t.eventCallback=e},setUninstallCallback:e=>{t.uninstallCallback=e},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):f.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let e=this._handlers.length-1;e>=0;e--){const t=this._handlers[e];t.priorityIndex=e,this._handlersPriority.push(t)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s)for(const t of r.handler.outgoingEventTypes)if(e.has(t)){s=!0;break}if(s)for(const i of r.handler.incomingEventMatches){e.add(i.eventType);for(const e of i.keyModifiers)(0,h.wj)(e)||t.add(e)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);const r=this._get("latestPointerLocation");if((0,o.Wi)(r)||r.x!==t||r.y!==i){const e=this._propertiesPool.get("latestPointerLocation");e.x=t,e.y=i,this._set("latestPointerLocation",e)}}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const e=new Set;this._activeKeyModifiers.forEach((t=>{e.add(t)})),this._activeKeyModifiers=e,i=!0}},s=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(r(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(r(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const i=t.key;this._keyModifiers.has(i)&&s(i,"key-down"===e)}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new p(((e,t,i)=>this._setLatestPointer(e,t,i))),this.installHandlers("input-manager-logic",[this._latestPointerHandler],v.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,v.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),1===n.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),0===n.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const o=void 0!==r?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=void 0!==s&&s,l={event:new g(t,i,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new a.Z,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(null==r||!this._stoppedPropagationEventIds.has(r))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){null!=r&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new a.Z;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(i.eventType!==e.eventType)continue;const t=i.keyModifiers.filter((t=>e.keyModifiers.includes(t)));if(t.length===i.keyModifiers.length!=(t.length===e.keyModifiers.length))return i.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(i,t[e])>=0;)e++;t.splice(e,0,i)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,i)=>{e((()=>{this._onEventReceived(t,i)}))},disablePointerCapture:e}}};(0,r._)([(0,l.Cb)({readOnly:!0})],m.prototype,"hasPendingInputs",null),(0,r._)([(0,l.Cb)()],m.prototype,"eventSource",void 0),(0,r._)([(0,l.Cb)()],m.prototype,"recognizers",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],m.prototype,"latestPointerType",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],m.prototype,"latestPointerLocation",void 0),m=(0,r._)([(0,c.j)("esri.views.input.InputManager")],m);class g{constructor(e,t,i,r,s){this.type=e,this.data=t,this.timestamp=i,this.modifiers=r,this.cancelable=s,this._propagationState=y.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=y.STOPPED}shouldStopPropagation(){return 0!=(this._propagationState&y.STOPPED)}async(e){this._propagationState|=y.PAUSED;const t=(e,t)=>{this._propagationState&=~y.PAUSED;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(this._propagationState&y.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}var y,_;(_=y||(y={}))[_.NONE=0]="NONE",_[_.STOPPED=1]="STOPPED",_[_.PAUSED=2]="PAUSED";const v={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class b{}},3846:(e,t,i)=>{"use strict";i.d(t,{CE:()=>u,uS:()=>a}),i(39994);var r=i(19431),s=i(95550),n=i(41649),o=i(15331);i(51986);const a=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],l={};function c(e){return!!l[e]}a.forEach((e=>{l[e]=!0}));class u{constructor(e){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((({handler:e,priority:t},i)=>this.inputManager.installHandlers(i,[e],t)))}disconnect(){this.inputManager&&this.handlers.forEach(((e,t)=>this.inputManager.uninstallHandlers(t))),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(e,t,i,r){const s=Array.isArray(e)?e:e.split(",");if(!function(e){for(const t of e)if(!c(t))return!1;return!0}(s))return s.some(c)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let n,a;Array.isArray(t)?a=t:(n=t,a=[]),"function"==typeof i?n=i:r=i,r=null!=r?r:o.f.DEFAULT;const l=this._createUniqueGroupName(),u=new h(this.view,s,a,n);this.handlers.set(l,{handler:u,priority:r});for(const e of s){const t=this.handlerCounts.get(e)||0;this.handlerCounts.set(e,t+1)}return this.inputManager&&this.inputManager.installHandlers(l,[u],r),{remove:()=>this._removeHandler(l,s)}}hasHandler(e){return!!this.handlerCounts.get(e)}_removeHandler(e,t){if(this.handlers.has(e)){this.handlers.delete(e);for(const e of t){const t=this.handlerCounts.get(e);void 0===t?console.error("Trying to remove handler for event that has no handlers registered: ",e):1===t?this.handlerCounts.delete(e):this.handlerCounts.set(e,t-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class h extends n.a{constructor(e,t,i,r){super(!0),this.view=e;for(const e of t)switch(e){case"click":this.registerIncoming("click",i,(e=>r(this._wrapClick(e))));break;case"double-click":this.registerIncoming("double-click",i,(e=>r(this._wrapDoubleClick(e))));break;case"immediate-click":this.registerIncoming("immediate-click",i,(e=>r(this._wrapImmediateClick(e))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,(e=>r(this._wrapImmediateDoubleClick(e))));break;case"hold":this.registerIncoming("hold",i,(e=>r(this._wrapHold(e))));break;case"drag":this.registerIncoming("drag",i,(e=>{const t=this._wrapDrag(e);t&&r(t)}));break;case"key-down":this.registerIncoming("key-down",i,(e=>r(this._wrapKeyDown(e))));break;case"key-up":this.registerIncoming("key-up",i,(e=>r(this._wrapKeyUp(e))));break;case"pointer-down":this.registerIncoming("pointer-down",i,(e=>r(this._wrapPointer(e,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",i,(e=>r(this._wrapPointer(e,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",i,(e=>r(this._wrapPointer(e,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,(e=>r(this._wrapPointerDrag(e))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,(e=>r(this._wrapMouseWheel(e))));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,(e=>r(this._wrapPointer(e,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,(e=>r(this._wrapPointer(e,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",i,(e=>{r(this._wrapGamepad(e))}));break;case"focus":this.registerIncoming("focus",i,(e=>{r(this._wrapFocus(e))}));break;case"blur":this.registerIncoming("blur",i,(e=>{r(this._wrapBlur(e))}))}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:t,button:i,buttons:r,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:t,button:i,buttons:r,x:n,y:o,native:a,timestamp:u,screenPoint:(0,s.vW)(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:n,native:o,eventId:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"double-click",pointerType:t,button:i,buttons:r,x:s,y:n,native:o,timestamp:c,mapPoint:this._getMapPoint(s,n),eventId:a,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:n,native:o,eventId:a}=e.data,l=o.pointerId,{cancelable:c,timestamp:u}=e;return{type:"immediate-click",pointerId:l,pointerType:t,button:i,buttons:r,x:s,y:n,native:o,timestamp:u,mapPoint:this._getMapPoint(s,n),eventId:a,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:n,native:o,eventId:a}=e.data,l=o.pointerId,{cancelable:c,timestamp:u}=e;return{type:"immediate-double-click",pointerId:l,pointerType:t,button:i,buttons:r,x:s,y:n,native:o,timestamp:u,mapPoint:this._getMapPoint(s,n),eventId:a,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:t,button:i,buttons:r,x:s,y:n,native:o}=e.data,{cancelable:a,timestamp:l}=e;return{type:"hold",pointerType:t,button:i,buttons:r,x:s,y:n,native:o,timestamp:l,mapPoint:this._getMapPoint(s,n),cancelable:a,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,t){return this.view.toMap((0,s.vW)(e,t),{exclude:[]})}_wrapDrag(e){const t=e.data,{x:i,y:s}=t.center,{action:n,pointerType:o,button:a}=t;if("start"===n&&(this.latestDragStart=t),!this.latestDragStart)return;const l=t.pointer.native,c=t.buttons,{cancelable:u,timestamp:h}=e,d={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===n&&(this.latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:d,pointerType:o,button:a,buttons:c,radius:t.radius,angle:(0,r.BV)(t.angle),native:l,timestamp:h,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:t,repeat:i,native:r}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-down",key:t,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:t,native:i}=e.data,{cancelable:r,timestamp:s}=e;return{type:"key-up",key:t,native:i,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,t){const{x:i,y:r,button:s,buttons:n,native:o,eventId:a}=e.data,l=o.pointerId,c=o.pointerType,{cancelable:u,timestamp:h}=e;return{type:t,x:i,y:r,pointerId:l,pointerType:c,button:s,buttons:n,native:o,timestamp:h,eventId:a,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:t,y:i,buttons:r,native:s,eventId:n}=e.data.currentEvent,{button:o}=e.data.startEvent,a=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,c=e.data.action,u={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:h,timestamp:d}=e;return{type:"pointer-drag",x:t,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:c,origin:u,native:s,timestamp:d,eventId:n,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:t,data:i,timestamp:r}=e,{x:s,y:n,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:o,native:a,timestamp:r,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:t,state:i,device:r}=e.data,{cancelable:s,timestamp:n}=e,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:n,action:t,buttons:o,axes:a,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}}},79622:(e,t,i)=>{"use strict";i.d(t,{CK:()=>s,kK:()=>o,wj:()=>a});var r=i(49546);const s=(0,i(39994).Z)("mac")?"Meta":"Ctrl",n={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)n[e]=String.fromCharCode(e);for(let e=1;e<25;e++)n[111+e]=`F${e}`;for(let e=65;e<91;e++)n[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function o(e){if(void 0!==e.key)return(0,r.kK)(e);const t=n[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function a(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}},91258:(e,t,i)=>{"use strict";var r,s,n;i.d(t,{Q9:()=>s,bH:()=>r,jg:()=>n}),function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(s||(s={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(n||(n={}))},22167:(e,t,i)=>{"use strict";i.d(t,{G5:()=>P,T8:()=>v,ZM:()=>C,sq:()=>I,z4:()=>_});var r=i(36663),s=i(53443),n=i(44584),o=i(13802),a=i(61681),l=i(31168),c=i(17135),u=i(78668),h=i(76868),d=i(12928),p=i(81977),f=(i(7753),i(39994),i(7283),i(40266)),m=i(253),g=i(16407);const y=o.Z.getLogger("esri.views.support.Scheduler");function _(){return new O.Scheduler}var v,b;(b=v||(v={})).RESOURCE_CONTROLLER="schedule",b.SLIDE="slide",b.STREAM_DATA_LOADER="stream loader",b.ELEVATION_QUERY="elevation query",b.TERRAIN_SURFACE="terrain",b.SURFACE_GEOMETRY_UPDATES="surface geometry updates",b.GRAPHICS_CORE="Graphics3D",b.I3S_CONTROLLER="I3S",b.POINT_CLOUD_LAYER="point cloud",b.FEATURE_TILE_FETCHER="feature fetcher",b.OVERLAY="overlay",b.STAGE="stage",b.GRAPHICS_DECONFLICTOR="graphics deconflictor",b.FILTER_VISIBILITY="Graphics3D filter visibility",b.SCALE_VISIBILITY="Graphics3D scale visibility",b.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",b.POINT_OF_INTEREST_FREQUENT="POI frequent",b.POINT_OF_INTEREST_INFREQUENT="POI infrequent",b.LABELER="labeler",b.FEATURE_QUERY_ENGINE="feature query",b.FEATURE_TILE_TREE="feature tile tree",b.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",b.ELEVATION_ALIGNMENT="elevation alignment",b.TEXT_TEXTURE_ATLAS="text texture atlas",b.TEXTURE_UNLOAD="texture unload",b.LINE_OF_SIGHT_TOOL="line of sight tool",b.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",b.ELEVATION_PROFILE="elevation profile",b.SNAPPING="snapping",b.SHADOW_ACCUMULATOR="shadow accumulator",b.CLOUDS_GENERATOR="cloud generator",b[b.TEST_PRIO=1]="TEST_PRIO";const w=new Map([[v.RESOURCE_CONTROLLER,0],[v.SLIDE,0],[v.STREAM_DATA_LOADER,0],[v.ELEVATION_QUERY,0],[v.TERRAIN_SURFACE,1],[v.SURFACE_GEOMETRY_UPDATES,1],[v.GRAPHICS_CORE,2],[v.I3S_CONTROLLER,2],[v.POINT_CLOUD_LAYER,2],[v.FEATURE_TILE_FETCHER,2],[v.OVERLAY,4],[v.STAGE,4],[v.GRAPHICS_DECONFLICTOR,4],[v.FILTER_VISIBILITY,4],[v.SCALE_VISIBILITY,4],[v.FRUSTUM_VISIBILITY,4],[v.POINT_OF_INTEREST_FREQUENT,6],[v.POINT_OF_INTEREST_INFREQUENT,30],[v.LABELER,8],[v.FEATURE_QUERY_ENGINE,8],[v.FEATURE_TILE_TREE,16],[v.FEATURE_TILE_TREE_ACTIVE,0],[v.ELEVATION_ALIGNMENT,12],[v.TEXT_TEXTURE_ATLAS,12],[v.CLOUDS_GENERATOR,12],[v.TEXTURE_UNLOAD,12],[v.LINE_OF_SIGHT_TOOL,16],[v.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[v.SNAPPING,0],[v.SHADOW_ACCUMULATOR,30]]);function x(e){return w.has(e)?w.get(e):"number"==typeof e?e:1}var C;!function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(C||(C={}));const T=(0,d.HA)(6.5),S=(0,d.HA)(1),E=(0,d.HA)(30),A=(0,d.HA)(1e3/30),M=(0,d.HA)(100);var O,R;!function(e){let t=class extends s.Z{constructor(){super(),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new l.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new o,this._state=C.INTERACTING,this._tasks=new c.Z,this._runQueue=new c.Z,this._load=0,this._idleStateCallbacks=new c.Z,this._idleUpdatesStartFired=!1,this._maxReschedule=L,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,h.YP)((()=>g.Z.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),h.nn);for(const e of Object.keys(v))this.performanceInfo.tasks.set(v[e],new l.Z(v[e]));let e;const t=this;this._test={get state(){return(0,a.Pt)(e,t._state)},set state(t){e=t},FRAME_SAFETY_BUDGET:T,INTERACTING_BUDGET:A,IDLE_BUDGET:M,get availableBudget(){return t._budget.budget},usedBudget:0,getBudget:()=>t._budget,setBudget:e=>t._budget=e,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,a.hw)(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=L,this._schedule(),this.frame()))})))}registerTask(e,t){const r=x(e),s=new i(this,e,t,r);return this._tasks.push(s),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new l.Z(e)),s}registerIdleStateCallbacks(e,t){const i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),this.state===C.IDLE&&this._idleUpdatesStartFired&&i.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(i),set idleBegin(e){r._idleUpdatesStartFired&&(i.idleEnd(),r._state===C.IDLE&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==C.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return(0,a.Wi)(this._test.state)?this._state:this._test.state}updateBudget(e){this._test.usedBudget=0;let t=T,i=e.frameDuration,r=S;switch(this.state){case C.IDLE:t=(0,d.HA)(0),i=(0,d.HA)(Math.max(M,e.frameDuration)),r=E;break;case C.INTERACTING:i=(0,d.HA)(Math.max(A,e.frameDuration));case C.ANIMATING:}return i=(0,d.HA)(i-e.elapsedFrameTime-t),this.state!==C.IDLE&&i<S&&!this._forceTask?(this._forceTask=!0,!1):(i=(0,d.HA)(Math.max(i,r)),this._budget.reset(i,this.state),this._maxReschedule=L,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case C.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case C.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset((0,d.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return R.SCHEDULED;let t=R.IDLE;return this._tasks.forAll((i=>{i.name===e&&i.needsUpdate&&(i.schedulePriority<=1?t=R.READY:t!==R.READY&&(t=R.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((i=>{i.name===e&&(t+=i.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,i)=>{t+=e>1?` ${e}x ${i}`:` ${i}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((i=>{i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&(e=!0,t=Math.max(t,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,this._runQueue.push(i)):--i.schedulePriority)})),!e)return this.updating=!1,!1;this._maxReschedule===L&&(this._maxReschedule=t),--this._maxReschedule}return this.updating=!0,!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const t=this._budget.now(),i=this._runQueue.pop();this._budget.resetProgress();try{i.task.runTask(this._budget)}catch(e){y.error(`Exception in task "${i.name}"`,e)}i.schedulePriority=i.basePriority;const r=this._budget.now()-t;if(i.runtime+=r,this._frameTaskTimes.set(i.priority,this._frameTaskTimes.get(i.priority)+r),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",i.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some((e=>e.needsUpdate)),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this.updating=this._tasks.some((e=>e.needsUpdate)),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(v))this._frameTaskTimes.set(v[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){return this._test}};(0,r._)([(0,p.Cb)()],t.prototype,"updating",void 0),t=(0,r._)([(0,f.j)("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends s.Z{constructor(e,t,i,r){super({}),this._scheduler=e,this.name=t,this._basePriority=r,this.runtime=0,this._queue=new m.b,this._handles=new n.Z,this.schedulePriority=this._basePriority,this.task=(0,a.pC)(i)?i:this._queue,this._handles.add((0,h.gx)((()=>this.task.running),(()=>e.activate())))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(P),this._scheduler.removeTask(this),this.schedule=I.schedule,this.reschedule=I.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){this.name=e;const t=x(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,i){return this._queue.push(e,t,i)}reschedule(e,t,i){return this._queue.unshift(e,t,i)}processQueue(e){this._queue.runTask(e)}};(0,r._)([(0,p.Cb)({constructOnly:!0})],i.prototype,"task",void 0),(0,r._)([(0,p.Cb)({readOnly:!0})],i.prototype,"updating",null),i=(0,r._)([(0,f.j)("esri.views.support.SchedulerTask")],i);class o{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=C.IDLE,this._didWork=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=o}(O||(O={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(R||(R={}));const P=(()=>{const e=new O.Budget;return e.enabled=!1,e})(),I=new class{remove(){}processQueue(){}schedule(e,t,i){try{if((0,u.Hc)(t)){const e=(0,u.zE)();return i?Promise.resolve(i(e)):Promise.reject(e)}return(0,u.gx)(e(P))}catch(e){return Promise.reject(e)}}reschedule(e,t,i){return this.schedule(e,t,i)}},L=Number.MAX_SAFE_INTEGER},16407:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(36663),s=i(53443),n=i(81977),o=(i(7753),i(39994),i(7283),i(40266));let a=class extends s.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,r._)([(0,n.Cb)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,r._)([(0,o.j)("esri.views.support.DebugFlags")],a);const l=new a},42780:(e,t,i)=>{"use strict";i.d(t,{Av:()=>a,_1:()=>n,lu:()=>l,rs:()=>o,tl:()=>s});var r=i(61681);function s(e){return e&&"function"==typeof e.highlight}function n(e){return e&&"function"==typeof e.maskOccludee}function o(e,t,i){return(0,r.Wi)(e)||e>i&&(0===t||e<t)}function a(e,t){return e>0||t>0}function l(e){const t=e.effectiveScaleRange;return{minScale:t?.minScale??0,maxScale:t?.maxScale??0}}},38114:(e,t,i)=>{"use strict";i.d(t,{Eu:()=>o,Rw:()=>l,Sj:()=>n,s6:()=>a,vT:()=>s}),i(39994);var r=i(95550);function s(e){return(0,r.vW)(e.x,e.y)}function n(e){return(0,r.s1)(e.x,e.y)}function o(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return(0,r.vW)(t.clientX-i.left,t.clientY-i.top)}function a(e,t){return t instanceof Event?o(e,t):s(t)}function l(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}},994:(e,t,i)=>{"use strict";i.d(t,{$3:()=>m,Jl:()=>p,TT:()=>f,cv:()=>a,r7:()=>d,uz:()=>o,v8:()=>l}),i(39994);var r=i(19431),s=i(61681);function n(e,t){const{format:i,quality:s,rotation:n,disableDecorations:o}=e||{},a=v(e,t.padding),l=function(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){null!=e.area.x&&(i.x=Math.floor(e.area.x)),null!=e.area.y&&(i.y=Math.floor(e.area.y));const r=null!=e.area.width?Math.floor(e.area.width):null,s=null!=e.area.height?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,null!=r&&null!=s)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(null==r&&null!=s){const e=Math.min(i.width,r);i.height=e/i.width*i.height,i.width=e}else if(null!=r&&null==s){const e=Math.min(i.height,s);i.width=e/i.height*i.width,i.height=e}}return function(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const e=Math.floor(s.width/o),t=s.height-e;return{x:s.x,y:Math.floor(s.y+t/2),width:s.width,height:e}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}(function(e,t){if(!t||null==t.width||null==t.height)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const t=Math.floor(e.height*i);return e.x-=(t-e.width)/2,e.width=t,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}(i,e),t)}(e,{width:t.width-a.left-a.right,height:t.height-a.top-a.bottom}),{width:c,height:u}=function(e,t){if(!e)return t;const i=e.width,r=e.height;if(null!=i&&null!=r)return{width:Math.floor(i),height:Math.floor(r)};if(null==i&&null==r)return t;const s=t.width/t.height;return null==r?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}(e,l),h=function(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return w}}(i),d=x[h];return{format:h,quality:(0,r.uZ)(null!=s?s:d,0,100),area:l,width:c,height:u,rotation:n,disableDecorations:!!o,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function o(e,t){const i=n(e,t),r=i.area,s=i.width/r.width,o=v(i,t.padding),a=o.left+o.right,l=o.top+o.bottom,c=t.width-a,u=t.height-l,h=Math.floor(c*s+a),d=Math.floor(u*s+l),p=e&&e.layers?e.layers:[],f=i.ignoreBackground,m=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:d,region:{x:Math.floor(r.x*s)+o.left,y:Math.floor(r.y*s)+o.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:p,disableDecorations:i.disableDecorations,ignoreBackground:f,ignorePadding:m}}function a(e,t,i){const{ctx:r,canvas:s}=c(e,i),n=r.getImageData(0,0,e.width,e.height),o=function(e,t){const i=b[t.format],r=t.quality/100;return e.toDataURL(i,r)}(s,t);return u(s),{dataUrl:o,data:n}}function l(e,t){const{ctx:i,canvas:r}=c(e,t),s=i.getImageData(0,0,e.width,e.height);return u(r),s}function c(e,t){const i=((0,s.Wi)(h)&&(h=document.createElement("canvas")),h);t.premultipliedAlpha&&function(e){const t=e.data,i=t.length;for(let e=0;e<i;e+=4){const i=t[e+3];if(255!==i&&i>0){const r=255/i;t[e+0]=t[e+0]*r,t[e+1]=t[e+1]*r,t[e+2]=t[e+2]*r}}}(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d");return r.putImageData(e,0,0),t.flipY&&function(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}(r),{ctx:r,canvas:i}}function u(e){e.width=0,e.height=0}let h=null;function d(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(_)try{return new ImageData(e,t)}catch(e){_=!1}return g(e,t,i)}function p(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(_)try{return new ImageData(e,t,i)}catch(e){_=!1}const s=g(t,i,r);return s.data.set(e,0),s}function f(e,t,i,r=0,s=0,n=e.width-r,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:u,data:h}=t,d=n/c,p=o/u,f=Math.ceil(d/2),m=Math.ceil(p/2),g=e.width;for(let e=0;e<u;e++)for(let t=0;t<c;t++){const n=4*(t+(a?u-e-1:e)*c);let o=0,y=0,_=0,v=0,b=0,w=0;const x=(e+.5)*p;for(let n=Math.floor(e*p);n<(e+1)*p;n++){const e=Math.abs(x-(n+.5))/m,a=(t+.5)*d,c=e*e;for(let e=Math.floor(t*d);e<(t+1)*d;e++){const t=Math.abs(a-(e+.5))/f,u=Math.sqrt(c+t*t);if(u>=1)continue;let h=2*u*u*u-3*u*u+1;const d=4*(r+e+(s+n)*g);w+=h*l[d+3],y+=h,!i&&l[d+3]<255&&(h=h*l[d+3]/255),_+=h*l[d],v+=h*l[d+1],b+=h*l[d+2],o+=h}}h[n]=_/o,h[n+1]=v/o,h[n+2]=b/o,h[n+3]=w/y}return t}function m(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=e,a=v(e,i),l=a.left+a.right,c=a.top+a.bottom,u=r-l,h=s-c,d=Math.min(8,Math.min((2048-l)/u,(2048-c)/h));return d<1.5?e:{...e,framebufferWidth:Math.round(u*d)+l,framebufferHeight:Math.round(h*d)+c,pixelRatio:n*d,resample:{region:{x:Math.round((o.x-a.left)*d)+a.left,y:Math.round((o.y-a.top)*d)+a.top,width:Math.round(o.width*d),height:Math.round(o.height*d)},width:r,height:s}}}function g(e,t,i){return i||(y||(y=document.createElement("canvas"),y.width=1,y.height=1),i=y),i.getContext("2d").createImageData(e,t)}let y=null,_=!0;function v(e,t){return!t||e&&e.ignorePadding?C:t}const b={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},w="png",x={png:100,jpg:98,jpeg:98},C={top:0,right:0,bottom:0,left:0}},14029:(e,t,i)=>{"use strict";i.d(t,{D:()=>n});var r=i(52345),s=i(65684);function n(e,t){return null!=e&&(null==t||(t===s.JY.Local?!e.isGeographic||e.isWGS84||e.wkid===r.W.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===r.W.CGCS2000||e.wkid===r.W.GCSMARS2000||e.wkid===r.W.GCSMARS2000_SPHERE||e.wkid===r.W.GCSMOON2000))}},78951:(e,t,i)=>{"use strict";i.d(t,{f:()=>h});var r=i(7753),s=i(13802),n=i(61681),o=i(86098),a=i(6174),l=i(36172),c=i(91907);const u=s.Z.getLogger("esri.views.webgl.BufferObject");class h{constructor(e,t,i,r){this._context=e,this.bufferType=t,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(c._g.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,a.zu)(this._context.gl),r&&this.setData(r)}static createIndex(e,t,i){return new h(e,c.w0.ELEMENT_ARRAY_BUFFER,t,i)}static createVertex(e,t,i){return new h(e,c.w0.ARRAY_BUFFER,t,i)}static createUniform(e,t,i){if(e.type!==l.zO.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new h(e,c.w0.UNIFORM_BUFFER,t,i)}static createPixelPack(e,t=c.l1.STREAM_READ,i){if(e.type!==l.zO.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const r=new h(e,c.w0.PIXEL_PACK_BUFFER,t);return i&&r.setSize(i),r}static createPixelUnpack(e,t=c.l1.STREAM_DRAW,i){if(e.type!==l.zO.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new h(e,c.w0.PIXEL_UNPACK_BUFFER,t,i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===c.w0.ELEMENT_ARRAY_BUFFER?this._indexType===c.g.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===c.w0.ELEMENT_ARRAY_BUFFER||this.bufferType===c.w0.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(c._g.BufferObject,this),this._context=null):this._glName&&u.warn("Leaked WebGL buffer object")}setSize(e,t=null){if(e<=0&&u.error("Buffer size needs to be positive!"),this.bufferType===c.w0.ELEMENT_ARRAY_BUFFER&&(0,n.pC)(t))switch(this._indexType=t,t){case c.g.UNSIGNED_SHORT:e*=2;break;case c.g.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===c.w0.ELEMENT_ARRAY_BUFFER&&((0,o.Uc)(e)&&(t/=2,this._indexType=c.g.UNSIGNED_SHORT),(0,o.ZY)(e)&&(t/=4,this._indexType=c.g.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const r=this._context.gl;(0,n.pC)(t)?r.bufferData(this.bufferType,t,this.usage):r.bufferData(this.bufferType,e,this.usage),(0,a.zu)(r),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,t=0,i=0,r=e.byteLength){if(!e)return;(t<0||t>=this._size)&&u.error("offset is out of range!");let s=t,n=i,l=r,h=e.byteLength;this.bufferType===c.w0.ELEMENT_ARRAY_BUFFER&&((0,o.Uc)(e)?(h/=2,s*=2,n*=2,l*=2):(0,o.ZY)(e)&&(h/=4,s*=4,n*=4,l*=4)),void 0===r&&(r=h-1),i>=r&&u.error("end must be bigger than start!"),t+i-r>this._size&&u.error("An attempt to write beyond the end of the buffer!");const d=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const p=this._context.gl,f=ArrayBuffer.isView(e)?e.buffer:e,m=0===n&&l===e.byteLength?f:f.slice(n,l);p.bufferSubData(this.bufferType,s,m),(0,a.zu)(p),this._isVAOAware&&this._context.bindVAO(d)}setSubDataFromView(e,t,i,r){if(!e)return;(t<0||t>=this._size)&&u.error("offset is out of range!"),i>=r&&u.error("end must be bigger than start!"),t+i-r>this._size&&u.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;if(this._context.type===l.zO.WEBGL2)n.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,i,r-i);else{const s=0===i&&r===e.length?e:e.subarray(i,r);n.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,s)}(0,a.zu)(n),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,t=0,i,s){if(this._context.type!==l.zO.WEBGL2)return void u.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void u.error("Problem getting subdata: offset and length were less than zero!");const n=function(e){return(0,r.zG)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>e.byteLength)return void u.error("Problem getting subdata: offset and length exceeded destination size!");t+n*(s??0)>this.byteSize&&u.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,c.w0.COPY_READ_BUFFER),o.getBufferSubData(c.w0.COPY_READ_BUFFER,t,e,i,s),this._context.unbindBuffer(c.w0.COPY_READ_BUFFER)}async getSubDataAsync(e,t=0,i,r){this._context.type===l.zO.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,t,i,r)):u.error("Get buffer subdata is supported in WebGL2 only!")}}},18567:(e,t,i)=>{"use strict";i.d(t,{X:()=>p});var r=i(13802),s=i(61681),n=i(78951),o=i(6174),a=i(36172),l=i(91907),c=i(37165),u=i(43487),h=i(62486);const d=r.Z.getLogger("esri.views.webgl.FrameBufferObject");class p{constructor(e,t,i=null,r=null){if(this._context=e,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc={...t},e.instanceCounter.increment(l._g.FramebufferObject,this),(0,s.pC)(i)){Array.isArray(i)||(i=[i]);for(let e=0;e<i.length;++e){const t=i[e],r=l.VY.COLOR_ATTACHMENT0+e;let s;g(t)?(f(t)?(s=t.descriptor,this._colorAttachments.set(r,t)):(s=t,this._colorAttachments.set(r,new u.x(this._context,s))),y(s,this._desc)):(m(t)?(s=t.descriptor,this._colorAttachments.set(r,t)):(s=t,this._colorAttachments.set(r,new c.r(this._context,s))),_(s,this._desc)),this._validateColorAttachmentPoint(r)}}if((0,s.pC)(r)){let e,t;if(g(r))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),f(r)?(t=r.descriptor,this._depthStencilTexture=r):(t=r,this._depthStencilTexture=new u.x(this._context,t)),y(t,this._desc);else{m(r)?(t=r.descriptor,e=r):(t=r,e=new c.r(this._context,t));const i=this._desc.depthStencilTarget??l.OU.DEPTH_STENCIL_RENDER_BUFFER;i===l.OU.STENCIL_RENDER_BUFFER?this._stencilAttachment=e:i===l.OU.DEPTH_RENDER_BUFFER||i===l.OU.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=e:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),_(t,this._desc)}}}dispose(){if(!this._desc)return;const e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(l._g.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(l.VY.COLOR_ATTACHMENT0);return e&&f(e)?e:null}get colorAttachment(){return this._colorAttachments.get(l.VY.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce(((e,[t,i])=>e+(0,h.un)(i)),0)+(0,h.un)(this.depthStencilAttachment)}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&f(t)?t:null}attachColorTexture(e,t=l.VY.COLOR_ATTACHMENT0){e&&(this._validateColorAttachmentPoint(t),y(e.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,t)),this._colorAttachments.set(t,e))}detachColorTexture(e=l.VY.COLOR_ATTACHMENT0){const t=this._colorAttachments.get(e);if(f(t)){const i=t;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),i}}setColorTextureTarget(e,t=l.VY.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);f(i)&&this._framebufferTexture2D(i.glName,t,e)}attachDepthStencilTexture(e){if((0,s.Wi)(e))return;const t=e.descriptor;t.pixelFormat!==l.VI.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),t.dataType!==l.Br.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),y(t,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==l.OU.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=l.OU.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,l.Lu)),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,l.Lu)),this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if((0,s.Wi)(e))return;const t=e.descriptor;if(t.internalFormat!==l.Tg.DEPTH_STENCIL&&t.internalFormat!==l.Tg.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),_(t,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=t.internalFormat===l.Tg.DEPTH_STENCIL?l.OU.DEPTH_STENCIL_RENDER_BUFFER:l.OU.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl,i=this._desc.depthStencilTarget===l.OU.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(l.qi.FRAMEBUFFER,i,t.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);const t=this._desc.depthStencilTarget===l.OU.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(l.qi.FRAMEBUFFER,t,e.RENDERBUFFER,null)}return this._depthAttachment=null,t}detachAll(){this._colorAttachments.forEach(((e,t)=>this._detachColorAttachment(t))),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(e,t,i,r,s,n,o){(e<0||t<0||s<0||n<0)&&console.error("Offsets cannot be negative!"),(i<=0||r<=0)&&console.error("Copy width and height must be greater than zero!");const a=this._desc,c=o.descriptor;o.descriptor.target!==l.No.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(e+i>a.width||t+r>a.height||s+i>c.width||n+r>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,d=h.bindTexture(o,u.x.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(u.x.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(l.No.TEXTURE_2D,0,s,n,e,t,i,r),h.bindTexture(d,u.x.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,t,i,r,s,n,o){(i<=0||r<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,i,r,s,n,o)}async readPixelsAsync(e,t,i,r,s,c,u){if(this._context.type!==a.zO.WEBGL2)return(0,o.hZ)()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,t,i,r,s,c,u);const h=this._context.gl,d=n.f.createPixelPack(this._context,l.l1.STREAM_READ,u.byteLength);this._context.bindBuffer(d),this._context.bindFramebuffer(this),h.readPixels(e,t,i,r,s,c,0),this._context.unbindBuffer(l.w0.PIXEL_PACK_BUFFER),await d.getSubDataAsync(u),d.dispose()}resize(e,t){const i=this._desc;if(i.width!==e||i.height!==t){if(!this._initialized)return i.width=e,i.height=t,this._colorAttachments.forEach((i=>{i&&i.resize(e,t)})),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,t));i.width=e,i.height=t,this._colorAttachments.forEach((i=>{i&&i.resize(e,t)})),null!=this._depthStencilTexture?this._depthStencilTexture.resize(e,t):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,t),this._stencilAttachment&&this._stencilAttachment.resize(e,t)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(e=l.qi.FRAMEBUFFER){const t=this._context.gl;if(this._initialized)return void t.bindFramebuffer(e,this.glName);this._glName&&t.deleteFramebuffer(this._glName);const i=this._context,r=t.createFramebuffer(),s=this._desc,n=s.colorTarget??l.Lm.RENDER_BUFFER,a=s.width??1,h=s.height??1;if(t.bindFramebuffer(e,r),0===this._colorAttachments.size)if(n===l.Lm.TEXTURE||n===l.Lm.CUBEMAP)this._colorAttachments.set(l.VY.COLOR_ATTACHMENT0,function(e,t,i){return new u.x(e,{target:i,pixelFormat:l.VI.RGBA,dataType:l.Br.UNSIGNED_BYTE,samplingMode:l.cw.NEAREST,wrapMode:l.e8.CLAMP_TO_EDGE,width:t.width,height:t.height})}(i,s,this.descriptor.colorTarget===l.Lm.CUBEMAP?l.No.TEXTURE_CUBE_MAP:l.No.TEXTURE_2D));else{const e=new c.r(i,{internalFormat:l.lP.RGBA4,width:a,height:h});this._colorAttachments.set(l.VY.COLOR_ATTACHMENT0,e)}this._colorAttachments.forEach(((i,r)=>{i&&(f(i)?this._framebufferTexture2D(i.glName,r,v(i),e):t.framebufferRenderbuffer(e,r,t.RENDERBUFFER,i.glName))}));const d=s.depthStencilTarget??l.OU.NONE;switch(d){case l.OU.DEPTH_RENDER_BUFFER:case l.OU.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new c.r(i,{internalFormat:s.depthStencilTarget===l.OU.DEPTH_RENDER_BUFFER?l.Tg.DEPTH_COMPONENT16:l.Tg.DEPTH_STENCIL,width:a,height:h}));const r=d===l.OU.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(e,r,t.RENDERBUFFER,this._depthAttachment.glName);break}case l.OU.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new c.r(i,{internalFormat:l.Tg.STENCIL_INDEX8,width:a,height:h})),t.framebufferRenderbuffer(e,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this._stencilAttachment.glName);break;case l.OU.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){i.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const e={target:l.No.TEXTURE_2D,pixelFormat:l.VI.DEPTH_STENCIL,dataType:l.Br.UNSIGNED_INT_24_8,samplingMode:l.cw.NEAREST,wrapMode:l.e8.CLAMP_TO_EDGE,width:a,height:h};this._depthStencilTexture=new u.x(i,e)}this._framebufferTexture2D(this._depthStencilTexture.glName,t.DEPTH_STENCIL_ATTACHMENT,v(this._depthStencilTexture),e)}(0,o.CG)()&&t.checkFramebufferStatus(e)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,t=l.VY.COLOR_ATTACHMENT0,i=l.No.TEXTURE_2D,r=l.qi.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(r,t,i,e,s)}_detachColorAttachment(e){(0,o.hZ)()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const t=this._context.gl,i=this._colorAttachments.get(e);return f(i)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)):this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(l.qi.FRAMEBUFFER,e,t.RENDERBUFFER,null)),this._colorAttachments.delete(e),i}_disposeColorAttachments(){this._colorAttachments.forEach(((e,t)=>{this._detachColorAttachment(t),e.dispose()})),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const t=this._desc.depthStencilTarget===l.OU.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(l.qi.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(l.qi.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(e){if(-1===p._MAX_COLOR_ATTACHMENTS){const e=this._context.capabilities.drawBuffers;if(e){const t=this._context.gl;p._MAX_COLOR_ATTACHMENTS=t.getParameter(e.MAX_COLOR_ATTACHMENTS)}else p._MAX_COLOR_ATTACHMENTS=1}const t=e-l.VY.COLOR_ATTACHMENT0;t+1>p._MAX_COLOR_ATTACHMENTS&&d.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${p._MAX_COLOR_ATTACHMENTS} color attachments`)}}function f(e){return"type"in e&&"texture"===e.type}function m(e){return"type"in e&&"renderbuffer"===e.type}function g(e){return f(e)||"pixelFormat"in e}function y(e,t){e.target!==l.No.TEXTURE_2D&&e.target!==l.No.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function _(e,t){void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function v(e){return e.descriptor.target===l.No.TEXTURE_CUBE_MAP?l.No.TEXTURE_CUBE_MAP_POSITIVE_X:l.No.TEXTURE_2D}p._MAX_COLOR_ATTACHMENTS=-1},69609:(e,t,i)=>{"use strict";i.d(t,{$:()=>R});var r=i(7753),s=(i(39994),i(61681)),n=i(6174),o=i(36172),a=i(91907);const l=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var c,u={exports:{}};void 0!==(c=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])&&(u.exports=c);const h=u.exports;var d,p={exports:{}};void 0!==(d=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"])&&(p.exports=d);const f=p.exports;var m,g,y={exports:{}};m=y,void 0!==(g=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"])&&(m.exports=g);const _=y.exports;var v=999,b=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function w(e){return function(e){var t=function(){var e,t,i,r=0,s=0,n=v,o=[],a=[],l=1,c=0,u=0,d=!1,p=!1,m="";return function(e){return a=[],null!==e?y(e.replace?e.replace(/\r\n/g,"\n"):e):(o.length&&g(o.join("")),n=10,g("(eof)"),a)};function g(e){e.length&&a.push({type:b[n],data:e,position:u,line:l,column:c})}function y(t){var o;for(r=0,i=(m+=t).length;e=m[r],r<i;){switch(o=r,n){case 0:r=T();break;case 1:case 2:r=C();break;case 3:r=S();break;case 4:r=M();break;case 11:r=A();break;case 5:r=O();break;case 9999:r=R();break;case 9:r=x();break;case v:r=w()}o!==r&&("\n"===m[o]?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function w(){return o=o.length?[]:o,"/"===t&&"*"===e?(u=s+r-1,n=0,t=e,r+1):"/"===t&&"/"===e?(u=s+r-1,n=1,t=e,r+1):"#"===e?(n=2,u=s+r,r):/\s/.test(e)?(n=9,u=s+r,r):(d=/\d/.test(e),p=/[^\w_]/.test(e),u=s+r,n=d?4:p?3:9999,r)}function x(){return/[^\s]/g.test(e)?(g(o.join("")),n=v,r):(o.push(e),t=e,r+1)}function C(){return"\r"!==e&&"\n"!==e||"\\"===t?(o.push(e),t=e,r+1):(g(o.join("")),n=v,r)}function T(){return"/"===e&&"*"===t?(o.push(e),g(o.join("")),n=v,r+1):(o.push(e),t=e,r+1)}function S(){if("."===t&&/\d/.test(e))return n=5,r;if("/"===t&&"*"===e)return n=0,r;if("/"===t&&"/"===e)return n=1,r;if("."===e&&o.length){for(;E(o););return n=5,r}if(";"===e||")"===e||"("===e){if(o.length)for(;E(o););return g(e),n=v,r+1}var i=2===o.length&&"="!==e;if(/[\w_\d\s]/.test(e)||i){for(;E(o););return n=v,r}return o.push(e),t=e,r+1}function E(e){for(var t,i,r=0;;){if(t=f.indexOf(e.slice(0,e.length+r).join("")),i=f[t],-1===t){if(r--+e.length>0)continue;i=e.slice(0,1).join("")}return g(i),u+=i.length,(o=o.slice(i.length)).length}}function A(){return/[^a-fA-F0-9]/.test(e)?(g(o.join("")),n=v,r):(o.push(e),t=e,r+1)}function M(){return"."===e||/[eE]/.test(e)?(o.push(e),n=5,t=e,r+1):"x"===e&&1===o.length&&"0"===o[0]?(n=11,o.push(e),t=e,r+1):/[^\d]/.test(e)?(g(o.join("")),n=v,r):(o.push(e),t=e,r+1)}function O(){return"f"===e&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(g(o.join("")),n=v,r):(o.push(e),t=e,r+1)}function R(){if(/[^\d\w_]/.test(e)){var i=o.join("");return n=h.indexOf(i)>-1?8:_.indexOf(i)>-1?7:6,g(o.join("")),n=v,r}return o.push(e),t=e,r+1}}(),i=[];return(i=i.concat(t(e))).concat(t(null))}(e)}const x=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function C(e,t){for(let i=t-1;i>=0;i--){const t=e[i];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function T(e,t,i,r){r=r||i;for(const s of e)if("ident"===s.type&&s.data===i)return r in t?t[r]++:t[r]=0,T(e,t,r+"_"+t[r],r);return i}function S(e,t,i="afterVersion"){function r(e,t){for(let i=t;i<e.length;i++){const t=e[i];if("operator"===t.type&&";"===t.data)return i}return null}const s={data:"\n",type:"whitespace"},n=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let o=function(e){let t=-1,s=0,n=-1;for(let o=0;o<e.length;o++){const a=e[o];if("preprocessor"===a.type&&(a.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++s:a.data.match(/\#endif\s*.*/)&&--s),"afterVersion"!==i&&"afterPrecision"!==i||"preprocessor"===a.type&&/^#version/.test(a.data)&&(n=Math.max(n,o)),"afterPrecision"===i&&"keyword"===a.type&&"precision"===a.data){const t=r(e,o);if(null===t)throw new Error("precision statement not followed by any semicolons!");n=Math.max(n,t)}t<n&&0===s&&(t=o)}return t+1}(e);n(o-1)&&e.splice(o++,0,s);for(const i of t)e.splice(o++,0,i);n(o-1)&&n(o)&&e.splice(o,0,s)}function E(e,t,i,r="lowp"){S(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function A(e,t,i,r,s="lowp"){S(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function M(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const t=e[n];if("operator"===t.type&&("["===t.data&&(i=n),"]"===t.data)){r=n;break}"integer"===t.type&&(s=parseInt(t.data,10))}return i&&r&&e.splice(i,r-i+1),s}function O(e,t){if((0,s.pC)(null))return null;const i=w(e);if("300 es"===function(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if("preprocessor"===s.type){const e=r.exec(s.data);if(e){const r=e[1].replace(/\s\s+/g," ");if(r===i)return r;if(r===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+r)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:"\n"}),null}(i,"100","300 es"))return e;let r=null,n=null;const o={},c={};for(let e=0;e<i.length;++e){const s=i[e];switch(s.type){case"keyword":t===a.Ho.VERTEX_SHADER&&"attribute"===s.data?s.data="in":"varying"===s.data&&(s.data=t===a.Ho.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(s.data.trim())&&(s.data=s.data.replace(/(2D|Cube|EXT)/g,"")),t===a.Ho.FRAGMENT_SHADER&&"gl_FragColor"===s.data&&(r||(r=T(i,o,"fragColor"),E(i,r,"vec4")),s.data=r),t===a.Ho.FRAGMENT_SHADER&&"gl_FragData"===s.data){const t=M(i,e+1),r=T(i,o,"fragData");A(i,r,"vec4",t,"mediump"),s.data=r}else t===a.Ho.FRAGMENT_SHADER&&"gl_FragDepthEXT"===s.data&&(n||(n=T(i,o,"gl_FragDepth")),s.data=n);break;case"ident":if(l.includes(s.data)){if(t===a.Ho.VERTEX_SHADER&&C(i,e))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");s.data in c||(c[s.data]=T(i,o,s.data)),s.data=c[s.data]}}}for(let e=i.length-1;e>=0;--e){const t=i[e];if("preprocessor"===t.type){const r=t.data.match(/\#extension\s+(.*)\:/);if(r&&r[1]&&x.includes(r[1].trim())){const t=i[e+1];i.splice(e,t&&"whitespace"===t.type?2:1)}const s=t.data.match(/\#ifdef\s+(.*)/);s&&s[1]&&x.includes(s[1].trim())&&(t.data="#if 1");const n=t.data.match(/\#ifndef\s+(.*)/);n&&n[1]&&x.includes(n[1].trim())&&(t.data="#if 0")}}return function(e,t){return t}(0,function(e){return e.map((e=>"eof"!==e.type?e.data:"")).join("")}(i))}new Map;class R{constructor(e,t,i,r,s=new Map){this._context=e,this._locations=r,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),this._context.type===o.zO.WEBGL2&&(t=O(t,a.Ho.VERTEX_SHADER),i=O(i,a.Ho.FRAGMENT_SHADER)),this._vShader=P(this._context,a.Ho.VERTEX_SHADER,t),this._fShader=P(this._context,a.Ho.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(a._g.Shader,this),(0,n.CG)()&&(this.vertexShader=t,this.fragmentShader=i)}get glName(){if((0,s.pC)(this._glName))return this._glName;if((0,s.Wi)(this._vShader))return null;const e=this._context.gl,t=e.createProgram();if(e.attachShader(t,this._vShader),e.attachShader(t,this._fShader),this._locations.forEach(((i,r)=>e.bindAttribLocation(t,i,r))),e.linkProgram(t),(0,n.CG)()&&!e.getProgramParameter(t,e.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${e.getProgramParameter(t,e.VALIDATE_STATUS)}, gl error ${e.getError()}, vertex: ${e.getShaderParameter(this._vShader,e.COMPILE_STATUS)}, fragment: ${e.getShaderParameter(this._fShader,e.COMPILE_STATUS)}, info log: ${e.getProgramInfoLog(t)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===o.zO.WEBGL2){const i=e;for(const[e,r]of this._uniformBlockBindings){const s=i.getUniformBlockIndex(t,e);s<4294967295&&i.uniformBlockBinding(t,s,r)}}return this._glName=t,this._context.instanceCounter.increment(a._g.Program,this),t}get hasGLName(){return(0,s.pC)(this._glName)}get isCompiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==e?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(a._g.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(a._g.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return void 0===this._nameToUniformLocation[e]&&(++L.numUniforms,this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return null!==this._getUniformLocation(e)}setUniform1i(e,t){const i=this._nameToUniform1[e];void 0!==i&&t===i||(this._context.gl.uniform1i(this._getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1iv(e,t){I(this._nameToUniform1v,e,t)&&this._context.gl.uniform1iv(this._getUniformLocation(e),t)}setUniform2iv(e,t){I(this._nameToUniform2,e,t)&&this._context.gl.uniform2iv(this._getUniformLocation(e),t)}setUniform3iv(e,t){I(this._nameToUniform3,e,t)&&this._context.gl.uniform3iv(this._getUniformLocation(e),t)}setUniform4iv(e,t){I(this._nameToUniform4,e,t)&&this._context.gl.uniform4iv(this._getUniformLocation(e),t)}setUniform1f(e,t){const i=this._nameToUniform1[e];void 0!==i&&t===i||(this._context.gl.uniform1f(this._getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1fv(e,t){I(this._nameToUniform1v,e,t)&&this._context.gl.uniform1fv(this._getUniformLocation(e),t)}setUniform2f(e,t,i){const r=this._nameToUniform2.get(e);void 0===r?(this._context.gl.uniform2f(this._getUniformLocation(e),t,i),this._nameToUniform2.set(e,[t,i])):t===r[0]&&i===r[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),t,i),r[0]=t,r[1]=i)}setUniform2fv(e,t){I(this._nameToUniform2,e,t)&&this._context.gl.uniform2fv(this._getUniformLocation(e),t)}setUniform3f(e,t,i,r){const s=this._nameToUniform3.get(e);void 0===s?(this._context.gl.uniform3f(this._getUniformLocation(e),t,i,r),this._nameToUniform3[e]=[t,i,r]):t===s[0]&&i===s[1]&&r===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),t,i,r),s[0]=t,s[1]=i,s[2]=r)}setUniform3fv(e,t){I(this._nameToUniform3,e,t)&&this._context.gl.uniform3fv(this._getUniformLocation(e),t)}setUniform4f(e,t,i,r,s){const n=this._nameToUniform4.get(e);void 0===n?(this._context.gl.uniform4f(this._getUniformLocation(e),t,i,r,s),this._nameToUniform4.set(e,[t,i,r,s])):void 0!==n&&t===n[0]&&i===n[1]&&r===n[2]&&s===n[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),t,i,r,s),n[0]=t,n[1]=i,n[2]=r,n[3]=s)}setUniform4fv(e,t){I(this._nameToUniform4,e,t)&&this._context.gl.uniform4fv(this._getUniformLocation(e),t)}setUniformMatrix3fv(e,t,i=!1){I(this._nameToUniformMatrix3,e,t)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,t)}setUniformMatrix4fv(e,t,i=!1){I(this._nameToUniformMatrix4,e,t)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,t)}stop(){}}function P(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),(0,n.CG)()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===a.Ho.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(function(e){let t=2;return e.replace(/\n/g,(()=>"\n"+function(e){return e>=1e3?e.toString():("  "+e).slice(-3)}(t++)+":"))}(i))),L.enabled&&(L.compiledLOC+=i.match(/\n/g).length+1),s}function I(e,t,i){const s=e.get(t);return s?(0,r.Vx)(s,i):(e.set(t,Array.from(i)),!0)}const L={compiledLOC:0,numUniforms:0,enabled:!1}},37165:(e,t,i)=>{"use strict";i.d(t,{r:()=>n});var r=i(36172),s=i(91907);class n{constructor(e,t){this._context=e,this._desc=t,this.type="renderbuffer",this._context.instanceCounter.increment(s._g.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:o,internalFormat:a,multisampled:l}=t;if(l){if(this._context.type!==r.zO.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,a,n,o)}else i.renderbufferStorage(i.RENDERBUFFER,a,n,o)}get descriptor(){return this._desc}get samples(){const e=this._desc.samples,t=this._context.parameters.maxSamples;return e?Math.min(e,t):t}resize(e,t){const i=this._desc;if(i.width===e&&i.height===t)return;i.width=e,i.height=t;const r=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):r.renderbufferStorage(r.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(s._g.Renderbuffer,this),this._context=null)}}},43487:(e,t,i)=>{"use strict";i.d(t,{x:()=>c}),i(39994);var r=i(19431),s=i(61681),n=i(6174),o=i(36172),a=i(91907),l=i(79193);class c{constructor(e,t,i=null){if(this._context=e,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,e.instanceCounter.increment(a._g.Texture,this),this._descriptor={target:a.No.TEXTURE_2D,samplingMode:a.cw.LINEAR,wrapMode:a.e8.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1,...t},e.type!==o.zO.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),d(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===a.No.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(a._g.Texture,this))}release(){this.dispose()}resize(e,t){const i=this._descriptor;if(i.width!==e||i.height!==t){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");i.width=e,i.height=t,this._descriptor.target===a.No.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let t=a.No.TEXTURE_CUBE_MAP_POSITIVE_X;t<=a.No.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}setData(e){this._setData(e)}_setData(e,t){if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),void 0===e&&(e=null);const r=this._descriptor;t??(t=r.target);const o=d(t);null===e&&(r.width=r.width||4,r.height=r.height||4,o&&(r.depth=r.depth??1));const f=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(c.TEXTURE_UNIT_FOR_UPDATES),c._validateTexture(this._context,r),this._configurePixelStorage();const m=r.pixelFormat;let g=r.internalFormat?r.internalFormat:this._deriveInternalFormat(m,r.dataType);if(h(e)){let s=e.width,a=e.height;const l=1;e instanceof HTMLVideoElement&&(s=e.videoWidth,a=e.videoHeight),r.width&&r.height,o&&r.depth,r.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(t,g,r.hasMipmap,s,a,l),this._texImage(t,0,g,s,a,l,e),(0,n.zu)(i),r.hasMipmap&&this.generateMipmap(),void 0===r.width&&(r.width=s),void 0===r.height&&(r.height=a),o&&void 0===r.depth&&(r.depth=l)}else{const{width:c,height:h,depth:d}=r;if(null!=c&&null!=h||console.error("Width and height must be specified!"),o&&null==d&&console.error("Depth must be specified!"),r.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(t,g,r.hasMipmap,c,h,d),i.DEPTH24_STENCIL8&&g===i.DEPTH_STENCIL&&(g=i.DEPTH24_STENCIL8),u(e)){const s=e.levels,n=p(t,c,h,d),o=Math.min(n-1,s.length-1);(0,l.Z)(i)?i.texParameteri(r.target,i.TEXTURE_MAX_LEVEL,o):r.hasMipmap=r.hasMipmap&&n===s.length;const u=g;if(!function(e){return e in a.q_}(u))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel(((e,i,r,n)=>{const o=s[Math.min(e,s.length-1)];this._compressedTexImage(t,e,u,i,r,n,o)}),o)}else(0,s.pC)(e)?(this._texImage(t,0,g,c,h,d,e),(0,n.zu)(i),r.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel(((e,r,s,o)=>{this._texImage(t,e,g,r,s,o,null),(0,n.zu)(i)}))}c._applySamplingMode(i,this._descriptor),c._applyWrapMode(i,this._descriptor),c._applyAnisotropicFilteringParameters(this._context,this._descriptor),(0,n.zu)(i),this._context.bindTexture(f,c.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,i,r,s,n){n||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const o=this._context.gl,a=this._descriptor,{pixelFormat:l,internalFormat:d,dataType:p,isImmutable:f,target:m}=a;if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const g=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES);(t<0||i<0||r>a.width||s>a.height||t+r>a.width||i+s>a.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),h(n)?o.texSubImage2D(m,e,t,i,l,p,n):u(n)?o.compressedTexSubImage2D(m,e,t,i,r,s,d,n.levels[e]):o.texSubImage2D(m,e,t,i,r,s,l,p,n),this._context.bindTexture(g,c.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,t,i,r,s,n,o,a){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const h=this._context.gl;if(!(0,l.Z)(h))throw new Error("3D textures are not supported in WebGL1");const p=this._descriptor,{pixelFormat:f,dataType:m,isImmutable:g,target:y,internalFormat:_}=p;if(g&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");d(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(c.TEXTURE_UNIT_FOR_UPDATES),(t<0||i<0||r<0||s>p.width||n>p.height||o>p.depth||t+s>p.width||i+n>p.height||r+o>p.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),u(a))a=a.levels[e],h.compressedTexSubImage3D(y,e,t,i,r,s,n,o,_,a);else{const l=a;h.texSubImage3D(y,e,t,i,r,s,n,o,f,m,l)}this._context.bindTexture(v,c.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,c._validateTexture(this._context,e)}e.samplingMode===a.cw.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=a.cw.LINEAR_MIPMAP_NEAREST):e.samplingMode===a.cw.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=a.cw.NEAREST_MIPMAP_NEAREST);const t=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(c.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(e.target),this._context.bindTexture(t,c.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,c._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(c._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(c._applyWrapMode(e,t),this._wrapModeDirty=!1)}_deriveInternalFormat(e,t){if(this._context.type===o.zO.WEBGL1)return e;switch(t){case a.Br.FLOAT:switch(e){case a.VI.RGBA:return a.lP.RGBA32F;case a.VI.RGB:return a.lP.RGB32F;default:throw new Error("Unable to derive format")}case a.Br.UNSIGNED_BYTE:switch(e){case a.VI.RGBA:return a.lP.RGBA8;case a.VI.RGB:return a.lP.RGB8}default:return e}}_configurePixelStorage(){const e=this._context.gl,{unpackAlignment:t,flipped:i,preMultiplyAlpha:r}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r?1:0)}_texStorage(e,t,i,r,s,n){const o=this._context.gl;if(!(0,l.Z)(o))throw new Error("Immutable textures are not supported in WebGL1");if(!function(e){return e in a.lP}(t))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const c=i?p(e,r,s,n):1;d(e)?o.texStorage3D(e,c,t,r,s,n):o.texStorage2D(e,c,t,r,s),this._wasImmutablyAllocated=!0}_texImage(e,t,i,r,n,a,l){const c=this._context.gl;let u=null;const p=this._context.type===o.zO.WEBGL2,f=d(e),{isImmutable:m,pixelFormat:g,dataType:y}=this._descriptor;if(p&&(u=c),p||!h(l))if(m){if((0,s.pC)(l)){const i=l;f?u.texSubImage3D(e,t,0,0,0,r,n,a,g,y,i):c.texSubImage2D(e,t,0,0,r,n,g,y,i)}}else{const o=(0,s.Wg)(l);f?u.texImage3D(e,t,i,r,n,a,0,g,y,o):c.texImage2D(e,t,i,r,n,0,g,y,o)}else c.texImage2D(e,0,i,g,y,l)}_compressedTexImage(e,t,i,r,n,a,l){const c=this._context.gl;let u=null;const h=d(e),p=this._descriptor.isImmutable;if(h){if(this._context.type!==o.zO.WEBGL2)throw new Error("3D textures are not supported in WebGL1");u=c}p?(0,s.pC)(l)&&(h?u.compressedTexSubImage3D(e,t,0,0,0,r,n,a,i,l):c.compressedTexSubImage2D(e,t,0,0,r,n,i,l)):h?u.compressedTexImage3D(e,t,i,r,n,a,0,l):c.compressedTexImage2D(e,t,i,r,n,0,l)}_forEachMipmapLevel(e,t=1/0){let{width:i,height:r,depth:s,hasMipmap:n,target:o}=this._descriptor;const l=o===a.No.TEXTURE_3D;for(let o=0;e(o,i,r,s),n&&(1!==i||1!==r||l&&1!==s)&&!(o>=t);++o)i=Math.max(1,i>>1),r=Math.max(1,r>>1),l&&(s=Math.max(1,s>>1))}static _validateTexture(e,t){(t.width<0||t.height<0||t.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=(0,l.Z)(e.gl),s=(0,r.wt)(t.width)&&(0,r.wt)(t.height);i||!t.isImmutable&&!d(t.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),i||s||("number"==typeof t.wrapMode?t.wrapMode!==a.e8.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):t.wrapMode.s===a.e8.CLAMP_TO_EDGE&&t.wrapMode.t===a.e8.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let i=t.samplingMode,r=t.samplingMode;i===a.cw.LINEAR_MIPMAP_NEAREST||i===a.cw.LINEAR_MIPMAP_LINEAR?(i=a.cw.LINEAR,t.hasMipmap||(r=a.cw.LINEAR)):i!==a.cw.NEAREST_MIPMAP_NEAREST&&i!==a.cw.NEAREST_MIPMAP_LINEAR||(i=a.cw.NEAREST,t.hasMipmap||(r=a.cw.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,i),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,r)}static _applyWrapMode(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){const i=e.capabilities.textureFilterAnisotropic;i&&e.gl.texParameterf(t.target,i.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy??1)}}function u(e){return(0,s.pC)(e)&&"type"in e&&"compressed"===e.type}function h(e){return(0,s.pC)(e)&&!u(e)&&!function(e){return(0,s.pC)(e)&&"byteLength"in e}(e)}function d(e){return e===a.No.TEXTURE_3D||e===a.No.TEXTURE_2D_ARRAY}function p(e,t,i,r=1){let s=Math.max(t,i);return e===a.No.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}c.TEXTURE_UNIT_FOR_UPDATES=0},62486:(e,t,i)=>{"use strict";i.d(t,{HH:()=>n,RG:()=>c,UF:()=>l,XP:()=>a,_V:()=>o,un:()=>u}),i(39994);var r=i(61681),s=i(91907);function n(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function o(e,t){return e.vertexBuffers[t].size/function(e){return e[0].stride}(e.layout[t])}function a(e,t,i,r,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const e of r){const i=t.get(e.name);void 0===i&&console.error(`There is no location for vertex attribute '${e.name}' defined.`);const r=s*e.stride;if(e.count<=4)n.vertexAttribPointer(i,e.count,e.type,e.normalized,e.stride,e.offset+r),n.enableVertexAttribArray(i),e.divisor>0&&o&&o.vertexAttribDivisor(i,e.divisor);else if(9===e.count)for(let t=0;t<3;t++)n.vertexAttribPointer(i+t,3,e.type,e.normalized,e.stride,e.offset+12*t+r),n.enableVertexAttribArray(i+t),e.divisor>0&&o&&o.vertexAttribDivisor(i+t,e.divisor);else if(16===e.count)for(let t=0;t<4;t++)n.vertexAttribPointer(i+t,4,e.type,e.normalized,e.stride,e.offset+16*t+r),n.enableVertexAttribArray(i+t),e.divisor>0&&o&&o.vertexAttribDivisor(i+t,e.divisor);else console.error("Unsupported vertex attribute element count: "+e.count)}}function l(e,t,i,r){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const e of r){const i=t.get(e.name);if(e.count<=4)n.disableVertexAttribArray(i),e.divisor&&e.divisor>0&&o&&o.vertexAttribDivisor(i,0);else if(9===e.count)for(let t=0;t<3;t++)n.disableVertexAttribArray(i+t),e.divisor&&e.divisor>0&&o&&o.vertexAttribDivisor(i+t,0);else if(16===e.count)for(let t=0;t<4;t++)n.disableVertexAttribArray(i+t),e.divisor&&e.divisor>0&&o&&o.vertexAttribDivisor(i+t,0);else console.error("Unsupported vertex attribute element count: "+e.count)}e.unbindBuffer(s.w0.ARRAY_BUFFER)}function c(e){switch(e){case s.VI.ALPHA:case s.VI.LUMINANCE:case s.VI.RED:case s.VI.RED_INTEGER:case s.lP.R8:case s.lP.R8I:case s.lP.R8UI:case s.lP.R8_SNORM:case s.Tg.STENCIL_INDEX8:return 1;case s.VI.LUMINANCE_ALPHA:case s.VI.RG:case s.VI.RG_INTEGER:case s.lP.RGBA4:case s.lP.R16F:case s.lP.R16I:case s.lP.R16UI:case s.lP.RG8:case s.lP.RG8I:case s.lP.RG8UI:case s.lP.RG8_SNORM:case s.lP.RGB565:case s.lP.RGB5_A1:case s.Tg.DEPTH_COMPONENT16:return 2;case s.VI.DEPTH_COMPONENT:case s.VI.RGB:case s.VI.RGB_INTEGER:case s.lP.RGB8:case s.lP.RGB8I:case s.lP.RGB8UI:case s.lP.RGB8_SNORM:case s.lP.SRGB8:case s.Tg.DEPTH_COMPONENT24:return 3;case s.VI.DEPTH_STENCIL:case s.VI.RGBA:case s.VI.RGBA_INTEGER:case s.lP.RGBA8:case s.lP.R32F:case s.lP.R11F_G11F_B10F:case s.lP.RG16F:case s.lP.R32I:case s.lP.R32UI:case s.lP.RG16I:case s.lP.RG16UI:case s.lP.RGBA8I:case s.lP.RGBA8UI:case s.lP.RGBA8_SNORM:case s.lP.SRGB8_ALPHA8:case s.lP.RGB9_E5:case s.lP.RGB10_A2UI:case s.lP.RGB10_A2:case s.Tg.DEPTH_STENCIL:case s.Tg.DEPTH_COMPONENT32F:case s.Tg.DEPTH24_STENCIL8:return 4;case s.Tg.DEPTH32F_STENCIL8:return 5;case s.lP.RGB16F:case s.lP.RGB16I:case s.lP.RGB16UI:return 6;case s.lP.RG32F:case s.lP.RG32I:case s.lP.RG32UI:case s.lP.RGBA16F:case s.lP.RGBA16I:case s.lP.RGBA16UI:return 8;case s.lP.RGB32F:case s.lP.RGB32I:case s.lP.RGB32UI:return 12;case s.lP.RGBA32F:case s.lP.RGBA32I:case s.lP.RGBA32UI:return 16;case s.q_.COMPRESSED_RGB_S3TC_DXT1_EXT:case s.q_.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case s.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT:case s.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case s.q_.COMPRESSED_R11_EAC:case s.q_.COMPRESSED_SIGNED_R11_EAC:case s.q_.COMPRESSED_RGB8_ETC2:case s.q_.COMPRESSED_SRGB8_ETC2:case s.q_.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case s.q_.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case s.q_.COMPRESSED_RG11_EAC:case s.q_.COMPRESSED_SIGNED_RG11_EAC:case s.q_.COMPRESSED_RGBA8_ETC2_EAC:case s.q_.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function u(e){if((0,r.Wi)(e))return 0;if("descriptor"in e)return e.glName?u(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,s=e.width*e.height;return c(t)*s*i}},29620:(e,t,i)=>{"use strict";i.d(t,{U:()=>l});var r=i(13802),s=i(61681),n=i(91907),o=i(62486);const a=r.Z.getLogger("esri.views.webgl.VertexArrayObject");class l{constructor(e,t,i,r,s=null){this._context=e,this._locations=t,this._layout=i,this._buffers=r,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(n._g.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].size),(0,s.pC)(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){if(this._context){if(this._glName){const e=this._context?.capabilities?.vao;e?(e.deleteVertexArray(this._glName),this._glName=null):a.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];this._indexBuffer=(0,s.O3)(this._indexBuffer)}this._context.instanceCounter.decrement(n._g.VertexArrayObject,this),this._context=null}else(this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&a.warn("Leaked WebGL VAO")}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:i}=this;e||a.error("Vertex buffer dictionary is empty!");const r=this._context.gl;for(const i in e){const r=e[i];r||a.error("Vertex buffer is uninitialized!");const s=t[i];s||a.error("Vertex element descriptor is empty!"),(0,o.XP)(this._context,this._locations,r,s)}(0,s.pC)(i)&&(this._context.capabilities.vao?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:t}=this;e||a.error("Vertex buffer dictionary is empty!");for(const i in e){const r=e[i];r||a.error("Vertex buffer is uninitialized!");const s=t[i];(0,o.UF)(this._context,this._locations,r,s)}(0,s.pC)(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}},41163:(e,t,i)=>{"use strict";i.d(t,{G:()=>r});class r{constructor(e,t,i,r,s,n=!1,o=0){this.name=e,this.count=t,this.type=i,this.offset=r,this.stride=s,this.normalized=n,this.divisor=o}}},35119:(e,t,i)=>{"use strict";i.d(t,{hc:()=>a});var r=i(61681),s=i(36172);let n,o;function a(e){const t=(0,s.Sh)(e);for(;t.length>1;){const e=l(t.shift());if(e.available)return e}return l(t.shift())}function l(e){switch(e){case s.zO.WEBGL1:return n||(n=function(){const e=new u,t=d(s.zO.WEBGL1,e);return(0,r.Wi)(t)||(e.supportsElementIndexUint=null!==t.getExtension("OES_element_index_uint"),e.supportsStandardDerivatives=null!==t.getExtension("OES_standard_derivatives"),e.supportsInstancedArrays=null!==t.getExtension("ANGLE_instanced_arrays"),e.supportsTextureFloat=null!==t.getExtension("OES_texture_float"),e.supportsTextureHalfFloat=null!==t.getExtension("OES_texture_half_float"),e.supportsColorBufferFloat=null!==t.getExtension("WEBGL_color_buffer_float"),e.supportsColorBufferFloatBlend=null!==t.getExtension("EXT_float_blend"),e.supportsColorBufferHalfFloat=null!==t.getExtension("EXT_color_buffer_half_float")),e}()),n;case s.zO.WEBGL2:return o||(o=function(){const e=new h,t=d(s.zO.WEBGL2,e);return(0,r.Wi)(t)||(e.supportsColorBufferFloat=null!==t.getExtension("EXT_color_buffer_float"),e.supportsColorBufferFloatBlend=null!==t.getExtension("EXT_float_blend"),e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||null!==t.getExtension("EXT_color_buffer_half_float")),e}()),o}}class c{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class u extends c{constructor(){super(...arguments),this.type=s.zO.WEBGL1}}class h extends c{constructor(){super(...arguments),this.type=s.zO.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function d(e,t){if(e===s.zO.WEBGL1&&void 0===typeof WebGLRenderingContext||e===s.zO.WEBGL2&&void 0===typeof WebGL2RenderingContext)return null;const i=document.createElement("canvas");if(!i)return null;let n=(0,s.kr)(i,e,{failIfMajorPerformanceCaveat:!0});if((0,r.Wi)(n)&&(n=(0,s.kr)(i,e),(0,r.pC)(n)&&(t.majorPerformanceCaveat=!0)),(0,r.Wi)(n))return n;if(e===s.zO.WEBGL1){const e=n.getParameter(n.VERSION)?.match(/^WebGL\s+([\d.]*)/);if(e){const i=parseFloat(e[1]);t.available=i>=.94}}else t.available=!0;t.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const o=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT);return o&&(t.supportsHighPrecisionFragment=o.precision>0),n}},79193:(e,t,i)=>{"use strict";function r(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}i.d(t,{Z:()=>r})},6174:(e,t,i)=>{"use strict";i.d(t,{CG:()=>l,hZ:()=>a,zu:()=>c});var r=i(70375),s=i(39994);const n=i(13802).Z.getLogger("esri/views/webgl"),o=!!(0,s.Z)("enable-feature:webgl-debug");function a(){return o}function l(){return o}function c(e){if(a()){const t=e.getError();if(t){const i=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),s=(new Error).stack;n.error(new r.Z("webgl-error","WebGL error occured",{message:i,stack:s}))}}}},36172:(e,t,i)=>{"use strict";i.d(t,{Sh:()=>l,kr:()=>c,sj:()=>a,zO:()=>r});var r,s,n=i(39994),o=i(61681);function a(e,t,i={}){const r=l(e);for(;r.length>1;){const e=c(t,r.shift(),i);if((0,o.pC)(e))return e}return function(e,t,i={}){if(!window.WebGLRenderingContext)return u(e,h),null;const r=c(e,t,i);return(0,o.Wi)(r)&&u(e,d),r}(t,r.shift(),i)}function l(e){const t=(0,n.Z)("esri-force-webgl");if(t===r.WEBGL1||t===r.WEBGL2)return[t];switch(e){case"2d":return(0,n.Z)("mac")&&(0,n.Z)("chrome")?[r.WEBGL1,r.WEBGL2]:[r.WEBGL2,r.WEBGL1];case"3d":return[r.WEBGL2,r.WEBGL1]}}function c(e,t,i={}){const s=t===r.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let n=null;for(const t of s){try{n=e.getContext(t,i)}catch(e){}if(n)break}return n}function u(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(s=r||(r={}))[s.WEBGL1=1]="WEBGL1",s[s.WEBGL2=2]="WEBGL2";const h='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',d='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'},30560:(e,t,i)=>{"use strict";function r(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function s(e,t){const i=e.length;for(let r=0;r<i;++r)o[0]=e[r],t[r]=o[0];return t}function n(e,t){const i=e.length;for(let r=0;r<i;++r)o[0]=e[r],o[1]=e[r]-o[0],t[r]=o[1];return t}i.d(t,{GB:()=>n,LF:()=>r,U8:()=>s});const o=new Float32Array(2)},91907:(e,t,i)=>{"use strict";var r,s,n,o,a,l,c,u,h,d,p,f,m,g,y,_,v,b,w,x,C,T;i.d(t,{Br:()=>_,Ho:()=>w,LR:()=>l,Ld:()=>S,Lm:()=>C,Lu:()=>M,MX:()=>s,No:()=>m,OU:()=>T,Se:()=>R,Tg:()=>v,V7:()=>D,VI:()=>g,VY:()=>A,Wf:()=>c,Y5:()=>L,_g:()=>E,cw:()=>p,db:()=>o,e8:()=>f,g:()=>u,l1:()=>b,lP:()=>y,lk:()=>r,q_:()=>O,qi:()=>x,w0:()=>a,wb:()=>h,xS:()=>d,zi:()=>n}),function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"}(r||(r={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(s||(s={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(n||(n={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(o||(o={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(a||(a={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(l||(l={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(c||(c={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(u||(u={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(h||(h={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(d||(d={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(p||(p={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(f||(f={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(m||(m={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(g||(g={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(y||(y={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(_||(_={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(v||(v={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(b||(b={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(w||(w={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(x||(x={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(C||(C={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(T||(T={}));const S=33984;var E,A;!function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"}(E||(E={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(A||(A={}));const M=33306;var O,R,P,I,L,D,N;!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"}(O||(O={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(R||(R={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(P||(P={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(I||(I={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(L||(L={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(D||(D={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(N||(N={}))},10054:(e,t,i)=>{"use strict";i.d(t,{Br:()=>l,Fm:()=>f,N9:()=>g,RA:()=>y,Tc:()=>u,Ue:()=>h,iC:()=>c,s9:()=>a,v:()=>m,xW:()=>p,zS:()=>d});var r=i(69666),s=i(36172),n=i(91907),o=(i(18567),i(43487));function a(e,t,i="nearest",r=!1){const a=!(r&&"u8"===t.pixelType),l=a?n.Br.FLOAT:n.Br.UNSIGNED_BYTE,c=null==t.pixels||0===t.pixels.length?null:a?t.getAsRGBAFloat():t.getAsRGBA(),u=e.capabilities.textureFloat?.textureFloatLinear,h={width:t.width,height:t.height,target:n.No.TEXTURE_2D,pixelFormat:n.VI.RGBA,internalFormat:e.type===s.zO.WEBGL2&&a?n.lP.RGBA32F:n.VI.RGBA,samplingMode:!u||"bilinear"!==i&&"cubic"!==i?n.cw.NEAREST:n.cw.LINEAR,dataType:l,wrapMode:n.e8.CLAMP_TO_EDGE,flipped:!1};return new o.x(e,h,c)}function l(e,t){const{spacing:i,offsets:r,coefficients:a,size:[l,c]}=t,u=i[0]>1,h={width:u?4*l:l,height:c,target:n.No.TEXTURE_2D,pixelFormat:n.VI.RGBA,internalFormat:e.type===s.zO.WEBGL2?n.lP.RGBA32F:n.VI.RGBA,dataType:n.Br.FLOAT,samplingMode:n.cw.NEAREST,wrapMode:n.e8.CLAMP_TO_EDGE,flipped:!1},d=new Float32Array(u?l*c*16:2*r.length);if(u)for(let e=0,t=0;e<a.length;e++)d[t++]=a[e],e%3==2&&(d[t++]=1);else for(let e=0;e<c;e++)for(let t=0;t<l;t++){const i=4*(e*l+t),s=2*(t*c+e);d[i]=r[s],d[i+1]=r[s+1],d[i+3]=-1===r[s]?0:1}return new o.x(e,h,d)}function c(e,t){const i={width:t.length/4,height:1,target:n.No.TEXTURE_2D,pixelFormat:n.VI.RGBA,internalFormat:n.VI.RGBA,dataType:n.Br.UNSIGNED_BYTE,samplingMode:n.cw.NEAREST,wrapMode:n.e8.CLAMP_TO_EDGE,flipped:!1};return new o.x(e,i,t)}function u(e,t,i,s=1,n=!0){return{u_flipY:n,u_applyTransform:!!e,u_opacity:s,u_transformSpacing:e?e.spacing:r.Z,u_transformGridSize:e?e.size:r.Z,u_targetImageSize:t,u_srcImageSize:i}}function h(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function d(e,t){return{u_scale:e,u_offset:t}}function p(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function f(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function m(e,t){const i=e.gl,r=t.glName,s=i.getProgramParameter(r,i.ACTIVE_UNIFORMS),n=new Map;let o;for(let e=0;e<s;e++)o=i.getActiveUniform(r,e),o&&n.set(o.name,{location:i.getUniformLocation(r,o.name),info:o});return n}function g(e,t,i){Object.keys(i).forEach((r=>{const s=t.get(r)||t.get(r+"[0]");s&&function(e,t,i,r){if(null===r||null==i)return!1;const{info:s}=r;switch(s.type){case n.Se.FLOAT:s.size>1?e.setUniform1fv(t,i):e.setUniform1f(t,i);break;case n.Se.FLOAT_VEC2:e.setUniform2fv(t,i);break;case n.Se.FLOAT_VEC3:e.setUniform3fv(t,i);break;case n.Se.FLOAT_VEC4:e.setUniform4fv(t,i);break;case n.Se.FLOAT_MAT3:e.setUniformMatrix3fv(t,i);break;case n.Se.FLOAT_MAT4:e.setUniformMatrix4fv(t,i);break;case n.Se.INT:s.size>1?e.setUniform1iv(t,i):e.setUniform1i(t,i);break;case n.Se.BOOL:e.setUniform1i(t,i?1:0);break;case n.Se.INT_VEC2:case n.Se.BOOL_VEC2:e.setUniform2iv(t,i);break;case n.Se.INT_VEC3:case n.Se.BOOL_VEC3:e.setUniform3iv(t,i);break;case n.Se.INT_VEC4:case n.Se.BOOL_VEC4:e.setUniform4iv(t,i);break;default:;}}(e,r,i[r],s)}))}function y(e,t,i,r){i.length===r.length&&(r.some((e=>null==e))||i.some((e=>null==e))||i.forEach(((i,s)=>{t.setUniform1i(i,s),e.bindTexture(r[s],s)})))}},17346:(e,t,i)=>{"use strict";i.d(t,{BK:()=>h,LZ:()=>u,Rd:()=>a,if:()=>n,jp:()=>z,sg:()=>l,sm:()=>b,wK:()=>o,zp:()=>c});var r=i(70984),s=i(91907);function n(e,t,i=s.db.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function o(e,t,i,r,n=s.db.ADD,o=s.db.ADD,a=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:n,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const a={face:s.LR.BACK,mode:s.Wf.CCW},l={face:s.LR.FRONT,mode:s.Wf.CCW},c=e=>e===r.Vr.Back?a:e===r.Vr.Front?l:null,u={zNear:0,zFar:1},h={r:!0,g:!0,b:!0,a:!0};function d(e){return C.intern(e)}function p(e){return S.intern(e)}function f(e){return A.intern(e)}function m(e){return O.intern(e)}function g(e){return P.intern(e)}function y(e){return L.intern(e)}function _(e){return N.intern(e)}function v(e){return k.intern(e)}function b(e){return V.intern(e)}class w{constructor(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}intern(e){if(!e)return null;const t=this.makeKey(e),i=this.interns;return i.has(t)||i.set(t,this.makeRef(e)),i.get(t)}}function x(e){return"["+e.join(",")+"]"}const C=new w(T,(e=>({__tag:"Blending",...e})));function T(e){return e?x([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const S=new w(E,(e=>({__tag:"Culling",...e})));function E(e){return e?x([e.face,e.mode]):null}const A=new w(M,(e=>({__tag:"PolygonOffset",...e})));function M(e){return e?x([e.factor,e.units]):null}const O=new w(R,(e=>({__tag:"DepthTest",...e})));function R(e){return e?x([e.func]):null}const P=new w(I,(e=>({__tag:"StencilTest",...e})));function I(e){return e?x([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const L=new w(D,(e=>({__tag:"DepthWrite",...e})));function D(e){return e?x([e.zNear,e.zFar]):null}const N=new w(F,(e=>({__tag:"ColorWrite",...e})));function F(e){return e?x([e.r,e.g,e.b,e.a]):null}const k=new w(U,(e=>({__tag:"StencilWrite",...e})));function U(e){return e?x([e.mask]):null}const V=new w((function(e){return e?x([T(e.blending),E(e.culling),M(e.polygonOffset),R(e.depthTest),I(e.stencilTest),D(e.depthWrite),F(e.colorWrite),U(e.stencilWrite)]):null}),(e=>({blending:d(e.blending),culling:p(e.culling),polygonOffset:f(e.polygonOffset),depthTest:m(e.depthTest),stencilTest:g(e.stencilTest),depthWrite:y(e.depthWrite),colorWrite:_(e.colorWrite),stencilWrite:v(e.stencilWrite)})));class z{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,t,i,r){return(i||e!==t)&&(r(e),this._pipelineInvalid=!0),e}}},78621:(e,t,i)=>{"use strict";i.d(t,{a:()=>s,b:()=>n});var r=i(7283);function s(e){const t=(0,r.vU)(100*(1-e));return Math.max(0,Math.min(t,100))}function n(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}},4e4:(e,t,i)=>{"use strict";i.d(t,{Nw:()=>d});var r=i(70375),s=i(67134),n=i(61681),o=i(86745),a=i(64626),l=i(54957);const c=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),u=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function h(e,t){"maxScale"in e&&(t.maxScale=(0,a.k)(e.maxScale)),"minScale"in e&&(t.minScale=(0,a.k)(e.minScale))}function d(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new r.Z("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(function(e,t){if(t.restrictedWebMapWriting){const i=function(e){return"basemap"===e.layerContainerType?c:"operational-layers"===e.layerContainerType?u:null}(t);return!(0,n.pC)(i)||i.has(e.type)&&!(0,l.rQ)(e)}return!0}(e,i)){const t={};return e.write(t,i)?t:null}return(0,n.pC)(t)&&function(e,t){if(function(e,t){if((0,l.rQ)(e)){const i=(0,o.hS)("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&h(e,r)}else"stream"===e.type?h(e,t.layerDefinition=t.layerDefinition||{}):"group"!==e.type&&h(e,t)}(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=(0,a.k)(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type)if((0,l.rQ)(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}(e,t=(0,s.d9)(t)),t}},31129:(e,t,i)=>{"use strict";i.d(t,{NA:()=>c,QQ:()=>u,fD:()=>h,pO:()=>a});var r=i(30936),s=i(17075);const n=new r.Z([64,64,64]);function o(e,t){const i=[],r=e.length-1;return 5===e.length?i.push(0,2,4):i.push(0,r),e.map(((e,n)=>i.includes(n)?(0,s.MN)(e,n,r,t):null))}async function a(e,t,r){let s=!1,n=[],a=[];if(e.stops){const t=e.stops;n=t.map((e=>e.value)),s=t.some((e=>!!e.label)),s&&(a=t.map((e=>e.label)))}const c=n[0],u=n[n.length-1];if(null==c&&null==u)return null;const h=s?null:o(n,r);return(await Promise.all(n.map((async(r,n)=>({value:r,color:"opacity"===e.type?await l(r,e,t):(await Promise.resolve().then(i.bind(i,36496))).getColor(e,r),label:s?a[n]:h[n]}))))).reverse()}async function l(e,t,s=n){const o=new r.Z(s),a=(await Promise.resolve().then(i.bind(i,36496))).getOpacity(t,e);return null!=a&&(o.a=a),o}function c(e){let t=!1,i=[],r=[];i=e.map((e=>e.value)),t=e.some((e=>!!e.label)),t&&(r=e.map((e=>e.label)));const s=i[0],n=i[i.length-1];if(null==s&&null==n)return null;const a=t?null:o(i,!1);return i.map(((i,s)=>({value:i,color:u(i,e),label:t?r[s]:a[s]}))).reverse()}function u(e,t){const{startIndex:i,endIndex:s,weight:n}=function(e,t){let i=0,r=t.length-1;return t.some(((t,s)=>e<t.value?(r=s,!0):(i=s,!1))),{startIndex:i,endIndex:r,weight:(e-t[i].value)/(t[r].value-t[i].value)}}(e,t);if(i===s)return t[i].color;const o=r.Z.blendColors(t[i].color,t[s].color,n);return new r.Z(o)}function h(e,t){let i=[];if(e&&"multipart"===e.type)e.colorRamps.reverse().forEach(((s,n)=>{0===n?i.push({value:t.max,color:new r.Z(s.toColor),label:"high"}):i.push({value:null,color:new r.Z(s.toColor),label:""}),n===e.colorRamps.length-1?i.push({value:t.min,color:new r.Z(s.fromColor),label:"low"}):i.push({value:null,color:new r.Z(s.fromColor),label:""})}));else{let s,n;e&&"algorithmic"===e.type?(s=e.fromColor,n=e.toColor):(s=[0,0,0,1],n=[255,255,255,1]),i=[{value:t.max,color:new r.Z(n),label:"high"},{value:t.min,color:new r.Z(s),label:"low"}]}return i}},25803:(e,t,i)=>{"use strict";i.d(t,{h:()=>s});var r=i(7541);function s(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter((e=>e.color?.a>0));let i=t.length-1;if(t&&t[0]){const e=t[i];e&&1!==e.ratio&&(t.push(new r.Z({ratio:1,color:e.color})),i++)}return t.map(((t,r)=>{let s="";return 0===r?s=e.legendOptions?.minLabel||"low":r===i&&(s=e.legendOptions?.maxLabel||"high"),{color:t.color,label:s,ratio:t.ratio}})).reverse()}},17075:(e,t,i)=>{"use strict";i.d(t,{Eh:()=>a,MN:()=>c,jb:()=>h,uY:()=>u,y$:()=>d,zZ:()=>o}),i(4905);var r=i(72057),s=i(21758),n=i(15498);const o="<",a=">",l=(0,r.Ze)("short-date");function c(e,t,i,n){let c="";0===t?c=`${o} `:t===i&&(c=`${a} `);let u=null;return u=n?(0,r.p6)(e,l):(0,s.WU)(e),c+u}const u=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function h(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find((e=>"color"===e.type));if(!t)return null;let r=null,s=null;if(t.stops){if(1===t.stops.length)return t.stops[0].color;r=t.stops[0].value,s=t.stops[t.stops.length-1].value}const n=r+(s-r)/2,{getColor:o}=await Promise.resolve().then(i.bind(i,36496));return o(t,n)}async function d(e,t){const i=e.trailCap,r=e.trailWidth||1,s=t||await h(e)||e.color;return new n.Z({cap:i,color:s,width:r})}},47035:(e,t,i)=>{"use strict";i.d(t,{Z:()=>B});var r=i(36663),s=(i(87090),i(59183)),n=i(31355),o=i(49546),a=i(44584),l=(i(39994),i(67134)),c=i(13802),u=i(61681),h=i(64189),d=i(78668),p=i(76868),f=i(12173),m=i(81977),g=i(69236),y=i(40266),_=i(55860),v=i(24163),b=i(66311);i(22591);const w={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},x={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},C=(e,t,i=!1)=>{let r=e;return t.forEach(((e,s)=>{const n=r?.children?((e,t)=>e.find(t))(r.children,(t=>t.domNode===e)):void 0;i&&!n&&s!==t.length-1||(r=n)})),r};var T=i(77210),S=i(36567),E=i(3466);let A;A="components/assets";var M=i(67181);const O=new Set;var R=i(67842),P=i(54956),I=i(8108),L=i(60720);const D="esri.widgets.Widget",N=c.Z.getLogger(D);let F=0;function k(e,t){for(const i in t)null!=e[i]&&("object"==typeof e[i]&&"object"==typeof t[i]?k(e[i],t[i]):e[i]=t[i]);return e}const U=(e=>{let t;const i={...w,...e},r=(n=i,{...x,...n}),s=r.performanceLogger;var n;let o,a=!0,l=!1;const c=[],u=[],h=(e,n,o)=>{let a;r.eventHandlerInterceptor=(e,r,n,o)=>function(e){let r;s("domEvent",e);const n=((e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i})(e.currentTarget,a.domNode),o=n.some((e=>customElements.get(e?.tagName?.toLowerCase())));if(e.eventPhase!==Event.CAPTURING_PHASE&&o){const t=e.composedPath(),i=t.slice(t.indexOf(e.currentTarget),t.indexOf(a.domNode)).filter((e=>e.getRootNode()===e.ownerDocument)).reverse();r=C(a.getLastRender(),i,!0)}else n.reverse(),r=C(a.getLastRender(),n);let l;return r&&(l=i.handleInterceptedEvent(t,r,this,e)),s("domEventProcessed",e),l},i.postProcessProjectionOptions?.(r);const l=o();a=e(n,l,r),c.push(a),u.push(o),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(a,l)};let d=()=>{if(o=void 0,a){a=!1,s("renderStart",void 0);for(let e=0;e<c.length;e++){const t=u[e]();s("rendered",void 0),c[e].update(t),s("patched",void 0)}s("renderDone",void 0),a=!0}};return i.modifyDoRenderImplementation&&(d=i.modifyDoRenderImplementation(d,c,u)),t={renderNow:d,scheduleRender:()=>{o||l||(o=requestAnimationFrame(d))},stop:()=>{o&&(cancelAnimationFrame(o),o=void 0),l=!0},resume:()=>{l=!1,a=!0,t.scheduleRender()},append:(e,t)=>{h(b.v.append,e,t)},insertBefore:(e,t)=>{h(b.v.insertBefore,e,t)},merge:(e,t)=>{h(b.v.merge,e,t)},replace:(e,t)=>{h(b.v.replace,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t})({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(e,r,s,n)=>{const o=t(e,r,s,n),a=i.test(e);if(!((e=e.replace(i,"")).toLowerCase()in s)||a){const t=e[2].toLowerCase()+e.slice(3),i=e=>o.call(s,e);s.addEventListener(t,i,a);const r=()=>s.removeEventListener(t,i,a),l=n.afterRemoved;n.afterRemoved=e=>{l?.(e),r()}}return o}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&((0,R.Uy)(),e.scheduleRender(),l[a].call(l.bind||i,r))}});let V=!1,z=class extends((0,h.v)(n.Z.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new a.Z,this._projector=U,this._readyForTrueRender=!1,this.domNode=null,this.iconClass="esri-icon-checkbox-unchecked",this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=(0,d.Ds)((async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const e=await(0,d.as)(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{let i=await(0,L.ME)(e);this.uiStrings&&Object.keys(this.uiStrings)&&(i=k((0,l.d9)(i),this.uiStrings)),this[t]=i})));for(const t of e)t.error&&N.error("widget-intl:locale-error",this.declaredClass,t.error)}await this.loadLocale()})),(0,T.YY)((0,E.hF)((0,S.V)("components/assets")));const i="esri-widget-uid-"+(0,f.D)(),r=this.render.bind(this);this._trackingTarget=new v.M((()=>this.scheduleRender()));const s=()=>{if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const e=r();let{properties:t}=e;t||(e.properties=t={});let{key:s,styles:n}=t;s||(t.key=i),n||(t.styles=n={}),n.display||(n.display="");let o=0;return e.children?.forEach((e=>{if((0,M.ZJ)(e.vnodeSelector))return;let{properties:t}=e;t||(e.properties=t={}),t.key||(t.key=`${this.id}--${o++}`)})),(0,M.dh)(this,e)};var n;this.render=()=>{if(V)return s();let e=(0,R.O9)(this);if(e)return e;this._trackingTarget.clear(),V=!0;try{e=(0,_.LJ)(this._trackingTarget,s)}catch(e){throw console.error(e),e}finally{V=!1}return(0,R.KF)(this,e),e},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{this._readyForTrueRender=!0,this._postInitialize()}))),n=this._resourcesFetch,O.add(n),n.finally((()=>O.delete(n)))}normalizeCtorArgs(e,t){const i={...e};return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then((()=>{})).catch(d.H9)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||((0,u.SC)(this._trackingTarget),(0,u.SC)(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,(0,R.w7)(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return(0,s.L7)(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+F++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||((0,R.w7)(this),this._projector.scheduleRender())}classes(...e){return P.Sh.apply(this,e)}renderNow(){(0,R.w7)(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this._internalHandles.add((0,p.YP)((()=>this.viewModel),((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&(0,o.vT)(e)&&this._internalHandles.add(this._delegatedEventNames.map((t=>(0,o.on)(e,t,(e=>{this.emit(t,e)})))),"delegated-events")}),p.nn)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(d.H9),this.scheduleRender()};this._internalHandles.add([(0,I.qe)(e),(0,p.YP)((()=>this.uiStrings),e),(0,p.gx)((()=>this.container),(e=>{this.destroyed||this._attach(e)}),{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};z[M.$X]=!0,(0,r._)([(0,m.Cb)()],z.prototype,"_readyForTrueRender",void 0),(0,r._)([(0,m.Cb)({value:null})],z.prototype,"container",null),(0,r._)([(0,g.p)("container")],z.prototype,"castContainer",null),(0,r._)([(0,m.Cb)({aliasOf:"container"})],z.prototype,"domNode",void 0),(0,r._)([(0,m.Cb)()],z.prototype,"iconClass",void 0),(0,r._)([(0,m.Cb)()],z.prototype,"id",null),(0,r._)([(0,m.Cb)()],z.prototype,"label",void 0),(0,r._)([(0,m.Cb)()],z.prototype,"renderable",null),(0,r._)([(0,m.Cb)()],z.prototype,"uiStrings",void 0),(0,r._)([(0,m.Cb)()],z.prototype,"viewModel",void 0),(0,r._)([(0,m.Cb)()],z.prototype,"visible",void 0),(0,r._)([(0,m.Cb)()],z.prototype,"key",void 0),(0,r._)([(0,m.Cb)()],z.prototype,"children",void 0),(0,r._)([(0,m.Cb)()],z.prototype,"afterCreate",void 0),(0,r._)([(0,m.Cb)()],z.prototype,"afterUpdate",void 0),(0,r._)([(0,m.Cb)()],z.prototype,"afterRemoved",void 0),z=(0,r._)([(0,y.j)(D)],z);const B=z},68266:(e,t,i)=>{"use strict";i.d(t,{_:()=>o});var r=i(36663),s=i(81977),n=(i(7753),i(39994),i(7283),i(40266));const o=e=>{let t=class extends e{constructor(...e){super(...e),this.goToOverride=null,this.view=null}callGoTo(e){const{view:t}=this;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}};return(0,r._)([(0,s.Cb)()],t.prototype,"goToOverride",void 0),(0,r._)([(0,s.Cb)()],t.prototype,"view",void 0),t=(0,r._)([(0,n.j)("esri.widgets.support.GoTo")],t),t}},62199:(e,t,i)=>{"use strict";i.d(t,{MJ:()=>l,X6:()=>o});var r=i(19431),s=i(54956),n=i(26451);function o(e,t){const i=a(e.level),r=`h${i}`;return delete e.level,(0,n.u)(r,{...e,class:(0,s.Sh)("esri-widget__heading",e.class),role:"heading","aria-level":String(i)},t)}function a(e){return(0,r.uZ)(Math.ceil(e),1,6)}function l(e,t=1){return a(e+t)}},92165:(e,t,i)=>{"use strict";i.d(t,{h:()=>s});var r=i(54956);function s(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:n(e[t])}}}function n(e){return function(t,...i){!function(e){const{type:t}=e;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}(t)?e.call(this,t,...i):(0,r.pf)(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click())}}},34236:(e,t,i)=>{"use strict";function r(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}i.d(t,{H:()=>r})},31071:(e,t,i)=>{"use strict";function r(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:e.split(",").map((e=>e.trim()));i.push(...r)}}i.d(t,{s:()=>r})},26451:(e,t,i)=>{"use strict";i.d(t,{u:()=>a});var r=i(67181),s=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},n=function(e,t){for(var i=0,r=e.length;i<r;i++){var o=e[i];Array.isArray(o)?n(o,t):null!=o&&!1!==o&&(o.hasOwnProperty("vnodeSelector")||(o=s(o)),t.push(o))}},o=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(1===i.length&&"string"==typeof i[0])return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return n(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function a(e,t,...i){return"function"!=typeof e||(0,r.ZJ)(e)?o(e,t,...i):e(t,...i)}},67181:(e,t,i)=>{"use strict";i.d(t,{$X:()=>s,ZJ:()=>d,dh:()=>l});var r=i(23148);const s=Symbol("widget"),n=[],o={},a=new WeakMap;function l(e,t){let i=t.children;if(i&&i.length)for(let t=0;t<i.length;++t)i[t]=l(e,i[t]);else i=n;const r=t.vnodeSelector;if(d(r)){const s=t.properties||o,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:c,afterUpdate:u,afterRemoved:h,parentWidget:e,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return t}function c(e,t,i,{parentWidget:s,widgetConstructor:n,widgetProperties:o}){const l=new n(o);l.container=e,a.set(e,l),l.afterCreate?.(l,e),s._internalHandles.add((0,r.kB)((()=>h(e))))}function u(e,t,i,{widgetProperties:r}){const s=a.get(e);s&&(s.set(r),s.afterUpdate?.(s,e))}function h(e){const t=a.get(e);t&&(t.destroy(),a.delete(e))}function d(e){return"function"==typeof e&&e[s]}},67842:(e,t,i)=>{"use strict";i.d(t,{KF:()=>o,O9:()=>n,Uy:()=>s,w7:()=>a});const r=new Map;function s(){r.clear()}function n(e){return r.get(e)}function o(e,t){r.set(e,t)}function a(e){r.delete(e)}},13509:(e,t,i)=>{"use strict";function r(e){return e&&"function"==typeof e.render}function s(e){return e&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}i.d(t,{Qd:()=>r,o:()=>s}),i(92165),i(26451),i(54956)},54956:(e,t,i)=>{"use strict";i.d(t,{Sh:()=>be,vU:()=>Te,pV:()=>xe,pf:()=>Oe,dZ:()=>we,_q:()=>Me,w3:()=>Ae,Yo:()=>Ce});var r,s,n=Function.prototype,o=Object.prototype,a=n.toString,l=o.hasOwnProperty,c=a.call(Object),u=o.toString,h=(r=Object.getPrototypeOf,s=Object,function(e){return r(s(e))}),d={exports:{}},p={},f={exports:{}},m={};function g(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}var y=/javascript\s*\:/gim;m.whiteList={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1},m.getDefaultWhiteList=g,m.onAttr=function(e,t,i){},m.onIgnoreAttr=function(e,t,i){},m.safeAttrValue=function(e,t){return y.test(t)?"":t};var _=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},v=function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")},b=m,w=function(e,t){";"!==(e=v(e))[e.length-1]&&(e+=";");var i=e.length,r=!1,s=0,n=0,o="";function a(){if(!r){var i=_(e.slice(s,n)),a=i.indexOf(":");if(-1!==a){var l=_(i.slice(0,a)),c=_(i.slice(a+1));if(l){var u=t(s,o.length,l,c,i);u&&(o+=u+"; ")}}}s=n+1}for(;n<i;n++){var l=e[n];if("/"===l&&"*"===e[n+1]){var c=e.indexOf("*/",n+2);if(-1===c)break;s=(n=c+1)+1,r=!1}else"("===l?r=!0:")"===l?r=!1:";"===l?r||a():"\n"===l&&a()}return _(o)};function x(e){return null==e}function C(e){(e=function(e){var t={};for(var i in e)t[i]=e[i];return t}(e||{})).whiteList=e.whiteList||b.whiteList,e.onAttr=e.onAttr||b.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||b.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||b.safeAttrValue,this.options=e}C.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,i=t.whiteList,r=t.onAttr,s=t.onIgnoreAttr,n=t.safeAttrValue;return w(e,(function(e,t,o,a,l){var c=i[o],u=!1;if(!0===c?u=c:"function"==typeof c?u=c(a):c instanceof RegExp&&(u=c.test(a)),!0!==u&&(u=!1),a=n(o,a)){var h,d={position:t,sourcePosition:e,source:l,isWhite:u};return u?x(h=r(o,a,d))?o+":"+a:h:x(h=s(o,a,d))?void 0:h}}))};var T=C;!function(e,t){var i=m,r=T;for(var s in(t=e.exports=function(e,t){return new r(t).process(e)}).FilterCSS=r,i)t[s]=i[s]}(f,f.exports);var S={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1}},E=f.exports.FilterCSS,A=f.exports.getDefaultWhiteList,M=S;var O=new E;function R(e){return e.replace(P,"&lt;").replace(I,"&gt;")}var P=/</g,I=/>/g,L=/"/g,D=/&quot;/g,N=/&#([a-zA-Z0-9]*);?/gim,F=/&colon;?/gim,k=/&newline;?/gim,U=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,V=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,z=/u\s*r\s*l\s*\(.*/gi;function B(e){return e.replace(L,"&quot;")}function H(e){return e.replace(D,'"')}function j(e){return e.replace(N,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function G(e){return e.replace(F,":").replace(k," ")}function W(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return M.trim(t)}function Z(e){return W(e=G(e=j(e=H(e))))}function q(e){return R(e=B(e))}p.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},p.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}},p.onTag=function(e,t,i){},p.onIgnoreTag=function(e,t,i){},p.onTagAttr=function(e,t,i){},p.onIgnoreTagAttr=function(e,t,i){},p.safeAttrValue=function(e,t,i,r){if(i=Z(i),"href"===t||"src"===t){if("#"===(i=M.trim(i)))return"#";if("http://"!==i.substr(0,7)&&"https://"!==i.substr(0,8)&&"mailto:"!==i.substr(0,7)&&"tel:"!==i.substr(0,4)&&"data:image/"!==i.substr(0,11)&&"ftp://"!==i.substr(0,6)&&"./"!==i.substr(0,2)&&"../"!==i.substr(0,3)&&"#"!==i[0]&&"/"!==i[0])return""}else if("background"===t){if(U.lastIndex=0,U.test(i))return""}else if("style"===t){if(V.lastIndex=0,V.test(i))return"";if(z.lastIndex=0,z.test(i)&&(U.lastIndex=0,U.test(i)))return"";!1!==r&&(i=(r=r||O).process(i))}return q(i)},p.escapeHtml=R,p.escapeQuote=B,p.unescapeQuote=H,p.escapeHtmlEntities=j,p.escapeDangerHtml5Entities=G,p.clearNonPrintableCharacter=W,p.friendlyAttrValue=Z,p.escapeAttrValue=q,p.onIgnoreTagStripAll=function(){return""},p.StripTagBody=function(e,t){"function"!=typeof t&&(t=function(){});var i=!Array.isArray(e),r=[],s=!1;return{onIgnoreTag:function(n,o,a){if(function(t){return!!i||-1!==M.indexOf(e,t)}(n)){if(a.isClosing){var l="[/removed]",c=a.position+l.length;return r.push([!1!==s?s:a.position,c]),s=!1,l}return s||(s=a.position),"[removed]"}return t(n,o,a)},remove:function(e){var t="",i=0;return M.forEach(r,(function(r){t+=e.slice(i,r[0]),i=r[1]})),t+=e.slice(i)}}},p.stripCommentTag=function(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("\x3c!--",i);if(-1===r){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("--\x3e",r);if(-1===s)break;i=s+3}return t},p.stripBlankChar=function(e){var t=e.split("");return t=t.filter((function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)})),t.join("")},p.cssFilter=O,p.getDefaultCSSWhiteList=A;var $={},Y=S;function X(e){var t=Y.spaceIndex(e);if(-1===t)var i=e.slice(1,-1);else i=e.slice(1,t+1);return"/"===(i=Y.trim(i).toLowerCase()).slice(0,1)&&(i=i.slice(1)),"/"===i.slice(-1)&&(i=i.slice(0,-1)),i}function J(e){return"</"===e.slice(0,2)}var K=/[^a-zA-Z0-9_:\.\-]/gim;function Q(e,t){for(;t<e.length;t++){var i=e[t];if(" "!==i)return"="===i?t:-1}}function ee(e,t){for(;t>0;t--){var i=e[t];if(" "!==i)return"="===i?t:-1}}function te(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}$.parseTag=function(e,t,i){var r="",s=0,n=!1,o=!1,a=0,l=e.length,c="",u="";e:for(a=0;a<l;a++){var h=e.charAt(a);if(!1===n){if("<"===h){n=a;continue}}else if(!1===o){if("<"===h){r+=i(e.slice(s,a)),n=a,s=a;continue}if(">"===h){r+=i(e.slice(s,n)),c=X(u=e.slice(n,a+1)),r+=t(n,r.length,c,u,J(u)),s=a+1,n=!1;continue}if('"'===h||"'"===h)for(var d=1,p=e.charAt(a-d);""===p.trim()||"="===p;){if("="===p){o=h;continue e}p=e.charAt(a-++d)}}else if(h===o){o=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r},$.parseAttr=function(e,t){var i=0,r=[],s=!1,n=e.length;function o(e,i){if(!((e=(e=Y.trim(e)).replace(K,"").toLowerCase()).length<1)){var s=t(e,i||"");s&&r.push(s)}}for(var a=0;a<n;a++){var l,c=e.charAt(a);if(!1!==s||"="!==c)if(!1===s||a!==i||'"'!==c&&"'"!==c||"="!==e.charAt(a-1)){if(/\s|\n|\t/.test(c)){if(e=e.replace(/\s|\n|\t/g," "),!1===s){if(-1===(l=Q(e,a))){o(Y.trim(e.slice(i,a))),s=!1,i=a+1;continue}a=l-1;continue}if(-1===(l=ee(e,a-1))){o(s,te(Y.trim(e.slice(i,a)))),s=!1,i=a+1;continue}}}else{if(-1===(l=e.indexOf(c,a+1)))break;o(s,Y.trim(e.slice(i+1,l))),s=!1,i=(a=l)+1}else s=e.slice(i,a),i=a+1}return i<e.length&&(!1===s?o(e.slice(i)):o(s,te(Y.trim(e.slice(i))))),Y.trim(r.join(" "))};var ie=f.exports.FilterCSS,re=p,se=$,ne=se.parseTag,oe=se.parseAttr,ae=S;function le(e){return null==e}function ce(e){(e=function(e){var t={};for(var i in e)t[i]=e[i];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=re.onIgnoreTagStripAll),e.whiteList=e.whiteList||e.allowList||re.whiteList,e.onTag=e.onTag||re.onTag,e.onTagAttr=e.onTagAttr||re.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||re.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||re.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||re.safeAttrValue,e.escapeHtml=e.escapeHtml||re.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new ie(e.css))}ce.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,i=t.whiteList,r=t.onTag,s=t.onIgnoreTag,n=t.onTagAttr,o=t.onIgnoreTagAttr,a=t.safeAttrValue,l=t.escapeHtml,c=this.cssFilter;t.stripBlankChar&&(e=re.stripBlankChar(e)),t.allowCommentTag||(e=re.stripCommentTag(e));var u=!1;t.stripIgnoreTagBody&&(u=re.StripTagBody(t.stripIgnoreTagBody,s),s=u.onIgnoreTag);var h=ne(e,(function(e,t,u,h,d){var p,f={sourcePosition:e,position:t,isClosing:d,isWhite:i.hasOwnProperty(u)};if(!le(p=r(u,h,f)))return p;if(f.isWhite){if(f.isClosing)return"</"+u+">";var m=function(e){var t=ae.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var i="/"===(e=ae.trim(e.slice(t+1,-1)))[e.length-1];return i&&(e=ae.trim(e.slice(0,-1))),{html:e,closing:i}}(h),g=i[u],y=oe(m.html,(function(e,t){var i,r=-1!==ae.indexOf(g,e);return le(i=n(u,e,t,r))?r?(t=a(u,e,t,c))?e+'="'+t+'"':e:le(i=o(u,e,t,r))?void 0:i:i}));return h="<"+u,y&&(h+=" "+y),m.closing&&(h+=" /"),h+">"}return le(p=s(u,h,f))?l(h):p}),l);return u&&(h=u.remove(h)),h};var ue=ce;!function(e,t){var i=p,r=$,s=ue;function n(e,t){return new s(t).process(e)}for(var o in(t=e.exports=n).filterXSS=n,t.FilterXSS=s,i)t[o]=i[o];for(var o in r)t[o]=r[o];"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=e.exports)}(d,d.exports);var he,de,pe=function(){function e(e,t){var i,r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(e,t,i,s){return"a"===e&&"href"===t||("img"===e||"source"===e)&&"src"===t?r.sanitizeUrl(i):d.exports.safeAttrValue(e,t,i,s)}},e&&!t?i=e:e&&t?(i=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach((function(t){"whiteList"===t?i.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]):i[t]=e[t]}))):(i=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,this.xssFilterOptions=i,this._xssFilter=new d.exports.FilterXSS(i)}return e.prototype.sanitize=function(e,t){switch(void 0===t&&(t={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,t);default:if(t.allowUndefined&&void 0===e)return;return null}},e.prototype.sanitizeUrl=function(e,t){var i=(null!=t?t:{}).isProtocolRequired,r=void 0===i||i,s=this._trim(e.substring(0,e.indexOf(":"))),n="/"===e,o=/^#/.test(e),a=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return n||o||a?d.exports.escapeAttrValue(e):s||r?"":d.exports.escapeAttrValue("https://".concat(e))},e.prototype.sanitizeHTMLAttribute=function(e,t,i,r){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(e,t,i,r):d.exports.safeAttrValue(e,t,i,r)},e.prototype.validate=function(e,t){void 0===t&&(t={});var i=this.sanitize(e,t);return{isValid:e===i,sanitized:i}},e.prototype._extendObjectOfArrays=function(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(i){Array.isArray(e[i])&&Array.isArray(t[i])?t[i]=t[i].concat(e[i]):t[i]=e[i]}))})),t},e.prototype._iterateOverObject=function(e,t){var i=this;void 0===t&&(t={});try{var r=!1,s=void 0;if(Array.isArray(e))s=e.reduce((function(e,s){var n=i.validate(s,t);return n.isValid?e.concat([s]):(r=!0,e.concat([n.sanitized]))}),[]);else{if(!function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=u.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=h(e);if(null===t)return!0;var i=l.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&a.call(i)==c}(e)){if(t.allowUndefined&&void 0===e)return;return null}s=Object.keys(e).reduce((function(s,n){var o=e[n],a=i.validate(o,t);return a.isValid?s[n]=o:(r=!0,s[n]=a.sanitized),s}),{})}return r?s:e}catch(e){return null}},e.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},e}(),fe=i(50904),me=(i(23148),i(39994),i(13802)),ge=i(67842),ye=function(e){he||function(e){if("WebkitTransition"in e.style)he="webkitTransitionEnd",de="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");he="transitionend",de="animationend"}}(e)},_e=function(e,t){return void 0===t&&(t=e+"-active"),function(i){ye(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(he,s),i.removeEventListener(de,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(he,s),i.addEventListener(de,s),requestAnimationFrame((function(){i.classList.add(t)}))}},ve=function(e,t){return void 0===t&&(t=e+"-active"),function(i,r){ye(i);var s=!1,n=function(e){s||(s=!0,i.removeEventListener(he,n),i.removeEventListener(de,n),r())};i.classList.add(e),i.addEventListener(he,n),i.addEventListener(de,n),requestAnimationFrame((function(){i.classList.add(t)}))}};me.Z.getLogger("esri.widgets.support.widgetUtils");function be(e){const t=fe.Z.acquire();for(let e=0;e<arguments.length;e++){const i=arguments[e],r=typeof i;if("string"===r)t.push(i);else if(Array.isArray(i))t.push.apply(t,i);else if("object"===r)for(const e in i)i[e]&&t.push(e)}const i=t.join(" ");return fe.Z.release(t),i}function we(e){const t=e?.closest("[dir]");return null!==t&&t instanceof HTMLElement&&"rtl"===t.dir||"rtl"===document.dir}function xe(e){this[e.getAttribute("data-node-ref")]=null}function Ce(e){this[e.getAttribute("data-node-ref")]=e}function Te(e,t){return("enter"===e?_e:ve)(t)}(()=>{const e=new Map;new ResizeObserver((t=>{(0,ge.Uy)();for(const i of t)e.get(i.target)(i)}))})();const Se=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((e,t)=>(e[t]=[],e)),{}),Ee=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Ae=new pe({whiteList:Se,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(Ee.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function Me(e,t){const i=e.getBoundingClientRect(),r=t.getBoundingClientRect(),s=i.top+i.height,n=r.top+r.height,o=i.top,a=r.top;(s>n||o<a)&&e.scrollIntoView({block:"end"})}function Oe(e){return"Enter"===e||" "===e}}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return i[e](n,n.exports,s),n.exports}s.m=i,s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,i)=>(s.f[i](e,t),t)),[])),s.u=e=>"chunks/"+e+".js",s.miniCssF=e=>{},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="berlin-equal-street-names:",s.l=(i,r,n,o)=>{if(e[i])e[i].push(r);else{var a,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+n){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",t+n),a.src=i),e[i]=[r];var d=(t,r)=>{a.onerror=a.onload=null,clearTimeout(p);var s=e[i];if(delete e[i],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(r))),t)return t(r)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="",(()=>{var e={4826:0};s.f.j=(t,i)=>{var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var n=new Promise(((i,s)=>r=e[t]=[i,s]));i.push(r[2]=n);var o=s.p+s.u(t),a=new Error;s.l(o,(i=>{if(s.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var n=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+n+": "+o+")",a.name="ChunkLoadError",a.type=n,a.request=o,r[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,n,[o,a,l]=i,c=0;if(o.some((t=>0!==e[t]))){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);l&&l(s)}for(t&&t(i);c<o.length;c++)n=o[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0},i=self.webpackChunkberlin_equal_street_names=self.webpackChunkberlin_equal_street_names||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e,t=s(36663),i=s(88355),r=s(30936),n=s(41831),o=s(58811),a=s(27755),l=s(70375),c=s(82064),u=s(67134),h=s(68309),d=s(63592),p=s(13802),f=s(78668),m=s(81977),g=s(7283),y=s(40266),_=s(39835),v=s(7753),b=s(39994),w=(s(33156),s(79438));let x=e=class extends c.wq{constructor(e){super(e),this.type="none"}clone(){return new e({type:this.type})}};(0,t._)([(0,w.J)({none:"none",stayAbove:"stay-above"})],x.prototype,"type",void 0),x=e=(0,t._)([(0,y.j)("esri.ground.NavigationConstraint")],x);var C,T=s(78621);const S=p.Z.getLogger("esri.Ground");let E=C=class extends((0,c.eC)(h.Z)){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new n.Z;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"!==e.type&&"base-elevation"!==e.type&&S.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>(e=>{e.parent=null})(e.item)))}initialize(){this.when().catch((e=>{S.error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",(0,o.Z)(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e?(r={...r,layerContainerType:"ground"},e.forEach((e=>{if("write"in e){const t={};(0,a.sM)(e)().write(t,r)&&s.push(t)}else r&&r.messages&&r.messages.push(new l.Z("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in the ground`,{layer:e}))})),t.layers=s):t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,d.G)(this,(e=>{e(this.layers)}))}async queryElevation(e,t){await this.load({signal:t?.signal});const{ElevationQuery:i}=await s.e(8184).then(s.bind(s,8184));(0,f.k_)(t);const r=new i,n=this.layers.filter(A).toArray();return r.queryAll(n,e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{ElevationQuery:i}=await s.e(8184).then(s.bind(s,8184));(0,f.k_)(t);const r=new i,n=this.layers.filter(A).toArray();return r.createSamplerAll(n,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:(0,u.d9)(this.surfaceColor),navigationConstraint:(0,u.d9)(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new C({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",n=t&&t.portal||null,o=t&&t.url||null;return s.e(5423).then(s.bind(s,45423)).then((({populateOperationalLayers:t})=>{(0,f.k_)(i);const s=[];if(e.layers&&Array.isArray(e.layers)){const i={context:{origin:r,url:o,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};s.push(t(this.layers,e.layers,i))}return(0,f.as)(s)})).then((()=>{}))}};function A(e){return"elevation"===e.type||function(e){return e&&"createElevationSampler"in e}(e)}(0,t._)([(0,m.Cb)({json:{read:!1}})],E.prototype,"layers",null),(0,t._)([(0,_.c)("layers")],E.prototype,"writeLayers",null),(0,t._)([(0,m.Cb)({readOnly:!0})],E.prototype,"resourceInfo",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:g.z8,read:{reader:T.b,source:"transparency"},write:{writer:(e,t)=>{t.transparency=(0,T.a)(e)},target:"transparency"}}})],E.prototype,"opacity",void 0),(0,t._)([(0,m.Cb)({type:r.Z,json:{type:[g.z8],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],E.prototype,"surfaceColor",void 0),(0,t._)([(0,m.Cb)({type:x,json:{write:!0}})],E.prototype,"navigationConstraint",void 0),E=C=(0,t._)([(0,y.j)("esri.Ground")],E);const M=E;var O=s(53443),R=s(81739),P=s(31355),I=s(61681),L=s(69236);function D(e){return!(!(e&&e.loaded&&"capabilities"in e&&e?.capabilities?.operations&&"supportsEditing"in e.capabilities.operations&&!0===e.capabilities.operations.supportsEditing)||"editingEnabled"in e&&!e.editingEnabled)}var N=s(51366),F=s(3466),k=s(2725);const U=p.Z.getLogger("esri.support.basemapUtils");var V=s(42228);const z=p.Z.getLogger("esri.support.groundUtils"),B={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};var H=s(9008),j=s(98234);let G=class extends((0,j.Q)((0,H.K)(P.Z.EventedMixin(O.Z)))){constructor(e){super(e),this.allLayers=new R.Z({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:e=>"layers"in e?e.layers:null}),this.allTables=(0,V.a)(this),this.basemap=null,this.editableLayers=new R.Z({getCollections:()=>[this.allLayers],itemFilterFunction:D}),this.ground=new M,this._basemapCache={}}destroy(){this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.ground?.destroy(),this.basemap?.destroy(),function(e){for(const t in e){const i=e[t];!1===i?.destroyed&&i.destroy(),delete e[t]}}(this._basemapCache),this._basemapCache=null}castBasemap(e){return function(e,t){let r;if("string"==typeof e){if(!(e in k.s)){const t=Object.entries(k.s).filter((([e,t])=>N.Z.apiKey&&!t.classic||!N.Z.apiKey&&t.classic&&!t.deprecated)).map((([e])=>`"${e}"`)).join(", ");return U.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`),null}t&&(r=t[e]),r||(r=i.default.fromId(e),t&&(t[e]=r))}else r=(0,g.se)(i.default,e);return r?.destroyed&&(U.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}(e,this._basemapCache)}castGround(e){const t=function(e){let t=null;return"string"==typeof e?e in B?t=new M({resourceInfo:{data:{layers:[B[e]]}}}):z.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`):t=(0,g.se)(M,e),t}(e);return(0,I.Wi)(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find((t=>t.id===e))}findTableById(e){return this.allTables.find((t=>t.id===e))}};(0,t._)([(0,m.Cb)({readOnly:!0,dependsOn:[]})],G.prototype,"allLayers",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],G.prototype,"allTables",void 0),(0,t._)([(0,m.Cb)({type:i.default})],G.prototype,"basemap",void 0),(0,t._)([(0,L.p)("basemap")],G.prototype,"castBasemap",null),(0,t._)([(0,m.Cb)({readOnly:!0})],G.prototype,"editableLayers",void 0),(0,t._)([(0,m.Cb)({type:M,nonNullable:!0})],G.prototype,"ground",void 0),(0,t._)([(0,L.p)("ground")],G.prototype,"castGround",null),G=(0,t._)([(0,y.j)("esri.Map")],G);const W=G;var Z=s(41151),q=s(16068),$=s(19431),Y=s(34248),X=s(53446);let J=class extends((0,Z.J)(c.wq)){constructor(...e){super(...e),this.position=new X.Z([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){const s={position:e};return null!=t&&(s.heading=t),null!=i&&(s.tilt=i),null!=r&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=(0,g.q9)(e.x||0),s.y=(0,g.q9)(e.y||0),s.z=e.hasZ?(0,g.q9)(e.z||0):e.z,t[i]=s.write({},r)}readPosition(e,t){const i=new X.Z;return i.read(e,t),i.x=(0,g.q9)(i.x||0),i.y=(0,g.q9)(i.y||0),i.z=i.hasZ?(0,g.q9)(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};(0,t._)([(0,m.Cb)({type:X.Z,json:{write:{isRequired:!0}}})],J.prototype,"position",void 0),(0,t._)([(0,_.c)("position")],J.prototype,"writePosition",null),(0,t._)([(0,Y.r)("position")],J.prototype,"readPosition",null),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,L.p)((e=>q.BV.normalize((0,g.q9)(e))))],J.prototype,"heading",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,L.p)((e=>(0,$.uZ)((0,g.q9)(e),-180,180)))],J.prototype,"tilt",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],J.prototype,"fov",void 0),J=(0,t._)([(0,y.j)("esri.Camera")],J);const K=J;var Q,ee=s(91957),te=s(80085),ie=s(53736);let re=Q=class extends c.wq{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new Q({rotation:this.rotation,scale:this.scale,targetGeometry:(0,I.pC)(this.targetGeometry)?this.targetGeometry.clone():null,camera:(0,I.pC)(this.camera)?this.camera.clone():null})}};function se(){return{enabled:!this.camera}}(0,t._)([(0,m.Cb)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:se}}}}})],re.prototype,"rotation",void 0),(0,t._)([(0,L.p)("rotation")],re.prototype,"castRotation",null),(0,t._)([(0,m.Cb)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:se}}}}})],re.prototype,"scale",void 0),(0,t._)([(0,m.Cb)({types:ee.qM,json:{read:ie.im,write:!0,origins:{"web-scene":{read:ie.im,write:{overridePolicy:se}}}}})],re.prototype,"targetGeometry",void 0),(0,t._)([(0,m.Cb)({type:K,json:{write:!0}})],re.prototype,"camera",void 0),re=Q=(0,t._)([(0,y.j)("esri.Viewpoint")],re);const ne=re;var oe=s(59183),ae=s(49546),le=s(23148),ce=s(99118),ue=s(98722),he=s(76868),de=s(17262),pe=s(95550),fe=s(47109),me=s(8909),ge=s(4637),ye=s(64307),_e=s(90472),ve=s(24568),be=s(96739),we=s(47190),xe=s(68577),Ce=s(54957);const Te=p.Z.getLogger("esri.support.AnalysesCollection");let Se=class extends ge.a{constructor(e){super(e),this.handles.add(this.on("before-add",(e=>{(0,I.Wi)(e.item)||e.item.parent===this.owner&&(Te.warn("Analysis inside the collection must be unique. Not adding this element again."),e.preventDefault())})))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Se=(0,t._)([(0,y.j)("esri.support.AnalysesCollection")],Se);var Ee=s(50904),Ae=s(44584);const Me={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Oe={xsmall:544,small:768,medium:992,large:1200};function Re(e,t){return t?Me[e].valueToClassName[t].split(" "):[]}const Pe=e=>{let i=class extends e{constructor(...e){super(...e),this._breakpointsHandles=new Ae.Z,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Oe}initialize(){this._breakpointsHandles.add((0,he.YP)((()=>[this.breakpoints,this.size]),(()=>this._updateClassNames()),he.nn))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=(0,I.SC)(this._breakpointsHandles))}set breakpoints(e){if(e===this._get("breakpoints"))return;const t=function(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(e);if(!t){const e=JSON.stringify(Oe,null,2);console.warn("provided breakpoints are not valid, using defaults:"+e)}e=t?e:Oe,this._set("breakpoints",{...e})}_updateClassNames(){if(!this.container)return;const e=Ee.Z.acquire(),t=Ee.Z.acquire();let i,r=!1;for(i in Me){const s=this[i],n=Me[i].getValue({viewSize:this.size,breakpoints:this.breakpoints});s!==n&&(r=!0,this[i]=n,Re(i,s).forEach((e=>t.push(e))),Re(i,n).forEach((t=>e.push(t))))}r&&(this._applyClassNameChanges(e,t),Ee.Z.release(e),Ee.Z.release(t))}_applyClassNameChanges(e,t){const i=this.container;i&&(t.forEach((e=>i.classList.remove(e))),e.forEach((e=>i.classList.add(e))))}_removeActiveClassNames(){const e=this.container;if(!e)return;let t;for(t in Me)Re(t,this[t]).forEach((t=>e.classList.remove(t)))}};return(0,t._)([(0,m.Cb)()],i.prototype,"breakpoints",null),(0,t._)([(0,m.Cb)()],i.prototype,"orientation",void 0),(0,t._)([(0,m.Cb)()],i.prototype,"widthBreakpoint",void 0),(0,t._)([(0,m.Cb)()],i.prototype,"heightBreakpoint",void 0),i=(0,t._)([(0,y.j)("esri.views.BreakpointsOwner")],i),i};var Ie=s(37599),Le=s(27127),De=s(56397),Ne=s(54565);const Fe=p.Z.getLogger("esri.views.support.GroundViewElevationSampler");let ke=class extends P.Z.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=Ne.$7}initialize(){this.view.basemapTerrain.on("elevation-change",(()=>this.emit("changed",{})))}get extent(){const e=this.view.basemapTerrain;if((0,I.Wi)(e.extent)||!e.spatialReference)return null;const t=(0,ve.HH)(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if((0,I.Wi)(this.extent)||!(0,Le.Kv)(this.extent,e,t)){const i=(0,I.pC)(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return Fe.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return(0,I.Pt)(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return(0,De.G$)(e.clone(),this)}};(0,t._)([(0,m.Cb)({readOnly:!0})],ke.prototype,"demResolution",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ke.prototype,"extent",null),(0,t._)([(0,m.Cb)({readOnly:!0})],ke.prototype,"noDataValue",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],ke.prototype,"spatialReference",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],ke.prototype,"view",void 0),ke=(0,t._)([(0,y.j)("esri.views.support.GroundViewElevationSampler")],ke);const Ue=ke;let Ve=class extends O.Z{constructor(e){super(e),this.handles=new Ae.Z,this.view=null,this.layerViews=new n.Z}initialize(){this.handles.add((0,he.gx)((()=>this.view?.map?.ground),(e=>e.load()))),this.handles.add(this.layerViews.on("after-changes",(()=>this._layerViewsAfterChangesHandler())))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?"2d"===this.view.type?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Ue({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some((e=>e.updating))}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map((e=>(0,he.YP)((()=>e.updating),(()=>this._updateUpdating()),he.Z_))).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};(0,t._)([(0,m.Cb)({readOnly:!0})],Ve.prototype,"elevationSampler",null),(0,t._)([(0,m.Cb)({type:Boolean,readOnly:!0})],Ve.prototype,"updating",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],Ve.prototype,"view",void 0),(0,t._)([(0,m.Cb)({type:n.Z,readOnly:!0})],Ve.prototype,"layerViews",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],Ve.prototype,"suspended",null),Ve=(0,t._)([(0,y.j)("esri.views.GroundView")],Ve);const ze=Ve,Be=e=>{let i=class extends e{async fetchPopupFeatures(e,t){await this.when();const{location:i,queryArea:r,layerViewsAndGraphics:s,clientOnlyGraphics:n}=await this._prepareFetchPopupFeatures(e,t),o=Promise.resolve(n),a=this._queryLayerPopupFeatures(r,s,t),l=a.map((e=>e.promise));return{location:i,clientOnlyGraphics:n,allGraphicsPromise:(0,f.WW)([o,...l]).then((e=>Array.from(new Set(e.flat())))),promisesPerLayerView:a}}_queryLayerPopupFeatures(e,t,i){return t.map((({layerView:t,graphics:r})=>{const s={clientGraphics:r,event:(0,I.pC)(i)?i.event:null,signal:(0,I.pC)(i)?i.signal:null,defaultPopupTemplateEnabled:!!(0,I.pC)(i)&&!!i.defaultPopupTemplateEnabled},n=t.fetchPopupFeatures(e,s);return{layerView:t,promise:n}}))}_isValidPopupGraphic(e,t){return e&&!!e.getEffectivePopupTemplate((0,I.pC)(t)&&t.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(e,t){const{clientGraphics:i,queryArea:r,location:s}=await this._popupHitTestGraphics(e,t),n=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:o,clientOnlyGraphics:a}=this._graphicsPerFetchPopupLayerView(i,n);return{clientOnlyGraphics:a,layerViewsAndGraphics:o,queryArea:r,location:s}}async _popupHitTestGraphics(e,t){const{results:i,mapPoint:r}=await this.popupHitTest(e),s=i.filter((e=>"graphic"===e.type&&this._isValidPopupGraphic(e.graphic,t))),n=s.length?s[0].mapPoint:null;return{clientGraphics:s.map((e=>e.graphic)),queryArea:r,location:r||n}}_getFetchPopupLayerViews(){const e=[];return this.allLayerViews.forEach((t=>{this._isValidPopupLayerView(t)&&e.push(t)})),(0,I.pC)(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&e.push(this.graphicsView),e.reverse()}_isValidPopupLayerView(e){return(0,I.pC)(e)&&(!("layer"in e)||!e.suspended)&&"fetchPopupFeatures"in e}_graphicsPerFetchPopupLayerView(e,t){const i=[],r=new Map,s=t.map((e=>{const t=[];return"layer"in e?r.set(e.layer,t):r.set(e.graphics,t),{layerView:e,graphics:t}}));for(const t of e){const e=r.get(t.layer)||r.get(t.sourceLayer)||null;e?e.push(t):i.push(t)}return{layerViewsAndGraphics:s,clientOnlyGraphics:i}}};return i=(0,t._)([(0,y.j)("esri.views.PopupView")],i),i};var He=s(37956),je=s(53280),Ge=s(64189),We=s(42730),Ze=s(91772),qe=s(14685),$e=s(35925),Ye=s(94449);let Xe=class extends O.Z{constructor(e){super(e),this.view=null,this.baseLayerViews=new n.Z,this.referenceLayerViews=new n.Z,this._loadingHandle=(0,he.YP)((()=>this.view?.map?.basemap),(e=>{e&&e.load().catch((()=>{}))}),he.nn)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view&&this.view.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some((e=>e.updating))||this.referenceLayerViews.some((e=>e.updating)))}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Xe.prototype,"view",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],Xe.prototype,"baseLayerViews",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],Xe.prototype,"referenceLayerViews",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],Xe.prototype,"suspended",null),(0,t._)([(0,m.Cb)({type:Boolean,readOnly:!0})],Xe.prototype,"updating",null),Xe=(0,t._)([(0,y.j)("esri.views.BasemapView")],Xe);var Je=s(86114),Ke=s(81589);const Qe=p.Z.getLogger("esri.views.LayerViewManager");class et{constructor(e,t,i){this.layer=e,this.view=t,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=(0,f.dD)(),this._started=!1,this.done=!1,(0,f.fu)(this._controller.signal,(()=>{const t=new l.Z("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:t,view:i}=this;t.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:i}=this;this._map=i.map;try{let r,s;if(await t.load({signal:e}),"prefetchResources"in t&&await t.prefetchResources({signal:e}),t.createLayerView)r=await t.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new l.Z("layer:view-not-supported","No layerview implementation was found");const s=await this.layerViewImporter.importLayerView(t);(0,f.k_)(e),r="default"in s?new s.default({layer:t,view:i}):new s({layer:t,view:i})}const n=()=>{s=(0,I.hw)(s),r.destroyed||r.destroy(),r.layer=null,r.parent=null,r.view=null,this.done=!0};s=(0,f.fu)(e,n),(0,f.k_)(e);try{await r.when()}catch(e){throw n(),e}const o=this._map?.allLayers?.includes(t);if(!o)return n(),void this._deferred.reject(new l.Z("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=r,t.emit("layerview-create",{view:i,layerView:r}),i.emit("layerview-create",{layer:t,layerView:r}),this.done=!0,this._deferred.resolve(r)}catch(e){t.emit("layerview-create-error",{view:i,error:e}),i.emit("layerview-create-error",{layer:t,error:e}),this.done=!0,this._deferred.reject(new l.Z("layerview:create-error","layerview creation failed",{layer:t,error:e}))}}}let tt=class extends je.r{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new Ke.t,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const e=this.view.map?.allLayers;if(e)for(const t of e)this.layerViewImporter.hasLayerViewModule(t)&&this.layerViewImporter.importLayerView(t)},this._reschedule=()=>((0,I.Wi)(this._workPromise)&&(this._workPromise=(0,f.dD)()),this.handles.remove("reschedule"),this.handles.add((0,de.Os)(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{const e=this.view.map;if(this._map!==e&&(this.clear(),this._map=e),(0,I.Wi)(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const t=new R.Z({getCollections:()=>this._rootCollectionNames.map((e=>this.get(e))),getChildrenFunction:e=>e&&"layers"in e?e.layers:null});if(!t)return this._workPromise.resolve(),void(this._workPromise=null);for(const e of t)this._createLayerView(e);this._refreshCollections();for(const[e,i]of this._layerLayerViewInfoMap)t.includes(e)||(this._layerLayerViewInfoMap.delete(i.layer),i.destroy());const i=t.filter((e=>"group"===e.type)).map((e=>e.layers)),r=[e?.ground?.layers,e?.basemap?.baseLayers,e?.basemap?.referenceLayers,e?.layers,...i].filter((e=>!!e));this.handles.add(r.map((e=>this._watchUpdatingTracking.addOnCollectionChange((()=>e),this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([(0,he.on)((()=>this.view?.map?.allLayers),"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),(0,he.YP)((()=>{const e=this.view,t=e?.map;return[t?.basemap,t?.ground,t?.layers,e?.ready]}),(()=>this._reschedule()),he.tX)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return(0,I.pC)(this._workPromise)||this._watchUpdatingTracking.updating||(0,Je.oE)(this._layerLayerViewInfoMap,(e=>!e.done))}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new l.Z("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const e=this._layerLayerViewInfoMap.get(s);if(!e||!e.layerView)continue;const n=e.layerView;n.layer=s,n.parent=i,t.getItemAt(r)!==n&&t.splice(r,0,n),s.layers&&this._populateLayerViewsOwners(s.layers,n.layerViews,n),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new et(e,this.view,this.layerViewImporter);t.promise.then((()=>this._refreshCollections()),(t=>{t&&((0,f.D_)(t)||"cancelled:layerview-create"===t.name)||Qe.error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};(0,t._)([(0,m.Cb)()],tt.prototype,"_workPromise",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],tt.prototype,"_watchUpdatingTracking",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],tt.prototype,"_layersToLayerViews",null),(0,t._)([(0,m.Cb)({readOnly:!0})],tt.prototype,"_rootCollectionNames",null),(0,t._)([(0,m.Cb)()],tt.prototype,"layerViewImporter",void 0),(0,t._)([(0,m.Cb)()],tt.prototype,"supportsGround",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],tt.prototype,"updating",null),(0,t._)([(0,m.Cb)({readOnly:!0})],tt.prototype,"updatingRemaining",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],tt.prototype,"view",void 0),tt=(0,t._)([(0,y.j)("esri.views.LayerViewManager")],tt);const it=tt;let rt=class extends O.Z{constructor(e){super(e),this.factor=1.5,this.offset=(0,pe.vW)(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};(0,t._)([(0,m.Cb)({type:Number})],rt.prototype,"factor",void 0),(0,t._)([(0,m.Cb)({nonNullable:!0})],rt.prototype,"offset",void 0),(0,t._)([(0,m.Cb)()],rt.prototype,"position",void 0),(0,t._)([(0,m.Cb)({type:Number,range:{min:0}})],rt.prototype,"size",void 0),(0,t._)([(0,m.Cb)()],rt.prototype,"maskUrl",void 0),(0,t._)([(0,m.Cb)()],rt.prototype,"maskEnabled",void 0),(0,t._)([(0,m.Cb)()],rt.prototype,"overlayUrl",void 0),(0,t._)([(0,m.Cb)()],rt.prototype,"overlayEnabled",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],rt.prototype,"version",null),(0,t._)([(0,m.Cb)({type:Boolean})],rt.prototype,"visible",void 0),rt=(0,t._)([(0,y.j)("esri.views.Magnifier")],rt);const st=rt;var nt=s(22167);let ot=class extends O.Z{constructor(e,t){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=t?.registerTask(nt.T8.TEXTURE_UNLOAD)??nt.sq}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach((e=>this._releaseTextureRequest(e))),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule((()=>this._releaseNow(e)))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.onRemove&&e.onRemove(),e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return(0,I.pC)(t)?`${e}.${t}px`:e}};(0,t._)([(0,m.Cb)()],ot.prototype,"_frameTask",void 0),(0,t._)([(0,m.Cb)()],ot.prototype,"updating",null),ot=(0,t._)([(0,y.j)("esri.views.3d.support.TextureCollection")],ot);var at=s(15331),lt=s(3846),ct=s(91258);const ut=p.Z.getLogger("esri.views.interactive.interactiveToolUtils");function ht(e){return e.visible&&e.getEditableFlag(ct.bH.USER)&&e.getEditableFlag(ct.bH.MANAGER)}var dt=s(38114);class pt{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,t){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":ft(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!mt(e))break;const r=(0,dt.vT)(e),s=this._intersect(r,e.pointerType,t.forEachTool);if((0,I.Wi)(s))break;const n=this._findToolAndManipulatorByKey(s,t.forEachTool,gt),o=(0,I.yw)(n,(e=>e.manipulator)),a=(0,I.yw)(n,(e=>e.tool));!((0,I.pC)(o)&&(0,I.pC)(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,a,e),(0,I.pC)(o)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:s,start:r,pointerType:e.pointerType}),1===this._grabbedManipulators.size&&t.activeTool!==s.tool&&(this._currentlyActiveTool=t.activeTool,this._revertToActiveTool=!0,t.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:r}),i());break}case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!mt(e))break;const r=this._grabbedManipulators.get(e.pointerId),s=this._draggedManipulators.get(e.pointerId),n=(0,I.yw)(r||s,(({key:e})=>e)),o=this._findManipulatorByKey(n,t.forEachTool);if((0,I.Wi)(o))break;const a=(0,dt.vT)(e);a.x=(0,$.uZ)(a.x,0,t.view.width),a.y=(0,$.uZ)(a.y,0,t.view.height);const l=(0,I.Wg)(r||s).start;switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(o.dragging=!0,s?o.events.emit("drag",{action:"update",start:l,screenPoint:a}):o.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{key:(0,I.Wg)(n),start:l}));break;case"end":o.dragging=!1,s&&o.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}i();break}case"immediate-click":{const r=(0,dt.vT)(e),s=this._intersect(r,e.pointerType,t.forEachTool),n=this._findToolAndManipulatorByKey(s,t.forEachTool,gt);if(function(e){return!!e.native.shiftKey}(e)||t.forEachTool((e=>{if((!(0,I.pC)(n)||n.tool!==e||e.automaticManipulatorSelection)&&e.manipulators){let t=!1;e.manipulators.forEach((({manipulator:e})=>{e.selected&&(e.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),(0,I.Wi)(n))break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.manipulatorSelectionChanged&&a.manipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const r=(0,dt.vT)(e),s=this._intersect(r,e.pointerType,t.forEachTool),n=this._findManipulatorByKey(s,t.forEachTool);if((0,I.Wi)(n)||!n.interactive)break;const o=e.native.shiftKey;n.events.emit(e.type,{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o}),i();break}case"double-click":{const r=(0,dt.vT)(e),s=this._intersect(r,e.pointerType,t.forEachTool),n=this._findManipulatorByKey(s,t.forEachTool);if((0,I.Wi)(n)||!n.interactive)break;const o=e.native.shiftKey;n.events.emit("double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i});break}case"immediate-double-click":{const r=(0,dt.vT)(e),s=this._intersect(r,e.pointerType,t.forEachTool),n=this._findManipulatorByKey(s,t.forEachTool);if((0,I.Wi)(n)||!n.interactive)break;const o=e.native.shiftKey;n.events.emit("immediate-double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i});break}}this._onFocusChange(t.forEachTool)}_ungrabManipulatorBeforeDragging(e,t,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:(0,dt.vT)(i)}),this._grabbedManipulators.forEach((({key:i},r)=>{i.tool===t&&t.manipulators.findById(i.manipulatorId)===e&&this._grabbedManipulators.delete(r)}))}_handlePointerEnd(e,t){const i=(0,I.yw)(this._grabbedManipulators.get(e.pointerId),(({key:e})=>e)),r=this._findManipulatorByKey(i,t.forEachTool);(0,I.pC)(r)&&!r.dragging&&(1===this._grabbedManipulators.size&&0===this._draggedManipulators.size&&this._revertToActiveTool&&(t.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:(0,dt.vT)(e)})),this._grabbedManipulators.delete(e.pointerId))}_cursorFromMap(e,t){let i=null;return(0,Je.oE)(e,(({key:e})=>{const r=this._findManipulatorByKey(e,t);return!!((0,I.pC)(r)&&r.interactive&&"cursor"in r&&r.cursor)&&(i=r.cursor,!0)})),i}_onFocusChange(e){this._updateCursor(e),this._updateFocusedManipulatorTools(e)}_updateCursor(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const t=new Set;this._grabbedManipulators.forEach((({key:{tool:e}})=>{t.add(e)})),this._hoveredManipulators.forEach((({key:{tool:e}})=>{t.add(e)})),e((e=>{e.hasFocusedManipulators=t.has(e)}))}clearPointers(e,t,i=!0,r){const s=t=>t.tool===e&&((0,I.Wi)(r)||t.manipulatorId===r);this._grabbedManipulators.forEach((({key:e,pointerType:i},r)=>{if(s(e)){this._grabbedManipulators.delete(r);const s=this._findManipulatorByKey(e,t);(0,I.pC)(s)&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:i}))}})),this._draggedManipulators.forEach((({key:e},i)=>{if(s(e)){this._draggedManipulators.delete(i);const r=this._findManipulatorByKey(e,t);(0,I.pC)(r)&&(r.dragging=!1,r.events.emit("drag",{action:"cancel"}))}})),i&&this._hoveredManipulators.forEach((({key:e},i)=>{if(s(e)){this._hoveredManipulators.delete(i);const r=this._findManipulatorByKey(e,t);(0,I.pC)(r)&&(r.hovering=!1)}})),this._onFocusChange(t)}_intersect(e,t,i){let r=null;return i((i=>{if(null==i.manipulators||!ht(i))return!1;const s=i.manipulators.intersect(e,t);return!(0,I.Wi)(s)&&(r={manipulatorId:s.id,tool:i},!0)})),r}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach(((t,i)=>{this._updateHoveredStateForPointerAtScreenPosition((0,pe.vW)(t.x,t.y),i,t.pointerType,e)}))}handleHoverEvent(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!ft(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition((0,dt.vT)(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,i,r){const s=this._intersect(e,i,r);let n=this._findManipulatorByKey(s,r);const o=(0,I.yw)(this._hoveredManipulators.get(t),(({key:e})=>e)),a=this._findManipulatorByKey(o,r);(0,I.pC)(n)&&!n.interactive&&(n=null),a!==n&&((0,I.pC)(a)&&(a.hovering=!1),(0,I.pC)(n)?(n.hovering=!0,this._hoveredManipulators.set(t,{key:(0,I.Wg)(s)})):this._hoveredManipulators.delete(t),this._onFocusChange(r))}_findManipulatorByKey(e,t){return this._findToolAndManipulatorByKey(e,t,gt)?gt.manipulator:null}_findToolAndManipulatorByKey(e,t,i){return(0,I.Wi)(e)?null:(i.tool=null,i.manipulator=null,t((t=>{if(t!==e.tool||null==t.manipulators||!ht(t))return!1;const r=t.manipulators.findById(e.manipulatorId);return!!(0,I.pC)(r)&&(i.manipulator=r,i.tool=t,!0)})),i.manipulator?i:null)}}function ft(e){return"mouse"===e}function mt(e){return"mouse"!==e.pointerType||0===e.button}const gt={manipulator:null,tool:null},yt=p.Z.getLogger("esri.views.ToolViewManager"),_t="attached",vt="tools";let bt=class extends je.r{constructor(e){super(e),this._manipulatorState=new pt,this.tools=new n.Z,this.cursor=null,this._forEachTool=e=>{for(const t of this.tools.items)if(e(t))return}}initialize(){var e;this.handles.add([this.view.on(lt.uS,(e=>{this._handleInputEvent(e)}),at.f.TOOL),...(e=this.tools,[e.on("before-add",(t=>{const i=t.item;if(null==i||e.includes(i))return ut.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()})),e.on("after-remove",(e=>{const t=e.item;t.visible=!1,t.active&&(t.view.activeTool=null),t.destroy()}))]),this.tools.on("before-remove",(({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if((0,I.pC)(e)&&!this.view.ready)return void yt.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),(0,I.pC)(t)&&t.deactivate(),(0,I.pC)(e)&&e.activate(),this._removeIncompleteTools(e);const i=(0,I.Wi)(this.activeTool);for(const e of this.tools){e.setEditableFlag(ct.bH.MANAGER,i||e===this.activeTool);const t=ht(e);!i&&t||this._manipulatorState.clearPointers(e,this._forEachTool,!t)}this._updateCursor()}get updating(){return this.updatingHandles.updating||this.tools.some((e=>e.updating))||(this.textures?.updating??!1)}attach(){"3d"===this.view.type?(this._set("textures",new ot(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([(0,he.YP)((()=>{const{state:e}=this.view;return"camera"in e&&e.camera}),(()=>{this._forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(e=>{this._forEachManipulator((t=>{null!=t.onElevationChange&&t.onElevationChange(e)}))})),(0,le.kB)((()=>this._set("textures",(0,I.SC)(this.textures))))],_t)):this.handles.add((0,he.YP)((()=>this.view.extent),(()=>{this._forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})))}detach(){(0,I.pC)(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(_t)}_forEachManipulator(e){this._forEachTool((t=>{t.manipulators&&t.manipulators.forEach((({manipulator:i})=>e(i,t)))}))}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};(0,I.pC)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((e=>{!t&&e.visible&&e.handleInputEvent(i)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}),!t&&(0,I.pC)(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(vt),this._forEachTool((e=>{if(e instanceof O.Z){const t=(0,he.YP)((()=>[e.cursor,e.visible,e.editable]),(()=>{ht(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()}));this.handles.add(t,vt)}e.manipulators&&this.handles.add(e.manipulators.on("change",(t=>{t.removed.forEach((({id:t})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,t)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})),vt)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const e=this._manipulatorState.cursor;let t=e;this._forEachTool((i=>!(!(0,I.pC)(i.cursor)||!i.visible||!(0,I.Wi)(e)&&i.preferManipulatorCursor||(t=i.cursor,0)))),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(e){this.tools.filter((t=>((0,I.Wi)(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel)).forEach((e=>{this.tools.remove(e)}))}};(0,t._)([(0,m.Cb)({constructOnly:!0,nonNullable:!0})],bt.prototype,"view",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,nonNullable:!0})],bt.prototype,"textures",void 0),(0,t._)([(0,m.Cb)({value:null})],bt.prototype,"activeTool",null),(0,t._)([(0,m.Cb)({readOnly:!0,type:n.Z})],bt.prototype,"tools",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],bt.prototype,"cursor",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],bt.prototype,"updating",null),bt=(0,t._)([(0,y.j)("esri.views.ToolViewManager")],bt);const wt=bt;let xt=class extends O.Z{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown","standard"===e.mapping?this._detectedDeviceType="standard":Ct.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Tt[this.deviceType]}};(0,t._)([(0,m.Cb)({nonNullable:!0,readOnly:!0})],xt.prototype,"nativeIndex",void 0),(0,t._)([(0,m.Cb)({type:String,readOnly:!0})],xt.prototype,"deviceType",null),(0,t._)([(0,m.Cb)({type:Number,readOnly:!0})],xt.prototype,"axisThreshold",null),xt=(0,t._)([(0,y.j)("esri.views.input.gamepad.GamepadInputDevice")],xt);const Ct=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Tt={standard:.15,spacemouse:.025,unknown:0},St=xt;let Et=class extends O.Z{constructor(...e){super(...e),this.devices=new n.Z,this.enabledFocusMode="document"}};(0,t._)([(0,m.Cb)({type:n.Z.ofType(St),readOnly:!0})],Et.prototype,"devices",void 0),(0,t._)([(0,m.Cb)({type:["document","view","none"]})],Et.prototype,"enabledFocusMode",void 0),Et=(0,t._)([(0,y.j)("esri.views.input.gamepad.GamepadSettings")],Et);const At=Et;let Mt=class extends O.Z{constructor(){super(...arguments),this.gamepad=new At}};(0,t._)([(0,m.Cb)({readOnly:!0})],Mt.prototype,"gamepad",void 0),Mt=(0,t._)([(0,y.j)("esri.views.input.Input")],Mt);const Ot=Mt;let Rt=class extends O.Z{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};(0,t._)([(0,m.Cb)({type:Boolean,nonNullable:!0})],Rt.prototype,"enabled",void 0),(0,t._)([(0,m.Cb)({type:St})],Rt.prototype,"device",void 0),(0,t._)([(0,m.Cb)({type:["pan","zoom"],nonNullable:!0})],Rt.prototype,"mode",void 0),(0,t._)([(0,m.Cb)({type:["forward-down","forward-up"],nonNullable:!0})],Rt.prototype,"tiltDirection",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0})],Rt.prototype,"velocityFactor",void 0),Rt=(0,t._)([(0,y.j)("esri.views.navigation.gamepad.GamepadSettings")],Rt);const Pt=Rt;let It=class extends O.Z{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Pt,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};(0,t._)([(0,m.Cb)({type:Boolean})],It.prototype,"browserTouchPanEnabled",void 0),(0,t._)([(0,m.Cb)({type:Pt,nonNullable:!0})],It.prototype,"gamepad",void 0),(0,t._)([(0,m.Cb)({type:Boolean})],It.prototype,"momentumEnabled",void 0),(0,t._)([(0,m.Cb)({type:Boolean})],It.prototype,"mouseWheelZoomEnabled",void 0),It=(0,t._)([(0,y.j)("esri.views.navigation.Navigation")],It);const Lt=It;var Dt=s(64862),Nt=s(65684);let Ft,kt=null;async function Ut(e){kt||(kt=Promise.resolve().then(s.bind(s,8060)).then((e=>Ft=e))),await kt,(0,f.k_)(e)}async function Vt(e,t,i,r){if(!e)return null;const s=e.spatialReference;return(0,_e.kR)()||(0,_e.Up)(s,t)?(0,_e.iV)(e,t):Ft?Ft.projectGeometry(e,t,i,r):(await Promise.race([Ut(r),(0,_e.zD)(r)]),Vt(e,t,i,r))}let zt=class extends O.Z{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=(0,I.IM)(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return(0,I.pC)(this.userSpatialReference)?this.userSpatialReference:(0,I.Wg)(this._spatialReferenceTask.spatialReference)}get extent(){return(0,I.Wg)(this._extentTask.extent)}get heightModelInfo(){return(0,I.Wg)(this._heightModelInfoTask.heightModelInfo)}get vcsWkid(){return(0,I.Wg)(this._heightModelInfoTask.vcsWkid)}get latestVcsWkid(){return(0,I.Wg)(this._heightModelInfoTask.latestVcsWkid)}get viewingMode(){return(0,I.Wi)(this.userSpatialReference)||this.userSpatialReference.equals((0,I.Wg)(this._spatialReferenceTask.spatialReference))?(0,I.Wg)(this._spatialReferenceTask.viewingMode):null}get tileInfo(){return(0,I.Wg)(this._tileInfoTask.tileInfo)}get mapCollections(){const e=this.map?.(),t=[];return(0,I.pC)(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;let i=null;for(const t of e){const e=this._getSupportedSpatialReferences(t);if(e.length>0){const t=this._narrowDownSpatialReferenceCandidates(i,e);(0,I.pC)(t)&&(i=t)}if((0,I.pC)(i)&&1===i.length)break}if(t&&((0,I.Wi)(i)||1!==i.length))return{updating:!0};const r=this._pickSpatialReferenceCandidate(i);return{spatialReference:(0,I.pC)(r)?r.spatialReference:null,viewingMode:(0,I.pC)(r)?r.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const t=e[0].tileInfo;return{tileInfo:t&&t.spatialReference.equals(this.spatialReference)?t:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const t of e)if((0,Dt.qC)(t)){const e=(0,Dt.Ku)(t);if(e)return{heightModelInfo:e,vcsWkid:t.spatialReference?.vcsWkid,latestVcsWkid:t.spatialReference?.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,i=[];for(const t of e.layers){const e="fullExtents"in t&&t.fullExtents||((0,I.pC)(t.fullExtent)?[t.fullExtent]:[]),r=this.requiresExtentInSpatialReference?null:e[0],s=e.find((e=>e.spatialReference.equals(this.spatialReference)))??r;if(s)return{candidates:[{extent:s,layer:t}],updating:!1};if(this._getSupportedSpatialReferences(t).length>0)for(const r of e)i.push({extent:r,layer:t})}return{candidates:i,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if((0,I.Wi)(e)||0===e.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:(0,I.pC)(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:((0,I.pC)(this._projectExtentTask.task)&&(this._projectExtentTask.task=(0,I.IM)(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:(0,f.vr)((async e=>{try{const t=await Vt(i.extent,r,i.layer.portalItem,e);this._projectExtentTask={...this._projectExtentTask,task:null,output:t}}catch(t){if((0,f.Hc)(e))return;this._projectExtentTask={...this._projectExtentTask,task:null}}}))},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if((0,I.Wi)(e))return t;const i=[],r=(e,t)=>(0,I.pC)(e)?(0,I.pC)(t)?e===t&&e:e:t;for(const s of e)for(const e of t){if(!s.spatialReference.equals(e.spatialReference))continue;const t=r(s.viewingMode,e.viewingMode);if(!1!==t){i.push({spatialReference:s.spatialReference,viewingMode:t});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return(0,I.Wi)(e)||e.length<1?(0,I.pC)(t)?{spatialReference:t,viewingMode:null}:null:((0,I.pC)(t)&&e.length>1&&e.some((({spatialReference:e})=>e.equals(t)))&&(e=e.filter((({spatialReference:e})=>e.equals(t)))),e.length>1&&e.some((({viewingMode:e})=>e!==Nt.JY.Local))&&(e=e.filter((({viewingMode:e})=>e!==Nt.JY.Local))),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return[];const i=[];for(const r of t){const t=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if((0,I.pC)(t)){const e=(0,I.pC)(t.constraints)?t.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:t,viewingMode:r}of e)(!this.requiresExtentInSpatialReference||(0,I.Wi)(this.userSpatialReference)||t.equals(this.userSpatialReference))&&i.push({spatialReference:t,viewingMode:r})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find((({extent:e})=>t.equals(e.spatialReference)))||e[0]}_collectLayers(e){if("loaded"!==this._loadMaybe(this.map?.()))return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const i of e)if(this._collectCollection(i,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?"not-loaded"===e.loadStatus?(e.load(),"loading"):e.loadStatus:"loaded"}};var Bt;(0,t._)([(0,m.Cb)()],zt.prototype,"required",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],zt.prototype,"map",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],zt.prototype,"getSpatialReferenceSupport",void 0),(0,t._)([(0,m.Cb)()],zt.prototype,"defaultSpatialReference",void 0),(0,t._)([(0,m.Cb)()],zt.prototype,"userSpatialReference",void 0),(0,t._)([(0,m.Cb)()],zt.prototype,"sourcePreloadCount",void 0),(0,t._)([(0,m.Cb)()],zt.prototype,"priorityCollection",void 0),(0,t._)([(0,m.Cb)()],zt.prototype,"requiresExtentInSpatialReference",void 0),(0,t._)([(0,m.Cb)()],zt.prototype,"suspended",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"ready",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"heightModelInfoReady",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"spatialReference",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"extent",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"heightModelInfo",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"vcsWkid",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"latestVcsWkid",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"viewingMode",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"tileInfo",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"mapCollections",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"_allLayers",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"_spatialReferenceTask",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"_tileInfoTask",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"_heightModelInfoTask",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zt.prototype,"_extentCandidatesTask",null),(0,t._)([(0,m.Cb)()],zt.prototype,"_extentTask",null),(0,t._)([(0,m.Cb)()],zt.prototype,"_projectExtentTask",void 0),zt=(0,t._)([(0,y.j)("esri.views.support.DefaultsFromMap")],zt);const Ht=p.Z.getLogger("esri.views.View");let jt=Bt=class extends((0,je.p)(P.Z.EventedMixin((0,Ge.v)(O.Z)))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new R.Z({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new Ye.J,this.analyses=new Se,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new n.Z,this.magnifier=new st,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Ot,this.navigation=new Lt,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new lt.CE(this),this.persistableViewModels=new n.Z,this._isValid=!1,this._readyCycleForced=!1,this.handles.add((0,he.YP)((()=>this.preconditionsReady),(e=>{e?(this._currentSpatialReference=this.spatialReference,Bt.views.add(this)):(this._currentSpatialReference=null,Bt.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.layerViewManager?.clear(),this.toolViewManager?.detach(),(0,I.pC)(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):e&&!this.ready&&(this._startup(),(0,I.pC)(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())}),he.Z_))}initialize(){this.addResolvingPromise(this.validate().then((()=>(this._isValid=!0,(0,he.N1)((()=>this.ready)))))),this.basemapView=new Xe({view:this}),this.layerViewManager=new it({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new wt({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([(0,he.YP)((()=>this.initialExtentRequired),(e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e}),{sync:!0,initial:!0}),(0,he.YP)((()=>this.ready),(e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)}),{sync:!0}),(0,he.YP)((()=>this._userSpatialReference),(e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)}),{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([(0,he.YP)((()=>this.defaultsFromMap?.ready),(t=>{const i=this.map?.allLayers.length>0;if(t&&!this.spatialReference&&i){if((0,I.pC)(e))return;const t=(0,le.kB)((()=>e=(0,I.IM)(e)));e=(0,f.vr)((async t=>{try{await(0,f.e4)(this.spatialReferenceWarningDelay,null,t)}catch{return}finally{e=null}Ht.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})),this.handles.add(t,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")}),{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=(0,I.SC)(this.graphics),this.analyses=(0,I.SC)(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),(0,I.SC)(this.analysisViewManager),this.toolViewManager=(0,I.SC)(this.toolViewManager),this.layerViewManager=(0,I.SC)(this.layerViewManager),this.basemapView=(0,I.SC)(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e?.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return Ht.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new zt({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||h.Z.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&(e?.destroyed&&(Ht.warn("#map","The provided map is already destroyed",{map:e}),e=null),h.Z.isLoadable(e)&&e.load().catch((()=>{})),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.defaultsFromMap?.required?.heightModelInfo&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!(0,$e.fS)(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return(0,I.pC)(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}importLayerView(e){throw new l.Z("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return(0,I.pC)(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&Ht.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&((0,he.gx)((()=>!1===this.preconditionsReady),(()=>this._readyCycleForced=!1),{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};jt.views=new n.Z,(0,t._)([(0,m.Cb)()],jt.prototype,"_userSpatialReference",void 0),(0,t._)([(0,We.B)("toolViewManager.activeTool")],jt.prototype,"activeTool",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"allLayerViews",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"groundView",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"animation",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"basemapView",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"_defaultsFromMapSettings",null),(0,t._)([(0,m.Cb)()],jt.prototype,"defaultsFromMap",null),(0,t._)([(0,m.Cb)()],jt.prototype,"fatalError",void 0),(0,t._)([(0,m.Cb)({type:Ze.Z})],jt.prototype,"extent",void 0),(0,t._)([(0,m.Cb)((0,ge.z)(Ye.J,"graphics"))],jt.prototype,"graphics",void 0),(0,t._)([(0,m.Cb)((0,ge.z)(Se,"analyses"))],jt.prototype,"analyses",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,type:ye.Z})],jt.prototype,"heightModelInfo",null),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"interacting",null),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"navigating",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],jt.prototype,"preconditionsReady",null),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"typeSpecificPreconditionsReady",void 0),(0,t._)([(0,m.Cb)({type:n.Z,readOnly:!0})],jt.prototype,"layerViews",void 0),(0,t._)([(0,m.Cb)({type:st})],jt.prototype,"magnifier",void 0),(0,t._)([(0,m.Cb)({value:null,type:W})],jt.prototype,"map",null),(0,t._)([(0,m.Cb)()],jt.prototype,"padding",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"ready",void 0),(0,t._)([(0,m.Cb)({type:qe.Z})],jt.prototype,"spatialReference",null),(0,t._)([(0,m.Cb)()],jt.prototype,"spatialReferenceWarningDelay",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"stationary",null),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"supportsGround",void 0),(0,t._)([(0,m.Cb)({type:He.Z})],jt.prototype,"timeExtent",void 0),(0,t._)([(0,We.B)("toolViewManager.tools")],jt.prototype,"tools",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"toolViewManager",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"type",void 0),(0,t._)([(0,m.Cb)({type:Number})],jt.prototype,"scale",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"updating",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"initialExtentRequired",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"initialExtent",null),(0,t._)([(0,m.Cb)()],jt.prototype,"cursor",null),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"input",void 0),(0,t._)([(0,m.Cb)({type:Lt,nonNullable:!0})],jt.prototype,"navigation",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"layerViewManager",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"analysisViewManager",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"width",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"height",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"resizing",void 0),(0,t._)([(0,m.Cb)({value:null,readOnly:!0})],jt.prototype,"size",null),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"suspended",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"viewEvents",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jt.prototype,"persistableViewModels",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"_isValid",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"_readyCycleForced",void 0),(0,t._)([(0,m.Cb)()],jt.prototype,"_currentSpatialReference",void 0),jt=Bt=(0,t._)([(0,y.j)("esri.views.View")],jt);const Gt=jt;let Wt=class extends Ge.D{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise(((e,t)=>this._dfd={resolve:e,reject:t})))}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new l.Z("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=(0,f.y8)(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};(0,t._)([(0,m.Cb)({readOnly:!0})],Wt.prototype,"done",null),(0,t._)([(0,m.Cb)({readOnly:!0,type:String})],Wt.prototype,"state",void 0),(0,t._)([(0,m.Cb)()],Wt.prototype,"target",void 0),Wt=(0,t._)([(0,y.j)("esri.views.ViewAnimation")],Wt),(Wt||(Wt={})).State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"};const Zt=Wt,qt=()=>s.e(6737).then(s.bind(s,76737)),$t=()=>s.e(969).then(s.bind(s,90969)),Yt={"base-dynamic":()=>Promise.all([s.e(8306),s.e(9134)]).then(s.bind(s,99134)),"base-elevation":$t,"base-tile":qt,"bing-maps":qt,"building-scene":()=>Promise.all([s.e(3362),s.e(7519),s.e(3840),s.e(3328),s.e(2828),s.e(9911),s.e(84)]).then(s.bind(s,84)),csv:()=>Promise.all([s.e(3362),s.e(7519),s.e(3840),s.e(3328),s.e(5871),s.e(874),s.e(3109),s.e(3288)]).then(s.bind(s,13288)),elevation:$t,feature:()=>Promise.all([s.e(3362),s.e(7519),s.e(3840),s.e(3328),s.e(5871),s.e(874),s.e(3109),s.e(834)]).then(s.bind(s,40834)),geojson:()=>Promise.all([s.e(3362),s.e(7519),s.e(3840),s.e(3328),s.e(5871),s.e(874),s.e(3109),s.e(8340)]).then(s.bind(s,55668)),graphics:()=>Promise.all([s.e(3328),s.e(883),s.e(1636)]).then(s.bind(s,31636)),group:()=>s.e(303).then(s.bind(s,10303)),imagery:()=>Promise.all([s.e(8306),s.e(2042)]).then(s.bind(s,32042)),"integrated-mesh":()=>Promise.all([s.e(3328),s.e(2828),s.e(9911),s.e(1128)]).then(s.bind(s,85109)),"line-of-sight":()=>s.e(6783).then(s.bind(s,46783)),"map-image":()=>Promise.all([s.e(8306),s.e(5187)]).then(s.bind(s,85187)),media:()=>s.e(6890).then(s.bind(s,46890)),"ogc-feature":()=>Promise.all([s.e(3362),s.e(7519),s.e(3840),s.e(3328),s.e(5871),s.e(874),s.e(3109),s.e(809)]).then(s.bind(s,90809)),"open-street-map":qt,"point-cloud":()=>s.e(70).then(s.bind(s,40070)),voxel:()=>s.e(2784).then(s.bind(s,92784)),route:()=>Promise.all([s.e(3328),s.e(883),s.e(3970),s.e(4853)]).then(s.bind(s,54853)),scene:e=>null==e.profile||"mesh-pyramids"===e.profile?Promise.all([s.e(3362),s.e(7519),s.e(3840),s.e(3328),s.e(2828),s.e(9911),s.e(6397)]).then(s.bind(s,6397)):Promise.all([s.e(3362),s.e(7519),s.e(3840),s.e(3328),s.e(5871),s.e(2828),s.e(9622)]).then(s.bind(s,89622)),stream:()=>Promise.all([s.e(3362),s.e(7519),s.e(3840),s.e(3328),s.e(5871),s.e(874),s.e(5028)]).then(s.bind(s,25028)),tile:qt,"imagery-tile":()=>s.e(10).then(s.bind(s,10)),"vector-tile":()=>Promise.all([s.e(1775),s.e(1329),s.e(3043),s.e(2718)]).then(s.bind(s,32718)),wcs:()=>s.e(10).then(s.bind(s,10)),"web-tile":qt,wfs:()=>Promise.all([s.e(3362),s.e(7519),s.e(3840),s.e(3328),s.e(5871),s.e(874),s.e(3109),s.e(1603)]).then(s.bind(s,11603)),wms:()=>Promise.all([s.e(8306),s.e(7544)]).then(s.bind(s,7544)),wmts:()=>s.e(9121).then(s.bind(s,89121)),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null},Xt=p.Z.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),Jt="analyses-owner-handles";var Kt,Qt,ei;(ei=Kt||(Kt={}))[ei.PENDING=0]="PENDING",ei[ei.CREATED=1]="CREATED",function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(Qt||(Qt={}));let ti=class extends je.r{constructor(e){super(e),this._allAnalysisViews=new n.Z,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=(0,f.hh)(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject((0,f.zE)("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject((0,f.zE)()),this._attachedToViewResolver=(0,f.hh)(),this._attachedToViewResolver.promise.catch((()=>{}))}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some((e=>e.updating))}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if((0,I.Wi)(t)||t.state.list===Qt.REMOVED)throw new l.Z("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Jt)}_disconnectOwners(){this.handles.remove(Jt),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const t of e)this._addAnalysis(t);const t=e.on("after-add",(e=>this._addAnalysis(e.item))),i=e.on("after-remove",(e=>this._removeAnalysis(e.item)));return{remove:()=>{t.remove(),i.remove();for(const t of e)this._removeAnalysis(t)}}}_addAnalysis(e){const t=this._items.get(e);if(null==t){const t={state:{view:Kt.PENDING,list:Qt.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,t),t.createAnalysisViewTask=(0,f.vr)((e=>this._createAnalysisViewPromise(t,e)))}else t.state.list=Qt.ADDED}_removeAnalysis(e){const t=this._items.get(e);null!=t?(t.state.list=Qt.REMOVED,this._scheduleUpdate()):Xt.error("Trying to remove analysis which was not added")}_scheduleUpdate(){(0,I.pC)(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=(0,de.Os)((()=>this._update())))}_update(){this._scheduledUpdateHandle=(0,I.hw)(this._scheduledUpdateHandle),this._items.forEach((e=>{if(e.state.list===Qt.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case Kt.PENDING:e.createAnalysisViewTask=(0,I.IM)(e.createAnalysisViewTask);break;case Kt.CREATED:(0,I.pC)(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=(0,I.SC)(e.view),e.createAnalysisViewTask=null)}}))}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,(0,I.Wi)(s.module))try{s.module=await this._loadAnalysisModule(r)}catch(e){throw this._creatingViewCount-=1,e}if((0,f.Hc)(t))throw this._creatingViewCount-=1,(0,f.zE)("AnalysisView creation aborted");const n=new s.module.default({analysis:i,view:this.view});try{await n.when()}catch(e){throw this._creatingViewCount-=1,e}if((0,f.Hc)(t))throw this._creatingViewCount-=1,n.destroy(),(0,f.zE)("AnalysisView creation aborted");return e.view=n,e.state.view=Kt.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return Promise.all([s.e(9067),s.e(9092),s.e(1414),s.e(5922)]).then(s.bind(s,35922));case"dimensioning":return Promise.all([s.e(3362),s.e(7519),s.e(3241),s.e(9092),s.e(9457),s.e(6756)]).then(s.bind(s,46756));case"direct-line-measurement":return Promise.all([s.e(9067),s.e(1414),s.e(2121)]).then(s.bind(s,92121));case"line-of-sight":return Promise.all([s.e(3241),s.e(9457),s.e(133)]).then(s.bind(s,70133));case"slice":return Promise.all([s.e(3241),s.e(3725)]).then(s.bind(s,73725))}}};(0,t._)([(0,m.Cb)()],ti.prototype,"updating",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],ti.prototype,"view",void 0),(0,t._)([(0,m.Cb)()],ti.prototype,"_allAnalysisViews",void 0),(0,t._)([(0,m.Cb)()],ti.prototype,"_creatingViewCount",void 0),ti=(0,t._)([(0,y.j)("esri.views.3d.analysis.AnalysisViewManager3D")],ti);const ii=ti;var ri=s(14260),si=s(35369);const ni=p.Z.getLogger("esri.views.3d.state.Constraints");let oi=class extends O.Z{constructor(e){super(e),this.collision=new ui,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===Nt.JY.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Nt.JY.Local?this._set("altitude",e):ni.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?(0,$.uZ)(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return(0,$.uZ)(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Nt.JY.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=ci)=>(i.min=li.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?(0,si.uV)([[4e3,li.max],[1e4,(0,$.Vl)(88)],[6e6,(0,$.Vl)(88)]]):()=>li.max;return(t,i=ci)=>(i.min=li.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?(0,si.uV)([[4e3,li.max],[5e4,(0,$.Vl)(88)],[6e6,(0,$.Vl)(88)],[2e7,li.min]]):(0,si.uV)([[3e5,li.max],[3e6,(0,$.Vl)(88)],[6e6,(0,$.Vl)(88)],[2e7,li.min]]);return(t,i=ci)=>(i.min=li.min,i.max=e(t),i)}};(0,t._)([(0,m.Cb)()],oi.prototype,"altitude",null),(0,t._)([(0,m.Cb)({readOnly:!0})],oi.prototype,"collision",void 0),(0,t._)([(0,m.Cb)()],oi.prototype,"distance",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],oi.prototype,"minimumPoiDistance",void 0),(0,t._)([(0,m.Cb)()],oi.prototype,"tilt",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],oi.prototype,"mode",void 0),oi=(0,t._)([(0,y.j)("esri.views.3d.state.Constraints")],oi);const ai=function(e){return{min:-2e5,max:4*e.radius}}(ri.sv),li={min:(0,$.Vl)(.5),max:(0,$.Vl)(179.5)},ci={min:0,max:0};let ui=class extends O.Z{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};(0,t._)([(0,m.Cb)({type:Boolean})],ui.prototype,"enabled",void 0),(0,t._)([(0,m.Cb)({type:Number})],ui.prototype,"elevationMargin",void 0),ui=(0,t._)([(0,y.j)("esri.views.3d.state.Constraints.CollisionConstraint")],ui);let hi=class extends O.Z{constructor(){super(...arguments),this.min=ai.min,this.max=ai.max}};(0,t._)([(0,m.Cb)({type:Number})],hi.prototype,"min",void 0),(0,t._)([(0,m.Cb)({type:Number})],hi.prototype,"max",void 0),hi=(0,t._)([(0,y.j)("esri.views.3d.constraints.AltitudeConstraint")],hi);let di=class extends O.Z{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){"auto"===this.mode&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};(0,t._)([(0,m.Cb)({type:Number,value:1e-8})],di.prototype,"near",null),(0,t._)([(0,L.p)("near")],di.prototype,"castNear",null),(0,t._)([(0,m.Cb)({type:Number,value:1e-8})],di.prototype,"far",null),(0,t._)([(0,L.p)("far")],di.prototype,"castFar",null),(0,t._)([(0,m.Cb)({type:["auto","manual"]})],di.prototype,"mode",void 0),di=(0,t._)([(0,y.j)("esri.views.3d.constraints.ClipDistanceConstraint")],di);const pi={min:(0,$.BV)(li.min),max:(0,$.BV)(li.max)};let fi=class extends O.Z{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return(0,$.uZ)(e,pi.min,pi.max)}autoUpdate(e){"auto"===this.mode&&this._get("max")!==e&&this._set("max",e)}};(0,t._)([(0,m.Cb)({type:["auto","manual"]})],fi.prototype,"mode",void 0),(0,t._)([(0,m.Cb)({type:Number,value:pi.max})],fi.prototype,"max",null),(0,t._)([(0,L.p)("max")],fi.prototype,"castMax",null),fi=(0,t._)([(0,y.j)("esri.views.3d.constraints.TiltConstraint")],fi);let mi=class extends O.Z{constructor(){super(...arguments),this.tilt=new fi,this.altitude=new hi,this.clipDistance=new di}};var gi;(0,t._)([(0,m.Cb)({type:fi})],mi.prototype,"tilt",void 0),(0,t._)([(0,m.Cb)({type:hi})],mi.prototype,"altitude",void 0),(0,t._)([(0,m.Cb)({type:di})],mi.prototype,"clipDistance",void 0),mi=(0,t._)([(0,y.j)("esri.views.3d.constraints.Constraints")],mi);let yi=gi=class extends c.wq{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return null!=t.datetime&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){null!=e&&(t.displayUTCOffset=e)}clone(){return new gi(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(e.date=new Date(this.date.getTime())),e}};(0,t._)([(0,m.Cb)({readOnly:!0,type:["sun"],json:{write:!0}})],yi.prototype,"type",void 0),(0,t._)([(0,m.Cb)({type:Date,json:{type:Number,write:{target:"datetime"}}})],yi.prototype,"date",void 0),(0,t._)([(0,Y.r)("date",["datetime"])],yi.prototype,"readDate",null),(0,t._)([(0,_.c)("date")],yi.prototype,"writeDate",null),(0,t._)([(0,m.Cb)({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],yi.prototype,"directShadowsEnabled",void 0),(0,t._)([(0,Y.r)("directShadowsEnabled",["directShadows"])],yi.prototype,"readDirectShadowsEnabled",null),(0,t._)([(0,_.c)("directShadowsEnabled")],yi.prototype,"writedirectShadowsEnabled",null),(0,t._)([(0,m.Cb)({type:Number,json:{write:!0}})],yi.prototype,"displayUTCOffset",void 0),(0,t._)([(0,_.c)("displayUTCOffset")],yi.prototype,"writeDisplayUTCOffset",null),yi=gi=(0,t._)([(0,y.j)("esri.webscene.SunLighting")],yi);const _i=yi;var vi;let bi=vi=class extends(P.Z.EventedMixin(_i)){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=(new Date).getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new vi(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){null!=e&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=vi.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;null!=e&&(this.positionTimezoneInfo.autoUpdated=!0,r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const s=vi.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(wi.target=this,wi.timezoneOffset=s,this.emit("timezone-will-change",wi)),null!=e)return r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new vi({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return null!=e.date&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};(0,t._)([(0,m.Cb)({type:Boolean})],bi.prototype,"cameraTrackingEnabled",void 0),(0,t._)([(0,m.Cb)({type:Boolean})],bi.prototype,"ambientOcclusionEnabled",void 0),(0,t._)([(0,m.Cb)({type:Boolean})],bi.prototype,"waterReflectionEnabled",void 0),(0,t._)([(0,m.Cb)({type:Date})],bi.prototype,"defaultDate",null),(0,t._)([(0,m.Cb)({type:Date})],bi.prototype,"date",null),bi=vi=(0,t._)([(0,y.j)("esri.views.3d.environment.SunLighting")],bi),function(e){e.calculateTimezoneOffset=function({hours:e,minutes:t,seconds:i}){return Math.round(e+t/60+i/3600)}}(bi||(bi={}));const wi={target:null,timezoneOffset:0},xi=bi;var Ci;let Ti=Ci=class extends c.wq{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Ci(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};(0,t._)([(0,m.Cb)({readOnly:!0,type:["virtual"],json:{write:!0}})],Ti.prototype,"type",void 0),(0,t._)([(0,m.Cb)({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],Ti.prototype,"directShadowsEnabled",void 0),Ti=Ci=(0,t._)([(0,y.j)("esri.webscene.VirtualLighting")],Ti);const Si=Ti;var Ei;let Ai=Ei=class extends(P.Z.EventedMixin(Si)){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new Ei({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled})}static fromWebsceneLighting(e){return new Ei(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};(0,t._)([(0,m.Cb)({type:Boolean})],Ai.prototype,"ambientOcclusionEnabled",void 0),(0,t._)([(0,m.Cb)({type:Boolean})],Ai.prototype,"waterReflectionEnabled",void 0),Ai=Ei=(0,t._)([(0,y.j)("esri.views.3d.environment.VirtualLighting")],Ai);const Mi=Ai,Oi={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:xi,virtual:Mi}};var Ri;let Pi=Ri=class extends O.Z{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new Ri({quality:this.quality})}};var Ii;(0,t._)([(0,m.Cb)({type:["low","high"],value:"low"})],Pi.prototype,"quality",null),Pi=Ri=(0,t._)([(0,y.j)("esri.views.3d.environment.SceneViewAtmosphere")],Pi);let Li=Ii=class extends c.wq{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new Ii({cloudCover:this.cloudCover})}};(0,t._)([(0,w.J)({sunny:"sunny"})],Li.prototype,"type",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Li.prototype,"cloudCover",void 0),Li=Ii=(0,t._)([(0,y.j)("esri.views.3d.environment.SunnyWeather")],Li);const Di=Li;var Ni;let Fi=Ni=class extends c.wq{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new Ni({cloudCover:this.cloudCover})}};(0,t._)([(0,w.J)({cloudy:"cloudy"})],Fi.prototype,"type",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Fi.prototype,"cloudCover",void 0),Fi=Ni=(0,t._)([(0,y.j)("esri.views.3d.environment.CloudyWeather")],Fi);const ki=Fi;var Ui;let Vi=Ui=class extends c.wq{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new Ui({fogStrength:this.fogStrength})}};(0,t._)([(0,w.J)({foggy:"foggy"})],Vi.prototype,"type",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Vi.prototype,"fogStrength",void 0),Vi=Ui=(0,t._)([(0,y.j)("esri.views.3d.environment.FoggyWeather")],Vi);const zi=Vi;var Bi;let Hi=Bi=class extends c.wq{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Bi({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,t._)([(0,w.J)({rainy:"rainy"})],Hi.prototype,"type",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Hi.prototype,"cloudCover",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Hi.prototype,"precipitation",void 0),Hi=Bi=(0,t._)([(0,y.j)("esri.views.3d.environment.RainyWeather")],Hi);const ji=Hi;var Gi;let Wi=Gi=class extends c.wq{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Gi({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,t._)([(0,w.J)({snowy:"snowy"})],Wi.prototype,"type",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Wi.prototype,"cloudCover",void 0),(0,t._)([(0,m.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Wi.prototype,"precipitation",void 0),(0,t._)([(0,m.Cb)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Wi.prototype,"snowCover",void 0),Wi=Gi=(0,t._)([(0,y.j)("esri.views.3d.environment.SnowyWeather")],Wi);const Zi={key:"type",base:Di,typeMap:{sunny:Di,cloudy:ki,rainy:ji,snowy:Wi,foggy:zi}},qi=Object.keys(Zi.typeMap),$i=1e4,Yi={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:_i,virtual:Si}};let Xi=class extends c.wq{constructor(e){super(e)}clone(){}};(0,t._)([(0,m.Cb)({readOnly:!0,json:{read:!1}})],Xi.prototype,"type",void 0),Xi=(0,t._)([(0,y.j)("esri.webscene.background.Background")],Xi);const Ji=Xi;var Ki;const Qi={...s(50264).a,nonNullable:!0};let er=Ki=class extends Ji{constructor(e){super(e),this.type="color",this.color=new r.Z([0,0,0,1])}clone(){return new Ki(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};(0,t._)([(0,w.J)({color:"color"},{readOnly:!0})],er.prototype,"type",void 0),(0,t._)([(0,m.Cb)(Qi)],er.prototype,"color",void 0),er=Ki=(0,t._)([(0,y.j)("esri.webscene.background.ColorBackground")],er);const tr=er,ir={base:Ji,key:"type",typeMap:{color:tr}},rr={types:ir,json:{read:function(e){return(t,i,r)=>{if(!t)return t;for(const i in e.typeMap)if(t.type===i){const s=new e.typeMap[i];return s.read(t,r),s}}}(ir),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var sr;const nr=p.Z.getLogger("esri.webscene.Environment"),or=(e,t,i)=>({enabled:!i||!i.isPresentation});let ar=sr=class extends c.wq{constructor(e){super(e),this.lighting=new _i,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){(function(e,t){return!!qi.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)})(e?.type,nr)&&this._set("weather",e)}clone(){return new sr(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?Si.prototype.clone.call(this.lighting):_i.prototype.clone.call(this.lighting),background:(0,u.d9)(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};(0,t._)([(0,m.Cb)({types:Yi,nonNullable:!0,json:{write:!0}})],ar.prototype,"lighting",void 0),(0,t._)([(0,m.Cb)(rr)],ar.prototype,"background",void 0),(0,t._)([(0,m.Cb)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:or}}})],ar.prototype,"atmosphereEnabled",void 0),(0,t._)([(0,m.Cb)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:or}}})],ar.prototype,"starsEnabled",void 0),(0,t._)([(0,m.Cb)({types:Zi,nonNullable:!0,json:{write:!0},value:new Di})],ar.prototype,"weather",null),ar=sr=(0,t._)([(0,y.j)("esri.webscene.Environment")],ar);const lr=ar;var cr;let ur=cr=class extends lr{constructor(e){super(e),this.atmosphere=new Pi,this.lighting=new xi}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new cr({...t,lighting:"virtual"===t.lighting.type?Mi.fromWebsceneLighting(t.lighting):xi.fromWebsceneLighting(t.lighting)})}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof xi||e instanceof Mi?e:e instanceof _i?this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(e):new xi(e.cloneConstructProperties()):e instanceof Si?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(e):new Mi(e.cloneConstructProperties()):(0,g.N7)(Oi,e):new xi}clone(){return new cr({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:(0,u.d9)(this.background)})}cloneWithWebsceneEnvironment(e){return new cr({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:(0,u.d9)(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){return"sun"===e.lighting.type?this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(e.lighting):xi.fromWebsceneLighting(e.lighting):"virtual"===e.lighting.type?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(e.lighting):Mi.fromWebsceneLighting(e.lighting):xi.fromWebsceneLighting(e.lighting)}};(0,t._)([(0,m.Cb)({type:Pi,json:{read:!1},nonNullable:!0})],ur.prototype,"atmosphere",void 0),(0,t._)([(0,m.Cb)({nonNullable:!0})],ur.prototype,"lighting",void 0),(0,t._)([(0,L.p)("lighting")],ur.prototype,"castLighting",null),ur=cr=(0,t._)([(0,y.j)("esri.views.3d.environment.SceneViewEnvironment")],ur);const hr=ur;var dr=s(6766),pr=s(1983),fr=s(25726),mr=s(55709),gr=s(69666);function yr(e){return Math.min(1,Math.max(0,(e-1e5)/9e5))}const _r=(0,me.f)(5802e-9,13558e-9,331e-7),vr=(0,me.f)(65e-8*3,5643e-9,255e-9),br=1e5;var wr=s(53737),xr=s(9969),Cr=s(52756),Tr=s(5474),Sr=s(95194),Er=s(91907),Ar=s(17346);class Mr extends Cr.A{initializeProgram(e){const t=Mr.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return this.configuration.haze?(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.ONE,Er.zi.ZERO,Er.zi.ONE_MINUS_SRC_COLOR,Er.zi.ONE),colorWrite:Ar.BK}):(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.SRC_ALPHA,Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA,Er.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Er.wb.LEQUAL},colorWrite:Ar.BK})}}Mr.shader=new xr.J(wr.C,(()=>s.e(7686).then(s.bind(s,37686))));var Or=s(67197);class Rr extends Or.m{constructor(){super(...arguments),this.haze=!1}}(0,t._)([(0,Or.o)()],Rr.prototype,"haze",void 0);var Pr=s(23410),Ir=s(71299),Lr=s(62039);class Dr{constructor(e){this._view=e,this.type="realistic",this.canRender=!0,this._cameraPosition=(0,me.c)(),this._heightParameters=(0,pr.c)(),this._betasRayleigh=(0,me.c)(),this._betasCombined=(0,me.c)(),this._scaleHeight=0,this._radii=(0,gr.a)(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=ri.sv.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(ri.sv.radius)}destroy(){this._atmosphereTechnique=(0,I.RY)(this._atmosphereTechnique),this._atmosphereHazeTechnique=(0,I.RY)(this._atmosphereHazeTechnique),this._vao=(0,I.O3)(this._vao),this._handles=(0,I.SC)(this._handles)}when(){return Promise.resolve()}initializeRenderContext(e){const t=e.renderContext.rctx,i=this._handles=new Ae.Z,r=this._view.basemapTerrain;(0,I.pC)(r.rootTiles)&&this._updateElevation({spatialReference:r.spatialReference,tile:r.rootTiles[0],extent:r.rootTiles[0].extent,context:"ground"}),i.add((0,he.on)((()=>this._view.basemapTerrain),"elevation-change",(e=>this._updateElevation(e)),{onListenerAdd:()=>this._updateElevation()})),i.add((0,he.on)((()=>this._view.basemapTerrain),"elevation-bounds-change",(()=>this._updateVisibleElevationBounds())));const s=new Rr;s.haze=!1,this._atmosphereTechnique=e.shaderTechniqueRepository.acquire(Mr,s),s.haze=!0,this._atmosphereHazeTechnique=e.shaderTechniqueRepository.acquire(Mr,s),this._vao=(0,Lr.ow)(t,Ir.Bn),this._scaleHeight=8500,(0,dr.s)(this._betasRayleigh,_r[0],_r[1],_r[2]),(0,dr.s)(this._betasCombined,_r[0]+vr[0],_r[1]+vr[1],_r[2]+vr[2])}render(e){this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture)}renderHaze(e,t){this._darkenHaze=t,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture)}_render(e,t,i){this._update(e.bindParameters.camera);const r=e.rctx.bindTechnique(t,Nr,e.bindParameters);e.offscreenRenderingHelper.renderDepthDetached((()=>{r.bindTexture("depthTex",i),this._renderCommon(t.program,e)}))}_renderCommon(e,t){if((0,I.Wi)(this._vao))return;const i=t.rctx;e.setUniform4fv("heightParameters",this._heightParameters),e.setUniform3fv("cameraPosition",this._cameraPosition),e.setUniform2fv("radii",this._radii),e.setUniform1f("scaleHeight",this._scaleHeight),e.setUniform1f("betaMie",3996e-9),e.setUniform3fv("betaRayleigh",this._betasRayleigh),e.setUniform3fv("betaCombined",this._betasCombined),e.setUniform1f("innerFadeDistance",this._innerFadeDistance),e.setUniform1f("altitudeFade",this._altitudeFade),e.setUniform1f("hazeStrength",this._hazeStrength),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Er.MX.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateElevation(e){const t=e?e.tile:(0,I.Pt)(this._view.basemapTerrain.rootTiles,[null])[0];if((0,I.Wi)(t)||0!==t.level)return;const i=this._adjustRadiusForTesselation(ri.sv.radius+t.elevationBounds[0]);i!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=i,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(ri.sv.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||e<this._lowerBoundEarthRadius)&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,(0,mr.a)(this._radii,e,e+br),this._innerFadeDistance=2*Math.sqrt(1e4*(2*e-1e4))}_update(e){if((0,I.Wi)(e))return;this._cameraHeight=(0,dr.l)(e.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const t=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/br));this._heightParameters=(0,pr.f)(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,t),(0,dr.c)(this._cameraPosition,e.eye),this._altitudeFade=yr(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?(0,$.t7)(.6,1,(0,$.CW)(9500,10500,this._cameraHeight-ri.sv.radius)):1}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}}const Nr=new Pr.K;var Fr=s(24455),kr=s(39100),Ur=s(10663),Vr=s(61044),zr=s(5700),Br=s(68817);function Hr(e=Wr){return[e[0],e[1],e[2],e[3]]}function jr(e,t){return function(e,t,i,r,s=Hr()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}(e[0],e[1],e[2],t,Br.o6.get())}function Gr(e,t,i=Hr()){return(0,dr.f)(i,e,t),(0,dr.n)(i,i),i[3]=(0,zr.EU)(e,t),i}const Wr=[0,0,1,0];(0,Vr.a)(),(0,Vr.a)();var Zr=s(57425),qr=s(35127);class $r extends Cr.A{constructor(e){super(e,null,(()=>this.destroy()))}initializeProgram(e){const t=$r.shader.get().build();return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({blending:(0,Ar.if)(Er.zi.ONE,Er.zi.SRC_ALPHA),depthTest:{func:Er.wb.LEQUAL},colorWrite:Ar.BK})}}function Yr(e){return(0,I.pC)(e)&&!e.running}$r.shader=new xr.J(qr.C,(()=>s.e(7068).then(s.bind(s,47068))));let Xr=class extends O.Z{constructor(e){super(e),this._technique=new $r(e),this._vao=(0,Lr.ow)(e.rctx)}destroy(){this._technique=(0,I.RY)(this._technique),this._vao=(0,I.O3)(this._vao)}render(e,t){const i=e.bindParameters.clouds;if((0,I.Wi)(this._vao)||(0,I.Wi)(i.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(i,e.bindParameters.camera.eye,t);const r=e.rctx.bindTechnique(this._technique,os,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Er.MX.TRIANGLE_STRIP,0,4),function(e){return e.crossFade.enabled||e.fadeInOut.stage!==Zr.co.FINISHED||e.fadeIn.stage!==Zr.YF.FINISHED||e.fadeInOutHeight.stage!==Zr.hZ.FINISHED}(i)&&this.requestRender()}_setFadeInStage(e,t){const i=performance.now(),r=e.parallax.anchorPointClouds;e.fadeIn.stage===Zr.YF.FINISHED&&(e.fadeIn.factor=1,(0,dr.c)(r,Qr),e.fadeIn.stage=Zr.YF.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=Zr.co.FINISHED);const s=ns(e,t);e.fadeIn.stage===Zr.YF.CHANGE_ANCHOR&&s&&Yr(e.data)&&((0,dr.c)(r,Qr),e.fadeIn.stage=Zr.YF.FADE_IN,e.startTime=i),e.fadeIn.factor>0&&e.fadeIn.stage===Zr.YF.FADE_IN&&(e.fadeIn.factor=1-(i-e.startTime)/ts),e.fadeIn.factor<=0&&e.fadeIn.stage===Zr.YF.FADE_IN&&(e.fadeIn.stage=Zr.YF.FINISHED,e.fadeIn.factor=0)}_setCrossFadingStage(e){const t=performance.now(),{crossFade:i}=e,r=e.parallax.anchorPointClouds;e.crossFade.enabled||((0,dr.c)(e.parallaxNew.anchorPointClouds,Qr),e.startTime=t,i.factor=0,e.crossFade.enabled=!0),i.factor<1&&e.crossFade.enabled&&(i.factor=(t-e.startTime)/rs),i.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,i.factor=1,(0,dr.c)(r,e.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e,t){const i=performance.now(),{fadeInOut:r,crossFade:s}=e;r.stage===Zr.co.FINISHED&&(e.startTime=i,r.factor=0,r.stage=Zr.co.FADE_OUT),r.factor<1&&r.stage===Zr.co.FADE_OUT&&(r.factor=(i-e.startTime)/is),r.factor>=1&&r.stage===Zr.co.FADE_OUT&&(r.factor=1,(0,dr.c)(e.parallax.anchorPointClouds,Qr)),r.factor>=1&&r.stage===Zr.co.FADE_OUT&&ns(e,t)&&(r.factor=1,r.stage=Zr.co.SWITCH,e.crossFade.enabled=!1,s.factor=1),Yr(e.data)&&r.stage===Zr.co.SWITCH&&(e.startTime=i,r.factor=1,r.stage=Zr.co.FADE_IN,(0,dr.c)(e.parallax.anchorPointClouds,Qr),e.crossFade.enabled=!1,s.factor=1),r.factor>0&&r.stage===Zr.co.FADE_IN&&(r.factor=1-(i-e.startTime)/ts),r.factor<=0&&r.stage===Zr.co.FADE_IN&&(r.stage=Zr.co.FINISHED,r.factor=0)}_setFadeInOutHeight(e,t){const i=performance.now(),r=e.fadeInOutHeight,s=(i-(r.stage===Zr.hZ.FINISHED?i:e.startTimeHeightFade))/ss;r.factor+=t?-s:s,e.startTimeHeightFade=i,r.factor=(0,$.uZ)(r.factor,0,1),r.stage=Zr.hZ.HEIGHT_FADE}_setParallaxParameters(e,t,i){const{parallax:r}=e;e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=(0,dr.l)(t)-this.planetRadius>$i?1:0),(0,dr.n)(Qr,t),(0,dr.g)(Qr,Qr,this.planetRadius),0===r.anchorPointClouds[0]&&0===r.anchorPointClouds[1]&&0===r.anchorPointClouds[2]&&(0,dr.c)(r.anchorPointClouds,Qr);const s=(0,dr.l)((0,dr.b)(es,r.anchorPointClouds,Qr));let n=!0;s>e.fadeIn.distanceThresholdFactor*r.cloudsHeight||e.fadeIn.stage!==Zr.YF.FINISHED?this._setFadeInStage(e,t):s>e.fadeInOut.distanceThresholdFactor*r.cloudsHeight||e.fadeInOut.stage!==Zr.co.FINISHED?this._setFadeInOutStage(e,t):s>e.crossFade.distanceThresholdFactor*r.cloudsHeight&&!i||e.crossFade.enabled?this._setCrossFadingStage(e):n=!1;const o=(0,dr.l)(t),a=o-this.planetRadius;if((a>17e3||a<-1e4)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(a>$i||a<-3500)&&e.fadeInOutHeight.factor<1?this._setFadeInOutHeight(e,!1):a<$i&&a>-3500&&e.fadeInOutHeight.factor>0?this._setFadeInOutHeight(e,!0):e.fadeInOutHeight.stage=Zr.hZ.FINISHED,r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(o*o-this.planetRadius*this.planetRadius,0))/o,Gr(Jr,r.anchorPointClouds,Kr),r.transform=(0,kr.c)(),(0,Fr.e)(r.transform,r.transform,Kr[3],Kr),n){const{parallaxNew:t}=e;Gr(Jr,t.anchorPointClouds,Kr),t.transform=(0,kr.c)(),(0,Fr.e)(t.transform,t.transform,Kr[3],Kr)}(0,dr.c)(e.cameraPositionLastFrame,t)}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Xr.prototype,"rctx",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Xr.prototype,"viewingMode",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Xr.prototype,"planetRadius",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Xr.prototype,"requestRender",void 0),Xr=(0,t._)([(0,y.j)("esri.views.3d.environment.CloudsComposition")],Xr);const Jr=(0,me.f)(0,0,1),Kr=Hr(),Qr=(0,me.c)(),es=(0,me.c)(),ts=500,is=250,rs=500,ss=500;function ns(e,t){return(0,dr.z)(e.cameraPositionLastFrame,t)}const os=new Pr.K;var as=s(1662),ls=s(55542),cs=s(79912),us=s(11547),hs=s(25853);class ds{constructor(e,t,i,r,s,n,o,a,l=.5){this.coverage=e,this.density=t,this.absorption=i,this.cloudSize=r,this.detailSize=s,this.smoothness=n,this.cloudHeight=o,this.raymarchingStepType=a,this.median=l}}const ps={sunny:new ds([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],hs.p.SIXTEEN),cloudy:new ds([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],hs.p.TWOHUNDRED,.6),rainy:new ds([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],hs.p.TWOHUNDRED,.4),snowy:new ds([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],hs.p.HUNDRED,.65),foggy:new ds([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],hs.p.SIXTEEN)};class fs extends Cr.A{constructor(e,t){super(e,t,(()=>this.destroy()))}initializeProgram(e){const t=fs.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.ONE,Er.zi.ONE,Er.zi.ZERO,Er.zi.ZERO),depthTest:{func:Er.wb.LEQUAL},colorWrite:Ar.BK})}}fs.shader=new xr.J(us.a,(()=>s.e(7530).then(s.bind(s,57530))));var ms=s(13696),gs=s(43175),ys=s(3720);class _s extends Cr.A{initializeProgram(e){const t=_s.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({blending:this.configuration.mode===ms.u.Full?(0,Ar.if)(Er.zi.ONE,Er.zi.ZERO):(0,Ar.wK)(Er.zi.ZERO,Er.zi.ONE,Er.zi.ONE,Er.zi.ZERO),depthTest:{func:Er.wb.ALWAYS},colorWrite:Ar.BK})}}_s.shader=new xr.J(ys.N,(()=>s.e(1378).then(s.bind(s,61378))));var vs=s(18567);class bs extends O.Z{constructor(e){let t;super(e),this._weatherTile=(0,ls.f)(0,0),this._needsRender=!0,this._frameBuffer=new vs.X(e.context.renderContext.rctx,{colorTarget:Er.Lm.TEXTURE,width:gs.IQ,height:gs.IQ},{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.CLAMP_TO_EDGE,samplingMode:Er.cw.LINEAR,hasMipmap:!1,width:gs.IQ,height:gs.IQ}),this._vao=(0,Lr.ow)(e.context.renderContext.rctx),this._shaderTechniqueRepository=e.context.shaderTechniqueRepository,this._ensureRendered=()=>((0,I.pC)(t)?(0,I.pC)(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(t=this._render(e.context.renderContext.rctx,ms.u.WeatherMap)):(0,I.pC)(this.fullTechnique)&&this.fullTechnique.compiled&&(t=this._render(e.context.renderContext.rctx,ms.u.Full)),t)}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._weatherTile[0]===e[0]&&this._weatherTile[1]===e[1]||(this._weatherTile=e,this._setDirty())}destroy(){this._fullTechnique=(0,I.RY)(this._fullTechnique),this._weatherMapTechnique=(0,I.RY)(this._weatherMapTechnique),this._frameBuffer=(0,I.O3)(this._frameBuffer),this._vao=(0,I.O3)(this._vao)}get fullTechnique(){if((0,I.Wi)(this._fullTechnique)){const e=new ms.i;e.mode=ms.u.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(_s,e)}return this._fullTechnique}get weatherMapTechnique(){if((0,I.Wi)(this._weatherMapTechnique)){const e=new ms.i;e.mode=ms.u.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(_s,e)}return this._weatherMapTechnique}_render(e,t){if((0,I.Wi)(this._vao)||(0,I.Wi)(this._frameBuffer))return null;const i=t===ms.u.Full?this.fullTechnique:this.weatherMapTechnique;if((0,I.Wi)(i))return null;const r=e.getViewport();e.setViewport(0,0,gs.IQ,gs.IQ),e.bindFramebuffer(this._frameBuffer);const s=e.bindTechnique(i);return s.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),e.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),e.gl.drawArrays(e.gl.TRIANGLE_STRIP,0,4),e.setViewport(r.x,r.y,r.width,r.height),this._needsRender=!1,this._frameBuffer.colorTexture}}(0,t._)([(0,m.Cb)({constructOnly:!0})],bs.prototype,"context",void 0);var ws=s(85211);let xs=class extends O.Z{constructor(e){super(e),this._frameTask=null,this._handles=new Ae.Z,this._cubeMapSize=(0,b.Z)("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new hs.t,this._bindParameters=new ws.p(null,null,null),this._drawParameters=new us.C,this._weatherTile=(0,ls.f)(0,0),this._weatherTileCount=128,this.coverage=(0,$.t7)(Es.coverage[0],Es.coverage[1],.5),this.density=(0,$.t7)(Es.density[0],Es.density[1],.5),this.absorption=(0,$.t7)(Es.absorption[0],Es.absorption[1],.5),this.cloudSize=(0,$.t7)(Es.cloudSize[0],Es.cloudSize[1],.5),this.detailSize=(0,$.t7)(Es.detailSize[0],Es.detailSize[1],.5),this.smoothness=(0,$.t7)(Es.smoothness[0],Es.smoothness[1],.5),this.cloudHeight=(0,$.t7)(Es.cloudHeight[0],Es.cloudHeight[1],.5),this.raymarchingStepType=Es.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=(0,kr.c)(),this._cameraPositionLastFrame=(0,me.c)(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new fs({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}_getWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;let i=(0,ls.f)((e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*i[0]-1));i=(0,ls.f)(Math.floor(2*this._weatherTileCount*i[0]),Math.floor(4*(this._weatherTileCount-r)*i[1]));let s=0,n=0;if((0,I.pC)(this.view.environment)&&"sun"===this.view.environment.lighting.type&&(0,I.pC)(this.view.environment.lighting.date)){const e=new Date(this.view.environment.lighting.date);e.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),s=31*e.getUTCMonth()+e.getUTCDate(),n=e.getUTCFullYear()}return i[0]=(i[0]+s)%(2*this._weatherTileCount),i[1]=(i[1]+n%100)%(4*this._weatherTileCount),i}initialize(){this._vao=(0,Lr.ow)(this.context.renderContext.rctx);const e=(0,fr.Iu)(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(nt.T8.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add((0,he.YP)((()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType]),(()=>this.setDirty()),he.nn))}destroy(){this._handles.destroy(),this._techniques.forEach((e=>(0,I.RY)(e))),this._techniques=null,this._frameBufferCube=(0,I.O3)(this._frameBufferCube),this._vao=(0,I.O3)(this._vao),this._noiseTexture=(0,I.SC)(this._noiseTexture)}_ensureNoiseTexture(){if((0,I.Wi)(this._noiseTexture)){const e=this.context;this._noiseTexture=new bs({context:e}),this._noiseTexture.updateWeatherMap(this._weatherTile)}return this._noiseTexture.textureAtlas}ensureWeatherTile(){const e=this._getWeatherTile();(0,I.pC)(this._noiseTexture)&&(0,I.pC)(this.context)&&this._noiseTexture.updateWeatherMap(e),e[0]===this._weatherTile[0]&&e[1]===this._weatherTile[1]||(this._weatherTile=e,this.setDirty())}get frameBufferCube(){if((0,I.Wi)(this._frameBufferCube)){const e={target:Er.No.TEXTURE_CUBE_MAP,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.CLAMP_TO_EDGE,samplingMode:Er.cw.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new vs.X(this.context.renderContext.rctx,{colorTarget:Er.Lm.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(e){return e.crossFade.enabled||e.fadeInOut.stage===Zr.co.FADE_OUT||e.fadeInOutHeight.stage!==Zr.hZ.FINISHED}applyPreset(e,t){const i=e.median,r=e=>{const r=(0,$.t7)(e[0],e[1],i);return t<.5?(0,$.t7)(e[0],r,2*t):(0,$.t7)(r,e[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(0===this.coverage||(0,I.Wi)(this._vao))return void(this.running=!1);const t=this._getTechnique(this.raymarchingStepType);if(!t.compiled)return;if(!(0,dr.z)(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void(0,dr.c)(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const i=this._ensureNoiseTexture();if((0,I.Wi)(i))return;const r=this.context.renderContext.rctx,s=r.bindTechnique(t),n=1+this.absorption,o=(0,$.t7)(35,120,this.absorption);s.bindTexture("cloudShapeTexture",i),s.setUniform1f("cloudRadius",this._cloudRadius),s.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),s.setUniform1f("power",o),s.setUniform1f("sigmaE",n),s.setUniform1f("density",(0,$.t7)(0,.3,this.density)),s.setUniform1f("cloudSize",(0,$.t7)(0,.02,Math.max(.01,1-this.cloudSize))),s.setUniform1f("detailSize",(0,$.t7)(0,.2,Math.max(.01,1-this.detailSize))),s.setUniform1f("smoothness",(0,$.t7)(0,.5,1-this.smoothness)),s.setUniform1f("cloudHeight",(0,$.t7)(0,1500,this.cloudHeight)),s.setUniform1f("coverage",this.coverage),r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const a=r.getViewport();r.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),r.bindFramebuffer(this.frameBufferCube);for(let e=0;e<5;e++){const t=Cs[e],i=Ts[e];(0,Fr.y)(this._viewMatrix,Ss,t,i),(0,as.f)(this._drawParameters.viewMatrix,this._viewMatrix);const n=Er.No.TEXTURE_CUBE_MAP_POSITIVE_X+e;this.frameBufferCube.setColorTextureTarget(n),s.bindDraw(this._drawParameters,this._bindParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush()}this.running=!1,r.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),e.madeProgress()}};(0,t._)([(0,m.Cb)({constructOnly:!0})],xs.prototype,"context",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],xs.prototype,"view",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],xs.prototype,"requestRender",void 0),(0,t._)([(0,m.Cb)()],xs.prototype,"_frameTask",void 0),(0,t._)([(0,m.Cb)()],xs.prototype,"coverage",void 0),(0,t._)([(0,m.Cb)()],xs.prototype,"density",void 0),(0,t._)([(0,m.Cb)()],xs.prototype,"absorption",void 0),(0,t._)([(0,m.Cb)()],xs.prototype,"cloudSize",void 0),(0,t._)([(0,m.Cb)()],xs.prototype,"detailSize",void 0),(0,t._)([(0,m.Cb)()],xs.prototype,"smoothness",void 0),(0,t._)([(0,m.Cb)()],xs.prototype,"cloudHeight",void 0),(0,t._)([(0,m.Cb)()],xs.prototype,"raymarchingStepType",void 0),(0,t._)([(0,m.Cb)()],xs.prototype,"running",void 0),xs=(0,t._)([(0,y.j)("esri.views.3d.environment.CloudsGenerator")],xs);const Cs=[(0,cs.f)(1,0,0),(0,cs.f)(-1,0,0),(0,cs.f)(0,1,0),(0,cs.f)(0,-1,0),(0,cs.f)(0,0,1)],Ts=[(0,cs.f)(0,1,0),(0,cs.f)(0,1,0),(0,cs.f)(0,0,-1),(0,cs.f)(0,0,1),(0,cs.f)(0,1,0)],Ss=(0,cs.z)(),Es=ps.sunny;var As=s(28539);class Ms extends Cr.A{initializeProgram(e){const t=Ms.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return this.configuration.haze?(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.ONE,Er.zi.ZERO,Er.zi.ONE_MINUS_SRC_COLOR,Er.zi.ONE),colorWrite:Ar.BK}):(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.SRC_ALPHA,Er.zi.ZERO,Er.zi.ONE_MINUS_SRC_ALPHA,Er.zi.ONE),colorWrite:Ar.BK})}}Ms.shader=new xr.J(As.F,(()=>s.e(3154).then(s.bind(s,43154))));class Os extends Or.m{constructor(){super(...arguments),this.haze=!1}}(0,t._)([(0,Or.o)()],Os.prototype,"haze",void 0);let Rs=class extends O.Z{constructor(e){super(e),this._fogColor=(0,cs.c)(),this._fogColorAtNight=(0,cs.c)(),this._cameraDirection=(0,cs.c)(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=(0,Lr.ow)(t,Ir.Bn);const i=(0,fr.Iu)(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+br}destroy(){this._hazeFogTechnique=(0,I.RY)(this._hazeFogTechnique),this._thickFogTechnique=(0,I.RY)(this._thickFogTechnique),this._vao=(0,I.O3)(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if((0,I.Wi)(this._thickFogTechnique)){const e=new Os;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(Ms,e)}return this._thickFogTechnique}get hazeFogTechnique(){if((0,I.Wi)(this._hazeFogTechnique)){const e=new Os;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(Ms,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,i){if(0===this.view.basemapTerrain.baseOpacity&&!t)return;if(this._update(e,t,i),this._fogAmount<=0)return;const r=t?this.thickFogTechnique:this.hazeFogTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper,n=e.rctx.bindTechnique(r,Ps,e.bindParameters);s.renderDepthDetached((()=>{n.bindTexture("depthTex",s.depthTexture),this._renderFog(r.program,e)}))}_renderFog(e,t){if((0,I.Wi)(this._vao))return!1;const i=t.rctx,r=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",r.eye),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Er.MX.TRIANGLE_STRIP,0,4),!0}_update(e,t,i){const r=e.bindParameters.camera,s=t?.1:0;i?(0,dr.s)(this._fogColor,.5,.5,.5):t?(0,dr.s)(this._fogColor,1.5,1.5,1.5):(0,dr.s)(this._fogColor,.24,.44,.8),(0,dr.g)(this._fogColorAtNight,this._fogColor,s),(0,dr.n)(this._cameraDirection,r.eye);const n=Math.max(0,(0,dr.e)(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));(0,dr.h)(this._fogColor,this._fogColorAtNight,this._fogColor,n);const o=(0,dr.l)(r.eye),a=o*o;this._atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-(0,$.CW)(this._foggyFadeStart*$i,this._foggyFadeEnd*$i,Math.abs(o-this._planetRadius)):1-(0,$.CW)(this._hazeFadeStart*$i,this._hazeFadeEnd*$i,Math.abs(o-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Rs.prototype,"context",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Rs.prototype,"view",void 0),Rs=(0,t._)([(0,y.j)("esri.views.3d.environment.Fog")],Rs);const Ps=new Pr.K;var Is=s(44883),Ls=s(41938),Ds=s(28876);class Ns extends Cr.A{initializeProgram(e){const t=Ns.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return this.configuration.geometry===Ds.n.Cylinder?(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.SRC_ALPHA,Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA,Er.zi.ONE_MINUS_SRC_ALPHA),culling:Ar.Rd,depthTest:{func:Er.wb.LEQUAL},colorWrite:Ar.BK}):(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.SRC_ALPHA,Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA,Er.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Er.wb.LEQUAL},colorWrite:Ar.BK})}}Ns.shader=new xr.J(Ls.a,(()=>s.e(3456).then(s.bind(s,43456))));const Fs="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";var ks=s(95397),Us=s(44685),Vs=s(6087),zs=s(21414),Bs=s(78951),Hs=s(43487),js=s(62486),Gs=s(29620);const Ws=p.Z.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class Zs{constructor(){this.type="panoramic",this._techniqueConfig=new Ds.f,this._passParameters=new Ls.S,this._readyResolver=(0,f.hh)(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=(0,I.O3)(this._passParameters.texture),this._vao=(0,I.O3)(this._vao),this._readyController=(0,I.IM)(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(e){this._techniqueConfig.geometry=Ds.n.Cylinder,this._technique=e.shaderTechniqueRepository.acquire(Ns,this._techniqueConfig);const t=e.renderContext.rctx;this._vao=this._createVertexArrayObject(t),this._vaoCount=(0,js._V)(this._vao,"geometry"),(0,Is.t)(Fs,{signal:this._readyController.signal}).then((i=>{this._passParameters.texture=new Hs.x(t,{pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.CLAMP_TO_EDGE,samplingMode:Er.cw.LINEAR,flipped:!0},i),e.requestRender(),this._readyController=null,this._readyResolver.resolve()})).catch((e=>{(0,f.D_)(e)||Ws.error("Unable to initialize atmosphere: image request failed",e),this._readyResolver.reject()}))}get canRender(){return null!=this._passParameters.texture}render(e){const t=e.rctx,i=t.bindTechnique(this._technique,this._passParameters,e.bindParameters);(function(e,t){(0,Fr.c)(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1})(qs,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",qs),t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Er.MX.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const t=Vs.Z.createPolySphereGeometry(1,2,!1),i=t.indices.get(zs.T.POSITION);for(let e=0;e<i.length;e+=3){const t=i[e];i[e]=i[e+2],i[e+2]=t}const r=t.vertexAttributes.get(zs.T.POSITION).data,s=$s.createBuffer(i.length),n=s.position;for(let e=0;e<i.length;++e){const t=3*i[e];n.set(e,0,r[t]),n.set(e,1,r[t+1]),n.set(e,2,r[t+2])}return new Gs.U(e,Tr.i,{geometry:(0,ks.K)($s)},{geometry:Bs.f.createVertex(e,Er.l1.STATIC_DRAW,s.buffer)})}}const qs=(0,kr.c)(),$s=(0,Us.U$)().vec3f(zs.T.POSITION);var Ys=s(12928),Xs=s(74630);class Js extends Pr.K{constructor(){super(...arguments),this.time=0,this.radius=1}}class Ks extends Cr.A{initializeProgram(e){const t=Ks.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Ks.attributeLocation)}initializePipeline(){return(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.ONE,Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA,Er.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Er.wb.LEQUAL},colorWrite:Ar.BK})}}Ks.shader=new xr.J(Xs.P,(()=>s.e(3657).then(s.bind(s,63657)))),Ks.attributeLocation=new Map([[zs.T.POSITION,0],[zs.T.INSTANCEFEATUREATTRIBUTE,1]]);var Qs=s(15396),en=s(48978);let tn=class extends O.Z{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=(0,me.c)(),this._tile=(0,me.c)(),this._particleColor=(0,cs.c)(),this._particleColorAtNight=(0,cs.c)(),this._nightMultiplier=.7,this._cameraDirection=(0,cs.c)(),this._renderParameters=new Js,this._animation=new en.d,this._updatingTracking=new Ke.t,this._renderParameters.time=0,this._renderParameters.radius=(0,fr.Iu)(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=(0,I.RY)(this._snowTechnique),this._rainTechnique=(0,I.RY)(this._rainTechnique),this._vao=(0,I.O3)(this._vao),this._instanceIdBuffer=(0,I.O3)(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if((0,I.Wi)(this._rainTechnique)){const e=new Qs.Y;e.type=Qs.H.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(Ks,e)}return this._rainTechnique}get snowTechnique(){if((0,I.Wi)(this._snowTechnique)){const e=new Qs.Y;e.type=Qs.H.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(Ks,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,i){const r="rainy"===i,s=r?this.rainTechnique:this.snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),(0,I.Wi)(s)||(0,I.Wi)(this._vao)||(0,I.Wi)(this._instanceIdBuffer))return;if((0,I.pC)(e.bindParameters.clouds.data)&&(this._opacity=1-e.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0)return;t=t<.5?(0,$.t7)(0,.35,2*t):(0,$.t7)(.35,1,2*(t-.5));const o=n.bindTechnique(s);this._renderParameters.camera=e.bindParameters.camera,this._renderParameters.time=(r?this._rainSpeed:this._snowSpeed)*(0,Ys.D9)(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(o,i,e),n.bindVAO(this._vao);const a=Ks.attributeLocation;o.assertCompatibleVertexAttributeLocations(this._vao),(0,js.XP)(n,a,this._instanceIdBuffer,sn,0),n.capabilities.instancing.drawArraysInstanced(Er.MX.TRIANGLES,0,3,this._numParticles*t),(0,js.UF)(n,a,this._instanceIdBuffer,sn)}_update(e,t,i){const r=i.bindParameters.camera,s=r.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",r.viewMatrix),e.setUniform3fv("cameraPosition",s),e.bindPass(null,i.bindParameters),e.setUniform1f("time",this._renderParameters.time),"rainy"===t?(0,dr.s)(this._particleColor,.85,.85,.85):(0,dr.s)(this._particleColor,1,1,1),(0,dr.g)(this._particleColorAtNight,this._particleColor,this._nightMultiplier),(0,dr.n)(this._cameraDirection,s);const n=Math.max(0,(0,dr.e)(this._cameraDirection,i.bindParameters.lighting.lightingMainDirection));(0,dr.h)(this._particleColor,this._particleColorAtNight,this._particleColor,n),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){(0,I.Wi)(this._vao)&&(this._vao=this._createVertexArrayObject(e)),(0,I.Wi)(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let e=0;e<this._numParticles;e++)t.push(e);return Bs.f.createVertex(e,Er.l1.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Gs.U(e,Ks.attributeLocation,{geometry:(0,ks.K)(rn)},{geometry:Bs.f.createVertex(e,Er.l1.STATIC_DRAW,t)})}};(0,t._)([(0,m.Cb)({constructOnly:!0})],tn.prototype,"context",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],tn.prototype,"view",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],tn.prototype,"updating",null),(0,t._)([(0,m.Cb)()],tn.prototype,"_updatingTracking",void 0),tn=(0,t._)([(0,y.j)("esri.views.3d.environment.Precipitation")],tn);const rn=(0,Us.U$)().vec3f(zs.T.POSITION),sn=(0,ks.K)((0,Us.U$)().f32(zs.T.INSTANCEFEATUREATTRIBUTE),1);var nn=s(15095);const on=p.Z.getLogger("esri.views.3d.environment.SimpleAtmosphere"),an=-1e4,ln=(0,si.uV)([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class cn{constructor(e){this.view=e,this.type="simple",this._renderData={texV:(0,gr.a)(),silCircleCenter:(0,me.c)(),silCircleV1:(0,me.c)(),silCircleV2:(0,me.c)(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new Ls.S,this._fadeVaoCount=0,this._readyResolver=(0,f.hh)(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=(0,$e.BZ)(e.spatialReference);const t=(0,fr.Iu)(e.spatialReference);this.planetRadius=t.radius,this.outerRimWidth=t.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+an)/this.planetRadius,this.middleRimFactor=(this.planetRadius+0)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=0/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=(0,I.hw)(this._cameraChangeHandle),this._passParameters.texture=(0,I.O3)(this._passParameters.texture),this._fadeVao=(0,I.O3)(this._fadeVao),this._vao=(0,I.O3)(this._vao),this._readyController=(0,I.IM)(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(e){this._shaderTechniqueRepository=e.shaderTechniqueRepository;const t=e.renderContext.rctx;this._cameraChangeHandle=(0,he.YP)((()=>this.view.state?.camera),(()=>e.requestRender()),he.tX),this._vao=this._createRibbon(t),this._vaoCount=(0,js._V)(this._vao,"geometry"),this._fadeVao=(0,Lr.ow)(t),this._fadeVaoCount=(0,js._V)(this._fadeVao,"geometry");const i=this.isOnMars?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==":Fs,r=this._readyController.signal;try{const s=await(0,Is.t)(i,{signal:r});(0,f.k_)(r),this._passParameters.texture=new Hs.x(t,{pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.CLAMP_TO_EDGE,samplingMode:Er.cw.LINEAR,flipped:!0},s),e.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(e){(0,f.D_)(e)||on.error("Unable to initialize simple atmosphere: image request failed",e),this._readyResolver.reject(e)}}get coneTechnique(){if((0,I.Wi)(this._coneTechnique)){const e=new Ds.f;e.geometry=Ds.n.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(Ns,e)}return this._coneTechnique}get undergroundTechnique(){if((0,I.Wi)(this._undergroundTechnique)){const e=new Ds.f;e.geometry=Ds.n.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(Ns,e)}return this._undergroundTechnique}render(e){const t=e.bindParameters.camera;this._update(t);const i=e.rctx;if(this._renderData.undergroundFadeAlpha<1){const r=i.bindTechnique(this.coneTechnique,this._passParameters,e.bindParameters);r.setUniformMatrix4fv("proj",t.projectionMatrix),r.setUniformMatrix4fv("view",t.viewMatrix),r.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),r.setUniform3fv("silCircleV1",this._renderData.silCircleV1),r.setUniform3fv("silCircleV2",this._renderData.silCircleV2),r.setUniform2fv("texV",this._renderData.texV),r.setUniform1f("altitudeFade",this._renderData.altitudeFade),r.setUniform1f("innerScale",this._renderData.innerScale),i.bindVAO(this._vao),i.drawArrays(Er.MX.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const r=i.bindTechnique(this.undergroundTechnique,this._passParameters,e.bindParameters);r.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),r.setUniform3fv("cameraPosition",t.eye),i.bindVAO(this._fadeVao),i.drawArrays(Er.MX.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(e){const t=(0,me.c)(),i=this.planetRadius,r=(0,dr.l)(e.eye),s=r-i;if(s<0){const e=Math.min(-s/5e3,1);this._renderData.undergroundFadeAlpha=e}else this._renderData.undergroundFadeAlpha=0;const n=Math.max(50,s),o=i+an;this._renderData.innerScale=function(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}(i+n,i,o)-1,this._renderData.altitudeFade=yr(s),(0,dr.g)(t,e.eye,(i+50)/r),un(t,e.center,e.up,i,this._renderData);const a=this._computeScreenRimWidth(e,t,e.up,this._renderData),l=1-511/512,c=ln(s);let u=this.texV0+l*this.texVScale,h=this.texV0+a*c*this.texVScale;if(s>50){un(e.eye,e.center,e.up,i,this._renderData);const t=this._computeScreenRimWidth(e,e.eye,e.up,this._renderData),r=(0,$.uZ)((t-1.5)/(a-1.5),0,1);u=this.texV0+r*l*this.texVScale,h=this.texV0+(0,$.t7)(this.texV1,a*c,r)*this.texVScale}(0,mr.a)(this._renderData.texV,u,h)}_createRibbon(e){const t=new Float32Array(1155),i=new Uint32Array(1920);t[0]=0,t[1]=0,t[2]=-1;for(let e=0;e<128;e++){const r=9*e+3;t[r+0]=e,t[r+1]=this.innerRimFactor,t[r+2]=-1,t[r+3]=e,t[r+4]=this.middleRimFactor,t[r+5]=0,t[r+6]=e,t[r+7]=this.outerRimFactor,t[r+8]=1;const s=3*e+1,n=127===e?1:s+3,o=15*e;i[o+0]=s,i[o+1]=s+1,i[o+2]=n+1,i[o+3]=n+1,i[o+4]=n,i[o+5]=s,i[o+6]=s+1,i[o+7]=s+2,i[o+8]=n+2,i[o+9]=n+2,i[o+10]=n+1,i[o+11]=s+1,i[o+12]=s,i[o+13]=n,i[o+14]=0}const r=fn.createBuffer(i.length),s=r.position;for(let e=0;e<i.length;++e){const r=3*i[e];s.set(e,0,t[r]),s.set(e,1,t[r+1]),s.set(e,2,t[r+2])}return new Gs.U(e,Tr.i,{geometry:(0,ks.K)(fn)},{geometry:Bs.f.createVertex(e,Er.l1.STATIC_DRAW,r.buffer)})}_computeScreenRimWidth(e,t,i,r){return(0,dr.a)(dn,r.silCircleCenter,r.silCircleV2),(0,dr.g)(pn,dn,this.outerRimFactor),(0,Fr.n)(hn,t,dn,i),(0,nn.iV)(dn,hn,e.projectionMatrix,e.viewport),(0,nn.iV)(pn,hn,e.projectionMatrix,e.viewport),(0,dr.i)(dn,pn)/e.height}}function un(e,t,i,r,s){const n=(0,dr.l)(e),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.silCircleV1,c=s.silCircleV2;return(0,dr.g)(s.silCircleCenter,e,a/n),(0,dr.f)(l,e,t),(0,dr.p)(l)<1&&(0,dr.f)(l,e,i),(0,dr.g)(l,l,o/(0,dr.l)(l)),(0,dr.f)(c,l,e),(0,dr.g)(c,c,o/(0,dr.l)(c)),o}const hn=(0,kr.c)(),dn=(0,me.c)(),pn=(0,me.c)(),fn=(0,Us.U$)().vec3f(zs.T.POSITION);var mn=s(36567),gn=s(26761);class yn extends Pr.K{constructor(){super(...arguments),this.modelMatrix=(0,kr.c)()}}class _n extends Cr.A{constructor(e){super(e,null,(()=>this.destroy()))}initializeProgram(e){const t=_n.shader.get().build();return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.SRC_ALPHA,Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA,Er.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Er.wb.LEQUAL},colorWrite:Ar.BK})}}_n.shader=new xr.J(gn.S,(()=>s.e(4506).then(s.bind(s,84506))));const vn=p.Z.getLogger("esri.views.3d.environment.Stars");let bn=class extends O.Z{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new yn,this._updatingTracking=new Ke.t}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return(0,I.pC)(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=(0,I.IM)(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=(0,I.RY)(this._technique),this._vao=(0,I.O3)(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),(0,I.Wi)(this._technique)||(0,I.Wi)(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Er.MX.POINTS,0,this._numPoints)}_ensureResources(e){if((0,I.pC)(this._technique)||(0,I.Wi)(En))return;this._technique=new _n({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=En.byteLength/Tn;const t=new Float32Array(En,0,2*this._numPoints),i=new Uint8Array(En,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add((()=>"sun"===this.view.environment.lighting.type?this.view.environment.lighting.date:null),(e=>this._update(e)),he.nn)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=(0,Fr.c)(this._renderParameter.modelMatrix,Cn);(0,Fr.g)(r,r,-i*Math.PI),(0,Fr.m)(r,xn,r),(0,Fr.g)(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const s=Sn.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let e=0;e<r;e++){const r=t[2*e+0],s=t[2*e+1];n.set(e,0,-Math.cos(r)*Math.sin(s)),n.set(e,1,-Math.sin(r)*Math.sin(s)),n.set(e,2,-Math.cos(s));const l=this._unpackUint8Attributes(i[e]),c=this._hexToRGB(wn[l[1]]);o.set(e,0,255*c[0]),o.set(e,1,255*c[1]),o.set(e,2,255*c[2]),o.set(e,3,255),a.set(e,l[0])}return new Gs.U(e,Tr.i,{geometry:(0,ks.K)(Sn)},{geometry:Bs.f.createVertex(e,Er.l1.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if((0,I.pC)(En))return null;const e=(0,f.vr)((async e=>{const{data:t}=await(0,mn.b)("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:e});this._verifyStarData(t),En=t}));return e.promise.catch((e=>{(0,f.D_)(e)||vn.error(e)})).then((()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))})),e}_verifyStarData(e){if(!e)throw new l.Z("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/Tn;if(t%1!=0||t>5e4||t<5e3)throw new l.Z("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};(0,t._)([(0,m.Cb)({constructOnly:!0})],bn.prototype,"view",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],bn.prototype,"requestRender",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],bn.prototype,"updating",null),(0,t._)([(0,m.Cb)()],bn.prototype,"_loadDataTask",void 0),(0,t._)([(0,m.Cb)()],bn.prototype,"_updatingTracking",void 0),bn=(0,t._)([(0,y.j)("esri.views.3d.environment.Stars")],bn);const wn=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],xn=(0,kr.f)(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Cn=(0,kr.f)(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Tn=9,Sn=(0,Us.U$)().vec3f(zs.T.POSITION).vec4u8(zs.T.COLOR).f32(zs.T.SIZE);let En=null;var An,Mn=s(38208),On=s(46378);const Rn=[On.r.POSTPROCESSING_ENVIRONMENT_OPAQUE,On.r.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Pn,In=An=class extends O.Z{constructor(e){super(e),this._handles=new Ae.Z,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(Rn,this)}destroy(){this._pendingAtmosphere=(0,I.SC)(this._pendingAtmosphere),null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this),this._handles=(0,I.SC)(this._handles),this._set("view",null)}get atmosphereType(){return(0,I.pC)(this._pendingAtmosphere)?this._pendingAtmosphere.type:(0,I.pC)(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){return!!this.view.basemapTerrain?.renderer.canRender||"global"!==this.view.viewingMode}get needsLinearDepth(){return"realistic"===this._selectAtmosphereType()}updateAnimation(e){return!!(0,I.pC)(this._precipitation)&&this._precipitation.update(e)}get updating(){return(0,I.pC)(this._pendingAtmosphere)||(0,I.pC)(this._stars)&&this._stars.updating||(0,I.pC)(this._clouds)&&this._clouds.running}get weatherVisible(){return(0,dr.l)(this.view.state.camera.eye)-(0,fr.Iu)(this.view.spatialReference).radius<=$i}get _stars(){const e=this.view,t=e.environment?.starsEnabled??!1,i=this._get("_stars");return!t||(0,I.Wi)(this._context)?((0,I.SC)(i),null):(0,I.pC)(i)?i:new bn({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||(0,I.Wi)(this._context))return(0,I.SC)(e),null;const t=this.view,i=this._context;return(0,I.pC)(e)&&e.context===i?e:((0,I.SC)(e),new tn({context:i,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||(0,I.Wi)(this._context))return(0,I.SC)(e),null;if((0,I.pC)(e))return e;const t=this.view,i=this._context;return(0,I.SC)(e),new xs({context:i,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||(0,I.Wi)(this._context))return(0,I.SC)(e),null;const t=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=(0,fr.Iu)(this.view.spatialReference).radius;return(0,I.pC)(e)&&e.viewingMode===t&&e.planetRadius===r?e:((0,I.SC)(e),new Xr({rctx:i,viewingMode:t,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||(0,I.Wi)(this._context))return(0,I.SC)(e),null;if((0,I.pC)(e))return e;const t=this.view,i=this._context;return(0,I.SC)(e),new Rs({context:i,view:t})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}initializeRenderContext(e=null){this._context=e,this._handles.add([(0,he.gx)((()=>this.view?.basemapTerrain),(()=>this._updateBasemapTerrain()),he.tX),(0,he.YP)((()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality})),(()=>this._updateAtmosphere()),he.tX),(0,he.YP)((()=>this._stars),(()=>this._setNeedsRender())),(0,he.YP)((()=>this._clouds),(()=>this._updateWeather(this._weatherUpdateParameters)),he.nn),(0,he.YP)((()=>this._precipitation),(()=>this._setNeedsRender())),(0,he.YP)((()=>this._fog),(()=>this._updateFog(this._weatherUpdateParameters)),he.nn),(0,he.YP)((()=>this._weatherUpdateParameters),(e=>{this._updateWeather(e),this._updateFog(e)}),he.tX)])}uninitializeRenderContext(){this._context=null,this._atmosphere=(0,I.SC)(this._atmosphere),this._set("_stars",(0,I.SC)(this._stars)),this._set("_precipitation",(0,I.SC)(this._precipitation)),this._set("_clouds",(0,I.SC)(this._clouds)),this._set("_cloudsComposition",(0,I.SC)(this._cloudsComposition)),this._set("_fog",(0,I.SC)(this._fog))}prepareRender(e){var t;e.bindParameters.clouds.data=(t=this._clouds,(0,I.pC)(t)&&(0,I.pC)(t.cubeMap)&&t.coverage>0?this._clouds:null)}render(e){if(e.pass===Mn.C.MATERIAL)switch(e.bindParameters.slot){case On.r.POSTPROCESSING_ENVIRONMENT_OPAQUE:(0,I.pC)(this._stars)&&this._stars.render(e),(0,I.pC)(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),(0,I.pC)(this._cloudsComposition)&&(0,I.pC)(e.bindParameters.clouds.data)&&(this.weatherVisible&&(0,I.pC)(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(e,(0,I.pC)(this.view.animation))));break;case On.r.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if((0,I.pC)(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,"rainy"===t),(0,I.pC)(this._fog)){const i="foggy"===t||"rainy"===t||"snowy"===t;(i||"realistic"!==this._selectAtmosphereType())&&this._fog.render(e,i,"rainy"===t)}if((0,I.pC)(this._precipitation)){const t=this.view.environment.weather;"rainy"!==t.type&&"snowy"!==t.type||this._precipitation.render(e,t.precipitation,t.type)}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return(0,I.Wi)(e)?null:"rainy"===e.type||"snowy"===e.type?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:"foggy"===e.type?e.fogStrength:e.cloudCover}}_updateWeather(e){(0,I.Wi)(e)||(0,I.Wi)(this._clouds)||(this._clouds.applyPreset(ps[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){(0,I.pC)(this._context)&&this._context.requestRender()}_updateFog(e){if(!(0,I.Wi)(this._fog)&&!(0,I.Wi)(e))switch(e.type){case"foggy":this._fog.strength=(0,$.t7)(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=(0,$.t7)(4e-6,2e-4,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;(0,I.pC)(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return(0,I.pC)(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const i=new t(this.view);(0,I.pC)(this._context)&&i.initializeRenderContext(this._context),(0,I.Wi)(this._atmosphere)&&(this._atmosphere=i,this._setNeedsRender()),this._pendingAtmosphere=i,i.when().then((()=>{(0,I.pC)(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()})).catch((()=>{this._pendingAtmosphere===i&&(this._pendingAtmosphere=null)}))}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return Dr;case"panoramic":return Zs;case"simple":return cn;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),i=this.view.viewingMode;return!e||null==t||(0,$e.V2)(this.view.spatialReference)?"none":"local"===i?"panoramic":"high"===t&&(0,I.pC)(this._context)&&Dr.isSupported(this._context)&&(0,$e.N$)(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=(0,I.pC)(this._atmosphere)&&"simple"===this.atmosphereType)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{Pn=An.prototype._getAtmosphereClass,An.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{An.prototype._getAtmosphereClass=Pn}}}};function Ln(e,t,i){return function(e,t,i,r,s){const n=(0,$.Vl)(i),o=(0,$.Vl)(s),a=n-o,l=(0,$.Vl)(t)-(0,$.Vl)(r),c=Math.sin(a/2),u=Math.sin(l/2),h=2*(0,$.Kt)(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*u*u))*e;return Math.round(1e4*h)/1e4}(e,t.longitude,t.latitude,i.longitude,i.latitude)}function Dn(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=function(e,t){let i=e/15;return t||(i=Math.round(i)),i}(e[0],!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const r=t.minutes%1;return t.minutes-=r,t.seconds=Math.round(60*r),t}(0,t._)([(0,m.Cb)({constructOnly:!0})],In.prototype,"view",void 0),(0,t._)([(0,m.Cb)({type:Boolean,readOnly:!0})],In.prototype,"updating",null),(0,t._)([(0,m.Cb)({readOnly:!0})],In.prototype,"weatherVisible",null),(0,t._)([(0,m.Cb)()],In.prototype,"_context",void 0),(0,t._)([(0,m.Cb)()],In.prototype,"_pendingAtmosphere",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],In.prototype,"_stars",null),(0,t._)([(0,m.Cb)({readOnly:!0})],In.prototype,"_precipitation",null),(0,t._)([(0,m.Cb)({readOnly:!0})],In.prototype,"_clouds",null),(0,t._)([(0,m.Cb)({readOnly:!0})],In.prototype,"_cloudsComposition",null),(0,t._)([(0,m.Cb)({readOnly:!0})],In.prototype,"_fog",null),(0,t._)([(0,m.Cb)({readOnly:!0})],In.prototype,"weatherEnabled",null),(0,t._)([(0,m.Cb)({readOnly:!0})],In.prototype,"_precipitationEnabled",null),(0,t._)([(0,m.Cb)({readOnly:!0})],In.prototype,"_weatherUpdateParameters",null),In=An=(0,t._)([(0,y.j)("esri.views.3d.environment.EnvironmentRenderer")],In);var Nn,Fn,kn,Un={exports:{}};Nn=Un,Fn=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,u=2451545,h={dec:0,ra:0};function d(e){return new Date((e+.5-c)*l)}function p(e){return function(e){return e.valueOf()/l-.5+c}(e)-u}var f=23.4397*a;function m(e,s){return n(t(e)*i(f)-r(s)*t(f),i(e))}function g(e,r){return s(t(r)*i(f)+i(r)*t(f)*t(e))}function y(e,s,o){return n(t(e),i(e)*t(s)-r(o)*i(s))}function _(e,r,n){return s(t(r)*t(n)+i(r)*i(n)*i(e))}function v(e,t){return a*(280.16+360.9856235*e)-t}function b(e){return a*(357.5291+.98560028*e)}function w(e){return a*(1.9148*t(e)+.02*t(2*e)+3e-4*t(3*e))}function x(t,i){return t+i+102.9372*a+e}function C(e,t){var i=b(e),r=x(i,w(i));return t||(t={dec:0,ra:0}),t.dec=g(r,0),t.ra=m(r,0),t}var T={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(e,t,i,r){var s=a*-i,n=a*t,o=p(e),l=C(o,h),c=v(o,s)-l.ra;return r||(r={azimuth:0,altitude:0}),r.azimuth=y(c,n,l.dec),r.altitude=_(c,n,l.dec),r}},S=[[-.83,"sunrise","sunset"]];T.addTime=function(e,t,i){S.push([e,t,i])};var E=9e-4;function A(t,i){return Math.round(t-E-i/(2*e))}function M(t,i,r){return E+(t+i)/(2*e)+r}function O(e,i,r){return u+e+.0053*t(i)-.0069*t(2*r)}function R(e,r,s){return o((t(e)-t(r)*t(s))/(i(r)*i(s)))}function P(e){var r=a*(134.963+13.064993*e),s=a*(93.272+13.22935*e),n=a*(218.316+13.176396*e)+6.289*a*t(r),o=5.128*a*t(s),l=385001-20905*i(r);return{ra:m(n,o),dec:g(n,o),dist:l}}return T.getTimes=function(e,r,s){var n=a*-s,o=a*r,l=A(p(e),n),c=M(0,n,l),u=b(c),h=w(u),f=x(u,h),m=g(f,0),y=O(c,u,f);function _(e){return O(M(R(e,o,m),n,l),u,f)}var v,C,E,P,I,L={solarNoon:d(y),nadir:d(y-.5),polarException:T.PolarException.NORMAL};for(v=0,C=S.length;v<C;v+=1)I=y-((P=_((E=S[v])[0]*a))-y),L[E[1]]=d(I),L[E[2]]=d(P);return L.polarException=function(e){var r=(t(e)-t(o)*t(m))/(i(o)*i(m));return r<-1?T.PolarException.MIDNIGHT_SUN:r>1?T.PolarException.POLAR_NIGHT:T.PolarException.NORMAL}(S[0][0]*a),L},T.getMoonPosition=function(e,t,i){var s=a*-i,n=a*t,o=p(e),l=P(o),c=v(o,s)-l.ra,u=_(c,n,l.dec);return u+=.017*a/r(u+10.26*a/(u+5.1*a)),{azimuth:y(c,n,l.dec),altitude:u,distance:l.dist}},T.getMoonFraction=function(e){var r=p(e),s=C(r),a=P(r),l=149598e3,c=o(t(s.dec)*t(a.dec)+i(s.dec)*i(a.dec)*i(s.ra-a.ra)),u=n(l*t(c),a.dist-l*i(c));return(1+i(u))/2},T},void 0!==(kn=Fn())&&(Nn.exports=kn);const Vn=Un.exports,zn={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function Bn(e,t,i,r,s,n,o){(0,dr.s)(o.ambient.color,1,1,1),o.ambient.intensity=zn.global.ambient,(0,dr.s)(o.direct.color,1,1,1),o.direct.intensity=zn.global.direct;const a=t[2],l=(0,$.uZ)((Math.abs(a)-zn.local.altitude)/(zn.global.altitude-zn.local.altitude),0,1);let c;if(o.globalFactor=l,"sun"===n&&(c=Vn.getTimes(e,t[1],t[0])),l<1){let t;if("sun"===n)t=function(e,t,i){const r=e.valueOf();let s,n;t.polarException===Vn.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===Vn.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,u=a+l,h=.06*o,d=s-h/2,p=s+h/2,f=n-h/2,m=n+h/2,g=zn.local,y=[.01,g.ambientAtNight],_=[.8,.8,1],v=[.01,.01,.01],b=[g.directAtTwilight,g.ambientAtTwilight],w=[1,.6,.5],x=[.8,.8,1],C=[.9*g.directAtNoon,g.ambientAtNoon],T=[1,.98,.98],S=[.98,.98,1],E=[g.directAtNoon,g.ambientAtNoon],A=[1,1,1],M=[1,1,1],O=C,R=T,P=S,I=b,L=w,D=x;let N,F,k=[0,0],U=[0,0,0],V=[0,0,0];r<d||r>m?(k=y,U=v,V=_,F="night"):r<p?(N=p-d,k=$n(r-d,N,y,b),U=$n(r-d,N,v,w),V=$n(r-d,N,_,x),F="sun rising"):r<c?(N=c-p,k=$n(r-p,N,b,C),U=$n(r-p,N,w,T),V=$n(r-p,N,x,S),F="early morning"):r<a?(N=a-c,k=$n(r-c,N,C,E),U=$n(r-c,N,T,A),V=$n(r-c,N,S,M),F="late morning"):r<u?(N=u-a,k=$n(r-a,N,E,O),U=$n(r-a,N,A,R),V=$n(r-a,N,M,P),F="early afternoon"):r<f?(N=f-u,k=$n(r-u,N,O,I),U=$n(r-u,N,R,L),V=$n(r-u,N,P,D),F="late afternoon"):r<m&&(N=m-f,k=$n(r-f,N,I,y),U=$n(r-f,N,L,v),V=$n(r-f,N,D,_),F="sun setting");let z=0;switch(i){case"rainy":case"foggy":z=.9;case"snowy":z=.5}z>0&&(U=qn(U,z),V=qn(V,z));const B=(0,me.f)(U[0],U[1],U[2]),H=(0,me.f)(V[0],V[1],V[2]),j=Zn(i);return{direct:{intensity:k[0]*j.direct,color:B},ambient:{intensity:k[1]*j.ambient,color:H},timeOfDay:F}}(e,c,r);else{const e=Zn(r);t={direct:{intensity:zn.local.directAtNoon*e.direct,color:(0,me.f)(1,1,1)},ambient:{intensity:zn.local.ambientAtNoon*e.ambient,color:(0,me.f)(1,1,1)},timeOfDay:"early afternoon"}}(0,dr.h)(o.ambient.color,t.ambient.color,o.ambient.color,l),o.ambient.intensity=(0,$.t7)(t.ambient.intensity,o.ambient.intensity,l),(0,dr.h)(o.direct.color,t.direct.color,o.direct.color,l),o.direct.intensity=(0,$.t7)(t.direct.intensity,o.direct.intensity,l),o.specularStrength="rainy"===r||"snowy"===r||"foggy"===r?0:1,o.environmentStrength="rainy"===r?.7:"snowy"===r||"foggy"===r?.75:1}o.noonFactor="sun"===n?function(e,t){const i=e.valueOf();let r,s;t.polarException===Vn.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===Vn.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=r+(s-r)/2;return 1-(0,$.uZ)(Math.abs(i-n)/432e5,0,1)}(e,c):1,"sun"===n?function(e,t,i,r){const s=Wn,n=(0,Fr.i)(Gn);if(i===Nt.JY.Global)Vn.getPosition(e,0,0,s),(0,dr.s)(r,0,0,-1),(0,Fr.r)(n,n,-s.azimuth),(0,Fr.o)(n,n,-s.altitude),(0,dr.m)(r,r,n);else{const i=zn.planarDirection,o=i.globalAngles,a=t[2];let l=(Math.abs(a)-i.localAltitude)/(i.globalAltitude-i.localAltitude);l=(0,$.uZ)(l,0,1),l<1?(Vn.getPosition(e,t[1],t[0],s),s.azimuth=(1-l)*s.azimuth+l*o.azimuth,s.altitude=(1-l)*s.altitude+l*o.altitude):(s.azimuth=o.azimuth,s.altitude=o.altitude),(0,dr.s)(r,0,-1,0),(0,Fr.g)(n,n,-s.azimuth),(0,Fr.r)(n,n,-s.altitude),(0,dr.m)(r,r,n)}}(e,t,i,o.direct.directionToLightSource):function(e,t,i){t===Nt.JY.Global?(0,dr.n)(Xn,e.eye):(0,dr.s)(Xn,0,0,1),(0,dr.g)(Jn,e.viewForward,-1);const r=(0,si.EU)(Jn,Xn),s=Math.max(r-2*Qn,0),n=.85*s/(s+1),o=Math.max(Qn,r-Qn-n);(0,Fr.d)(Yn,-o,e.viewRight),(0,dr.m)(i,Jn,Yn),(0,dr.a)(i,i,(0,dr.g)(Kn,e.viewRight,eo)),(0,dr.n)(i,i)}(s,i,o.direct.directionToLightSource)}const Hn=(0,me.f)(.5773502691896258,-.5773502691896258,.5773502691896258);class jn{constructor(){this.ambient={color:(0,me.f)(1,1,1),intensity:.55},this.direct={color:(0,me.f)(1,1,1),intensity:.55,directionToLightSource:(0,me.a)(Hn)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const Gn=(0,kr.c)(),Wn={azimuth:0,altitude:0};function Zn(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function qn(e,t){const i=(e[0]+e[1]+e[2])/3;for(let r=0;r<3;r++)e[r]=e[r]+(i-e[r])*t;return e}function $n(e,t,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*e/t+i[n];return s}new Date(0);const Yn=(0,kr.c)(),Xn=(0,me.c)(),Jn=(0,me.c)(),Kn=(0,me.c)(),Qn=.25,eo=.2;var to=s(23627);let io=class extends P.Z.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Ae.Z,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new to.Eg,this._ambientLight=new to.Mi,this._moonLight=new to.AM,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===Nt.JY.Global&&(0,$e.N$)(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new In({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler(),r=()=>this._updateLighting();this._viewHandles.add([(0,he.YP)((()=>e.environment.lighting),(e=>this._updateLightingHandler(e)),he.Z_),(0,he.YP)((()=>"sun"===e.environment.lighting.type?e.environment.lighting.date:null),(e=>this._lightingDateHandler(e)),he.Z_),(0,he.YP)((()=>e.stationary),(()=>this._interactingStationaryHandler())),(0,he.YP)((()=>e.environment.lighting.directShadowsEnabled),t,he.Z_),(0,he.YP)((()=>e.environment.lighting.ambientOcclusionEnabled),t,he.Z_),(0,he.YP)((()=>e.environment.lighting.waterReflectionEnabled),t,he.Z_),(0,he.YP)((()=>e.environment.background?.color),t,he.Z_),(0,he.YP)((()=>e.spatialReference),(()=>this._resetReferencePosition(!0)),he.Z_),(0,he.YP)((()=>e.environment.weather.type),r,he.Z_),(0,he.YP)((()=>this.weatherEnabled),r,he.Z_),(0,he.YP)((()=>e.viewingMode),(()=>this._resetReferencePosition(!0)),he.tX),(0,he.YP)((()=>"sun"===e.environment.lighting.type&&e.environment.lighting.cameraTrackingEnabled),(e=>this._updateCameraTracking(e)),he.tX),(0,he.YP)((()=>e.state.camera),i,he.tX),(0,he.YP)((()=>this.disableQueries),i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=(0,I.SC)(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking("sun"===e.type&&e.cameraTrackingEnabled),this._lightingDateHandler("sun"===e.type?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const e=this._view.environment.lighting;"sun"===e?.type&&(e.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if("virtual"!==t?.type){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!(0,_e.jF)(i)){const e=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(e))return void this._requestReferencePositionUpdate(e)}if(this._preupdateTracking(e),(0,I.pC)(this._referencePosWGS84Comparable)){const e=Dn(this._referencePosWGS84Comparable,oo);(0,I.pC)(e)&&(t.autoUpdate(null,e),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&"sun"===this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){const i=(0,$e.N$)(this._view.spatialReference);if(i&&!(0,_e.jF)(this._view.spatialReference))return!1;const r=e.position;return(0,I.Wi)(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=(0,me.c)()),i?(0,_e.UY)(r,this._referencePosWGS84Comparable):(0,dr.s)(this._referencePosWGS84Comparable,r.longitude,r.latitude,r.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,i=e||("sun"===t.environment.lighting.type?t.environment.lighting.date:null),r=this._referencePosWGS84Comparable,s=(0,I.pC)(r)?ro:so;if((0,I.pC)(r)){const e=this.weatherVisible?t.environment.weather.type:"disabled";Bn(i,r,t.state.viewingMode,e,t.state.camera,t.environment.lighting.type,s)}const n=this._mainLight,o=s.direct;(0,dr.g)(n.intensity,o.color,o.intensity*Math.PI),(0,dr.c)(n.direction,o.directionToLightSource),n.specularStrength=s.specularStrength,n.environmentStrength=s.environmentStrength;const a=this._ambientLight;(0,dr.g)(a.intensity,s.ambient.color,s.ambient.intensity);const l=this._moonLight;(0,dr.h)(l.intensity,ao,lo,s.globalFactor);const c=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));(0,dr.g)(l.intensity,l.intensity,c),(0,dr.c)(l.direction,o.directionToLightSource),t._stage.renderView.updateLightSources([n,a,l],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||(0,I.Wi)(e))return!1;const i=no;i.setTime((t||this._view.environment.lighting.date).getTime());const r=Dn(e,oo);if((0,I.Wi)(r))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;const n=i.getUTCHours()-(r.hours-s.hours),o=i.getUTCMinutes()-(r.minutes-s.minutes),a=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=(0,I.R2)(this._referencePosWGS84Comparable,!0,(e=>function(e,t){if(t===Nt.JY.Global)return!0;const i=zn.planarDirection;return Math.abs(e)<i.localAltitude}(e[2],this._view.state.viewingMode))),i=this._view.environment.background,s=i instanceof tr?{type:"color",color:(0,pr.b)(r.Z.toUnitRGBA(i.color))}:{type:"color",color:(0,pr.f)(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const e=this._referencePosUpdateQuery=(0,f.e4)(this._referencePointUpdateDelay).then((()=>{if(this._referencePosUpdateQuery===e){const t=()=>this._referencePosUpdateQuery!==e;return this._doReferencePositionUpdateQuery(t)}})).catch((e=>{"mapcoordshelper:missing-geometry-service"===e.name&&(this.disableQueries=!0)})).then((()=>{this._referencePosUpdateQuery===e&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))})),t=this._referencePosUpdateTimer=(0,f.e4)(this._referencePointUpdateInterval).then((()=>{this._referencePosUpdateTimer===t&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())}));this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const e=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=e):this._referencePosWGS84Comparable=[t[0],t[1],e],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};(0,t._)([(0,m.Cb)({type:Boolean,readOnly:!0})],io.prototype,"updating",null),(0,t._)([(0,m.Cb)()],io.prototype,"disableQueries",void 0),(0,t._)([(0,m.Cb)()],io.prototype,"_disableWeather",void 0),(0,t._)([(0,m.Cb)()],io.prototype,"weatherEnabled",null),(0,t._)([(0,m.Cb)()],io.prototype,"weatherVisible",null),(0,t._)([(0,m.Cb)()],io.prototype,"referencePositionWGS84Comparable",null),(0,t._)([(0,m.Cb)()],io.prototype,"_renderer",void 0),(0,t._)([(0,m.Cb)()],io.prototype,"_referencePosWGS84Comparable",void 0),io=(0,t._)([(0,y.j)("esri.views.3d.environment.SceneViewEnvironmentManager")],io);const ro=new jn,so=new jn,no=new Date,oo={hours:0,minutes:0,seconds:0},ao=(0,me.f)(.22,.22,.33),lo=(0,me.f)(.22,.22,.22);var co,uo,ho,po,fo=s(91917),mo=s(97537);function go(e,t){return 0!=(e&t)}function yo(e,t,i,r,s,n){0!==e&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):null!=r?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}(po=co||(co={}))[po.NONE=0]="NONE",po[po.ZOOM=1]="ZOOM",po[po.TUMBLE=2]="TUMBLE",po[po.LOOK_AROUND=3]="LOOK_AROUND",po[po.PAN=4]="PAN",po[po.ASCEND=5]="ASCEND",function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(uo||(uo={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(ho||(ho={}));const _o={selection:uo.NONE,interactionType:co.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ho.TUMBLE};function vo(e,t,i,r){return t=t||e.viewForward,(0,dr.c)(r,t),(0,dr.g)(r,r,Math.sign((0,dr.e)(t,i))),r}var bo=s(18979);function wo(e,t,i=_o){if(!function(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i||t.interactionType===co.TUMBLE&&go(t.selection,uo.TILT))}(e,i))return 0;const r=function(e,t){return t.min=e.min,t.max=e.max,t}(e.state.constraints.altitude,xo);!function(e,t,i){const r=t.interactionType;if(r===co.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===co.TUMBLE||r===co.ZOOM,c=wo(e,o),u=0===c?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,yo(c,u,l,a,.05*u,i)}(e,i,r);const s=e.renderCoordsHelper.getAltitude(t.eye),n=(0,$.uZ)(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}const xo={min:0,max:0},Co=(0,me.c)(),To=(0,me.c)(),So=(0,me.c)(),Eo=(0,me.c)();function Ao(e,t,i=_o){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;Oo.min=0,Oo.max=r,function(e,t,i){const r=t.interactionType;if(r===co.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===co.ZOOM||r===co.PAN,c=Ao(e,o),u=0===c?0:Mo(e,o);i.min=s,i.max=n,yo(c,u,l,a,.05*u,i)}(e,i,Oo);const s=Mo(e,t),n=Oo.max-s;return n>=-1e-6?0:n}function Mo(e,t){const i=e.pointsOfInterest.surfaceOrigin;return(0,dr.i)(t.eye,i.renderLocation)}const Oo={min:0,max:0},Ro=(0,me.c)(),Po=(0,me.c)(),Io=(0,me.c)(),Lo=(0,me.c)(),Do=(0,me.c)();var No=s(8927);function Fo(e,t,i,r){return(0,I.pC)(e.renderCoordsHelper.fromRenderCoords(t.eye,Bo,r))&&(0,ve.BD)(i,Bo)}function ko(e,t){return e.elevationProvider?(0,I.Pt)(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function Uo(e,t,i,r){const s=e.state.camera.clone();t&&(s.eye=t,s.center=i,s.up=r),function(e,t,i){let r=zo[e.viewingMode];r||(r=(0,No.Z8)(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,zo[e.viewingMode]=r);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||Vo(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||Vo(e,t.origin,i))||!!s&&function(e,t,i){const r=(0,dr.e)(e.origin,e.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return(0,dr.g)(t,e.direction,s/(0,dr.l)(e.direction)),(0,dr.a)(t,t,e.origin),!0}(t,i,(0,fr.Iu)(e.spatialReference).radius)}(e,s.ray,Ho)||(0,dr.c)(Ho,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if((0,dr.d)(s.eye,Ho)<o){const t=n.collision.enabled;(0,dr.c)(jo,s.viewForward),(0,dr.g)(jo,jo,o),t?s.eye=(0,dr.b)(Bo,Ho,jo):(0,dr.a)(Ho,s.eye,jo);const i=e.renderCoordsHelper,r=i.getAltitude(s.eye),a=n.collision.elevationMargin;t&&r<a&&((0,dr.b)(jo,Ho,s.eye),s.eye=i.setAltitude(Bo,a,s.eye),(0,dr.a)(Ho,s.eye,jo))}return s.center=Ho,s}function Vo(e,t,i){if(!e.state.isGlobal)return!1;const r=ko(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,i,e.renderDataExtent,r,Go),o=n*n;return(0,dr.d)(t,i)>o}const zo={},Bo=(0,me.c)(),Ho=(0,me.c)(),jo=(0,me.c)(),Go={near:0,far:0};function Wo(e,t,i=Zo.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const s=ko(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=(0,dr.l)(t.eye);if((0,dr.b)(qo,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude($o,o,t.eye),i===Zo.EYE_AND_CENTER)t.center=(0,dr.a)(qo,t.eye,qo);else if(i===Zo.EYE_AND_CENTER_SCALE){const e=(a-n+o)/a;t.center=(0,dr.g)(qo,t.center,e)}return!0}var Zo;!function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"}(Zo||(Zo={}));const qo=(0,me.c)(),$o=(0,me.c)();function Yo(e,t,i){e.worldUpAtPosition(t,Xo),(0,dr.b)(Jo,i,t);const r=(0,dr.l)(Jo);return 0===r?0:(0,$.ZF)((0,dr.e)(Jo,Xo)/r)}const Xo=(0,me.c)(),Jo=(0,me.c)();function Ko(e,t,i=_o,r=_o,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,oa);return function(e,t,i){if(t.interactionType===co.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=t,{min:n,max:o}=i,a=Ko(e,r,_o,t),l=0===a?0:Yo(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,t.interactionType===co.TUMBLE?(go(t.selection,uo.ALTITUDE)&&ta(e,r,i),yo(a,l,!0,s,na,i)):yo(a,l,!1,s,na,i)}(e,i,o),r.interactionType===co.TUMBLE&&go(r.selection,uo.ALTITUDE)&&ta(e,r.interactionStartCamera,o),i.tiltMode===ho.LOOK_AROUND||r.tiltMode===ho.LOOK_AROUND?function(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return function(e,t,i,r){const s=function(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+(0,fr.Iu)(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,sa);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,(0,I.pC)(n)?(i.eyeCenterDistance=(0,dr.i)(t.eye,n),i.tiltAtCenter=Yo(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=Yo(e.renderCoordsHelper,t.center,t.eye):((0,fo.j)((0,fo.k)(fo.t,s),t.ray,sa),i.eyeCenterDistance=(0,dr.i)(t.eye,sa),i.tiltAtCenter=(0,$.ZF)(-(0,dr.e)(t.viewForward,(0,dr.n)(sa,sa)))),i.radius=s,i.eyeRadius=(0,dr.l)(t.eye),i.constraints=e.state.constraints,i}(e,t,aa),n=(0,$.uZ)(s.tiltAtCenter,i.min,i.max);if(!Qo(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=function(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let s=r,n=t.clampTilt(i,r);const o=ea(e,n);if(t.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&Qo(n-s);){const i=(s+n)/2,r=ea(e,i);Qo(t.clampTilt(r,i)-i)?s=i:n=i,a++}return n}(s),a=function(e,t){const i=(0,$.Kt)(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=(0,$.Kt)(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=function(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}(s,o)),r&&(r.eyeCenterDistance=ea(s,o)),a}(e,t,i,r);case"local":return function(e,t,i,r){const s=Yo(e.renderCoordsHelper,t.center,t.eye),n=(0,$.uZ)(s,i.min,i.max),o=s-n;if(!Qo(o))return 0;if(r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=e.renderCoordsHelper.getAltitude(t.eye)-i,o=Math.cos(n);Math.abs(o)>1e-4?r.eyeCenterDistance=s/o:r.eyeCenterDistance=t.distance}return o}(e,t,i,r);default:return void(0,a.Bg)(e.viewingMode)}}(e,t,o,s):function(e,t,i){const r=Yo(e.renderCoordsHelper,t.center,t.eye),s=r-(0,$.uZ)(r,i.min,i.max);return Qo(s)?s:0}(e,t,o)}function Qo(e){return Math.abs(e)>1e-9}function ea(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-(0,$.uZ)(t,0,Math.PI),r=(0,$.Kt)(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){const t=Math.PI-r,s=Math.PI-i-t;return Math.sin(s)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function ta(e,t,i){if(e.state.isLocal)return;const r=e.state.constraints;if(!r.altitude)return;const s=(0,dr.p)(t.center),n=Math.sqrt(s),o=t.distance,a=(0,fr.Iu)(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),h=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-(0,$.ZF)(h),i.max)),i.max=Math.min(i.max,Math.PI-(0,$.ZF)(u))}const ia=(0,me.c)(),ra=(0,kr.c)(),sa=(0,me.c)(),na=(0,$.Vl)(5),oa={min:0,max:0},aa={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},la={eyeCenterDistance:0,requiresTwoSteps:!1},ca=e=>e*e,ua=e=>1-ca(1-e),ha=e=>e*e*e,da=e=>1-ha(1-e),pa=e=>e<.5?ha(2*e)/2:(da(2*(e-.5))+1)/2,fa=e=>e*e*e*e,ma=e=>1-fa(1-e),ga=e=>e*e*e*e*e,ya=e=>1-ga(1-e),_a=e=>1-Math.cos(e*Math.PI/2),va=e=>1-_a(1-e),ba=e=>2**(10*(e-1)),wa=e=>1-ba(1-e),xa=e=>-(Math.sqrt(1-e*e)-1),Ca=e=>1-xa(1-e);function Ta(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function Sa(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const Ea=Sa(Ta(1),1),Aa=Sa(Ta(1),0),Ma=Sa(Ta(1),.5),Oa=Sa(Ta(2),1),Ra=Sa(Ta(2),0),Pa=Sa(Ta(2),.5),Ia=Sa(Ta(3),1),La=Sa(Ta(3),0),Da=Sa(Ta(3),.5),Na=Sa(Ta(4),1),Fa=Sa(Ta(4),0),ka=Sa(Ta(4),.5),Ua={linear:function(e){return e},"in-quad":ca,"out-quad":ua,"in-out-quad":e=>e<.5?ca(2*e)/2:(ua(2*(e-.5))+1)/2,"in-coast-quad":Ea,"out-coast-quad":Aa,"in-out-coast-quad":Ma,"in-cubic":ha,"out-cubic":da,"in-out-cubic":pa,"in-coast-cubic":Oa,"out-coast-cubic":Ra,"in-out-coast-cubic":Pa,"in-quart":fa,"out-quart":ma,"in-out-quart":e=>e<.5?fa(2*e)/2:(ma(2*(e-.5))+1)/2,"in-coast-quart":Ia,"out-coast-quart":La,"in-out-coast-quart":Da,"in-quint":ga,"out-quint":ya,"in-out-quint":e=>e<.5?ga(2*e)/2:(ya(2*(e-.5))+1)/2,"in-coast-quint":Na,"out-coast-quint":Fa,"in-out-coast-quint":ka,"in-sine":_a,"out-sine":va,"in-out-sine":e=>e<.5?_a(2*e)/2:(va(2*(e-.5))+1)/2,"in-expo":ba,"out-expo":wa,"in-out-expo":e=>e<.5?ba(2*e)/2:(wa(2*(e-.5))+1)/2,"in-circ":xa,"out-circ":Ca,"in-out-circ":e=>e<.5?xa(2*e)/2:(Ca(2*(e-.5))+1)/2};function Va(e,t,i=Ha,r=t){let s=!1;r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);for(let t=0;t<ja;t++){let t=0;for(const n of Ba)if(go(i.selection,n.type)){const o=Math.abs(n.error(e,r,i));n.apply(e,r,i)&&(s=!0,t+=o)}if(0===t)break}const n=go(i.selection,uo.COLLISION),o=function(e,t){switch(e){case co.PAN:return Zo.EYE_AND_CENTER;case co.ASCEND:return t.state.isGlobal?Zo.EYE_AND_CENTER_SCALE:Zo.EYE_AND_CENTER;default:return Zo.EYE}}(i.interactionType,e);return n&&Wo(e,r,o)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function za(e,t){const i="number"==typeof e?e:(0,mr.j)(e,t),r=Math.min(1,i/150);return pa(r)}const Ba=[{type:uo.TILT,error:function(e,t,i){return Ko(e,t,i)*t.distance},apply:function e(t,i,r=_o,s=!0){la.eyeCenterDistance=0,la.requiresTwoSteps=!1;const n=Ko(t,i,r,void 0,la);if(0===n)return!1;switch((0,Fr.d)(ra,-n,i.viewRight),r.tiltMode){case ho.LOOK_AROUND:(0,dr.m)(ia,i.viewForward,ra),(0,dr.g)(ia,ia,la.eyeCenterDistance),i.center=(0,dr.a)(sa,i.eye,ia);break;case ho.TUMBLE:(0,dr.b)(ia,i.center,i.eye),(0,dr.m)(ia,ia,ra),i.eye=(0,dr.b)(sa,i.center,ia);break;default:(0,a.Bg)(r.tiltMode)}return i.up=(0,dr.m)(sa,i.up,ra),!la.requiresTwoSteps||!s||e(t,i,r,!1)}},{type:uo.ALTITUDE,error:wo,apply:function(e,t,i=_o){const r=wo(e,t,i);if(0===r)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,o=vo(t,i.interactionDirection,function(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),(0,dr.g)(r,r,i),r}(e,t,Math.sign(r),To),Co),a=(0,dr.c)(So,t.viewForward),l=s.intersectInfiniteManifold((0,mo.re)(t.eye,o),n,Eo);return t.eye=(0,I.pC)(l)?l:s.setAltitude(Eo,n,t.eye),t.center=(0,bo.W8)(Eo,t.eye,a,t.center),!0}},{type:uo.DISTANCE,error:Ao,apply:function(e,t,i=_o){const r=Ao(e,t,i);if(0===r)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=Mo(e,t)+r,o=(0,dr.c)(Ro,t.eye),a=vo(t,i.interactionDirection,function(e,t,i){const r=e.pointsOfInterest.surfaceOrigin;return(0,dr.r)(i,t.eye,r.renderLocation)}(e,t,Lo),Io);if(!(0,fo.h)((0,fo.l)(s.renderLocation,n),(0,mo.re)(t.eye,a),Do))return!1;t.eye=Do;const l=(0,dr.b)(Po,t.eye,o);t.center=(0,dr.a)(Do,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),u=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,Do);return(0,I.pC)(u)&&(t.center=u),!0}}],Ha={selection:uo.ALL,interactionType:co.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ho.TUMBLE},ja=5;var Ga=s(34344);const Wa=(0,me.c)(),Za=(0,me.c)(),qa=(0,me.c)(),$a=(0,me.c)(),Ya=(0,me.c)(),Xa=(0,me.c)(),Ja={upward:(0,me.f)(0,0,1),forward:(0,me.f)(0,1,0),sideway:(0,me.f)(1,0,0)},Ka=(0,Ga.c)();class Qa{constructor(e=Nt.JY.Global){this.viewingMode=e,this.center=(0,me.c)(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=(0,me.a)(Ja.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,t){if(t||(t={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Nt.JY.Global){const i=((0,dr.l)(this.center)+(0,dr.l)(e.center))/2;t.pan=(0,si.EU)(this.center,e.center)*i}else t.pan=(0,dr.i)(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const r=Math.abs(e.pitch-this.pitch);return t.rotate=Math.max(i,r),t.sourceZoom=this.distance,t.targetZoom=e.distance,t}interpolate(e,t,i){this.viewingMode===Nt.JY.Global?(0,si.ZA)(e.center,t.center,i.pan,this.center):(0,dr.h)(this.center,e.center,t.center,i.pan),this.distance=(0,$.t7)(e.distance,t.distance,i.zoom),this.pitch=(0,$.t7)(e.pitch,t.pitch,i.rotate);let r=e.yaw;const s=t.yaw;Math.abs(s-r)>=Math.PI&&(r+=2*(r<s?1:-1)*Math.PI),this.yaw=(0,$.t7)(r,s,i.rotate)}copyFrom(e){(0,dr.c)(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,(0,dr.c)(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const t=this._lookAtOrientation(e.center,Ka);(0,dr.c)(this.center,e.center),(0,dr.b)($a,e.center,e.eye),(0,dr.t)($a,$a,t),(0,dr.t)(Ya,e.up,t),this.distance=(0,dr.l)($a),$a[0]/=this.distance,$a[1]/=this.distance,$a[2]/=this.distance,this.pitch=this._eyeUpToPitch($a),this.yaw=this._eyeUpToYaw($a,Ya),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const t=this._lookAtOrientation(this.center,Ka);(0,as.t)(t,t),this._axisAngleVec3(Ja.sideway,this.pitch-Math.PI/2,Ja.forward,$a),this._axisAngleVec3(Ja.upward,this.yaw,$a),this._axisAngleVec3(Ja.sideway,this.pitch-Math.PI/2,Ja.upward,Ya),this._axisAngleVec3(Ja.upward,this.yaw,Ya),(0,dr.g)($a,$a,this.distance),(0,dr.t)($a,$a,t),(0,dr.t)(Ya,Ya,t),e.center=this.center,e.eye=(0,dr.b)($a,this.center,$a),e.up=Ya}_axisAngleVec3(e,t,i,r=i){const s=Math.cos(t),n=Math.sin(t);return(0,dr.g)(Wa,i,s),(0,dr.f)(Za,e,i),(0,dr.g)(Za,Za,n),(0,dr.g)(qa,e,(1-s)*(0,dr.e)(e,i)),(0,dr.a)(r,(0,dr.a)(r,Wa,Za),qa)}_lookAtOrientation(e,t=(0,Ga.c)()){return this._upAtLookAt(e,qa),(0,dr.f)(Wa,this.lookAtDirection,qa),(0,dr.n)(Wa,Wa),0===Wa[0]&&0===Wa[1]&&0===Wa[2]&&(0,dr.c)(Wa,Ja.sideway),(0,dr.f)(Za,qa,Wa),(0,dr.n)(Za,Za),t[0]=Wa[0],t[1]=Za[0],t[2]=qa[0],t[3]=Wa[1],t[4]=Za[1],t[5]=qa[1],t[6]=Wa[2],t[7]=Za[2],t[8]=qa[2],t}_upAtLookAt(e,t){return this.viewingMode===Nt.JY.Local?(0,dr.c)(t,Ja.upward):(0,dr.n)(t,e)}_eyeUpToPitch(e){return Math.PI-(0,si.EU)(Ja.upward,e)}_eyeUpToYaw(e,t){const i=Xa;return Math.abs(t[2])<.5?((0,dr.c)(i,t),e[2]>0&&(0,dr.g)(i,i,-1)):(0,dr.c)(i,e),(0,dr.f)(Za,i,Ja.upward),(0,dr.n)(Za,Za),(0,si.EU)(Ja.sideway,Za,Ja.upward)}}var el=s(18435);const tl=(0,Ys.HA)(500),il=(0,Ys.HA)(8e3);class rl{constructor(e){this.createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:2},this.source=e(),this.target=e()}clone(){const e=new rl(this.createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,t,i){this.source!==e&&this.source.copyFrom(e),this.target!==t&&this.target.copyFrom(t),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=null!=i.desiredScreenFlow?i.desiredScreenFlow:2,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const t=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/t}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class sl{constructor(){this.segments=[]}get time(){return this.segments.reduce(((e,t)=>(0,Ys._H)(e+t.time)),(0,Ys._H)(0))}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,r=0;const s=this.definition;for(let n=0;n<this.segments.length;n++){const o=this.segments[n],a=o.definition;if(e<=o.time||n===this.segments.length-1){t=this.segmentInterpolateComponentsAt(o,e/o.time,t),s.hasPan?t.pan=(i+a.compared.pan*t.pan)/s.compared.pan:t.pan=1,s.hasRotate?t.rotate=(r+a.compared.rotate*t.rotate)/s.compared.rotate:t.rotate=1;const n=t.zoom*(a.compared.targetZoom-a.compared.sourceZoom)+a.compared.sourceZoom,l=this.segments[0].definition.compared.sourceZoom,c=this.segments[this.segments.length-1].definition.compared.targetZoom;return s.hasZoom?t.zoom=(n-l)/(c-l):t.zoom=1,t}e-=o.time,i+=a.compared.pan,r+=a.compared.rotate}}segmentInterpolateComponentsAt(e,t,i){return e.interpolateComponentsAt(t,i)}}class nl{constructor(e){e&&this.update(e)}get time(){return this._time}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,t=e.compared,i=t.sourceZoom,r=t.targetZoom;this._zoomSign=i>r?1:-1,this._panPixelsAtSource=t.pan*e.source.pixelsPerPanAtZoom(i);const s=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(r))/2;this._rotatePixels=t.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,t=this.definition.compared.targetZoom,{hasZoom:i,hasPan:r,hasRotate:s}=this.definition;let n=0,o=0;i&&(r&&(n=(t/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(o=this._zoomSign*(Math.log(e/t)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const a=this.definition.desiredPixelFlow;if(i&&r&&s){const e=n+o+n*o;this._zoomPixelFlow=n*o/e*a,this._panPixelFlow=o/e*a,this._rotatePixelFlow=n/e*a}else if(i&&r){const e=1+n;this._zoomPixelFlow=n/e*a,this._panPixelFlow=1/e*a}else if(i&&s){const e=1+o;this._zoomPixelFlow=o/e*a,this._rotatePixelFlow=1/e*a}else if(r&&s){const e=this._panPixelsAtSource/this._rotatePixels,t=1+e;this._panPixelFlow=e/t*a,this._rotatePixelFlow=1/t*a}else r?this._panPixelFlow=a:i?this._zoomPixelFlow=a:s&&(this._rotatePixelFlow=a);this._time=s?this.rotateTime:i?this.zoomTime:r?this.panTime:(0,Ys._H)(0)}get rotateTime(){return this.definition.hasRotate?(0,Ys._H)(this._rotatePixels/this._rotatePixelFlow):(0,Ys._H)(0)}get zoomTime(){return this.definition.hasZoom?(0,Ys._H)(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):(0,Ys._H)(0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,t=e*this._panPixelsAtSource;return(0,Ys._H)(Math.log(t*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return(0,Ys._H)(this._panPixelsAtSource/this._panPixelFlow)}return(0,Ys._H)(0)}_interpolateComponentsZoom(e){if(0===e||1===e)return e;if(this.definition.hasZoom){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(t*(t/i)**-e-t)/(i-t)}return e}_interpolateComponentsPan(e){if(0===e||1===e)return e;if(this.definition.hasPan&&this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(t*e*this._time)-1))/(t*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),r=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return t?(t.zoom=i,t.pan=r,t.rotate=s):t={zoom:i,pan:r,rotate:s},t}}function ol(e,t,i){const r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function al(e,t,i){const r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function ll(e,t,i){const r=t-e.compared.sourceZoom,s=1/r,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function cl(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function ul(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function hl(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function dl(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function pl(e,t,i){const r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*a+e.halfWindowSize*r*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function fl(e,t,i){const r=t-e.compared.targetZoom,s=1/r,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function ml(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function gl(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function yl(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}class _l extends sl{constructor(e,t){super(),this._preallocSegments=[new nl,new nl,new nl],this.update(e,t)}update(e,t){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;t&&t.apex&&(i=function(e,t){let i=function(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?null!=t.maximumDistance?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}(e,t);const r={ascensionFactor:null!=t.ascensionFactor?t.ascensionFactor:.5,descensionFactor:null!=t.descensionFactor?t.descensionFactor:.5},s=0===r.ascensionFactor,n=0===r.descensionFactor,o=s?cl:ol,a=s?ul:al,l=s?hl:ll,c=n?ml:dl,u=n?gl:pl,h=n?yl:fl,d=t=>o(e,t,r)+function(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}(e,t,r)+c(e,t,r),p=t=>a(e,t,r)+function(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}(e,t,r)+u(e,t,r),f=t=>l(e,t,r)+function(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}(e,t,r)+h(e,t,r);let m=d(i);const g=function(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-r):s*(t+r)}(e);let y;const _=t.maximumIterations||20,v=null!=t.maximumDistance?t.maximumDistance:1/0;for(y=0;y<_;y++){const t=1e-6,r=(p(i)+t)/f(i);if(isNaN(r)||i>=v&&r<0){if(!isFinite(v))return null;i=v,m=d(i);break}if(i-=r,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const s=d(i);if(Math.abs(s-m)/m<=.005)break;m=s}return m>.7*g||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}(e,t.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,null==i?this._updateWithoutApex():this._updateWithApex(i,t.apex)}segmentInterpolateComponentsAt(e,t,i){return i=e.interpolateComponentsAt(t,i),e===this._ascensionSegment?i.zoom=ua(i.zoom):e===this._descensionSegment&&(i.zoom=ca(i.zoom)),i}_updateWithApex(e,t){const[i,r,s]=this._preallocSegments,n=null!=t.ascensionFactor?t.ascensionFactor:.5,o=Math.min(1-n,null!=t.ascensionFactor?t.descensionFactor:.5),a=1-n-o;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*n,i.definition.compared.rotate=this.definition.compared.rotate*n,i.update(),this._ascensionSegment=i,this.segments.push(i),a>0&&(r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.copyFrom(this.definition),r.definition.compared.sourceZoom=e,r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*a,r.definition.compared.rotate=this.definition.compared.rotate*a,r.update(),this.segments.push(r)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*o,s.definition.compared.rotate=this.definition.compared.rotate*o,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}}const vl={zoom:0,pan:0,rotate:0};class bl{constructor(e){this.createCamera=e,this._time=(0,Ys.HA)(0),this.definition=new rl(e),this.path=new _l}get time(){return this._time}update(e,t,i){this.definition.update(e,t,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings((0,Ys.up)(this.path.time),i),this._easing=i.easing?i.easing:this._time>=1e3?Ma:wa}cameraAt(e,t){t=t||this.createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,vl);return t.interpolate(this.definition.source,this.definition.target,i),t}_normalizedEasing(e){const t=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(i-t)}_applyTimeSettings(e,t){const i=null!=t.speedFactor?t.speedFactor:1;null!=t.duration?e=t.duration:null!=t.speedFactor&&(e=(0,Ys.HA)(e/i));const r=null!=t.minDuration?t.minDuration:tl/i,s=null!=t.maxDuration?t.maxDuration:il/i;return(0,Ys.HA)(Math.min(Math.max(r,e),s))}}const wl=(0,me.c)();class xl{constructor(e){this.currentTime=(0,Ys.HA)(0),this._animation=new bl((()=>new Qa(e))),this._current=new Qa(e)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(e,t,i){const r=this._animation.definition.source,s=this._animation.definition.target,n=(0,dr.b)(wl,t.center,e.center),o=(0,dr.l)(n);o>=1e-5?(n[0]/=o,n[1]/=o,n[2]/=o):(n[0]=0,n[1]=1,n[0]=0),(0,dr.c)(r.lookAtDirection,n),(0,dr.c)(s.lookAtDirection,n),r.copyFromRenderCamera(e),s.copyFromRenderCamera(t),this._current.copyFrom(r),this._animation.update(r,s,i),this.currentTime=(0,Ys.HA)(0),e.almostEquals(t)&&(this.currentTime=this._animation.time)}cameraAt(e,t){return this._animation.cameraAt(e,this._current),t=t||new el.V,this._current.copyToRenderCamera(t),t}step(e,t){return this.finished||(this.currentTime=(0,Ys.HA)(this.currentTime+(0,Ys.up)(e)),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,t)}}var Cl;!function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"}(Cl||(Cl={}));let Tl=class extends O.Z{constructor(){super(...arguments),this.state=Cl.Ready}get active(){return this.state===Cl.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Cl.Stopped,!0)}finishController(){this.state=Cl.Finished}get steppingFinished(){return!1}};(0,t._)([(0,m.Cb)({readOnly:!0})],Tl.prototype,"active",null),(0,t._)([(0,m.Cb)()],Tl.prototype,"state",void 0),Tl=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.CameraController")],Tl);let Sl=class extends Tl{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject((0,f.zE)()),this._asyncResult=null),this.state===Cl.Finished||this.state===Cl.Stopped?this.state===Cl.Finished?e.resolve():e.reject((0,f.zE)()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Cl.Running,(0,I.pC)(this.viewAnimation)&&this.viewAnimation.when((()=>this.updateStateFromViewAnimation()),(()=>this.updateStateFromViewAnimation()))}updateStateFromViewAnimation(){!(0,I.pC)(this.viewAnimation)||this.state!==Cl.Ready&&this.state!==Cl.Running||(this.viewAnimation.state===Zt.State.FINISHED?this.finish():this.viewAnimation.state===Zt.State.STOPPED&&(this.state=Cl.Stopped))}onControllerEnd(){(0,I.pC)(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Cl.Finished?this.viewAnimation.finish():this.state===Cl.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Cl.Finished?this._asyncResult.resolve():this._asyncResult.reject((0,f.zE)()))}finish(){this.finishController()}};Sl=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.AnimationController")],Sl);let El=class extends Sl{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new xl(this.view.state.viewingMode),this.viewAnimation="interaction"===this.mode?null:new Zt}get isInteractive(){return"interaction"===this.mode}begin(e,t){this.hasTarget=!0;const i=this.animationSettings(t);Al.copyFrom(this.view.state.camera);const r=(0,No.Z8)(this.view.state.viewingMode);this.intersectionHelper.intersectRay(Al.ray,r,Ml)&&(Al.center=Ml),this.animation.update(Al,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:"string"==typeof e.easing?Ua[e.easing]:e.easing}}};(0,t._)([(0,m.Cb)({constructOnly:!0})],El.prototype,"view",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],El.prototype,"mode",void 0),El=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.PointToPointAnimationController")],El);const Al=new el.V,Ml=(0,me.c)();var Ol=s(69430),Rl=s(40460);function Pl(e,t,i,r){const s=(0,Rl.iE)(t,i,Il);return(0,fo.h)(e,s,r)}const Il=(0,mo.Ue)();var Ll;!function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"}(Ll||(Ll={}));const Dl=[1,3e8];function Nl(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function Fl(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function kl(e,t,i){const r=(0,Fr.d)(Br.MP.get(),i[3],i);(0,I.Wi)(r)||((0,dr.b)(Ec,e.eye,t),(0,dr.m)(Ec,Ec,r),e.eye=(0,dr.a)(Ec,Ec,t),(0,dr.b)(Ec,e.center,t),(0,dr.m)(Ec,Ec,r),e.center=(0,dr.a)(Ec,Ec,t),e.up=(0,dr.m)(Ec,e.up,r))}function Ul(e,t,i,r){return(0,Ol.BR)(e,(0,Rl.iE)(t,i,Pc),r)}function Vl(e,t,i,r){const s=Br.WM.get();let n=1-i;(0,dr.b)(s,t,e.eye);const o=(0,dr.l)(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||((0,dr.g)(s,s,n),e.eye=(0,dr.a)(Ec,e.eye,s),e.center=(0,dr.h)(Ec,e.center,t,n))}function zl(e,t,i){t.getScreenCenter(Bl),Pl(e,t,Bl,Ec)&&(t.center=Ec);const r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=(0,dr.g)(Br.WM.get(),t.viewForward,s);t.eye=(0,dr.b)(Ec,t.center,n)}const Bl=(0,pe.s1)();function Hl(e,t){(0,dr.s)(t,0,0,0);for(const i of e)(0,dr.a)(t,t,i);(0,dr.g)(t,t,1/e.length)}function jl(e,t,i,r){return Math.sin(e/(0,dr.l)(t))*(i+r.radius)}function Gl(e,t,i,r){return jl(Math.PI/2,t,i,r)+(e-Math.PI/2)}var Wl;!function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(Wl||(Wl={}));const Zl=(0,$.Vl)(6),ql={Pole:.95,Angle:(0,$.Vl)(18),Tilt:45},$l=(0,$.Vl)(80);function Yl(e,t,i,r,s,n){const o=(0,me.c)(),a=(0,fo.c)();let l=!0,c=!0;return e.intersectScreen(i,o,n)?a[3]=(0,dr.l)(o):(c=!1,t.aboveGround&&s!==Ll.Ellipsoid?a[3]=Math.max((0,dr.l)(t.center),.9*r.radius):a[3]=(0,dr.l)(t.eye)-t.relativeElevation,s===Ll.Silhouette?Ql(a,t,i,o):l=Pl(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function Xl(e,t,i,r){return(0,dr.l)(e.eye)-r.radius>3e4?Wl.Horizontal:i?((0,Rl.iE)(e,t,Ic),-Math.sign(e.relativeElevation)*(.5*Math.PI+(0,zr.EU)(e.eye,Ic.direction))<Zl?Wl.Vertical:Wl.Horizontal):Wl.Vertical}function Jl(e,t,i){(0,dr.b)(Kl,i,t),e.eye=(0,dr.b)(Ec,e.eye,Kl),e.center=(0,dr.b)(Ec,e.center,Kl)}const Kl=(0,me.c)();function Ql(e,t,i,r){const s=(0,Rl.iE)(t,i,Pc);return!((0,I.Wi)(s)||((0,fo.j)(e,s,ec),(0,fo.h)(e,s,r)?(0,dr.d)(ec,s.origin)<(0,dr.d)(r,s.origin)&&((0,dr.c)(r,ec),1):((0,dr.b)(tc,t.eye,t.center),(0,dr.n)(tc,tc),(0,Ol.Oy)(tc,-(0,dr.e)((0,dr.n)(tc,tc),ec),ic),(0,Ol.BR)(ic,s,r),1)))}const ec=(0,me.c)(),tc=(0,me.c)(),ic=(0,Ol.Ue)();function rc(e,t,i,r,s,n){let o;if((0,dr.f)(Oc,e,t),(0,dr.b)(Ac,e,t),(0,dr.l)(e)<=s||!r.aboveGround){(0,dr.f)(i,Ac,r.eye);const a=(0,dr.e)(e,t)/((0,dr.l)(e)*(0,dr.l)(t)),l=Math.cos((0,$.uZ)(q.Q4.normalize((0,$.Vl)(n)),0,$l));o=-(0,$.ZF)(a)-Math.max(0,(0,dr.l)(t)-s)/(l*s)}else(0,dr.b)(sc,r.eye,r.center),(0,dr.f)(i,Ac,sc),o=-(0,dr.l)(Ac)/s;return(0,dr.n)(i,i),(0,dr.g)(i,i,(0,dr.l)(Oc)),o}const sc=(0,me.c)();function nc(e,t,i,r){let s,n;const o=Math.cos((0,$.uZ)(q.Q4.normalize((0,$.Vl)(r)),0,$l));return s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):(0,$.ZF)(t/i),n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):(0,$.ZF)(e/i),(n-s)*i}function oc(e,t,i,r,s,n,o,a,l,c){(0,dr.f)(Oc,e,t),(0,we.Tz)(n.up,n.eye,mc,gc,yc),(0,we.Tz)([0,0,1],n.eye,dc,pc,fc),(0,dr.c)(i,pc),(0,dr.c)(r,dc),(0,dr.n)(i,i),(0,dr.g)(i,i,(0,dr.l)(Oc)),(0,we.yS)(e,(0,dr.n)(gc,gc),(0,dr.n)(yc,yc),(0,dr.n)(mc,mc),_c),(0,we.yS)(t,gc,yc,mc,vc),function(e,t,i,r,s,n,o,a,l,c){const u=nc(e[2],t[2],o[3],l),h=c?nc(e[0],t[0],o[3],180):t[0]-e[0],d=Math.sin(a)*h-Math.cos(a)*u,p=Math.cos(a)*h+Math.sin(a)*u;(0,dr.n)(Ec,s);const f=c?d/Math.sqrt(Math.abs(o[3]**2-(0,dr.e)(i,Ec)**2)):d/o[3],m=p/Math.sqrt(Math.abs(o[3]**2-(0,dr.e)(i,r)**2));(0,mr.a)(n,f,m)}(_c,vc,e,dc,pc,s,o,a,l,c)}function ac(e,t,i,r,s,n,o){(0,Fr.d)(xc,s,r),(0,Fr.d)(Cc,o,n),(0,Fr.m)(Tc,xc,Cc),(0,dr.b)(t,e,i),(0,dr.m)(t,t,Tc),(0,dr.a)(t,t,i)}function lc(e,t,i,r,s,n){(0,Fr.d)(xc,r,i),(0,Fr.d)(Cc,n,s),(0,Fr.m)(Tc,xc,Cc),(0,dr.b)(Ec,e.eye,t),(0,dr.m)(Ec,Ec,Tc),e.eye=(0,dr.a)(Ec,Ec,t),(0,dr.b)(Ec,e.center,t),(0,dr.m)(Ec,Ec,Tc),e.center=(0,dr.a)(Ec,Ec,t),(0,dr.b)(Ec,e.up,t),(0,dr.m)(Ec,Ec,Tc),e.up=(0,dr.a)(Ec,Ec,t)}function cc(e,t,i,r,s,n,o=ql.Pole,a=ql.Angle){const l=Math.abs(r)>Math.PI-a||Math.abs(r)<a,c=Math.abs(e[2])<i*o||Math.abs(t)>i;return!!(l&&c&&n.aboveGround&&s<ql.Tilt)}function uc(e,t,i,r,s,n){if(n)Gr(i,r,wc),kl(t,e,wc);else{const n=rc(i,r,Rc,t,e[3],s);kl(t,e,jr(Rc,n))}}function hc(e,t,i,r,s,n,o){const a=o?20:1;let l,c;(0,dr.c)(Sc,r),Mc.copyFrom(t);for(let r=0;r<a&&(0,dr.d)(i,Sc)>1e-12&&(l=(0,dr.d)(i,Sc),oc(i,Sc,pc,dc,bc,Mc,e,s,n,o),lc(Mc,e,dc,bc[1],pc,bc[0]),ac(Sc,Sc,e,dc,bc[1],pc,bc[0]),c=(0,dr.d)(i,Sc),c<l||0===r);r++)t.copyFrom(Mc)}const dc=(0,me.c)(),pc=(0,me.c)(),fc=(0,me.c)(),mc=(0,me.c)(),gc=(0,me.c)(),yc=(0,me.c)(),_c=(0,me.c)(),vc=(0,me.c)(),bc=(0,gr.a)(),wc=Hr(),xc=(0,kr.c)(),Cc=(0,kr.c)(),Tc=(0,kr.c)(),Sc=(0,me.c)(),Ec=(0,me.c)(),Ac=(0,me.c)(),Mc=new el.V,Oc=(0,me.c)(),Rc=(0,me.c)(),Pc={origin:(0,me.c)(),direction:(0,me.c)()},Ic={origin:(0,me.c)(),direction:(0,me.c)()};var Lc=s(5073);let Dc=class extends El{constructor(){super(...arguments),this.zoomLocation=(0,me.c)(),this.tmpCamera=new el.V,this.tmpViewDir=(0,me.c)(),this.tmpRayDir={origin:(0,me.c)(),direction:(0,me.c)()},this.targetOnSphere=(0,me.c)(),this.tmpCenter=(0,me.c)(),this.constraintOptions={selection:uo.ALL_EXCEPT_COLLISION,interactionType:co.ZOOM,interactionFactor:null,interactionStartCamera:new el.V,interactionDirection:null,tiltMode:ho.TUMBLE},this.sphere=(0,fo.c)()}initialize(){this.intersector=(0,No.Z8)(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation,0===this.view.map.ground.opacity?kc:{})&&(s=e>0,n=!0),this.tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:(0,dr.c)(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,n),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:(0,Ys.HA)(600),easing:wa}}_updateCamera(e,t,i,r,s){const n=Xl(e,r,s,(0,fr.Iu)(this.view.spatialReference));let o;this.view.camera.position.hasZ&&(o=Math.abs(this.view.camera.position.z)),(0,dr.n)(Fc,e.eye),(0,dr.g)(Fc,Fc,-1),(0,Rl.iE)(e,r,this.tmpRayDir),(0,dr.n)(this.tmpRayDir.direction,this.tmpRayDir.direction);const a=Math.max(Math.min(12,1/Math.abs((0,dr.e)(Fc,this.tmpRayDir.direction)))*o,200);if(n===Wl.Horizontal){let s=.6**t;this.sphere[3]=(0,dr.l)(i),(0,dr.b)(this.tmpViewDir,e.center,e.eye);const n=Math.min((0,dr.l)(this.tmpViewDir),a);let o=n*s;if(s<=1&&o<4&&(o=4,s=o/n),Math.abs(n-o)<1e-6)return;const l=(0,dr.l)(e.center);if(this.sphere[3]!==l){const t=this.sphere[3]+s*(l-this.sphere[3]);e.center=(0,dr.g)(Nc,e.center,t/l)}(0,dr.g)(this.tmpViewDir,this.tmpViewDir,-s),e.eye=(0,dr.a)(Nc,e.center,this.tmpViewDir),Va(this.view,e,this.constraintOptions),(0,dr.d)(i,e.center)>1e-12&&Pl(this.sphere,e,r,this.targetOnSphere)&&function(e,t,i,r,s,n,o){cc(i,(0,dr.e)(t.up,i),e[3],-q.Q4.normalize((0,$.Vl)(s)),n,t,ql.Pole,ql.Angle)?hc(e,t,i,r,-q.Q4.normalize((0,$.Vl)(s)),n,true):uc(e,t,i,r,n,true)}(this.sphere,e,i,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt)}else{let n=.6**Math.abs(t);const o=t>0?1:-1;(0,dr.b)(this.tmpViewDir,i,e.eye);const l=(0,dr.l)(this.tmpViewDir),c=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,60);let u=c?Math.min(a,c):a;u=s?Math.min(u,l):u,(0,dr.g)(this.tmpRayDir.direction,this.tmpRayDir.direction,u),(0,dr.a)(i,this.tmpRayDir.origin,this.tmpRayDir.direction);let h=u*n;const d=Math.max(4,1.01*e.nearFar[0]);if(t>0&&h<d&&(h=d,n=h/u),Math.abs(u-h)<1e-6)return;(0,dr.g)(this.tmpRayDir.direction,this.tmpRayDir.direction,o*(1-n)),e.eye=(0,dr.a)(Nc,e.eye,this.tmpRayDir.direction),e.center=(0,dr.a)(Nc,e.center,this.tmpRayDir.direction)}Wo(this.view,e)}};Dc=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.global.ZoomStepController")],Dc);const Nc=(0,me.c)(),Fc=(0,me.c)(),kc={exclude:new Set([Lc.cy])};let Uc=class extends El{constructor(){super(...arguments),this.zoomLocation=(0,me.c)(),this.tmpCamera=new el.V,this.tmpRayDir=(0,me.c)(),this.tmpCenter=(0,me.c)(),this.constraintOptions={selection:uo.ALL,interactionType:co.ZOOM,interactionFactor:null,interactionStartCamera:new el.V,interactionDirection:null,tiltMode:ho.TUMBLE}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r),this.tmpCamera.copyFrom(i.camera);const s=(0,No.Z8)(this.view.state.viewingMode);e>0?(0===this.view.map.ground.opacity?this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation,Hc):this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:(0,dr.c)(this.zoomLocation,this.tmpCamera.center);const n=.6**e;let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,60);(0,dr.b)(Bc,this.tmpCamera.eye,this.zoomLocation),(0,dr.n)(Bc,Bc);const a=Math.max(Math.min(14,1/Math.abs((0,dr.e)(zc,Bc)))*Math.abs(this.view.camera.position.z),200);if(o=o?Math.min(o,a):a,o){const e=(0,me.c)();(0,dr.b)(e,this.zoomLocation,this.tmpCamera.eye),o<(0,dr.l)(e)&&((0,dr.n)(e,e),(0,dr.a)(this.zoomLocation,this.tmpCamera.eye,(0,dr.g)(e,e,o)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:(0,Ys.HA)(600),easing:wa}}_updateCamera(e,t,i){(0,dr.b)(this.tmpRayDir,i,e.eye);const r=(0,dr.l)(this.tmpRayDir);let s=r*t;const n=t<=1,o=Math.max(4,1.01*e.nearFar[0]);n&&s<o&&(s=o,t=s/r),Math.abs(r-s)<1e-6||((0,dr.g)(this.tmpRayDir,this.tmpRayDir,t),e.eye=(0,dr.b)(Vc,i,this.tmpRayDir),e.center=(0,dr.h)(Vc,e.center,i,1-t),Va(this.view,e,this.constraintOptions))}};Uc=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.local.ZoomStepController")],Uc);const Vc=(0,me.c)(),zc=(0,me.f)(0,0,1),Bc=(0,me.c)(),Hc={exclude:new Set([Lc.cy])};var jc=s(41649);function Gc(e,t){if("touch"===e.pointerType)return!1;switch(t){case"primary":return 0===e.button;case"secondary":return 2===e.button;case"tertiary":return 1===e.button}}class Wc extends jc.a{constructor(e,t){super(!0),this.view=e,this.registerIncoming("double-click",t,(e=>this._handleDoubleClick(e)))}_handleDoubleClick(e){const t=e.data;if(function(e,t){return"touch"===e.pointerType||0===e.button}(t)){const i=this.view.state.isGlobal?new Dc({view:this.view,mode:"animation"}):new Uc({view:this.view,mode:"animation"});this.view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),(0,pe.s1)(t.x,t.y)),e.stopPropagation()}}}let Zc=class extends Tl{constructor(){super(...arguments),this.startCamera=new el.V,this.currentCamera=new el.V}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Cl.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};var qc;Zc=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.InteractiveController")],Zc),function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"}(qc||(qc={}));let $c=class extends Zc{constructor(e){super(e),this.view=null,this.pivot=qc.CENTER,this.lastPoint=(0,gr.a)(),this.tmpWorldUp=(0,me.c)(),this.tmpViewDir=(0,me.c)(),this.tmpRotCurPoint=(0,gr.a)(),this.tmpTransf=(0,kr.c)(),this.tmpAxis=(0,me.c)(),this.tmpPivotPoint=(0,me.c)(),this.pivotPos=(0,me.c)(),this.constraintOptions={selection:uo.ALL,interactionType:co.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ho.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===qc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case qc.EYE:(0,dr.c)(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=co.LOOK_AROUND,this.constraintOptions.tiltMode=ho.LOOK_AROUND,this.constraintOptions.selection=uo.NONE;break;case qc.CENTER:{const t=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);t||(0,dr.c)(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=co.TUMBLE,this.constraintOptions.tiltMode=ho.TUMBLE,this.constraintOptions.selection=uo.ALL&~uo.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,Nl(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e,t){const i=this.startCamera,r=(0,me.c)();(0,dr.b)(r,this.pivotPos,i.eye);const s=(0,dr.l)(r);let n=Math.min(s,7*Math.abs(this.view.camera.position.z));const o=(0,fr.Iu)(this.view.spatialReference),a=(0,pe.s1)(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=Xl(this.startCamera,a,!0,o);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,225,90),u=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,90);void 0===c&&void 0===u||(c=void 0===c?u:c,u=void 0===u||l===Wl.Horizontal?c:u,n=c>u?u:c,n=t?Math.min(n,s):n),(0,dr.n)(r,r),(0,dr.c)(this.pivotPos,(0,dr.a)(this.tmpPivotPoint,i.eye,(0,dr.g)(this.tmpPivotPoint,r,n)))}update(e){if(this.active){switch(this.pivot){case qc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case qc.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}Va(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this.tmpWorldUp),Nl(e,t,this.tmpRotCurPoint);let s=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,n=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;(0,dr.b)(this.tmpViewDir,i,r);const o=(0,dr.l)(this.tmpViewDir),a=(0,$.ZF)((0,dr.e)(this.tmpViewDir,this.tmpWorldUp)/o);if(this.pivot===qc.EYE){s*=-.5;const e=.5*Math.PI-a,t=.5*Math.PI*.99;s=e-Math.max(-t,Math.min(t,e+s))}return s=(0,$.uZ)(s+a,li.min,li.max)-a,(0,dr.f)(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===qc.CENTER&&(n=-n),(0,Fr.d)(this.tmpTransf,n,this.tmpWorldUp),(0,Fr.e)(this.tmpTransf,this.tmpTransf,s,this.tmpAxis),(0,dr.m)(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=(0,dr.m)(Yc,e.up,this.tmpTransf),(0,dr.a)(Yc,r,this.tmpViewDir),(0,mr.c)(this.lastPoint,this.tmpRotCurPoint),Yc}};(0,t._)([(0,m.Cb)({constructOnly:!0})],$c.prototype,"view",void 0),(0,t._)([(0,m.Cb)()],$c.prototype,"pivot",void 0),$c=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.RotateController")],$c);const Yc=(0,me.c)();class Xc extends jc.a{constructor(e,t,i,r){super(!0),this.view=e,this.pointerAction=t,this.pivot=i,this.registerIncoming("drag",r,(e=>this._handleDrag(e)))}_handleDrag(e){const t=e.data;if(t.pointers.size>1)return;if(!Gc(e.data,this.pointerAction))return;const i=(0,pe.s1)(t.center.x,t.center.y);switch(t.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new $c({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController&&this.cameraController.update(i);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}}let Jc=class extends Zc{constructor(e){super(e),this.view=null,this.pickPoint=(0,me.c)(),this.tmpP0=(0,gr.a)(),this.panAxisAngle=Hr(),this.tmpRayDir=(0,me.c)(),this.tmpRayDirPick=(0,me.c)(),this.targetOnSphere=(0,me.c)(),this.tmpRay={origin:(0,me.c)(),direction:(0,me.c)()},this.dragBeginPoint=(0,pe.s1)(),this.normalizedAnchorPoint=(0,gr.a)(),this.constraintOptions={selection:uo.ALL_EXCEPT_COLLISION,interactionType:co.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ho.TUMBLE},this.sphere=(0,fo.c)(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;(0,mr.c)(this.dragBeginPoint,e),Nl(this.startCamera,e,this.normalizedAnchorPoint);const t=(0,fr.Iu)(this.view.spatialReference),i=Yl(this.intersectionHelper,this.startCamera,e,t,Ll.Ellipsoid,0===this.view.map.ground.opacity?Qc:{});if(this.navMode=Xl(this.startCamera,e,i.hasGeometryIntersection,t),this.navMode===Wl.Horizontal)this.hasPickPoint=!!i.scenePickPoint,this.pickPoint=i.scenePickPoint,this.sphere=i.sphere;else{let t,r;(0,Rl.iE)(this.startCamera,e,this.tmpRay),(0,dr.n)(this.tmpRay.direction,this.tmpRay.direction),i.scenePickPoint&&((0,dr.b)(this.tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),r=(0,dr.l)(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(t=Math.abs(this.view.camera.position.z));let s=(0,$.uZ)(30*t,Dl[0],Dl[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,70);s=n?Math.min(s,n):s,s=i.scenePickPoint?Math.min(s,r):s,this.hasPickPoint=!0,(0,dr.g)(this.tmpRay.direction,this.tmpRay.direction,s),(0,dr.a)(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===Wl.Horizontal){(0,dr.b)(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=(0,dr.l)(this.tmpRayDir);Nl(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this.hasPickPoint&&r<t){const e=1-(1-r/t)*(1-this.sphere[3]/(0,dr.l)(this.currentCamera.center));this.currentCamera.center=(0,dr.g)(Kc,this.currentCamera.center,e)}(0,dr.g)(this.tmpRayDir,this.tmpRayDir,-r/t),this.currentCamera.eye=(0,dr.a)(Kc,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=za(this.dragBeginPoint,e),Va(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(Ql(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),Gr(this.pickPoint,this.targetOnSphere,this.panAxisAngle),kl(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=(0,dr.l)(this.tmpRay.direction);Nl(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;(0,dr.g)(this.tmpRayDir,this.tmpRay.direction,1-r/t),this.currentCamera.eye=(0,dr.a)(Kc,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=(0,dr.a)(Kc,this.currentCamera.center,this.tmpRayDir)}Wo(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Jc.prototype,"view",void 0),Jc=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.global.ZoomController")],Jc);const Kc=(0,me.c)(),Qc={exclude:new Set([Lc.cy])};let eu=class extends Zc{constructor(e){super(e),this.view=null,this.tmpP=(0,me.c)(),this.tmpDir=(0,me.c)(),this.tmpN=(0,me.c)(),this.tmpP0=(0,gr.a)(),this.tmpPoi=(0,me.c)(),this.tmpRayDir=(0,me.c)(),this.dragBeginPoint=(0,pe.s1)(),this.normalizedAnchorPoint=(0,gr.a)(),this.constraintOptions={selection:uo.ALL,interactionType:co.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:(0,me.c)(),tiltMode:ho.TUMBLE},this.plane=(0,Ol.Ue)()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;(0,mr.c)(this.dragBeginPoint,e),Nl(this.startCamera,e,this.normalizedAnchorPoint);const t=this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP,0===this.view.map.ground.opacity?iu:{});(0,dr.b)(this.tmpDir,this.tmpP,this.startCamera.eye);const i=(0,dr.l)(this.tmpDir);let r;(0,dr.n)(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let s=(0,$.uZ)(30*r,Dl[0],Dl[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,70);s=n?Math.min(s,n):s,s=t?Math.min(s,i):s,(0,dr.g)(this.tmpDir,this.tmpDir,s),(0,dr.a)(this.tmpP,this.startCamera.eye,this.tmpDir),(0,dr.b)(this.tmpN,this.startCamera.eye,this.startCamera.center),(0,dr.n)(this.tmpN,this.tmpN),this.tmpN[1]<0&&(0,dr.o)(this.tmpN,this.tmpN),(0,Ol.Yq)(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;(function(e,t,i,r){return(0,Ol.BR)(e,(0,Rl.u4)(t,i,Pc),r)})(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||(0,dr.c)(this.tmpPoi,this.currentCamera.center),Nl(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);(0,mr.c)(this.normalizedAnchorPoint,this.tmpP0),(0,dr.b)(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=(0,dr.l)(this.tmpRayDir);let r=i*(1-t);(0,dr.c)(this.constraintOptions.interactionDirection,this.tmpRayDir),(0,dr.g)(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/i);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||((0,dr.g)(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=(0,dr.a)(tu,this.currentCamera.eye,this.tmpRayDir),(0,dr.h)(tu,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?tu[2]=Math.max(this.startCamera.center[2],tu[2]):tu[2]=Math.min(this.startCamera.center[2],tu[2]),this.currentCamera.center=tu,this.constraintOptions.interactionFactor=za(this.dragBeginPoint,e),Va(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};(0,t._)([(0,m.Cb)({constructOnly:!0})],eu.prototype,"view",void 0),eu=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.local.ZoomController")],eu);const tu=(0,me.c)(),iu={exclude:new Set([Lc.cy])};class ru extends jc.a{constructor(e,t,i){super(!0),this.view=e,this.pointerAction=t,this.registerIncoming("drag",i,(e=>this._handleDrag(e)))}_handleDrag(e){const t=e.data;if(t.pointers.size>1)return;if(!Gc(e.data,this.pointerAction))return;const i=(0,pe.s1)(t.center.x,t.center.y);switch(t.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new Jc({view:this.view}):this.cameraController=new eu({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController&&this.cameraController.update(i);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}}const su=(0,me.c)(),nu=(0,me.c)();function ou(){return{direction:(0,me.c)(),up:(0,me.c)()}}function au(e,t,i,r,s){let n=(0,dr.n)(su,e),o=(0,dr.e)(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs((0,dr.e)(t,r)),o<.99?((0,dr.c)(n,t),a&&(0,dr.g)(n,n,-1)):n=null);let l=0;if(n){(0,dr.g)(nu,r,(0,dr.e)(r,n)),(0,dr.b)(n,n,nu);const e=(0,dr.e)(n,s)/((0,dr.l)(n)*(0,dr.l)(s));(0,dr.f)(nu,n,s),l=((0,dr.e)(nu,r)>0?1:-1)*(0,$.BV)((0,$.ZF)(e))}const c=(0,$.BV)((0,$.ZF)(-(0,dr.e)(r,e)/(0,dr.l)(e)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const lu=(0,me.f)(0,1,0),cu=(0,me.f)(0,0,1),uu=(0,kr.c)(),hu=(0,me.c)(),du=(0,me.c)();function pu(e,t,i,r=ou()){const{direction:s,up:n}=r;return(0,Fr.b)(uu,-(0,$.Vl)(t)),(0,Fr.r)(uu,uu,(0,$.Vl)(i)),(0,dr.m)(s,cu,uu),(0,dr.g)(s,s,-1),(0,dr.m)(n,lu,uu),r}function fu(e,t,i,r,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return(0,_e.KC)(t,hu,n),(0,_e.KC)(t,du,n),hu[0]-=i/2,du[0]+=i/2,hu[1]-=r/2,du[1]+=r/2,(0,_e.SH)(hu,n,hu,o),(0,_e.SH)(du,n,du,o),s?(s.xmin=hu[0],s.ymin=hu[1],s.xmax=du[0],s.ymax=du[1],s.spatialReference=o):s=new Ze.Z(hu[0],hu[1],du[0],du[1],o),s}const mu=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:pu,directionToHeadingTilt:function(e,t,i,r){return au(t,i,r,cu,lu)},eyeForCenterWithHeadingTilt:function(e,t,i,r){const s=pu(0,i,r),n=(0,me.c)();return(0,dr.g)(n,s.direction,-t),(0,dr.a)(n,n,e),{up:s.up,eye:n,heading:i,tilt:r}},lookAtTiltToEyeTilt:function(e){return(0,$.BV)(e)},eyeTiltToLookAtTilt:function(e){return(0,$.Vl)(e)},toExtent:fu},Symbol.toStringTag,{value:"Module"}));var gu=s(39536);const yu=(0,me.f)(0,0,1),_u=(0,dr.n)((0,me.c)(),(0,me.f)(1,1,1)),vu=new q.pE(-180,180),bu=(0,kr.c)(),wu=(0,me.c)(),xu=(0,me.c)();function Cu(e,t,i,r=ou()){(0,dr.f)(wu,e,yu),0===(0,dr.e)(wu,wu)&&(0,dr.f)(wu,e,_u),(0,Fr.d)(bu,-(0,$.Vl)(t),e),(0,Fr.e)(bu,bu,-(0,$.Vl)(i),wu);const{up:s,direction:n}=r;return(0,dr.f)(s,wu,e),(0,dr.n)(s,s),(0,dr.m)(s,s,bu),(0,dr.n)(n,e),(0,dr.o)(n,n),(0,dr.m)(n,n,bu),r}function Tu(e){const t=e[1];e[1]=-e[2],e[2]=t}function Su(e,t){const i=Cu(t,e.heading,e.tilt);return e.up=i.up,e}function Eu(e,t,i,r,s){let n,o,a,l;const c=t.latitude,u=(0,fr.Iu)(e.spatialReference).radius,h=t.longitude,d=function(e,t,i){const r=t/i,s=(0,$.Vl)(e),n=Math.sin(r/2),o=Math.cos(s),a=2*(0,$.Kt)(Math.sqrt(n*n/(o*o)));return(0,$.BV)(a)}(c,i,u)/2;n=h-d,o=h+d;const p=(0,$.Vl)(c),f=(1+Math.sin(p))/(1-Math.sin(p)),m=(f+1)*Math.tan(r/u/2),g=m*m;function y(e){const t=Math.PI/2;return(e=q.c5.normalize(e,-t))>t&&(e=Math.PI-e),e}if(a=1.5*Math.PI-2*Math.atan(.5*(m+Math.sqrt(4*f+g))),l=a+r/u,a=y(a),l=y(l),l<a){const e=l;l=a,a=e}if(a=Math.max((0,$.BV)(a),-90),l=Math.min((0,$.BV)(l),90),o=vu.monotonic(n,o),o-n>180){const e=(o-n-180)/2;n+=e,o-=e}const _=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:qe.Z.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=_):s=new Ze.Z(n,a,o,l,_),e.spatialReference&&e.spatialReference.isWebMercator&&(0,gu.$)(s,!1,s),s}const Au=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:Cu,directionToHeadingTilt:function(e,t,i,r){const s=wu,n=xu;return(0,dr.n)(s,e),(0,dr.f)(xu,s,yu),0===(0,dr.e)(xu,xu)&&(0,dr.f)(xu,s,_u),(0,dr.f)(n,xu,s),au(t,i,r,s,n)},eyeForCenterWithHeadingTilt:function(e,t,i,r){const s={eye:(0,me.c)(),up:null,tilt:r,heading:i},n=wu;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=(0,$.Vl)(i),l=(0,$.Vl)(r),c=Math.sin(a),u=Math.cos(a),h=Math.sin(l),d=Math.cos(l),p=(0,dr.l)(n);let f;if(Math.abs(l)<1e-8)f=o+p;else{const e=p/h,t=(0,$.Kt)(o/e),i=Math.PI-l-t;f=e*Math.sin(i)}const m=d*o,g=o*o*(h*h),y=u*u*g,_=f-m,v=_*_,b=y*(y+v-n[1]*n[1]);if(b<0)return(0,dr.g)(s.eye,n,f/p),s.tilt=0,s;const w=Math.sqrt(b),x=n[1]*_,C=y+v;let T;if(T=u>0?-w+x:w+x,Math.abs(C)<1e-8)return p<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):(0,dr.g)(s.eye,n,f/p),s.tilt=0,Tu(s.eye),Su(s,e);s.eye[1]=T/C;const S=c*c*g,E=h*o,A=u*E*s.eye[1],M=s.eye[1]*s.eye[1],O=1-M,R=Math.sqrt(O),P=y*M+S-2*A*R*_+O*v;return Math.abs(P)<1e-8?((0,dr.g)(s.eye,n,f/p),s.tilt=0,Tu(s.eye),Su(s,e)):(s.eye[0]=(O*(f*n[0]-m*n[0])-E*R*(n[0]*s.eye[1]*u+n[2]*c))/P,s.eye[2]=(O*(f*n[2]-m*n[2])-E*R*(n[2]*s.eye[1]*u-n[0]*c))/P,(0,dr.g)(s.eye,s.eye,f),Tu(s.eye),Su(s,e))},lookAtTiltToEyeTilt:function(e,t,i){const r=(0,dr.l)(t),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),n=(0,$.Kt)(i/(s/Math.sin(e)));return(0,$.BV)(e-n)},eyeTiltToLookAtTilt:function(e,t,i){const r=(0,$.Vl)(e),s=(0,dr.l)(t);return(0,$.Kt)(i/(s/Math.sin(r)))+r},toExtent:Eu},Symbol.toStringTag,{value:"Module"}));var Mu=s(66143),Ou=s(14029);const Ru=p.Z.getLogger("esri.views.3d.support.cameraUtils"),Pu=(0,me.c)(),Iu=(0,me.c)(),Lu={heading:0,tilt:0},Du=new X.Z,Nu=new q.pE(-20037508.342788905,20037508.342788905),Fu=new q.pE(-180,180);var ku;function Uu(e){return e.spatialReference||qe.Z.WGS84}function Vu(e){return"global"===e.viewingMode?Au:mu}function zu(e,t){if((0,I.Wi)(t))return null;const i=e.renderSpatialReference,r=Vu(e).headingTiltToDirectionUp,s=(0,me.c)();if(!(0,_e.KC)(t.position,s,i))return null;const n=r(s,t.heading,t.tilt);(0,dr.g)(n.direction,n.direction,e.state.camera.distance),(0,dr.a)(n.direction,n.direction,s);const o=Uo(e,s,n.direction,n.up);return o.fov=(0,$.Vl)(t.fov),o}!function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"}(ku||(ku={}));const Bu=(0,me.c)();function Hu(e,t,i){const r=e.renderSpatialReference,s=qu(e,t.eye,t.viewForward,t.up,Lu);let n=Uu(e);return(0,_e.SH)(t.eye,r,Bu,n)||(n=qe.Z.WGS84,(0,_e.SH)(t.eye,r,Bu,n)),(0,I.Wi)(i)?new K(new X.Z(Bu,n),s.heading,s.tilt,(0,$.BV)(t.fov)):(i.position.x=Bu[0],i.position.y=Bu[1],i.position.z=Bu[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=(0,$.BV)(t.fov),i)}function ju(e,t,i){const r=e.state.camera,s=r.width/2/r.pixelRatio;return e.renderCoordsHelper.viewingMode===Nt.JY.Global&&null!=i&&(t*=Math.cos((0,$.Vl)(i))),s/(96*39.37/(t/=e.renderCoordsHelper.unitInMeters))/Math.tan(r.fovX/2)}function Gu(e,t,i){const r=e.state.camera,s=t*Math.tan(r.fovX/2);let n=96*39.37/(r.width/2/r.pixelRatio/s);return e.renderCoordsHelper.viewingMode===Nt.JY.Global&&(n/=Math.cos((0,$.Vl)(i))),n*=e.renderCoordsHelper.unitInMeters,n}function Wu(e,t,i,r,s,n){return Zu(e,t,ju(e,i,t.latitude),r,s,n)}function Zu(e,t,i,r,s,n){if(nh(n)){const o=new sh(n.signal);return $u(e,r.heading,r.tilt,t,i,s,o),void o.resolver.promise.then((t=>{const i=eh(e,t,r.fov);if(!(0,I.Wi)(i))return n.resolver.resolve(i);n.resolver.reject()}),(e=>n.resolver.reject(e)))}const o=$u(e,r.heading,r.tilt,t,i,s);return eh(e,o,r.fov,n)}function qu(e,t,i,r,s){return Vu(e).directionToHeadingTilt(t,i,r,s)}function $u(e,t,i,r,s,n,o){const a=r&&r instanceof X.Z?r:null;if(nh(o))return async function(e,t,i){const r=(0,me.c)();if(t)if(t instanceof X.Z){if((0,_e.KC)(t,r,e.renderSpatialReference),null==t.z&&null!=e.basemapTerrain){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",i);return(0,I.pC)(s)&&e.renderCoordsHelper.setAltitude(r,s),r}}else(0,dr.c)(r,t);else(0,dr.c)(r,e.state.camera.center);return r}(e,r,o.signal).then((r=>{Yu(e,t,i,a,r,s,n,o)}),(e=>o.resolver.reject(e))),null;const l=function(e,t){const i=(0,me.c)();if(t&&t instanceof X.Z){if((0,_e.KC)(t,i,e.renderSpatialReference),null==t.z&&null!=e.basemapTerrain){const r=(0,Mu.KO)(e.elevationProvider,t);(0,I.pC)(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else(0,dr.c)(i,t||e.state.camera.center);return i}(e,r);return Yu(e,t,i,a,l,s,n,o)}function Yu(e,t,i,r,s,n,o,a){if((0,I.Wi)(r)){const t=e.renderSpatialReference;if(r=(0,_e.fA)(s,t,Uu(e)),(0,I.Wi)(r))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=function(e,t,i,r,s,n){let o=0;return n===ku.ADJUST&&function(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>8)return!0;const s=e.renderSpatialReference,n=Uu(e),o=(0,_e.fA)(t,s,n),a=(0,_e.fA)(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if((0,I.Wi)(o)||(0,I.Wi)(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*r;return a.distance(o)/l>5}(e,r,s)?(t=0,o=function(e,t,i,r){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-Ju)+s.max*Ju,o=Qu(e,r,t,i);return Math.min(o,n)}(e,s,i,r)):o=Qu(e,r,s,i),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:i=Ku(e,r,s,o)}}(e,t,i,s,n,o),c=(0,Vu(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===ku.ADJUST&&"global"===e.viewingMode&&i>0){const l=()=>{const l=Ku(e,s,n,function(e,t,i,r){const s=e.state.constraints.tilt(t);let n=Qu(e,r,t,i);return n=Math.min(n,.5*Math.PI),s.min*(1-Ju)+n*Ju}(e,n,i,s));return o=i-l<1?ku.LOCKED:ku.ADJUST,Yu(e,t,l,r,s,n,o,a)},u=e.map.ground.navigationConstraint;if(!u||"stay-above"===u.type){if(function(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Du,e.spatialReference)&&(0,I.Pt)((0,Mu.KO)(e.elevationProvider,Du),0)>Du.z-1)}(e,c.eye))return l();if(nh(a))return async function(e,t,i){if(!e.renderCoordsHelper.fromRenderCoords(t,Du,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation(Du.x,Du.y,Du.z,Du.spatialReference,"ground",i);return(0,I.Pt)(r,0)>Du.z-1}(e,c.eye,a.signal).then((e=>e?l():(a.resolver.resolve({eye:c.eye,up:c.up,center:(0,me.a)(s),heading:c.heading,tilt:c.tilt}),null))),null}}const u=!a||nh(a)?{center:(0,me.c)(),eye:(0,me.c)(),up:(0,me.c)(),tilt:0,heading:0}:a;return u.eye=c.eye,u.up=c.up,u.center=(0,me.a)(s),u.heading=c.heading,u.tilt=c.tilt,nh(a)&&a.resolver.resolve(u),u}function Xu(e,t,i,r,s,n=null){const o=null!=t.zmax&&null!=t.zmin;let a,l,c;if(e.state.isGlobal){if(!(0,Ou.D)(t.spatialReference,Nt.JY.Global))return nh(n)&&n.resolver.reject(),null;const e=new X.Z(t.xmin,t.ymin,t.spatialReference),i=new X.Z(t.xmax,t.ymax,t.spatialReference),r=t.spatialReference.isGeographic?Fu:Nu;a=new X.Z({x:r.center(e.x,i.x),y:(i.y+e.y)/2,z:o?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const s=(0,fr.Iu)(t.spatialReference),u=function(e,t,i){const r=t.spatialReference,s=(0,fr.Iu)(r),n=new X.Z(t.x,e.y,r),o=new X.Z(i.x,e.y,r),a=new X.Z(e.x,t.y,r),l=new X.Z(e.x,i.y,r);return{lon:Ln(s.radius,n,o),lat:Ln(s.radius,a,l)}}(a,e,i);l=u.lon,c=u.lat,r.diff(e.x,i.x)>r.range/2&&(l+=s.halfCircumference),l=Math.min(l,s.halfCircumference),c=Math.min(c,s.halfCircumference)}else{const i=(0,I.Pt)(e.renderSpatialReference,t.spatialReference);i.equals(t.spatialReference)||(t=(0,_e.iV)(t,i)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const r=o?(t.zmax+t.zmin)/2:null;a=new X.Z({x:t.xmin+.5*l,y:t.ymin+.5*c,z:r,spatialReference:i})}const u=o?t.zmax-t.zmin:0,h=e.state.camera,d=1/Math.tan(h.fovX/2),p=1/Math.tan(h.fovY/2),f=1/Math.tan(h.fov/2),m=Math.max(.5*l*d,.5*c*p,.5*u*f)/1;if(nh(n)){const t=new sh(n.signal);return $u(e,i,r,a,m,s,t),void t.resolver.promise.then((t=>{const i=eh(e,t,e.camera.fov);if(!(0,I.Wi)(i))return n.resolver.resolve(i);n.resolver.reject()}),(e=>n.resolver.reject(e)))}const g=$u(e,i,r,a,m,s);return eh(e,g,e.camera.fov,n)}const Ju=.7;function Ku(e,t,i,r){return Vu(e).lookAtTiltToEyeTilt(r,t,i)}function Qu(e,t,i,r){return Vu(e).eyeTiltToLookAtTilt(r,t,i)}function eh(e,t,i,r){if((0,I.Wi)(t))return null;const s=e.renderSpatialReference,n=(0,_e.fA)(t.eye,s,Uu(e));return(0,I.Wi)(n)?null:(0,I.pC)(r)?(r.position=n,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new K(n,t.heading,t.tilt,i)}function th(e,t){const i=e.basemapTerrain?.tilingScheme;if(i)return i.levelAtScale(t);Ru.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function ih(e,t){const i=e.basemapTerrain?.tilingScheme;if(i)return i.scaleAtLevel(t);Ru.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function rh(e,t,i){const r=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const o=qe.Z.WGS84;return t instanceof K?(s=t.position.latitude,(0,_e.KC)(t.position,Pu,r),(0,_e.KC)(i,Iu,r),n=(0,dr.i)(Pu,Iu)):((0,_e.SH)(t.center,r,Iu,o),s=Iu[1],n=t.distance),Gu(e,n,s)}class sh{constructor(e){this.signal=e,this.resolver=(0,f.hh)()}}function nh(e){return e&&"resolver"in e}function oh(e){let t=e*e;return e<0&&(t*=-1),t}function ah(e,t,i){const r=i,s=e.state,n=e.device,o="forward-down"===t.tiltDirection?1:-1;return"standard"===n.deviceType?(r.translation[0]=oh(s.axes[0]),r.translation[1]=oh(s.axes[1]),r.translation[2]=oh(s.buttons[7])-oh(s.buttons[6]),r.heading=oh(s.axes[2]),r.tilt=oh(s.axes[3])):"spacemouse"===n.deviceType&&(r.translation[0]=1.2*oh(s.axes[0]),r.translation[1]=1.2*oh(s.axes[1]),r.translation[2]=2*-oh(s.axes[2]),r.heading=1.2*oh(s.axes[5]),r.tilt=1.2*oh(s.axes[3])),r.tilt*=o,(0,dr.g)(r.translation,r.translation,1),r}function lh(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function ch(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}let uh=class extends Zc{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new el.V,this.constraintOptions={selection:uo.ALL,interactionType:co.NONE,interactionStartCamera:new el.V,interactionFactor:0,interactionDirection:null,tiltMode:ho.LOOK_AROUND}}handleEventGamepad(e){const t=ah(e,this.view.navigation.gamepad,this.transformation);("end"===e.action||ch(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,lh(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0,ch(lh(this.keysButtonState,this.transformation))&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z;this.filteredSurfaceElevation+=1*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,_h),this._applyDisabledMovementTypes(_h),this._applyPan(_h.pan),this._applyRotate(_h.rotate),this._applyZoom(_h.zoom),this._applyAscend(_h.ascend),this.constraintOptions.interactionType=co.NONE,this.constraintOptions.selection=uo.COLLISION,Va(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;(0,dr.b)(vh,t.center,t.eye),(0,dr.m)(vh,vh,e.matrix),t.center=(0,dr.a)(vh,vh,t.eye),t.up=(0,dr.m)(vh,t.up,e.matrix),this.constraintOptions.interactionType=co.LOOK_AROUND,this.constraintOptions.selection=uo.ALL_EXCEPT_COLLISION,Va(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){e.enabled&&(t.eye=(0,dr.m)(vh,t.eye,e.matrix),t.center=(0,dr.m)(vh,t.center,e.matrix),this.view.state.isGlobal&&(t.up=(0,dr.m)(vh,t.up,e.matrix)),this.constraintOptions.interactionType=co.PAN,this.constraintOptions.selection=uo.ALL,Va(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=(0,dr.a)(vh,this.currentCamera.eye,(0,dr.g)(Br.WM.get(),t,e)),(0,dr.c)(bh,t),(0,dr.o)(bh,bh),this.constraintOptions.interactionDirection=bh,this.constraintOptions.interactionType=co.ZOOM,this.constraintOptions.selection=uo.ALL_EXCEPT_COLLISION,Va(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Br.WM.get());if(this.constraintOptions.interactionDirection=(0,dr.c)(bh,t),this.view.state.isGlobal){const t=(0,dr.l)(this.currentCamera.eye),i=(t+e)/t;this.currentCamera.eye=(0,dr.g)(vh,this.currentCamera.eye,i),this.currentCamera.center=(0,dr.g)(vh,this.currentCamera.center,i)}else{const i=(0,dr.g)(Br.WM.get(),t,e);this.currentCamera.eye=(0,dr.a)(vh,this.currentCamera.eye,i),this.currentCamera.center=(0,dr.a)(vh,this.currentCamera.center,i)}this._updateCameraCenter(),this.constraintOptions.interactionType=co.ASCEND,this.constraintOptions.selection=uo.COLLISION,Va(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=uo.ALL_EXCEPT_COLLISION,Va(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){!function(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,(0,Fr.i)(e.pan.matrix),e.rotate.enabled=!1,(0,Fr.i)(e.rotate.matrix)}(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,vh)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:s}=t,n=this.transformation,o=this.view.navigation.gamepad,l=(0,dr.s)(Br.WM.get(),s[0],s[1],0);(0,dr.n)(l,l);const c=n.translation[0]*e.pan;if(0!==c){const e=(0,dr.g)(Br.WM.get(),r,c);(0,Fr.j)(i.pan.matrix,i.pan.matrix,e),i.pan.enabled=!0}switch(o.mode){case"pan":{const t=-n.translation[1]*e.pan;if(0!==t){const e=(0,dr.g)(Br.WM.get(),l,t);(0,Fr.j)(i.pan.matrix,i.pan.matrix,e),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:(0,a.Bg)(o.mode)}const u=n.translation[2]*e.ascend;i.ascend=u;const h=-n.heading*e.rotate;0!==h&&((0,Fr.e)(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Br.WM.get())),i.rotate.enabled=!0);const d=n.tilt*e.rotate,p=Yo(this.view.renderCoordsHelper,t.center,t.eye),f=(0,$.uZ)(p+d,li.min,li.max)-p;f&&((0,Fr.e)(i.rotate.matrix,i.rotate.matrix,f,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=(0,dr.f)(Br.WM.get(),s,r);(0,dr.n)(a,a),(0,dr.o)(a,a),function(e,t,i,r,s,n,o,a,l){cc(e.center,(0,dr.e)(e.up,e.center),(0,dr.l)(e.center),-q.Q4.normalize((0,$.Vl)(n)),o,t)?function(e,t,i,r,s,n){const{eye:o}=e;(0,we.Tz)([0,0,1],o,dc,pc,fc);const a=t.translation[0]*i.pan,l="zoom"===s.mode?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-(0,dr.e)(e.center,dc)**2/(0,dr.l)(e.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/c,h=-Math.cos(n)*l+Math.sin(n)*a;switch((0,Fr.e)(r.pan.matrix,r.pan.matrix,u,dc),r.pan.enabled=!0,s.mode){case"pan":(0,Fr.e)(r.pan.matrix,r.pan.matrix,h,pc),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}(t,i,r,a,l,-q.Q4.normalize((0,$.Vl)(s))):function(e,t,i,r,s){const{eye:n,viewRight:o}=e,a=(0,dr.f)(Br.WM.get(),o,n),l=t.translation[0]*i.pan;switch(0!==l&&((0,Fr.e)(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const e=t.translation[1]*i.pan;0!==e&&((0,Fr.e)(r.pan.matrix,r.pan.matrix,e,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}(t,i,r,a,l)}(this.startCamera,t,n,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,o),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(_h.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;i.ascend=c;const u=-n.heading*e.rotate;0!==u&&((0,Fr.e)(i.rotate.matrix,i.rotate.matrix,u,this.tmpCamera.eye),i.rotate.enabled=!0);const h=n.tilt*e.rotate,d=this._clampTiltDeltaGlobalToValidRange(h,t.ray,l);0!==d&&((0,Fr.e)(i.rotate.matrix,i.rotate.matrix,d,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=(0,fr.Iu)(this.view.spatialReference),s=jl(li.min,t.origin,i,r);let n=0,o=0;const a=Br.WM.get();return this.view.renderCoordsHelper.intersectManifold(t,i,a)?(n=jl(Yo(this.view.renderCoordsHelper,a,t.origin),t.origin,i,r),o=jl(li.max,t.origin,i,r)):((0,fo.j)((0,fo.k)(fo.t,i+r.radius),t,a),n=Gl((0,$.ZF)(-(0,dr.e)(t.direction,(0,dr.n)(a,a))),t.origin,i,r),o=Gl(li.max,t.origin,i,r)),(0,$.uZ)(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=function(e,t,i,r,s){return Vu(e).headingTiltToDirectionUp(t,0,r,s)}(this.view,t,0,dh,wh),n=i.intersectManifoldClosestSilhouette((0,mo.re)(t,s),e,Br.WM.get()),o=(0,dr.i)(t,n),a=i.intersectManifoldClosestSilhouette((0,mo.re)(t,(0,dr.r)(Br.WM.get(),t,r.center)),e,Br.WM.get()),l=(0,dr.i)(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,Br.WM.get());if(s){const t=(0,dr.b)(Br.WM.get(),e,n),i=(0,dr.l)(t);(0,dr.g)(t,t,1/i);const r=(0,dr.n)(Br.WM.get(),e),s=(0,$.ZF)((0,dr.e)(r,t));return i*Math.sin(Math.min(ph,s))}{const i=(0,dr.c)(Br.WM.get(),e);return t.setAltitude(i,this.filteredSurfaceElevation),(0,dr.i)(n,i)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:mh}_computeVelocities(e){const t=this.filteredSurfaceElevation,i=t+(0,fr.Iu)(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=Br.WM.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=r.width/2,c=fh*r.width,u=fh*r.width,h=a*Math.tan(.5*r.fovX)/l,d=h/i,p=h/this._computeHeadingRotateRadius(n),f=o-t;return{pan:(s?d:h)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*f-f),zoom:2**(c*e/l)*a-a,rotate:(0,$.uZ)(p*u,gh,yh)*e}}_applyDisabledMovementTypes(e){!(0,I.pC)(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&(0,Fr.i)(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&(0,Fr.i)(e.rotate.matrix))}static activatesFor(e,t){const i=ah(t,e.navigation.gamepad,hh);return!("end"===t.action||ch(i))}};(0,t._)([(0,m.Cb)({constructOnly:!0})],uh.prototype,"view",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],uh.prototype,"gamepadDevice",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],uh.prototype,"disableMovements",void 0),uh=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.GamepadKeyboardController")],uh);const hh={translation:[0,0,0],heading:0,tilt:0,zoom:0},dh=80,ph=(0,$.Vl)(dh),fh=.75,mh=5,gh=(0,$.Vl)(30),yh=(0,$.Vl)(80),_h={zoom:0,ascend:0,pan:{enabled:!1,matrix:(0,kr.c)()},rotate:{enabled:!1,matrix:(0,kr.c)()}},vh=(0,me.c)(),bh=(0,me.c)(),wh=ou();class xh extends jc.a{constructor(e){super(!0),this.view=e,this.watchHandles=new Ae.Z,this.handle=this.registerIncoming("gamepad",(e=>this._handleEventGamepad(e))),this.handle.pause()}onInstall(e){super.onInstall(e),this.watchHandles.add([(0,he.YP)((()=>this.view.navigation.gamepad.enabled),(e=>{e?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))}),he.nn),(0,he.YP)((()=>this.view.navigation.gamepad.device),(e=>{this.cameraControllerGamepad&&e&&this.cameraControllerGamepad.gamepadDevice!==e&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)}))])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const t=this.view.navigation.gamepad.device;if(t&&e.data.device!==t)return;const i=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(i||uh.activatesFor(this.view,e.data)){if(!i){const t=new uh({view:this.view,gamepadDevice:e.data.device});this.view.state.switchCameraController(t)&&(this.cameraControllerGamepad=t)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===e.data.device&&this.cameraControllerGamepad.handleEventGamepad(e.data)}}}var Ch;!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"}(Ch||(Ch={}));class Th extends jc.a{constructor(e,t){super(!0),this.view=e,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Nt.JY.Local},this.keyToNumber={[t.left]:Ch.LEFT,[t.right]:Ch.RIGHT,[t.forward]:Ch.FORWARD,[t.backward]:Ch.BACKWARD,[t.up]:Ch.UP,[t.down]:Ch.DOWN,[t.headingLeft]:Ch.HEADINGLEFT,[t.headingRight]:Ch.HEADINGRIGHT,[t.tiltUp]:Ch.TILTUP,[t.tiltDown]:Ch.TILTDOWN,[t.zoomIn]:Ch.ZOOMIN,[t.zoomOut]:Ch.ZOOMOUT},this.registerIncoming("key-down",null,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",null,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",null,(()=>this._handleBlur()))}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this.keyToNumber[e.data.key];null!=t&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new uh({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(t),e.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this.keyToNumber[e.data.key];null!=t&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(t),e.stopPropagation())}}class Sh extends jc.a{constructor(e,t){super(!0),this.view=e,this.registerIncoming("mouse-wheel",t,(e=>this._handleMouseWheel(e)))}_handleMouseWheel(e){if(!this.view.navigation.mouseWheelZoomEnabled)return;const t=e.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new Dc({view:this.view,mode:"interaction"}):new Uc({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*t.deltaY,(0,pe.s1)(t.x,t.y)),e.preventDefault(),e.stopPropagation()}}class Eh{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return void 0===this._value?0:this._value}update(e){void 0===this._value?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}}let Ah=class extends Sl{constructor(e){super(e),this.view=null,this.beginCamera=new el.V,this.elapsedTimeSec=0,this.constraintOptions={selection:uo.ALL,interactionType:co.PAN,interactionFactor:0,interactionStartCamera:new el.V,interactionDirection:null,tiltMode:ho.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new Zt}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),Va(this.view,t,this.constraintOptions)}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Ah.prototype,"view",void 0),Ah=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.momentum.MomentumController")],Ah);let Mh=class extends Ah{constructor(e){super(e),this.interactionType=co.PAN,this.tmpPan=(0,me.c)()}momentumStep(e,t){const i=this.momentum.value(e);(0,dr.g)(this.tmpPan,this.momentum.direction,i),t.eye=(0,dr.b)(Oh,t.eye,this.tmpPan),t.center=(0,dr.b)(Oh,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Mh.prototype,"momentum",void 0),Mh=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],Mh);const Oh=(0,me.c)(),Rh=(0,me.c)(),Ph=(0,me.c)();let Ih=class extends Ah{constructor(e){super(e),this.interactionType=co.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);(0,dr.c)(Ph,t.eye),(0,dr.n)(Ph,Ph),(0,dr.f)(this.momentum.axis2,Ph,this.momentum.axis1),lc(t,Rh,this.momentum.axis1,i,this.momentum.axis2,r)}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Ih.prototype,"momentum",void 0),Ih=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],Ih);let Lh=class extends Ah{constructor(e){super(e),this.interactionType=co.TUMBLE}set center(e){this._set("center",(0,me.a)(e))}set axis(e){this._set("axis",(0,me.a)(e))}momentumStep(e,t){const i=this.momentum.value(e);kl(t,this.center,jr(this.axis,i))}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Lh.prototype,"momentum",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Lh.prototype,"center",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],Lh.prototype,"axis",null),Lh=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.momentum.MomentumController")],Lh);let Dh=class extends Ah{constructor(e){super(e),this.interactionType=co.ZOOM,this.constraintOptions.interactionDirection=(0,me.c)()}set zoomCenter(e){this._set("zoomCenter",(0,me.a)(e))}momentumStep(e,t){(0,dr.c)(this.constraintOptions.interactionDirection,t.eye);const i=this.momentum.valueDelta(0,e);Vl(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=(0,dr.r)(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Dh.prototype,"momentum",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Dh.prototype,"zoomCenter",null),Dh=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],Dh);let Nh=class extends Ah{constructor(e){super(e),this.interactionType=co.ZOOM,this.radius=0,this.tmpSceneCenter=(0,me.c)(),this.tmpZoomAxisAngle=Hr(),this.sphere=(0,fo.c)()}set screenCenter(e){this._set("screenCenter",(0,pe.s1)(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",(0,me.a)(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);zl(this.sphere,t,i),this.constraintOptions.interactionType=co.ZOOM,Va(this.view,t,this.constraintOptions),Ql(this.sphere,t,this.screenCenter,this.tmpSceneCenter),Gr(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),kl(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=co.PAN}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Nh.prototype,"momentum",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Nh.prototype,"screenCenter",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],Nh.prototype,"sceneCenter",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],Nh.prototype,"radius",void 0),Nh=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Nh);class Fh{constructor(e){this.gain=e}update(e){if(this.hasLastValue){const t=this.computeDelta(e);this._updateDelta(t)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return void 0!==this.lastValue}get hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(e){return e-this.lastValue}_updateDelta(e){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*e:this.filteredDelta=e}}class kh{constructor(e,t,i){this._initialVelocity=e,this._stopVelocity=t,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,t){const i=this.value(e);return this.value(e+t)-i}valueFromInitialVelocity(e,t){t=Math.min(t,this.duration);const i=1-this.friction;return e*(i**t-1)/Math.log(i)}}class Uh extends kh{constructor(e,t,i,r,s){super(e,t,i),this.sceneVelocity=r,this.direction=s}value(e){return super.valueFromInitialVelocity(this.sceneVelocity,e)}}class Vh{constructor(e=300,t=12,i=.84){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=i,this.enabled=!0,this.time=new Fh(.6),this.screen=[new Fh(.4),new Fh(.4)],this.scene=[new Fh(.6),new Fh(.6),new Fh(.6)],this.tmpDirection=(0,me.c)()}add(e,t,i){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(i)<.015)return;this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.scene[0].update(t[0]),this.scene[1].update(t[1]),this.scene[2].update(t[2]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,i=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(e,t,i){(0,dr.s)(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const r=(0,dr.l)(this.tmpDirection);r>0&&(0,dr.g)(this.tmpDirection,this.tmpDirection,1/r);const s=r/this.time.filteredDelta;return new Uh(e,t,i,s,this.tmpDirection)}}class zh{constructor(e){this.gain=e}update(e){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}const Bh=1e-5;class Hh extends kh{constructor(e,t,i,r,s,n=0,o){super(e,t,i),this.angularVelocity1=r,this.axis1=s,this.angularVelocity2=n,this.axis2=o}value1(e){return super.valueFromInitialVelocity(this.angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}}class jh{constructor(e=300,t=12,i=.84){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=i,this.enabled=!0,this.tmpAxis1=(0,me.c)(),this.tmpAxis2=(0,me.c)(),this.tmpAngles=(0,gr.a)(),this.time=new Fh(.3),this.screen=[new Fh(.4),new Fh(.4)],this.angle1=new zh(.6),this.angle2=new zh(.6),this.axis1=(0,me.c)(),this.axis2=(0,me.c)(),this.lastScene=(0,me.c)()}addMomentumDirectRotation(e,t,i,r,s,n){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;let e=rc(this.lastScene,t,this.tmpAxis2,r,s,n);this.angle2.update(0),(0,dr.p)(this.tmpAxis2)<Bh?e=0:(0,dr.n)(this.axis1,this.tmpAxis2),this.angle1.update(e),(0,dr.c)(this.lastScene,t)}this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.time.update(i)}}addMomentumPreserveHeading(e,t,i,r,s,n,o){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;oc(this.lastScene,t,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,r,s,n,o,!1),(0,dr.p)(this.tmpAxis2)<Bh?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),(0,dr.n)(this.axis1,this.tmpAxis1),(0,dr.n)(this.axis2,this.tmpAxis2)),(0,dr.c)(this.lastScene,t)}this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,i=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(e,t,i){const r=this.angle1.filteredValue/this.time.filteredDelta,s=this.angle2.filteredValue/this.time.filteredDelta;return new Hh(e,t,i,r,this.axis1,s,this.axis2)}}class Gh{constructor(e=2.5,t=.01,i=.95,r=12){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=i,this.maxVelocity=r,this.enabled=!0,this.value=new Fh(.8),this.time=new Fh(.3)}add(e,t){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta){const t=this.value.computeDelta(e);this.value.filteredDelta*t<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=(0,$.uZ)(e,-this.maxVelocity,this.maxVelocity),Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)}createMomentum(e,t,i){return new kh(e,t,i)}}class Wh extends Gh{constructor(e=3,t=.01,i=.95,r=12){super(e,t,i,r)}add(e,t){if(this.value.hasLastValue){const t=this.value.lastValue;let i=e-t;for(;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;e=t+i}super.add(e,t)}}class Zh extends kh{constructor(e,t,i){super(e,t,i)}value(e){const t=super.value(e);return Math.exp(t)}valueDelta(e,t){const i=super.value(e),r=super.value(e+t)-i;return Math.exp(r)}}class qh extends Gh{constructor(e=2.5,t=.01,i=.95,r=12){super(e,t,i,r)}add(e,t){super.add(Math.log(e),t)}createMomentum(e,t,i){return new Zh(e,t,i)}}let $h=class extends Zc{constructor(e){super(e),this.view=null,this.smoothRotation=new Eh(.05),this.rotationAxis=(0,me.c)(),this.panningPlane=(0,Ol.Ue)(),this.smoothScaling=new Eh(.05),this.zoomCenterScreen=(0,pe.s1)(),this.zoomMomentumEstimator=new qh,this.rotationMomentumEstimator=new Wh,this.panSphericalMomentumEstimator=new jh,this.panPlanarMomentumEstimator=new Vh,this.adjustedSphere=(0,fo.c)(),this.tmp3d=(0,me.c)(),this.tmpScreenPointArray=(0,pe.s1)(),this.beginScreenPoint=(0,pe.s1)(),this.beginScenePoint=(0,me.c)(),this.screenPickPoint=(0,pe.s1)(),this.navMode=Wl.Horizontal,this.tmpInteractionDirection=(0,me.c)(),this.constraintOptions={selection:uo.ALL,interactionType:co.NONE,interactionFactor:0,interactionStartCamera:new el.V,interactionDirection:null,tiltMode:ho.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-q.Q4.normalize((0,$.Vl)(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),(0,pe.md)(e.center,this.screenPickPoint),(0,mr.c)(this.beginScreenPoint,this.screenPickPoint);const i=(0,fr.Iu)(this.view.spatialReference),r=Yl(this.intersectionHelper,this.startCamera,this.screenPickPoint,i,Ll.Silhouette);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,(0,dr.c)(this.beginScenePoint,this.scenePickPoint),this.navMode=Xl(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,i),this.navMode===Wl.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=(0,dr.o)(this.tmp3d,this.startCamera.viewForward);(0,Ol.Yq)(this.scenePickPoint,t,this.panningPlane);const i=(0,pe.s1)(this.screenPickPoint[0],0),r=(0,me.c)(),s=(0,dr.l)(this.startCamera.eye);this.adjustedSphere[3]=s<this.sphere[3]?s-100:this.sphere[3],Ql(this.adjustedSphere,this.startCamera,i,r);const n=(0,pe.J$)();this.startCamera.projectToRenderScreen(r,n);const o=.9*n[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],o);const a=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);a&&(0,Ol.Yq)(this.scenePickPoint,(0,Ol.mJ)(this.panningPlane),this.panningPlane);const l=(0,me.c)(),c=(0,me.c)(),u=(0,me.c)();(0,dr.b)(l,this.scenePickPoint,this.currentCamera.eye);const h=(0,dr.l)(l);(0,dr.n)(l,l);const d=5*Math.max(Math.abs(this.view.camera.position.z),50),p=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,80);let f=p?Math.min(p,d):d;f=a?Math.min(f,h):f,(0,dr.c)(u,(0,dr.a)(c,this.currentCamera.eye,(0,dr.g)(c,l,f))),this.panningPlane[3]=-(0,dr.e)(this.panningPlane,u),this.startCamera.center=(0,dr.a)(c,this.startCamera.eye,(0,dr.g)(c,this.startCamera.viewForward,f));const m=(0,pe.md)(e.center,this.tmpScreenPointArray);Ul(this.panningPlane,this.startCamera,m,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===Wl.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===Wl.Horizontal?new Nh({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new Dh({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Lh({view:this.view,momentum:i,center:this.sphere,axis:this.rotationAxis});if(this.navMode===Wl.Horizontal){const e=this.panSphericalMomentumEstimator.evaluateMomentum();if(e)return new Ih({view:this.view,momentum:e})}else{const e=this.panPlanarMomentumEstimator.evaluateMomentum();if(e)return new Mh({view:this.view,momentum:e})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),zl(this.sphere,this.currentCamera,this.smoothScaling.value),(0,pe.md)(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=co.ZOOM,this.constraintOptions.interactionFactor=za(e.radius-this.beginRadius),Va(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=(0,pe.md)(e.center,this.tmpScreenPointArray);Ql(this.sphere,this.currentCamera,t,this.tmp3d),cc(this.beginScenePoint,(0,dr.e)(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(hc(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(uc(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=co.PAN,this.constraintOptions.interactionFactor=za(this.screenPickPoint,t),Va(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){(0,dr.n)(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||(0,dr.o)(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,i=t+Fl(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=r,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),kl(this.currentCamera,this.sphere,jr(this.rotationAxis,s)),this.constraintOptions.interactionType=co.TUMBLE,this.constraintOptions.interactionFactor=za(e.radius*i),Va(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=(0,pe.md)(e.center,this.tmpScreenPointArray);Ul(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(Jl(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=co.PAN,this.constraintOptions.interactionFactor=za(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),Va(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),Vl(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=co.ZOOM,this.constraintOptions.interactionFactor=za(e.radius-this.beginRadius),Va(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){(0,dr.c)(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||(0,dr.o)(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let i=e.angle-t;i=Fl(i);const r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),kl(this.currentCamera,this.sphere,jr(this.rotationAxis,n)),this.constraintOptions.interactionType=co.TUMBLE,this.constraintOptions.interactionFactor=za(e.radius*n),Va(this.view,this.currentCamera,this.constraintOptions)}};(0,t._)([(0,m.Cb)({constructOnly:!0})],$h.prototype,"view",void 0),$h=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.global.PinchAndPanController")],$h);const Yh=(0,me.f)(0,0,1),Xh=16/180*Math.PI;let Jh=class extends Zc{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new Eh(.05),this.scalingValueSmooth=new Eh(.05),this.planeHorizontal=(0,Ol.Ue)(),this.planeVertical=(0,Ol.Ue)(),this.rotationMomentumEstimator=new Wh,this.panMomentumEstimator=new Vh(300,12,.9),this.zoomMomentumEstimator=new qh,this.beginCenter=(0,me.c)(),this.tmpPoints=[],this.beginCenterScreen=(0,pe.s1)(),this.tmpCentroid3d=(0,me.c)(),this.tmpCentroid2d=(0,pe.s1)(),this.tmp2d=(0,pe.s1)(),this.constraintOptions={selection:uo.ALL,interactionType:co.NONE,interactionFactor:0,interactionStartCamera:new el.V,interactionDirection:null,tiltMode:ho.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),(0,pe.md)(e.center,this.beginCenterScreen),(0,Ol.Oy)(Yh,0,this.planeHorizontal);const i=(0,me.c)(),r=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,i),s=(0,me.c)();(0,dr.o)(s,this.startCamera.viewForward);const n=(0,me.c)();(0,dr.c)(n,Yh);const o=(0,dr.e)(s,n),a=(0,$.Kt)(o<0?-o:o);if(this.panMode=a>=Xh?Wl.Horizontal:Wl.Vertical,(0,Ol.T5)(this.planeHorizontal,this.planeHorizontal,i),this.startCamera.aboveGround||(0,Ol.tk)(this.planeHorizontal,this.planeHorizontal),this.panMode===Wl.Vertical){(0,dr.g)(n,n,o),(0,dr.b)(this.planeVertical,s,n),(0,dr.n)(this.planeVertical,this.planeVertical),(0,Ol.T5)(this.planeVertical,this.planeVertical,i);const t=(0,me.c)(),a=(0,me.c)(),l=(0,me.c)();(0,dr.b)(t,i,this.currentCamera.eye);const c=(0,dr.l)(t);(0,dr.n)(t,t);const u=5*Math.max(Math.abs(this.view.camera.position.z),50),h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,80);let d=h?Math.min(h,u):u;d=r?Math.min(d,c):d,(0,dr.c)(l,(0,dr.a)(a,this.currentCamera.eye,(0,dr.g)(a,t,d))),this.planeVertical[3]=-(0,dr.e)(this.planeVertical,l),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),Hl(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),Hl(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this.panMode===Wl.Horizontal?this.planeHorizontal:this.planeVertical,r=this.beginCenter;if(t){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=i,this.scalingValueSmooth.update(t),Vl(this.currentCamera,r,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=co.ZOOM,this.constraintOptions.interactionFactor=za(Math.abs(e.radius-this.beginRadius)),Va(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,i,this.currentCamera,this.tmpPoints),Hl(this.tmpPoints,this.tmpCentroid3d),(0,pe.md)(e.center,this.tmpCentroid2d),Jl(this.currentCamera,r,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=co.PAN,this.constraintOptions.interactionFactor=za(this.beginCenterScreen,this.tmpCentroid2d),Va(this.view,this.currentCamera,this.constraintOptions),t){const t=this.planeHorizontal,i=r,s=this.rotationValueSmooth.value,n=s+Fl(e.angle-s),o=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=o,this.rotationValueSmooth.update(n);const a=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(a,.001*e.timestamp),kl(this.currentCamera,i,jr(t,a)),this.constraintOptions.interactionType=co.TUMBLE,this.constraintOptions.interactionFactor=za(Math.abs(e.radius*a)),Va(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new Dh({view:this.view,momentum:t,zoomCenter:this.beginCenter});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Lh({view:this.view,momentum:i,center:this.beginCenter,axis:(0,Ol.mJ)(this.planeHorizontal)});const r=this.panMomentumEstimator.evaluateMomentum();return r?new Mh({view:this.view,momentum:r}):null}computePlanePoints(e,t,i,r){r.length=e.size;const s=this.tmp2d;let n=0;return e.forEach((e=>{s[0]=e.x,s[1]=e.y,void 0===r[n]&&(r[n]=(0,me.c)()),Ul(t,i,s,r[n]),n+=1})),r}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Jh.prototype,"view",void 0),Jh=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.local.PinchAndPanController")],Jh);class Kh extends jc.a{constructor(e,t,i){super(!0),this.view=e,this.pointerAction=t,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",i,(e=>this._handleDrag(e)))}_handleDrag(e){if("mouse"===e.data.pointerType&&!Gc(e.data,this.pointerAction))return;const t=e.timestamp-this.lastEndTimestamp,i=this.momentum&&this.momentum.active&&t<40;switch(e.data.action){case"start":case"update":if(i)break;this.controller&&this.controller.active?e.data.timestamp-this.lastTimestamp>2&&(this.controller.update(e.data),this.lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,t){if(this.controller&&this.controller.active){this.lastEndTimestamp=e.timestamp;const i=this.controller.end(e.data);t&&i&&(this.momentum=i,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(e){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(e.data),this.lastTimestamp=e.timestamp}_createController(){return this.view.state.isGlobal?new $h({view:this.view}):new Jh({view:this.view})}}class Qh extends jc.a{constructor(e,t){super(!0),this.view=e,this.registerIncoming("pointer-down",t,(()=>this.view.state.stopActiveCameraController()))}}class ed extends jc.a{constructor(e,t){super(!0),this.key=e,this.registerIncoming("key-down",t,(e=>this._handleKeyDown(e)))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}}class td extends ed{constructor(e,t,i){super(t,i),this.view=e}activate(){this.view.goTo({heading:0}).catch((()=>{}))}}class id extends ed{constructor(e,t,i){super(t,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch((()=>{}))}}class rd extends jc.a{constructor(e,t=!1){super(!0),this.view=e,this.invert=t,this.registerIncoming("vertical-two-finger-drag",(e=>this._handleTwoFinger(e)))}_handleTwoFinger(e){const t=this.invert?-1:1,i=(0,pe.s1)(0,e.data.delta*t);switch(e.data.action){case"begin":this.cameraController?.end(),this.cameraController=new $c({view:this.view,pivot:qc.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController?.update(i);break;case"end":this.cameraController?.end(),this.cameraController=null}}}var sd=s(79622);function nd(e){const t=e.native;return t?{buttons:t.buttons.map((e=>e.pressed?e.value?e.value:1:0)),axes:t.axes.map((t=>function(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}(t,e.axisThreshold)))}:{buttons:[],axes:[]}}class od{constructor(e,t){this.element=e,this.input=t,this._hasEventListeners=!1,this._onConnectGamepad=e=>{this._connectGamepad(e.gamepad)},this._onDisconnectGamepad=e=>{const t=e.gamepad,i=t.index,r=this.inputDevices[i];r&&(this._emitGamepadEvent(t,nd(r),!1),this.inputDevices.splice(i,1),this.latestUpdate.splice(i,1),this.input.gamepad.devices.remove(r),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const i="getGamepads"in window.navigator,r=window.isSecureContext;this.supported=i&&r,this.supported&&(this._forEachGamepad((e=>this._connectGamepad(e))),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this.callback=e}_connectGamepad(e){const t=new St(e);"unknown"!==t.deviceType&&(this.inputDevices[e.index]=t,this.input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this.frameTask&&(this.frameTask=(0,de.A)({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),t=this.element.contains(document.activeElement),i="document"===this.input.gamepad.enabledFocusMode&&!e||"view"===this.input.gamepad.enabledFocusMode&&!t;this._forEachGamepad((e=>{const t=this.inputDevices[e.index];if(!t)return;const r=this.latestUpdate[e.index],s=nd(t),n=i||function(e){for(let t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(let t=0;t<e.buttons.length;t++)if(0!==e.buttons[t])return!1;return!0}(s);if(r){if(r.timestamp===e.timestamp)return;if(!r.active&&n)return;if(function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}(r.state,s))return}this._emitGamepadEvent(e,s,!n)}))}_forEachGamepad(e){const t=window.navigator.getGamepads();for(let i=0;i<t.length;i++){const r=t[i];this._validate(r)&&e(r)}}_emitGamepadEvent(e,t,i){const r=this.latestUpdate[e.index],s=r&&r.active;if(!s&&!i)return;const n=!s&&i?"start":s&&i?"update":"end";this.latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:i},this.callback&&this.callback({device:this.inputDevices[e.index],state:t,action:n})}_validate(e){if(!e)return!1;if(!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}}const ad=(0,b.Z)("trident"),ld=(0,b.Z)("edge"),cd=(0,b.Z)("chrome"),ud=(0,b.Z)("ff"),hd=(0,b.Z)("safari"),dd="esri-view-surface--touch-none",pd="esri-view-surface--touch-pan";class fd{constructor(e,t){this.input=t,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new od(e,this.input),this._gamepadSource.onEvent=e=>this._callback("gamepad",e)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((e=>{this._releasePointerCaptureSafe(e)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const e=this._active[t];this._element.removeEventListener(md[t],e),delete this._active[t]}e&&e.forEach((e=>{if(!this._active[e]&&md[e]){const t=(this._eventHandlers[e]||this._handleDefault).bind(this,e);this._element.addEventListener(md[e],t),this._active[e]=t}})),this._gamepadSource.hasEventListeners=e&&e.has("gamepad")}setPointerCapture(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?dd:pd),this._element.classList.add(this._browserTouchPanningEnabled?pd:dd)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(dd),this._element.classList.remove(pd),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(e){}}_updateNormalizedPointerLikeEvent(e,t){const i=(0,dt.Eu)(this._element,e);return fd.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),t.x=i.x,t.y=i.y,t}_handleKey(e,t){const i=(0,sd.kK)(t);i&&"key-up"===e&&this._keyDownState.delete(i);const r={native:t,key:i,repeat:i&&this._keyDownState.has(i)};i&&"key-down"===e&&this._keyDownState.add(r.key),this._callback(e,r)}_handlePointer(e,t){const i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,t){const i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,t){let i=t.deltaY;switch(t.deltaMode){case 0:(ad||ld)&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}ad||ld?i*=.7:cd||hd?i*=.6:ud&&(i*=1.375);const r=Math.abs(i);if(r>100){const e=.02;i=i/r*200/(1+Math.exp(-e*(r-100)))}const s=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:i});this._callback(e,s)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const i={native:t};t.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){"Alt"===e.key&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}}fd.test={disableSubpixelCoordinates:!1};const md={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class gd extends jc.a{constructor(){super(!0),this.registerIncoming("context-menu",(e=>{e.data.native.preventDefault()}))}}function yd(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}class _d extends jc.a{constructor(e){super(!1),this.navigationTouch=e,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,t,i,r){return{action:e,pointerType:this.pointerType,button:this.mouseButton,buttons:t.buttons,timestamp:r,pointers:wd(this.activePointerMap),pointer:t,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const t=e.native.pointerId,i=bd(this.activePointerMap).angle,r={event:e,initialAngle:0,lastAngle:0};this.activePointerMap.set(t,r);const s=xd(r,vd(this.activePointerMap));r.initialAngle=s,r.lastAngle=s,this._updatePointerAngles(i)}_updatePointer(e){if(e&&null==e.x&&null==e.y)return;const t=e.native.pointerId,i=this.activePointerMap.get(t);i?i.event=e:this._addPointer(e)}_removePointer(e){const t=bd(this.activePointerMap).angle;this.activePointerMap.delete(e),this._updatePointerAngles(t)}_updatePointerAngles(e){const t=bd(this.activePointerMap);this.activePointerMap.forEach((i=>{i.initialAngle=xd(i,t)-e,i.lastAngle=xd(i,t)-e}))}_emitEvent(e,t,i){const r=bd(this.activePointerMap);this.drag.emit(this._createPayload(e,t,r,i),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,i=(0,Ys.HA)(e.timestamp);this.activePointerMap.get(t)&&(1===this.activePointerMap.size?(this._updatePointer(e.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",e.data,(0,Ys.HA)(e.timestamp))))}_handlePointerDrag(e){const t=e.data,i=t.currentEvent,r=(0,Ys.HA)(e.timestamp);switch(t.action){case"start":case"update":this.isDragging?this.activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this.isCurrentDragSuppressed&&this._emitEvent("update",i,r)):(this._addPointer(i),this._emitEvent("added",i,r),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(i),this.pointerType=e.data.startEvent.pointerType,this.mouseButton=e.data.startEvent.button,this.startStateModifiers=e.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",i,r))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}function vd(e){const t=[];return e.forEach((e=>{t.push((0,pe.vW)(e.event.x,e.event.y))})),function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:(0,pe.vW)()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){const[i,r]=e,[s,n]=[r.x-i.x,r.y-i.y];return t.radius=Math.sqrt(s*s+n*n)/2,t.center.x=(i.x+r.x)/2,t.center.y=(i.y+r.y)/2,t}let i=0,r=0;for(let t=0;t<e.length;t++)i+=e[t].x,r+=e[t].y;i/=e.length,r/=e.length;const s=e.map((e=>e.x-i)),n=e.map((e=>e.y-r));let o=0,a=0,l=0,c=0,u=0,h=0,d=0;for(let e=0;e<s.length;e++){const t=s[e],i=n[e],r=t*t,p=i*i;o+=r,a+=p,l+=t*i,c+=r*t,u+=p*i,h+=t*p,d+=i*r}const p=.5*(c+h),f=.5*(u+d),m=o*a-l*l,g=(p*a-f*l)/m,y=(o*f-l*p)/m,_=(0,pe.vW)(g+i,y+r);return{radius:Math.sqrt(g*g+y*y+(o+a)/e.length),center:_}}(t)}function bd(e){const t=vd(e);let i=0;return e.forEach((e=>{let r=xd(e,t),s=r-e.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;r=e.lastAngle+s,e.lastAngle=r;const n=r-e.initialAngle;i+=n})),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function wd(e){const t=new Map;return e.forEach(((e,i)=>t.set(i,e.event))),t}function xd(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var Cd;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(Cd||(Cd={}));var Td=s(18234);class Sd extends jc.a{constructor(e=250,t=10,i=350,r=35,s=Td.m){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=r,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach((e=>e.doubleClickTimeout=(0,I.hw)(e.doubleClickTimeout)))}get hasPendingInputs(){return(0,Je.oE)(this._pointerState,(e=>null!=e.doubleClickTimeout))}_pointerId(e){const t=e.native;return"mouse"===t.pointerType?`${t.pointerId}:${t.button}`:`${t.pointerType}`}_handleImmediateClick(e){const t=e.data,i=this._pointerId(t),r=this._pointerState.get(i);if(r){const s="touch"===t.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;yd(r.event.data,t)>s?(this._clearDoubleClickTimeout(i,!0),this._startClick(e)):(this._clearDoubleClickTimeout(i,!1),this._doubleClick.emit(r.event.data,void 0,r.event.modifiers))}else this._startClick(e)}_startClick(e){const t=this._pointerId(e.data),i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(t,{event:e,doubleClickTimeout:this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(t)),i)}),this.refreshHasPendingInputs()}_handlePointerDrag(e){const t=this._pointerId(e.data.currentEvent);this._clearDoubleClickTimeout(t,!0)}_handleDrag(e){const t=this._pointerId(e.data.pointer);this._clearDoubleClickTimeout(t,!0)}_clearDoubleClickTimeout(e,t){const i=this._pointerState.get(e);i&&(i.doubleClickTimeout.remove(),i.doubleClickTimeout=null,t&&this._doubleClickTimeoutExceeded(e),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}}class Ed extends jc.a{constructor(e=250,t=10,i=350,r=35,s=Td.m){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=r,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")}))}onUninstall(){this._pointerState.forEach((e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=this._pointerId(t);if(!this._pointerState.has(i)){const e={downButton:t.native.button,immediateDoubleClick:null};this._pointerState.set(i,e),this.startCapturingPointer(t.native)}}_handlePointerLoss(e,t){const i=e.data,r=this._pointerId(i),s=this._pointerState.get(r);if(s&&"pointer-up"===t&&s.downButton===i.native.button){const t=s.immediateDoubleClick;if(t){t.timeoutHandle.remove();const r="touch"===e.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;yd(t,e.data)>r?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,t.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,t){const i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(e.data)),i)}}_pointerId(e){const t=e.native;return"mouse"===t.pointerType?`${t.pointerId}:${t.button}`:`${t.pointerType}`}_removeState(e){const t=this._pointerId(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}}class Ad extends jc.a{constructor(e=300,t=1.5,i=6,r=6,s=500,n=Td.m){super(!1),this.maximumClickDelay=e,this.movementUntilMouseDrag=t,this.movementUntilPenDrag=i,this.movementUntilTouchDrag=r,this.holdDelay=s,this._clock=n,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")})),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((e=>{null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null)})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=t.native.pointerId;let r=null;0===this._pointerState.size&&(r=this._clock.setTimeout((()=>{const t=this._pointerState.get(i);if(t){if(!t.isDragging){const i=t.previousEvent;this._pointerHold.emit(i,void 0,e.modifiers),t.holdEmitted=!0}t.holdTimeout=null}}),this.holdDelay));const s={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:r,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}_handlePointerMove(e){const t=e.data,i=t.native.pointerId,r=this._pointerState.get(i);r&&(r.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",r,t),void 0,r.modifiers):function(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}(t,r.startEvent)>this._getDragThreshold(t.native.pointerType)&&this._startDragging(e),r.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(e){const t=e.data,i=t.native.pointerId;this._pointerState.forEach((r=>{null!=r.holdTimeout&&(r.holdTimeout.remove(),r.holdTimeout=null),r.isDragging||(r.modifiers=e.modifiers,r.isDragging=!0,i===r.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",r,t)):this._pointerDrag.emit(this._createPointerDragData("start",r,r.previousEvent),e.timestamp))}))}_handlePointerLoss(e,t){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(null!=s.holdTimeout&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,"pointer-up"===t?i:s.previousEvent),void 0,s.modifiers):"pointer-up"===t&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this.maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(r),this.stopCapturingPointer(i.native),0===this._pointerState.size&&this._moveHandle.pause())}}class Md{constructor(e){this.callbacks=e,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(e){const t=e.data,i=t.pointers.size;switch(t.action){case"start":this.currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this.currentCount=0}this.previousEvent=e}_emitStart(e){this.startEvent=e,this.callbacks.condition(this.currentCount,e)&&this.callbacks.start(this.currentCount,e,this.startEvent)}_emitUpdate(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.update(this.currentCount,e,this.startEvent)}_emitEnd(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.end(this.currentCount,e,this.startEvent),this.startEvent=null}}class Od extends jc.a{constructor(e=20,t=40){super(!1),this._threshold=e,this._maxDelta=t,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new Md({start:(e,t)=>this._observeStart(e,t),update:(e,t,i)=>this._observeUpdate(e,t,i),end:(e,t)=>this._observeEnd(t)}),this.registerIncoming("drag",(e=>this.dragEventSeparator.handle(e)))}get failed(){return"failed"===this.state}_observeStart(e,t){1===e&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),t.stopPropagation()),this.state=2===e?"ready":"failed"}_observeUpdate(e,t,i){if("failed"!==this.state&&2===e)return"active"===this.state?(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void t.stopPropagation()):void(this._checkMovementWithinLimits(t.data,i.data)?this._checkVerticalThresholdReached(t.data,i.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=t.data.center,this._artificalDrag.emit({action:"end",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),t.stopPropagation()):this.state="failed")}_observeEnd(e){"active"===this.state&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,t){let i=-1/0,r=1/0,s=-1/0,n=1/0;t.pointers.forEach((e=>{i=Math.max(i,e.x),r=Math.min(r,e.x),s=Math.max(s,e.y),n=Math.min(n,e.y)}));let o=-1/0,a=1/0,l=-1/0,c=1/0;e.pointers.forEach((e=>{o=Math.max(o,e.x),a=Math.min(a,e.x),l=Math.max(l,e.y),c=Math.min(c,e.y)}));const u=i-r,h=s-n,d=o-a,p=l-c;return Math.abs(e.center.x-t.center.x)<this._threshold&&Math.abs(d-u)<=this._maxDelta&&Math.abs(p-h)<=this._maxDelta}_checkVerticalThresholdReached(e,t){let i=Math.abs(e.center.y-t.center.y);return e.pointers.forEach(((e,r)=>{const s=t.pointers.get(r);i=Math.min(i,Math.abs(e.y-s.y))})),i>=this._threshold}}let Rd=class extends O.Z{constructor(){super(...arguments),this._handles=new Ae.Z}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){"pan"!==e&&"rotate"!==e||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){"default"!==e&&"pro"!==e||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){return this._inputManager?.hasPendingInputs}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new fd(this.view.surface,e.input);const t=[new Ed,new Ad,new Sd,new _d(this.view.navigation),new Od],i=new at.$({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new gd],at.f.INTERNAL),this._modeDragPan=new Kh(e,"primary"),this._modeDragRotate=new Xc(e,"secondary",qc.CENTER),this._modeDragZoom=new ru(e,"tertiary");i.installHandlers("navigation",[new Qh(e),new Wc(e),new xh(e),new Th(e,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new Sh(e),new id(e,"p"),new td(e,"n"),new Xc(e,"primary",qc.EYE,["b"]),new Xc(e,"secondary",qc.CENTER,["b"]),new Kh(e,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new rd(e)],at.f.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add((0,he.YP)((()=>this.view.navigation?.browserTouchPanEnabled),(e=>{this._source.browserTouchPanningEnabled=!e}),he.nn))}_updateMode(){const e=this.mode,t=this.primaryDragAction,i=Pd.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};(0,t._)([(0,m.Cb)()],Rd.prototype,"view",void 0),(0,t._)([(0,m.Cb)({value:"pan"})],Rd.prototype,"primaryDragAction",null),(0,t._)([(0,m.Cb)({value:"default"})],Rd.prototype,"mode",null),(0,t._)([(0,m.Cb)({readOnly:!0})],Rd.prototype,"hasPendingInputs",null),(0,t._)([(0,m.Cb)()],Rd.prototype,"latestPointerType",null),(0,t._)([(0,m.Cb)()],Rd.prototype,"latestPointerLocation",null),(0,t._)([(0,m.Cb)()],Rd.prototype,"_inputManager",void 0),Rd=(0,t._)([(0,y.j)("esri.views.3d.input.SceneInputManager")],Rd);const Pd=new Map,Id=new Map,Ld=new Map;Id.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Id.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),Ld.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),Ld.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),Pd.set("default",Id),Pd.set("pro",Ld);const Dd=Rd;var Nd=s(17135),Fd=s(88589),kd=s(3289);let Ud,Vd,zd=!1,Bd=!1,Hd=!1,jd=!1,Gd=null;function Wd(){Gd&&(Gd(),Gd=null)}function Zd(e,t,i,r,s){Wd();const n=Ud.height,o=Vd;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-i),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.closePath()}function qd(e,t){zd&&(t&&Hd||!t&&jd)&&Zd(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var $d=s(12391),Yd=s(72946),Xd=s(98166);const Jd=(0,me.c)(),Kd=(0,pr.c)(),Qd=(0,pr.c)(),ep=(0,me.c)(),tp=(0,kr.c)(),ip=(0,fo.c)(),rp=(0,mo.Ue)(),sp=(0,me.c)(),np=(0,ve.Ue)();class op{constructor(){this.aabr=(0,ve.Ue)(),this.distance=0,this.culled=!1,this.visible=!1}}class ap{constructor(e,t,i={}){this.graphics3DGraphic=e,this.slicePlaneEnabled=t,this.info=i}}class lp{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class cp{}class up{constructor(){this.sortArray=new Nd.Z({allocator:e=>e||new cp})}}var hp,dp;(dp=hp||(hp={}))[dp.Idle=0]="Idle",dp[dp.Process=1]="Process",dp[dp.Sort=2]="Sort",dp[dp.Deconflict=3]="Deconflict",dp[dp.NumStates=4]="NumStates";class pp{constructor(){this.camera=new el.V,this.slicePlane=(0,be.c)(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),(0,be.a)(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let fp=class extends O.Z{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new pp,this._state=hp.Idle,this.graphics=new lp,this.iterators=new up,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==hp.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/hp.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(e){switch(this._state){case hp.Idle:this._startUpdate(),e.madeProgress();case hp.Process:if(this._state=hp.Process,!this._processActiveGraphics(e))return;case hp.Sort:if(this._state=hp.Sort,!this._sortVisibleGraphics(e))return;case hp.Deconflict:if(this._state=hp.Deconflict,!this._deconflictVisibleGraphics(e))return;default:(function(e,t){if(!Bd||!Vd)return;Wd();const i=Vd;let r=0;for(let t=0;t<e.accBinsNumX;t++)for(let s=0;s<e.accBinsNumY;s++){const n=e.accBins[t][e.accBinsNumY-1-s];r+=n.length;const o=t*e.accBinsSizeX,a=(t+1)*e.accBinsSizeX,l=s*e.accBinsSizeY,c=(s+1)*e.accBinsSizeY;i.fillText(n.length.toFixed(),o+5,l+15),Zd(o,a,l,c,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)})(this,this.graphics.visible),this._state=hp.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach((e=>this.addToActiveGraphics(e))):e.forEach((e=>this.removeFromActiveGraphics(e))),this.setDirty()}layerSupportsDeconfliction(e){if((0,I.Wi)(e)||"object3d"!==e.type)return!1;const t=e.stageObject;return 1===(t?t.geometryRecords.length:0)&&t.geometryRecords[0].material instanceof Xd.A}_startUpdate(){(function(e){Hd=kd.Z.DECONFLICTOR_SHOW_VISIBLE,jd=kd.Z.DECONFLICTOR_SHOW_INVISIBLE,zd=Hd||jd,Bd=kd.Z.DECONFLICTOR_SHOW_GRID,Gd=null,zd||Bd?Gd=()=>function(e){null==Ud&&(Ud=document.createElement("canvas"),Ud.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Ud));const{state:t}=e,{camera:i,pixelRatio:r}=t,{width:s,height:n}=i,o=s*r,a=n*r;Ud.setAttribute("width",`${o}px`),Ud.setAttribute("height",`${a}px`),Ud.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),Vd=Ud.getContext("2d"),Vd.clearRect(0,0,s,n),Vd.font="12px Arial"}(e):Ud&&(Ud.parentElement.removeChild(Ud),Ud=null)})(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new op,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),function(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag($d.P.DECONFLICTION,t)}(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=(0,Fr.a)(tp,this._runningViewState.camera.projectionMatrix),r="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this._runningViewState.camera.relativeElevation>0?ip:null;let s=0;for((0,I.pC)(r)&&((0,dr.m)(r,me.Z,this._runningViewState.camera.viewMatrix),r[3]=(0,fr.Iu)(this.view.spatialReference).radius,s=(0,fo.e)(r,me.Z));!e.done;){e.madeProgress();const n=t.next();if(!0===n.done)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),!0===i.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===$d.E.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(!0===r.done)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),qd(n,a)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=mp(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=mp(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=function*(e,t,i){t.clear(),e.forEach(((e,r)=>{const s=t.pushNew();s.id=r,s.prio=e.info?-e.info[i].distance:Number.MAX_VALUE})),yield;const r=t.iterableSort(((e,t)=>t.prio-e.prio));for(let e=r.next();!e.done;e=r.next())yield;t.forAll((t=>{const i=e.get(t.id);i&&(e.delete(t.id),e.set(t.id,i))})),t.clear()}(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible($d.E.GRAPHIC,$d.P.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);(0,ve.cS)(n.aabr);let a=null;for(const s of o){if(!this.layerSupportsDeconfliction(s))continue;const o=s.stageObject.geometryRecords[0].material;if((0,I.Wi)(a)){if(a=this._getProjectionInfo(s,t,yp),a.isOutsideScreen||this._isCulledBySlice(e,Jd)||(0,I.pC)(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!kd.Z.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,s,o,a)}(0,I.Wi)(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,i){const r=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],o=n.material,a=(0,fo.g)(s.boundingVolumeWorldSpace.bounds);(0,dr.m)(Jd,a,r.viewMatrix);const l=n.geometry.vertexAttributes,c=l.get(zs.T.NORMAL).data,u=l.get(zs.T.AUXPOS1).data;return o.applyShaderOffsetsView(Jd,c,s.transformation,u,r,i.scaleInfo,Jd),(0,Fd.s)(Kd,Jd[0],Jd[1],Jd[2],1),(0,Fd.t)(Qd,Kd,r.projectionMatrix),(0,dr.g)(i.positionNDC,Qd,1/Qd[3]),o.applyShaderOffsetsNDC(i.positionNDC,u,r,i.positionNDC,ep),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(ep[2]),i.distance=ep[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),(0,Fd.s)(Qd,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),(0,Fd.t)(Kd,Qd,t),(0,Fd.b)(Kd,Kd,1/Kd[3]),(0,dr.s)(i.positionView,Jd[0],Jd[1],Jd[2]),i}_isCulledByHorizon(e,t,i){return(0,dr.c)(rp.direction,e.positionView),(0,dr.s)(rp.origin,0,0,0),!!(0,fo.h)(t,rp,sp)&&e.distanceWithoutPolygonOffset>i}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&(0,be.e)(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(gp);(0,Yd.TU)(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=(0,ve.cv)(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,np),(0,$.t7)(0,n.fullWidth,.5+.5*r[0]),(0,$.t7)(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(0!==l){const e=l*Math.min((0,ve.bf)(a),(0,ve.Cb)(a));a[0]-=e,a[1]-=e,a[2]+=e,a[3]+=e}(0,ve.jn)(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let e=Math.floor(i.aabr[0]/this.accBinsSizeX);e<=Math.floor(i.aabr[2]/this.accBinsSizeX);e++)if(!(e<0||e>=this.accBinsNumX))for(let r=Math.floor(i.aabr[1]/this.accBinsSizeY);r<=Math.floor(i.aabr[3]/this.accBinsSizeY);r++){if(r<0||r>=this.accBinsNumY)continue;const s=this.accBins[e][r];for(let e=0;e<s.length;e++){const r=s.data[e],n=r.info[this.visibilityGroup];if(n&&n.visible&&r.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,(0,ve.kK)(n.aabr,i.aabr)))return!0}}return!1}_initBins(e,t){if(null==this.accBins){this.accBins=[];for(let e=0;e<this.accBinsNumX;e++){this.accBins.push([]);const e=this.accBins[this.accBins.length-1];for(let t=0;t<this.accBinsNumY;t++)e.push(new Nd.Z)}}else for(let e=0;e<this.accBinsNumX;e++)for(let t=0;t<this.accBinsNumY;t++)this.accBins[e][t].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this.accBinsSizeX),r=Math.floor(t.aabr[2]/this.accBinsSizeX),s=Math.floor(t.aabr[1]/this.accBinsSizeY),n=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let t=i;t<=r;t++)if(!(t<0||t>=this.accBinsNumX))for(let i=s;i<=n;i++)i<0||i>=this.accBinsNumY||this.accBins[t][i].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag($d.P.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===$d.E.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function*mp(e){if(Map.prototype.entries){const t=e.entries();for(let e=t.next();!e.done;e=t.next())yield e.value[1]}else yield*e.values()}(0,t._)([(0,m.Cb)({constructOnly:!0})],fp.prototype,"view",void 0),(0,t._)([(0,m.Cb)({type:Boolean,readOnly:!0})],fp.prototype,"updating",null),fp=(0,t._)([(0,y.j)("esri.views.3d.layers.graphics.Deconflictor")],fp);const gp=(0,gr.a)(),yp=new class{constructor(){this.positionView=(0,me.c)(),this.positionNDC=(0,me.c)(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}};let _p=class extends fp{constructor(){super(...arguments),this.visibilityGroup=$d.E.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===nt.ZM.IDLE||t-this._lastDeconfliction>2e3)&&(super.runTask(e),this.state===hp.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};(0,t._)([(0,m.Cb)({constructOnly:!0})],_p.prototype,"parent",void 0),_p=(0,t._)([(0,y.j)("esri.views.3d.layers.graphics.LabelDeconflictor")],_p);let vp=class extends fp{constructor(){super(...arguments),this._handles=new Ae.Z,this._contexts=new Map,this._viewState=new pp,this.visibilityGroup=$d.E.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([(0,he.YP)((()=>this.view?.state?.camera),(()=>{this._updateViewState(),this.setDirty()})),(0,he.YP)((()=>this.view?.map?.ground?.opacity),((e,t)=>{1!==e&&1!==t||this.setDirty()})),(0,he.YP)((()=>this.view?.slicePlane),(()=>{this._updateSlicePlane(),this._slicePlaneChanged()}),he.nn)]),this._frameTask=this.view.resourceController.scheduler.registerTask(nt.T8.GRAPHICS_DECONFLICTOR,this),this._labels=new _p({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&bp(e));t.setVisibilityFlag($d.P.DECONFLICTION,i,$d.E.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;(0,I.pC)(e)&&(0,be.t)(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=(0,I.pC)(e)}_slicePlaneChanged(){(0,Je.oE)(this._contexts,((e,t)=>t.symbolCreationContext.slicePlaneEnabled))&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return null==t&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:e=>this._removeGraphic(t,e),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic)))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic))),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,s=new ap(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),bp(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=bp(e);i||function(e){const t=e.graphics3DGraphics;t&&t.forEach((e=>e.clearVisibilityFlag($d.P.DECONFLICTION)))}(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach((e=>e.slicePlaneEnabled=i)),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const e of t)if(this.layerSupportsDeconfliction(e))return!0;return!1}};function bp(e){const t=e.layer;return!(!t||!t.featureReduction||"selection"!==t.featureReduction.type)}vp=(0,t._)([(0,y.j)("esri.views.3d.layers.graphics.GraphicsDeconflictor")],vp);var wp=s(67979),xp=s(45043),Cp=s(13667),Tp=s(94984),Sp=s(63630),Ep=s(51555),Ap=s(37753),Mp=s(27437);function Op(e){return e instanceof Mp.Z?e.graphics3DSymbol:e instanceof Ap.Z?e:null}var Rp=s(37116);const Pp=p.Z.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Ip(e){const t=function(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,s=Op(r.graphics3DSymbol),n=(0,I.yw)(s,(e=>"point-3d"===e.symbol.type?e.symbol:null)),o=Up[t]||Np(e);return(0,I.pC)(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:kp(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&((0,I.Wi)(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?function(e){return"above-center"===e}(o.placement)?{placement:"above-center",verticalOffset:kp(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(Pp.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}(e);if((0,I.Wi)(t))return null;const i=function(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=Up[i],s=r||Np(e);return i&&!r&&Pp.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),function(e,t){const i=t.graphics3DGraphic.graphic.geometry;if((0,I.Wi)(i))return null;if((0,I.pC)(t.disablePlacement))return t.labelClass.labelPlacement?(Pp.warnOncePerTick(Dp(e.placement,t.disablePlacement.logEntityDescription)),Np(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return Pp.warnOncePerTick(Dp(e.placement,`'${r}' geometries`)),Np(t);break;case"point":case"mesh":return e}return e}(s,e)}(e,t);if((0,I.Wi)(i))return null;const r=i.anchor,s=!!t.hasLabelVerticalOffset;return function(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if((0,I.Wi)(r))return null;switch(r.type){case"point":!function(e,t,i){const r=Lp(i);if((0,I.Wi)(r))return;const s=i.graphics3DGraphic.graphics[0];switch((0,I.pC)(s)?s.getCenterObjectSpace(e.translation):(0,dr.s)(e.translation,0,0,0),r.type){case"icon":case"text":!function(e,t,i,r){const{graphics3DGraphic:s}=i,n=(0,I.pC)(r)?r.getScreenSize():null;if(!s.isDraped&&(0,I.pC)(n)){const r=function(e,t=Bp){const{graphics3DGraphic:i}=e,r=i.graphics[0],s=(0,I.pC)(r)?r.stageObject.geometryRecords[0].material:null;if(s&&s instanceof Xd.A){const e=s.parameters.anchorPosition;t[0]=2*(e[0]-.5),t[1]=2*(e[1]-.5)}else t[0]=0,t[1]=0;return t}(i);zp[0]=n[0]/2*(t.normalizedOffset[0]-r[0]),zp[1]=n[1]/2*(t.normalizedOffset[1]-r[1]),e.screenOffset[0]=zp[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=zp[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=zp[1]}else e.hasLabelVerticalOffset||"center"===e.anchor||(Up[i.labelClass.labelPlacement]&&Pp.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}(e,t,i,s);break;case"object":Fp(e,t,s)}}(e,t,i);break;case"polygon":!function(e,t,i){const r=Lp(i);if(!(0,I.Wi)(r))switch(r.type){case"extrude":{const r=i.graphics3DGraphic.graphics[0];(0,I.pC)(r)?(r.getBoundingBoxObjectSpace(Hp),(0,Rp.be)(Hp,e.translation),e.translation[2]=(0,Rp.Cb)(Hp)/2):(0,dr.s)(e.translation,0,0,0),Fp(e,t,r);break}}}(e,t,i);break;case"mesh":Fp(e,t,i.graphics3DGraphic.graphics[0])}return e}({anchor:r,verticalOffset:t.verticalOffset,screenOffset:(0,gr.a)(),centerOffset:(0,pr.f)(0,0,0,-1),centerOffsetUnits:"world",translation:(0,me.c)(),elevationOffset:0,hasLabelVerticalOffset:s},i,e)}function Lp(e){const t=Op(e.graphics3DGraphic.graphics3DSymbol);return(0,I.pC)(t)?t.symbol.symbolLayers.getItemAt(0):null}function Dp(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function Np(e){const t=e.graphics3DGraphic.graphic.geometry;if((0,I.Wi)(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const t=Lp(e);return(0,I.pC)(t)&&"extrude"===t.type?Up["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Up["above-center"];default:return}}function Fp(e,t,i){const r=(0,I.pC)(i)?i.getBoundingBoxObjectSpace(Hp):Hp,s=(0,me.f)(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=(0,dr.l)(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function kp(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const Up={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Vp={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in Vp){const t=Vp[e],i=Up[e];t.forEach((e=>{Up[e]=i}))}Object.freeze&&(Object.freeze(Up),Object.keys(Up).forEach((e=>{Object.freeze(Up[e]),Object.freeze(Up[e].normalizedOffset)})));const zp=[0,0],Bp=[0,0],Hp=(0,Rp.Ue)();var jp=s(89160);class Gp{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,t){this._materials.set(e,t),this._stage.add(t)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}var Wp=s(90670),Zp=s(71667),qp=s(7958),$p=s(95399),Yp=s(39169);const Xp=4096;let Jp=class extends O.Z{constructor(e){super(e),this.type=$p.U.Texture,this.id=(0,qp.D)(),this.events=new P.Z,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=(0,I.O3)(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.CLAMP_TO_EDGE,flipped:!0,samplingMode:Er.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return(0,I.pC)(this._glTexture)||(this._glTexture=new Hs.x(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(nt.T8.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=(0,I.hw)(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=(0,I.O3)(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",512..toString()),e.setAttribute("height",512..toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=512){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=(0,$.Sf)(i),i=Math.min(i,Xp),i}_resizeAtlas(e,t){t=t||e;const i=this.atlas;i.size.width=e,i.size.height=t,(0,I.pC)(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=Kp,e.cursor.y=Kp+Qp,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,i=this.elements.size;return this._getAtlasUsage()/i*(i+t-e)}_addAtlasElement(e,t,i,r){const s=this.atlas,{renderedWidth:n,renderedHeight:o,displayWidth:a,displayHeight:l}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=o,e.placement.size.displayWidth=a,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,r),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,i=e.placement.size;this.ctx.clearRect(t.x,t.y,i.width,i.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const i=new Set;return this.stageObjects.set(e,i),i}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const i=this.stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get(zs.T.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const i=this.atlas,r=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+Kp,a=n+Kp+Qp;if(i.cursor.x+o<i.size.width&&i.cursor.y+a<i.size.height)this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+a+i.lineHeight<i.size.height)){const e=this._getExpectedAtlasUsage(),r=e>.85&&i.size.width<Xp;return r&&this._resizeAtlas(2*i.size.width,2*i.size.height),!t||!r&&e>.95&&i.size.width===Xp?(this._processRemovals(),ef.OK):(this._repack(),ef.REPACK)}i.cursor.x=Kp,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r)}return ef.OK}_processRemovals(){this.elementsToRemove.forEach(((e,t)=>{const i=this.stageObjects.get(t);i&&0!==i.size||this._removeAtlasElement(e),i&&0===i.size&&this.stageObjects.delete(t)})),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach(((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)})),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach((t=>{t.geometries[0].vertexAttributes.get(zs.T.UV0).data=new Float32Array(e.placement.uvMinMax),t.geometries[0].vertexAttributes.get(zs.T.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],t.geometryVertexAttrsUpdated(t.geometryRecords[0])})),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let i=!1;if((0,Je.oE)(this.elementsToAddOrUpdate,((e,r)=>{const s=this.elements.get(r);if(s&&s.rendered){const e=this.stageObjects.get(r);return e&&e.forEach((e=>{const t=e.geometries[0].vertexAttributes,i=this.elements.get(r);t.get(zs.T.UV0).data=new Float32Array(i.placement.uvMinMax),t.get(zs.T.SIZE).data=new Float32Array([i.placement.size.displayWidth,i.placement.size.displayHeight]),e.geometryVertexAttrsUpdated(e.geometryRecords[0])})),this.elementsToAddOrUpdate.delete(r),!1}return this._processAddition(this.elementsToAddOrUpdate.get(r),t)===ef.REPACK&&(i=!0,!0)})),i)return void this.runTask(nt.G5,!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),(0,Je.oE)(this.elementsToRender,((t,i)=>(this._processRenderingRequest(t),this.elementsToRender.delete(i),r=!0,e.madeProgress(),e.done))),r&&(0,I.pC)(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&Yp.y.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const i=e.key;this.elementsToAddOrUpdate.has(i)||this.elementsToAddOrUpdate.set(i,{textId:i,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(i,t),this.elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this.elementsToRemove.set(i,this.elements.get(i)),this._removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(0===this.elements.size)return;const e=[];this.elements.forEach(((t,i)=>e.push({element:t,key:i})));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort(((e,t)=>e.key.localeCompare(t.key))),this.elements.clear();for(const{element:t,key:i}of e)this.elements.set(i,t);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:i,atlas:r}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,_resizeAtlas:(e,t)=>s._resizeAtlas(e,t),run:(e,t)=>s.runTask(e,t)}}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Jp.prototype,"view",void 0),(0,t._)([(0,m.Cb)({type:Boolean})],Jp.prototype,"updating",void 0),Jp=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],Jp);const Kp=2,Qp=2;var ef;!function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"}(ef||(ef={}));var tf=s(26982);const rf=p.Z.getLogger("esri.views.3d.layers.graphics.Labeler");let sf=class extends O.Z{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Ae.Z,this._handles.add([(0,he.YP)((()=>this.view.state?.camera),(()=>this.setDirty())),(0,he.YP)((()=>this.view.state?.pixelRatio),(()=>this._resetAllLabels())),this.view.resourceController.scheduler.registerTask(nt.T8.LABELER,this)]),this._textTextureAtlas=new Jp({view:this.view}),this._hudMaterialCollection=new Gp(this.view._stage),this._calloutMaterialCollection=new Gp(this.view._stage)}dispose(){this._handles=(0,I.SC)(this._handles),this._textTextureAtlas=(0,I.O3)(this._textTextureAtlas),this._hudMaterialCollection=(0,I.O3)(this._hudMaterialCollection),this._calloutMaterialCollection=(0,I.O3)(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach(((e,t)=>{this._labels.set(t,e),e.graphics3DGraphic.setVisibilityFlag($d.P.USER_SETTING,!0,$d.E.LABEL)})),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach(((e,t)=>{e.graphics3DGraphic.setVisibilityFlag($d.P.USER_SETTING,!1,$d.E.LABEL),this.setLabelGraphicVisibility(e.graphics3DGraphic,!1),this._labels.delete(t)})),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];(0,I.pC)(i)&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];(0,I.pC)(i)&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this._textTextureAtlas?.updating||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(nf(t)){if(!af(t)){if(lf(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),of(t)){this._dirty=!0;continue}if(!af(t))continue}(0,Je.oE)(t.labelsToInitialize,((i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textTextureResources.initialized||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done)))&&(this._dirty=!0)}this._labelsToRemove.forEach((e=>this._removeLabelTextureFromAtlas(e))),this._labelsToAdd.forEach((e=>this._addLabelTextureToAtlas(e))),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),(0,f.k_)(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,s=r.labelingInfo&&r.labelingInfo.filter((e=>!!e.symbol));if(!s||0===s.length)return;const n=new Array(s.length);let o=!1;await(0,wp.Ed)(s,(async(r,s)=>{const a=r.symbol,l=Op(i.getOrCreateGraphics3DSymbol(a));if((0,I.Wi)(l))return void rf.error("Failed to create Graphics3DSymbol for label");await l.load(),(0,f.k_)(t);let c=null;(0,Tp.Pd)(a)&&a.hasVisibleCallout()&&(c=(0,Sp.S)(a,i.symbolCreationContext),await c.load(),(0,f.k_)(t));const u=await(0,wp.q6)((0,Cp.createLabelFunction)(r,e.layer.fieldsIndex,this.view.spatialReference));if((0,f.k_)(t),!0===u.ok){const e=await this._createTextRenderParameters(l.symbol);(0,f.k_)(t),n[s]={labelClass:r,labelFunction:u.value,graphics3DSymbol:l,graphics3DCalloutSymbolLayer:c,calloutSymbolLayerIndex:0,textRenderParameters:e}}else rf.error(`Label expression failed to evaluate: ${u.error}`),o=!0})),(0,f.k_)(t),o||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch((t=>{if((0,f.D_)(t))throw t;e.labelClassContexts=null})).then((()=>{e.labelClassAbortController=null,this.notifyChange("updating")})).catch((()=>{})),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&"text"===t.type?Zp.V.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const t of e.labelClassContexts)--t.graphics3DSymbol.referenced,t.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,s){const n={text:e.text,centerOffset:i.centerOffset,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffsetUnits:i.centerOffsetUnits,horizontalPlacement:(0,jp.zi)(i.anchor),verticalPlacement:(0,jp.EP)(i.anchor),verticalOffset:i.verticalOffset,debugDrawLabelBorder:kd.Z.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return cf.graphic=t,cf.renderingInfo=null,cf.layer=r,s.createLabel(cf,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,s){const n={symbol:t,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffset:r.centerOffset,centerOffsetUnits:r.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return cf.graphic=e,cf.renderingInfo=n,cf.layer=s,i.createGraphics3DGraphic(cf)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:i}=e,r=e.labelingContext,s=r.labelClassContexts;if(!s||0===s.length||!r.emptySymbolLabelSupported&&0===t.graphics.length)return!1;let n=!1;const o=t.graphic,a=r.layer,l=(0,Ce.C6)(r.layer),c=this.view._stage;for(let e=0;e<s.length;e++){const u=i.textRenderers[e],h=i.labelPlacements[e];if((0,I.Wi)(u)||(0,I.Wi)(h))continue;const d=s[e],p=d.graphics3DSymbol,f=p.symbol&&"label-3d"===p.symbol.type?p.symbol:null,m=p.symbolLayers[0];if(!m)continue;m.setElevationInfoOverride(r.elevationInfoOverride);const g=this._createTextSymbolGraphic(u,o,h,a,m);if(!g)return!1;g._labelClass=d.labelClass,g._labelIndex=e,t.addLabelGraphic(g,c,r.stageLayer),t.setVisibilityFlag($d.P.USER_SETTING,l,$d.E.LABEL),t.clearVisibilityFlag($d.P.SCALE_RANGE,$d.E.LABEL),t.setVisibilityFlag($d.P.DECONFLICTION,!1,$d.E.LABEL),n=!0;const y=d.graphics3DCalloutSymbolLayer;if(y&&h.hasLabelVerticalOffset){y.setElevationInfoOverride(r.elevationInfoOverride);const e=this._createLineCalloutGraphic(o,f,y,h,a);(0,I.pC)(e)&&(d.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(e,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelGraphics){if(null==i._labelClass)continue;const e=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];null!=e&&e.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||0===r.length)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if("arcade"===a.type)try{const e=a.needsHydrationToEvaluate()?(0,xp.mW)(s,i.layer):s;l=a.evaluate(e)}catch(e){l=null}else l=a.evaluate(s);if((0,I.Wi)(l)||""===l||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,u=c.symbol&&"label-3d"===c.symbol.type?c.symbol:null;if(!c.symbolLayers[0])continue;const h=Ip({graphics3DGraphic:e.graphics3DGraphic,labelSymbol:u,labelClass:o.labelClass,disablePlacement:i.disablePlacement});if((0,I.Wi)(h))continue;const d=(0,jp.zi)(h.anchor),p=(0,jp.mq)(d);t.textRenderers[n]=new Wp.tV(l,p,o.textRenderParameters),t.labelPlacements[n]=h}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const i={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},r=t.graphic.uid;e.labels.set(r,i),e.labelsToInitialize.set(r,i),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=e.labels.get(i);r&&(this._destroyGraphic(r,i),e.labels.delete(i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const t=e.labels.get(i);t&&(this._removeGraphic(e,t.graphics3DGraphic),this._addGraphic(e,t.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.labels.forEach((e=>{const t=e.graphics3DGraphic;r.set(t.graphic.uid,t)}));const s=e=>e.labelGraphics[0];if((0,I.Wg)(i.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(e,r,s),i.graphics3DCalloutSymbolLayer){const t=e=>e.labelGraphics[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,t)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach(((t,i)=>{this._destroyGraphic(t,i),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(i,t)})),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,n=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a={graphics3DCore:e,layer:o,scaleVisibility:t,emptySymbolLabelSupported:r,elevationInfoOverride:s,disablePlacement:n,active:o.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new tf.F({isPickable:!0},o.uid)};return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:e=>this._addGraphic(a,e),removeGraphic:e=>this._removeGraphic(a,e),featureReductionChange:()=>{},layerLabelsEnabled:()=>(0,Ce.C6)(a.layer),labelingInfoChange:e=>this._labelingInfoChange(a,e),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.labels.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic))),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.textTextureResources.initialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some((e=>of(e)))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce(((e,t)=>e+(of(t)?0:1)),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function nf(e){return e.active&&(0,Ce.C6)(e.layer)}function of(e){return e.labelClassPromise&&!!e.labelClassAbortController}function af(e){return e.labelClassContexts&&e.labelClassContexts.length}function lf(e){return null===e.labelClassContexts}(0,t._)([(0,m.Cb)({constructOnly:!0})],sf.prototype,"view",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],sf.prototype,"deconflictor",void 0),(0,t._)([(0,m.Cb)()],sf.prototype,"_textTextureAtlas",void 0),(0,t._)([(0,m.Cb)({type:Boolean,readOnly:!0})],sf.prototype,"updating",null),sf=(0,t._)([(0,y.j)("esri.views.3d.layers.graphics.Labeler")],sf);const cf=new Ep.Z(null,null,null);var uf=s(91420),hf=s(40462),df=s(1305);class pf{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new Ae.Z}loadGLTF(e,t,i){const r=i?`gltfPBR:${e}`:`gltf:${e}`;return this._fromCache(this.gltfCache,r,(t=>(0,hf.z)(new uf.C(t.streamDataRequester),e,t,i)),t)}loadWOSR(e,t){const i=`wosr:${e}:${t.disableTextures}`;return this._fromCache(this.wosrCache,i,(t=>(0,df.zD)(e,t)),t)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(e,t,i,r){return new Promise(((s,n)=>{if((0,f.Hc)(r))return void n((0,f.zE)());const o=(0,f.fu)(r,(()=>{this._remove(e,t),n((0,f.zE)())})),a=e.get(t);if(a)return this.evictHandles.remove(t),a.refCount++,void a.item.then(s,n);const l=new AbortController,c={...r,signal:l.signal},u={refCount:1,abortController:l,item:i(c).then((i=>(u.abortController=null,i.remove=()=>this._remove(e,t),i)))};e.set(t,u),u.item.then((e=>{(0,I.pC)(o)&&o.remove(),s(e)}),(e=>{(0,I.pC)(o)&&o.remove(),n(e)}))}))}_remove(e,t){const i=e.get(t);i&&(i.refCount--,0===i.refCount&&this.evictHandles.add((0,le.HO)((()=>{e.delete(t),(0,I.pC)(i.abortController)&&i.abortController.abort()}),ff),t))}}let ff=1e4;var mf=s(57267),gf=s(59934),yf=s(42772),_f=s(34596),vf=s(62884),bf=s(79981);class wf{constructor(e){this.renderCoordsHelper=e,this.surfaceElevation=0,this.cache=new Map,this.frustum=new vf.i(e),this.extendedFrustum=new vf.i(e),this.intersector=new bf.q({renderCoordsHelper:e}),this.renderCoordsHelper=e}begin(e,t){this.surfaceElevation=t,this.aboveGround=this.renderCoordsHelper.getAltitude(e.eye)>t,this.frustum.update(e),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(e)}end(){this.cache.clear()}calculate(e){if(this.allTilesInvisible)return mf.E.INVISIBLE;const t=this.renderCoordsHelper.viewingMode===Nt.JY.Global&&e.lij[0]>=xf&&e.lij[0]<Cf,i=this._getOrCalculateSingleTileVisibility(e,!t);return i!==mf.E.INVISIBLE&&t?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const t=vf.i.nearFarLineIndices,i=e.mutablePoints;for(const e of t){const[t,r]=e,s=i[t],n=i[r];(0,dr.b)(Af,n,s),(0,dr.g)(Af,Af,Sf),(0,dr.a)(i[r],s,Af)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let t=mf.E.INVISIBLE;const i=this.cache.get(e.id);if(null!=i)return i;const r=Rf.acquire();e.getChildren(r);for(const e of r){const i=this.calculate(e);if(i!==mf.E.INVISIBLE&&(t=i,i===mf.E.VISIBLE_ON_SURFACE))break}return Rf.release(r),this.cache.set(e.id,t),t}_getOrCalculateSingleTileVisibility(e,t){const i=this.cache.get(e.id);if(null!=i)return i;const r=this._calculateSingleTileVisibility(e);return t&&this.cache.set(e.id,r),r}_calculateSingleTileVisibility(e){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===Nt.JY.Global&&e.lij[0]<Tf?this._calculateSingleTileVisibilitySided(e,!1)===mf.E.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this.aboveGround)}_calculateSingleTileVisibilitySided(e,t){this.intersector.update(e.extent,e.tilingScheme.spatialReference,this.surfaceElevation,t);const i=(0,fr.Iu)(e.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,i)?this.intersector.isVisibleInFrustum(this.frustum,i,!0)?mf.E.VISIBLE_ON_SURFACE:mf.E.VISIBLE_WHEN_EXTENDED:mf.E.INVISIBLE}_updateExtendedFrustum(e){this.extendedFrustum.update(e),this._shortenFrustumFarPlane(this.extendedFrustum);const t=this.renderCoordsHelper.worldUpAtPosition(e.eye,Af);this.aboveGround||(0,dr.o)(t,t);const i=(0,$.ZF)(-(0,dr.e)(t,e.viewForward));if(this.allTilesInvisible=i>(Math.PI+e.fovY)/2,this.allTilesInvisible)return;if(this.hasExtendedFrustum=i>e.fovY/2,!this.hasExtendedFrustum)return;const r=this._extendedFrustumParameters(),s=this.extendedFrustum.mutablePoints;for(let e=0;e<4;e++){const t=r.pointIndices[e],i=s[t],n=this.renderCoordsHelper.getAltitude(i);if(r.needsAltitudeAdjustment(n)){switch(this.renderCoordsHelper.worldUpAtPosition(i,Af),t){case gf.NQ.FAR_BOTTOM_LEFT:case gf.NQ.FAR_TOP_LEFT:case gf.NQ.NEAR_BOTTOM_LEFT:case gf.NQ.NEAR_TOP_LEFT:(0,Ol._l)(this.extendedFrustum.planes[gf.Nu.LEFT],Af,Af);break;case gf.NQ.FAR_BOTTOM_RIGHT:case gf.NQ.FAR_TOP_RIGHT:case gf.NQ.NEAR_BOTTOM_RIGHT:case gf.NQ.NEAR_TOP_RIGHT:(0,Ol._l)(this.extendedFrustum.planes[gf.Nu.RIGHT],Af,Af)}(0,dr.g)(Af,Af,r.direction),this.renderCoordsHelper.intersectInfiniteManifold((0,mo.re)(i,Af),r.zWithMargin,i)}}if(this.extendedFrustum.updatePoints(s),(0,Ol.zk)(s[gf.NQ.NEAR_BOTTOM_LEFT],s[gf.NQ.NEAR_BOTTOM_RIGHT],s[gf.NQ.NEAR_TOP_RIGHT],Mf),(0,Ol.zk)(s[gf.NQ.NEAR_BOTTOM_RIGHT],s[gf.NQ.NEAR_TOP_RIGHT],s[gf.NQ.NEAR_TOP_LEFT],Of),(0,dr.e)((0,Ol.mJ)(Mf),(0,Ol.mJ)(Of))<0){const e=this.extendedFrustum.mutablePoints;this.aboveGround?[e[gf.NQ.NEAR_BOTTOM_LEFT],e[gf.NQ.NEAR_BOTTOM_RIGHT]]=[e[gf.NQ.NEAR_BOTTOM_RIGHT],e[gf.NQ.NEAR_BOTTOM_LEFT]]:[e[gf.NQ.NEAR_TOP_LEFT],e[gf.NQ.NEAR_TOP_RIGHT]]=[e[gf.NQ.NEAR_TOP_RIGHT],e[gf.NQ.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(e)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this.surfaceElevation-Ef;return{zWithMargin:e,pointIndices:vf.i.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:t=>t>e}}_extendedFrustumParametersBelowSurface(){const e=this.surfaceElevation+Ef;return{zWithMargin:e,pointIndices:vf.i.planePointIndices.top,direction:1,needsAltitudeAdjustment:t=>t<e}}}const xf=2,Cf=6,Tf=12,Sf=.95,Ef=1,Af=(0,me.c)(),Mf=(0,Ol.Ue)(),Of=(0,Ol.Ue)(),Rf=new _f.Z(Array,(e=>{4!==e.length&&(e[0]=new mf.C,e[1]=new mf.C,e[2]=new mf.C,e[3]=new mf.C)}),(e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()}));class Pf{constructor(e){this.camera=new el.V,this.focusOnMap=[0,0],this.screenRect=(0,ve.Ue)(),this.tileSize=e.tileSize,this.renderCoordsHelper=e.renderCoordsHelper,this.tilingScheme=e.tilingScheme,this.visibility=new wf(e.renderCoordsHelper)}begin(e,t,i){this.camera.copyFrom(e),this.surfaceElevation=i,this.focusOnMap[0]=t.x,this.focusOnMap[1]=t.y,(0,ve.al)(0,0,e.fullWidth,e.fullHeight,this.screenRect),this.visibility.begin(this.camera,i)}end(){this.visibility.end()}updateTile(e){e.measures.visibility=this.visibility.calculate(e),e.measures.distance=(0,ve.TE)(e.extent,this.focusOnMap),e.measures.visibility!==mf.E.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const t=Lf,i=1<<t,r=e.measures.screenRect;(0,ve.cS)(r);let s=0;const n=e.lij[0]+t,o=e.lij[1]<<t,a=e.lij[2]<<t,l=this._tileSizeWithBias(e),c=l*l;for(let t=0;t<i;t++)for(let l=0;l<i;l++)if(s+=this._computeScreenArea(e,n,o+t,a+l,r),s>c)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===mf.E.VISIBLE_WHEN_EXTENDED?this.tileSize*Df:this.tileSize}_computeScreenArea(e,t,i,r,s){const n=e.measures.visibility===mf.E.VISIBLE_WHEN_EXTENDED;this._projectToScreen(t,i,r,n,Nf),(0,ve.cS)(If);for(let e=0;e<4;e++)(0,ve.Ho)(If,Nf[e]);return(0,ve.jn)(s,If,s),(0,yf.wu)(Nf[0],Nf[1],Nf[2])+(0,yf.wu)(Nf[0],Nf[2],Nf[3])}_projectToScreen(e,t,i,r,s){this.tilingScheme.ensureMaxLod(e),this.tilingScheme.getExtent(e,t,i,Ff),this._toRenderCoords(Ff,0,3,Uf[0]),this._toRenderCoords(Ff,2,3,Uf[1]),this._toRenderCoords(Ff,2,1,Uf[2]),this._toRenderCoords(Ff,0,1,Uf[3]),r&&(this._projectToPlane(Uf,this.camera.frustum[gf.Nu.NEAR]),this._projectToPlane(Uf,this.camera.frustum[gf.Nu.TOP]),this._projectToPlane(Uf,this.camera.frustum[gf.Nu.BOTTOM]));for(let e=0;e<4;e++)this.camera.projectToRenderScreen(Uf[e],zf),this.camera.renderToScreen(zf,s[e])}_projectToPlane(e,t){for(let i=0;i<4;i++)Vf[i]=(0,Ol.jH)(t,e[i]);const i=Math.max(Vf[0],Vf[1],Vf[2],Vf[3]);if(i>0){const r=(0,dr.g)(kf,(0,Ol.mJ)(t),-i);for(let t=0;t<4;t++)(0,dr.a)(e[t],e[t],r)}}_toRenderCoords(e,t,i,r){return kf[0]=e[t],kf[1]=e[i],kf[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(kf,this.tilingScheme.spatialReference,r),r}}const If=(0,ve.Ue)(),Lf=2,Df=5,Nf=[(0,pe.s1)(),(0,pe.s1)(),(0,pe.s1)(),(0,pe.s1)()],Ff=(0,ve.Ue)(),kf=(0,me.c)(),Uf=[(0,me.c)(),(0,me.c)(),(0,me.c)(),(0,me.c)()],Vf=[0,0,0,0],zf=(0,pe.J$)();var Bf=s(76557);const Hf=p.Z.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let jf=class extends O.Z{constructor(e){super(e),this.tiles=new n.Z,this.tileSize=512,this._idToTile=new Map,this._handles=new Ae.Z,this._clients=new Set,this._dirty=!1,this._newTiles=new Nd.Z}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if((0,I.pC)(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void Hf.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||(0,I.pC)(t)&&e&&t.equals(e))return;const i=(0,I.pC)(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get filterExtentRect(){if((0,I.Wi)(this.filterExtent)||!this.tilingScheme)return null;const e=(0,ve.Ue)();return(0,Bf.G)(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([(0,he.YP)((()=>[this.tilingScheme,this.tileSize]),(()=>this._reset()),he.Z_),(0,he.YP)((()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location]),(()=>this._setDirty()),he.tX)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(nt.T8.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=(0,I.hw)(this._frameWorker),this._handles=(0,I.SC)(this._handles)}addClient(){const e=Gf++;return this._clients.add(e),1===this._clients.size&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(nt.G5))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),(0,I.pC)(this._frameWorker)&&(this._frameWorker.priority=nt.T8.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&(0,I.pC)(this._frameWorker)&&(this._frameWorker.priority=nt.T8.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Pf({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map((e=>new mf.C(e[0],e[1],e[2],this.tilingScheme)))}_purgeHorizonTiles(e){e.sort(((e,t)=>{const i=e.measures.screenRect,r=t.measures.screenRect;return i[1]+i[3]-(r[1]+r[3])})),(0,ve.cS)(Wf);for(let t=0;t<e.length;t++)if((0,ve.jn)(Wf,e.data[t].measures.screenRect,Wf),(0,ve.Cb)(Wf)>Zf)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!(0,ve.kK)(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==mf.E.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const e of this.tiles.items)e.used=!1;const t=e.filter((e=>{const t=this._idToTile.get(e.id);return t?(t.copyMeasurementsFrom(e),t.used=!0):this._idToTile.set(e.id,e),!t})),i=this.tiles.items.filter((e=>!e.used&&(this._idToTile.delete(e.id),!0)));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort(((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===mf.E.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance)),this.tiles.forEach(((e,t)=>e.loadPriority=t))}};(0,t._)([(0,m.Cb)({constructOnly:!0})],jf.prototype,"scheduler",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],jf.prototype,"renderCoordsHelper",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],jf.prototype,"tilingSchemeOwner",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],jf.prototype,"cameraOnSurface",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],jf.prototype,"focus",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],jf.prototype,"viewState",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],jf.prototype,"terrain",void 0),(0,t._)([(0,m.Cb)()],jf.prototype,"tiles",void 0),(0,t._)([(0,m.Cb)()],jf.prototype,"tileSize",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],jf.prototype,"tilingScheme",null),(0,t._)([(0,m.Cb)()],jf.prototype,"filterExtent",null),(0,t._)([(0,m.Cb)({readOnly:!0})],jf.prototype,"filterExtentRect",null),(0,t._)([(0,m.Cb)({readOnly:!0})],jf.prototype,"rootTileIds",null),(0,t._)([(0,m.Cb)({value:!1})],jf.prototype,"suspended",null),(0,t._)([(0,m.Cb)({readOnly:!0})],jf.prototype,"updating",null),jf=(0,t._)([(0,y.j)("esri.views.3d.layers.support.FeatureTileTree3D")],jf);let Gf=0;const Wf=(0,ve.Ue)(),Zf=10;var qf=s(81509),$f=s(90139);let Yf=class extends O.Z{constructor(){super(...arguments),this._propertiesPool=new $f.L({camera:el.V},this),this._lastSeenCameraProjectionValues=new el.V,this.events=new P.Z,this.viewingMode=Nt.JY.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new oi({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new $f.L({camera:el.V},this)}createInitialCamera(){if(this.viewingMode===Nt.JY.Global){const e=(0,fr.Iu)(this.spatialReference).radius;this.camera=new el.V((0,me.f)(4*e,0,0),(0,me.f)(e,0,0),(0,me.f)(0,0,1))}else this.camera=new el.V((0,me.f)(0,0,100),(0,me.f)(0,0,0),(0,me.f)(0,1,0))}get animation(){return this.cameraController instanceof Sl&&(0,I.pC)(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Jf&&Jf.copyFrom(e),Jf.computeUp(this.viewingMode),Kf.camera=Jf,this.events.emit("before-camera-change",Kf);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Jf)&&(this._lastSeenCameraProjectionValues.copyFrom(Jf),Qf.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",Qf)),(!t||!t.equals(Jf))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Jf)),this._cameraChanged=!t||!t.almostEquals(Jf),this._cameraChanged)){const e=(0,qf.Fs)((()=>{this._cameraChanged=!1,e.remove()}))}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return(0,I.pC)(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=(0,I.pC)(e)?e.clone():null}get fixedContentCamera(){return(0,I.pC)(this._contentCamera)}get isGlobal(){return this.viewingMode===Nt.JY.Global}get isLocal(){return this.viewingMode===Nt.JY.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own((0,he.YP)((()=>e.state),(t=>{t!==Cl.Finished&&t!==Cl.Stopped||(this._set("cameraController",null),this.updateCamera((t=>e.onControllerEnd(t))))}),he.Z_)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Cl.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Cl.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(0===this.updateQueue.length||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();Jf.copyFrom(this._get("camera")),e(Jf),this.camera=Jf,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[el.N.TOP]!==t.padding[el.N.TOP]||e.padding[el.N.RIGHT]!==t.padding[el.N.RIGHT]||e.padding[el.N.BOTTOM]!==t.padding[el.N.BOTTOM]||e.padding[el.N.LEFT]!==t.padding[el.N.LEFT]}};(0,t._)([(0,m.Cb)({readOnly:!0,type:Zt})],Yf.prototype,"animation",null),(0,t._)([(0,m.Cb)({type:el.V})],Yf.prototype,"camera",null),(0,t._)([(0,m.Cb)()],Yf.prototype,"pixelRatio",null),(0,t._)([(0,m.Cb)({})],Yf.prototype,"_contentCamera",void 0),(0,t._)([(0,m.Cb)({type:el.V})],Yf.prototype,"contentCamera",null),(0,t._)([(0,m.Cb)({readOnly:!0})],Yf.prototype,"fixedContentCamera",null),(0,t._)([(0,m.Cb)({readOnly:!0})],Yf.prototype,"constraints",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],Yf.prototype,"events",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],Yf.prototype,"isGlobal",null),(0,t._)([(0,m.Cb)({readOnly:!0})],Yf.prototype,"isLocal",null),(0,t._)([(0,m.Cb)({readOnly:!0})],Yf.prototype,"viewingMode",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],Yf.prototype,"spatialReference",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],Yf.prototype,"navigating",null),(0,t._)([(0,m.Cb)({readOnly:!0})],Yf.prototype,"stationary",null),(0,t._)([(0,m.Cb)()],Yf.prototype,"_cameraChanged",void 0),(0,t._)([(0,m.Cb)()],Yf.prototype,"cameraController",null),Yf=(0,t._)([(0,y.j)("esri.views.3d.state.ViewState")],Yf);const Xf=Yf,Jf=new el.V,Kf={camera:null},Qf={camera:null};var em=s(17321);class tm{constructor(e,t){this.elevationProvider=e,this._referenceEllipsoid=(0,fr.Iu)(t),this.unitInMeters=(0,em.c9)(t,this._referenceEllipsoid.metersPerDegree)}compute(e,t,i,r,s){s||(s={near:0,far:0});let n=e[2]*this.unitInMeters;const o=n,a=n-r,l=this.elevationProvider?this.elevationProvider.elevationBounds:null;l&&(n=a>=0?o-this.unitInMeters*l.min:this.unitInMeters*l.max-o);const c={x:(i=(0,I.pC)(i)?i:new Ze.Z({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},u=Math.max(c.x,c.y,c.z);(0,dr.b)(cm,t,e),lm[0]=cm[0]>0?i.xmax:i.xmin,lm[1]=cm[1]>0?i.ymax:i.ymin,lm[2]=cm[2]>0?u/2:-u/2,(0,dr.b)(lm,lm,e),(0,dr.n)(cm,cm);const h=1.1*(0,dr.e)(lm,cm)*this.unitInMeters,d=Math.sqrt(n*(n+2*this._referenceEllipsoid.radius)),p=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),f=p*om*this.unitInMeters,m=p*am*this.unitInMeters;let g=(0,$.uZ)((n-m)/(f-m),0,1);g*=g*g;let y=(0,$.t7)(d,h,g);return y*=Math.max(Math.log(Math.abs(a)),1),y=Math.min(y,Math.max(34064e4,u)),y/=this.unitInMeters,rm(y,sm,this.unitInMeters,s)}}class im{constructor(e){this._referenceEllipsoid=(0,fr.Iu)(e)}compute(e,t,i,r,s){s||(s={near:0,far:0});const n=(0,dr.l)(e)-this._referenceEllipsoid.radius,o=this._referenceEllipsoid.radius+Math.min(0,r),a=Math.abs(n-r),l=Math.max(a,Math.abs(n));return rm(1.2*Math.sqrt(l*(l+2*o)),(0,$.uZ)(2e4-(Math.log(l)-7.983)/9.011*19e3,1e3,2e4),1,s)}}function rm(e,t,i,r){const s=nm/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}const sm=2e4,nm=2,om=.001,am=1e-4,lm=(0,me.c)(),cm=(0,me.c)();let um=class extends O.Z{constructor(e){super(e),this.handles=new Ae.Z}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",(e=>this._handleElevationChangeEvent(e))))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;Fo(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera((e=>{Wo(this.view,e,Zo.EYE_AND_CENTER)}))}};(0,t._)([(0,m.Cb)({constructOnly:!0})],um.prototype,"view",void 0),um=(0,t._)([(0,y.j)("esri.views.3d.state.ElevationCollisionConstraint")],um);let hm=class extends O.Z{constructor(e){super(e),this._handles=new Ae.Z,this.nearFarHeuristic=function(e,t,i){return e===Nt.JY.Global?new im(i):new tm(t,i)}(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([(0,he.YP)((()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far]),(()=>this._clipDistanceNearFarChanged())),(0,he.YP)((()=>this.view.constraints?.clipDistance?.mode),(()=>this._updateNearFar())),this.view.state.events.on("before-camera-change",(e=>this._updateCameraNearFar(e.camera))),(0,he.YP)((()=>this.view.renderDataExtent),(()=>this._updateNearFar()),he.Z_),(0,he.YP)((()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max]),(()=>this._updateAltitude()),he.Z_),(0,he.YP)((()=>this.view.constraints?.tilt?.max),(()=>this._updateTiltMax()),he.Z_),(0,he.YP)((()=>this.view.constraints?.tilt?.mode),(()=>this._updateTilt()),he.Z_),(0,he.YP)((()=>this.view.state?.camera),(()=>this._updateTiltAutoMax()),he.Z_),(0,he.YP)((()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled]),(()=>this._updateCollision()),he.Z_)]),this.view.state.isLocal&&this._handles.add((0,he.YP)((()=>this.view.renderDataExtent),(e=>this._updateLocalSurfaceDistance(e)),he.nn)),this._updateNearFar(),this.view.state.viewingMode!==Nt.JY.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new um({view:this.view}))}destroy(){this._handles=(0,I.SC)(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&"auto"!==e.mode&&this.view.state.updateCamera((t=>(this._updateCameraNearFarManual(t,e),!0)))}_updateNearFar(){this.view.state.updateCamera((e=>(this._updateCameraNearFar(e),!0)))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(t?t.mode:"auto")?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,ko(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,t=!e||"stay-above"===e,i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(uo.COLLISION);const e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Nt.JY.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;"manual"===(e?e.mode:"auto")?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt((0,$.Vl)(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||"auto"!==e.mode)return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate((0,$.BV)(i))}}_updateLocalSurfaceDistance(e){if((0,I.Wi)(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=uo.ALL){this.view.state.updateCamera((t=>Va(this.view,t,{selection:e,interactionType:co.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:ho.TUMBLE})))}};(0,t._)([(0,m.Cb)({constructOnly:!0})],hm.prototype,"view",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],hm.prototype,"surfaceCollisionConstraint",void 0),hm=(0,t._)([(0,y.j)("esri.views.3d.state.ConstraintsManager")],hm);let dm=class extends Tl{constructor(e){super(e),this.handles=new Ae.Z}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Cl.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",(e=>this._handleElevationChangeEvent(e)))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){Fo(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera((e=>{e.copyViewFrom(this.desiredCamera),Wo(this.view,e,Zo.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Cl.Stopped)}))}};(0,t._)([(0,m.Cb)({constructOnly:!0})],dm.prototype,"view",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],dm.prototype,"desiredCamera",null),dm=(0,t._)([(0,y.j)("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],dm);var pm=s(20031);function fm(e){return 360-q.BV.normalize(e)}function mm(e){return q.BV.normalize(360-e)}function gm(e){return(0,I.pC)(e)&&e.resolver&&e.resolver.reject(),null}function ym(e,t,i,r=null){if(!t)return gm(r);const s=e.spatialReference||qe.Z.WGS84;if((0,I.pC)(t.camera)){const e=(0,gu.iV)(t.camera.position,s);if((0,I.Wi)(e))return gm(r);const i=t.camera.clone();return i.position=e,function(e,t){return(0,I.pC)(e)&&e.resolver&&e.resolver.resolve(t),t}(r,i)}if((0,I.Wi)(t.targetGeometry))return gm(r);const n=t.get("targetGeometry.spatialReference");if(n&&!(0,gu.Q8)(n,s))return gm(r);const o=Hu(e,e.state.camera);let a=ku.ADJUST;if(null!=t.rotation&&(o.heading=fm(t.rotation),a=ku.LOCKED),null!=i&&(o.tilt=i),"point"===t.targetGeometry.type){const i=t.targetGeometry;let s;const n=t.targetGeometry.clone();return s=null!=t.scale?ju(e,t.scale,i.latitude):e.state.camera.distance,Zu(e,n,s,o,a,r)}return Xu(e,t.targetGeometry.extent,o.heading,o.tilt,a,r)}async function _m(e,t,i){const r=function(e,t){if(!t||!e.spatialReference)return null;const i={target:null};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const e in t)i[e]=t[e];t.center&&!i.target&&(i.target=t.center)}return i}(e,t);if(!r)throw new l.Z("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new K({fov:e.camera.fov}),n=new ne({camera:s});if(r.target instanceof ne)return Em(await async function(e,t,i,r,s){if((0,I.pC)(t.camera))return Tm(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=(0,I.pC)(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,null!=i.heading?s.rotation=mm(i.heading):null!=i.rotation&&(s.rotation=i.rotation);const n=vm(e,i);null!=n&&(s.scale=n);const o=new sh(r);return ym(e,s,i.tilt,o),s.camera=await o.resolver.promise,s}(e,r.target,r,i,n));if(r.target instanceof K)return Em(Tm(e,r.target,n));const o=null!=r.scale||null!=r.zoom;if(r.target instanceof Ze.Z){const t=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Em(o||t?await Sm(e,r,r.target.center,s,i,n):await async function(e,t,i,r,s,n){n.targetGeometry=i.clone();Hu(e,Uo(e),r);const o=bm(r,t)?ku.LOCKED:ku.ADJUST,a=new sh(s);return Xu(e,i,r.heading,r.tilt,o,a),n.camera=await a.resolver.promise,n}(e,r,r.target,s,i,n))}const a={boundingBox:(0,Rp.cS)(),hasZ:!1,screenSpaceObjects:[]},c=o?function(e,t){return function(e,t){return e.spatialReference?(0,xe.dp)(t,e.spatialReference):void 0}(e,vm(e,t))}(e,r):void 0;if(await Cm(e,r.target,c,a),isFinite(a.boundingBox[0])){let t;if((0,Rp.be)(a.boundingBox,Am),Fm.x=Am[0],Fm.y=Am[1],Fm.z=Am[2],Fm.spatialReference=e.spatialReference,isFinite(Fm.z)&&a.hasZ?t=(0,Rp.wp)(a.boundingBox):(Fm.z=void 0,t=(0,ve.wp)((0,Rp.y8)(a.boundingBox,Pm))),o||t)return Em(await Sm(e,r,Fm,s,i,n));const l=function(e,t){if(!t.length)return.66;let i=Number.NEGATIVE_INFINITY;for(let e=0;e<t.length;e++){const r=t[e].screenSpaceBoundingRect;i=Math.max(i,Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2]),Math.abs(r[3]))}return.66-i/Math.min(e.width,e.height)*2}(e,a.screenSpaceObjects);return Em(await async function(e,t,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=Uo(e),c=function(e,t,i,r,s){let n=0;i.hasZ?n=i.z:e.basemapTerrain&&(n=(0,I.Wg)((0,Mu.KO)(e.elevationProvider,i))),(0,dr.s)(Am,i.x,i.y,n),(0,_e.Bm)(e.spatialReference,Am,Mm,e.renderSpatialReference),(0,as.f)(Om,Mm),(0,as.t)(Om,Om),(0,Rp.cS)(Rm);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let t=0;t<o.length;t++){const i=o[t];let s=r[i[2]];isFinite(s)||(s=n),(0,dr.s)(Am,r[i[0]],r[i[1]],s),(0,_e.SH)(Am,e.spatialReference,Am,e.renderSpatialReference),(0,Rp.pp)(Rm,(0,dr.t)(Am,Am,Om))}const a=(0,Rp.bf)(Rm),l=(0,Rp.Cb)(Rm),c=(0,Rp.Ye)(Rm),u=1/Math.tan(t.fovX/2),h=1/Math.tan(t.fovY/2),d=.5*Math.sqrt(a*a+c*c)*Math.max(h,u)+.5*l,p=.5*l*h+.5*Math.max(a,c);return Math.max(d,p)/s}(e,l,i,r,s);Hu(e,l,n);const u=bm(n,t)?ku.LOCKED:ku.ADJUST;a.scale=Gu(e,c,a.targetGeometry.latitude);const h=new sh(o);return Wu(e,a.targetGeometry,a.scale,n,u,h),a.camera=await h.resolver.promise,a}(e,r,Fm,a.boundingBox,l,s,i,n))}return r.position?Em(function(e,t,i,r){const s=Uo(e);return(0,dr.c)(Im,s.viewForward),qu(e,s.eye,Im,s.up,Nm),i.position=new X.Z(t.position),i.heading=null!=t.heading?t.heading:Nm.heading,i.tilt=null!=t.tilt?t.tilt:Nm.tilt,wm(e,null,i,r)}(e,r,s,n)):Em(await async function(e,t,i,r,s){const n=Uo(e);return Sm(e,t,(0,_e.fA)(n.center,e.renderSpatialReference,e.spatialReference),i,r,s)}(e,r,s,i,n))}function vm(e,t){return null==t.scale&&null!=t.zoom?ih(e,t.zoom):t.scale}function bm(e,t){let i=!1;return null!=t.heading?(e.heading=t.heading,i=!0):null!=t.rotation&&(e.heading=fm(t.rotation),i=!0),null!=t.tilt&&(e.tilt=t.tilt,i=!0),null!=t.fov&&(e.fov=t.fov),i}function wm(e,t,i,r){const s=e.spatialReference||qe.Z.WGS84;return t=(0,I.pC)(t)?t:zu(e,i),(0,I.Wi)(t)||(r.targetGeometry=(0,_e.fA)(t.center,e.renderSpatialReference,s),r.scale=rh(e,t),r.rotation=mm(i.heading),r.camera=i),r}function xm(e,t,i){if(!t)return;if(!(0,gu.Q8)(t.spatialReference,e.spatialReference))throw new l.Z("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const r=[];if(!t.hasZ&&e.basemapTerrain){let i;switch(t.type){case"point":i=t;break;case"multipoint":case"polyline":i=t.extent.center;break;case"mesh":i=t.origin;break;case"extent":i=t.center;break;case"polygon":i=t.centroid}i&&(0,gu.Q8)(i,e.basemapTerrain.spatialReference)?Am[2]=(0,I.Pt)((0,Mu.KO)(e.elevationProvider,i),0):Am[2]=0}(0,km[t.type])(t,(e=>{r.push(e[0],e[1],e[2])}),Am);const s=r.length/3;if(0===s)return;const n=new Array(r.length);if((0,_e.CM)(r,t.spatialReference,0,n,e.spatialReference,0,s)){t.hasZ&&(i.hasZ=!0);for(let e=0;e<n.length;e+=3)t.hasZ?(Am[0]=n[e+0],Am[1]=n[e+1],Am[2]=n[e+2]):(Am[0]=n[e+0],Am[1]=n[e+1]),(0,Rp.pp)(i.boundingBox,Am)}}async function Cm(e,t,i,r){if(Array.isArray(t)&&2===t.length){const i=t[0],s=t[1];if("number"==typeof i&&"number"==typeof s)return Fm.x=i,Fm.y=s,Fm.z=void 0,Fm.spatialReference=e.spatialReference.isGeographic?e.spatialReference:qe.Z.WGS84,void xm(e,Fm,r)}t&&"function"==typeof t.map?await(0,f.as)(t.map((t=>Cm(e,t,i,r)))):t instanceof pm.Z?xm(e,t,r):t instanceof te.Z&&await async function(e,t,i,r){const s=await(0,wp.q6)(e.whenViewForGraphic(t));if(!1===s.ok||(0,I.Wi)(s.value)||!("whenGraphicBounds"in s.value))return void xm(e,t.geometry,r);const n=s.value,o=await(0,wp.q6)(n.whenGraphicBounds(t,{minDemResolution:i}));if(!1===o.ok)return void xm(e,t.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;(0,Rp.TC)(r.boundingBox,l),a&&a.forEach((e=>{r.screenSpaceObjects.push(e)})),isFinite(l[2])&&(r.hasZ=!0)}(e,t,i,r)}function Tm(e,t,i){const r=e.spatialReference,s=(0,gu.iV)(t.position,r);return(0,I.Wi)(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,wm(e,null,t,i))}async function Sm(e,t,i,r,s,n){if((0,I.Wi)(i))throw new l.Z("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=Uo(e);if(t.position)return function(e,t,i,r,s,n){const o=e.renderSpatialReference;return(0,_e.KC)(i.position,Lm,o),(0,_e.KC)(t,Dm,o),n.targetGeometry=new X.Z(t),s.position=new X.Z(i.position),(0,dr.b)(Im,Dm,Lm),qu(e,Lm,Im,r.up,s),n.scale=Gu(e,(0,dr.i)(Lm,Dm),n.targetGeometry.latitude),n.rotation=mm(s.heading),n.camera=s,n}(e,n.targetGeometry,t,o,r,n);if(t.zoomFactor){const r=o.distance/t.zoomFactor,s=(0,dr.g)(Am,o.viewForward,-r);o.eye=(0,dr.a)(Am,o.center,s),n.scale=Gu(e,r,i.latitude)}Hu(e,o,r);const a=bm(r,t)?ku.LOCKED:ku.ADJUST;if(!t.zoomFactor){n.scale=vm(e,t),null==n.scale&&((0,_e.KC)(i,Am,e.renderSpatialReference),(0,gf.g8)(o.frustum,Am)?n.scale=Gu(e,(0,dr.i)(o.eye,Am),i.latitude):n.scale=rh(e,o));const l=new sh(s);Wu(e,n.targetGeometry,n.scale,r,a,l),n.camera=await l.resolver.promise}return n}function Em(e){return e&&(0,I.pC)(e.camera)&&(e.rotation=mm(e.camera.heading)),e}const Am=(0,me.c)(),Mm=(0,kr.c)(),Om=(0,Ga.c)(),Rm=(0,Rp.Ue)(),Pm=(0,ve.Ue)(),Im=(0,me.c)(),Lm=(0,me.c)(),Dm=(0,me.c)(),Nm={heading:0,tilt:0},Fm=new X.Z,km={point(e,t,i){i[0]=e.x,i[1]=e.y,e.hasZ&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let e=0;e<n.length;e++)i[0]=n[e][0],i[1]=n[e][1],r&&(i[2]=n[e][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let e=0;e<n.length;e++)i[0]=n[e][0],i[1]=n[e][1],r&&(i[2]=n[e][2]),t(i)}},multipoint(e,t,i){const r=e.points,s=e.hasZ;for(let e=0;e<r.length;e++)i[0]=r[e][0],i[1]=r[e][1],s&&(i[2]=r[e][2]),t(i)},extent(e,t,i){e.hasZ?(t((0,dr.s)(i,e.xmin,e.ymin,e.zmin)),t((0,dr.s)(i,e.xmax,e.ymin,e.zmin)),t((0,dr.s)(i,e.xmin,e.ymax,e.zmin)),t((0,dr.s)(i,e.xmax,e.ymax,e.zmin)),t((0,dr.s)(i,e.xmin,e.ymin,e.zmax)),t((0,dr.s)(i,e.xmax,e.ymin,e.zmax)),t((0,dr.s)(i,e.xmin,e.ymax,e.zmax)),t((0,dr.s)(i,e.xmax,e.ymax,e.zmax))):(t((0,dr.s)(i,e.xmin,e.ymin,i[2])),t((0,dr.s)(i,e.xmax,e.ymin,i[2])),t((0,dr.s)(i,e.xmin,e.ymax,i[2])),t((0,dr.s)(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let e=0;e<r.length;e+=3)t((0,dr.s)(i,r[e+0],r[e+1],r[e+2]))}};class Um{constructor(e,t,i){this.target=e,this.options=t,this.view=i,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise(((e,t)=>{this.resolveCallback=e,this.rejectCallback=t;const i=new AbortController;(0,I.pC)(this.options.signal)&&(0,f.fu)(this.options.signal,(()=>{this.abort()})),this.abortController=i,this.waitForReady()}))}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}resolve(e){return this.state="finished",this.resolveCallback(e)}reject(e){return this.state="finished",this.rejectCallback(e)}abort(e=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject((0,f.zE)());break;case"wait-for-animation-finish":!e&&(0,I.pC)(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject((0,f.zE)())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await(0,he.N1)((()=>this.view.ready),this.abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,_m(this.view,this.target,this.abortController.signal).then((e=>{if("finished"===this.state)return;const t=this._getCameraFromViewpoint(e);if(!(0,I.Wi)(t))if(this.options.animate){if((0,I.Wi)(this.animationController))return;this.startAnimation(t,this.animationController)}else this.view.stateManager.setStateCamera(t.camera,{applyConstraints:!t.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()}),(e=>{this.reject(e)})))}_getCameraFromViewpoint(e){const t=!!(this.target instanceof ne&&this.target.camera||this.target instanceof K),i=e.camera;if((0,I.Wi)(i))return null;if(!this.view.stateManager.isCompatible(i)){const e=i.position,t=e&&e.spatialReference,r=t?t.wkid:"none",s=this.view.spatialReference.wkid;return this.reject(new l.Z("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${r}, view: ${s})`,{camera:i})),null}const r=zu(this.view,i);return(0,I.Wi)(r)?(this.reject(new l.Z("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:r,isFullySpecified:t}}startAnimation(e,t){this.state="wait-for-animation-finish";const i=t.viewAnimation;if((0,I.Wi)(i))return void this.reject(new l.Z("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!t.active||(0,I.Wi)(t.viewAnimation)||t.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==t)return this.abort();let r;e.isFullySpecified?(r=new dm({view:this.view,desiredCamera:e.camera}),Wo(this.view,e.camera,Zo.EYE_AND_CENTER)):Va(this.view,e.camera),t.begin(e.camera,this.options);const s=e=>{if(!(0,I.Wi)(this.view.state))switch(t.state){case Cl.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Cl.Ready:case Cl.Rejected:case Cl.Running:case Cl.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(e)}}};i.when((()=>{const i=this.view.state.cameraController;r&&(i&&i.active?i instanceof El&&(0,I.pC)(i.viewAnimation)&&i.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=r):(0,I.pC)(t.viewAnimation)&&t.viewAnimation.target===e.viewpoint&&"finished"===t.state&&(this.view.state.cameraController=r))}),(e=>s(e))),t.asyncResult={resolve:()=>s(),reject:e=>s(e)}}_getAnimationController(){let e,t=null;const i=this.view.state.cameraController;return i instanceof El&&(i.updateStateFromViewAnimation(),i.active&&(e=i,t=e.viewAnimation)),null!=e||(e=new El({view:this.view,mode:"animation"}),t=e.viewAnimation,this.view.state.switchCameraController(e))?e:((0,I.pC)(t)&&t.stop(),this.reject(new l.Z("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const Vm=p.Z.getLogger("esri.views.3d.state.ViewStateManager");let zm=class extends O.Z{constructor(e){super(e),this.propertiesPool=new $f.L({frustum:vf.i},this),this.handles=new Ae.Z,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:e=>this._devicePixelRatioOverride=e,setMaximumPixelRatio:e=>this._maximumPixelRatioOverride=e}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=Hu(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(zu(this.view,e),{applyConstraints:!1})||Vm.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=Hu(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=zu(this.view,e);(0,I.Wi)(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=(0,me.d)(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.handles.add([(0,he.YP)((()=>this.contentCamera),(()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())})),(0,he.YP)((()=>this.zoom),(e=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(e-t)/2),Math.abs(e-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})),(0,he.YP)((()=>this.view.state.camera),(e=>{const t=(0,dr.d)(r,e.center);this.test.contentCameraResetState.set("camera.center",t/i),t>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}))],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Vm.error("#center=","Invalid center",e):Vm.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Vm.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=function(e,t,i){const r=e.renderSpatialReference,s=(0,_e.fA)(i,r,Uu(e));if((0,I.Wi)(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=(0,dr.j)(t.eye,i),l=2*a*n*1,c=2*a*o*1;return"global"===e.viewingMode?Eu(e,s,l,c):fu(e,s,l,c)}(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return(0,I.pC)(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Vm.error("#extent=","Invalid extent",e):Vm.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Vm.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Gu(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Vm.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[el.N.TOP]/i),n=Math.round(t[el.N.RIGHT]/i),o=Math.round(t[el.N.BOTTOM]/i),a=Math.round(t[el.N.LEFT]/i);return null!=r&&r.top===s&&r.right===n&&r.bottom===o&&r.left===a?r:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,qm),this.view.state.updateCamera((e=>e.padding=qm)))}_paddingToArray(e,t,i){e?(0,Fd.s)(i,e.top||0,e.right||0,e.bottom||0,e.left||0):(0,Fd.s)(i,0,0,0,0);for(let e=0;e<4;e++)i[e]=Math.round(i[e]*t)}get screenCenter(){const e=this.padding;return(0,pe.vW)((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?function(e,t,i=null){return(0,I.Wi)(i)&&(i=new ne),wm(e,null,t.clone(),i)}(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Vm.error("#viewpoint=","Invalid viewpoint",e);else{const t=(0,I.pC)(e.camera)?e.camera.position:e.targetGeometry,i=(0,I.pC)(t)&&t.spatialReference;Vm.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else Vm.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?th(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Vm.error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if((0,I.pC)(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.view.qualitySettings;if(null!=t&&(e=Math.min(e,t)),null!=i){const t=i/Math.max(this.view.width,this.view.height);e=Math.min(e,t)}return e}get _devicePixelRatio(){return(0,I.Wi)(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([(0,he.on)((()=>this.view.state.events),"before-camera-change",(e=>this._updateElevation(e.camera)))]),(0,he.YP)((()=>this.view.state.camera),(e=>this._updateElevation(e)),{once:!0,sync:!0}),this.handles.add((0,de.A)({prepare:()=>this._prepareFrame()})),this.handles.add((0,he.YP)((()=>this.view.state.cameraController),(()=>{this.cameraSetByUser=!0,this.handles.remove($m)}))),this.handles.add((0,he.on)((()=>this.view.state.events),"camera-projection-changed",(()=>this.notifyChange("scale"))))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new hm({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const e=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;e&&this.isCompatible(e)?this._setInitialView(e):this.view.state.viewingMode===Nt.JY.Local&&this.handles.add((0,he.gx)((()=>this.view.basemapTerrain.ready),(()=>{this.handles.remove($m),this._setInitialView(this.view.dataExtent)}),{once:!0,initial:!0}),$m)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove($m),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i={animate:!0,...t};return(0,I.pC)(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new Um(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Uo(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera((t=>{i.stepController(e,t)})),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){(0,I.pC)(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of jm){const s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach((t=>e.add(t)))}return t}_setInitialView(e){if((0,I.Wi)(e)||this.cameraSetByUser)return;if(e instanceof K)return void this.setStateCamera(zu(this.view,e),{applyConstraints:!1});if(e instanceof ne){if(e.targetGeometry instanceof Ze.Z){const t=Xu(this.view,e.targetGeometry,0,.5,ku.LOCKED);return void((0,I.pC)(t)&&this.setStateCamera(zu(this.view,t),{applyConstraints:!0}))}const t={applyConstraints:!e.camera},i=this._viewpointToCamera(e);return void this.setStateCamera(i,t)}const t=Xu(this.view,e,0,.5,ku.LOCKED);(0,I.pC)(t)&&this.setStateCamera(zu(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&Hm.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!(0,I.Wi)(e)&&(e instanceof ne?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof K?this.isCompatible(e.position):e.spatialReference&&(0,gu.Q8)(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Gm){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=Zm){const{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=$u(this.view,r,s,e,t,ku.ADJUST);return(0,I.Wi)(n)?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=Xu(this.view,e,t,i,ku.ADJUST,Wm);return(0,I.pC)(r)?zu(this.view,r):null}_scaleToCamera(e){if(null==e)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,s=ju(this.view,e,r);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(ih(this.view,e))}_viewpointToCamera(e){return zu(this.view,ym(this.view,e))}setStateCamera(e,t){return!((0,I.Wi)(e)||!this.view.state.stopActiveCameraController()||(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera((i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&Va(this.view,i)})),t.applyConstraints||(this.view.state.cameraController=new dm({view:this.view,desiredCamera:e})),0))}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._devicePixelRatio,r=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(0!==r&&0!==s&&(t.width===r&&t.height===s||(t.width=r,t.height=s),this.view.state)){const e=this.view.state.camera;e.fullWidth===r&&e.fullHeight===s&&e.pixelRatio===i||(Zm.copyFrom(e),Zm.pixelRatio!==i&&(this._paddingToArray(this.padding,i,qm),Zm.padding=qm),Zm.fullWidth=r,Zm.fullHeight=s,Zm.pixelRatio=i,this.view.state.camera=Zm)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?ko(this.view,e.eye):0;e.relativeElevation=i-r}};(0,t._)([(0,m.Cb)({type:K,dependsOn:["view.state.camera","ready"]})],zm.prototype,"camera",null),(0,t._)([(0,m.Cb)({type:K,dependsOn:["view.state.contentCamera","ready"]})],zm.prototype,"contentCamera",null),(0,t._)([(0,m.Cb)({type:X.Z})],zm.prototype,"center",null),(0,t._)([(0,m.Cb)({type:Ze.Z})],zm.prototype,"extent",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zm.prototype,"frustum",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zm.prototype,"hasInitialView",null),(0,t._)([(0,m.Cb)({readOnly:!0,type:Boolean})],zm.prototype,"ready",void 0),(0,t._)([(0,m.Cb)({type:Number})],zm.prototype,"scale",null),(0,t._)([(0,m.Cb)()],zm.prototype,"padding",null),(0,t._)([(0,m.Cb)({readOnly:!0})],zm.prototype,"screenCenter",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],zm.prototype,"view",void 0),(0,t._)([(0,m.Cb)({type:ne})],zm.prototype,"viewpoint",null),(0,t._)([(0,m.Cb)({type:Number})],zm.prototype,"zoom",null),(0,t._)([(0,m.Cb)()],zm.prototype,"maximumPixelRatio",null),(0,t._)([(0,m.Cb)()],zm.prototype,"_devicePixelRatio",null),(0,t._)([(0,m.Cb)()],zm.prototype,"_windowDevicePixelRatio",void 0),(0,t._)([(0,m.Cb)()],zm.prototype,"_devicePixelRatioOverride",void 0),(0,t._)([(0,m.Cb)()],zm.prototype,"_maximumPixelRatioOverride",void 0),zm=(0,t._)([(0,y.j)("esri.views.3d.state.ViewStateManager")],zm);const Bm=zm,Hm=["camera","viewpoint","extent","scale","center","zoom"],jm=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Gm={heading:0,tilt:0},Wm=new K,Zm=new el.V,qm=(0,pr.c)(),$m="pending-initial-view";var Ym=s(20757),Xm=s(66218);class Jm{constructor(e,t,i){this.viewingMode=e,this._forEachLayer=t,this.view=i,this.externalIntersectionHandlers=new Nd.Z,this.tolerance=No.vh,this.tmpRay=(0,mo.Ue)(),this.tmpRegion=(0,ve.Ue)(),this.validateHUDIntersector=(0,No.Z8)(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(e,t,i){return this.intersectRay(this._getPickRay(e,this.tmpRay),ig(this.viewingMode),t,i)}intersectScreenFreePointFallback(e,t,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this.tmpRay),t,i)}intersectRayFreePointFallback(e,t,i){return this.intersectRay(e,ig(this.viewingMode),t,i)||this._intersectRayFreePointLocal(e,t)}intersectRay(e,t,i,r){return t.options.selectionMode=!1,t.options.store=Ym.eC.MIN,this.computeIntersection(e,t,r),!!t.results.min&&t.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,t,i=.5,r=.5){return e.getRenderCenter(og,i,r),og[0]+=.0466,og[1]-=.0123,(0,Rl.eW)(e,og,t)}intersectIntersectorScreen(e,t,i){this.computeIntersection(this._getPickRay(e,this.tmpRay),t,i)}intersectToolIntersectorScreen(e,t,i){const r=this._getPickRay(e,this.tmpRay);this.intersectToolIntersectorRay(r,t,i)}intersectToolIntersectorRay(e,t,i){t.options.selectionMode=!0,this.computeIntersection(e,t,i);const r=t.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.opaque||(0,Xm.nn)(r)&&r.intersector!==Ym.q7.TERRAIN||(t.options.selectionMode=!1,this.computeIntersection(e,t,i))}setTolerance(e=No.vh){this.tolerance=e}addIntersectionHandler(e){this.externalIntersectionHandlers.push(e),this.externalIntersectionHandlers.sort(((e,t)=>e.type===Ym.q7.TERRAIN?1:t.type===Ym.q7.TERRAIN?-1:0))}removeIntersectionHandler(e){null!=this.externalIntersectionHandlers.removeUnordered(e)&&this.externalIntersectionHandlers.sort(((e,t)=>e.type===Ym.q7.TERRAIN?1:t.type===Ym.q7.TERRAIN?-1:0))}_getPickRay(e,t){const i=this.view.state.camera;return(0,Rl.u4)(i,e,t)}_intersectRayFreePointLocal(e,t){if(this.viewingMode!==Nt.JY.Local||(0,I.Wi)(e))return!1;const i=this.view.renderDataExtent;if((0,I.Wi)(i))return(0,dr.a)(t,e.origin,(0,dr.n)(Br.WM.get(),e.direction)),!0;const r={x:i.xmax-i.xmin,y:i.ymax-i.ymin,z:8*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},s=Math.max(r.x,r.y,r.z);if(0===s)return(0,dr.a)(t,e.origin,(0,dr.n)(Br.WM.get(),e.direction)),!0;const n=this.view.state.camera,o=Math.max(0,i.xmin-n.eye[0],n.eye[0]-i.xmax),a=Math.max(0,i.ymin-n.eye[1],n.eye[1]-i.ymax),l=Math.sqrt(o*o+a*a),c=Math.abs(n.relativeElevation)+Number.MIN_VALUE,u=Math.max(0,Math.log(s/c))**2;let h=s/Math.max(1,u);h=Math.max(h,Math.min(l,s));const d=(0,dr.g)(Br.WM.get(),e.direction,h/(0,dr.l)(e.direction));return(0,dr.a)(t,e.origin,d),!0}intersectElevationFromScreen(e,t,i=0,r=null){return this._intersectElevation(this._getPickRay(e,this.tmpRay),t,i,r)}_intersectElevation(e,t,i=0,r=null){if((0,I.Wi)(e))return null;const s=(0,I.pC)(t)?t.mode:"absolute-height",n=(0,I.pC)(t)?(0,I.Pt)(t.offset,0):0,o="on-the-ground"!==s?n+i:0,a=o/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===s){if(this.view.renderCoordsHelper.intersectInfiniteManifold(e,o,ng)){const e=this.view.computeMapPointFromVec3d(ng);return e.z-=n,e}return null}const l=this.view.state.camera,c=(0,pe.Wv)(Br.WM.get());l.projectToRenderScreen(e.origin,c);const u=new rg(null,this._forEachLayer),h=this.view.slicePlane,d=(0,I.pC)(h)?(0,Xm.e4)(h):null,p=(0,No.Z8)(this.viewingMode);p.options.store=Ym.eC.MIN,p.options.verticalOffset=a;const f=e.origin,m=(0,dr.a)(Br.WM.get(),f,e.direction);p.reset(f,m,l),p.point=c;const g=(0,I.pC)(r)?"type"in r&&"graphics"===r.type?e=>e.metadata.layerUid!==r.uid:e=>e.metadata.graphicUid!==r.uid:null;switch(s){case"relative-to-scene":{const e=e=>((0,I.Wi)(g)||g(e))&&e.metadata&&e.metadata.isElevationSource;p.intersect(u.layers,c,this.tolerance,null,e),this.externalIntersectionHandlers.forAll((e=>{if(e.type===Ym.q7.I3S||e.type===Ym.q7.TERRAIN){const t=e.slicePlaneEnabled?d:null;e.intersect(p,t,p.rayBegin,p.rayEnd,c)}}))}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll((e=>{if(e.isGround){const t=e.slicePlaneEnabled?d:null;e.intersect(p,t,p.rayBegin,p.rayEnd,c)}}))}if(p.results.min.getIntersectionPoint(ng)){const e=this.view.computeMapPointFromVec3d(ng);return e.z=i,e}return null}computeIntersection(e,t,i){if((0,I.Wi)(e))return;const r=this.view.state.camera,s=(0,pe.Wv)(Br.WM.get());r.projectToRenderScreen(e.origin,s);const n=new rg(i,this._forEachLayer);t.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const o=e.origin,a=(0,dr.a)(Br.WM.get(),e.origin,e.direction);t.reset(o,a,r),t.intersect(n.layers,s,this.tolerance);const l=this.view.slicePlane,c=(0,I.pC)(l)?(0,Xm.e4)(l):null;t.intersect(n.sliceableLayers,s,this.tolerance,c);const u=i&&(i.requiresGroundFeedback||i.enableDraped);this.externalIntersectionHandlers.forAll((e=>{if(t.options.isFiltered=!n.filterLayerUid(e.layerUid),e.isGround&&u||!t.options.isFiltered){const i=e.slicePlaneEnabled?c:null;e.intersect(t,i,o,a,s)}}));const h=Br.WM.get();if(i&&i.enableDraped&&t.results.ground.getIntersectionPoint(h)){const e=this.view.basemapTerrain,i=e.overlayManager.renderer,r=this.view.renderCoordsHelper.spatialReference,s=Br.WM.get();this.view.renderCoordsHelper.fromRenderCoords(h,s,e.spatialReference),s[2]=(0,I.Pt)(this.view.elevationProvider.getElevation(h[0],h[1],h[2],r,"ground"),0),i.intersect(t,s,t.results.ground,(e=>n.filterRenderGeometry(e)))}t.sortResults(),this._processHUDResults(t)}_processHUDResults(e){const t=e.results.hud;(0,ve.JG)(this.tmpRegion,ve.Gv);const i=this.view.state.camera,r=[],s=this.tmpRegion,n=e=>{const t=new eg(e);i.projectToRenderScreen(e.target.center,t.screenPoint),t.screenPoint[0]=Math.floor(t.screenPoint[0]),t.screenPoint[1]=Math.floor(t.screenPoint[1]),r.push(t),(0,ve.Ho)(s,t.screenPoint)};e.sortResults(t.all),(0,I.pC)(t.min.dist)&&n(t.min);for(const e of t.all)t.min.target.object!==e.target.object&&t.max.target.object!==e.target.object&&n(e);if((0,I.pC)(t.max.dist)&&t.max.target.object!==t.min.target.object&&n(t.max),!r.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const o=i.fullWidth,a=i.fullHeight,l=Math.max(0,s[0]-Km),c=Math.max(0,s[1]-Km),u=Math.min((0,ve.bf)(s)+2*Km,o-l),h=Math.min((0,ve.Cb)(s)+2*Km,a-c),d=new Uint8Array(u*h*4);this.view._stage.renderView.readHUDVisibility(l,c,u,h,d);let p=!0;const f=(0,I.Wi)(e.results.max.dist);let m=0;for(const t of r)for(const i of Qm)if(d[4*(Math.min(t.screenPoint[0]+i[0],o)-s[0]+(Math.min(t.screenPoint[1]+i[1],a)-s[1])*u)]){p&&(e.results.min.copy(t.result),p=!1),f&&e.results.max.copy(t.result),e.options.store===Ym.eC.ALL&&e.results.all.splice(m++,0,t.result);break}}}const Km=1,Qm=(()=>{const e=[],t=Km;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)e.push([r+t,i+t]);return e})();class eg{constructor(e){this.result=e,this.screenPoint=(0,pe.J$)()}}let tg;function ig(e){return tg&&tg.viewingMode===e||(tg=(0,No.Z8)(e)),tg}class rg{constructor(e,t){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,t((e=>{e.isPickable&&this.filterLayerUid(e.apiLayerUid)&&(e.isSliceable?this.sliceableLayers:this.layers).push(e)}))}filterLayerUid(e){const{include:t,exclude:i}=this;return(0,I.Wi)(e)?null==t&&null==i:(null==t||t.has(e))&&(null==i||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}}function sg(e){return"object"==typeof e&&"intersect"in e}const ng=(0,me.c)(),og=(0,pe.J$)();var ag=s(89301);let lg=class extends(P.Z.EventedMixin(O.Z)){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=(0,I.SC)(this._elevationQuery)}get elevationQuery(){return(0,I.Wi)(this._elevationQuery)&&(this._elevationQuery=new ag.K(this.view.resourceController.scheduler,this.view.spatialReference,(()=>this.view.map&&this.view.map.ground),{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,s){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){const n=this.lastElevationQuery;if(e===n.x&&t===n.y&&i===n.z&&r.equals(n.spatialReference)&&s===n.queryContext)return n.result}let n=null;return n=cg(n,this.im,e,t,i,r,s),(0,I.Wi)(n)&&(n=cg(n,this.ground,e,t,i,r,s)),"scene"===s&&(n=cg(n,this.scene,e,t,i,r,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}queryElevation(e,t,i,r,s,n=null,o=0){const a=(0,f.hh)();return this.elevationQuery.queryElevation(e,t,n,o).then((n=>{"scene"===s&&(n=cg(n,this.scene,e,t,i,r,s)),a.resolve(n)})).catch((n=>{(0,f.D_)(n)?a.reject(n):a.resolve(this.getElevation(e,t,i,r,s))})),a.promise}register(e,t){this.handles.set(t,t.on("elevation-change",(e=>this.emit("elevation-change",e)))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}};function cg(e,t,i,r,s,n,o){for(const a of t){const t=a.getElevation(i,r,s,n,o);(0,I.pC)(t)&&(e=(0,I.pC)(e)?Math.max(t,e):t)}return e}(0,t._)([(0,m.Cb)({constructOnly:!0})],lg.prototype,"view",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],lg.prototype,"spatialReference",void 0),lg=(0,t._)([(0,y.j)("esri.views.3d.support.CombinedElevationProvider")],lg);class ug{static isValidProfile(e){return e in ug.profiles}static getDefaultProfile(){return(0,b.Z)("trident")||(0,b.Z)("esri-iPhone")?"low":"medium"}static apply(e,t){const i=ug.profiles[e];t.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,t.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,t.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,t.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,t.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable;{const e=t.sceneService["3dObject"],r=i.sceneService["3dObject"];e.lodFactor=r.lodFactor,e.lodCrossfadeinDuration=r.lodCrossfadeinDuration,e.lodCrossfadeoutDuration=r.lodCrossfadeoutDuration,e.lodCrossfadeUncoveredDuration=r.lodCrossfadeUncoveredDuration}t.sceneService.point.lodFactor=i.sceneService.point.lodFactor,t.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,t.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,t.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,t.tiledSurface.lodBias=i.tiledSurface.lodBias,t.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,t.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,t.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,t.heatmap.pixelRatio=i.heatmap.pixelRatio,t.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,t.antialiasingEnabled=i.antialiasingEnabled,t.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,t.highQualityTransparency=i.highQualityTransparency,t.memoryLimit=i.memoryLimit,t.additionalCacheMemory=i.additionalCacheMemory,t.frameRate=i.frameRate,t.maximumRenderResolution=i.maximumRenderResolution,t.maximumPixelRatio=i.maximumPixelRatio}}function hg(){const e=!!(0,b.Z)("esri-mobile"),t=!!(0,b.Z)("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!(0,b.Z)("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!(0,b.Z)("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}ug.debug={reset(){const e=hg();for(const t in e)ug.profiles[t]=e[t]}},function(e){e.profiles=hg()}(ug||(ug={}));const dg=ug;var pg=s(18916);let fg=class extends O.Z{constructor(){super(...arguments),this.color=new r.Z([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new r.Z([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=r.Z.toUnitRGBA(e.color),i=(0,I.pC)(e.haloColor)?r.Z.toUnitRGBA(e.haloColor):t,s=r.Z.toUnitRGBA(e.shadowColor);return{color:(0,pg.f)(t[0],t[1],t[2],t[3]),haloColor:(0,pg.f)(i[0],i[1],i[2],i[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:(0,pr.f)(s[0],s[1],s[2],s[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};(0,t._)([(0,m.Cb)({type:r.Z})],fg.prototype,"color",void 0),(0,t._)([(0,m.Cb)({type:r.Z})],fg.prototype,"haloColor",void 0),(0,t._)([(0,m.Cb)()],fg.prototype,"haloOpacity",void 0),(0,t._)([(0,m.Cb)()],fg.prototype,"fillOpacity",void 0),(0,t._)([(0,m.Cb)()],fg.prototype,"shadowOpacity",void 0),(0,t._)([(0,m.Cb)({type:r.Z})],fg.prototype,"shadowColor",void 0),(0,t._)([(0,m.Cb)()],fg.prototype,"shadowDifference",void 0),fg=(0,t._)([(0,y.j)("esri.views.3d.support.HighlightOptions")],fg);const mg=fg;var gg=s(8060),yg=s(73630),_g=s(41268);class vg{constructor(e,t){this.spatialReference=t,this.unitInMeters=(0,em.c9)(this.spatialReference,(0,fr.Iu)(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=(0,gg.getGeometryServiceURL)(e&&e.get("portalItem")).catch((()=>{throw new l.Z("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")}))}async toGeographic(e){const t=await this._geometryServiceURLPromise;let i,r=!0;Array.isArray(e[0])&&"number"!=typeof e[0]?i=e:(i=[e],r=!1);const s=i.map((e=>e instanceof X.Z?e:new X.Z(e,this.spatialReference))),n=new _g.Z({geometries:s,outSpatialReference:qe.Z.WGS84}),o=(await(0,yg.i)(t,n)).map((e=>"point"===e.type?[e.x,e.y]:void 0));return r?o:o[0]}}let bg=class extends O.Z{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};(0,t._)([(0,m.Cb)()],bg.prototype,"minTotalNumberOfFeatures",void 0),(0,t._)([(0,m.Cb)()],bg.prototype,"maxTotalNumberOfFeatures",void 0),(0,t._)([(0,m.Cb)()],bg.prototype,"maxTotalNumberOfPrimitives",void 0),(0,t._)([(0,m.Cb)()],bg.prototype,"snapshotAvailable",void 0),(0,t._)([(0,m.Cb)()],bg.prototype,"polygonLodFactor",void 0),(0,t._)([(0,m.Cb)()],bg.prototype,"polylineLodFactor",void 0),bg=(0,t._)([(0,y.j)("esri.views.3d.support.QualitySettings.Graphics3DSettings")],bg);let wg=class extends O.Z{constructor(){super(...arguments),this.lodFactor=1}};(0,t._)([(0,m.Cb)()],wg.prototype,"lodFactor",void 0),wg=(0,t._)([(0,y.j)("esri.views.3d.support.QualitySettings.LoDFactorSettings")],wg);let xg=class extends wg{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};xg=(0,t._)([(0,y.j)("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],xg);let Cg=class extends O.Z{constructor(){super(...arguments),this["3dObject"]=new xg,this.point=new wg,this.integratedMesh=new wg,this.pointCloud=new wg,this.uncompressedTextureDownsamplingEnabled=!1}};(0,t._)([(0,m.Cb)({type:xg})],Cg.prototype,"3dObject",void 0),(0,t._)([(0,m.Cb)({type:wg})],Cg.prototype,"point",void 0),(0,t._)([(0,m.Cb)({type:wg})],Cg.prototype,"integratedMesh",void 0),(0,t._)([(0,m.Cb)({type:wg})],Cg.prototype,"pointCloud",void 0),(0,t._)([(0,m.Cb)()],Cg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Cg=(0,t._)([(0,y.j)("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Cg);let Tg=class extends O.Z{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};(0,t._)([(0,m.Cb)()],Tg.prototype,"lodBias",void 0),(0,t._)([(0,m.Cb)()],Tg.prototype,"angledSplitBias",void 0),(0,t._)([(0,m.Cb)()],Tg.prototype,"reduceTileLevelDifferences",void 0),(0,t._)([(0,m.Cb)()],Tg.prototype,"textureFadeDuration",void 0),Tg=(0,t._)([(0,y.j)("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Tg);let Sg=class extends O.Z{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};(0,t._)([(0,m.Cb)()],Sg.prototype,"pixelRatio",void 0),(0,t._)([(0,m.Cb)()],Sg.prototype,"maxTotalNumberOfFeatures",void 0),Sg=(0,t._)([(0,y.j)("esri.views.3d.support.QualitySettings.HeatmapSettings")],Sg);let Eg=class extends O.Z{constructor(){super(...arguments),this.graphics3D=new bg,this.sceneService=new Cg,this.tiledSurface=new Tg,this.heatmap=new Sg,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};(0,t._)([(0,m.Cb)({type:bg})],Eg.prototype,"graphics3D",void 0),(0,t._)([(0,m.Cb)({type:Cg})],Eg.prototype,"sceneService",void 0),(0,t._)([(0,m.Cb)({type:Tg})],Eg.prototype,"tiledSurface",void 0),(0,t._)([(0,m.Cb)({type:Sg})],Eg.prototype,"heatmap",void 0),(0,t._)([(0,m.Cb)()],Eg.prototype,"antialiasingEnabled",void 0),(0,t._)([(0,m.Cb)()],Eg.prototype,"physicallyBasedRenderingEnabled",void 0),(0,t._)([(0,m.Cb)()],Eg.prototype,"highQualityTransparency",void 0),(0,t._)([(0,m.Cb)()],Eg.prototype,"memoryLimit",void 0),(0,t._)([(0,m.Cb)()],Eg.prototype,"additionalCacheMemory",void 0),(0,t._)([(0,m.Cb)()],Eg.prototype,"frameRate",void 0),(0,t._)([(0,m.Cb)()],Eg.prototype,"maximumRenderResolution",void 0),(0,t._)([(0,m.Cb)()],Eg.prototype,"maximumPixelRatio",void 0),Eg=(0,t._)([(0,y.j)("esri.views.3d.support.QualitySettings.QualitySettings")],Eg);const Ag=Eg;var Mg=s(43180),Og=s(25024),Rg=s(40366);function Pg(e){return"function"==typeof e.getUsedMemory}const Ig=p.Z.getLogger("esri.views.3d.support.MemoryController");let Lg=class extends O.Z{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Rg.WJ,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){null==e||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(1),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){null!=e&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new Rg.Xq(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<.6&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(1);else if(e)(this._memoryPredicted>1.1||this._memoryUsed>1)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>1)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<.75&&this._quality<1){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),1))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some((e=>!!e.updating))}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;(0,I.pC)(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach((i=>{if(Pg(i)){const r=i.ignoresMemoryFactor()?this._quality:1;e+=i.getUsedMemory()*r,t+=i.getUnloadedMemory()*r}}));const r=null==this._warnMemoryUsage||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&r){this._warnMemoryUsage=e;const i=e=>(e/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",r=Math.round(100*this._quality);Ig.warn(`Memory Limit exceeded! Limit: ${i(s)} Current: ${i(e)} Projected: ${i(e+t)} Quality: ${r}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Lg.prototype,"view",void 0),(0,t._)([(0,m.Cb)()],Lg.prototype,"maxMemory",null),(0,t._)([(0,m.Cb)()],Lg.prototype,"additionalCacheMemory",null),(0,t._)([(0,m.Cb)()],Lg.prototype,"memoryFactor",null),(0,t._)([(0,m.Cb)()],Lg.prototype,"updating",null),(0,t._)([(0,m.Cb)()],Lg.prototype,"usedMemory",null),(0,t._)([(0,m.Cb)()],Lg.prototype,"_quality",void 0),(0,t._)([(0,m.Cb)()],Lg.prototype,"_memoryUsed",void 0),(0,t._)([(0,m.Cb)()],Lg.prototype,"_updating",void 0),(0,t._)([(0,m.Cb)()],Lg.prototype,"_stableQuality",void 0),(0,t._)([(0,m.Cb)()],Lg.prototype,"_maxMemory",void 0),(0,t._)([(0,m.Cb)()],Lg.prototype,"_additionalCacheMemory",void 0),Lg=(0,t._)([(0,y.j)("esri.views.3d.support.MemoryController")],Lg);var Dg=s(51091);let Ng=class extends O.Z{constructor(){super(...arguments),this.updating=!1}};var Fg;(0,t._)([(0,m.Cb)({readOnly:!0})],Ng.prototype,"updating",void 0),Ng=(0,t._)([(0,y.j)("esri.views.3d.support.ResourceController")],Ng),function(e){let i=class extends Ng{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=nt.sq,this._cameraChangeTime=0,this._handles=new Ae.Z,this._frameTask=null,this._state=nt.ZM.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=(0,nt.z4)(),this._memoryController=function(e){return new Lg({view:e})}(this.view),this._streamDataLoader=new Dg.wu,this._streamDataLoader.setup(Og.NT,Og.Ty,this._scheduler),this._handles.add([(0,he.YP)((()=>this.view.state?.camera),((e,t)=>this._cameraChangedHandler(e,t)),he.Z_),(0,he.YP)((()=>this.view.stationary),(()=>this._stationaryChangedHandler()))]),this._frameTask=(0,de.A)({update:e=>this._frame(e)}),this._scheduleTask=this._scheduler.registerTask(nt.T8.RESOURCE_CONTROLLER)}destroy(){this._handles=(0,I.SC)(this._handles),this._scheduleTask.remove(),this._frameTask=(0,I.hw)(this._frameTask),this._streamDataLoader=(0,I.SC)(this._streamDataLoader),this._memoryController=(0,I.SC)(this._memoryController),this._scheduler=(0,I.SC)(this._scheduler)}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._scheduleTask?.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(e,t,i){return this._scheduleTask.schedule(e,t,i)}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(i,r,s)=>t.request(i,r,e,s),get busy(){return!t.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step((0,Ys.D9)(e.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=nt.ZM.ANIMATING:this.view.interacting?this._state=nt.ZM.INTERACTING:(this._state===nt.ZM.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=r?this._state=nt.ZM.INTERACTING:this._state=nt.ZM.IDLE)}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e),state:this._state}}};(0,t._)([(0,m.Cb)({constructOnly:!0})],i.prototype,"view",void 0),(0,t._)([(0,m.Cb)()],i.prototype,"_scheduler",void 0),(0,t._)([(0,m.Cb)()],i.prototype,"_memoryController",void 0),(0,t._)([(0,m.Cb)()],i.prototype,"_streamDataLoader",void 0),(0,t._)([(0,m.Cb)()],i.prototype,"_scheduleTask",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],i.prototype,"updating",null),i=(0,t._)([(0,y.j)("esri.views.3d.support.ResourceController")],i),e.ResourceController=i;const r=300}(Fg||(Fg={}));var kg=s(4745),Ug=s(13809);class Vg{constructor(e,t){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=(0,Ug.wP)(e)?t.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),function(e){return"performanceInfo"in e}(e)){const t=e.performanceInfo;this.displayedNumberOfFeatures=t.displayedNumberOfFeatures,this.maximumNumberOfFeatures=t.maximumNumberOfFeatures,this.totalNumberOfFeatures=t.totalNumberOfFeatures}}}class zg{constructor(e){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const t=e.resourceController.memoryController;this.totalMemory=t.maxMemory*kg.Y8.MEGABYTES,this.usedMemory=Math.round(t.usedMemory*this.totalMemory),this.quality=t.memoryFactor,this.load=e.resourceController.scheduler.load,this.terrainMemory=e.basemapTerrain?e.basemapTerrain.getUsedMemory():0;const i=e._stage&&e._stage.renderView&&e._stage.renderView.edgeView;this.edgesMemory=(0,I.pC)(i)?i.usedMemory:0,e.allLayerViews.items.forEach((t=>{(Pg(t)||(0,Ug.wP)(t))&&this.layerPerformanceInfos.push(new Vg(t,e))})),this.layerPerformanceInfos.sort(((e,t)=>t.memory-e.memory))}}var Bg=s(70984),Hg=s(44101);class jg extends ot{constructor(e,t,i,r){super(t,r),this._streamDataRequester=e,this._parameters=i}async fromUrl(e,t,i){(0,f.k_)(i);const r=(0,I.pC)(i)&&i.signal,s=this.makeUid(e,t);let n=this._textureRequests.get(s);if(!n){const i=new AbortController,r=this._streamDataRequester.request(e,"image",{uid:s,signal:i.signal});n={referenceCount:0,texture:null,textureAsync:null,abortController:i},this._textureRequests.set(s,n),n.textureAsync=r.then((async i=>{const r=this._createTexture(e,i,t);return n.texture=r,n.abortController=null,this._stage.add(r),await this._stage.load(r),{uid:s,texture:r,release:()=>this._release(s)}}),(e=>{throw n.abortController=null,e}))}return n.referenceCount++,new Promise(((e,t)=>{(0,f.fu)(r,(()=>{t((0,f.zE)())})),n.textureAsync.then(e,t)})).catch((e=>{throw this._release(s),e}))}_createTexture(e,t,i){const r={...this._parameters,powerOfTwoResizeMode:Bg.CE.PAD};if((0,F.zd)(e)){if(i||0===t.width&&0===t.height){const e=t.width?t.height/t.width:1;i=i||64,e>1?(t.width=Math.round(i/e),t.height=i):(t.width=i,t.height=Math.round(i*e))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(r.preMultiplyAlpha=!1)}return r.width=t.width,r.height=t.height,new Hg.x(t,r)}}class Gg{constructor(e){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=e.viewState,this.view=e.view,this.pointsOfInterest=e.pointsOfInterest,this.objectResourceCache=e.objectResourceCache,this.streamDataRequester=e.resourceController.createStreamDataRequester(Og.Bh.SYMBOLOGY),this.textures=new jg(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:Er.e8.CLAMP_TO_EDGE,t:Er.e8.CLAMP_TO_EDGE}},e.resourceController.scheduler);const t=(0,fr.Iu)(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=(0,Yd.Gw)(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=(0,Yd.n9)(e.viewingMode,t)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return(0,le.kB)();this.graphicsOwners.push(e);const t=(0,he.YP)((()=>e.layer?.screenSizePerspectiveEnabled),(()=>this._updateScreenSizePerspectiveEnabled()));return this._updateScreenSizePerspectiveEnabled(),(0,le.kB)((()=>{t.remove(),(0,v.e$)(this.graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()}))}_updateScreenSizePerspectiveEnabled(){const e=this.graphicsOwners.some((e=>!0===e.layer?.screenSizePerspectiveEnabled));if(e&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new Ae.Z;const e=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([(0,he.YP)((()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance),e,he.Z_),this.viewState.events.on("camera-projection-changed",e)]),this._updateScreenSizePerspectiveSettings()}else!e&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const e=this.pointsOfInterest;Wg.distance=e.centerOnSurfaceInfrequent.distance,Wg.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(Wg),this.screenSizePerspectiveSettingsLabels.update(Wg),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const Wg={distance:0,fovY:0};s(4905);var Zg=s(89542),qg=s(88283),$g=s(57770),Yg=s(60378),Xg=s(80419),Jg=s(69996);class Kg{constructor(e,t,i=""){this.graphics=e,this._symbol=new Yg.Z({symbolLayers:[new Xg.Z({material:{color:t},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Jg.Z({text:i,halo:{color:"white",size:1/.75},material:{color:t},size:12})]})}show(e,t){if((0,I.Wi)(t))return;this.hide();const i=new X.Z({x:e[0],y:e[1],z:e[2],spatialReference:t});this._graphic=new te.Z({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){(0,I.pC)(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let Qg=class extends O.Z{constructor(e){super(e),this.handles=new Ae.Z}destroy(){this.handles.destroy()}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Qg.prototype,"renderCoordsHelper",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Qg.prototype,"surface",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Qg.prototype,"state",void 0),Qg=(0,t._)([(0,y.j)("esri.views.3d.support.PointOfInterest")],Qg);const ey=Array;let ty=class extends Qg{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new $f.L({location:X.Z,renderLocation:ey},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=(0,me.c)(),this.tmpPoint=new X.Z}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add((0,he.on)((()=>this.map?.ground?.layers),"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=(0,dr.i)(e.eye,this.renderLocation);return Gu({renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}},t,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then((e=>this._updateSurfaceAltitude(e.geometry.z))).catch((e=>{(0,f.D_)(e)||this._updateSurfaceAltitude(0)})).catch((()=>{})).then((()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null})),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(iy,this._estimatedSurfaceAltitude,this._camera.eye),(0,dr.k)(this._get("renderLocation"),iy)||this._set("renderLocation",(0,dr.c)(this._propertiesPool.get("renderLocation"),iy))}};(0,t._)([(0,m.Cb)({constructOnly:!0})],ty.prototype,"scheduler",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],ty.prototype,"cache",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],ty.prototype,"task",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],ty.prototype,"cameraName",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ty.prototype,"location",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],ty.prototype,"map",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ty.prototype,"renderLocation",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ty.prototype,"scale",null),(0,t._)([(0,m.Cb)({readOnly:!0})],ty.prototype,"updating",null),ty=(0,t._)([(0,y.j)("esri.views.3d.support.CameraOnSurface")],ty);const iy=(0,me.c)(),ry=Array;let sy=class extends Qg{constructor(e){super(e),this._propertiesPool=new $f.L({location:X.Z,renderLocation:ry},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=(0,me.c)(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=(0,I.hw)(this._frameWorker),this._propertiesPool=(0,I.SC)(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=oy;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=ay;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&((0,dr.c)(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=(0,dr.i)(this._camera.eye,e):((0,dr.g)(e,this._camera.viewForward,this._get("distance")),(0,dr.a)(e,e,this._camera.eye)),(0,dr.k)(this._get("renderLocation"),e)||this._set("renderLocation",(0,dr.c)(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=(0,fr.Iu)(this.renderCoordsHelper.spatialReference).radius,s=r+e,n=(0,dr.p)(i.eye),o=n<s*s,a=(0,dr.i)(i.eye,t);if(o&&a>r/4){const e=s-Math.sqrt(n);return(0,dr.g)(t,i.viewForward,e),(0,dr.a)(t,t,i.eye),!0}}else{const e=this.surface.ready?this.surface.extent:null;(0,I.pC)(e)&&(0,_e.dH)(e,this.surface.spatialReference,ly,this.renderCoordsHelper.spatialReference)&&(t[0]=(0,$.uZ)(t[0],ly[0],ly[2]),t[1]=(0,$.uZ)(t[1],ly[1],ly[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==e)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(kd.Z.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=(0,dr.i)(i,e),s=(0,dr.i)(i,t);if(Math.abs(s-r)/r>ny)return!0}return!1}};(0,t._)([(0,m.Cb)({constructOnly:!0})],sy.prototype,"scheduler",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],sy.prototype,"task",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],sy.prototype,"cameraName",void 0),(0,t._)([(0,m.Cb)()],sy.prototype,"distance",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],sy.prototype,"estimateSurfaceAltitudeAtCenter",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],sy.prototype,"location",null),(0,t._)([(0,m.Cb)({readOnly:!0})],sy.prototype,"renderLocation",void 0),(0,t._)([(0,m.Cb)()],sy.prototype,"updating",void 0),sy=(0,t._)([(0,y.j)("esri.views.3d.support.CenterOnSurface")],sy);const ny=.05,oy=(0,me.c)(),ay=(0,me.c)(),ly=(0,ve.Ue)();class cy{constructor(e){this.handles=new Ae.Z,this.events=new P.Z,this.contentLayerViews=e.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",(e=>this._layerViewsChanged(e)))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(e){e.added.forEach((e=>{"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&this.handles.add(e.on("visible-geometry-changed",(()=>this._contentChanged())),e.uid)})),e.removed.forEach((e=>this.handles.remove(e.uid)))}_contentChanged(){this.events.emit("request-update",uy)}}const uy={},hy=Array;let dy=class extends Qg{constructor(e){super(e),this._propertiesPool=new $f.L({location:X.Z,renderLocation:hy},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([(0,he.YP)((()=>this.centerOnSurface.renderLocation),(()=>this.updateRenderLocation())),(0,he.YP)((()=>this.state.contentCamera),(()=>this.updateRenderLocation()))]),this.scheduler&&this.handles.add(this.scheduler.registerTask(nt.T8.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,py);const s=Math.max(0,(Math.acos((0,dr.e)(py,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!(0,dr.z)(e,t)){const e=this._propertiesPool.get("renderLocation");(0,dr.c)(e,t),this._set("renderLocation",e)}return}const n=1-(0,$.uZ)(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(my);const a=this._propertiesPool.get("renderLocation");(0,dr.h)(a,t,my,o),e&&(0,dr.z)(e,a)||this._set("renderLocation",a)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter((0,pe.J$)());if(i[1]=t.aboveGround?t.padding[el.N.BOTTOM]:t.fullHeight-t.padding[el.N.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,fy)){(0,dr.b)(fy,fy,t.eye);const i=(0,dr.n)(fy,fy);if(this.renderCoordsHelper.intersectManifold((0,mo.re)(t.eye,i),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};(0,t._)([(0,m.Cb)()],dy.prototype,"_dirty",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],dy.prototype,"scheduler",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],dy.prototype,"centerOnSurface",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],dy.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],dy.prototype,"updating",null),(0,t._)([(0,m.Cb)({readOnly:!0})],dy.prototype,"location",null),(0,t._)([(0,m.Cb)({readOnly:!0})],dy.prototype,"renderLocation",void 0),dy=(0,t._)([(0,y.j)("esri.views.3d.support.CenterOnSurface")],dy);const py=(0,me.c)(),fy=(0,me.c)(),my=(0,me.c)();let gy=class extends O.Z{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Ae.Z}get renderLocation(){if(!this.location)return null;const e=(0,me.c)();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([(0,he.YP)((()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent]),(()=>this._update())),(0,he.on)((()=>this.surface?.layers),"change",(()=>this._update()))]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||(0,I.Wi)(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=(0,ve.be)(this.surfaceView.extent),t=new X.Z({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then((e=>{this._updateController=null,this._set("location",e.geometry)})).catch((e=>{(0,f.D_)(e)||e&&"elevation-query:invalid-layer"===e.name||console.error("StableSurfaceCenter failed to update: ",e)}))):this._set("location",t)}};(0,t._)([(0,m.Cb)({constructOnly:!0})],gy.prototype,"view",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],gy.prototype,"cache",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,aliasOf:"view.map.ground"})],gy.prototype,"surface",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,aliasOf:"view.basemapTerrain"})],gy.prototype,"surfaceView",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],gy.prototype,"location",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],gy.prototype,"renderLocation",null),gy=(0,t._)([(0,y.j)("esri.views.3d.terrain.StableSurfaceCenter")],gy);let yy=class extends O.Z{constructor(){super(...arguments),this.handles=new Ae.Z,this._tileGeometryUpdateExtent=(0,ve.cS)(),this._tileGeometryUpdateSpatialReference=null,this.events=new P.Z,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",(e=>this._tileGeometryChanged(e))),this.scheduler.registerTask(nt.T8.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=(0,I.SC)(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",_y),(0,ve.cS)(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,(0,ve.jn)(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.camera.eye,r=wy,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,vy,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,by,t),vy[0]<by[0]?(r[0]=vy[0],r[2]=by[0]):(r[0]=by[0],r[2]=vy[0]),vy[1]<by[1]?(r[1]=vy[1],r[3]=by[1]):(r[1]=by[1],r[3]=vy[1]),(0,ve.kK)(r,e)}};(0,t._)([(0,m.Cb)({constructOnly:!0})],yy.prototype,"state",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],yy.prototype,"centerOnSurfaces",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],yy.prototype,"renderCoordsHelper",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],yy.prototype,"scheduler",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],yy.prototype,"surface",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],yy.prototype,"updating",void 0),yy=(0,t._)([(0,y.j)("esri.views.3d.support.SurfaceGeometryUpdates")],yy);const _y={},vy=(0,me.c)(),by=(0,me.c)(),wy=(0,ve.cS)();let xy=class extends O.Z{constructor(e){super(e),this._handles=new Ae.Z,this._tmpRay=(0,mo.Ue)(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new $f.L({renderPointOfView:Cy},this),this.renderPointOfView=(0,me.c)(),this._pois=new Array,this._debugCenters=new Map}initialize(){const{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=(0,No.Z8)(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Ym.eC.MIN,this._contentIntersector=(0,No.Z8)(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(0,I.Wg)(this.view.basemapTerrain?.elevationQueryCache),a={state:e,scheduler:n,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new sy({...a,task:nt.T8.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new sy({...a,task:nt.T8.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("contentCenterOnSurface",new sy({...a,task:nt.T8.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s,cameraName:"contentCamera"})),this._set("centerOnContent",new sy({...a,task:nt.T8.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new ty({...a,cache:o,task:nt.T8.POINT_OF_INTEREST_INFREQUENT,map:r})),this._set("contentCameraOnSurface",new ty({...a,cache:o,task:nt.T8.POINT_OF_INTEREST_INFREQUENT,map:r,cameraName:"contentCamera"})),this._set("surfaceGeometryUpdates",new yy({...a,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new cy({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new gy({cache:o,view:this.view})),this._set("focus",new dy({state:e,scheduler:n,surface:t,renderCoordsHelper:i,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(e,t)=>this._estimateSurfaceIntersectionAtRenderPoint(e,this.view.state.contentCamera,t)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new Kg(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new Kg(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new Kg(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new Kg(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new Kg(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new Kg(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new Kg(l,"green","Focus")),this._handles.add([(0,he.YP)((()=>e.camera),(e=>this._cameraChanged(e)),he.Z_),(0,he.YP)((()=>t.extent),(()=>this._updateCenterPointsOfInterest())),(0,he.gx)((()=>!t.updating),(()=>this._updateCenterPointsOfInterest()),he.Z_),(0,he.on)((()=>this.surfaceGeometryUpdates.events),"request-update",(()=>this._updateCenterPointsOfInterest())),(0,he.on)((()=>this.contentGeometryUpdates.events),"request-update",(()=>this._updateCenterOnContent())),(0,he.gx)((()=>kd.Z.SHOW_POI),(e=>this._setDebug(e)),he.nn)]),this._cameraChanged(this.view.state.camera);for(const e of this._pois)e.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some((e=>e.updating)))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return(0,I.Wi)(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Ty,Ey)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Ty):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if((0,I.Wi)(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=(0,dr.a)(Ty,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(Ty)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Ty)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=(0,Rl.eW)(t,e,Sy);if((0,I.Wi)(r))return null;const s=r.origin,n=(0,dr.a)(Ty,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;(0,dr.k)(this.renderPointOfView,t)||this._set("renderPointOfView",(0,dr.c)(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach((e=>e.hide())),void this._handles.remove("debug");for(const e of this._pois)this._handles.add((0,he.YP)((()=>e.renderLocation),(t=>this._debugCenters.get(e).show(t,e.renderCoordsHelper.spatialReference)),he.nn),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"centerOnContent",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"centerOnSurfaceFrequent",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"centerOnSurfaceInfrequent",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"contentCenterOnSurface",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"cameraOnSurface",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"contentCameraOnSurface",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"focus",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"renderPointOfView",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"surfaceOrigin",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"contentGeometryUpdates",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"surfaceGeometryUpdates",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],xy.prototype,"view",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],xy.prototype,"updating",null),xy=(0,t._)([(0,y.j)("esri.views.3d.support.PointsOfInterest")],xy);const Cy=Array,Ty=(0,me.c)(),Sy=(0,mo.Ue)(),Ey={exclude:new Set([Lc.cy])};var Ay=s(12478);class My{constructor(e){this.store=e}destroy(){this.store.destroy()}get(e){return this.store.get(e)}put(e,t){this.store.put(e,t,t.values.byteLength+256)}}var Oy=s(27299),Ry=s(54135),Py=s(57686);class Iy{constructor(e=0,t=0){this.min=e,this.max=t,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}}class Ly{constructor(e,t,i){this.type="elevation",this.samplerData=null,this.level=e[0],this.i=e[1],this.j=e[2],this.extent=t;const r=i.noDataValue,s=i.values;let n=1/0,o=-1/0,a=!0,l=!1;for(let e=0;e<s.length;e++){const t=s[e];t!==r?(n=t<n?t:n,o=t>o?t:o,a=!1):l=!0}a&&(n=0,o=0),o=o>-3e38?o:0,this.samplerData={pixelData:i.values,width:i.width,height:i.height,noDataValue:r,safeWidth:.99999999*(i.width-1),dx:(i.width-1)/(t[2]-t[0]),dy:(i.width-1)/(t[3]-t[1]),x0:t[0],y1:t[3]},this.bounds=[n,o],this.hasNoDataValues=l}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(e,t,i,r){r.min=1/0,r.max=-1/0,r.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return r;const n=2**s;if(Math.floor(t/n)!==this.i||Math.floor(i/n)!==this.j)return r;let o=1/0,a=-1/0;const l=this.samplerData.width,c=this.samplerData.pixelData,u=.5*Ne.$7;let h=(l-1)/n,d=(i-this.j*n)*h,p=(t-this.i*n)*h;if(h<1){const e=Math.floor(d),t=Math.floor(p),i=e+t*l,s=c[i],n=c[i+1],o=c[i+l],a=c[i+l+1];if(s+n+o+a<u){const i=d-e,l=p-t,c=(0,si.bX)(s,n,o,a,i,l),u=(0,si.bX)(s,n,o,a,i+h,l),f=(0,si.bX)(s,n,o,a,i,l+h),m=(0,si.bX)(s,n,o,a,i+h,l+h);return r.min=Math.min(c,u,f,m),r.max=Math.max(c,u,f,m),r}d=e,p=t,h=1}else d=Math.floor(d),p=Math.floor(p),h=Math.ceil(h);for(let e=d;e<=d+h;e++)for(let t=p;t<=p+h;t++){const i=c[e+t*l];i<u?(o=Math.min(o,i),a=Math.max(a,i)):r.hasNoDataValues=!0}return r.min=o,r.max=a,r}}function Dy(e,t,i){if((0,I.Wi)(i))return null;for(const r of i){if(!r)continue;const i=r.safeWidth;let s=(0,$.uZ)(r.dy*(r.y1-t),0,i),n=(0,$.uZ)(r.dx*(e-r.x0),0,i);const o=Math.floor(s),a=Math.floor(n),l=r.width,c=o*l+a,u=r.pixelData,h=u[c],d=u[c+1],p=c+l,f=u[p],m=u[p+1];if(h+f+d+m<.5*Ne.$7){s-=o,n-=a;const e=h+(d-h)*n;return e+(f+(m-f)*n-e)*s}}return null}function Ny(e,t,i){const r=Dy(e,t,i);return(0,I.pC)(r)?r:0}let Fy=class extends O.Z{constructor(e){super(e),this._handles=new Ae.Z}initialize(){this._handles.add([this.layerViews.on("change",(()=>this.notifyChange("stencilEnabledExtents")))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach((t=>{const i=t.layer;if("IntegratedMeshLayer"===i.operationalLayerType&&null!=this.viewSpatialReference){const t=Vy(i.fullExtent,this.viewSpatialReference);(0,I.pC)(t)&&e.push((0,ve.oJ)(t))}})),e}};(0,t._)([(0,m.Cb)({readOnly:!0})],Fy.prototype,"layerViewsExtent",null),(0,t._)([(0,m.Cb)({readOnly:!0})],Fy.prototype,"tiledLayersExtent",null),(0,t._)([(0,m.Cb)({readOnly:!0})],Fy.prototype,"stencilEnabledExtents",null),(0,t._)([(0,m.Cb)()],Fy.prototype,"viewSpatialReference",void 0),(0,t._)([(0,m.Cb)()],Fy.prototype,"tilingScheme",void 0),(0,t._)([(0,m.Cb)()],Fy.prototype,"defaultTiledLayersExtent",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Fy.prototype,"layers",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Fy.prototype,"layerViews",void 0),Fy=(0,t._)([(0,y.j)("esri.views.3d.terrain.ExtentHelper")],Fy);let ky=class extends Fy{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?Ne.cy:Ne.Lz}};ky=(0,t._)([(0,y.j)("esri.views.3d.terrain.ExtentHelperGlobal")],ky);let Uy=class extends Fy{_computeLayerViewsExtent(){const e=(0,ve.cS)(),t=this.viewSpatialReference;this.layerViews.forEach((i=>{const r=i.layer;if(i.isResolved()&&("graphics"!==r.type||!r.internal)){const r=Vy("fullExtentInLocalViewSpatialReference"in i&&i.fullExtentInLocalViewSpatialReference||i.layer.fullExtent,t);(0,ve.jn)(e,r,e)}}));const i=(0,ve.sU)(e)?e:null,r=this._get("layerViewsExtent");return(0,ve.fS)(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=(0,ve.cS)();this.layers.forEach((r=>{if(r.loaded&&(0,Ce.iC)(r)){const s=(0,Ug.E_)(r,t,Nt.JY.Local);if((0,I.Wi)(s))return;const{tileInfo:n,fullExtent:o}=s;(0,I.pC)(n)&&(0,I.pC)(o)&&((0,Ug.x4)(r)||e.compatibleWith(n)&&o.spatialReference.equals(e.spatialReference))&&(0,ve.jn)(i,o,i)}})),(0,ve.jn)(i,this.defaultTiledLayersExtent,i);const r=(0,ve.sU)(i)?i:null,s=this._get("tiledLayersExtent");return(0,ve.fS)(r,s)?s:r}};function Vy(e,t){return(0,I.pC)(e)&&!e.spatialReference.equals(t)?(0,_e.fi)(e,e.spatialReference,t):e}Uy=(0,t._)([(0,y.j)("esri.views.3d.terrain.ExtentHelperLocal")],Uy);var zy,By=s(9812);!function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"}(zy||(zy={}));const Hy=[zy.ELEVATION,zy.MAP];var jy=s(62093),Gy=s(99608),Wy=s(58781),Zy=s(65075);function qy(){const e=globalThis.require?.modules;if(e){const t=Object.keys(e);for(const i of t)-1!==i.search(".glsl")&&delete e[i]}}const $y=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Yy,Xy=class extends O.Z{constructor(e){super(e),this._handles=new Ae.Z,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=(0,b.Z)("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||kd.Z.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return(0,I.pC)(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?(0,fr.Iu)(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new Gy.CB({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=(0,No.Z8)(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",(()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")})),this.renderer.events.on("has-water",(t=>e._stage?.renderView.setRenderParameters({hasOverlayWater:t}))),this.renderer.events.on("renders-occluded",(()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")})),this.renderer.events.on("content-changed",(()=>this.setDrawTexturesDirty())),this.renderer.events.on("textures-disposed",(()=>this.updateOverlayResult())),(0,he.YP)((()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location]),(()=>this.setPlacementDirty())),(0,he.YP)((()=>e.state?.pixelRatio),(()=>this.setPlacementDirty()),he.Z_),this.surface.on("elevation-change",(()=>this.setPlacementDirty())),e.on("resize",(()=>this.setPlacementDirty())),(0,de.A)({preRender:e=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(this.renderer.overlays,Bg.Xx.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(nt.T8.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",(e=>{this._updateOverlays(e,Bg.Xx.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Bg.Xx.BACKGROUND,e)}))])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),(0,I.pC)(Yy)&&(Yy.hide(),Yy=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;(0,I.pC)(e)&&(0,I.pC)(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new q.pE(-20037508.342787,20037508.342787):new q.pE(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Zy.S)}_updateDrapeSourceExtent(e){2===this.renderer.overlays.length&&(0,I.pC)(e.setDrapingExtent)&&(0,I.pC)(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){this.view._stage?.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,Bg.Xx.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const i=(0,jy.Jk)(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,i,Qy);const r=(0,ve.bf)(Qy.inner)/(0,ve.bf)(Qy.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(By.fu.INNER,Qy.inner,i,1*Qy.pixelRatioAdjustment,Qy.mapUnitsPerPixel),n=this._updateOverlay(By.fu.OUTER,Qy.outer,i,r*Qy.pixelRatioAdjustment,Qy.mapUnitsPerPixel);s!==r_.EXTENT&&n!==r_.EXTENT||(this._drapeSources.forEach((e=>this._updateDrapeSourceExtent(e))),this.surface.updateTileOverlayParams(t)),s===r_.NONE&&n===r_.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,i,r,s){if(0===this.renderer.overlays.length)return r_.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,function(e,t){const i=kd.Z.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=i&&Math.abs(t[1]-e[1])<=i&&Math.abs(t[2]-e[2])<=i&&Math.abs(t[3]-e[3])<=i}(t,n.extent)&&i===n.resolution)return o===s?r_.NONE:r_.RERENDER_ONLY;(0,ve.JG)(n.extent,t),n.resolution=i;const a=(0,ve.be)(n.extent);return n.renderLocalOrigin=(0,Wy.al)(a[0],a[1],0,"OV_"+this._latestOriginId++),r_.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[By.fu.INNER],r=this.renderer.overlays[By.fu.OUTER],s=(0,ve.jV)(e.extent,this.surface.extent,e_);this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,By.fu.INNER,t),this._setTileOverlayData(s,By.fu.OUTER,t)):(this._clearTileOverlayData(By.fu.INNER,t),this._clearTileOverlayData(By.fu.OUTER,t))}else this._clearTileOverlayData(By.fu.INNER,t),this._clearTileOverlayData(By.fu.OUTER,t)}overlayPixelSizeInMapUnits(e){if(0===this.renderer.overlays.length)return 0;const t=this.renderer.overlays[By.fu.INNER],i=this.renderer.overlays[By.fu.OUTER],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(0===this.renderer.overlays.length)return;const r=this.renderer.overlays[t].extent,s=(0,ve.bf)(r),n=(0,ve.Cb)(r);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);const t=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>t&&(o=t-(e[2]-e[0]))}i.setScale(t,(0,ve.bf)(e)/s,(0,ve.Cb)(e)/n),i.setOffset(t,(o-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){qy(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=(0,Ys.HA)(e.time-this._animationTimeLast);(t>=this.surface.view._stage.renderView.animationTimestep||(0,I.pC)(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,i_,t,i);if((0,I.Wi)(s))return!1;const n=s.origin,o=(0,dr.a)(Ky,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=(0,$.uZ)(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if("global"===this.view.viewingMode){const t=Ky;(0,fo.j)((0,fo.k)(fo.t,(0,fr.Iu)(this.view.spatialReference).radius+a),(0,mo.re)(e.eye,e.viewForward),t),(0,dr.b)(t,t,e.eye);const s=q.Q4.normalize((0,zr.cp)(e.viewForward,t,e.viewRight))/e.fovY+.5,n=s<=0||s>=1?.5:r;i=l?n*s:s+n*(1-s)}else{const t=.5*Math.PI-Math.acos(-e.viewForward[2]),s=Math.tan(t),n=(0,pr.f)(0,s,1,0),o=(0,Fd.t)(n,n,e.projectionMatrix)[1],a=(0,$.uZ)(.5+.5*o,0,1);i=1===a||0===a?.5:l?a*r:1-(1-a)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&(0,dr.x)(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=(0,me.c)();this._findHorizonBasedPointOfInterest(e,s)||(0,dr.c)(s,r);const n=Math.max(.1,(0,dr.i)(e.eye,s)),o=Yo(this.view.renderCoordsHelper,r,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);kd.Z.OVERLAY_SHOW_CENTER?((0,I.Wi)(Yy)&&(Yy=new Kg(this.view.graphics,"red")),Yy.show(s,this._renderSR)):(0,I.pC)(Yy)&&Yy.hide(),this._overlaySREqualsRenderSR||(0,_e.SH)(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&(0,I.pC)(this._spatialReference)&&this._spatialReference.isGeographic,u=c&&(0,I.pC)(this._spatialReference)?1/(0,fr.Iu)(this._spatialReference).metersPerDegree:1,h=e.perRenderPixelRatio*n*u;i.mapUnitsPerPixel=h/this._worldToPCSRatio;let d=t*h/2,p=!1,f=c?90:1/0;this._isSpherical&&(0,I.pC)(l)&&(0,I.pC)(this._spatialReference)&&(this._spatialReference.isWebMercator?(d/=Math.cos((0,gu.mZ)(s[1])),f=l[3]):(p=!0,d/=(0,fr.Iu)(this._spatialReference).metersPerDegree,f=90),d>=f&&(d=f,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let m=1;p&&(m=1/Math.max(.2,Math.cos(Math.abs((0,$.Vl)(s[1])))),d*m>180&&(m=180/d),i.mapUnitsPerPixel*=m);const g=Math.log(2)/12;d=Math.exp(Math.round(Math.log(d)/g)*g);const y=d*m,_=.5*t/(32*y),v=.5*t/(32*d);s[0]=Math.round(s[0]*_)/_,s[1]=Math.round(s[1]*v)/v;const b=i.inner;b[0]=s[0]-y,b[1]=s[1]-d,b[2]=s[0]+y,b[3]=s[1]+d,this._isSpherical&&this._shiftExtentToFitBounds(b,1/0,f);const w=i.outer;if(6*y>(0,ve.bf)(l))(0,ve.JG)(w,(0,I.Wg)(l));else if(a<=.25*Math.PI)w[0]=b[0]-y,w[1]=b[1]-d,w[2]=b[2]+y,w[3]=b[3]+d;else{(0,_e.SH)(e.eye,this._renderSR,Ky,this._spatialReference),(0,mr.g)(Jy,s,Ky);let t=-Math.atan2(Jy[1],Jy[0])+.125*Math.PI;t<0&&(t+=2*Math.PI);const i=Math.floor(t/(.25*Math.PI));(0,Fd.b)(Jy,$y[i],2*d),Jy[0]*=m,Jy[2]*=m,(0,Fd.a)(w,b,Jy)}if(this._isSpherical)w[0]=this._longitudeCyclical.clamp(w[0]),w[2]=this._longitudeCyclical.clamp(w[2]),w[1]=Math.max(w[1],-f),w[3]=Math.min(w[3],f);else{const e=(0,ve.jV)(b,l,e_),t=(0,ve.jV)(w,l,t_);(0,ve.r3)(e,t)&&(w[2]=w[0],w[3]=w[1])}const x=Math.abs(b[2]-b[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,x),i.pixelRatioAdjustment=i.mapUnitsPerPixel/x}_drawOverlayTextures(e,t,i=this.view.state.camera){if(0===e.length||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[By.fu.INNER],i),n=this._drawOverlay(e[By.fu.OUTER],i);s!==Bg.Yg.CHANGED&&n!==Bg.Yg.CHANGED||this.surface.updateTileOverlayParams(Bg.Xx.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),r?(this.surface.requestRender(t),t===Bg.Xx.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Bg.Xx.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!(0,I.Wi)(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):(0,ve.kK)(e,t))}_rectInsideRect(e,t){return!(0,I.Wi)(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:(0,ve.r3)(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),(0,ve.cv)(e,r,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};(0,t._)([(0,m.Cb)()],Xy.prototype,"_spatialReference",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],Xy.prototype,"running",null),(0,t._)([(0,m.Cb)()],Xy.prototype,"_placementDirty",void 0),(0,t._)([(0,m.Cb)()],Xy.prototype,"_contentUpdated",void 0),(0,t._)([(0,m.Cb)()],Xy.prototype,"_isSpherical",null),(0,t._)([(0,m.Cb)()],Xy.prototype,"_worldToPCSRatio",null),(0,t._)([(0,m.Cb)()],Xy.prototype,"renderer",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],Xy.prototype,"surface",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,aliasOf:"surface.suspended"})],Xy.prototype,"suspended",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],Xy.prototype,"updating",null),(0,t._)([(0,m.Cb)({type:Boolean})],Xy.prototype,"hasHighlights",null),(0,t._)([(0,m.Cb)({type:Boolean})],Xy.prototype,"rendersOccluded",null),Xy=(0,t._)([(0,y.j)("esri.views.3d.terrain.OverlayManager")],Xy);const Jy=(0,pr.c)(),Ky=(0,me.c)(),Qy={inner:(0,ve.Ue)(),outer:(0,ve.Ue)(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},e_=(0,ve.Ue)(),t_=(0,ve.Ue)(),i_=(0,mo.Ue)();var r_;!function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"}(r_||(r_={}));class s_{constructor(e,t){this._factoryCallback=e,this._lengthCallback=t,this._pool=new Map}acquire(e){if(!s_.test.disabled){const t=this._pool.get(e);if(t&&0!==t.length)return t.pop()}try{return this._factoryCallback(e)}catch(t){const i=window.performance&&window.performance.memory;let r="";throw i&&(r=`\n  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+t+r),t}}release(e){if(s_.test.disabled)return;const t=this._lengthCallback(e);let i=this._pool.get(t);i||(i=new Nd.Z({shrink:!0}),this._pool.set(t,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}s_.test={disabled:!1};class n_{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=(0,Rp.cS)(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=(0,pr.c)(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class o_{constructor(e,t,i,r,s){this._buf=e,this._localOrigin=t,this.offset0=i,this.stride=r,this.count=s}getVertexOffset(e){return(0,Ug.Fp)(0<=e&&e<this.count),this.offset0+this.stride*e}getVertex(e,t){const i=this.getVertexOffset(t)*Ne.Vs;e[0]=this._buf[i+0]+this._localOrigin[0],e[1]=this._buf[i+1]+this._localOrigin[1],e[2]=this._buf[i+2]+this._localOrigin[2]}getVertexZ(e){const t=this.getVertexOffset(e)*Ne.Vs;return this._buf[t+2]+this._localOrigin[2]}setVertex(e,t,i,r){const s=this.getVertexOffset(e)*Ne.Vs;this._buf[s+0]=t[0]-this._localOrigin[0],this._buf[s+1]=t[1]-this._localOrigin[1],this._buf[s+2]=t[2]-this._localOrigin[2],this._buf[s+3]=i,this._buf[s+4]=r}getNormal(e,t){const i=this.getVertexOffset(t)*Ne.Vs;e[0]=this._buf[i+5],e[1]=this._buf[i+6],e[2]=this._buf[i+7]}setVertexRawXYZUV(e,t,i,r,s,n){const o=this.getVertexOffset(e)*Ne.Vs;this._buf[o+0]=t,this._buf[o+1]=i,this._buf[o+2]=r,this._buf[o+3]=s,this._buf[o+4]=n}setVertexRawXYZUVN(e,t,i,r,s,n,o,a,l){const c=this.getVertexOffset(e)*Ne.Vs;this._buf[c+0]=t,this._buf[c+1]=i,this._buf[c+2]=r,this._buf[c+3]=s,this._buf[c+4]=n,this._buf[c+5]=o,this._buf[c+6]=a,this._buf[c+7]=l}setVertexRawNormal(e,t,i,r){const s=this.getVertexOffset(e)*Ne.Vs;this._buf[s+5]=t,this._buf[s+6]=i,this._buf[s+7]=r}getVertexRawNormal(e,t){const i=this.getVertexOffset(t)*Ne.Vs;e[0]=this._buf[i+5],e[1]=this._buf[i+6],e[2]=this._buf[i+7]}}const a_=(0,Us.U$)().vec3f(zs.T.POSITION).vec2f(zs.T.UV0).vec3f(zs.T.NORMAL),l_=new s_((e=>a_.createBuffer(e)),(e=>e.count));function c_(e){return l_.acquire(e)}class u_{constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null]}}class h_{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new u_,new u_,new u_,new u_],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class d_{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new h_}}class p_{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=(0,I.SC)(this._current),this._next=(0,I.SC)(this._next),this._waiting=(0,I.SC)(this._waiting),this._delayed=(0,I.SC)(this._delayed)}get current(){if((0,I.Wi)(this._current))return null;if(!this._isFadingEnabled){const e=this._delayed||this._waiting||this._next||this._current;e!==this._current&&(this._current=null,this.clear(),this._current=e)}let e=p_.test.fadeMoment;if((0,I.pC)(this._delayed)&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,f_.Immediate),this._delayed=null)),(0,I.pC)(this._next)){e=e||performance.now();const t=this._fadeDuration,i=(0,I.pC)(this._current)&&this._next.texture===this._current.texture,r=this._next.type!==By.Ns.FADING,s=e-this._fadeStart>=t;(i||r||s)&&((0,I.SC)(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if((0,I.Wi)(this._next))return 1;const e=p_.test.fadeMoment||performance.now(),t=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return t>i?0:1-t/i}get isFading(){return(0,I.pC)(this._next)||(0,I.pC)(this._delayed)}push(e,t=f_.Immediate){this._delayed=(0,I.SC)(this._delayed),this._push(e,t)}_push(e,t){if(this._isFadingEnabled||this.clear(),(0,I.Wi)(this._current))return void(this._current=e);const i=p_.test.fadeMoment||performance.now();return t!==f_.Immediate?(this._delayed=e,void(this._delayedTime=i+t)):(0,I.Wi)(this._next)?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void((0,I.Wi)(e)||((0,I.SC)(this._waiting),this._waiting=e))}get _fadeDuration(){return(0,I.Wi)(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const t=this._getFadeDuration();return e+t-e%t}get _isFadingEnabled(){return this._getFadeDuration()>0}}var f_;p_.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(f_||(f_={}));var m_=s(93011),g_=s(30220);class y_{get updating(){return!!this._tileRequested}init(e,t,i,r){this.tile=e,this._layerIdx=t,this._layerClass=i,this._suspended=r,this._tileLayerInfo=e.getLayerInfo(t,i),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,By.Ns.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return(0,I.pC)(e)?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,t=this._layerClass,i=this.tile.surface.layerViewByIndex(e,t),r=(0,Ug.RB)(i),{minLevel:s,maxLevel:n}=i.dataLevelRange,o=this._desiredMinLevelDelta,a=this._progressiveLevelModulo+o,l=this._scaleRangeEnabled?g_.yf:()=>!0;let c=this.tile;const u=c.level;let h;const d=this._tileLayerInfo.upsampleInfo,p=(0,I.pC)(d)?d.tile.level:-1,f=!!(0,I.pC)(d)&&p-u>=o,m=(0,I.U2)(r,"tilemapCache");for(;c&&l(c,r,!1)&&c.level>=s;){const i=c.level,r=u-i,l=c.layerInfo[t][e];if(l.data&&r>=o){(!f||i>p)&&this._setUpsampleTile(c),l.dataInvalidated&&(h=c);break}if(((0,I.Wi)(m)||"unavailable"!==m.getAvailability(c.lij[0],c.lij[1],c.lij[2]))&&i<=n&&!l.data&&!l.dataMissing&&(((0,I.Wi)(h)||c.level===s||i%Ne.Sx==0||u-h.level<o)&&(h=c),r>=a))break;c=c.parent}return(0,I.pC)(h)&&u-h.level<o&&this._tileLayerInfo.upsampleInfo&&(h=null),h}_findAncestorWithData(){const e=this.tile.vlevel,t=this._desiredMinLevelDelta;let i;for(let r=this.tile;r;r=r.parent)if(r.hasLayerData(this._layerIdx,this._layerClass)){if(e-r.level>=t)return r;i=r}return i}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,By.Ns.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}const __=new Error("Abstract method called on TileAgent"),v_=new class extends y_{get _desiredMinLevelDelta(){throw __}get _progressiveLevelModulo(){throw __}dispose(){}};class b_ extends y_{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return(0,Ne.L)(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class w_ extends y_{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Ne.Sx}}var x_=s(52003);class C_{constructor(){this.waitingAgents=new Nd.Z,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const t=T_.acquire();return t._init(e),t}release(){this.dispose(),S_.delete(this),T_.release(this)}dispose(){this.loadingAgent=(0,I.O3)(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=(0,Ug.z4)(this._data)}static prune(){T_.prune(0)}_init(e){this.waitingAgents.clear(),this._data=(0,Ug.z4)(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=(0,I.IM)(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){(0,I.pC)(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,t){if(e===t||(0,I.Wi)(t))this._unsetUpsampleInfo();else{if((0,I.Wi)(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===t)return;this._upsampleInfo.tile.unrefMapData()}t.refMapData(),(0,g_.QT)(e,t,this._upsampleInfo)}}get data(){return this._data}set data(e){(0,Ug.z4)(this._data),this._data=e}}const T_=new _f.Z(C_,null,(()=>{})),S_=new Map;class E_{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,0===this._refCount&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var A_,M_;(M_=A_||(A_={}))[M_.NONE=0]="NONE",M_[M_.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",M_[M_.SPLIT=2]="SPLIT",M_[M_.VSPLITMERGE=4]="VSPLITMERGE",M_[M_.MERGE=8]="MERGE",M_[M_.RENDERDATA=16]="RENDERDATA",M_[M_.GEOMETRY=32]="GEOMETRY",M_[M_.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",M_[M_.TEXTURE_FADING=128]="TEXTURE_FADING";const O_=(0,me.c)(),R_=(0,me.c)(),P_=(0,me.c)();class I_{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class L_{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=(0,ve.Ue)(),this._elevationBounds=(0,gr.a)(),this.layerInfo=[[],[]],this.extentInRadians=(0,ve.Ue)(),this.centerAtSeaLevel=(0,me.c)(),this._center=[(0,me.c)(),(0,fo.c)(),(0,me.c)()],this.up=(0,me.u)(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){F_.prune(0),k_.prune(0),C_.prune()}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[V_.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const e=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return e!==this._visible&&(this._visible=e,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setNeedsRender()),e}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===By.VB.ON){const e=this.level-this._surface.snapLevel;if(0===e)return!0;if(1===e)return!1}return this.isLeaf}init(e,t,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=(0,fr.Iu)(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[V_.MIDDLE][3]=0,this.vlevel=e?e[0]:0,t&&t.elevationBounds?(0,mr.c)(this._elevationBounds,t.elevationBounds):(0,mr.a)(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=t,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const e of Hy){const t=i.numLayers(e),r=this.layerInfo[e];for(const e of r)e.release();r.length=t;for(let i=0;i<t;i++)r[i]=C_.acquire(this._surface.upsampleInfoPool),e===zy.ELEVATION&&this.findElevationBoundsForLayer(i,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,Ne.HB)}release(){(0,Ug.wu)(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of Hy){for(const t of this.layerInfo[e])t.release();this.layerInfo[e].length=0}this._parent=null,this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const e=this.cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[zy.MAP].reduce(((e,t)=>e+(t instanceof Ry.i?t.memoryUsage:0)),this._mapTileMemory)}get cpuImageMemorySize(){const e=this._surface.tilingScheme.pixelSize;return e*e*4}_ensureUsedMemory(){if((0,I.pC)(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let e=0;for(const{data:t}of this.layerInfo[zy.MAP])t instanceof Ry.i?e+=this._getTerrainDataMemory(t):this._mapTileMemory+=this._getTerrainDataMemory(t);const t=this.cpuImageMemorySize;for(const e of this.layerInfo[zy.ELEVATION])this._usedMemory+=e.data?t:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=(0,js.un)(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+e),this._usedMemory}getUsedMemoryForLayer(e,t){const i=this.layerInfo[e][t];return i?.data?e===zy.MAP?this.isCached?0:this._getTerrainDataMemory(i.data):e===zy.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof E_?(0,js.un)(e.texture):e instanceof HTMLImageElement||e instanceof Dg.nN?this.cpuImageMemorySize:e instanceof Ry.i||e instanceof x_.H?e.memoryUsage:0}updateScreenDepth(e){const t=this._center[V_.MIDDLE],i=e,r=t[0],s=t[1],n=t[2],o=i[2]*r+i[6]*s+i[10]*n+i[14];this._screenDepth=o<0?0:o/(i[3]*r+i[7]*s+i[11]*n+i[15])}shouldSplit(e,t,i){if((0,I.pC)(e.frustum)&&(!this._intersectsClippingArea||!this._isVisible(e.frustum)))return A_.NONE;const r=this.level;(0,dr.b)(O_,this._center[V_.MIDDLE],t);let s=(0,dr.p)(O_),n=V_.MIDDLE;(0,dr.b)(R_,this._center[V_.TOP],t);const o=(0,dr.p)(R_);o<s&&(s=o,n=V_.TOP),(0,dr.b)(R_,this._center[V_.BOTTOM],t);const a=(0,dr.p)(R_);if(a<s&&(s=a,n=V_.BOTTOM),this._edgeLen2>s&&r<e.maxLod)return A_.SPLIT;const l=Math.sqrt(s),c=e.fovX*l*2,u=this._edgeLen/c,h=()=>{const t=r+Math.ceil(-Math.log2(e.relativeWidthLimit/u));return t!==this.vlevel?(this.vlevel=t,A_.VSPLITMERGE):A_.NONE_HIT_MAXLOD};if(i===By.VB.ON&&1==this._surface.snapLevel-r)return r>=e.maxLod?h():A_.SPLIT;const d=(0,dr.e)(this.up,O_),p=this._elevationBounds[1]-this._elevationBounds[0],f=p/this.edgeLen;if(e.aboveGround&&d>0&&f<.001&&d/l-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-f>0)return A_.NONE;if(u<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,A_.VSPLITMERGE):A_.NONE;if(r>=e.maxLod)return h();if(r>6){(0,dr.b)(R_,this._center[n],t),(0,dr.g)(P_,this.up,d),(0,dr.b)(P_,P_,R_);const i=(0,dr.p)(P_);if(i>this.radius*this.radius){(0,dr.g)(P_,P_,this.radius/Math.sqrt(i)),(0,dr.a)(P_,P_,this._center[n]),(0,dr.b)(P_,t,P_);const r=Math.min(1,(Math.abs((0,dr.e)(P_,this.up))+.5*p+this._curvatureHeight)/(0,dr.l)(P_)),s=.1/e.angledSplitBias,o=e.fovY*l*2;if(r*(this._edgeLen/o)<s*e.relativeHeightLimit)return A_.NONE}}return A_.SPLIT}setChildren(e,t,i,r){(0,Ug.wu)(!!(e&&t&&i&&r),"Null child passed"),this._children[0]=e,this._children[1]=t,this._children[2]=i,this._children[3]=r}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}prepareToLoad(e){this.refMapData();for(const e of Hy)this._createOrUpdateAgents(0,e);e.updateTileGeometryState(this)}load(e){this.prepareToLoad(e),this.loadPrepared(e)}loadPrepared(e){e.loadTile(this)}unload(e){e.unloadTile(this);for(const e of Hy){const t=this.layerInfo[e];for(const e of t)e.loadingAgent&&e.loadingAgent!==v_&&(N_(e.loadingAgent),e.loadingAgent=null),e.pendingUpdates=0}this.resetPendingUpdate(A_.GEOMETRY),this.resetPendingUpdate(A_.TEXTURE_NOFADING),this.resetPendingUpdate(A_.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[zy.MAP];for(const t of e)t.loadingAgent&&t.loadingAgent!==v_&&(N_(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if((0,ve.fS)(e,this._clippingArea))return!1;const t=this._intersectsClippingArea,i=this._isWithinClippingArea;(0,I.pC)(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const r=i&&this._isWithinClippingArea,s=!(i||t||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||r||s||this.setPendingUpdate(A_.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,t){return this.layerInfo[t][e]}hasLayerData(e,t){const i=this.layerInfo[t][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of Hy){const t=this.layerInfo[e];for(const e of t)if(e.loadingAgent&&e.loadingAgent!==v_&&e.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(A_.SPLIT)||e!==zy.ELEVATION&&!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===A_.SPLIT||e===A_.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,t,i){const r=this.layerInfo[t][e];if(r.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),t,e),!0;if(r.waitingAgents.push(i),r.data&&!r.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),t,e),i.dataArrived(this),!0;if(r.requestPromise)return!0;(0,I.IM)(r.requestAbort),r.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,t,r.requestAbort);if(!s)return r.requestAbort=null,!1;const n=()=>{r.requestPromise===s&&(r.requestPromise=null,r.requestAbort=null)};return r.requestPromise=s,s.then(n,n),!0}get isLeaf(){return null==this._children[0]}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){return this.hasLij(e)?this:this.isLeaf?null:this._children[0].findByLij(e)||this._children[1].findByLij(e)||this._children[2].findByLij(e)||this._children[3].findByLij(e)||null}distanceToSquared(e){return(0,dr.p)((0,dr.b)(P_,this._center[V_.MIDDLE],e))}containsPoint(e){const t=this.extent;return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[2]&&e[1]<=t[3]}unrequestLayerData(e,t,i){const r=this.layerInfo[t][e],s=r.waitingAgents,n=null!=s.removeUnordered(i);(0,Ug.wu)(n,"agent has not requested this piece of map data"),s.length<1&&(r.abortRequest(),this.setMemoryDirty())}dataArrived(e,t,i){const r=this.layerInfo[t][e];r.data=i,r.dataInvalidated=!1,r.waitingAgents.forAll((e=>e.dataArrived(this))),r.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,t,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${t}/${e} error ${i}`);const r=this.layerInfo[t][e];r.dataMissing=!0,r.waitingAgents.forAll((e=>e.dataMissing())),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,t){switch(e){case zy.MAP:return this._updateTexture(t);case zy.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===By.Ns.FADING?A_.TEXTURE_NOFADING:A_.TEXTURE_FADING),this.setPendingUpdate(e===By.Ns.FADING?A_.TEXTURE_FADING:A_.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(A_.GEOMETRY);for(const e of this.layerInfo[zy.ELEVATION])e.pendingUpdates|=A_.GEOMETRY}invalidateLayerData(e,t){this.layerInfo[t][e].invalidateSourceData(),this.restartAgents(t)}computeElevationBounds(){const e=this._elevationBounds;(0,mr.a)(e,Number.MAX_VALUE,-Number.MAX_VALUE);const t=this.layerInfo[zy.ELEVATION];let i=!0;for(const r of t)(0,I.pC)(r.elevationBounds)&&(e[0]=Math.min(e[0],r.elevationBounds.min),e[1]=Math.max(e[1],r.elevationBounds.max),r.elevationBounds.hasNoDataValues||(i=!1));i&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const e=this._elevationBounds,t=.5*(e[0]+e[1]);(0,dr.g)(P_,this.up,t),(0,dr.a)(this._center[V_.MIDDLE],this.centerAtSeaLevel,P_),(0,dr.g)(P_,this.up,e[0]),(0,dr.a)(this._center[V_.TOP],this.centerAtSeaLevel,P_),(0,dr.g)(P_,this.up,e[1]),(0,dr.a)(this._center[V_.BOTTOM],this.centerAtSeaLevel,P_)}findElevationBoundsForLayer(e,t){const i=this.layerInfo[zy.ELEVATION][e];if((0,I.pC)(i.elevationBounds)&&i.elevationBounds.level>=t)return;const r=this._surface.layerViewByIndex(e,zy.ELEVATION),s=(0,Ug.RB)(r);if(!(0,g_.yf)(this,s,!1))return;const n=U_;let o=!1;if(i.data){const e=i.data;n.min=e.bounds[0],n.max=e.bounds[1],n.hasNoDataValues=e.hasNoDataValues,n.level=this.level,o=!0}else{let t,i,r=0;for(let s=this._parent;s&&(!i||r<(0,Ne.L)(this.level))&&(r=this.vlevel-s.level,t=i||t,i=s.layerInfo[zy.ELEVATION][e].data,!(!i&&t&&r>=(0,Ne.L)(this.level)));s=s.parent);i=i||t,i&&(i.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],n),n.min!==1/0&&(n.level=i.level,o=!0))}o&&((0,I.Wi)(i.elevationBounds)&&(i.elevationBounds=new Iy),i.elevationBounds.copyFrom(n))}modifyLayers(e,t,i){const r=this.layerInfo[i];for(const e of r)e.loadingAgent&&e.loadingAgent!==v_&&(N_(e.loadingAgent),e.loadingAgent=null),e.waitingAgents.clear();for(let t=0;t<r.length;++t)void 0===e[t]&&r[t].release();const s=new Array(...r),n=t.length;r.length=n;for(let e=0;e<n;e++){const i=t[e];r[e]=i>-1?s[i]:C_.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,By.Ns.FADING))}updateAgents(e){if(this.renderData){const t=this.layerInfo[e];for(const e of t)e.loadingAgent===v_&&(e.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of Hy){const t=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==v_&&(i.loadingAgent.setSuspension(t),i.loadingAgent===v_&&this.updateRenderData(e,By.Ns.FADING))}}removeLayerAgent(e,t){const i=this.layerInfo[t][e];i.loadingAgent&&i.loadingAgent!==v_&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,t){const i=this.layerInfo[t][e];i.loadingAgent=v_,!i.data&&(0,I.Wi)(i.upsampleInfo)&&this._createOrUpdateAgents(e+1,t)}_createOrUpdateAgents(e,t){const i=this.layerInfo[t];if(0===i.length)return;const r=(()=>{for(let r=e;r<i.length;++r){const e=this._surface.layerViewByIndex(r,t);if((0,Ug.TK)(e)&&"normal"!==e.layer.blendMode)return!0}return!1})(),s=this._isSuspended(t);for(let n=e;n<i.length;++n){const e=i[n];let o=!1;const a=this._surface.layerViewByIndex(n,t),l=(0,Ug.RB)(a);if(e.loadingAgent?(0,g_.yf)(this,l,!1)?(e.loadingAgent!==v_&&e.loadingAgent.setSuspension(s),e.loadingAgent!==v_&&(o=e.loadingAgent.update())):e.dispose():(0,g_.yf)(this,l,!1)&&(e.loadingAgent=D_(this,n,t,s),o=e.loadingAgent.startLoading(),o?e.loadingAgent===v_&&this.setPendingUpdate(A_.GEOMETRY):(N_(e.loadingAgent),e.loadingAgent=v_)),e.loadingAgent===v_&&this.updateRenderData(t,By.Ns.FADING),!r&&o&&a.isOpaque)return}}_isWithinExtent(e){const t=this.extent;return t[0]>=e[0]&&e[2]>=t[2]&&t[1]>=e[1]&&e[3]>=t[3]}intersectsExtent(e){const t=this.extent;return t[2]>=e[0]&&e[2]>=t[0]&&t[3]>=e[1]&&e[3]>=t[1]}getElevationBasedVerticesPerSide(e){const t=this.vlevel-this.level,i=Math.max(this.level-e,(0,Ne.L)(this.level)-t);return(0,$.uZ)(1+(this.maxTesselation>>i),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(e,t){if(!e)return null;const i=this.surface.rootTiles;if((0,I.pC)(i))for(const r of i)if(z_(r,e)){let i=r,s=e[0]-i.level-1;for(;s>=0&&!i.isLeaf&&!t(i);){const t=e[1]>>s&1,r=e[2]>>s&1;i=i.children[2*t+r],s--}return t(i)?i:null}return null}findNeighborTile(e,t){const i=this.lij,r=this.getNeighborLIJ(i,e);return r?function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}(i,r)?t(this)?this:null:this._findLIJ(r,t):null}findCorner(e,t){const i=e===By.Xo.NORTH_EAST?1:e===By.Xo.NORTH_WEST?0:e===By.Xo.SOUTH_WEST?2:3;let r=this;for(;!(r.isLeaf||t&&t(r));)r=r.children[i];return r}findNeighborCornerTileExact(e,t){return this.findNeighborTile(e,(e=>t(e)||e.level===this.level))?.findCorner((0,Ug.$v)(e),t)}forAllSubtreeOnSide(e,t){const i=e===By.Xo.NORTH?[0,1]:e===By.Xo.NORTH_EAST?[1]:e===By.Xo.EAST?[1,3]:e===By.Xo.SOUTH_EAST?[3]:e===By.Xo.SOUTH?[2,3]:e===By.Xo.SOUTH_WEST?[2]:e===By.Xo.WEST?[0,2]:[0],r=e=>{t(e)||e.isLeaf||i.forEach((t=>r(e.children[t])))};r(this)}forallNeighbors(e){Ug.cA.forEach((t=>this.findNeighborCornerTileExact(t,e))),Ug.OC.forEach((t=>this.findNeighborTile(t,(t=>t.level===this.level||e(t)))?.forAllSubtreeOnSide((0,Ug._F)(t),e)))}getNeighborEdgeStartVertexIndex(e,t){const i=t??this.findNeighborTile(Ug.OC[e],(e=>e.isLoaded));if(!i||!this.isLoaded||!i.isLoaded)return 0;const r=this.level-i.level;if(0===r)return 0;const s=2**r,n=1==(1&e),o=n?0:1,a=i.lij[o+1]*s,l=this.lij[o+1]-a;return n?s-1-l:l}_updateNeighborsWithChangedEdgeResolution(){for(let e=0;e<4;++e)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[e]){const t=Ug.OC[e],i=this.findNeighborTile(t,(e=>e.isLoaded||e.level===this.level));if(!i)continue;if(!i.isLoaded){(0,Ug.Fp)(!i.isLeaf);const r=(e+2)%4,s=(0,Ug._F)(t);i.forAllSubtreeOnSide(s,(e=>e.isLoaded?(e.updateEdgeAfterResolutionChange(r),!0):((0,Ug.Fp)(!e.isLeaf),!1)))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[e]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(e=this.level){this.forEachLoadedNeighbor((e=>this._updateNeighbor(e))),Ug.OC.forEach((t=>{this.findNeighborTile(t,(t=>t.isLoaded&&t.level<e))?.updateNeighborsWithChangedEdgeResolution()}))}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(e){this.renderData.updateEdgeAfterResolutionChange(e)}forEachLoadedNeighbor(e){const t=this.level,i=e=>e.level===t||e.isLoaded;Ug.OC.forEach(((t,r)=>{const s=this.findNeighborTile(t,i);null!=s&&s!==this&&s.forAllSubtreeOnSide((0,Ug._F)(t),(t=>!!t.isLoaded&&(e(t),!0)));const n=this.renderData?.geometryState?.neighborData;n&&(n.modifiedEdgeResolutions[r]=!1)})),Ug.cA.forEach((t=>{const r=this.findNeighborTile(t,i)?.findCorner((0,Ug.$v)(t),(e=>e.isLoaded));(0,Ug.Fp)(!r||function(e,t,i){return!(0,I.Wi)(e)&&!(0,I.Wi)(t)&&t!==e&&(e.level>=t.level?H_(e,t,i):H_(t,e,(0,Ug.$v)(i)))}(this,r,t)),r?.isLoaded&&e(r)}))}_updateNeighbor(e){e?.isLoaded&&e.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(e,t){const i=(0,Ug.Mw)(t)?-1:(0,Ug.uv)(t)?1:0,r=(0,Ug.OD)(t)?-1:(0,Ug.Eu)(t)?1:0,s=[e[0],e[1]+i,e[2]+r];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return 0===this.lij[2]}get isNorthEnd(){return 0===this.lij[1]}get isSouthEnd(){return this.extent[1]+m_.E>=this.surface.extent[1]}compareLIJs(e){const t=this.lij,i=t[0],r=e[0];if(i===r)return[t,e];const s=i-r;if(s<0){const i=2**-s;return[[r,t[1]*i,t[2]*i],e]}{const r=2**s;return[t,[i,e[1]*r,e[2]*r]]}}checkGeometryWaterproofness(){Ug.XJ&&((0,Ug.Fp)(this.isLoaded),this.renderData.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const t=this.extent,i=this.surface.rootTilesExtent,r=.25*(t[2]-t[0]);if((0,Ug.Mw)(e)&&t[3]+r>=i[3])return!1;if((0,Ug.uv)(e)&&t[1]-r<=i[1])return!1;const s=this.surface.isGlobal;return!(!s&&(0,Ug.OD)(e)&&t[0]-r<=i[0]||!s&&(0,Ug.Eu)(e)&&t[2]+r>=i[2])}}function D_(e,t,i,r){const s=i===zy.ELEVATION?k_.acquire():F_.acquire();return s.init(e,t,i,r),s}function N_(e){e.dispose(),e instanceof b_?k_.release(e):e instanceof w_&&F_.release(e)}const F_=new _f.Z(w_),k_=new _f.Z(b_),U_=new Iy;var V_;function z_(e,t){const i=e.level,r=t[0];if(i>r)return!1;const s=r-i,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function B_(e,t,i){return Math.abs(e-t)<=i}function H_(e,t,i){(0,Ug.Fp)(e.level>=t.level);const r=(0,Ug._0)(i),s=(0,Ug.wt)(i),n=e.extent,o=t.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),u=B_(a[0],l[0],c)||e.surface.isGlobal&&B_(a[0],-l[0],c),h=B_(a[1],l[1],c);return!(!u||!h)||e.level!==t.level&&!(!u&&!h)&&(u?j_(o[1],o[3],n[1],n[3],c):j_(o[0],o[2],n[0],n[2],c))}function j_(e,t,i,r,s=m_.E){return e-s<=i&&i<=r&&r<=t+s}!function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"}(V_||(V_={}));class G_{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,t,i){this._scales[2*e]=t,this._scales[2*e+1]=i}setOffset(e,t,i){this._offsets[2*e]=t,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}}class W_{constructor(){this.geometryInfo=new n_,this.intersectionData=null,this.geometryState=null,this._textureRef=new p_((()=>this.tile.surface.textureFadeDuration)),this.overlay=new G_,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get tile(){return this._tile}init(e){this._tile=e,this.clear();const t=this.geometryInfo;t.indices=null,t.vertexAttributes=null,(0,Rp.cS)(t.boundingBox),t.indexCount=0,t.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new d_,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometryIfChanged(e,t){const i=this.updateGeometryStateAndPrepareForGeometryGeneration(t);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(i,e)}updateNeighborDataAndGeometryIfNeeded(e=!1,t=this.vao.context){const i=this._updateNeighborData(),r=e||this._geometryStateChangedSinceLastUpdate||i;return r&&(this._updateGeometry(t),this._geometryStateChangedSinceLastUpdate=!1),r}_calculateEdgeResolution(e,t){const i=this.tile,r=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const t=i.surface.extent;if((0,I.pC)(t)&&(0===e&&i.extent[3]>t[3]||1===e&&i.extent[2]>t[2]||2===e&&i.extent[1]<t[1]||3===e&&i.extent[0]<t[0]))return r}const s=i.level,n=Ug.OC[e],o=t||i.findNeighborTile(n,(e=>e.isLoaded||e.level===s));if(!o||o.isLeaf&&!o.isLoaded)return(0,Ug.Fp)((0,I.Wi)(i.surface?.rootTiles)||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(n)),r;if(o.isLoaded){const t=o,i=t.renderData.geometryState,n=s-t.level;if(0===n){const e=i.numVerticesPerSide-1;return Math.max(e,r)}const a=2**n,l=i.neighborData.edgeResolutions[(e+2)%4]/a;return Math.max(1,l)}(0,Ug.Fp)(!o.isLeaf);let a=r;return o.forAllSubtreeOnSide((0,Ug._F)(n),(e=>e===i||(e.isLoaded?(a=Math.max(a,2**(e.level-s)),!0):((0,Ug.Fp)(!e.isLeaf),!1)))),a}_updateNeighborData(){const e=this.tile,t=t=>t.isLoaded||t.level===e.level,i=e=>e.isLoaded,r=[null,null,null,null],s=[null,null,null,null];(()=>{for(let i=0;i<4;++i){const n=e.findNeighborTile(Ug.OC[i],t);r[i]=n,s[i]=n?.isLoaded?n:null}})();const n=[null,null,null,null];(()=>{for(let t=0;t<4;++t)n[t]=e.findNeighborTile(Ug.cA[t],i)})();const o=this.geometryState.neighborData;let a=!1;return(()=>{for(let t=0;t<4;++t){const i=o.edgeResolutions[t],s=r[t],n=this._calculateEdgeResolution(t,s);o.edgeResolutions[t]=n,i!==n&&(a=!0,this._edgeResolutionChanged=!0,s&&s!==e&&!s.isLoaded&&s.level===e.level&&(o.modifiedEdgeResolutions[t]=!0))}})(),(()=>{const t=o.cornerNeighborData,i=(i,r)=>{const s=t[i],n=s.cornerTiles;for(let t=0;t<4;++t){const i=Ug.cA[t],s=r[t]?.findCorner((0,Ug.$v)(i),(t=>t?.isLoaded||t===e));n[t]=s}const o=((t,i)=>{const r=t.reduce(((e,t)=>Math.min(e,t?.level??1/0)),1/0);for(let r=0;r<4;++r){const s=t[(r+3)%4],n=t[r];if(s&&s.level<e.level&&s===n){const t=s,n=1==(1&r),o=(e.getNeighborEdgeStartVertexIndex(r,t)+(0===i||1===i&&!n||3===i&&n?1:0))/2**(e.level-t.level);return Ny(n?0===i||1===i?t.extent[0]:t.extent[2]:(0,$.t7)(t.extent[0],t.extent[2],o),n?(0,$.t7)(t.extent[1],t.extent[3],o):0===i||3===i?t.extent[1]:t.extent[3],t.renderData.geometryState.samplerData)}}let s=0,n=0;for(let e=0;e<4;++e){const i=t[e];if(i&&i.level===r){const t=0===e||1===e,r=0===e||3===e,o=i.extent;n+=Ny(o[t?0:2],o[r?1:3],i.renderData?.geometryState?.samplerData),s++}}return s?n/s:0})(n,i);return s.elevation!==o&&(s.elevation=o,!0)};for(let t=0;t<4;++t){const r=n[t],o=s[t],l=[r,s[(t+1)%4],e,o],c=l.map(((e,i)=>l[(i+4-t)%4]));i(t,c)&&(this._cornerElevationChanged=!0,a=!0)}})(),(()=>{const t=(t,i)=>{if(!t?.isLoaded||t.lij[0]>e.lij[0])return null;const r=t.renderData.geometryState;return{neighborSamplerData:r.samplerData,neighborEdgeOverlapResolution:r.neighborData.edgeResolutions[i+2],version:r.samplerDataVersion,neighborVerticesPerSide:r.numVerticesPerSide,neighborTile:t}},i=o.edgeNeighbours;for(let r=0;r<4;++r){const n=s[r];n&&((0,Ug.Fp)(n?.isLoaded),(0,Ug.Fp)(n?.lij[0]<=e.lij[0]));const o=i[r],l=o?.version,c=t(n,r),u=c?.version??null,h=null!=o!=(null!=c),d=o&&c&&l!==u,p=o&&c&&o?.neighborTile!==c?.neighborTile,f=h||d||p;this._edgeNeighborChanged||(this._edgeNeighborChanged=f),a||(a=f),!f&&l||(i[r]=c)}})(),a}updateEdgeAfterResolutionChange(e){const t=this._calculateEdgeResolution(e),i=this.geometryState.neighborData.edgeResolutions,r=i[e];(0,Ug.Fp)((this.geometryState.neighborData.edgeNeighbours[e]?.neighborTile.level??0)<=this.tile.level),t!==r&&(i[e]=t,this._edgeResolutionChanged=!0,W_.deferTileNeighborUpdate?W_.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))}_updateGeometry(e){this.intersectionData=null;const t=this.tile,i=t.lij,r=W_.updatedGeometryTiles.get(i)||0;W_.updatedGeometryTiles.set(i,r+1);const s=this._vao,n=this.geometryInfo.vertexAttributes,o=!s||!n||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,a=!o&&this._edgeNeighborChanged,l=!a&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,o?(this._releaseGeometry(),this._createGeometry(e)):a?t.updateEdgeElevations():l?t.updateCornerElevations():console.warn("Update for no reason?")}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(e,t){return(0,I.pC)(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),(0,I.Wi)(this._texture)&&(this._texture=t(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){(0,I.pC)(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(e){const t=this._getElevationInfo(),i=t.samplerData?this.tile.getElevationBasedVerticesPerSide(t.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),r=Math.max(i,5);let s=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(s=null);const n=this.geometryState;let o=!1;return n.numVerticesPerSide!==r&&(this._numVerticesPerSideChanged=!0,n.numVerticesPerSide=r,n.samplerDataVersion++,o=!0),t.changed&&(this._samplerDataChanged=!0,n.samplerData=t.samplerData,n.samplerDataVersion++,o=!0),(0,v.fS)(n.clippingArea,s)||(this._clippingAreaChanged=!0,n.clippingArea=s,o=!0),n.wireframe!==e&&(this._wireframeChanged=!0,n.wireframe=e,o=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=o),this._hasGeometry=!0,o}_createGeometry(e){this.tile.createGeometry();const t=this.geometryInfo.vertexAttributes,i=this.geometryInfo.indices,r=e.gl;this._vao=new Gs.U(e,Tr.i,{geometry:(0,ks.K)(t.layout)},{geometry:Bs.f.createVertex(e,r.STATIC_DRAW,t.buffer)},Bs.f.createIndex(e,r.STATIC_DRAW,i)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,function(e){l_.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(e,t=f_.Immediate){(0,I.pC)(e)&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,t)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,t=this.tile.layerInfo[zy.ELEVATION],i=t.length;let r=new Array(i),s=0,n=0,o=!1;for(let a=0;a<i;a++){const i=t[a];if((0,I.pC)(i.upsampleInfo)){const t=i.upsampleInfo.tile,l=t.layerInfo[zy.ELEVATION][a].data,c=l&&l.samplerData;e&&e[s]===c||(o=!0),r[s++]=c,n=Math.max(n,t.lij[0])}else if(i.data){const t=this.tile.surface.layerViewByIndex(a,zy.ELEVATION);if((0,g_.yf)(this.tile,t.layer,!1)){const t=i.data;e&&e[s]===t.samplerData||(o=!0),r[s++]=t.samplerData,n=this.tile.level}}}return(0,I.pC)(e)&&e.length!==s&&(o=!0),s>0?r.length=s:r=null,{changed:o,samplerData:r,maxTileLevel:n}}get estimatedGeometryMemoryUsage(){const e=(0,I.R2)(this.intersectionData,0,(e=>e.estimatedMemoryUsage));return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+e}get textureDescriptor(){return(0,I.pC)(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:null!=this._texture}}checkGeometryWaterproofness(){}}function Z_(e,t,i,r,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,r[1])-Math.max(1,r[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=Ug.OC.map(((e,i)=>0===i&&s[1]<t-2||1===i&&r[1]<t-2||2===i&&s[0]>1||3===i&&r[0]>1)),u=3*(l+e.outerEdges.reduce(((e,t,i)=>e+(c[i]?0:o-2+t.count-1)),0)+i.reduce(((e,t)=>e+o*(2*(t.latitudeResolution-1)+1)),0))*(n?2:1),h=new(a>65536?Uint32Array:Uint16Array)(u);let d=0;const p=n?(e,t,i)=>{h[d++]=e,h[d++]=t,h[d++]=t,h[d++]=i,h[d++]=i,h[d++]=e}:(e,t,i)=>{h[d++]=e,h[d++]=t,h[d++]=i},f=t-2,m=o-2;(()=>{for(let e=Math.max(s[0],1)-1;e<Math.min(s[1],t-2)-1;++e)for(let i=Math.max(r[0],1)-1;i<Math.min(r[1],t-2)-1;++i){const t=e*f+i,r=t+1,s=r+f,n=s-1;p(t,r,s),p(s,n,t)}})(),(()=>{for(let t=0;t<4;++t){if(c[t])continue;const i=e.outerEdges[t],r=e.innerEdges[t];let s=0,n=0;const a=i.count,l=r.count;i.count;const u=1===t||2===t?(e,t,i)=>p(e,t,i):(e,t,i)=>p(e,i,t);for(;s<a-1||n<l-1;){const e=r.getVertexOffset(n),t=i.getVertexOffset(s),c=s<a-1,h=n<l-1,d=c?0+o*(s+.5)/(a-1):0,p=h?1+m*(n+.5)/(l-1):0;c&&(!h||d<=p)?(++s,u(e,t,i.getVertexOffset(s))):(++n,u(e,t,r.getVertexOffset(n)))}}})();i.forEach((i=>{let r=e.outerEdges[i.connectedOuterEdgeOffset].offset0;for(let e=0;e<i.latitudeResolution;++e){const s=0===e?i.rowOffset:r+t;for(let t=0;t<o;t++)p(r,r+1,s+t),e<i.latitudeResolution-1&&p(r+1,s+t+1,s+t),++r;r=s}})),e.indices=h,e.indexCount=u}function q_(e,t){const i=e.localOrigin,r=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,o=r.vertexAttributes.position.typedBuffer;let a=t;for(let e=0;e<4;++e){{const t=0===e||2===e,s=(0===e?n-1:0)*n+(1===e?n-1:0),a=(t?0:1)*n+(t?1:0);r.innerEdges[e]=new o_(o,i,s,a,n)}{const t=a,n=s[e]+1;r.outerEdges[e]=new o_(o,i,t,1,n),a+=n}}}function $_(e,t){K_(e,t),function(e,t){const i=e.geometryState.clippingArea,r=e.tile.extent,s=(0,I.pC)(i)&&(r[0]<i[0]||r[2]>i[2]||r[1]<i[1]||r[3]>i[3])?ov:nv;for(let i=0;i<4;++i)s(e,i,t)}(e,t),uv(e,t)}function Y_(e,t,i,r,s){const n=Math.cos(i),o=Math.sin(i),a=Math.sin(t),l=Math.cos(t),c=s+r;e[0]=l*n*c,e[1]=a*n*c,e[2]=o*c}function X_(e,t,i){return e?e=>function(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}(e,t):e=>function(e,t){return e*t}(e,i)}function J_(e){Q_(e,((t,i,r,s)=>function(e,t,i,r,s,n){const o=s[0===i?1:3];Y_(e,s[0===t?0:2],o,r,n)}(t,i,r,s,e.tile.extentInRadians,e.tile.ellipsoid.radius)))}function K_(e,t){const i=e.tile;(0,I.pC)(i.renderData.geometryState.clippingArea)?function(e,t){const i=e.geometryState,r=e.tile,s=r.extent,n=(0,I.Pt)(i.clippingArea,s),o=e.geometryInfo,a=o.boundingBox,l=o.outerEdges,c=i.neighborData.cornerNeighborData,u=o.uvOffsetAndScale[0],h=o.uvOffsetAndScale[1],d=o.uvOffsetAndScale[2],p=o.uvOffsetAndScale[3],f=d>0?1/d:1,m=p>0?1/p:1,g=-u*f,y=-h*m,_=r.surface.isWebMercatorOnPlateeCarree,v=X_(_,_?r.ellipsoid.radius:0,t),b=i.samplerData,w=i.neighborData.edgeNeighbours,x=e.localOrigin,C=(e,i,o,l,u)=>{const h=s[0]*(1-l)+s[2]*l,d=s[1]*(1-u)+s[3]*u,p=(0,$.uZ)(h,n[0],n[2]),_=(0,$.uZ)(d,n[1],n[3]),C=[_===s[3],p===s[2],_===s[1],p===s[0]],T=!C[3]&&!C[1]||!C[0]&&!C[2],S=T?C[0]&&(0,I.pC)(w[0])?w[0]:C[1]&&(0,I.pC)(w[1])?w[1]:C[2]&&(0,I.pC)(w[2])?w[2]:C[3]&&(0,I.pC)(w[3])?w[3]:null:null,E=T?S?S.neighborTile.level===r.level?.5*(Ny(p,_,b)+Ny(p,_,S.neighborSamplerData)):Ny(p,_,S.neighborSamplerData):Ny(p,_,b):c[o].elevation,A=p*t-x[0],M=v(_)-x[1],O=E-x[2];dv(A,M,O,a);const R=(0,$.uZ)(g+l*f,0,1),P=(0,$.uZ)(y+u*m,0,1);e.setVertexRawXYZUV(i,A,M,O,R,P)};for(let e=0;e<4;++e){const t=l[e];C(t,0,0===e?3:1===e?1:2,1===e?1:0,0===e?1:0);const i=2===e?1:3===e?3:0,r=3===e?0:1,s=2===e?0:1;C(t,t.count-1,i,r,s)}}(e,t):Q_(e,((r,s,n,o)=>function(e,t,i,r,s,n,o){const a=0===t?s[0]:s[2],l=0===i?s[1]:s[3],c=r;e[0]=a*n,e[1]=o(l),e[2]=c}(r,s,n,o,e.tile.extent,t,X_(i.surface.isWebMercatorOnPlateeCarree,i.ellipsoid.radius,t))))}function Q_(e,t){const i=e.geometryInfo,r=i.outerEdges,s=e.geometryState.neighborData.cornerNeighborData,n=i.boundingBox,o=e.localOrigin,a=(e,i,r,a,l)=>{t(gv,r,a,s[i].elevation);for(let e=0;e<3;++e)gv[e]-=o[e];dv(gv[0],gv[1],gv[2],n),e.setVertexRawXYZUV(l,gv[0],gv[1],gv[2],r,a)};for(let e=0;e<4;++e){const t=r[e];a(t,0===e?3:1===e?1:2,1===e?1:0,0===e?1:0,0),a(t,2===e?1:3===e?3:0,3===e?0:1,2===e?0:1,t.count-1)}}function ev(e){const t=e.vao,i=e.geometryInfo.vertexAttributes;t?.vertexBuffers?.geometry?.setSubData(i.position.typedBuffer)}function tv(e){J_(e);for(let t=0;t<4;++t)iv(e,t);cv(e)}function iv(e,t){const i=e.geometryState,r=i.neighborData,s=e.tile;s.level;const n=s.extent,o=n[2]-n[0],a=n[3]-n[1],l=s.extentInRadians,c=l[0];l[1];const u=l[2];l[3];const h=s.ellipsoid.radius,d=lv(e),p=r.edgeNeighbours[t],f=r.edgeResolutions[t],m=1===t||3===t,g=1===t?1:0,y=0===t?1:0,_=n[0]+g*o,v=n[1]+y*a,b=c*(1-g)+u*g,w=d(y),x=p?.neighborTile,C=s.level-(x?.level??s.level),T=2**C,S=f*T,E=(e=>{if(!e)return 0;const t=f,i=m?0:1,r=e.lij[i+1]*T,n=s.lij[i+1]-r;return(m?T-1-n:n)*t})(x),A=x?.extent,M=(t+2)%4,O=i.samplerData,R=x?.renderData?.geometryState?.samplerData,P=x&&0===C,I=P?(e,t,i,r)=>.5*(Ny(e,t,R)+Ny(i,r,O)):(e,t)=>Ny(e,t,R);let L=A?1===M?A[2]:A[0]:_,D=A?0===M?A[3]:A[1]:v;const N=x?m?(e,t,i)=>{const r=(E+e)/S;return D=A[1]*(1-r)+A[3]*r,I(L,D,t,i)}:(e,t,i)=>{const r=(E+e)/S;return L=A[0]*(1-r)+A[2]*r,I(L,D,t,i)}:(e,t,i)=>Ny(t,i,O),F=(e,t,i)=>N(e,t,i);let k=g,U=_,V=b,z=y,B=v,H=w,j=Math.sin(V),G=Math.cos(V),W=Math.cos(H),Z=Math.sin(H);const q=m?()=>d(z):()=>w,$=m?e=>{z=e,B=n[1]*(1-e)+n[3]*e,H=q(),W=Math.cos(H),Z=Math.sin(H)}:e=>{k=e,U=n[0]*(1-e)+n[2]*e,V=c*(1-k)+u*k,j=Math.sin(V),G=Math.cos(V)},Y=e.geometryInfo,X=Y.boundingBox,J=Y.vertexAttributes,K=J.position.typedBuffer,Q=J.uv0.typedBuffer,ee=J.normal.typedBuffer,te=Y.outerEdges[t];let ie=te.getVertexOffset(1);const re=f+1,se=e.localOrigin,ne=se[0],oe=se[1],ae=se[2],le=s.surface.shadingEnabled,ce=1===t?-1:3===t?1:0,ue=0===t?-1:2===t?1:0,he=o/f,de=ce*he,pe=ue*he,fe=ce*(1/f),ge=ue*(1/f),ye=e=>{(0,dr.v)(_v,e,wv),(0,dr.f)(vv,_v,Cv),(0,dr.f)(bv,vv,_v),(0,dr.a)(Tv,Tv,bv)};for(let e=1;e<re-1;++e){$(e/f);const t=F(e,U,B),i=h+t,r=G*W*i,s=j*W*i,n=Z*i,o=r-ne,a=s-oe,l=n-ae;dv(o,a,l,X);const p=Ne.Vs*ie;if(K[p+0]=o,K[p+1]=a,K[p+2]=l,Q[p+0]=k,Q[p+1]=z,le){(0,dr.s)(Tv,0,0,0),(0,dr.s)(wv,r,s,n),(0,dr.n)(Cv,wv);const e=(e,t)=>{const i=Ny(U+e*de,B+e*pe,t),r=h+i,s=k+e*fe,n=c*(1-s)+u*s,o=Math.sin(n),a=Math.cos(n),l=d(z+e*ge),p=Math.sin(l),f=Math.cos(l),m=(0,me.f)(a*f*r,o*f*r,p*r);ye(m)};x&&e(-1,R),x&&!P||e(1,O),ee[p+0]=Tv[0],ee[p+1]=Tv[1],ee[p+2]=Tv[2]}++ie}if(le)for(let e=1;e<re-1;++e)te.getVertexRawNormal(Tv,e),te.getVertex(wv,e),(0,dr.n)(Cv,wv),te.getVertex(yv,e-1),ye(yv),te.getVertex(yv,e+1),ye(yv),(0,dr.n)(Tv,Tv),te.setVertexRawNormal(e,Tv[0],Tv[1],Tv[2])}function rv(e,t,i,r,s,n,o){return o===s?!e||t?(e,t)=>Ny(e,t,i):null:o===n&&e?(e,t)=>Ny(e,t,r):null}function sv(e,t,i,r){if(t!==e)return()=>0;const s=t?3:2,n=t?1:0,o=r(s,n),a=r(n,s),l=(null!=o?1:0)+(null!=a?1:0),c=t?i:0,u=t?0:i;return(e,t,i)=>((null!=o?-(o(e+c,t+u)-i):0)+(null!=a?+(a(e-c,t-u)-i):0))/l}function nv(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],u=r.edgeResolutions[t],h=u,d=n.extent,p=e.geometryState,f=h+1,m=c,g=e.localOrigin,y=p.samplerData,_=m?.neighborTile.level===o,v=_?(e,t)=>.5*(Ny(e,t,m.neighborSamplerData)+Ny(e,t,y)):(e,t)=>Ny(e,t,m.neighborSamplerData),b=(0,I.pC)(m)?v:(e,t)=>Ny(e,t,y),w=e.geometryInfo,x=w.outerEdges[t],C=X_(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),T=w.boundingBox,S=1===t||3===t,E=1===t?d[2]:d[0],A=0===t?d[3]:d[1],M=1===t?1:0,O=0===t?1:0,R=(d[2]-d[0])/u,P=m?.neighborSamplerData,L=(0,I.pC)(m),D=(e,i)=>rv(L,_,y,P,e,i,t),N=sv(S,!0,R,D),F=sv(S,!1,R,D);for(let e=1;e<f-1;++e){const t=e/h,r=S?E:d[0]*(1-t)+d[2]*t,s=S?d[1]*(1-t)+d[3]*t:A,n=S?M:t,o=S?t:O,a=b(r,s),c=r*i-g[0],u=C(s)-g[1],p=a-g[2];if(dv(c,u,p,T),l){const t=N(r,s,a),i=F(r,s,a),l=R;x.setVertexRawXYZUVN(e,c,u,p,n,o,t,i,l)}else x.setVertexRawXYZUV(e,c,u,p,n,o)}if(l){const e=S?0:1,t=S?1:0;for(let i=1;i<f-1;++i){x.getNormal(Sv,i);const r=x.getVertexZ(i-1)-x.getVertexZ(i+1),s=Sv[0]+.5*e*r,n=Sv[1]+.5*t*r,o=2*R,a=1/Math.sqrt(s*s+n*n+o*o);x.setVertexRawNormal(i,a*s,a*n,a*o)}}}function ov(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],u=r.edgeResolutions[t],h=u,d=n.extent,p=e.geometryState,f=(0,I.Pt)(p.clippingArea,mv),m=e.geometryInfo,g=m.uvOffsetAndScale[0],y=m.uvOffsetAndScale[1],_=g+m.uvOffsetAndScale[2],v=y+m.uvOffsetAndScale[3],b=_>g?1/(_-g):1,w=v>y?1/(v-y):1,x=-g*b,C=-y*w,T=h+1,S=[d[3]>f[3],d[2]>f[2],d[1]<f[1],d[0]<f[0]],E=c,A=p.samplerData,M=(e,t)=>Ny(e,t,A),O=E?.neighborTile.level===o,R=M,P=(0,I.pC)(E)?(e,t)=>{const i=Ny(e,t,E.neighborSamplerData);return O?.5*(i+Ny(e,t,A)):i}:M,L=S[t]?R:P,D=m.outerEdges[t],N=m.boundingBox,F=1===t||3===t,k=(0,$.uZ)(1===t?d[2]:d[0],f[0],f[2]),U=(0,$.uZ)(0===t?d[3]:d[1],f[1],f[3]),V=1===t?1:0,z=0===t?1:0,B=e.localOrigin,H=X_(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),j=(d[2]-d[0])/u,G=E?.neighborSamplerData,W=(0,I.pC)(E),Z=E?.neighborTile.level===o,q=(e,i)=>rv(W,Z,A,G,e,i,t),Y=sv(F,!0,j,q),X=sv(F,!1,j,q);for(let e=1;e<T-1;++e){const t=e/h,r=F?k:(0,$.uZ)(d[0]*(1-t)+d[2]*t,f[0],f[2]),s=F?(0,$.uZ)(d[1]*(1-t)+d[3]*t,f[1],f[3]):U,n=F?V:(0,$.uZ)(x+t*b,0,1),o=F?(0,$.uZ)(C+t*w,0,1):z,a=L(r,s),c=r*i-B[0],u=H(s)-B[1],p=a-B[2];if(dv(c,u,p,N),l){const t=Y(r,s,a),i=X(r,s,a),l=j;D.setVertexRawXYZUVN(e,c,u,p,n,o,t,i,l)}else D.setVertexRawXYZUV(e,c,u,p,n,o)}if(l){const e=F?0:1,t=F?1:0;for(let i=1;i<T-1;++i){D.getNormal(Sv,i);const r=D.getVertexZ(i-1)-D.getVertexZ(i+1),s=Sv[0]+.5*e*r,n=Sv[1]+.5*t*r,o=2*j,a=1/Math.sqrt(s*s+n*n+o*o);D.setVertexRawNormal(i,a*s,a*n,a*o)}}}function av(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function lv(e){const t=e.tile;if(t.surface.isWebMercator){const e=t.extent,i=t.ellipsoid.radius;return t=>function(e,t,i,r){return av(e+r*(t-e),i)}(e[1],e[3],i,t)}const i=t.extentInRadians;return e=>function(e,t,i){return e*(1-i)+t*i}(i[1],i[3],e)}function cv(e){e.tile.surface.shadingEnabled&&hv(e,((e,t,i,r,s,n,o)=>function(e,t,i,r,s,n,o){(function(e,t,i,r,s){const n=lv(e),o=e.tile,a=o.extent;(0,Ug.Fp)((0,ve.OC)(a,i,r,1));const l=(i-a[0])/(a[2]-a[0]),c=(r-a[1])/(a[3]-a[1]),u=o.extentInRadians;Y_(t,u[0]*(1-l)+u[2]*l,n(c),s,o.ellipsoid.radius)})(e,yv,s,n,o),(0,dr.v)(_v,yv,i),(0,dr.f)(vv,_v,r),(0,dr.f)(t,vv,_v)}(t,e,i,r,s,n,o)))}function uv(e,t){e.tile.surface.shadingEnabled&&hv(e,((i,r,s,n,o,a,l)=>function(e,t,i,r,s,n){e(yv,r,s,n);const o=yv[0]-i[0],a=yv[1]-i[1],l=yv[2]-i[2];t[0]=-o*l,t[1]=-a*l,t[2]=o*o+a*a}(function(e,t){return e.tile.surface.isWebMercatorOnPlateeCarree?(i,r,s,n)=>function(e,t,i,r,s,n){i[0]=r*e,i[1]=(Math.PI/2-2*Math.atan(Math.exp(-s/t)))*t,i[2]=n}(t,e.tile.ellipsoid.radius,i,r,s,n):(e,i,r,s)=>function(e,t,i,r,s){t[0]=i*e,t[1]=r*e,t[2]=s}(t,e,i,r,s)}(e,t),i,s,o,a,l)))}function hv(e,t){if(!e.tile.surface.shadingEnabled)return;const i=e.geometryState.neighborData.cornerNeighborData,r=e.tile,s=r.extent,n="local"===e.tile.surface.view?.viewingMode;n&&(0,dr.s)(Cv,0,0,1);{const o=(e,i,r,s)=>{t(bv,e.renderData,wv,Cv,i,r,s),(0,dr.a)(Tv,Tv,bv)},a=1,l=(e,t,i,r,s,n)=>{const l=1===n?s.extent[0]:3===n?s.extent[2]:e,c=0===n?s.extent[1]:2===n?s.extent[3]:t,u=l+pv[i][0]*r,h=c+pv[i][1]*r;(0,Ug.Fp)((0,ve.OC)(s.extent,u,h,a));const d=Ny(u,h,s.renderData.geometryState.samplerData);o(s,u,h,d)},c=(e,t,i)=>e.extent[0===t||1===t?2:0]+i,u=(e,t,i)=>e.extent[0===t||3===t?3:1]+i,h=(e,t,i,r)=>{const s=c(i,r,pv[e][0]*t),n=u(i,r,pv[e][1]*t);(0,Ug.Fp)((0,ve.OC)(i.extent,s,n,a));const l=Ny(s,n,i.renderData.geometryState.samplerData);o(i,s,n,l)},d=(e,t,i,r,s,n)=>{const l=pv[e][0]*t,h=pv[e][1]*t,d=c(i,r,l),p=u(i,r,h),f=c(s,n,l),m=u(s,n,h);(0,Ug.Fp)((0,ve.OC)(i.extent,d,p,a)),(0,Ug.Fp)((0,ve.OC)(s.extent,f,m,a));const g=Ny(d,p,i.renderData.geometryState.samplerData),y=Ny(f,m,s.renderData.geometryState.samplerData);o(i,d,p,.5*(g+y))},p=e=>{const t=0===e||1===e?s[2]:s[0],n=0===e||3===e?s[3]:s[1],o=i[e].cornerTiles,a=o.reduce(((e,t)=>Math.min(e,t?.level??1/0)),1/0);for(let e=0;e<4;++e){const t=o[e];Av[e]=t?.level===a?t:null}for(let e=0;e<4;++e){const i=Av[(e+3)%4],s=Av[e];if(null!=i&&i!==r&&i===s){const s=i,o=(e+2)%4,a=s.renderData.geometryState.neighborData.edgeResolutions[o],c=Math.max(a,2**(r.level-s.level)),u=(s.extent[2]-s.extent[0])/c,h=(e+0)%4,d=(e+1)%4;return l(t,n,(e+3)%4,u,s,e),l(t,n,h,u,s,e),l(t,n,d,u,s,e),Tv}}{(0,Ug.Fp)(Av.some((e=>e?.isLoaded||e===r)));const e=Av.reduce(((e,t)=>t?t.extent[2]-t.extent[0]:e),0)/Av.reduce(((e,t)=>Math.max(e,t?.renderData.geometryState.numVerticesPerSide??1)),1);for(let t=0;t<4;++t){const i=Av[(t+3)%4],r=Av[(t+0)%4];if(!i&&!r)continue;const s=0===t?1:1===t?2:2===t?3:0,n=0===t?2:1===t?3:2===t?0:1;i&&r?d(t,e,i,s,r,n):h(t,e,i??r,i?s:n)}}return Tv};for(let t=0;t<4;++t){const i=e.geometryInfo.outerEdges[t],r=1===t||2===t?0:i.count-1;i.getVertex(wv,r),n||(0,dr.n)(Cv,wv),(0,dr.s)(Tv,0,0,0);const s=p(t);(0,dr.n)(Ev[t],s)}}{const t=(e,t,i,r,s)=>{e.setVertexRawNormal(s,t,i,r)},i=e.geometryInfo.outerEdges;for(let e=0;e<4;++e){const r=i[e];{const i=Ev[0===e?3:1===e?1:2];t(r,i[0],i[1],i[2],0)}{const i=Ev[2===e?1:3===e?3:0];t(r,i[0],i[1],i[2],r.count-1)}}}}function dv(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}W_.updatedGeometryTiles=new Map,W_.deferTileNeighborUpdate=!1,W_.neighborTilesToUpdate=new Set;const pv=[[0,1],[1,0],[0,-1],[-1,0]],fv=new class{constructor(){this.sinLonLUT=new Array(Ne.HB+1),this.cosLonLUT=new Array(Ne.HB+1)}update(e,t){const i=t[0],r=t[2];for(let t=0;t<=e;t++){const s=t/e,n=i*(1-s)+r*s;this.sinLonLUT[t]=Math.sin(n),this.cosLonLUT[t]=Math.cos(n)}}},mv=(0,ve.al)(-1/0,-1/0,1/0,1/0),gv=(0,me.c)(),yv=(0,me.c)(),_v=(0,me.c)(),vv=(0,me.c)(),bv=(0,me.c)(),wv=(0,me.c)(),xv=(0,me.c)(),Cv=(0,me.c)(),Tv=(0,me.c)(),Sv=(0,me.c)(),Ev=[(0,me.c)(),(0,me.c)(),(0,me.c)(),(0,me.c)()],Av=[null,null,null,null];var Mv=s(25584);class Ov extends L_{constructor(e,t,i){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=(0,ve.Ue)(),void 0!==e&&this.init(e,t,i)}init(e,t,i){super.init(e,t,i);const r=i.view.renderSpatialReference,s=i.spatialReference,n=(0,I.pC)(r)&&(0,$e.QM)(r)&&s.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=n;const o=this.surface.isWebMercatorOnPlateeCarree,a=this.extentInRenderSR,l=this.extent;if(o){const e=(0,me.f)(l[0],l[1],0);(0,_e.SH)(e,qe.Z.WebMercator,e,qe.Z.PlateCarree);const t=(0,me.f)(l[2],l[3],0);(0,_e.SH)(t,qe.Z.WebMercator,t,qe.Z.PlateCarree),a[0]=e[0],a[1]=e[1],a[2]=t[0],a[3]=t[1]}else for(let e=0;e<4;++e)a[e]=l[e]*n;this.centerAtSeaLevel[0]=.5*(a[0]+a[2]),this.centerAtSeaLevel[1]=.5*(a[1]+a[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(a[2]-a[0],a[3]-a[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this.extentInRenderSR,t=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),r=Math.sqrt(t*t+i*i),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),n=Math.max(r,s);this._center[V_.MIDDLE][3]=n}_isVisible(e){return(0,gf.fz)(e,this._aabb())}_aabb(){const e=this.extentInRenderSR;return(0,Rp.re)(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,t,i,r){return Rv[0]=1/t[0],Rv[1]=1/t[1],Rv[2]=1/t[2],(0,Mv.Fw)(this._aabb(),e,Rv,i,r)}createGeometry(){(function(e,t){const i=e.tile,r=i.extent,s=e.localOrigin,n=e.geometryState,o=i.surface,a=o.isWebMercatorOnPlateeCarree,l=o.shadingEnabled,c=r[0],u=r[1],h=r[2]-c,d=r[3]-u,p=n.clippingArea,f=(0,I.pC)(p)?Math.max(0,(p[0]-r[0])/h):0,m=(0,I.pC)(p)?Math.max(0,(p[1]-r[1])/d):0,g=(0,I.pC)(p)?Math.min(1,(p[2]-r[0])/h):1,y=(0,I.pC)(p)?Math.min(1,(p[3]-r[1])/d):1,_=g-f,v=y-m,b=_>0?1/_:1,w=v>0?1/v:1,x=-f*b,C=-m*w,T=n.numVerticesPerSide,S=T-1,E=(T-2)**2+n.neighborData.edgeResolutions.reduce(((e,t)=>e+t+1),0),A=c_(E),M=A.position.typedBuffer,O=A.uv0.typedBuffer,R=A.normal.typedBuffer,P=e.geometryInfo,L=P.boundingBox;(0,Rp.cS)(L);let D=0;const N=i.ellipsoid.radius,F=n.samplerData,k=(0,I.pC)(p)?p:mv,U=(0,ve.al)(Math.max(r[0],k[0]),Math.max(r[1],k[1]),Math.min(r[2],k[2]),Math.min(r[3],k[3])),V=s[0],z=s[1],B=s[2],H=X_(a,N,t);(()=>{for(let e=1;e<=S-1;e++){const i=e/S,r=C+i*w,s=(0,$.uZ)(u+i*d,U[1],U[3]),n=(0,$.uZ)(r,0,1),o=H(s)-z,a=h/S;for(let e=1;e<=S-1;e++){const i=e/S,r=x+i*b,u=(0,$.uZ)(c+i*h,U[0],U[2]),d=(0,$.uZ)(r,0,1),p=Ny(u,s,F),f=u*t-V,m=p-B;dv(f,o,m,L);const g=Ne.Vs*D;if(M[g+0]=f,M[g+1]=o,M[g+2]=m,O[g+0]=d,O[g+1]=n,l){const e=Ny(u+a,s,F),t=Ny(u-a,s,F),i=Ny(u,s+a,F),r=.25*(t-e),n=.25*(Ny(u,s-a,F)-i),o=a,l=Math.sqrt(r*r+n*n+o*o);R[g+0]=r/l,R[g+1]=n/l,R[g+2]=o/l}++D}}})(),P.numVerticesPerSide=n.numVerticesPerSide,P.vertexAttributes=A,(0,Fd.s)(e.geometryInfo.uvOffsetAndScale,f,m,g-f,y-m),q_(e,D),$_(e,t),D=E,Z_(P,n.numVerticesPerSide,[],[0,T-1],[0,T-1],n.wireframe),e.intersectionData=null})(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){!function(e,t){K_(e,t),uv(e,t),ev(e)}(this.renderData,this.horizontalScaleFactor)}updateEdgeElevations(){!function(e,t){$_(e,t),ev(e)}(this.renderData,this.horizontalScaleFactor)}}const Rv=(0,me.c)();var Pv;!function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"}(Pv||(Pv={}));class Iv extends L_{constructor(e,t,i){super(),this.obb=new Array(8);for(let e=0;e<8;e++)this.obb[e]=(0,me.c)();void 0!==e&&this.init(e,t,i)}init(e,t,i){super.init(e,t,i);const r=this.ellipsoid.radius,s=this.extentInRadians[0],n=this.extentInRadians[1],o=this.extentInRadians[2],a=this.extentInRadians[3],l=e[0],c=(0,$.t7)(n,a,.5),u=(0,$.t7)(s,o,.5),h=0===l?0:Math.min(Math.abs(n),Math.abs(a));this._edgeLen=(o-s)*Math.cos(h)*r,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=r-Math.sqrt(r*r-this._edgeLen2/4),(0,_e.zP)(this.centerAtSeaLevel,u,c,this.ellipsoid.radius);const d=(0,me.d)(this.centerAtSeaLevel);(0,dr.n)(d,d),this.up=d,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(0===this.lij[0])(0,dr.s)(this._center[Nv.MIDDLE],0,0,0),(0,dr.s)(this._center[Nv.TOP],0,0,0),(0,dr.s)(this._center[Nv.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=(0,fr.Iu)(this.surface.spatialReference)),this._center[Nv.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const e=Math.max((0,dr.d)(this._center[Nv.MIDDLE],this.obb[0]),(0,dr.d)(this._center[Nv.MIDDLE],this.obb[1]));this._center[Nv.MIDDLE][3]=Math.sqrt(e)}}_isVisible(e){if(!(0,gf.hr)(e,this._center[Nv.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const t=this.obb;for(let i=0;i<gf.tc.NUM;i++){const r=i===gf.Nu.NEAR,s=e[i];r&&(Dv[0]=s[0],Dv[1]=s[1],Dv[2]=s[2],Dv[3]=s[3]-this.surface.view.state.camera.near);const n=r?Dv:s;let o;for(o=0;o<8;o++){const e=t[o];if(n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]<0)break}if(8===o)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const e=this._getPatchType(this.lij[1],this.lij[0]);(function(e,t){const i=e.tile,{extent:r,extentInRadians:s,surface:n}=i,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shadingEnabled,u=a.numVerticesPerSide,h=u-1,d=(u-2)**2,p=l&&(t===By.tk.HAS_SOUTH_POLE||t===By.tk.HAS_BOTH_POLES),f=l&&(t===By.tk.HAS_NORTH_POLE||t===By.tk.HAS_BOTH_POLES),m=6*((p?1:0)+(f?1:0))*(h+1),g=a.neighborData,y=g.edgeResolutions.reduce(((e,t)=>e+t+1),0),_=c_(d+m+y),v=e.geometryInfo;v.numVerticesPerSide=a.numVerticesPerSide,v.vertexAttributes=_,(0,Fd.s)(v.uvOffsetAndScale,0,0,1,1);const b=_.position.typedBuffer,w=_.uv0.typedBuffer,x=_.normal.typedBuffer,C=v.boundingBox;(0,Rp.cS)(C);const T=o[0],S=o[1],E=o[2];fv.update(h,s);let A=0;const M=a.samplerData,O=i.ellipsoid.radius,R=lv(e),P=u-2,I=r[0],L=r[2],D=r[1],N=r[3];(()=>{for(let e=1;e<=P;e++){const t=e/h,i=D*(1-t)+N*t,r=R(t),s=Math.cos(r),n=Math.sin(r);for(let e=1;e<=P;e++){const r=e/h,o=I*(1-r)+L*r,a=fv.sinLonLUT[e],l=fv.cosLonLUT[e],c=O+Ny(o,i,M),u=l*s*c-T,d=a*s*c-S,p=n*c-E;dv(u,d,p,C);const f=Ne.Vs*A;b[f+0]=u,b[f+1]=d,b[f+2]=p,w[f+0]=r,w[f+1]=t,++A}}})(),c&&(()=>{const t=e=>((0,dr.b)(_v,e,xv),(0,dr.f)(vv,_v,Cv),(0,dr.f)(bv,vv,_v),bv),i=_.position,r=_.normal;A=0;const s=e=>{i.getVec(e,yv),(0,dr.a)(Tv,Tv,t(yv))},n=(e,i)=>{{const t=e/h,r=I*(1-t)+L*t,s=fv.sinLonLUT[e],n=fv.cosLonLUT[e],o=i/h,a=D*(1-o)+N*o,l=R(o),c=Math.cos(l),u=Math.sin(l),d=O+Ny(r,a,M);(0,dr.s)(yv,n*c*d-T,s*c*d-S,u*d-E)}(0,dr.a)(Tv,Tv,t(yv))},o=(e,t,i)=>{e>1&&t>1&&e<P&&t<P?s(A+i):n(e,t)};for(let t=1;t<=P;t++)for(let s=1;s<=P;s++)i.getVec(A,xv),(0,dr.a)(wv,xv,e.localOrigin),(0,dr.n)(Cv,wv),(0,dr.s)(Tv,0,0,0),o(s-1,t,-1),o(s+1,t,1),o(s,t-1,-P),o(s,t+1,+P),(0,dr.n)(Tv,Tv),r.setVec(A,Tv),++A})(),A=d,q_(e,d),tv(e),A=d+y;const F=[];(()=>{const e=(e,t)=>{const i=t*u;dv(-T,-S,e*O-E,C),F.push({connectedRowOffset:i,connectedOuterEdgeOffset:1===e?0:2,rowOffset:A,latitudeResolution:6});const r=av(-1===e?D:N,O),s=e*Math.PI/2-r,n=.99*(1===e?1:-1),o=O+0;for(let e=1;e<=6;++e){const t=r+s*(e/6),i=Math.cos(t),a=Math.sin(t);for(let e=0;e<=h;e++){const t=e/h,r=fv.sinLonLUT[e],s=fv.cosLonLUT[e]*i*o-T,l=r*i*o-S,u=a*o-E;dv(s,l,u,C);const d=Ne.Vs*A;if(b[d+0]=s,b[d+1]=l,b[d+2]=u,w[d+0]=t,w[d+1]=n,c){const e=1/Math.sqrt(s*s+l*l+u*u);x[d+0]=e*s,x[d+1]=e*l,x[d+2]=e*u}++A}}};p&&e(-1,0),f&&e(1,h)})(),Z_(v,a.numVerticesPerSide,F,[0,u-1],[0,u-1],a.wireframe),e.intersectionData=null;for(let e=0;e<4;++e)(0,Ug.Fp)(v.outerEdges[e].count===g.edgeResolutions[e]+1)})(this.renderData,e),this.setMemoryDirty()}_updateOBB(){const e=this.extentInRadians,t=this.obb;for(let i=0;i<2;i++){const r=this.elevationBounds[i];let s=4*i;(0,_e.zP)(t[s++],e[0],e[1],this.ellipsoid.radius+r),(0,_e.zP)(t[s++],e[0],e[3],this.ellipsoid.radius+r),(0,_e.zP)(t[s++],e[2],e[3],this.ellipsoid.radius+r),(0,_e.zP)(t[s++],e[2],e[1],this.ellipsoid.radius+r)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case By.tk.HAS_NORTH_POLE:(0,dr.s)(t[1],0,0,this.ellipsoid.radius),(0,dr.s)(t[2],0,0,this.ellipsoid.radius),(0,dr.s)(t[5],0,0,this.ellipsoid.radius),(0,dr.s)(t[6],0,0,this.ellipsoid.radius);break;case By.tk.HAS_SOUTH_POLE:(0,dr.s)(t[0],0,0,-this.ellipsoid.radius),(0,dr.s)(t[3],0,0,-this.ellipsoid.radius),(0,dr.s)(t[4],0,0,-this.ellipsoid.radius),(0,dr.s)(t[7],0,0,-this.ellipsoid.radius)}}_getPatchType(e,t){return e===(1<<t)-1?0===e?By.tk.HAS_BOTH_POLES:By.tk.HAS_SOUTH_POLE:0===e?By.tk.HAS_NORTH_POLE:By.tk.REGULAR}intersectsRay(e,t,i,r){const s=this._center[Nv.MIDDLE],n=s[3]+i,o=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],a=s[0]-e[0],l=s[1]-e[1],c=s[2]-e[2],u=(a*t[0]+l*t[1]+c*t[2])/o,h=t[0]*u-a,d=t[1]*u-l,p=t[2]*u-c;return h*h+d*d+p*p<n*n}getDefaultVerticesPerRowOnLevel(){return this.level<Lv.length?Lv[this.level]+1:2}updateCornerElevations(){!function(e){J_(e),cv(e);const t=e.vao,i=e.geometryInfo.vertexAttributes;t?.vertexBuffers?.geometry?.setSubData(i.position.typedBuffer)}(this.renderData)}updateEdgeElevations(){!function(e){tv(e),ev(e)}(this.renderData)}}const Lv=[128,64,32,16,16,8,8,4],Dv=(0,Ol.Ue)();var Nv;!function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"}(Nv||(Nv={}));var Fv=s(81936);class kv{constructor(){this.extent=(0,pr.c)(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class Uv{constructor(){this._queries=new Nd.Z({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Nd.Z({initialSize:30}),this._queryPool=new _f.Z(kv)}queryVisibleLevelRange(e,t,i,r){const s=this._queryPool.acquire();(0,Fd.c)(s.extent,e),s.minLevel=t||-Number.MAX_VALUE,s.maxLevel=null!=i?i:Number.MAX_VALUE,s.callback=r,this._queryQueue.push(s)}hasPendingQueries(){return 0!==this._queryQueue.length}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}processQueries(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear()}scaleQueriesForTile(e){const t=e.level;let i=0;for(;i<this._queriesInvPtr;){const r=this._queries.data[i],s=r.extent;t>=r.minLevel&&t<=r.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}}var Vv=s(23998);class zv extends Or.m{constructor(){super(...arguments),this.blendMode=Vv.iM.Normal}}(0,t._)([(0,Or.o)({count:Vv.iM.COUNT})],zv.prototype,"blendMode",void 0);var Bv=s(73721),Hv=s(33803);class jv extends Bv.R{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=Vv.iM.Normal,this.backgroundColor=me.Z}}class Gv extends Cr.A{initializeProgram(e){const t=Gv.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({blending:(0,Ar.if)(Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ar.BK})}}Gv.shader=new xr.J(Hv.b,(()=>s.e(9387).then(s.bind(s,59387))));class Wv extends zv{constructor(){super(...arguments),this.output=Hv.B.Composite,this.baseOpacityMode=Hv.a.One,this.premultipliedSource=!1}}(0,t._)([(0,Or.o)({count:Hv.B.COUNT})],Wv.prototype,"output",void 0),(0,t._)([(0,Or.o)({count:Hv.a.COUNT})],Wv.prototype,"baseOpacityMode",void 0),(0,t._)([(0,Or.o)()],Wv.prototype,"premultipliedSource",void 0);class Zv{constructor(e,t,i,r,s,n){this.texture=e,this.type=t,e.retain(),this.offsetAndScale=(0,pr.f)(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=(0,me.f)(r,n,s)}destroy(){this.texture.release()}}var qv=s(84342),$v=s(40278),Yv=s(59566);Object.freeze(Object.defineProperty({__proto__:null,create:function(){return[1,0,0,1,0,0]},clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]},fromValues:function(e,t,i,r,s,n){return[e,t,i,r,s,n]},createView:function(e,t){return new Float64Array(e,t,6)}},Symbol.toStringTag,{value:"Module"}));var Xv=s(19710),Jv=s(70144);Math.PI;function Kv(e,t){return t.type?(0,mr.a)(e,t.x,t.y):(0,mr.c)(e,t)}function Qv(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const eb=function(){const e=(0,gr.a)();return function(t,i,r){const s=i.targetGeometry;Kv(e,s);const n=.5*ib(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}(),tb=function(){const e=(0,gr.a)();return function(t,i,r){return(0,mr.k)(t,function(e,t){return(0,mr.f)(e,t,.5)}(t,i),function(e,t,i){return i?(0,mr.a)(e,.5*(t[0]-i.right+i.left),.5*(t[1]-i.bottom+i.top)):(0,mr.f)(e,t,.5)}(e,i,r))}}();!function(){const e=[1,0,0,1,0,0],t=(0,gr.a)()}();function ib(e){return e.scale*function(e){return(0,I.pC)(e)&&(0,$e.JY)(e.spatialReference)?1/(39.37*function(e){return(0,em.c9)(e)}(e.spatialReference)*96):1}(e.targetGeometry)}function rb(e){return(0,m_.t)(e.rotation)||0}const sb=function(){const e=(0,gr.a)(),t=(0,gr.a)(),i=(0,gr.a)();return function(r,s,n,o,a,l){return(0,mr.n)(e,s),(0,mr.f)(t,n,.5*l),(0,mr.a)(i,1/o*l,-1/o*l),(0,$v.a)(r,t),a&&(0,$v.r)(r,r,a),(0,$v.s)(r,r,i),(0,$v.t)(r,r,e),r}}(),nb=function(){const e=(0,gr.a)();return function(t,i,r,s){const n=ib(i),o=rb(i);return Kv(e,i.targetGeometry),sb(t,e,r,n,o,s)}}(),ob=function(){const e=(0,gr.a)();return function(t,i,r,s){const n=ib(i);return Kv(e,i.targetGeometry),sb(t,e,r,n,0,s)}}();(0,gr.a)(),(0,gr.a)(),(0,gr.a)(),(0,gr.a)();(function(){const e=(0,gr.a)()})(),function(){const e=(0,gr.a)()}();const ab=((0,gr.a)(),(0,gr.a)(),function(){const e=[1,0,0,1,0,0];return function(t,i,r,s){return(0,mr.t)(t,i,function(e,t,i,r){return nb(e,t,i,1),(0,$v.b)(e,e)}(e,r,s))}}()),lb=function(){const e=[1,0,0,1,0,0];return function(t,i,r,s){return(0,mr.t)(t,i,nb(e,r,s,1))}}(),cb=function(){const e=(0,gr.a)(),t=[1,0,0,1,0,0];return function(i,r,s){Qv(i,r);const n=ib(r),o=i.targetGeometry;return(0,$v.c)(t,rb(r)),(0,$v.s)(t,t,(0,gr.f)(n,n)),(0,mr.t)(e,s,t),o.x+=e[0],o.y+=e[1],i}}();var ub;const hb=[0,0];let db=ub=class extends c.wq{constructor(e){super(e),this._viewpoint2D={center:(0,gr.a)(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new Ze.Z,this.id=0,this.inverseTransform=[1,0,0,1,0,0],this.resolution=0,this.rotation=0,this.scale=0,this.transform=[1,0,0,1,0,0],this.transformNoRotation=[1,0,0,1,0,0],this.displayMat3=(0,Xv.c)(),this.displayViewMat3=(0,Xv.c)(),this.viewMat3=(0,Xv.c)(),this.viewMat2d=(0,Yv.c)(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=Qv(i,e.viewpoint),this._set("size",(0,mr.c)(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new ub({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return(0,Jv.lM)(t)?(0,mr.t)(e,t,this.inverseTransform):(hb[0]=t,hb[1]=i,(0,mr.t)(e,hb,this.inverseTransform))}toScreen(e,t,i){return(0,Jv.lM)(t)?(0,mr.t)(e,t,this.transform):(hb[0]=t,hb[1]=i,(0,mr.t)(e,hb,this.transform))}toScreenNoRotation(e,t,i){return(0,Jv.lM)(t)?(0,mr.t)(e,t,this.transformNoRotation):(hb[0]=t,hb[1]=i,(0,mr.t)(e,hb,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return sb(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new ne({targetGeometry:new X.Z(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=ib(o),this.rotation=r,this.scale=i,this.spatialReference=t,(0,mr.c)(this.center,e);const a=0!==n[0]?2/n[0]:0,l=0!==n[1]?-2/n[1]:0;(0,as.s)(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=(0,as.b)(this.viewMat3),u=(0,ls.f)(n[0]/2,n[1]/2),h=(0,ls.f)(-n[0]/2,-n[1]/2),d=(0,m_.t)(r);(0,as.c)(c,c,u),(0,as.r)(c,c,d),(0,as.c)(c,c,h),(0,as.m)(this.displayViewMat3,this.displayMat3,c);const p=(0,$v.a)(this.viewMat2d,u);return(0,$v.r)(p,p,d),(0,$v.t)(p,p,h),eb(this.extent,o,n),nb(this.transform,o,n,s),(0,$v.b)(this.inverseTransform,this.transform),ob(this.transformNoRotation,o,n,s),this.worldScreenWidth=function(e,t){return Math.round(function(e){const t=(0,$e.C5)(e);return t?t.valid[1]-t.valid[0]:0}(e)/t)}(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};(0,t._)([(0,m.Cb)({readOnly:!0})],db.prototype,"id",void 0),(0,t._)([(0,m.Cb)({value:1,json:{write:!0}})],db.prototype,"pixelRatio",null),(0,t._)([(0,m.Cb)({json:{write:!0}})],db.prototype,"size",null),(0,t._)([(0,m.Cb)()],db.prototype,"spatialReference",void 0),(0,t._)([(0,m.Cb)({type:ne,json:{write:!0}})],db.prototype,"viewpoint",null),db=ub=(0,t._)([(0,y.j)("esri.views.2d.ViewState")],db);const pb=db;class fb{constructor(){this._renderParams={context:null,drawPhase:1,state:new pb({viewpoint:new ne({targetGeometry:new X.Z(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(e,t,i,r,s,n,o,a,l,c){const u=n.adjustLevel(t[0]),h=this._renderParams;h.context=e,h.painter=r,h.glyphMosaic=r.glyphMosaic,h.spriteMosaic=r.spriteMosaic,h.pixelRatio=c,h.displayLevel=u,h.requiredLevel=u;const d=n.getScale(t[0]),[p,f]=n.getShift(t,o*d),m=.125*o*d/l,g=i.transforms.dvs;g[0]=m,g[4]=-m,g[6]=-1-p-a[0]*o*2,g[7]=1+f+(1-a[1])*o*2-2,h.state.size[0]=l,h.state.size[1]=l,i.stage||i.attachWithContext(e),i.triangleCount=0,r.drawTile(h,i,s)}}var mb=s(28624),gb=s(52191);class yb extends Cr.A{initializeProgram(e){const t=yb.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({blending:(0,Ar.if)(Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ar.BK})}}yb.shader=new xr.J(mb.R,(()=>s.e(6145).then(s.bind(s,36145))));class _b extends zv{constructor(){super(...arguments),this.colorizerType=qv.U.Stretch,this.stretchType=qv.H.Noop,this.tileBlendInput=gb.R.LayerOnly,this.baseOpacityMode=Hv.a.One,this.applyColormap=!0}}(0,t._)([(0,Or.o)({count:qv.U.COUNT})],_b.prototype,"colorizerType",void 0),(0,t._)([(0,Or.o)({count:qv.H.COUNT})],_b.prototype,"stretchType",void 0),(0,t._)([(0,Or.o)({count:gb.R.COUNT})],_b.prototype,"tileBlendInput",void 0),(0,t._)([(0,Or.o)({count:Hv.a.COUNT})],_b.prototype,"baseOpacityMode",void 0),(0,t._)([(0,Or.o)()],_b.prototype,"applyColormap",void 0);class vb{constructor(e){this._rctx=e,this._pools=new Map}acquire(e){return this._getPool(e).acquire()}clear(){this._pools.forEach((e=>e.destroy())),this._pools.clear()}_getPool(e){let t=this._pools.get(e);if(!t){const i=bb.bind(bb,this._rctx,{colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.DEPTH_RENDER_BUFFER,width:e,height:e},(e=>this._getPool(e.width).release(e)));t=new _f.Z(i,null,(()=>{})),this._pools.set(e,t)}return t}}class bb extends vs.X{constructor(e,t,i){super(e,t),this.release=()=>i(this)}}const wb=p.Z.getLogger("esri.views.3d.terrain");class xb{constructor(e,t){this._rctx=e,this._techniqueRepository=t,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new fb,this._bindParameters=new ws.p(null,null,null),this._blendLayersTechniqueConfig=new Wv,this._poolToWrite=0,this._vaoQuad=(0,Lr.ow)(this._rctx,Ir.Bn),this._fboPools.push(new vb(this._rctx)),this._fboPools.push(new vb(this._rctx))}dispose(){this._fboPools.forEach((e=>{e.clear(),e=null})),this._fboPools=null,this._doubleBufferFbo.forEach((e=>(0,I.O3)(e))),this._vaoQuad=(0,I.O3)(this._vaoQuad),this._vectorTileHelper=(0,I.O3)(this._vectorTileHelper),this._backgroundTechnique=(0,I.RY)(this._backgroundTechnique),this._applyOpacityTechnique=(0,I.RY)(this._applyOpacityTechnique),this._blendLayersTechnique=(0,I.RY)(this._blendLayersTechnique)}_getBlendLayersTechnique(e,t,i,r=!1){return this._blendLayersTechniqueConfig.output=t,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i?t===Hv.B.Composite?Hv.a.OnBaseLayer:Hv.a.OnBackground:Hv.a.One,this._blendLayersTechniqueConfig.premultipliedSource=r,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(Gv,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,t){const i=this._getBlendLayersTechnique(Vv.iM.Normal,t,!1),r=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(r)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Er.MX.TRIANGLE_STRIP,0,(0,js._V)(this._vaoQuad,"geometry"))}drawRasterData(e,t,i=!1){if((0,I.Wi)(t.texture))return;const r=t.baseOpacity<1;t.blendMode!==Vv.iM.Normal||r||i?(t.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):t.fboTexture=null;const s=this._getBlendLayersTechnique(t.blendMode,e,r,i),n=this._rctx.bindTechnique(s,t,this._bindParameters);this._render(n)}drawImageryTileData(e,t,i){const r=e.sourceLayerInfo.data;if(!r.source)return;e.tile.surface.layerViewByIndex(e.layerIndex,zy.MAP).ensureSymbolizerParameters(r);const s=i.baseOpacity<1;i.blendMode!==Vv.iM.Normal||s?(i.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):i.fboTexture=null;const n=this._getRasterColorizerTechnique(r,t,i.blendMode,s),o=this._rctx.bindTechnique(n);if(!r.bind(this._rctx))return;r.opacity=i.opacity;const a=r.getUniforms();a.scale=e.scale,a.offset=e.offset,a.backgroundColor=i.backgroundColor,a.fboTexture=i.fboTexture,a.baseOpacity=i.baseOpacity,n.bindPass(a,null),this._render(o)}_getRasterColorizerTechnique(e,t,i,r){const s=e.symbolizerParameters,n=["stretch","lut","hillshade"].indexOf(s.type);return(0,I.Wi)(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new _b,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=t===Hv.B.ColorComposite?gb.R.ColorComposite:t===Hv.B.GridComposite?gb.R.GridComposite:gb.R.LayerOnly,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=r?t===Hv.B.Composite?Hv.a.OnBaseLayer:Hv.a.OnBackground:Hv.a.One,this._rasterColorizerConfig.colorizerType=n,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?qv.H.Noop:qv.H.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(yb,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,t,i,r,s,n,o){const a=this._rctx,l=t.sourceLayerInfo.data,c=t.tile.surface.layerViewByIndex(t.layerIndex,zy.MAP),u=e.baseOpacity<1||e.opacity<1||e.blendMode!==Vv.iM.Normal||o!==Hv.B.Composite;let h;this._getBlendLayersTechnique(e.blendMode,o,e.baseOpacity<1,u).bindPipelineState(a),u?(h=this._acquire(s),a.bindFramebuffer(h),a.setClearColor(0,0,0,0),a.clearSafe(Er.lk.COLOR_BUFFER_BIT|Er.lk.DEPTH_BUFFER_BIT)):n&&a.clearSafe(Er.lk.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(a,t.sourceLod,l,c.painter,c.layer.styleRepository,c.schemaHelper,Math.round(1/t.scale),t.offset,r,i)}catch(e){wb.warnOnce("A render call containing vector tiles did not resolve correctly.",e)}return!(0,I.pC)(h)||(a.bindFramebuffer(this._currentFBO),e.texture=h.colorTexture,e.offset=gr.Z,e.scale=1,this.drawRasterData(o,e,u),h.release(),n)}copyFBOToTexture(e){const t=this._rctx,i=t.bindTexture(e.texture,Hs.x.TEXTURE_UNIT_FOR_UPDATES),r=e.descriptor;t.gl.copyTexImage2D(Er.No.TEXTURE_2D,0,r.pixelFormat,0,0,r.width,r.height,0),e.generateMipmap(),t.bindTexture(i,Hs.x.TEXTURE_UNIT_FOR_UPDATES)}_initFBO(e,t){this._rctx.bindFramebuffer(e),this._rctx.setViewport(0,0,t,t),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Er.lk.COLOR_BUFFER_BIT|Er.lk.DEPTH_BUFFER_BIT)}_acquire(e){return this._fboPools[this._poolToWrite].acquire(e)}bindPool(e,t){this._poolToWrite=e,null==this._doubleBufferFbo[e]&&(this._doubleBufferFbo[e]=this._acquire(t),this._initFBO(this._doubleBufferFbo[e],t))}_switchPool(e){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=0===this._poolToWrite?1:0,this.bindPool(this._poolToWrite,e)}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO()}cleanupFBOPool(e,t){e===this._lastPixelRatio&&t===this._lastNumLayers||(this._fboPools.forEach((e=>e.clear())),this._lastPixelRatio=e,this._lastNumLayers=t)}}class Cb{constructor(e,t,i){this._rctx=e,this.tileSize=t,this._techniqueRepository=i,this._passParameters=new jv,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new xb(this._rctx,this._techniqueRepository),this._blackTex=new E_((0,Lr.YO)(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=(0,I.O3)(this._composition),this._backgroundTexture=(0,I.RY)(this._backgroundTexture),this._blackTex=(0,I.RY)(this._blackTex)}get backgroundIsGrid(){return(0,I.Wi)(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,t){if(!e.renderData)return;const i=e.surface,r=i.baseOpacity;this._numTexturedLayer=0;let s=0,n=this.tileSize,o=!1;const a=i.view.state.pixelRatio;let l=!1;const c=e.layerInfo[zy.MAP];let u=c.length,h=0;for(;h<c.length;h++){const t=i.layerViewByIndex(h,zy.MAP),d=t.fullOpacity;if(Sb[h]=d,(0,Ce.sy)(t.layer)&&u>=c.length&&(u=h),0===d){c[h].pendingUpdates&=~(A_.TEXTURE_NOFADING&A_.TEXTURE_FADING);continue}++s;const p=Tb(e,h);if(p){if(c[h].pendingUpdates&=~(A_.TEXTURE_NOFADING&A_.TEXTURE_FADING),(0,Ug.TK)(t)){const e=(0,Ug.CY)(t.layer.parent)?"normal":t.layer.blendMode;Eb[h]=e;const i="normal"!==e;i&&(l=i,o=!1)}(0,Ug.Q)(t)?n=Math.max(n,this.tileSize*a):1===r&&1===d&&(t.isOpaque||this._dataToTexture(p)&&p.sourceLayerInfo.data.descriptor.isOpaque)&&(o=!0),++this._numTexturedLayer}}this._composition.cleanupFBOPool(a,c.length),n=function(e){const t=(0,$.Sf)(e),i=t*t,r=e*e;if(i===r)return e;const s=t/2;return i-r<r-s*s?t:s}(n);const d=n/this.tileSize,p=h-1;this._ensureBackgroundTexture(this.tileSize),0!==this._numTexturedLayer?1===this._numTexturedLayer&&!l&&this._useLayerTexture(e,p,u,Sb[p])||this._composeMapLayers(e,t,p,u,Sb,Eb,n,d,!o||l):this._useBackgroundTexture(e,s)}_ensureBackgroundTexture(e){(0,I.Wi)(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,e),this._passParameters.offset=gr.Z,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=Vv.iM.Normal,(0,I.pC)(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,(0,I.pC)(this.backgroundColor)?Hv.B.ColorOnly:Hv.B.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1)}_useBackgroundTexture(e,t){let i=f_.Immediate;(e.surface.view.layerViewManager.updating||t>0)&&(i=f_.Delayed),this._backgroundTexture&&(0,I.Wi)(e.renderData.textureReference)&&(i=f_.Immediate),e.renderData.setTextureReference((0,I.pC)(this._backgroundTexture)?new Zv(this._backgroundTexture,By.Ns.FADING,Mb,e.surface.baseOpacity,1,0):null,i)}_useLayerTexture(e,t,i,r){const s=t<i,n=s?1:e.surface.baseOpacity,o=s?e.surface.baseOpacity:1,a=Tb(e,t);return!!this._dataToTexture(a)&&(e.renderData.setTextureReference(new Zv(a.sourceLayerInfo.data,By.Ns.FADING,a,n,r,o)),!0)}_composeMapLayers(e,t,i,r,s,n,o,a,l){this._composition.bindPool(0,o);const c=e.surface.baseOpacity;let u=!1,h=Er.cw.LINEAR_MIPMAP_LINEAR,d=!1,p=0;for(let t=i;t>=0;t--){const i=Tb(e,t);if(!i)continue;if(0===s[t])continue;const f=t<r&&c<1&&!u;this._passParameters.baseOpacity=f?c:1,f&&(u=!0);const m=0===p,g=l&&m?this.backgroundIsGrid?Hv.B.GridComposite:Hv.B.ColorComposite:Hv.B.Composite;(0,Ug.Ke)(i)?(this._passParameters.opacity=s[t],this._passParameters.blendMode=Vv.pU[n[t]],d=this._composition.drawVectorData(this._passParameters,i,a,this.tileSize,o,d,g)):(0,Ug.Ay)(i)?(this._passParameters.opacity=s[t],this._passParameters.blendMode=Vv.pU[n[t]],this._composition.drawImageryTileData(i,g,this._passParameters),this._hasNearestInterpolation(i)&&(h=Er.cw.NEAREST)):this._dataToTexture(i)&&(this._passParameters.texture=i.sourceLayerInfo.data.texture,this._passParameters.offset=i.offset,this._passParameters.scale=i.scale,this._passParameters.opacity=s[t],this._passParameters.blendMode=Vv.pU[n[t]],this._composition.drawRasterData(g,this._passParameters)),p++}const f=e.renderData.ensureTexture(o,(()=>this._buildTexture(o,h)));this._composition.copyFBOToTexture(f),this._composition.releasePool(),e.renderData.setTextureReference(new Zv(f,t,Mb,u?1:c,1,0))}_hasNearestInterpolation(e){const t=e.sourceLayerInfo.data;return!!t.source&&"nearest"===t.interpolation}_dataToTexture(e){return(0,Ug.L4)(e)&&this._rasterDataToTexture(e),(0,Ug.z7)(e)}_rasterDataToTexture(e){const t=e.sourceLayerInfo;t.data=this._buildTexture(t.data),e.tile.setMemoryDirty()}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,t=Er.cw.LINEAR_MIPMAP_LINEAR){if((0,I.Wi)(e))return null;const i={target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.CLAMP_TO_EDGE,samplingMode:t,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},r=this._rctx;let s;if("number"==typeof e)i.width=i.height=e,s=new E_(new Hs.x(r,i));else if(e instanceof Dg.nN)i.isOpaque=e.isOpaque,s=new E_(new Hs.x(r,i,e.image)),e.release();else try{s=new E_(new Hs.x(r,i,e))}catch(e){s=new E_((0,Lr.l_)(r)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const n=r.bindTexture(s.texture,Hs.x.TEXTURE_UNIT_FOR_UPDATES);return s.generateMipmap(),r.bindTexture(n,Hs.x.TEXTURE_UNIT_FOR_UPDATES),s}get test(){return{backgroundTexture:this._backgroundTexture}}}function Tb(e,t){Ab.layerIndex=t;const i=e.layerInfo[zy.MAP][t];if((0,I.pC)(i.data))return(0,mr.a)(Ab.offset,0,0),Ab.tile=e,Ab.scale=1,Ab.sourceLod=e.lij,Ab.sourceLayerInfo=i,Ab;const r=i.upsampleInfo;if((0,I.pC)(r)){const e=r.tile.layerInfo[zy.MAP][t];return Ab.tile=r.tile,(0,mr.c)(Ab.offset,r.offset),Ab.scale=r.scale,Ab.sourceLod=r.tile.lij,Ab.sourceLayerInfo=e,Ab}return null}const Sb=new Array,Eb=new Array,Ab={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},Mb={offset:[0,0],scale:1},Ob=1e-6;class Rb{constructor(e,t,i,r,s){this.aabb=e,this.axis=t,this.d=i,this.midStartIndex=r,this.rightStartIndex=s}}class Pb{constructor(e,t,i,r){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=t,this.positionAttribute=r,this.rayDirection=(0,me.c)(),this.bspNodeTree=new Array,this.vertexPositionBuffer=r.data,this.vertexPositionStride=r.stride;const s=i-t,n=s<=Nb?new Uint16Array(s):new Uint32Array(s);this.indices=n;for(let e=0;e<s;++e)n[e]=e;{const o=function(e,t,i,r,s){const n=i-t,o=new Float32Array(6*n);for(let i=0;i<n;++i){const n=3*(i+t),a=e[n+0]*s,l=e[n+1]*s,c=e[n+2]*s;for(let e=0;e<3;++e){const t=r[a+e],s=r[l+e],n=r[c+e];o[6*i+e]=Math.min(t,s,n),o[6*i+3+e]=Math.max(t,s,n)}}return o}(e,t,i,r.data,r.stride),a=(0,$.uZ)(Math.log2(s/40),2,10),l=(e,t,i)=>{const r=function(e,t,i,r){if(r<=i)return(0,Rp.al)(NaN,NaN,NaN,NaN,NaN,NaN);{const r=6*e[i];for(let e=0;e<3;++e)Lb[e]=t[r+0+e],Db[e]=t[r+3+e]}for(let s=i+1;s<r;++s){const i=6*e[s];for(let e=0;e<3;++e)Lb[e]=Math.min(Lb[e],t[i+0+e]),Db[e]=Math.max(Db[e],t[i+3+e])}return(0,Rp.al)(Lb[0],Lb[1],Lb[2],Db[0],Db[1],Db[2])}(n,o,e,t),s=t-e;if(s<=40){const i=new Rb(r,void 0,0,e,t);return this.bspNodeTree.push(i),i}const{axis:c,midValue:u}=function(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}(r),h=function(e,t,i,r,s,n){let o=i,a=r;for(;o<a;){const i=e[o];t[6*i+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=i)}let l=o;for(a=r;l<a;){const i=e[a-1];t[6*i+s]>=n?--a:(e[a-1]=e[l],e[l]=i,++l)}return{next:o,mid:l}}(n,o,e,t,c,u),d=(e,t)=>{if(i>a)return;const r=t-e;return r<40||r>=.8*s?void 0:l(e,t,i+1)},p=new Rb(r,c,u,h.next,h.mid);return this.bspNodeTree.push(p),p.leftNode=d(e,h.next),p.rightNode=d(h.mid,t),p};l(0,s,0),this.triangleVertexIndices=function(e,t,i,r){const s=r-i;let n=0;for(let e=i;e<r;++e)for(let i=0;i<3;++i)n=Math.max(t[3*e+i],n);const o=n<=Nb?new Uint16Array(3*s):new Uint32Array(3*s);for(let r=0;r<s;++r){const s=3*(e[r]+i);for(let e=0;e<3;++e){const i=t[s+e];o[3*r+e]=i}}return o}(n,e,t,i)}}intersectRayTriangleRange(e,t){{if(e>=t)return;const i=this.triangleVertexIndices,r=this.positionAttribute.data,s=this.positionAttribute.stride,n=this.rayOrigin,o=n[0],a=n[1],l=n[2],c=this.rayDirection,u=c[0],h=c[1],d=c[2];for(let n=e,c=3*e;n<t;++n){const e=i[c]*s,t=r[e],p=r[e+1],f=r[e+2],m=i[c+1]*s,g=r[m],y=r[m+1],_=r[m+2],v=i[c+2]*s,b=r[v],w=r[v+1],x=r[v+2];c+=3;const C=g-t,T=y-p,S=_-f,E=b-t,A=w-p,M=x-f,O=h*M-A*d,R=d*E-M*u,P=u*A-E*h,I=C*O+T*R+S*P;if(Math.abs(I)<=Number.EPSILON)continue;const L=o-t,D=a-p,N=l-f,F=L*O+D*R+N*P;if(I>0){if(F<0||F>I)continue}else if(F>0||F<I)continue;const k=D*S-T*N,U=N*C-S*L,V=L*T-C*D,z=u*k+h*U+d*V;if(I>0){if(z<0||F+z>I)continue}else if(z>0||F+z<I)continue;const B=(E*k+A*U+M*V)/I;if(B>=0){const e=this.indices[n]+this.firstTriangleIndex,t=(0,Mv.Mw)(C,T,S,E,A,M,Ib);this.callback(B,t,e,!1)}}}Pb.numFacesTested+=t-e}intersectRay(e,t){Pb.numFacesTested=0;const i=(0,me.f)(e.r0[0],e.r0[1],e.r0[2]),r=(0,me.f)(e.r1[0],e.r1[1],e.r1[2]),s=r[0]-i[0],n=r[1]-i[1],o=r[2]-i[2];if(s*s+n*n+o*o<Ob)return;this.rayOrigin=i;const a=this.rayDirection;a[0]=s,a[1]=n,a[2]=o;const l=this.triangleVertexIndices.length/3;this.callback=t;const c=this.bspNodeTree[0];this.intersectRayBSP(c,0,l)}intersectRayBSP(e,t,i){const r=this.rayOrigin,s=this.rayDirection;if(!function(e,t,i){const r=t,s=i;let n=0,o=1/0;for(let t=0;t<3;++t){{const i=e[t];if(r[t]<i){if(s[t]<=Ob)return!1;const e=(i-r[t])/s[t];n=Math.max(n,e)}else if(s[t]<=-1e-6){const e=(i-r[t])/s[t];o=Math.min(o,e)}if(n>o)return!1}{const i=e[t+3];if(r[t]>i){if(s[t]>=-1e-6)return!1;const e=(i-r[t])/s[t];n=Math.max(n,e)}else if(s[t]>=Ob){const e=(i-r[t])/s[t];o=Math.min(o,e)}if(n>o)return!1}}return!0}(e.aabb,r,s))return;const n=e.axis,o=e.d;if(r[n]<o||s[n]<0){const i=t,r=e.midStartIndex;if(i<r){const t=e.leftNode;void 0!==t?this.intersectRayBSP(t,i,r):this.intersectRayTriangleRange(i,r)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),r[n]>o||s[n]>0){const t=e.rightStartIndex,r=i;if(t<r){const i=e.rightNode;void 0!==i?this.intersectRayBSP(i,t,r):this.intersectRayTriangleRange(t,r)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}Pb.numFacesTested=0;const Ib=(0,me.c)(),Lb=[1/0,1/0,1/0],Db=[-1/0,-1/0,-1/0],Nb=65535;var Fb=s(25714),kb=s(97582),Ub=s(8106),Vb=s(7358),zb=s(22456),Bb=s(79040);class Hb extends Cr.A{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,t){t.spherical=e.viewingMode===Nt.JY.Global}initializeProgram(e){const t=Hb.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const t=this.configuration,i=t.backfaceCullingEnabled&&!t.renderOccluded;return(0,Ar.sm)({blending:t.renderOccluded?(0,Ar.if)(Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA):null,culling:i&&Ar.Rd,depthTest:!t.renderOccluded&&{func:Er.wb.LESS},depthWrite:!t.renderOccluded&&Ar.LZ,colorWrite:Ar.BK,stencilTest:e?(0,Bb.iV)(Bg.hU.IntegratedMeshMaskExcluded):null})}getPipelineState(e,t){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,t)}}Hb.shader=new xr.J(Ub.a,(()=>s.e(5618).then(s.bind(s,65618))));var jb=s(3864),Gb=s(86942);class Wb extends Gb.W{constructor(){super(...arguments),this.output=Fb.H.Color,this.overlayMode=kb.gT.Disabled,this.tileBlendInput=gb.R.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=(0,b.Z)("enable-feature:terrain-shading")}}(0,t._)([(0,Or.o)({count:Fb.H.COUNT})],Wb.prototype,"output",void 0),(0,t._)([(0,Or.o)({count:kb.gT.COUNT})],Wb.prototype,"overlayMode",void 0),(0,t._)([(0,Or.o)({count:gb.R.COUNT})],Wb.prototype,"tileBlendInput",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"spherical",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"atmosphere",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"receiveShadows",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"hasSlicePlane",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"backfaceCullingEnabled",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"stencilEnabled",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"textureFadingEnabled",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"renderOccluded",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"hasScreenSpaceReflections",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"hasCloudsReflections",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"tileBorders",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"screenSizePerspective",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"receiveAmbientOcclusion",void 0),(0,t._)([(0,Or.o)()],Wb.prototype,"shading",void 0),(0,t._)([(0,Or.o)({constValue:!0})],Wb.prototype,"isGround",void 0),(0,t._)([(0,Or.o)({constValue:jb.f7.Disabled})],Wb.prototype,"pbrMode",void 0),(0,t._)([(0,Or.o)({constValue:!1})],Wb.prototype,"highStepCount",void 0),(0,t._)([(0,Or.o)({constValue:!1})],Wb.prototype,"useCustomDTRExponentForWater",void 0),(0,t._)([(0,Or.o)({constValue:!1})],Wb.prototype,"useFillLights",void 0);const Zb=(0,Rp.Ue)(),qb=(0,pr.c)();let $b=class extends O.Z{constructor(e){super(e),this.type=Ym.q7.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new Wb,this._passParameters=new Ub.T,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new Uv,this.renderDataPool=new _f.Z(W_),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new g_.AA,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Vb.yD.Occlude}get isGlobal(){return this.stage.viewingMode===Nt.JY.Global}get shadingEnabled(){return this._techniqueConfiguration?.shading}initialize(){const e=[On.r.OPAQUE_TERRAIN,On.r.TRANSPARENT_TERRAIN,On.r.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),l_.clear()}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return Lc.cy}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender()}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?Gy.Qi:Vb.yD.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,(0,I.pC)(this.tileRenderer)&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,A_.TEXTURE_FADING)}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()}updateTileTexture(e,t){(0,I.pC)(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(e,t===A_.TEXTURE_FADING?By.Ns.FADING:By.Ns.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(e){for(const t of e.layerInfo[zy.ELEVATION])t.pendingUpdates&=~A_.GEOMETRY;e.resetPendingUpdate(A_.GEOMETRY),e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=Math.max(0,7*Math.floor((e.level-3)/7));if(this.isGlobal&&0===t)return me.Z;for(;e.parent&&e.level>t;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll((e=>{e.isLoaded&&(this.updateTileGeometry(e),e.updateNeighborsAfterGeometryChange())})),this.setNeedsRender())}setNeedsRender(e=Bg.Xx.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this.tileRenderer=new Cb(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=(0,Lr.l_)(this.rctx)}uninitializeRenderContext(){this.emptyTex=(0,I.O3)(this.emptyTex),this.tileRenderer=(0,I.O3)(this.tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=Jb,n=Kb;(0,dr.b)(s,r,i),(0,dr.s)(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===Ym.eC.MIN,u=!!e.results.ground.target,h=(0,Lc.lV)(e.verticalOffset),d=e.tolerance;let p,f=c&&(0,I.pC)(o.dist)?o.dist:1/0;const m=u=>{const m=u.renderData;if(!m?.vao)return;const g=m.geometryInfo;(0,Rp.t8)(Zb,g.boundingBox);const y=m.localOrigin;(0,I.pC)(h)&&(h.localOrigin=y,h.applyToAabb(Zb));const _=Zb;if(Qb[0]=i[0]-y[0],Qb[1]=i[1]-y[1],Qb[2]=i[2]-y[2],!(0,Mv.Fw)(_,Qb,n,d,f))return;const v=(e,t,i)=>{e.set(this.type,u,t,i,kr.I),f=c&&(0,I.pC)(o.dist)?o.dist:1/0},b=(n,c)=>{if((0,I.pC)(c)&&n>=0&&(e.options.backfacesTerrain||(0,dr.e)(c,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||null==t||t(i,r,n))){if((null==l.dist||n<l.dist)&&v(l,n,c),e.options.isFiltered)return;e.options.store===Ym.eC.ALL&&((0,I.Wi)(p)?(p=(0,No.LP)(e.ray),v(p,n,c),e.results.all.push(p)):n<p.dist&&v(p,n,c)),(null==o.dist||n<o.dist)&&v(o,n,c),e.options.store!==Ym.eC.MIN&&(null==a.dist||n>a.dist)&&v(a,n,c)}},w=ew;(0,dr.b)(w,r,y);const x=g.indices,C=g.vertexAttributes,T={data:C.getField(zs.T.POSITION,Fv.ct).typedBuffer,size:3,stride:C.stride/4},S=g.indexCount/3;if((0,I.Wi)(h)&&S>200){const e=u.renderData;(0,I.Wi)(e.intersectionData)&&(e.intersectionData=new Pb(x,0,S,T)),e.intersectionData.intersectRay({r0:Qb,r1:w},b)}else(0,Mv.CN)(Qb,w,0,S,x,T,null,h,b)},g=this._rootTiles;(0,I.pC)(g)&&(()=>{const t=this.tileIterator;t.reset(g);const r=e.options.invisibleTerrain;for(;!t.done;){const e=t.next();!(e.visible||r&&e.intersectsClippingArea)||!(0,I.pC)(h)&&!e.intersectsRay(i,s,d,f)||u&&this._useStencilForTile(e)?t.skipSubtree():m(e)}})()}prepareTechnique(e){if(e.bindParameters.slot===On.r.OCCLUDED_TERRAIN){if(0==(e.renderOccludedMask&Gy.Qi))return null}else{const t=this.opaque?On.r.OPAQUE_TERRAIN:On.r.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case Mn.C.MATERIAL:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=(0,I.pC)(e.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?kb.gT.Disabled:this.overlayRenderer.hasWater?kb.gT.EnabledWithWater:kb.gT.Enabled;const t=e.bindParameters.slot===On.r.OCCLUDED_TERRAIN?jy.$e.Occluded:jy.$e.ColorAndWater;return this._updateTechnique(Fb.H.Color,t===jy.$e.Occluded)}case Mn.C.MATERIAL_DEPTH_SHADOWMAP_ALL:case Mn.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&1===e.bindParameters.lighting.globalFactor?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Fb.H.Shadow,!1)):null;case Mn.C.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Fb.H.Depth,!1));case Mn.C.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Fb.H.Normal,!1);case Mn.C.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Fb.H.Highlight,!1)):null}return null}render(e,t){const i=e.pass,r=1===e.bindParameters.lighting.globalFactor;switch(this._updatePatchGroups(),t.useStencil=!1,i){case Mn.C.MATERIAL:{const i=e.bindParameters.slot===On.r.OCCLUDED_TERRAIN?jy.$e.Occluded:jy.$e.ColorAndWater;this._renderMaterialPass(e,t,i);break}case Mn.C.MATERIAL_DEPTH_SHADOWMAP_ALL:case Mn.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,jy.$e.None);break;case Mn.C.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,jy.$e.None);break;case Mn.C.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,jy.$e.None);break;case Mn.C.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,jy.$e.Highlight),e.rctx.clearSafe(Er.lk.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,i):e.offscreenRenderingHelper.renderToTargets((()=>this._renderPatchGroups(e,t,i)),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,i){const r=e.rctx;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,i)}updateTileBackground(e=null){if((0,I.Wi)(this.tileRenderer))return;const t=this.tileRenderer;let i=null;if((0,I.pC)(e)){const t=r.Z.toUnitRGBA(e);i=(0,me.f)(t[0]||0,t[1]||0,t[2]||0)}t.setBackground(i),this.allTiles.forAll((e=>t.updateTileTexture(e,By.Ns.FADING))),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?gb.R.GridComposite:(0,I.pC)(t.backgroundColor)?gb.R.ColorComposite:gb.R.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==Pv.NONE){const e=Array.from(this._patchGroups.values());e.forEach((e=>(0,g_.zW)(this.renderOrder,e))),e.sort(((e,t)=>(0,g_.dF)(e[0],t[0],this.renderOrder))),this._patchGroups=new Map(e.map((e=>[e[0].renderData.localOrigin,e])))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(!(0,I.Wi)(e)){e[0]?.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const t of e)this._rebuildPatchGroupsForRootTile(t)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const e=t.next(),i=e.renderData;if(!i||e.visible)if(e.rendered){if(i){const r=this._patchGroups.get(i.localOrigin)||new Array;this._patchGroups.set(i.localOrigin,r),r.push(e),(!this.highestVisibleLODTile||e.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=e),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i){const r=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach((s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new zb.w(n),e.bindParameters);for(let n=0;n<s.length;n++)this._renderPatch(e,t,s[n],Er.MX.TRIANGLES,r,i)})),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i){const r=e.rctx,s=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const e=(0,Yd.Gw)(this.stage.viewingMode,this.ellipsoidRadius),t=this.pointsOfInterest.centerOnSurfaceFrequent.distance;e.update({distance:t,fovY:s.fovY})}const o=this.stencilEnabledLayerExtents.length>0,a=i===jy.$e.Occluded;a&&(n.bindTexture("tex",this.emptyTex),n.setUniform1f("blend",1),n.setUniform4fv("texOffsetAndScale",pr.Z));const l=(0,I.pC)(this.tileRenderer)&&(0,I.pC)(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:me.Z;this._techniqueConfiguration.tileBlendInput===gb.R.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Er.MX.LINES:Er.MX.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach((r=>{const s=r[0].renderData.localOrigin;t.program.bindDraw(new zb.w(s),e.bindParameters),this.numOriginsRendered++;for(let s=0;s<r.length;s++){const l=r[s],u=l.renderData.textureReference;if(!(0,I.Wi)(u)){if(!a){this._scaleRangeQueries.scaleQueriesForTile(l),Xb(l.renderData.geometryInfo.uvOffsetAndScale,u.offsetAndScale,qb),n.setUniform4fv("texOffsetAndScale",qb),n.bindTexture("tex",u.texture.texture);const e=l.renderData.textureFadeFactor,t=e<1?l.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&(0,I.pC)(t)&&e<1?(Xb(l.renderData.geometryInfo.uvOffsetAndScale,t.offsetAndScale,qb),n.setUniform1f("fadeFactor",e),n.setUniform4fv("nextTexOffsetAndScale",qb),n.setUniform3fv("nextTexOpacities",t.opacities),n.bindTexture("texNext",t.texture.texture)):n.setUniform1f("fadeFactor",1),l.renderData.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",u.opacities)}this._renderPatch(e,t,l,c,o,i),l.renderOrder=this.numTilesRendered,this.numTilesRendered++}}})),r.bindVAO(null)}_renderPatch(e,t,i,r,s,n){const o=i.renderData,a=o.vao,l=a.indexBuffer;if((0,I.Wi)(l))return;const c=t.program;n!==jy.$e.None&&this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.bindParameters.slot));const u=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,u,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===Fb.H.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(Hb,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};(0,t._)([(0,m.Cb)({constructOnly:!0})],$b.prototype,"overlayRenderer",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],$b.prototype,"stage",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],$b.prototype,"isGlobal",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],$b.prototype,"allTiles",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],$b.prototype,"ellipsoidRadius",void 0),(0,t._)([(0,m.Cb)({value:!1})],$b.prototype,"renderingDisabled",null),(0,t._)([(0,m.Cb)()],$b.prototype,"renderPatchBorders",null),(0,t._)([(0,m.Cb)()],$b.prototype,"cullBackFaces",null),(0,t._)([(0,m.Cb)({value:Pv.FRONT_TO_BACK})],$b.prototype,"renderOrder",null),(0,t._)([(0,m.Cb)()],$b.prototype,"wireframe",null),$b=(0,t._)([(0,y.j)("esri.views.3d.terrain.TerrainRenderer")],$b);const Yb=$b;function Xb(e,t,i){i[0]=e[0]*t[2]+t[0],i[1]=e[1]*t[3]+t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3]}const Jb=(0,me.c)(),Kb=(0,me.c)(),Qb=(0,me.c)(),ew=(0,me.c)();class tw{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}var iw=s(56545);let rw=class extends O.Z{constructor(e){super(e),this._handles=new Ae.Z}initialize(){this._handles.add(this.layers.on("change",(()=>this._update()))),this._handles.add((0,he.YP)((()=>this.extentHelper.layerViewsExtent),(()=>this._setAdHocTilingScheme()))),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=(0,I.SC)(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some((t=>!(!(0,Ce.iC)(t)||t.isRejected()||t.isFulfilled()&&!function(e,t,i){return(0,I.pC)((0,Ug.E_)(e,t,i))}(t,this.viewSpatialReference,this.viewingMode)||(e=t,"vector-tile"===t?.type||(0,Ug.x4)(t))))),e)if(e.isResolved()){const t=(0,Ug.E_)(e,this.viewSpatialReference,this.viewingMode);if((0,I.pC)(t)){const e=new iw.t(t.tileInfo);this._lockTilingScheme(e)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch((()=>{})).then((()=>{t!==this._waitTask||this.destroyed||this._update()}));this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Nt.JY.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=iw.t.makeWebMercatorAuxiliarySphere(t):(0,_e.jF)(e.spatialReference)&&(e=iw.t.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add((0,he.YP)((()=>this.extentHelper.tiledLayersExtent),(()=>this._updateTiledLayerExtent())))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Nt.JY.Global){const e=this.extentHelper.viewSpatialReference,t=(0,_e.jF)(e)||(0,$e.BZ)(e)||(0,$e.V2)(e);e.isWebMercator?this.tilingScheme=iw.t.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=iw.t.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;(0,I.pC)(e)&&!(0,ve.fS)(e,this.extent)&&(this.tilingScheme=iw.t.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};(0,t._)([(0,m.Cb)()],rw.prototype,"tilingScheme",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],rw.prototype,"extent",void 0),(0,t._)([(0,m.Cb)({value:!1})],rw.prototype,"tilingSchemeLocked",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],rw.prototype,"viewSpatialReference",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],rw.prototype,"layers",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],rw.prototype,"extentHelper",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],rw.prototype,"viewingMode",void 0),rw=(0,t._)([(0,y.j)("esri.views.3d.terrain.TilingSchemeLogic")],rw);class sw{constructor(){this.offset=(0,gr.a)(),this.scale=0,this.tile=null}init(e,t,i,r){this.tile=e,this.offset[0]=t,this.offset[1]=i,this.scale=r}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const nw=p.Z.getLogger("esri.views.3d.terrain.TerrainSurface");let ow=class extends(P.Z.EventedMixin(O.Z)){constructor(e){super(e),this._elevationBounds=new Iy,this._iteratorPool=new _f.Z(g_.AA,(e=>e.remove=()=>this._iteratorPool.release(e))),this._postorderIterator=new g_.rv,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new tw,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=(0,me.c)(),this._eyePosSurfaceSR=(0,me.c)(),this._splitLimits=new I_,this._snapLevel=1/0,this._frustum=(0,gf.Ue)(),this._viewProjectionMatrix=(0,kr.c)(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Ae.Z,this._watchUpdatingTracking=new Ke.t,this._frameTask=nt.sq,this._allTiles=new Nd.Z,this._upsampleInfoPool=new _f.Z(sw),this._rootTilesExtent=(0,ve.Ue)(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!e.view?.state?.isLocal}initialize(){this._lercDecoder=(0,Oy.w)(this.view.resourceController),this._tilePool=this.view.state.isLocal?new _f.Z(Ov):new _f.Z(Iv);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",(e=>e.unloadMapData())),this._elevationQueryCache=new My(e.newCache("elevation-query")),this._set("overlayManager",new Xy({surface:this})),this._handles.add([(0,he.YP)((()=>this.overlayManager.hasHighlights),(e=>this._renderer.setNeedsHighlight(e))),(0,he.YP)((()=>this.overlayManager.rendersOccluded),(e=>this._renderer.setRenderOccludedOverlay(e)))],"overlayManager"),this._renderer=new Yb({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:(0,fr.Iu)(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([(0,he.YP)((()=>this.baseOpacity),(e=>{this._handleLayerViewChanges(),this._updateBaseOpacity(e)}),he.tX),(0,he.YP)((()=>this.hasCompositeBlendMode),(()=>{this._updateBaseOpacity(this.baseOpacity)}),he.tX),(0,he.YP)((()=>this.renderingDisabled),(()=>this._updateTransparentTerrain()),he.Z_),(0,he.YP)((()=>this.backgroundColor),(e=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(e)}),he.tX),(0,he.YP)((()=>this.view.pointsOfInterest),(e=>{this._renderer.pointsOfInterest=e,this._watchUpdatingTracking.removeAll(),e&&this._watchUpdatingTracking.add((()=>e.focus.renderLocation),(()=>()=>this._allTilesSorted=!1))})),(0,he.YP)((()=>kd.Z.TERRAIN_TILE_TREE_SHOW_TILES),(e=>{e&&!this._treeDebugger?s.e(6532).then(s.bind(s,66532)).then((({TerrainTileTree3DDebugger:e})=>{!this._treeDebugger&&kd.Z.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new e({view:this.view}))})):e||(this._treeDebugger=(0,I.SC)(this._treeDebugger))}),he.nn)]),this._extentHelper=function(e,t){return e===Nt.JY.Global?new ky(t):new Uy(t)}(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new R.Z({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map((({layers:e})=>e)),getChildrenFunction:e=>e&&"layers"in e?e.layers:null}):this.view.map.allLayers,i=new rw({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Og.Bh.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Og.Bh.BASEMAP);const r=this.view.resourceController.scheduler;this._frameTask=r.registerTask(nt.T8.TERRAIN_SURFACE,this),this._handles.add([(0,he.YP)((()=>this._extentHelper.stencilEnabledExtents),(e=>this._renderer.setStencilEnabledLayerExtents(e)),he.nn),(0,he.YP)((()=>this.tilingSchemeLogic.tilingScheme),(()=>this._updateTilingScheme()),he.Z_),(0,he.YP)((()=>this.extent),(()=>this._updateRootTiles()),he.nn),this.view.on("resize",(()=>this._viewChangeUpdate())),(0,he.YP)((()=>{const e=this.view,t=e.state;return[this.lodBias,this.lodSnapping,e.resourceController?.memoryController?.memoryFactor,t.camera,t.contentCamera,t.fixedContentCamera]}),(()=>this._viewChangeUpdate()),he.tX),(0,he.YP)((()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration),(e=>this._renderer.textureFadingEnabled=e>0),he.nn),(0,he.YP)((()=>this._userClippingExtent),(()=>this._updateClippingExtent()),he.Z_)]),this._handles.add(this.view.allLayerViews.on("after-changes",(()=>this._layerViewsDirty=!0))),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=(0,I.RY)(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=(0,I.SC)(this._upsampleMapCache),this._elevationQueryCache=(0,I.SC)(this._elevationQueryCache),this._set("tilingSchemeLogic",(0,I.SC)(this.tilingSchemeLogic)),this._extentHelper=(0,I.SC)(this._extentHelper),this._basemapLayerViewHandles.forEach(((e,t)=>this._unregisterTiledLayerView(t))),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",(0,I.SC)(this.overlayManager)),this._tilePool=(0,I.SC)(this._tilePool),L_.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=(0,I.SC)(this._renderer),this._iteratorPool=(0,I.SC)(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=(0,I.SC)(this._upsampleInfoPool),(0,Ry.K)(),S_.size>0&&(console.log(`${S_.size} live TilePerLayerInfo allocations:`),S_.forEach((e=>console.log(e,"\n"))))}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){const e=this.view.pointsOfInterest?.contentCameraOnSurface?.scale;if(e){const t=this.view.state.contentCamera;let i=qu(this.view,t.eye,t.viewForward,t.up).tilt;i>90&&(i=180-i);const r=2*(i/90)**2,s=th(this.view,e)-r;Math.abs(this._snapLevel-s)>.25&&(Math.round(s)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=s)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?By.VB.ON:By.VB.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if((0,I.Wi)(t)||(0,I.Wi)(e))return null;const i=(0,ve.Ue)(),r=(0,Bf.G)(t,i,e)?i:null,s=this._get("extent");return(0,ve.fS)(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=(0,ve.jV)(this.groundExtent,this._userClippingExtent,(0,ve.Ue)()),t=this._get("extent");return(0,ve.fS)(e,t)?t:e}get groundExtent(){return(0,I.pC)(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return(0,I.pC)(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){return this.tilingScheme?.spatialReference??null}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain()}_updateTransparentTerrain(){const e=!this.renderingDisabled&&!this.opaque;this.view?._stage?.renderView.setRenderParameters({transparentTerrain:e})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=this.getTileWithElevation(e,t,i,r,uw);return(0,I.Wi)(s)?null:Dy(uw[0],uw[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=uw){const n=this.rootTiles;if((0,I.Wi)(n)||!n.length)return null;if(0===n[0].layerInfo[zy.ELEVATION].length)return null;if(s[0]=e,s[1]=t,s[2]=i,!(0,_e.SH)(s,r,s,this.tilingScheme?.spatialReference))return nw.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let e of n){if(!e.containsPoint(s))continue;for(;e&&!e.rendered&&!e.isLeaf;){let t=0;s[0]>.5*(e.extent[0]+e.extent[2])&&(t+=1),s[1]<.5*(e.extent[1]+e.extent[3])&&(t+=2),e=e.children[t]}const t=e.renderData;return t&&t.geometryState.samplerData?e:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!(0,_e.KC)(e,uw,this.spatialReference))return nw.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if((0,I.pC)(t))for(let e of t)if(e?.containsPoint(uw)){for(;!e.isLeaf&&!e.rendered;){let t=0;uw[0]>e.children[0].extent[2]&&(t+=1),uw[1]<e.children[0].extent[1]&&(t+=2),e=e.children[t]}return this._getLodBiasCorrectedScale(e.level)}}return 1e100}getSphereElevationBounds(e,t,i,r,s){if(uw[0]=e,uw[1]=t,uw[2]=i,uw[3]=r,!(0,_e.SH)(uw,s,uw,this.tilingScheme?.spatialReference))return nw.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=e=>{if(e&&(0,ve.hr)(e.extent,uw))if(e.isLeaf||e.rendered)n=Math.min(n,e.elevationBounds[0]),o=Math.max(o,e.elevationBounds[1]);else for(const t of e.children)a(t)},l=this.rootTiles;if((0,I.pC)(l))for(const e of l)a(e);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!(0,_e.KC)(e,uw,this.spatialReference))return nw.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;uw[3]=t;let i=null;const r=e=>{if(e&&(0,ve.hr)(e.extent,uw))if(e.isLeaf||e.rendered){const t=this._getLodBiasCorrectedScale(e.level);i=null==i?t:Math.min(i,t)}else for(const t of e.children)r(t)},s=this.rootTiles;if((0,I.pC)(s))for(const e of s)r(e);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+o,n+o,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const i=t!==this._renderer.opaque;i&&this._updateTransparentTerrain(),this._updateTileTextures(i?By.Ns.UNFADED:By.Ns.IMMEDIATE)}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&((0,Ug.wu)(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return dw[0]=e,dw[1]=t,dw[2]=i,s.init(dw,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=hw;let r=t.rootTilesInExtent(e,i,5*Ne.$r);if((0,I.pC)(this.rootTiles)){if(r.length>Ne.$r)return void nw.warn(Ne.Tg);const e=this.rootTiles.map((e=>e.lij)),t=(0,v.e5)(e,r,lw);if(this._updatingRootTiles=!0,t.removed.length>0||t.added.length>0){const e=this.rootTiles.filter((e=>!(t.removed.findIndex((t=>lw(t,e.lij)))>-1&&(this._purgeTile(e,!0),1))));t.added.forEach((t=>e.push(this._newRootTile(t)))),this._setRootTiles(e)}}else this._updatingRootTiles=!0,r.length>Ne.$r&&(nw.warn(Ne.iU),r=t.rootTilesInExtent(e,i,Ne.$r)),this._setRootTiles(r.map((e=>this._newRootTile(e))));(0,ve.fS)(i,this._rootTilesExtent)||(this._rootTilesExtent=(0,ve.Ue)(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach((e=>{e.isLoaded&&this._prepareToLoadTile(e)})),this._allTiles.forAll((e=>{e.isLoaded&&(this._updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e))})),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===A_.SPLIT&&t.setPendingUpdate(A_.SPLIT),this._loadTile(t),this.deferTileNeighborUpdate||t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),(0,I.pC)(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(A_.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if((0,I.Wi)(e))return;const t=(0,g_.t8)(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const e=a.next();e.updateClippingStatus(n)&&e.resetPendingUpdate(A_.GEOMETRY)&&this._updateTileGeometry(e),e.setPendingUpdate(A_.RENDERDATA);const t=e.computeVisibility();s||t?(e.updateScreenDepth(o),e.renderData&&(i=Math.min(e.elevationBounds[0],i),r=Math.max(e.elevationBounds[1],r))):a.skipSubtree()}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?((0,I.Wi)(this._splitLimits.frustum)&&(this._splitLimits.frustum=(0,gf.Ue)()),(0,gf.JG)(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,(0,gf.JG)(this._frustum,e.frustum),(0,Fr.m)(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),(0,dr.c)(this._eyePosRenderSR,t.eye),(0,_e.SH)(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(cw(e)?(this._loadChildren(e),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(e),e.children.forEach((e=>e.checkGeometryWaterproofness())))):function(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e),this._elevationUpdate(e),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e)}_updateTileNeighborsAfterGeometryChange(e,t){if(this.deferTileNeighborUpdate){const t=this.neighborTilesToUpdate;e.forEachLoadedNeighbor((e=>{t.add(e)}))}else e.updateNeighborsAfterGeometryChange(t)}_updateTileTexture(e,t){const i=e.resetPendingUpdate(A_.TEXTURE_FADING)?A_.TEXTURE_FADING:!!e.resetPendingUpdate(A_.TEXTURE_NOFADING)&&A_.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_elevationUpdate(e){fw.spatialReference=this.spatialReference,fw.tile=e,fw.extent=e.extent,this.emit("elevation-change",fw)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run((()=>this._updateElevation(e))),e.run((()=>this._updateTextures(e))),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const e=t.next();if(e.loadable){const i=e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(i===A_.SPLIT){e.resetPendingUpdate(A_.MERGE),e.isLeaf&&(e.setPendingUpdate(A_.SPLIT),t.skipSubtree());continue}e.resetPendingUpdate(A_.SPLIT)&&e.updateAgentSuspension(),i===A_.VSPLITMERGE&&e.updateAgents(zy.ELEVATION)}if(t.skipSubtree(),!e.isLeaf){e.setPendingUpdate(A_.MERGE),e.resetPendingUpdate(A_.SPLIT);const t=this._iteratorPool.acquire();t.resetOne(e);for(let e=t.next();!t.done;e=t.next())this._updateClippingStatus(e),e.updateVisibility(),e.loadable&&e.updateScreenDepth(this._viewProjectionMatrix);t.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||((0,g_.b)(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_prepareBatchTileGeometryUpdate(){(0,Ug.Fp)(0===this.neighborTilesToUpdate.size),this.deferTileNeighborUpdate=!0}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const e=this.neighborTilesToUpdate;(()=>{for(const t of e)t.updateNeighborDataAndGeometryIfNeeded()})(),(()=>{for(const t of e)t.updateNeighborsWithChangedEdgeResolution()})(),e.clear()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let i=!1;for(;!e.done;){i=!0;let r=!1;const s=!this._allTiles.some((i=>{if(i.resetPendingUpdate(A_.MERGE)){if(!t)return i.setPendingUpdate(A_.MERGE),e.done;this._mergeTile(i),r=!0,e.madeProgress()}else i.resetPendingUpdate(A_.SPLIT)&&(this._splitTile(i),r=!0,e.madeProgress());return!e.done&&i.resetPendingUpdate(A_.RENDERDATA)&&(this._updateRenderData(i),e.madeProgress()),e.done}));if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(!r)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}i||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(e)}_updateElevation(e){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some((t=>(t.resetPendingUpdate(A_.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done))),this._batchUpdateUpdatedTileNeighbors(),e.hasProgressed}_updateTextures(e){return this._allTiles.some((t=>(this._updateTileTexture(t,e),e.done))),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Bg.Xx.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Ne.DR}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=(0,$.uZ)(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){(0,I.pC)(this.rootTiles)&&(this.rootTiles.forEach((e=>this._purgeTile(e,!1))),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let i=0;i<4;++i)t=this._purgeTile(e.children[i],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&this._updateTileNeighborsAfterGeometryChange(e),this._tilePool.release(e),i}_unloadTile(e){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e),e.unload(this._renderer)}_splitTile(e){(0,Ug.wu)(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(A_.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){mw.spatialReference=this.spatialReference,mw.extent=e.extent,mw.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",mw)}_createTile(e,t,i,r){(0,Ug.wu)(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===A_.SPLIT&&s.setPendingUpdate(A_.SPLIT)),s}_mergeTile(e){(0,Ug.wu)(!e.hasPendingUpdate(A_.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&((0,Ug.wu)(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._updateTileNeighborsAfterGeometryChange(e),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e)}_checkTileNeighborsWaterproofness(e){Ug.XJ&&e.forallNeighbors((e=>!!e.isLoaded&&(e.checkGeometryWaterproofness(),!0)))}_loadChildren(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e),(0,Ug.wu)(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach((e=>this._prepareToLoadTile(e))),t.forEach((e=>this._loadTilePrepared(e))),this._updateTileNeighborsAfterGeometryChange(e,e.level+1),this.deferTileNeighborUpdate||(t.forEach((e=>e.updateNeighborsWithChangedEdgeResolution())),t.forEach((e=>e.checkGeometryWaterproofness())),this._checkTileNeighborsWaterproofness(e))}_loadParent(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._updateTileNeighborsAfterGeometryChange(t),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(t)}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const i=e.children[t];this._unloadChildren(i),this._unloadTile(i)}}_postLoadTile(e){e.setPendingUpdate(A_.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_loadTile(e){e.load(this._renderer),this._postLoadTile(e)}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e)}_prepareToLoadTile(e){e.prepareToLoad(this._renderer)}_elevationDataArrived(e,t,i){const r=new Ly(e.lij,e.extent,i);e.dataArrived(t,zy.ELEVATION,r);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const e=o.next();e.findElevationBoundsForLayer(t,n),e.computeElevationBounds()}o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=nt.G5){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const e of this.view.allLayerViews.items)if(i.add(e.uid),(0,Ug.wP)(e))if(this._basemapLayerViewHandles.has(e.uid)){const i=this._layerClassFromLayerView(e),s=this._getLayerIdxByUID(i,e.uid);(0,I.pC)(s)&&((s<r||(0,I.Wi)(r))&&(t=!0),r=s)}else this._registerTiledLayerView(e),e.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach(((e,r)=>{i.has(r)||(this._unregisterTiledLayerView(r),t=!0)})),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress()}_allSurfaceLayersTransparent(){let e=0===this.view.map?.ground?.opacity;for(const t of this.view.allLayerViews.items)if((0,Ug.GL)(t)&&!(0,Ce.sy)(t.layer)&&0!==t.fullOpacity)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((0,Ug.TK)(e)){const t=(0,Ug.CY)(e.layer.parent)?"normal":e.layer.blendMode;if((0,Vv.MV)(Vv.pU[t]))return!0}return!1}_layerClassFromLayerView(e){return(0,Ug._1)(e)?zy.ELEVATION:zy.MAP}_registerTiledLayerView(e){const t=[],i=this._layerClassFromLayerView(e);t.push((0,he.YP)((()=>e.suspended),(()=>this._updateTiledLayers()))),t.push((0,he.YP)((()=>e.fullOpacity),(()=>this._updateTileTextures(By.Ns.UNFADED)))),t.push((0,he.YP)((()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null),(()=>this._restartAllAgents(i)))),(0,Ug.TK)(e)&&t.push((0,he.YP)((()=>e.layer.blendMode),(()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(By.Ns.UNFADED)}))),e.on("data-changed",(()=>{const t=this._getLayerIdxByUID(i,e.uid);(0,I.pC)(t)&&this._invalidateLayerData(t,i)})),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let e=0;e<t.length;e++)t[e].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;e.forEach((e=>{if(!e.layer||e.suspended||!(0,Ug.wP)(e)||!e.fullExtent)return;const r=this._layerClassFromLayerView(e);if(r===zy.MAP){const t=e.displayLevelRange.maxLevel;t!==1/0&&(null===i||t>i)&&(i=t)}t[r].push(e)}));for(const e of Hy){const i=this._layerViews[e],r=t[e];r.reverse();const s=r.length;let n=i.length!==s;const o=new Array(s),a=new Array(i.length);this._layerIndexByUid[e].clear();for(let t=0;t<s;t++){const s=r[t].uid;this._layerIndexByUid[e].set(s,t);const l=i.indexOf(r[t]);o[t]=l,t!==l&&(n=!0),l>-1&&(a[l]=t)}if(n){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;)t.next().modifyLayers(a,o,e);this._layerViews[e]=r,this._restartAllAgents(e),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===zy.ELEVATION&&i.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll((t=>{t.updateAgents(zy.MAP),e===By.Ns.IMMEDIATE?this.renderer.updateTileTexture(t,A_.TEXTURE_NOFADING):t.updateRenderData(zy.MAP,e)})),this._renderer.isTransparent=this._allSurfaceLayersTransparent()}_invalidateLayerData(e,t){this._allTiles.forAll((i=>i.removeLayerAgent(e,t))),this._allTiles.forAll((i=>i.invalidateLayerData(e,t)))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Bg.Xx.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){1==++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||(0,Ug.Q)(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...r,timeout:6e3}).then((()=>--this._asyncWorkItems)).catch((t=>{throw--this._asyncWorkItems,(0,f.D_)(t)||this._dataMissing(e,i,s,{notInTilemap:!0}),t})).then((()=>this._frameTask.schedule((()=>this._requestTileData(e,i,s,r)),r.signal))))}_requestTileData(e,t,i,r){return t===zy.ELEVATION?(0,Ug._1)(i)?this._requestElevationTileData(e,i,r):Promise.reject():(0,Ug.GL)(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;const r=r=>{if((0,f.Hc)(i))return;const s=this._layerIndexByUid[zy.ELEVATION].get(t.uid);null!=s?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,s,r)):nw.warn("TerrainSurface: received data from unknown layer %d %s",zy.ELEVATION,e.lij.toString())},s=i=>{(0,f.D_)(i)||(this._dataMissing(e,zy.ELEVATION,t,i),this.requestUpdate())};if((0,Ug.FZ)(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:Ne.$7,signal:i.signal}).then((e=>{if(!(0,f.Hc)(i))return this._frameTask.schedule((()=>r(e)),i.signal,s);nw.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")}),s).finally((()=>{--this._asyncWorkItems}));const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",i).then((e=>this._lercDecoder.decode(e,{noDataValue:Ne.$7},i.signal))).then((e=>{e?r({values:e.pixelData,width:e.width,height:e.height,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue}):s(new Error("LERC decoding failed"))}),s).finally((()=>{--this._asyncWorkItems}))}_requestMapTileData(e,t,i){++this._asyncWorkItems;const r=(r,s)=>{--this._asyncWorkItems,(0,Ug.z4)(s),(0,f.Hc)(i)||(this._dataMissing(e,zy.MAP,t,r),this.requestUpdate())},s=e=>t=>r(t,e),n=r=>this._frameTask.schedule((()=>{--this._asyncWorkItems,this.requestUpdate(),(0,f.Hc)(i)?(0,Ug.z4)(r):this._mapTileDataArrived(e,t,r)}),i.signal,s(r)).catch(s(r)),o=(e,t=null)=>this._frameTask.schedule((()=>r(e,t)));if((0,Ug.Q)(t)){const r=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(r[0],r[1],r[2],i).then(n,o)}if((0,Ug.sR)(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(n,o);if((0,Ug.FH)(t)&&(0,Ug.FZ)(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then((e=>{if((0,f.Hc)(i))return nw.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o((0,f.zE)());n(e)}),o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);(0,Ay.d)(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(n,o)}_mapTileDataArrived(e,t,i){const r=this._getLayerIdxByUID(zy.MAP,t.uid);(0,I.pC)(r)?e.dataArrived(r,zy.MAP,i):((0,Ug.z4)(i),nw.warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i,r){const s=this._getLayerIdxByUID(t,i.uid);(0,I.pC)(s)?e.dataMissing(s,t,r):nw.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll((e=>{e.renderData&&this.overlayManager.setTileParameters(e)})),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll((t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))})),e}getUsedMemory(){return this.tilingScheme?((0,I.Wi)(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),(0,I.pC)(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce(((e,t)=>e+t.usedMemory),0):null}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return(0,I.pC)(r)&&this._allTiles.forAll((e=>t+=e.getUsedMemoryForLayer(i,r))),t}getTile(e){if((0,I.Wi)(e)||(0,I.Wi)(this.rootTiles))return null;const t=e.split("/").map((e=>+e));if(0===t[0])return this.rootTiles.find((e=>e.lij[1]===t[1]&&e.lij[2]===t[2]));const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let n;if(this.rootTiles.some((e=>e.lij[1]===r&&e.lij[2]===s&&(n=e,!0))),n){let e=1<<t[0]-1;for(;n.lij[0]<t[0];){let i=t[1]&e?2:0;if((t[2]&e)>0&&i++,!n.children[i])return null;n=n.children[i],e>>=1}return(0,Ug.wu)(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{(0,I.pC)(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){pw.clear(),e._allTiles.forAll((e=>{e.visible&&e.rendered&&pw.push(e)}));const t=pw.toArray();return(0,g_.zW)(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTileWaterproofness(){if(!Ug.XJ)return;const e=this.rootTiles;if((0,I.Wi)(e))return;const t=e=>e?.renderData?.geometryInfo?.indices?.length>0??!1,i=(e,i)=>{t(e)&&console.error("Tile[",e.lij,"] has geometry although parent[",i.lij,"] has geom")},r=e=>{if(e.renderData&&!e.renderData.geometryState&&console.error("Tile[",e.lij,"] has renderData but not geometryState"),e.renderData&&!e.renderData.geometryInfo&&console.error("Tile[",e.lij,"] has renderData but not geometryInfo"),!e.renderData?.geometryInfo||(e.renderData.geometryInfo.indices?.length??0)>0||console.error("Tile[",e.lij,"] has renderData but no indices - geometryInfo: ",e.renderData.geometryInfo),t(e)){e.checkGeometryWaterproofness();for(const t of e.children)i(t,e)}else if(e.isLeaf)console.error("Tile[",e.lij,"] has no geometry and no children, from root to leaf");else for(const t of e.children)r(t)},s=e=>{const t=e.parent?.visible??!0,i=e.visible;e.computeVisibility();const r=e.visible;if(i!==r&&t&&console.error(" Tile[",e.lij,"] has out of date visibility: ",i," instead of ",r),!e.isLeaf)for(const t of e.children)s(t)};for(const t of e)r(t),s(t)}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){return!!this.tilingScheme?.spatialReference.isWebMercator}get isWebMercatorOnPlateeCarree(){return this.isWebMercator&&(0,$e.QM)(this.view?.renderSpatialReference)}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&0===e[2]}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this.isGlobal)return null;const r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}};(0,t._)([(0,m.Cb)()],ow.prototype,"_renderer",void 0),(0,t._)([(0,m.Cb)()],ow.prototype,"_hasPendingUpdates",void 0),(0,t._)([(0,m.Cb)()],ow.prototype,"_asyncWorkItems",void 0),(0,t._)([(0,m.Cb)()],ow.prototype,"_allTilesDirty",void 0),(0,t._)([(0,m.Cb)()],ow.prototype,"_allTilesSorted",void 0),(0,t._)([(0,m.Cb)()],ow.prototype,"_viewChanged",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"_watchUpdatingTracking",void 0),(0,t._)([(0,m.Cb)()],ow.prototype,"_frameTask",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"snapLevel",null),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"lodSnapping",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],ow.prototype,"view",void 0),(0,t._)([(0,m.Cb)()],ow.prototype,"_userClippingExtent",null),(0,t._)([(0,m.Cb)()],ow.prototype,"_rootTilesExtent",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"extent",null),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"groundExtent",null),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"_tilingSchemeExtent",null),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"updating",null),(0,t._)([(0,m.Cb)(Py.q)],ow.prototype,"updatingProgress",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"updatingProgressValue",null),(0,t._)([(0,m.Cb)()],ow.prototype,"_maxNumUpdating",void 0),(0,t._)([(0,m.Cb)({aliasOf:"view.map.ground.opacity"})],ow.prototype,"baseOpacity",void 0),(0,t._)([(0,m.Cb)()],ow.prototype,"hasCompositeBlendMode",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"overlayManager",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"viewingMode",null),(0,t._)([(0,m.Cb)()],ow.prototype,"maxTextureScale",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"ready",null),(0,t._)([(0,m.Cb)({value:Pv.FRONT_TO_BACK})],ow.prototype,"renderOrder",null),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"rootTiles",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"spatialReference",null),(0,t._)([(0,m.Cb)({type:r.Z,aliasOf:"view.map.ground.surfaceColor"})],ow.prototype,"backgroundColor",void 0),(0,t._)([(0,m.Cb)({value:!1})],ow.prototype,"slicePlaneEnabled",null),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"tilingScheme",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],ow.prototype,"tilingSchemeLocked",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],ow.prototype,"tilingSchemeLogic",void 0),(0,t._)([(0,m.Cb)({value:!0})],ow.prototype,"velvetOverground",null),(0,t._)([(0,We.B)("_renderer.wireframe")],ow.prototype,"wireframe",void 0),(0,t._)([(0,m.Cb)({value:!1})],ow.prototype,"suspended",null),(0,t._)([(0,m.Cb)({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],ow.prototype,"textureFadeDuration",void 0),(0,t._)([(0,m.Cb)()],ow.prototype,"_layerViewsDirty",void 0),(0,t._)([(0,We.B)("_renderer.renderPatchBorders")],ow.prototype,"renderPatchBorders",void 0),(0,t._)([(0,We.B)("_renderer.renderingDisabled")],ow.prototype,"renderingDisabled",void 0),ow=(0,t._)([(0,y.j)("esri.views.3d.terrain.TerrainSurface")],ow);const aw=ow;function lw(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function cw(e){return!e.isLeaf&&(e.children.some((e=>e.shouldLoad))||e.children.some((e=>cw(e))))}const uw=(0,pr.c)(),hw=(0,ve.Ue)(),dw=[0,0,0],pw=new Nd.Z,fw={spatialReference:null,tile:null,extent:null,context:"ground"},mw={spatialReference:null,extent:null,scale:0};var gw=s(93718),yw=s(2236),_w=s(95607),vw=s(53464),bw=s(79341);let ww=class extends O.Z{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach(((t,i)=>this.commitLayer(i,e)))}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach(((i,r)=>{const s=this._ensureGeomRecord(e,r);i.forEach(((e,i)=>{const n=e[0],o=e[1],a=e[2];let l=!1;if(o&bw.$.Geometry.UPDATE){const e=s.get(i);if(e){const i=e[1];if(a&bw.$.State.TRANSFORMATION){const e=this.model.getObject(r);this.model.updateRenderGeometryTransformation(e,n,i)&&(l=!0)}l||t.updates.push({renderGeometry:i,updateType:a})}else(0,nn.hu)(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(o&bw.$.Geometry.REMOVE||l){const e=s.get(i);e?(t.removes.push(e[1]),s.delete(i),e[0].disposed&&_w.k.pool.release(e[0])):o===bw.$.Geometry.REMOVE&&(0,nn.hu)(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(o&bw.$.Geometry.ADD||l){const e=this.model.getObject(r);if((0,I.pC)(e)){const r=this.model.getRenderGeometry(e,n),o=[n,r];t.adds.push(r),s.set(i,o)}}})),0===s.size&&this._residentGeomRecords.get(e).delete(r)})),0===this._residentGeomRecords.get(e).size&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach((e=>e.forEach((e=>t.push(e[1])))))}_objectStateChanged(e,t){for(const i of t.geometryRecords)this._updateOrCreateDirtyRecord(t,i,null,bw.$.Geometry.UPDATE,0,0,bw.$.Geometry.UPDATE,bw.$.Geometry.ADD|bw.$.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(bw.$.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(bw.$.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(bw.$.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,bw.$.Geometry.UPDATE,0,0,bw.$.Geometry.UPDATE,bw.$.Geometry.ADD|bw.$.Geometry.REMOVE,bw.$.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll((t=>this._layerObjectAdded(e,t)))}layerRemoved(e){e.objects.forAll((t=>this._layerObjectRemoved(e,t)))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const e of t.geometryRecords)this._objectGeometryAdded(t,e,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const e of t.geometryRecords)this._objectGeometryRemoved(t,e,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach(((e,t)=>{const i=this.model.getObject(t);i&&i.hasVolativeTransformation()&&e.forEach((e=>{e[1].shaderTransformationChanged()}))}))}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach((i=>{this._updateOrCreateDirtyRecord(e,i[0],t,bw.$.Geometry.UPDATE,0,0,bw.$.Geometry.UPDATE,bw.$.Geometry.ADD|bw.$.Geometry.REMOVE,bw.$.State.TRANSFORMATION)}))}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,bw.$.Geometry.ADD,bw.$.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,bw.$.Geometry.REMOVE,bw.$.Geometry.ADD,bw.$.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,i,r,s,n,o,a,l){i=(0,I.Pt)(i,this._getParentLayerId(e));const c=e.id,u=t.id,h=this._ensureDirtyRecord(i,c),d=h.get(u);if(d){const e=d[1];e&s?(h.delete(u),d[0].disposed&&_w.k.pool.release(d[0])):e&n?(d[1]=r,d[2]=l):e&o?d[2]|=l:e&a||(0,nn.hu)(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else h.set(u,[t,r,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return(0,Je.oE)(this._dirtyGeomRecords,(e=>(0,Je.oE)(e,(e=>e&&e.size>0))))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return(0,I.pC)(e.parentLayer)?e.parentLayer.id:qp.u}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach(((i,r)=>{i.forEach(((i,s)=>{t.length>0&&(t+="\n"),t+=r+"."+s;const n=[];i.forEach((e=>{const t=e[1];n[t]||(n[t]=[]),n[t].push(e[0].geometry.id)}));for(let i=0;i<n.length;i++)if(n[i]){t+=" "+e[i-1]+": ";for(let e=0;e<n[i].length;e++)t+=n[i][e]+", "}}))})),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce(((e,t)=>e+t.size),0)}}}};(0,t._)([(0,m.Cb)({constructOnly:!0})],ww.prototype,"model",void 0),(0,t._)([(0,m.Cb)()],ww.prototype,"dirty",void 0),ww=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.lib.ModelDirtySet")],ww);const xw=ww;var Cw=s(96047);let Tw=class extends O.Z{constructor(){super(...arguments),this.dirtySet=new xw({model:this}),this._content=new Map,this._originFactory=new vw.C(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;(0,nn.hu)(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),(0,tf.e)(e)&&this.dirtySet.layerAdded(e)}remove(e){(0,nn.hu)(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),(0,tf.e)(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)(0,I.pC)(t)&&((0,nn.hu)(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)(0,nn.hu)(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach((i=>{i.type===e&&t(i)}))}getRenderGeometry(e,t){const{geometry:i,material:r,id:s,shaderTransformation:n,origin:o,instanceParameters:a}=t,l=new Cw.z(i,r,{id:s,boundingInfo:i.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return l.updateTransformation((i=>e.getCombinedStaticTransformation(t,i))),l.origin=o||this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=a,l}updateRenderGeometryTransformation(e,t,i){if((0,I.Wi)(e))return!1;i.updateTransformation((i=>e.getCombinedStaticTransformation(t,i)));const r=this._originFactory.getOrigin(i.boundingSphere);return i.origin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<$p.U.COUNT;++i)e[i]=t.filter((e=>e.type===i)).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};(0,t._)([(0,m.Cb)({constructOnly:!0})],Tw.prototype,"dirtySet",void 0),Tw=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.parts.Model")],Tw);var Sw=s(86717),Ew=s(14789),Aw=s(78565),Mw=s(66352),Ow=s(47850),Rw=s(86098);class Pw{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return 0===this._indexRanges.length}componentCount(){const e=this._indexRanges;let t=0;for(let i=0;i<e.length;i+=2)t+=e[i+1];return t}reset(e){"all"===e||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=function(e){const t=new Array;if(0===e.length)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){const n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}(e)}forEachComponent(e){const t=this._indexRanges;for(let i=0;i<t.length;i+=2){const r=t[i],s=r+t[i+1];for(let t=r;t<s;t++)if(!e(t))return!1}return!0}forEachComponentRange(e){const t=this._indexRanges;for(let i=0;i<t.length;i+=2){const r=t[i];if(!e(r,r+t[i+1]))return!1}return!0}computeOffsetRanges(e){const t=new Array(this._indexRanges.length),i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1],o=e[s],a=e[n];t[r]=o,t[r+1]=a-o}return t}}class Iw extends gw.Xn{constructor(e,t){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=(0,Rw.tP)(t);const i=this.count;this.visibility=new Pw(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let e=0;e<i;e++)this.materialDataIndices[e]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return(0,I.Wi)(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return(0,I.Wi)(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return(0,I.Wi)(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if(((0,I.Wi)(this.cachedHighlightRanges)||(0,I.Wi)(this.cachedDefaultRanges))&&(0,I.pC)(this.highlightCounts)){const{highlightRanges:e,defaultRanges:t}=function(e,t,i){const r=[],s=[];let n=i.length,o=i.length;return t.forEachComponent((t=>(e[t]>0?(n!==t-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[t])),n=t):(o!==t-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[t])),o=t),!0))),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=t}}}var Lw=s(15318);function Dw(e,t,i,r){if(i>=t)return e;null==e&&(e=function(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}());const s=e.isVisibleBit;let n=e.data;const o=Fw(n),a=i/o|0,l=i-o*a,c=(t-1)/o|0,u=n,h=r===s;if(!(i<u.length*o)&&h){const e=1.5,t=a+1,i=Math.ceil(u.length*e),r=c+1;let s=Math.max(t,i);s=Math.min(s,r),n=new Uint32Array(s),n.set(u)}return a<n.length&&(n[a]=function(e,t,i){return e&~(1<<t)|(i?1:0)<<t}(n[a],l,h)),e.data=n,e}function Nw(e,t){if(null==e)return!0;const{isVisibleBit:i,data:r}=e,s=Fw(r);return t<r.length*s?function(e,t,i,r){const s=i/r|0,n=i-s*r;return function(e,t){return 0!=(e&1<<t)}(t[s],n)===e}(i,r,t,s):!e.isVisibleBit}function Fw(e){return 8*e.BYTES_PER_ELEMENT}var kw=s(36620);class Uw{constructor(e,t){this._indices=(0,I.pC)(e.indices)?e.indices:(0,kw.p)(e.positions.length/3),this._positions=new Fv.ct(e.positions),this._components=t,this._componentIntersectionData=new Array(t.count)}getComponentAabb(e,t){if((0,I.pC)(this._perComponentAabbs)){for(let i=0;i<6;i++)t[i]=this._perComponentAabbs[6*e+i];return t}return this._computePerComponentAabbs(),this.getComponentAabb(e,t)}getComponentPositions(e,t){t.indices=this._indices,t.data=this._positions.typedBuffer,t.stride=this._positions.typedBufferStride,t.startIndex=this._components.offsets[e],t.endIndex=this._components.offsets[e+1]}intersect(e,t,i,r,s,n,o){const a={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},l=this._indices,c=this._components.offsets,u=(0,Mv.Ue)(e,t,Vw),h=e[2],d=t[2];this._components.visibility.forEachComponent((p=>{if(!Nw(this._components.pickability,p))return!0;const f=this.getComponentAabb(p,zw);if((0,I.pC)(n)){const i=n[p];(0,I.pC)(s)?s.componentOffset=i:(e[2]=h-i,t[2]=d-i)}if((0,I.pC)(s)&&s.applyToAabb(f),!(0,Mv.Tw)(f,e,u,i))return!0;const m=c[p]/3,g=c[p+1]/3,y=(e,t,i)=>{o(p,e,(0,dr.t)(t,t,r),i)},_=g-m;return(0,I.Wi)(s)&&_>200?(null==this._componentIntersectionData[p]&&(this._componentIntersectionData[p]=new Pb(this._indices,m,g,a)),this._componentIntersectionData[p].intersectRay({r0:e,r1:t},y)):(0,Mv.CN)(e,t,m,g,l,a,void 0,s,y),!0}))}_computePerComponentAabbs(){const e=this._components.count;this._perComponentAabbs=new Float32Array(6*e);const t=this._indices,i=this._positions.typedBuffer,r=this._positions.typedBufferStride,s=this._components.offsets;let n=0;for(let o=0;o<e;o++){const e=s[o],a=s[o+1];let l=1/0,c=1/0,u=1/0,h=-1/0,d=-1/0,p=-1/0;for(let s=e;s<a;s++){const e=t[s]*r,n=i[e],o=i[e+1],a=i[e+2];l=Math.min(l,n),c=Math.min(c,o),u=Math.min(u,a),h=Math.max(h,n),d=Math.max(d,o),p=Math.max(p,a)}this._perComponentAabbs[n++]=l,this._perComponentAabbs[n++]=c,this._perComponentAabbs[n++]=u,this._perComponentAabbs[n++]=h,this._perComponentAabbs[n++]=d,this._perComponentAabbs[n++]=p}}get positions(){return this._positions}get indices(){return this._indices}}const Vw=(0,me.c)(),zw=(0,Rp.Ue)();class Bw{constructor(e,t,i){this.material=e,this.geometry=t,this.meta=i}dispose(){this.material.dispose(),this.geometry.dispose()}}class Hw extends gw.Xn{constructor(e,t,i,r){super(),this.primitiveType=t,this.parameters=i,this.indexed=r,this.vao=e}}function jw(e){return e?Gw(e,1/0,-1/0):{near:1/0,far:-1/0}}function Gw(e,t,i){return e.near=t,e.far=i,e}function Ww(e,t,i=e){return i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far),i}function Zw(e,t){return e.near<=t&&t<=e.far}(0,t._)([(0,gw.gT)()],Hw.prototype,"vao",void 0);const qw={near:0,far:0};const $w=new Nd.Z({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),Yw=jw(),Xw=(0,me.c)(),Jw=(0,me.c)(),Kw=new Nd.Z({deallocator:null}),Qw=new Nd.Z({deallocator:null});function ex(e,t,i){i.length=0;const r=t.length-3;tx(Xw,t,r);const s=(0,Ol.jH)(e,Xw);s<=0&&(i.push(Xw[0]),i.push(Xw[1]),i.push(Xw[2]));let n=0,o=s;for(;n<r;n+=3){tx(Jw,t,n);const r=(0,Ol.jH)(e,Jw);o*r<0&&((0,dr.h)(Xw,Jw,Xw,r/(r-o)),ix(i,Xw)),r<=0&&ix(i,Jw),o=r,(0,dr.c)(Xw,Jw)}o*s<0&&(tx(Jw,t,r),(0,dr.h)(Xw,Jw,Xw,s/(s-o)),ix(i,Xw))}function tx(e,t,i){return(0,dr.s)(e,t.data[i+0],t.data[i+1],t.data[i+2])}function ix(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function rx(e,t,i,r){(0,Ur.c)(ax,e.quaternion),(0,dr.v)(lx,t,e.center),(0,dr.q)(lx,lx,ax);const s=8*((lx[0]<-e.halfSize[0]?-1:lx[0]>e.halfSize[0]?1:0)+3*(lx[1]<-e.halfSize[1]?-1:lx[1]>e.halfSize[1]?1:0)+9*(lx[2]<-e.halfSize[2]?-1:lx[2]>e.halfSize[2]?1:0)+13),n=sx[s];if(0===n)return n;(0,as.g)(ox,e.quaternion),(0,as.d)(ox,ox,e.halfSize);const o=(t,i)=>{const r=sx[s+i+1];return(0,dr.s)(t,((1&r)<<1)-1,(2&r)-1,((4&r)>>1)-1),(0,dr.t)(t,t,ox),(0,dr.a)(t,e.center,t)};return i.length=0,ix(i,o(cx,0)),ix(i,o(ux,1)),ix(i,o(lx,2)),ix(i,o(hx,3)),r(i),1===n||(i.length=0,ix(i,cx),ix(i,hx),ix(i,o(lx,4)),ix(i,o(dx,5)),r(i),2===n||(i.length=0,ix(i,cx),ix(i,dx),ix(i,o(lx,6)),ix(i,ux),r(i))),n}const sx=(()=>{const e=new Int8Array(216);let t=0;const i=i=>{for(let r=0;r<i.length;r++)e[t+r]=i[r];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),nx=4,ox=(0,Ga.c)(),ax=(0,Vr.a)(),lx=(0,me.c)(),cx=(0,me.c)(),ux=(0,me.c)(),hx=(0,me.c)(),dx=(0,me.c)();class px{constructor(e){this._objects=e}submit(e,t){this._objects.preSubmit(t),this._objects.visibleObjects.forAll((i=>i.renderable.material.submit(e,t,i)))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?function(e,t){const i=jw(),{eye:r,frustum:s,viewForward:n}=e;t.forAll((e=>{const t=(0,I.pC)(e.offsetObb)?e.offsetObb:e.obb,o=(0,dr.e)((0,dr.v)(lx,t.center,r),n),a=(0,Ow.xz)(t,n);if(Zw(i,o-a)&&Zw(i,o+a))return;const l=function(e,t){let i=0;for(let r=0;r<nx;r++){const s=(0,Ow.hZ)(e,t[r]);if(s>0)return-1;0===s&&(i|=1<<r)}return i}(t,s);if(-1===l)return;if(0===l)return Yw.far=o+a,Yw.near=o-a,void Ww(i,Yw);const c=$w.pushNew();c.near=o-a,c.far=o+a,c.mask=l,c.object=e}));for(let e=0;e<$w.length;e++){const t=$w.data[e];if(Zw(i,t.near)&&Zw(i,t.far))continue;Yw.far=t.far,Yw.near=1/0;const o=rx((0,I.pC)(t.object.offsetObb)?t.object.offsetObb:t.object.obb,r,Kw,(e=>{let i=Qw;for(let r=0;r<nx&&e.length>0;r++){if(0==(t.mask&1<<r))continue;ex(s[r],e,i);const n=e;e=i,i=n}for(let t=0;t<e.length;t+=3){(0,dr.s)(Xw,e.data[t+0],e.data[t+1],e.data[t+2]);const i=(0,dr.e)((0,dr.v)(Xw,Xw,r),n);Yw.near=Math.min(Yw.near,i)}}));0===o&&(Yw.near=0),Ww(i,Yw)}return $w.length=0,i}(e,this._objects.visibleObjects):null}}var fx=s(67920),mx=s(68848),gx=s(22919),yx=s(9004),_x=s(5331),vx=s(12045);class bx extends Cr.A{bindDraw(e,t){const i=this.program;i.bindDraw(e,t),i.rebindTextures(),e.componentParameters.type===gx._N.Varying&&e.componentParameters.texture.bind(i,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(e,t){t.spherical=e.viewingMode===Nt.JY.Global,t.doublePrecisionRequiresObfuscation=(0,_x.I)(e.rctx)}initializeProgram(e){const t=bx.shader.get(),i=t.build(this.configuration);return new Sr.$(e.rctx,i,t.attributeLocations)}_setPipelineState(e){const t=this.configuration,i=t.integratedMeshMode!==mx.OH.None,r=e===Bg.Am.NONE,s=e===Bg.Am.FrontFace;return(0,Ar.sm)({blending:t.output!==Fb.H.Color&&t.output!==Fb.H.Alpha||!t.blendingEnabled?null:r?vx.wu:(0,vx.j7)(e),culling:(0,Ar.zp)(t.cullFace),depthTest:{func:(0,vx.Bh)(e)},depthWrite:r||s?Ar.LZ:null,colorWrite:Ar.BK,stencilWrite:i||t.hasOccludees?Bb.s3:null,stencilTest:i?(0,Bb.ec)(Bg.hU.IntegratedMeshMaskExcluded):t.hasOccludees?Bb.RY:null,polygonOffset:r||s?t.hasPolygonOffset?{factor:2,units:2}:null:vx.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}bx.shader=new xr.J(yx.C,(()=>s.e(5736).then(s.bind(s,35736))));var wx=s(98135);class xx extends Pr.K{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,null!=this._parameterBlocks)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==this._parameterBlocks)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}}class Cx{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Tx(e={}){return(t,i)=>{const r=t._parameterCount??0;if(t._parameterCount=r+1,e.vectorOps){const s=e.vectorOps;Object.defineProperty(t,i,{get(){return this[r]},set(e){const t=this[r];if(null==t)this[r]=e;else{if(s.equals(t,e))return;s.copy(t,e)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[r]},set(t){this[r]!==t&&(e.dispose&&this[r]&&this[r].dispose(),this[r]=t,this._setDirty())}})}}function Sx(){return(e,t)=>{const i=e._parameterCount??0;e._parameterCount=i+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(i),Object.defineProperty(e,t,{get(){return this[i]},set(e){this[i]!==e&&(this[i]=e,this._setDirty())}})}}var Ex=s(17e3),Ax=s(90511),Mx=s(2833),Ox=s(44391),Rx=s(94283);class Px{constructor(e){this._low=(0,cs.c)(),this._high=(0,cs.c)(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){const t=this._low,i=this._high;(0,dr.c)(t,e),(0,dr.v)(i,e,t)}setElements(e,t,i){(0,dr.s)(Ix,e,t,i),this.set(Ix)}get(e){return(0,dr.a)(e,this._low,this._high)}getLowScaled(e){return(0,dr.g)(e,this._low,1)}}const Ix=(0,me.c)();class Lx extends xx{constructor(e,t){super(),this.toMapSpace=t,this.baseColor=(0,pg.f)(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=(0,cs.f)(1,1,.5),this.emissiveFactor=(0,cs.f)(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new kx,this.componentParameters=new Ux,this.textureAlphaCutoff=Ox.F,this.alphaDiscardMode=Bg.JJ.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Rx.U.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new mx._O;const i=new Px(e.position),r=(0,Xv.a)(e.rotationScale);(0,as.e)(r,r),this.transformNormalGlobalFromModel=(0,as.t)(r,r),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=(0,I.RY)(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return(0,I.pC)(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return(0,I.pC)(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return(0,I.pC)(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return(0,I.pC)(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return(0,I.pC)(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(e,t,i,r){const s=this._techniqueConfiguration;s.hasVertexColors=r.colors,s.hasNormals=r.normals,s.textureCoordinateType=r.textureCoordinates,s.hasMetalnessAndRoughnessTexture=(0,I.pC)(this.metallicRoughnessTexture),s.hasEmissionTexture=(0,I.pC)(this.emissionTexture),s.hasOcclusionTexture=(0,I.pC)(this.occlusionTexture),s.hasNormalTexture=(0,I.pC)(this.normalTexture),s.transparencyPassType=t.identifier===Ex.o9.Material&&null!=i.transparencyPassType?i.transparencyPassType:Bg.Am.NONE,s.hasMultipassTerrain=t.identifier===Ex.o9.Material&&null!=i.multipassTerrain&&i.multipassTerrain.enabled,s.cullAboveGround=t.identifier===Ex.o9.Material&&null!=i.multipassTerrain&&i.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?Mx.q.View:Mx.q.None,s.hasBaseColorTexture=(0,I.pC)(this.baseColorTexture);const n=this._computeWhichMaterialPass();s.blendingEnabled=n===Nx.Transparent||n===Nx.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?function(e){return 0!==e.overlays.length&&(0,I.pC)(e.overlays[By.fu.INNER].getColorTextureNoRasterImage())}(i)?(0,yx.g)(i)?mx.OH.ColorOverlayWithWater:mx.OH.ColorOverlay:mx.OH.NoOverlay:mx.OH.None,s.isGround=this.isIntegratedMesh,s.hasPolygonOffset=this.polygonOffsetEnabled;const o=this.hasParametersFromSource&&(0,I.Wi)(this.baseColorTexture);return s.pbrMode=s.integratedMeshMode===mx.OH.ColorOverlayWithWater?jb.f7.WaterOnIntegratedMesh:this.usePBR?o?jb.f7.Schematic:jb.f7.Normal:jb.f7.Disabled,s.normalType=s.integratedMeshMode===mx.OH.None?s.hasNormals?Ax.h.CompressedAttribute:Ax.h.ScreenDerivative:Ax.h.Ground,s.hasSlicePlane=(0,I.pC)(i.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,t.identifier===Ex.o9.ShadowMap?(s.output=Fb.H.Shadow,s.vertexDiscardMode=wx.a.None):t.identifier===Ex.o9.Highlight?(s.output=Fb.H.Highlight,s.vertexDiscardMode=wx.a.None):(this._computeWhichMaterialPass()===Nx.OpaqueAndTransparent?s.vertexDiscardMode=t.transparent?wx.a.Opaque:wx.a.Transparent:s.vertexDiscardMode=wx.a.None,s.output=function(e){switch(e){case Ex.zp.Color:return Fb.H.Color;case Ex.zp.Alpha:return Fb.H.Alpha;case Ex.zp.Depth:return Fb.H.Depth;case Ex.zp.Normal:return Fb.H.Normal}}(t.subPass),t.subPass===Ex.zp.Alpha&&(s.hasOccludees=i.hasOccludees),t.subPass===Ex.zp.Color?(s.receiveAmbientOcclusion=i.ssaoHelper.ready,s.hasOccludees=i.hasOccludees,s.receiveShadows=i.shadowMap.ready,s.hasScreenSpaceReflections=i.ssr.enabled,s.hasCloudsReflections=(0,I.pC)(i.clouds.data)):(s.receiveAmbientOcclusion=!1,s.receiveShadows=!1),s.snowCover=this.hasSnowCover(i)),this._technique=e.releaseAndAcquire(bx,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return(0,I.pC)(e.weather)&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}submit(e,t,i){if(0===this.objectOpacity)return;const r=i.renderable.geometry,s=i.components,n=i.renderable.meta.cameraDepthSquared,o=s.geometryRanges,a=s.highlightRanges,l=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Nx.Opaque:e.materialOpaque.submitDraw(this,r,o,n);break;case Nx.Transparent:e.materialTransparent.submitDraw(this,r,o,n);break;case Nx.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,r,o,n),e.materialTransparent.submitDraw(this,r,o,n);break;case Nx.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,r,o,n),function(e){return 0!==e.overlays.length&&(0,I.pC)(e.overlays[By.fu.INNER].getValidTexture(By.NH.Highlight))}(t)&&e.highlightIntegratedMesh.submitDraw(this,r,o,n)}const c=this.componentParameters.castShadows!==Fx.None;c&&e.shadowMap.submitDraw(this,r,o,n),(0,I.pC)(a)&&(e.highlight.submitDraw(this,r,a,n),c&&e.highlightShadowMap.submitDraw(this,r,a,n)),c&&(0,I.pC)(l)&&e.defaultShadowMap.submitDraw(this,r,l,n)}get attributeLocations(){return yx.a}_computeWhichMaterialPass(){return this.isIntegratedMesh?Nx.IntegratedMesh:this.objectOpacity<1?Nx.Transparent:this.componentParameters.opaqueOverride===Fx.All?Nx.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Bg.JJ.Blend||this.alphaDiscardMode===Bg.JJ.MaskBlend?Nx.Transparent:this.componentParameters.transparent===Fx.None?Nx.Opaque:this.componentParameters.transparent===Fx.All?Nx.Transparent:Nx.OpaqueAndTransparent}}var Dx,Nx,Fx;(0,t._)([Tx({vectorOps:Fd.v})],Lx.prototype,"baseColor",void 0),(0,t._)([Tx()],Lx.prototype,"usePBR",void 0),(0,t._)([Tx()],Lx.prototype,"hasParametersFromSource",void 0),(0,t._)([Tx({vectorOps:dr.F})],Lx.prototype,"mrrFactors",void 0),(0,t._)([Tx({vectorOps:dr.F})],Lx.prototype,"emissiveFactor",void 0),(0,t._)([Tx({dispose:!0})],Lx.prototype,"baseColorTexture",void 0),(0,t._)([Tx({dispose:!0})],Lx.prototype,"metallicRoughnessTexture",void 0),(0,t._)([Tx({dispose:!0})],Lx.prototype,"emissionTexture",void 0),(0,t._)([Tx({dispose:!0})],Lx.prototype,"occlusionTexture",void 0),(0,t._)([Tx({dispose:!0})],Lx.prototype,"normalTexture",void 0),(0,t._)([Tx()],Lx.prototype,"objectOpacity",void 0),(0,t._)([Sx()],Lx.prototype,"commonMaterialParameters",void 0),(0,t._)([Sx()],Lx.prototype,"componentParameters",void 0),(0,t._)([Tx()],Lx.prototype,"textureAlphaCutoff",void 0),(0,t._)([Tx()],Lx.prototype,"alphaDiscardMode",void 0),(0,t._)([Tx()],Lx.prototype,"isIntegratedMesh",void 0),(0,t._)([Tx()],Lx.prototype,"polygonOffsetEnabled",void 0),(0,t._)([Tx()],Lx.prototype,"ellipsoidMode",void 0),(0,t._)([Tx()],Lx.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(Dx||(Dx={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(Nx||(Nx={}));class kx extends Cx{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Bg.Vr.Back,this.hasSlicePlane=!0}}(0,t._)([Tx()],kx.prototype,"doubleSided",void 0),(0,t._)([Tx()],kx.prototype,"cullFace",void 0),(0,t._)([Tx()],kx.prototype,"hasSlicePlane",void 0);class Ux extends Cx{constructor(){super(...arguments),this.externalColor=(0,pg.f)(1,1,1,1),this.externalColorMixMode=Mw.a9.Multiply,this.castShadows=Fx.All}get transparent(){return this.externalColor[3]<1?Fx.All:Fx.None}get opaqueOverride(){return this.externalColorMixMode===Mw.a9.Replace&&1===this.externalColor[3]?Fx.All:Fx.None}get visible(){return this.externalColor[3]>0?Fx.All:Fx.None}get type(){return gx._N.Uniform}}(0,t._)([Tx({vectorOps:Fd.v})],Ux.prototype,"externalColor",void 0),(0,t._)([Tx()],Ux.prototype,"externalColorMixMode",void 0),(0,t._)([Tx()],Ux.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(Fx||(Fx={}));class Vx extends Cx{constructor(){super(...arguments),this.texture=null,this.transparent=Fx.None,this.opaqueOverride=Fx.None,this.castShadows=Fx.None}get type(){return gx._N.Varying}}(0,t._)([Tx()],Vx.prototype,"texture",void 0),(0,t._)([Tx()],Vx.prototype,"transparent",void 0),(0,t._)([Tx()],Vx.prototype,"opaqueOverride",void 0),(0,t._)([Tx()],Vx.prototype,"castShadows",void 0);var zx=s(82976),Bx=s(5843);class Hx{constructor(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this.recycledIndices.push(e)}}class jx{constructor(e,t=1){this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new Hs.x(this.rctx,{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,samplingMode:Er.cw.NEAREST,wrapMode:Er.e8.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new Fv.mc(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(e,t,i,r,s,n){const o=e*this.fieldCount+t;this.dirty=!0,this.data.set(o,0,i),this.data.set(o,1,r),this.data.set(o,2,s),this.data.set(o,3,n)}setDataElement(e,t,i,r){const s=e*this.fieldCount+t;this.dirty=!0,this.data.set(s,i,r)}resizeToFit(e){const t=e*this.fieldCount;if(t>=this.data.count){const e=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,i=new Fv.mc(new ArrayBuffer(4*e));i.typedBuffer.set(this.data.typedBuffer),this.data=i}}updateTexture(){if(!this.dirty)return;const e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(e,t,i){e.bindTexture(t,this.texture),e.setUniform2f(i,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}class Gx{constructor(e,t=1){this.textureBuffer=new jx(e,t),this.indexManager=new Hx(65536)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const e=this.indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this.indexManager.release(e)}}class Wx{constructor(e,t=1){this.rctx=e,this.fieldCount=t,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter((e=>0!==e.activeCount||(e.dispose(),!1)))}destroy(){this.buffers.forEach((e=>e.dispose())),this.buffers=[]}getBuffer(e){for(const t of this.buffers)if(t.availableCount>=e)return t;if(e>65536)return null;const t=new Gx(this.rctx,this.fieldCount);return this.buffers.push(t),t}updateTextures(){for(const e of this.buffers)e.textureBuffer.updateTexture()}}const Zx=p.Z.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class qx{constructor(e,t){this._renderManager=e,this._viewingMode=t,this._objects=[new Nd.Z,new Nd.Z],this._renderSubmit=new px(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new Wx(e.rctx,2)}dispose(){(0,nn.hu)(0===this._objects[Lw.Z.Hidden].length&&0===this._objects[Lw.Z.Visible].length,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(e){const t=new Lw.c;return t.toMapSpace=e.toMapSpace,t.transform=e.transform,t.obb=(0,Ow.d9)(e.obb),t.components=new Iw(this._componentBufferManager,e.geometry.componentOffsets),t.renderable=this._createRenderable(e,t.components),t.intersectionGeometry=new Uw(e.geometry.positionData,t.components),this._objects[t.visible].push(t),t}destroyObject(e){const t=e;this._objects[t.visible].removeUnordered(t),t.dispose(),this._notifyDirty()}setObjectVisibility(e,t){const i=e;t!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[t].push(i),i.visible=t,this._notifyDirty())}preSubmit(e){const t=e.camera.eye;this.visibleObjects.forAll((e=>e.renderable.meta.cameraDepthSquared=(0,dr.d)(t,e.obb.center)))}getMaterial(e){return e.renderable.material}updateMaterial(e,t){const i=e.renderable.material;t(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,t){const i=e;i.components.visibility.reset(t),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,t){return e.components.visibility.forEachComponent(t)}getComponentCount(e){const t=e,i=t.components.visibility.componentCount();return{visible:i,invisible:t.components.count-i}}setComponentData(e,t){const i=e,r=i.renderable.material,s=i.components,n=s.materialDataBuffer,o=s.materialDataIndices,a={castShadows:!0,pickable:!0,externalColor:(0,pg.c)(),externalColorMixMode:Mw.a9.Multiply,elevationOffset:0},l=n.textureBuffer,c=new Uint8Array(4),u=new Uint32Array(c.buffer);let h=0,d=0,p=0,f=s.verticalOffsets,m=1/0,g=-1/0,y=!1,_=!1,v=0;for(let e=0;e<s.count;e++)t(e,a),h+=+(a.externalColor[3]<1),d+=+(a.externalColorMixMode===Mw.a9.Replace&&1===a.externalColor[3]),p+=+a.castShadows,(0,Mw.HB)(a.externalColor,a.externalColorMixMode,c),c[2]=254&c[2]|+a.castShadows,l.setData(o[e],0,c[0],c[1],c[2],c[3]),y||(y=e>0&&v!==u[0]),v=u[0],_||(_=0!==a.elevationOffset),_&&(0,I.Wi)(f)&&(f=new Array(e).fill(0)),(0,I.pC)(f)&&(f[e]=a.elevationOffset),m=Math.min(m,a.elevationOffset),g=Math.max(g,a.elevationOffset),(0,gx.nO)(a.elevationOffset,c),l.setData(o[e],1,c[0],c[1],c[2],c[3]),a.pickable!==Nw(s.pickability,e)&&(s.pickability=Dw(s.pickability,s.count,e,a.pickable));s.verticalOffsets=_?f:null,i.offsetObb=_?(0,Aw.gI)(i.obb,m,g,this._viewingMode,(0,I.pC)(i.offsetObb)?i.offsetObb:(0,Ow.d9)(i.obb)):null,y||_?(r.componentParameters=new Vx,r.componentParameters.castShadows=Yx(p,s.count),r.componentParameters.transparent=Yx(h,s.count),r.componentParameters.opaqueOverride=Yx(d,s.count),r.componentParameters.texture=l,l.updateTexture()):(r.componentParameters=new Ux,r.componentParameters.castShadows=a.castShadows?Fx.All:Fx.None,r.componentParameters.externalColor=a.externalColor,r.componentParameters.externalColorMixMode=a.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,t,i,r=!1){e.intersectionGeometry.getComponentAabb(t,i);const s=e,n=s.components.verticalOffsets;if(r||(0,I.Wi)(n))return i;const o=n[t];if(this._viewingMode===Nt.JY.Local||0===o)return i[2]+=o,i[5]+=o,i;const a=(0,I.Wg)((0,Lc.iO)(o));return a.localOrigin=s.transform.position,a.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,t,i){return e.intersectionGeometry.getComponentPositions(t,i)}intersect(e,t,i,r,s,n){const o=e;(0,I.pC)(s)&&(s.localOrigin=o.transform.position);const a=(0,as.e)(Xx,o.transform.rotationScale);(0,dr.v)(Jx,t,o.transform.position),(0,dr.v)(Kx,i,o.transform.position),(0,dr.t)(Jx,Jx,a),(0,dr.t)(Kx,Kx,a);const l=(0,as.t)(Xx,a);return o.intersectionGeometry.intersect(Jx,Kx,r,l,s,o.components.verticalOffsets,n)}addEdges(e,t,i,r){const s=e,{indices:n,positions:o}=s.intersectionGeometry,a=s.components.offsets;return t.addComponentObject(e,s.transform,{center:s.obb.center,radius:(0,Ow.q0)(s.obb)},o,n,a,i,r)}async extractEdgeInformation(e,t,i){const r=e,s=r.components.visibility;if(s.allInvisible())return{buffer:Bx.extractComponentsEdgeLocationsLayout.createBuffer(0),origin:[0,0,0]};const{indices:n,positions:o}=r.intersectionGeometry,a=r.components.offsets,l=zx.tf.createBuffer(o.count);(0,Ew.c)(l.position,o),(0,Sw.a)(l.position,l.position,r.transform.rotationScale),this._setComponentIndices(l.componentIndex,n,a);const c=l.count,u=this._computeVisibilityIndices(n,s,a,c);return{origin:(0,me.a)(r.transform.position),buffer:await t.extractComponentsEdgeLocations({indices:u,indicesLength:u.length,skipDeduplicate:!0,data:l,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,t,i){let r=0;for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let i=n;i<o;i++){const s=t?t[i]:i;e.set(s,r)}r++}}_computeVisibilityIndices(e,t,i,r){if(e&&t.allVisible())return e;let s=0;t.forEachComponentRange(((e,t)=>(s+=i[t]-i[e],!0)));const n=2===e?.BYTES_PER_ELEMENT||r<=65536?new Uint16Array(s):new Uint32Array(s);let o=0;return t.forEachComponentRange(((t,r)=>{const s=i[t],a=i[r];for(let t=s;t<a;t++)n[o++]=e?e[t]:t;return!0})),n}addComponentHighlight(e,t){const i=e.components;(0,I.Wi)(i.highlightCounts)&&(i.highlightCounts=new Uint32Array(i.count+1)),0==i.highlightCounts[t]++&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,t){const i=e.components;if((0,I.Wi)(i.highlightCounts))return void Zx.warn("Removing non-existing highlight.");const r=i.highlightCounts[t],s=i.highlightCounts[i.count];if(0!==r){if(r>1)return i.highlightCounts[t]=r-1,void(i.highlightCounts[i.count]=s-1);i.highlightCounts[t]=0,i.highlightsDirty(),this._notifyDirty(),1===s?i.highlightCounts=null:i.highlightCounts[i.count]=s-1}else Zx.warn("Removing non-existing highlight.")}clearHighlights(e){const t=e.components;(0,I.pC)(t.highlightCounts)&&(t.highlightCounts=null,t.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[Lw.Z.Visible]}_createRenderable(e,t){const i=this._renderManager.rctx,r=e.geometry,s=r.vertices.layoutParameters,n=Bs.f.createVertex(i,Er.l1.STATIC_DRAW,r.vertices.data),o=(0,I.yw)(r.indices,(e=>Bs.f.createIndex(i,Er.l1.STATIC_DRAW,e))),a=(0,ks.K)((0,fx.N)(s)),l=new Uint16Array(r.vertices.count);for(let e=0;e<t.count;e++){const i=t.offsets[e],s=t.offsets[e+1],n=t.materialDataIndices[e];if((0,I.pC)(r.indices))for(let e=i;e<s;e++)l[r.indices[e]]=n;else for(let e=i;e<s;e++)l[e]=n}const c=Bs.f.createVertex(i,Er.l1.STATIC_DRAW,l.buffer),u=new Lx(e.transform,e.toMapSpace),h=new Gs.U(i,u.attributeLocations,{data:a,componentIndices:$x},{data:n,componentIndices:c},(0,I.Wg)(o)),d=new Hw(h,Er.MX.TRIANGLES,s,(0,I.pC)(o)),p={cameraDepthSquared:.5,gpuMemoryEstimate:n.byteSize+c.byteSize+((0,I.pC)(o)?o.byteSize:0)};return new Bw(u,d,p)}_notifyDirty(){this._renderManager.notifyDirty()}}const $x=(0,ks.K)((0,Us.U$)().u16(zs.T.COMPONENTINDEX));function Yx(e,t){return e===t?Fx.All:0===e?Fx.None:Fx.Some}const Xx=(0,Xv.c)(),Jx=(0,me.c)(),Kx=(0,me.c)();var Qx=s(18841),eC=s(73487),tC=s(42199);class iC extends Cr.A{initializeProgram(e){const t=iC.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){if(this.configuration.function===tC.v3.TransparentToHUDVisibility)return(0,Ar.sm)({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case tC.Fv.None:return(0,Ar.sm)({colorWrite:Ar.BK});case tC.Fv.Alpha:return(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.SRC_ALPHA,Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA,Er.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ar.BK});default:return(0,Ar.sm)({blending:(0,Ar.if)(Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ar.BK})}}}iC.shader=new xr.J(eC.a,(()=>s.e(4622).then(s.bind(s,4622))));class rC{constructor(e,t){this._rctx=e,this._techniqueRepository=t,this._configuration=new tC.ZB,this._passParameters=new eC.C}dispose(){this._vao=(0,I.O3)(this._vao)}compositeTransparent(e,t,i,r,s=1){this._configuration.alphaMode=tC.Fv.Alpha,this._configuration.function=tC.v3.Transparency,this._configuration.hasOpacityFactor=1!==s,this._passParameters.colorTexture=t,this._passParameters.alphaTexture=i,this._passParameters.frontFaceTexture=r;const n=this._rctx,o=this._techniqueRepository.acquire(iC,this._configuration);n.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Er.MX.TRIANGLE_STRIP,0,(0,js._V)(a,"geometry")),o.release()}composite(e,t,i=tC.Fv.None,r=1,s=tC.v3.Standard,n=By.fu.INNER){const o=this._rctx;this._configuration.alphaMode=i,this._configuration.function=s,this._configuration.hasOpacityFactor=1!==r,this._passParameters.overlayIndex=n,this._passParameters.texture=t,this._passParameters.opacity=r;const a=this._techniqueRepository.acquire(iC,this._configuration);o.bindTechnique(a,this._passParameters,e);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Er.MX.TRIANGLE_STRIP,0,(0,js._V)(l,"geometry")),a.release()}_ensureVAO(){return(0,I.Wi)(this._vao)&&(this._vao=(0,Lr.ow)(this._rctx)),this._vao}}var sC=s(73534),nC=s(20766);function oC(e,t,i){return(0,sC.v)(t,e)*(i[1]-i[0])+i[0]}function aC(e,t,i){if(!i.isVisible)return;if(!(0,gf.hr)(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=dC;i.geometryRecords.forEach((i=>{(0,Fr.m)(s,r,i.getShaderTransformation());const n=(0,si.u1)(s);lC(e,t,i.geometry.boundingInfo,s,n)}))}function lC(e,t,i,r,s){if((0,I.Wi)(i))return;const n=t.eye,o=t.viewForward;(0,dr.m)(hC,i.center,r);const a=o[0]*(hC[0]-n[0])+o[1]*(hC[1]-n[1])+o[2]*(hC[2]-n[2]);if(hC[3]=i.radius*s,!(a-hC[3]>e.near&&a+hC[3]<e.far)&&(0,gf.hr)(t.frustum,hC))if(i.radius>100&&i.getChildren()){const n=i.getChildren();for(let i=0;i<8;++i)n[i]&&lC(e,t,n[i],r,s)}else gC.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function cC(e,t,i){const r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}const uC=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],hC=(0,fo.c)(),dC=(0,kr.c)(),pC=jw(),fC=new class{constructor(){this._items=new Nd.Z({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const t=e.eye,i=e.viewForward;this._items.forAll((e=>{const r=e.obj.boundingVolumeWorldSpace.bounds,s=(r[0]-t[0])*i[0]+(r[1]-t[1])*i[1]+(r[2]-t[2])*i[2];e.distance=s,e.near=s-r[3],e.far=s+r[3]})),this._items.sort(((e,t)=>e.distance-t.distance))}forEachInDepthRange(e,t,i){if(t===nC.Z.DepthOrder.FRONT_TO_BACK)for(let t=0;t<this._items.length;++t){const r=this._items.data[t];r.far<e.near||r.near>e.far||i(r.obj,r.near,r.far)}else for(let t=this._items.length-1;t>=0;--t){const r=this._items.data[t];r.far<e.near||r.near>e.far||i(r.obj,r.near,r.far)}}},mC=new class{constructor(){this.view=(0,kr.c)(),this.viewProj=(0,kr.c)(),this.frustum=(0,gf.Ue)(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(e,t){this._reset(),(0,Fr.c)(this.view,e.viewMatrix),(0,Fr.m)(this.viewProj,e.projectionMatrix,this.view),(0,gf.JG)(this.frustum,e.frustum);const i=this.view,r=i[2],s=i[6],n=i[10],o=i[14],a=this.range;let l=0;if(t.forEach((e=>{if(!e.instanceParameters.visible)return;if(!e.castShadow)return;let t;e.hasShaderTransformation?(e.computeBoundingSphere(e.getShaderTransformation(),hC,1),t=hC):t=e.boundingSphere;const i=r*t[0]+s*t[1]+n*t[2]+o,a=i-t[3],c=i+t[3];this.geometries[l]=e,this.near[l]=-c,this.far[l]=-a,++l})),0===this.geometries.length)return a;for(let e=0;e<this.geometries.length;++e)this.near[e]>a.far&&(a.far=this.near[e]),this.near[e]>2&&this.far[e]<a.near&&(a.near=this.far[e]);const c=this.looseRange;c.near=Math.max(.5*a.near,2),c.far=2*a.far;let u=0,h=0;for(let e=0;e<this.geometries.length;++e)this.near[e]<a.near&&(this.near[e]>=c.near?a.near=this.near[e]:this.nearCandidates[u++]=e),this.far[e]>a.far&&(this.far[e]<=c.far?a.far=this.far[e]:this.farCandidates[h++]=e);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(((e,t)=>this.near[e]<this.near[t]?-1:this.near[e]>this.near[t]?1:0)),this.farCandidates.sort(((e,t)=>this.far[e]<this.far[t]?1:this.far[e]>this.far[t]?-1:0));for(let e=0;e<this.nearCandidates.length;++e){const t=this.nearCandidates[e];if(this.near[t]<a.near){const e=this.geometries[t],i=e.boundingInfo;this._includeNearBoundingInfoRec(i,e.getShaderTransformation())}}for(let e=0;e<this.farCandidates.length;++e){const t=this.farCandidates[e];if(this.far[t]>a.far){const e=this.geometries[t],i=e.boundingInfo;this._includeFarBoundingInfoRec(i,e.getShaderTransformation())}}return a}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(e,t){if((0,I.Wi)(e))return;const i=e.getCenter();(0,dr.m)(hC,i,t);const r=(0,si.u1)(t),s=hC[0],n=hC[1],o=hC[2],a=e.getBSRadius()*r,l=this.frustum;if(l[0][0]*s+l[0][1]*n+l[0][2]*o+l[0][3]>a||l[1][0]*s+l[1][1]*n+l[1][2]*o+l[1][3]>a||l[2][0]*s+l[2][1]*n+l[2][2]*o+l[2][3]>a||l[3][0]*s+l[3][1]*n+l[3][2]*o+l[3][3]>a)return;const c=this.view[2]*s+this.view[6]*n+this.view[10]*o+this.view[14],u=c+a;if(!(-(c-a)<2||-u>=this.range.near))if(-u>this.looseRange.near)this.range.near=-u;else{if(a>100){const i=e.getChildren();if(void 0!==i){for(let e=0;e<8;++e)void 0!==i[e]&&this._includeNearBoundingInfoRec(i[e],t);return}}gC.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}_includeFarBoundingInfoRec(e,t){if((0,I.Wi)(e))return;let i=e.getBSRadius();const r=e.getCenter();(0,dr.m)(hC,r,t);const s=(0,si.u1)(t),n=hC[0],o=hC[1],a=hC[2];i*=s;const l=this.frustum;if(l[0][0]*n+l[0][1]*o+l[0][2]*a+l[0][3]>i||l[1][0]*n+l[1][1]*o+l[1][2]*a+l[1][3]>i||l[2][0]*n+l[2][1]*o+l[2][2]*a+l[2][3]>i||l[3][0]*n+l[3][1]*o+l[3][2]*a+l[3][3]>i)return;const c=this.view[2]*n+this.view[6]*o+this.view[10]*a+this.view[14]-i;if(!(-c<=this.range.far))if(-c<this.looseRange.far)this.range.far=-c;else{if(i>100){const i=e.getChildren();if(void 0!==i){for(let e=0;e<8;++e)void 0!==i[e]&&this._includeFarBoundingInfoRec(i[e],t);return}}gC.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},gC=new class{constructor(){this.modelViewProj=(0,kr.c)(),this.clipPosition=[(0,pr.c)(),(0,pr.c)(),(0,pr.c)(),(0,pr.c)(),(0,pr.c)(),(0,pr.c)(),(0,pr.c)(),(0,pr.c)()]}unionDepthRangeWithAABB(e,t,i,r,s){const n=this.modelViewProj;(0,Fr.m)(n,t,i);let o=!1;for(let e=0;e<8;++e){const t=this.clipPosition[e],i=0===e||3===e||4===e||7===e?r[0]:s[0],o=0===e||1===e||4===e||5===e?r[1]:s[1],a=e<4?r[2]:s[2];t[0]=n[0]*i+n[4]*o+n[8]*a+n[12],t[1]=n[1]*i+n[5]*o+n[9]*a+n[13],t[2]=n[2]*i+n[6]*o+n[10]*a+n[14],t[3]=n[3]*i+n[7]*o+n[11]*a+n[15]}for(let t=0;t<12;++t){const i=this.clipPosition[uC[t][0]],r=this.clipPosition[uC[t][1]],s=this.clipPosition[uC[t][2]],n=this._clipTriangle(i,r,s);let a=!0;for(let e=0;e<n.length;++e)if(n[e][3]>=2){a=!1;break}if(!a){o=!0;for(let t=0;t<n.length;++t){const i=n[t][3];i<e.near&&(e.near=i),i>e.far&&(e.far=i)}}}return o}_inside(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void(0,nn.hu)(!1)}_intersect(e,t,i){let r=0;return 0===i?r=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===i?r=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===i?r=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===i&&(r=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),(0,Fd.l)((0,pr.c)(),e,t,r)}_clipTriangle(e,t,i){let r=[e,t,i];for(let e=0;e<4;++e){const t=r;r=[];for(let i=0;i<t.length;++i){const s=t[i],n=t[(i+1)%t.length];this._inside(n,e)?(this._inside(s,e)||r.push(this._intersect(s,n,e)),r.push(n)):this._inside(s,e)&&r.push(this._intersect(s,n,e))}}return r}};var yC=s(55982),_C=s(71278),vC=s(62869),bC=s(3961),wC=s(57663);class xC extends Pr.K{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}let CC=class extends O.Z{constructor(){super(...arguments),this._handles=new Ae.Z,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new xC,this.events=new P.Z,this.attributeLocations=new Map([[zs.T.POSITION,0]]),this.tmpScreenPoint=(0,pe.s1)(),this.tmpRenderPoint=(0,pe.gX)()}get updating(){return(0,I.Wi)(this._imageSources)&&(0,I.pC)(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};(0,I.pC)(this._magnifier)&&this._handles.add((0,he.YP)((()=>(0,I.yw)(this._magnifier,(e=>e.version))),t)),t()}get enabled(){return(0,I.pC)(this._validMagnifier)}get _validMagnifier(){return(0,I.pC)(this._magnifier)&&this._magnifier.visible&&(0,I.pC)(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return(0,I.pC)(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),(0,I.pC)(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const i=this._validMagnifier;if((0,I.Wi)(i))return;const r=t.camera.pixelRatio,s=Math.ceil(r*i.size);if(this._updateResources(e,s),(0,I.Wi)(this._resources))return;this._passParameters.maskEnabled=i.maskEnabled,this._passParameters.overlayEnabled=i.overlayEnabled;const n=this._resources.program;e.useProgram(n),n.bindPass(this._passParameters,t);const o=this._resources.textures,a=Math.ceil(1/this.factor*s);o.input.resize(a,a);const l=t.camera.fullWidth,c=t.camera.fullHeight;(0,pe.md)(i.position,this.tmpScreenPoint);const u=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),h=.5*a,d=.5*a;u[0]=(0,$.uZ)(u[0],h,l-h-1),u[1]=(0,$.uZ)(u[1],d,c-d-1);const p=Math.floor(u[0]-h),f=Math.floor(u[1]-d);n.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,p,f,a,a,0);const m=i.offset.x*r,g=i.offset.y*r,y=(u[0]+m)/l*2-1,_=(u[1]-g)/c*2-1,v=s/l*2,b=s/c*2;e.bindVAO(this._resources.vao),n.bindTexture("textureOverlay",o.overlay),n.bindTexture("textureMask",o.mask),n.setUniform4f("drawPosition",y,_,v,b),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Er.MX.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if((0,I.Wi)(e))return;const t=e.maskUrl,i=e.overlayUrl;!(0,I.pC)(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),(0,I.pC)(this._imageSources)||(0,I.pC)(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:(0,f.vr)((async e=>{const r=(0,I.Wi)(t)||(0,I.Wi)(i)?async function(e){const t=s.e(2030).then(s.bind(s,12030)),i=s.e(9110).then(s.bind(s,49110)),r=(0,Is.t)((await t).default,{signal:e}),n=(0,Is.t)((await i).default,{signal:e}),o={mask:await r,overlay:await n};return(0,f.k_)(e),o}(e):null,n=(0,I.pC)(t)?(0,Is.t)(t,{signal:e}):r.then((e=>e.mask)),o=(0,I.pC)(i)?(0,Is.t)(i,{signal:e}):r.then((e=>e.overlay));this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")}))},this._imageLoadTask.task.promise.then((()=>this.notifyChange("updating")),(()=>this.notifyChange("updating"))))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if((0,I.pC)(this._resources)){if(this._resources.textures.size!==t){const i=this._createTextureResources(e,t);if((0,I.Wi)(i))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=i}return}const i=this._createTextureResources(e,t);(0,I.Wi)(i)||(this._resources={textures:i,program:this._createProgram(e),vao:(0,Lr.ow)(e,Ir.QI,this.attributeLocations,0,1),pipelineState:(0,Ar.sm)({blending:(0,Ar.if)(Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Ar.BK})})}_disposeResources(){(0,I.Wi)(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if((0,I.Wi)(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new Hs.x(e,{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,internalFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.CLAMP_TO_EDGE,samplingMode:Er.cw.LINEAR,flipped:!0,preMultiplyAlpha:!(0,F.zd)(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),r=new Hs.x(e,{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.ALPHA,internalFormat:Er.VI.ALPHA,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.CLAMP_TO_EDGE,samplingMode:Er.cw.LINEAR,flipped:!0},this._imageSources.mask);return{input:new Hs.x(e,{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,internalFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.CLAMP_TO_EDGE,samplingMode:Er.cw.LINEAR,flipped:!1}),mask:r,overlay:i,size:t}}_createProgram(e){return new Sr.$(e,function(){const e=new bC.kG;return e.attributes.add(zs.T.POSITION,"vec2"),e.vertex.uniforms.add(new vC.y("drawPosition")),e.varyings.add("vUV","vec2"),e.vertex.code.add(Pr.H`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new wC.Q("textureInput")),e.fragment.uniforms.add(new wC.Q("textureMask")),e.fragment.uniforms.add(new wC.Q("textureOverlay")),e.fragment.uniforms.add(new _C.U("maskEnabled",(e=>e.maskEnabled))),e.fragment.uniforms.add(new _C.U("overlayEnabled",(e=>e.overlayEnabled))),e.fragment.code.add(Pr.H`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}(),this.attributeLocations)}};(0,t._)([(0,m.Cb)()],CC.prototype,"_imageSources",void 0),(0,t._)([(0,m.Cb)()],CC.prototype,"_imageLoadTask",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],CC.prototype,"updating",null),CC=(0,t._)([(0,y.j)("esri/views/3d/webgl-engine/lib/MagnifierHelper")],CC);const TC=(0,Ys.HA)(1e3/30);var SC;!function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"}(SC||(SC={}));class EC{constructor(e,t,i=SC.FrontToBack){this._rctx=e,this._techniqueRepository=t,this._sorting=i,this._draws=new Nd.Z({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,t,i,r){const s=this._draws.pushNew();s.geometry=t,s.geometryRanges=i,s.material=e,s.depthSquaredHint=r,s.indexType=t.indexed?(0,I.Wg)(t.vao.indexBuffer).indexType:0}dispatch(e,t){const i=this._rctx;this._previouslyBoundDraw.clear();let r=null;const s=this._draws.map((i=>i.material.prepareTechnique(this._techniqueRepository,e,t,i.geometry.parameters))),n=this._draws.length;for(let o=0;o<n;o++){const n=s[o];n===r&&n.configuration.transparencyPassType===Bg.Am.NONE||(i.bindTechnique(n,e,t),r=n);const a=this._draws.data[o],l=a.geometry;i.bindVAO(l.vao),this._previouslyBoundDraw.get(n)!==a.material&&(n.bindDraw(a.material,t),this._previouslyBoundDraw.set(n,a.material));const c=a.geometryRanges,u=c.length;if(0!==a.indexType){const e=AC.get(a.indexType);for(let t=0;t<u;t+=2){const r=c[t],s=c[t+1];i.drawElements(l.primitiveType,s,a.indexType,r*e)}}else for(let e=0;e<u;e+=2){const t=c[e],r=c[e+1];i.drawArrays(l.primitiveType,t,r)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===SC.FrontToBack?1:-1;this._draws.sort(((t,i)=>{const r=e*(t.depthSquaredHint-i.depthSquaredHint);return 0!==r?r:t.geometry.vao.size-i.geometry.vao.size}))}get count(){return this._draws.length}}const AC=new Map;AC.set(Er.g.UNSIGNED_BYTE,1),AC.set(Er.g.UNSIGNED_SHORT,2),AC.set(Er.g.UNSIGNED_INT,4);class MC{constructor(e,t){this.rctx=e,this.shaderTechniqueRepository=t,this.canRender=!0,this._materialPassParameters=new Ex.SP,this._shadowPassParameters=new Ex.kF,this._highlightPassParameters=new Ex.T5,this._systems=new Set,this._passes={materialOpaque:new EC(e,t),materialTransparent:new EC(e,t,SC.BackToFront),materialIntegratedMesh:new EC(e,t),shadowMap:new EC(e,t),highlight:new EC(e,t),highlightIntegratedMesh:new EC(e,t),highlightShadowMap:new EC(e,t),defaultShadowMap:new EC(e,t)}}register(e){this._systems.add(e)}prepareRender(e){if(0!==this._systems.size){for(const e of Object.values(this._passes))e.prepareSubmit();this._systems.forEach((t=>t.submit(this._passes,e.bindParameters)));for(const e of Object.values(this._passes))e.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(e){if(0!==this._systems.size)switch(this._configure(e),e.bindParameters.slot){case On.r.OPAQUE_MATERIAL:switch(e.pass){case Mn.C.MATERIAL:return this._materialPassParameters.subPass=Ex.zp.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters);case Mn.C.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ex.zp.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters);case Mn.C.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ex.zp.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters);case Mn.C.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,e.bindParameters);case Mn.C.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case Mn.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case Mn.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,e.bindParameters)}return;case On.r.TRANSPARENT_MATERIAL:switch(e.pass){case Mn.C.MATERIAL:return this._materialPassParameters.subPass=Ex.zp.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters);case Mn.C.MATERIAL_ALPHA:return this._materialPassParameters.subPass=Ex.zp.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters);case Mn.C.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ex.zp.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters);case Mn.C.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ex.zp.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters)}return;case On.r.INTEGRATED_MESH:switch(e.pass){case Mn.C.MATERIAL:return this._materialPassParameters.subPass=Ex.zp.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters);case Mn.C.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ex.zp.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters);case Mn.C.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ex.zp.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters);case Mn.C.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,e.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[On.r.OPAQUE_MATERIAL,On.r.TRANSPARENT_MATERIAL,On.r.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const t={near:1/0,far:-1/0};return this._systems.forEach((i=>{const r=i.queryShadowCasterDepthRange(e);(0,I.pC)(r)&&Ww(t,r,t)})),t}_configure(e){const t=e.pass===Mn.C.MATERIAL_DEPTH_SHADOWMAP_ALL||e.pass===Mn.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||e.pass===Mn.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:e.pass===Mn.C.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,t)}_updateParameters(e,t){const i=e.bindParameters.camera,r=i.viewInverseTransposeMatrix;(0,dr.s)(OC,r[3],r[7],r[11]),PC.set(OC),(0,dr.c)(t.transformWorldFromViewTH,PC.high),(0,dr.c)(t.transformWorldFromViewTL,PC.low),(0,dr.c)(t.slicePlaneLocalOrigin,OC),(0,as.f)(t.transformViewFromCameraRelativeRS,i.viewMatrix),(0,Fr.c)(t.transformProjFromView,i.projectionMatrix),t.identifier===Ex.o9.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===On.r.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===On.r.INTEGRATED_MESH,(0,as.t)(RC,t.transformViewFromCameraRelativeRS),(0,as.e)(t.transformNormalViewFromGlobal,RC))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const OC=(0,me.c)(),RC=(0,Ga.c)(),PC=new Px;var IC=s(62912),LC=s(34106),DC=s(64183);class NC extends Cr.A{initializeProgram(e){const t=NC.shader.get().build();return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.SRC_ALPHA,Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA,Er.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ar.BK})}}NC.shader=new xr.J(DC.H,(()=>s.e(9175).then(s.bind(s,39175))));var FC=s(43930);class kC extends Cr.A{initializeProgram(e){const t=kC.shader.get().build();return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({colorWrite:Ar.BK})}}kC.shader=new xr.J(FC.a,(()=>s.e(3400).then(s.bind(s,73400))));var UC=s(37738);class VC extends Cr.A{initializeProgram(e){const t=VC.shader.get().build();return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({colorWrite:Ar.BK})}}VC.shader=new xr.J(UC.a,(()=>s.e(3290).then(s.bind(s,23290))));class zC extends Pr.K{constructor(){super(...arguments),this.color=(0,pg.f)(1,0,1,1),this.haloColor=(0,pg.f)(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=(0,pr.f)(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}class BC{constructor(e,t){this._techniqueRep=e,this._rctx=t,this.viewportToRestore=(0,pr.c)(),this._passParameters=new zC,this._downsampleDrawParameters=new UC.H,this._blurDrawParameters=new FC.H,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=(0,Lr.ow)(this._rctx);const e={colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.NONE,width:0,height:0},t={target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,samplingMode:Er.cw.LINEAR,wrapMode:Er.e8.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new vs.X(this._rctx,e,t),this.blur1Fbo=new vs.X(this._rctx,e,t);const i=new Or.m;this._blurTechnique=this._techniqueRep.acquire(kC,i),this._downsampleTechnique=this._techniqueRep.acquire(VC,i),this._applyTechnique=this._techniqueRep.acquire(NC,i)}dispose(){if(this._blurTechnique=(0,I.RY)(this._blurTechnique),this._downsampleTechnique=(0,I.RY)(this._downsampleTechnique),this._applyTechnique=(0,I.RY)(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=(0,I.O3)(this.blur0Fbo),this.blur1Fbo=(0,I.O3)(this.blur1Fbo)}setDefaultOptions(e){this._passParameters={...new zC,...e}}render(e,t,i){this._passParameters.highlightColorTexture=t.colorTexture,this._assertResources();const r=e.camera;(0,Fd.c)(this.viewportToRestore,r.fullViewport);const s=r.fullWidth,n=r.fullHeight,o=r.pixelRatio,a=Math.ceil(s/o),l=Math.ceil(n/o);this.blur0Fbo.resize(a,l),this.blur1Fbo.resize(a,l);const c=this._rctx;c.bindVAO(this.quadVAO);let u=null;this._gridUpdateResources(t,32),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,u=this._grid.vao;const h=c.bindTechnique(this._blurTechnique,this._passParameters,e);c.bindVAO(u),c.bindFramebuffer(this.blur0Fbo),c.setViewport(0,0,a,l),c.setClearColor(0,0,0,0),c.clear(Er.lk.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=t.colorTexture,(0,mr.a)(this._blurDrawParameters.blurSize,1/a,0),h.bindDraw(this._blurDrawParameters,e),c.drawArrays(this._blurTechnique.primitiveType,0,(0,js._V)(u,"geometry")),c.bindFramebuffer(this.blur1Fbo),c.clear(Er.lk.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,(0,mr.a)(this._blurDrawParameters.blurSize,0,1/l),h.bindDraw(this._blurDrawParameters,e),c.drawArrays(this._blurTechnique.primitiveType,0,(0,js._V)(u,"geometry")),c.bindFramebuffer(i),c.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,c.bindTechnique(this._applyTechnique,this._passParameters,e),c.drawArrays(this._applyTechnique.primitiveType,0,(0,js._V)(u,"geometry")),c.bindVAO(null)}_gridUpdateResources(e,t){const i=this._rctx,r=this._grid;let s=!1;if(null===r.coverageMipmap&&(r.coverageMipmap=[e],s=!0),r.viewportWidth===e.width&&r.viewportHeight===e.height||(s=!0,r.viewportWidth=e.width,r.viewportHeight=e.height),r.coverageMipmap[0]=e,r.cellPixelSize!==t&&(r.cellPixelSize=t,s=!0),s){for(let e=1;e<r.coverageMipmap.length;e++)r.coverageMipmap[e].dispose();r.mipmapLevels=Math.ceil(Math.log(r.cellPixelSize)*Math.LOG2E),r.coverageMipmap.length=r.mipmapLevels+1;for(let e=0;e<r.mipmapLevels;e++){const t=r.coverageMipmap[e],s={target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGB,dataType:Er.Br.UNSIGNED_SHORT_5_6_5,samplingMode:Er.cw.LINEAR,wrapMode:Er.e8.CLAMP_TO_EDGE,width:Math.ceil(t.width/2),height:Math.ceil(t.height/2)},n={colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.NONE,width:Math.ceil(t.width/2),height:Math.ceil(t.height/2)};r.coverageMipmap[e+1]=new vs.X(i,n,s)}}const n=Math.ceil(e.height/r.cellPixelSize),o=Math.ceil(e.width/r.cellPixelSize);if(!r.vao||r.verticalCellCount!==n||r.horizontalCellCount!==o){r.verticalCellCount=n,r.horizontalCellCount=o;const e=n+1,t=o+1,s=1/n,a=1/o,l=6,c=4,u=new Float32Array(l*c*e*t);let h=0;for(let i=0;i<e;i++)for(let e=0;e<t;e++)u[h+0]=(e-.5)*a*2-1,u[h+1]=(i-.5)*s*2-1,u[h+2]=e*a,u[h+3]=i*s,u[h+4]=(e+.5)*a*2-1,u[h+5]=(i-.5)*s*2-1,u[h+6]=e*a,u[h+7]=i*s,u[h+8]=(e-.5)*a*2-1,u[h+9]=(i+.5)*s*2-1,u[h+10]=e*a,u[h+11]=i*s,u[h+12]=(e-.5)*a*2-1,u[h+13]=(i+.5)*s*2-1,u[h+14]=e*a,u[h+15]=i*s,u[h+16]=(e+.5)*a*2-1,u[h+17]=(i-.5)*s*2-1,u[h+18]=e*a,u[h+19]=i*s,u[h+20]=(e+.5)*a*2-1,u[h+21]=(i+.5)*s*2-1,u[h+22]=e*a,u[h+23]=i*s,h+=l*c;r.vao&&r.vao.dispose(!0),r.vao=new Gs.U(i,Tr.i,{geometry:Ir.Bn},{geometry:Bs.f.createVertex(i,Er.l1.STATIC_DRAW,u)})}}_gridComputeMipmap(e){const t=this._rctx,i=this._grid,r=t.bindTechnique(this._downsampleTechnique,this._passParameters,e);t.bindVAO(this.quadVAO);for(let s=0;s<i.mipmapLevels;s++){t.bindFramebuffer(i.coverageMipmap[s+1]);const n=i.coverageMipmap[s+1].width,o=i.coverageMipmap[s+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[s].colorTexture,(0,mr.a)(this._downsampleDrawParameters.invFramebufferDim,1/n,1/o),r.bindDraw(this._downsampleDrawParameters,e),t.setViewport(0,0,n,o),t.drawArrays(Er.MX.TRIANGLE_STRIP,0,(0,js._V)(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=((0,I.pC)(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+((0,I.pC)(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const t of this._grid.coverageMipmap)e+=t.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}var HC=s(37165);const jC={dataType:Er.Br.UNSIGNED_BYTE,internalFormat:Er.VI.RGBA},GC={};class WC{constructor(e){this.rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=e.capabilities.depthTexture}dispose(){this._depthBuffers.forEach((e=>e.dispose())),this._depthBuffers.clear(),this._depthTextures.forEach((e=>e.dispose())),this._depthTextures.clear(),this._colorTextures.forEach((e=>e.dispose())),this._colorTextures.clear(),this._framebuffers.forEach((e=>e.dispose())),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(e){const t=e.id;this._activeTargets.has(t)&&(this._activeTargets.delete(t),this._disposeWithFramebuffers(this._depthTextures,t),this._disposeWithFramebuffers(this._depthBuffers,t),this._disposeWithFramebuffers(this._colorTextures,t))}_disposeWithFramebuffers(e,t){const i=e.get(t);i&&(this._framebuffers.forEach(((e,t)=>{e.colorAttachment!==i&&e.depthStencilAttachment!==i||(e.detachAll(),e.dispose(),this._framebuffers.delete(t))})),i.dispose(),e.delete(t))}getDepthTexture(e,t){if(!this.depthTextureSupported)return null;let i=this._depthTextures.get(e.id);return!i||i.descriptor.width===t.width&&i.descriptor.height===t.height||(i.dispose(),i=null),i||(i=new Hs.x(this.rctx,{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.DEPTH_STENCIL,dataType:Er.Br.UNSIGNED_INT_24_8,samplingMode:Er.cw.NEAREST,wrapMode:Er.e8.CLAMP_TO_EDGE,width:t.width,height:t.height}),this._depthTextures.set(e.id,i),this._activeTargets.add(e.id)),i}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,t){if(this.depthTextureSupported)return null;let i=this._depthBuffers.get(e.id);return i?i.descriptor.width===t.width&&i.descriptor.height===t.height||i.resize(t.width,t.height):(i=new HC.r(this.rctx,{internalFormat:Er.Tg.DEPTH_STENCIL,...t}),this._depthBuffers.set(e.id,i),this._activeTargets.add(e.id)),i}getColorTexture(e,t){let i=this._colorTextures.get(e.id);return i&&(i.descriptor.width===t.width&&i.descriptor.height===t.height||(i.dispose(),i=null)),i||(i=new Hs.x(this.rctx,{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:null!=e.samplingMode?e.samplingMode:Er.cw.LINEAR,wrapMode:Er.e8.CLAMP_TO_EDGE,width:t.width,height:t.height}),this._colorTextures.set(e.id,i),this._activeTargets.add(e.id)),i}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:(0,qp.D)(),...GC,...e}}registerColorTarget(e={}){return{id:(0,qp.D)(),...jC,...e}}getFramebuffer(e,t,i){const r=this._getKey(t,i);let s=this._framebuffers.get(r);const n=this.getColorTexture(t,e);if(this.depthTextureSupported){const t=i?this.getDepthTexture(i,e):void 0;return s?((s.width!==e.width||s.height!==e.height||s.colorTexture!==n||s.depthStencilTexture!==t)&&(s.detachAll(),s.resize(e.width,e.height),s.attachColorTexture(n),s.attachDepthStencilTexture(t)),s):(s=(0,I.pC)(i)?new vs.X(this.rctx,{colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.DEPTH_STENCIL_TEXTURE},n,t):new vs.X(this.rctx,{colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.NONE},n),this._framebuffers.set(r,s),s)}const o=i?this.getDepthBuffer(i,e):void 0;return s?((s.width!==e.width||s.height!==e.height||s.colorTexture!==n)&&(s.detachAll(),s.resize(e.width,e.height),s.attachColorTexture(n),s.attachDepthStencilBuffer(o)),s):(s=new vs.X(this.rctx,{colorTarget:Er.Lm.TEXTURE,depthStencilTarget:i?Er.OU.DEPTH_STENCIL_RENDER_BUFFER:Er.OU.NONE},n,o),this._framebuffers.set(r,s),s)}_getKey(e,t){return`${e.id}_${t?t.id:"X"}_${e.name}${t?"_"+t.name:""}`}get gpuMemoryUsage(){let e=0;const t=new Set,i=i=>{t.has(i)||(t.add(i),e+=(0,js.un)(i))};return this._depthTextures.forEach(i),this._colorTextures.forEach(i),this._depthBuffers.forEach(i),e}}var ZC=s(36172);class qC{constructor(e,t){this._rctx=e,this._compositingHelper=t,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const i=e.type===ZC.zO.WEBGL2;this._renderTargetHelper=new WC(e);const r=this._renderTargetHelper;this.mainColorTargets=[r.registerColorTarget({name:"mainColorTarget0"}),r.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=r.registerColorTarget({name:"frontFaceTarget"});const s=e=>r.registerColorTarget({name:e,dataType:Er.Br.FLOAT,internalFormat:i?Er.lP.RGBA32F:Er.VI.RGBA,samplingMode:Er.cw.NEAREST});this.colorFloatTarget=s("colorFloatTarget"),this.alphaFloatTarget=s("alphaFloatTarget"),this.mainDepth=r.registerDepthTarget({name:"mainDepth"}),this.linearDepth=r.registerColorTarget({name:"linearDepth",samplingMode:Er.cw.NEAREST}),this.terrainLinearDepth=r.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=r.registerColorTarget({name:"geometryLinearDepth"}),this.normal=r.registerColorTarget({name:"normal"}),this.highlight=r.registerColorTarget({name:"highlight",internalFormat:i?Er.lP.RGBA4:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=r.registerColorTarget({name:"hudVisibility",internalFormat:i?Er.lP.RGBA4:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=r.registerColorTarget({name:"tmpColor"}),this.tmpDepth=r.registerDepthTarget({name:"tmpDepth"}),this.hudColor=r.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,t){return this._renderTargetHelper.getFramebuffer(this._dimensions,e,t)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=0===this._mainColorTarget&&this._needLastFrameColorTexture?1:0}initializeFrame(e){const t=this._rctx;this._dimensions.width=e.fullWidth,this._dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),t.setClearStencil(0);const i=this._background.color;t.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),t.clearSafe(Er.lk.COLOR_BUFFER_BIT|Er.lk.DEPTH_BUFFER_BIT|Er.lk.STENCIL_BUFFER_BIT)}composite(e){(0,I.pC)(this.colorTexture)&&this._compositingHelper.composite(e,this.colorTexture,tC.Fv.None)}renderTmpAndCompositeToMain(e,t,i,r=!1){this.renderToTargets(e,this.tmpColor,r?this.tmpDepth:this.mainDepth,$C),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),i)}renderHUDVisibility(e,t=!1){this.renderToTargets(e,this.hudVisibility,t?this.tmpDepth:this.mainDepth,YC)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets((()=>this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),tC.Fv.None,1,tC.v3.TransparentToHUDVisibility)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,t,i){let r,s;switch(t){case Bg.Am.Color:r=this.colorFloatTarget,s=[0,0,0,0];break;case Bg.Am.Alpha:r=this.alphaFloatTarget,s=[1,1,1,1];break;case Bg.Am.FrontFace:r=this.frontFaceTarget,s=[0,0,0,0]}i?this.renderToTargets(e,r,this.tmpDepth,s,!0,!0):this.renderToTargets(e,r,this.mainDepth,s,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),tC.Fv.PremultipliedAlpha)}compositeOccludedOntoMain(e,t){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),tC.Fv.PremultipliedAlpha,t)}compositeTransparentOntoOpaque(e,t){t?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Er.lk.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}set needLastFrameColorTexture(e){!e&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=e}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(e,t,i,r,s=!1,n=!1){const o=this._rctx,a=this.bindTarget(t,i);let l=0;if(r){const e=1e-13,t=Math.max(e,r[3]);o.setClearColor(r[0],r[1],r[2],t),l|=Er.lk.COLOR_BUFFER_BIT}return s&&(l|=Er.lk.DEPTH_BUFFER_BIT),!1===n?n=0:(!0===n&&(n=255),l|=Er.lk.STENCIL_BUFFER_BIT),l&&o.clearSafe(l,n),e(),o.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),a}bindTarget(e,t){const i=this._renderTargetHelper.getFramebuffer(this._dimensions,e,t);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this._dimensions)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}}const $C=[0,0,0,0],YC=[0,1,0,1];var XC=s(4051),JC=s(74533);class KC{constructor(e){this.context=e,this._renderPlugins=new Nd.Z,this.slots=[];for(let e=0;e<On.r.MAX_SLOTS;++e)this.slots[e]=[]}add(e,t,i){const r=()=>{if(i?.aborted)throw t.uninitializeRenderContext(),(0,f.zE)();this._renderPlugins.push(t);for(const i of e)this.slots[i].push(t);this.context.requestRender()},s=t.initializeRenderContext(this.context,i);if((0,f.y8)(s))return s.then(r);r()}remove(e){if(null!=this._renderPlugins.removeUnordered(e)){for(let t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter((t=>t!==e));e.uninitializeRenderContext(),this.context.requestRender()}}prepareRender(){this._renderPlugins.forAll((e=>{e.prepareRender&&e.prepareRender(this.context.renderContext)}))}updateAnimation(e){let t=!1;return this._renderPlugins.forAll((i=>{i.updateAnimation&&(t=i.updateAnimation(e)||t)})),t}render(){const e=this.slots[this.context.renderContext.bindParameters.slot],t=new Array;e.filter((e=>{if(!e.canRender)return!1;if(function(e){return"prepareTechnique"in e}(e)){const i=e.prepareTechnique(this.context.renderContext);return!!i&&(t.push(i),!0)}return t.push(null),!0})).forEach(((e,i)=>e.render(this.context.renderContext,t[i])))}queryDepthRange(e){const t=QC;return t.near=1/0,t.far=-1/0,this._renderPlugins.forAll((i=>{if(i.queryDepthRange){const r=i.queryDepthRange(e);r&&Ww(t,r,t)}})),t}get needsTransparentPass(){return this._renderPlugins.some((e=>e.needsTransparentPass))}get needsHighlight(){return this._renderPlugins.some((e=>e.needsHighlight))}get needsLinearDepth(){return this._renderPlugins.some((e=>e.needsLinearDepth))}get needsLaserlineWithContrastControl(){const e=this.slots[On.r.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce(((e,t)=>e|t.renderOccludedFlags),0)}}const QC={near:0,far:0};var eT=s(52436);class tT extends Cr.A{constructor(e,t){super(e,t,(()=>this.destroy()))}initializeProgram(e){const t=tT.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({blending:vx.wu,colorWrite:Ar.BK,depthTest:null,depthWrite:null})}get primitiveType(){return Er.MX.TRIANGLE_STRIP}}tT.shader=new xr.J(eT.S,(()=>s.e(5441).then(s.bind(s,65441))));var iT=s(50740);const rT=(0,pr.f)(.01,0,.25,1),sT=1/512;let nT=class extends O.Z{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=i,this._requestRender=r,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:rT,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new iT.l,this._enabled=!1,this._vao=(0,Lr.ow)(t),this._techniqueConfig.visualization=iT.w.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=(0,I.O3)(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(tT,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,(0,js._V)(this._vao,"geometry"))}setOptions(e){void 0!==e.enabled&&this._setEnabled(e.enabled),void 0!==e.color&&this._setColor(e.color),void 0!==e.threshold&&(this._threshold=e.threshold),void 0!==e.visualization&&(this._visualization=e.visualization),void 0!==e.bandSize&&(this._bandSize=e.bandSize),void 0!==e.bandsEnabled&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>sT}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;(0,Fd.g)(e,t)||((0,Fd.c)(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};(0,t._)([(0,m.Cb)()],nT.prototype,"opacityFromElevation",null),nT=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],nT);var oT,aT=s(80876),lT=s(89417);class cT extends Cr.A{constructor(e,t){super(e,t,(()=>this.destroy()))}initializeProgram(e){const t=cT.shader.get().build();return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.ONE,Er.zi.ONE,Er.zi.ONE,Er.zi.ONE),colorWrite:Ar.BK,depthTest:null,depthWrite:null})}get primitiveType(){return Er.MX.TRIANGLE_STRIP}}cT.shader=new xr.J(lT.a,(()=>s.e(6614).then(s.bind(s,16614))));let uT=oT=class extends O.Z{constructor(e,t,i,r,s,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new lT.S,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=qw,this._previewing=!1,this._handles=new Ae.Z,this._cameraForcedForScreenshot=!1,this._bindParameters=new ws.p(new aT.l(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new el.V,this._vao=(0,Lr.ow)(e);const o={colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.NONE,width:0,height:0},a={target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,samplingMode:Er.cw.LINEAR,wrapMode:Er.e8.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new vs.X(e,o,a),this._accumulationRenderer=new nT(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(nt.T8.SHADOW_ACCUMULATOR,this)),this._handles.add((0,he.YP)((()=>i.renderView),(e=>{this._handles.remove(oT.renderViewHandleKey),(0,I.Wi)(e)||this._handles.add(e.events.on("force-camera-for-screenshot",(()=>this._cameraForcedForScreenshot=!0)),oT.renderViewHandleKey)}),he.tX))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if((0,I.Wi)(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new cT(e,new Or.m)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return null!==this._passParameters.linearDepthTexture&&this._depthRange!==qw&&this._opacityFromElevation>sT}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if((0,v.fS)(t,e,dr.z))return;const i=e.length;t.length=i,this._sampleCount=Math.min(lT.s,i);for(let r=0;r<i;++r){const i=e[r],s=t[r]||(0,me.c)();(0,dr.c)(s,i),t[r]=s}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(oT.previewSamples,this._sampleCount-this._progress);for(let e=0;e<s;++e)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=(0,I.O3)(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=(0,I.O3)(this._fbo),this._vao=(0,I.O3)(this._vao),this._accumulationTechnique=(0,I.RY)(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.previewing&&(this.previewing=e.previewing),void 0!==e.lightDirections&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}set lightDirections(e){this._lightDirections=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=hT;return this._fbo.readPixels(e,t,1,1,Er.VI.RGBA,Er.Br.UNSIGNED_BYTE,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Er.lk.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,(0,js._V)(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-(0,$.CW)(4e4,5e4,e.relativeElevation))}set enabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};uT.previewSamples=6,uT.renderViewHandleKey="renderView",(0,t._)([(0,m.Cb)()],uT.prototype,"_progress",void 0),(0,t._)([(0,m.Cb)()],uT.prototype,"_sampleCount",void 0),(0,t._)([(0,m.Cb)()],uT.prototype,"_enabled",void 0),(0,t._)([(0,m.Cb)()],uT.prototype,"_depthRange",void 0),(0,t._)([(0,m.Cb)()],uT.prototype,"_previewing",void 0),(0,t._)([(0,m.Cb)()],uT.prototype,"_accumulationRenderer",void 0),(0,t._)([(0,m.Cb)()],uT.prototype,"_isRefining",null),(0,t._)([(0,m.Cb)()],uT.prototype,"_isActive",null),(0,t._)([(0,m.Cb)()],uT.prototype,"canAccumulate",null),(0,t._)([(0,m.Cb)()],uT.prototype,"_isDoneAccumulating",null),(0,t._)([(0,m.Cb)()],uT.prototype,"_opacityFromElevation",null),(0,t._)([(0,m.Cb)()],uT.prototype,"running",null),uT=oT=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],uT);const hT=new Uint8Array(4);var dT=s(45416),pT=s(23839);class fT extends Pr.K{constructor(){super(...arguments),this.shadowColor=(0,pr.f)(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class mT extends Cr.A{constructor(e){super(e,null,(()=>this.destroy()))}initializeProgram(e){const t=mT.shader.get().build();return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.SRC_ALPHA,Er.zi.ONE,Er.zi.ONE_MINUS_SRC_ALPHA,Er.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ar.BK,depthTest:null,depthWrite:null})}get primitiveType(){return Er.MX.TRIANGLE_STRIP}}mT.shader=new xr.J(pT.S,(()=>s.e(2420).then(s.bind(s,32420))));class gT{constructor(e,t){this._rctx=e,this._viewingMode=t,this._maxOpacity=1,this._passParameters=new fT,this._drawParameters=new dT.ry,this._vao=(0,Lr.ow)(this._rctx)}get technique(){return(0,I.Wi)(this._technique)&&(this._technique=new mT({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(e,t){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this.technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(t),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,(0,js._V)(this._vao,"geometry"))}get gpuMemoryUsage(){return this._vao?.size??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,t){this._passParameters.opacityElevation=1-(0,$.CW)(4e4,5e4,e.relativeElevation);const i=this._viewingMode===Nt.JY.Global?(0,dr.n)(yT,e.center):(0,dr.s)(yT,0,0,1),r=(0,dr.e)(i,t);this._passParameters.dayNightTerminator=(0,$.CW)(0,1,(0,$.uZ)(30*r,0,1))}dispose(){this._vao=(0,I.O3)(this._vao),this._technique=(0,I.RY)(this._technique)}get isVisible(){const{opacityElevation:e,dayNightTerminator:t}=this._passParameters;return this._maxOpacity*e*t>=.001953125}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}}const yT=(0,me.c)(),_T=(0,be.c)();class vT{constructor(){this._plane=(0,be.c)()}get isEnabled(){return!(0,be.d)(this.plane,_T)}get plane(){return this._plane}set plane(e){(0,be.a)(e||_T,this._plane)}}var bT=s(41490);class wT extends Cr.A{initializeProgram(e){const t=wT.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,Tr.i)}initializePipeline(){return(0,Ar.sm)({colorWrite:Ar.BK})}}wT.shader=new xr.J(bT.S,(()=>s.e(7263).then(s.bind(s,67263))));var xT=s(52694);let CT=class extends O.Z{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=(0,I.IM)(this._abortController),this.disable()}_loadResources(e){if((0,I.pC)(this._abortController))return!1;if((0,I.pC)(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return s.e(6182).then(s.bind(s,66182)).then((e=>this._loadTextures(e,t))).then((()=>e())).finally((()=>this._abortController=null)),!1}_loadTextures(e,t){return(0,f.k_)(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,Er.cw.LINEAR,Er.VI.RGB),this._loadTextureFromBase64(e.searchTexure,Er.cw.NEAREST,Er.VI.LUMINANCE)]).then((([e,i])=>{(0,f.Hc)(t)?(e.dispose(),i.dispose(),(0,f.k_)(t)):(this._areaTexture=e,this._searchTexture=i)}))}get updating(){return(0,I.pC)(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const e=new xT.L,t=(e,t)=>this._techniqueRep.releaseAndAcquire(wT,e,t);e.output=xT.f.EdgeDetector,this._edgeDetectTechnique=t(e,this._edgeDetectTechnique),e.output=xT.f.BlendWeight,this._blendWeightsTechnique=t(e,this._blendWeightsTechnique),e.output=xT.f.Blur,this._blurTechnique=t(e,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=(0,Lr.E9)(this.rctx),this._edges=new vs.X(this.rctx,{colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.NONE},{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGB,dataType:Er.Br.UNSIGNED_BYTE,samplingMode:Er.cw.LINEAR,wrapMode:Er.e8.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new vs.X(this.rctx,{colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.NONE},{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,samplingMode:Er.cw.LINEAR,wrapMode:Er.e8.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=(0,I.O3)(this._vao),this._areaTexture=(0,I.O3)(this._areaTexture),this._searchTexture=(0,I.O3)(this._searchTexture),this._blend=(0,I.O3)(this._blend),this._edges=(0,I.O3)(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,i=t.getBoundFramebufferObject(),r={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(r.x,r.y,r.width,r.height),this._edges.resize(r.width,r.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(Er.lk.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._edgeDetectTechnique);s.bindTexture("tColor",e),s.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),t.drawArrays(Er.MX.TRIANGLES,0,3),this._blend.resize(r.width,r.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(Er.lk.COLOR_BUFFER_BIT);const n=t.bindTechnique(this._blendWeightsTechnique);n.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture("tSearch",this._searchTexture),n.bindTexture("tArea",this._areaTexture),n.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays(Er.MX.TRIANGLES,0,3),t.bindFramebuffer(i),t.setClearColor(0,1,0,1),t.clear(Er.lk.COLOR_BUFFER_BIT);const o=t.bindTechnique(this._blurTechnique);o.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),o.bindTexture("tColor",e),o.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays(Er.MX.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,i){return(0,Is.t)(e).then((e=>new Hs.x(this.rctx,{pixelFormat:i,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.CLAMP_TO_EDGE,width:e.width,height:e.height,samplingMode:t},e)))}};(0,t._)([(0,m.Cb)()],CT.prototype,"_abortController",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],CT.prototype,"updating",null),CT=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],CT);var TT=s(5198);class ST{constructor(e){this.factory=e,this.originData=new Map}acquire(e){return this.register(this.factory.getOrigin(e))}register(e){const t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:(0,kr.c)(),origin:e}),e)}release(e){const t=this.originData.get(e.id);t&&(t.refCount--,0===t.refCount&&this.originData.delete(e.id))}updateViewMatrices(e){this.originData.forEach((t=>{(0,Fr.c)(t.viewMatrix,e),function(e,t){const i=t,r=e[0],s=e[1],n=e[2];i[12]+=r*i[0]+s*i[4]+n*i[8],i[13]+=r*i[1]+s*i[5]+n*i[9],i[14]+=r*i[2]+s*i[6]+n*i[10],i[14]+=r*i[3]+s*i[7]+n*i[11]}(t.origin.vec3,t.viewMatrix)}))}getViewMatrix(e){return this.originData.get(e.id).viewMatrix}}var ET=s(49394),AT=s(68083),MT=s(11591),OT=s(62295);class RT extends OT.su{constructor(e,t,i){super(),this.distanceFalloffFactor=e,this.minimumEdgeLength=t,this.transparency=i,this.transformNormalViewFromGlobal=(0,Ga.c)()}}class PT extends OT.OU{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,Ga.c)(),this.slicePlaneLocalOrigin=(0,me.c)(),this.transformNormalGlobalFromModel=(0,Ga.c)()}}var IT=s(94721);class LT extends Cr.A{initializeProgram(e){const t=LT.shader.get().build(this.configuration);return new Sr.$(e.rctx,t,zx.so)}initializePipeline(e){return e.blendMinMax?(0,Ar.sm)({blending:(0,Ar.wK)(Er.zi.ONE,Er.zi.ONE,Er.zi.ZERO,Er.zi.ONE,Er.db.ADD,e.blendMinMax.MAX),depthTest:{func:Er.wb.LEQUAL},colorWrite:Ar.BK}):(0,Ar.sm)({depthTest:{func:Er.wb.LEQUAL},depthWrite:Ar.LZ,colorWrite:Ar.BK})}}LT.shader=new xr.J(IT.E,(()=>s.e(9397).then(s.bind(s,19397))));var DT=s(37630);class NT extends Gb.W{constructor(){super(...arguments),this.mode=DT.Jb.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}(0,t._)([(0,Or.o)({count:DT.Jb.COUNT})],NT.prototype,"mode",void 0),(0,t._)([(0,Or.o)()],NT.prototype,"hasSlicePlane",void 0),(0,t._)([(0,Or.o)()],NT.prototype,"silhouette",void 0),(0,t._)([(0,Or.o)()],NT.prototype,"legacy",void 0),(0,t._)([(0,Or.o)()],NT.prototype,"antialiasing",void 0),(0,t._)([(0,Or.o)()],NT.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,t._)([(0,Or.o)()],NT.prototype,"hasMultipassTerrain",void 0),(0,t._)([(0,Or.o)()],NT.prototype,"cullAboveGround",void 0),(0,t._)([(0,Or.o)()],NT.prototype,"spherical",void 0);var FT=s(75427);const kT={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class UT{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const VT={solid:DT.Jb.SOLID,sketch:DT.Jb.SKETCH,uber:DT.Jb.MIXED};class zT{constructor(e,t,i){this.rctx=e,this.shaderTechniqueRepository=t,this._configuration=new NT,this.refCount=new UT,this.renderables=new Set,this.sortedRenderables={[FT.i.TRANSPARENT]:{[FT.i.TRANSPARENT]:new Nd.Z,[FT.i.OPAQUE]:new Nd.Z},[FT.i.OPAQUE]:{[FT.i.TRANSPARENT]:new Nd.Z,[FT.i.OPAQUE]:new Nd.Z}},this._renderablesDirty=!1,this._drawParameters=new PT,this._settings={...kT,...i},this.key=zT.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const r=this._settings.strokesTexture.variants;this.writerSettings={variants:r,reducedPrecision:kd.Z.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=VT[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=(0,_x.I)(e),this._configuration.spherical=i.spherical}dispose(){this._technique=(0,I.RY)(this._technique)}addRenderable(e){this.renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this.renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,t){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[t][FT.i.TRANSPARENT].forAll(e),this.sortedRenderables[t][FT.i.OPAQUE].forAll(e)}updateTechnique(e,t){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=t,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(LT,this._configuration,this._technique),this._technique}bindRegularEdges(e,t){return this.rctx.bindTechnique(this.updateTechnique(t,!1),e,t)}bindSilhouetteEdges(e,t){return this.rctx.bindTechnique(this.updateTechnique(t,!0),e,t)}renderRegularEdges(e,t,i,r,s){this._render(e,t,t.regular.vao,i,r,s)}renderSilhouetteEdges(e,t,i,r,s){this._render(e,t,t.silhouette.vao,i,r,s)}_render(e,t,i,r,s,n){this._bindDraw(e,t,r,n),this.rctx.bindVAO(i),this.rctx.capabilities.instancing.drawArraysInstanced(Er.MX.TRIANGLE_FAN,0,4,s)}_bindDraw(e,t,i,r){if(t.components.buffer.textureBuffer.bind(e,BT,HT),"origin"in t.transform)e.setUniformMatrix4fv("localView",r),e.setUniformMatrix4fv("model",t.transform.modelMatrix),(0,dr.c)(this._drawParameters.slicePlaneLocalOrigin,t.transform.origin.vec3);else{const e=new Px(t.transform.position),r=(0,as.t)(jT,(0,as.e)(jT,t.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=e.low,this._drawParameters.transformWorldFromModelTH=e.high,this._drawParameters.transformWorldFromModelRS=t.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=r;const s=i.camera.viewInverseTransposeMatrix;(0,dr.s)(this._drawParameters.slicePlaneLocalOrigin,s[3],s[7],s[11])}e.bindDraw(this._drawParameters,i),"uber"!==this._settings.type&&"sketch"!==this._settings.type||this._setSketchUniforms(e)}_setSketchUniforms(e){const t=this._settings.strokesTexture,i=t.texture;(0,I.Wi)(i)||(e.bindTexture("strokesTexture",i),e.setUniform2f("strokesTextureScale",1/i.descriptor.width,1/i.descriptor.height),e.setUniform1f("strokesLog2Resolution",Math.log2(t.resolution)),e.setUniform1f("strokesNormalizationScale",t.normalizationScale),e.setUniform1f("strokesAmplitude",t.amplitude),e.setUniform1f("strokeVariants",t.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[FT.i.TRANSPARENT][FT.i.TRANSPARENT].clear(),this.sortedRenderables[FT.i.TRANSPARENT][FT.i.OPAQUE].clear(),this.sortedRenderables[FT.i.OPAQUE][FT.i.TRANSPARENT].clear(),this.sortedRenderables[FT.i.OPAQUE][FT.i.OPAQUE].clear(),this.renderables.forEach((e=>{e.objectTransparency!==FT.i.INVISIBLE&&e.edgeTransparency!==FT.i.INVISIBLE&&this.sortedRenderables[e.objectTransparency][e.edgeTransparency].push(e)}));const e=(e,t)=>"origin"in e.transform&&"origin"in t.transform?e.transform.origin.id<t.transform.origin.id?-1:e.transform.origin.id>t.transform.origin.id?1:0:0;this.sortedRenderables[FT.i.TRANSPARENT][FT.i.TRANSPARENT].sort(e),this.sortedRenderables[FT.i.TRANSPARENT][FT.i.OPAQUE].sort(e),this.sortedRenderables[FT.i.OPAQUE][FT.i.TRANSPARENT].sort(e),this.sortedRenderables[FT.i.OPAQUE][FT.i.OPAQUE].sort(e)}static getKey(e,t,i){return`edges-t:${e}:${t}:${i}`}}const BT="componentDataTex",HT="componentDataTexInvDim",jT=(0,Xv.c)();var GT,WT=s(93396);function ZT(e,t){if(!e)return null;const i=e.length/2,r=qT*i,s=new Array(i);let n=0;const o=t===GT.PRESSURE;for(let t=0;t<e.length;t+=2){const i=(e[t]+e[t+1])/2;s[n++]=o?Math.min(r,1-(1-i)*$T):Math.min(r,i*$T)}return s}!function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"}(GT||(GT={}));const qT=.1,$T=.5;class YT{constructor(e,t,i,r,s){this.resolution=e,this.normalizationScale=t,this.amplitude=i,this.variants=r,this.texture=s}dispose(){this.texture=(0,I.O3)(this.texture)}}const XT=8,JT=256,KT=[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}];function QT(e){let t=null;for(const i of e){const e=i.type;if(rS(i))if((0,I.Wi)(t))t=e;else if(t!==e)return"uber"}return(0,I.pC)(t)?t:"uber"}function eS(e){let t=FT.i.INVISIBLE;for(const{material:i}of e)if(iS(i)){if(i.color[3]*i.opacity<1)return FT.i.TRANSPARENT;t=FT.i.OPAQUE}return t}function tS(e){let t=FT.i.INVISIBLE;for(const{material:i}of e)if(iS(i)){switch(i.objectTransparency){case FT.i.TRANSPARENT:case FT.i.INVISIBLE:return FT.i.TRANSPARENT;case FT.i.OPAQUE:if(i.opacity<1)return FT.i.TRANSPARENT}t=FT.i.OPAQUE}return t}function iS(e){return e.size*e.color[3]*e.opacity>0}function rS(e){return e.size*e.color[3]>0}function sS(e,t,i){return e.length-function(e,t){const i=(0,v.$A)(e,t,!0);return-1===i?t<e[0]?0:e.length:i}(e,t*i.minimumEdgeLength)}function nS(e,t,i,r){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(r)for(let e=o;e<a;e++){const t=r[e];i.set(t,n)}else for(let e=o;e<a;e++)i.set(e,n)}}const oS=p.Z.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let aS=class extends O.Z{constructor(e){super(e),this.updatingHandles=new Ke.t,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[FT.i.TRANSPARENT]:0,[FT.i.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=(0,me.c)(),this.localOrigins=new ST(new vw.C(e.renderSR))}initialize(){this.worker=new WT.Z(this.schedule),this.componentColorManager=new Wx(this.rctx,3);const e=zx.rD.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,0===t||3===t?0:1),e.sideness.set(t,1,0===t||1===t?0:1);this.verticesBufferObject=Bs.f.createVertex(this.rctx,Er.l1.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach((e=>this._discardObjectEntry(e))),this.perObjectData.clear(),this.strokesTexture=(0,I.O3)(this.strokesTexture),this.componentColorManager=(0,I.SC)(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=(0,I.O3)(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[FT.i.TRANSPARENT]+this.numberOfRenderedEdges[FT.i.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,i,r,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new lS(new Promise((e=>l=e)),i.center,i.radius);this.perObjectData.set(e,c);const u=await this.updatingHandles.addPromise(this._addComponentGeometry(t,c,r,s,n,o,a));return this.setNeedsRender(),l(),u}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void oS.warn("Attempt to add an object to a destroyed instance");const s=this.perObjectData.get(e);let n;s?.renderables.length>0&&this.perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new lS(new Promise((e=>n=e)),(0,fo.g)(o),(0,fo.d)(o));this.perObjectData.set(e,a);const l=new Array;if(i.mergeGeometries&&e.geometries.length>1&&function(e){let t=null,i=null;for(let r=0;r<e.geometries.length;r++){const s=e.geometryRecords[r];if(s.material.supportsEdges){if(t){if(!(0,v.fS)(t,s.transformation))return!1}else t=s.transformation;if(!i&&(0,I.pC)(s.origin))i=s;else if((0,I.pC)(i?.origin)&&(0,I.pC)(s.origin)&&i.origin.id!==s.origin.id)return!1}}return!0}(e))l.push(this._addObjectMergedGeometries(e,a,t,i,r));else for(let s=0;s<e.geometries.length;s++){const n=e.geometryRecords[s];if(!n.material.supportsEdges)continue;const o=e.geometries[s];l.push(this._addGeometry(e,a,o,n,t[0],i,r))}await this.updatingHandles.addPromise(Promise.all(l)),this.perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach((e=>this._removeRenderable(e))),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=t instanceof Array?e=>t[e]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach((e=>{const t=e.components.meta.length;for(let r=0;r<t;r++){const t=i(r),s=e.components.meta[r],n=s.index;s.material.opacity=t,e.components.buffer.textureBuffer.setDataElement(n,1,3,255*t)}this._updateTransparency(e)})),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce(((e,t)=>e+t.statistics.gpuMemoryUsage),0)}async updateAllComponentMaterials(e,t,i,r){const s=e instanceof ET.T,n=!!i.hasSlicePlane,o=QT(t),a=zT.getKey(o,n,s);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach((e=>{if(a!==e.rendererKey){const t=this.renderers.get(e.rendererKey),i=this._acquireRenderer(o,n,s);t.removeRenderable(e),t.refCount.decrement(),e.rendererKey=a,i.addRenderable(e)}for(let i=0;i<t.length;i++)e.components.meta[i].material=t[i];r&&this._updateComponentBuffer(e.components),this._updateTransparency(e)})),this.setNeedsRender()}async updateAllVerticalOffsets(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach((e=>{const i=e.components.meta;for(let r=0;r<i.length;r++)e.components.meta[r].verticalOffset=t?.[r]??0;this._updateComponentBuffer(e.components)})),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach((e=>e.visible=t)),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";if(await t.loaded,null==t.loaded)throw(0,f.zE)();return t}removeAll(){this.perObjectData.forEach(((e,t)=>this.removeObject(t)))}render(e,t){if(this.numberOfRenderedEdges[t]=0,(0,I.Wi)(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=(0,me.c)(),s=new Px;let n=0,o=0;if(this.renderers.forEach((i=>{0===i.refCount.value?(this.renderers.delete(i.key),i.dispose()):i.forEachRenderable((t=>{t.visible&&(n+=t.statistics.averageEdgeLength,o++,t.regular&&i.updateTechnique(e,!1),t.silhouette&&i.updateTechnique(e,!0))}),t)})),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),0===o)return;const a=40*n/o,l=e.camera.perScreenPixelRatio,c=new RT(a,l,t);(0,dr.s)(r,i[3],i[7],i[11]),s.set(r),(0,dr.c)(c.transformWorldFromViewTH,s.high),(0,dr.c)(c.transformWorldFromViewTL,s.low),(0,as.f)(c.transformViewFromCameraRelativeRS,e.camera.viewMatrix),(0,as.t)(cS,c.transformViewFromCameraRelativeRS),(0,as.e)(c.transformNormalViewFromGlobal,cS),c.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach((t=>{this._renderRegularEdges(t,e,c),this._renderSilhouetteEdges(t,e,c)}))}_updateTransparency(e){const t=eS(e.components.meta),i=tS(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,i){if(e.getCombinedStaticTransformation(t,i),(0,I.pC)(t.origin))this.localOrigins.register(t.origin);else{const e=(0,dr.s)(this.tmpModelPosition,i[12],i[13],i[14]);t.origin=this.localOrigins.acquire(e)}return function(e,t){const i=t,r=-e[0],s=-e[1],n=-e[2],o=i[3],a=i[7],l=i[11],c=i[15];i[0]+=o*r,i[1]+=o*s,i[2]+=o*n,i[4]+=a*r,i[5]+=a*s,i[6]+=a*n,i[8]+=l*r,i[9]+=l*s,i[10]+=l*n,i[12]+=c*r,i[13]+=c*s,i[14]+=c*n}(t.origin.vec3,i),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:i}=e,r=new Uint8Array(4);for(let e=0;e<t.length;e++){const s=t[e].material,n=t[e].index,o=(0,$.uZ)(Math.round(8*s.size),0,255),a=(0,$.uZ)(s.extensionLength,-128,127)+128,l="solid"===s.type?MT.P.SOLID:MT.P.SKETCH,c=255*s.opacity,u=s.color,h=255*u[0],d=255*u[1],p=255*u[2],f=255*u[3];i.textureBuffer.setData(n,0,h,d,p,f),i.textureBuffer.setData(n,1,o,a,l,c),(0,gx.nO)(t[e].verticalOffset,r),i.textureBuffer.setData(n,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(e){if((0,I.Wi)(this.componentColorManager))return null;const t=new Array,i=this.componentColorManager.getBuffer(e.length);for(let r=0;r<e.length;r++){const s=e[r],n=i.acquireIndex();t.push({index:n,verticalOffset:0,material:s})}const r={meta:t,buffer:i};return this._updateComponentBuffer(r),r}_extractEdges(e,t,i,r,s,n=s.length){return this.worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:i},this.workerAbort.signal,r)}_createEdgeResources(e){const t={};if((0,I.Wi)(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const i=new Gs.U(this.rctx,zx.so,{vertices:zx.dx,instances:AT.D9.glLayout},{vertices:this.verticesBufferObject,instances:Bs.f.createVertex(this.rctx,Er.l1.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:i,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const i=new Gs.U(this.rctx,zx.so,{vertices:zx.dx,instances:AT.qE.glLayout},{vertices:this.verticesBufferObject,instances:Bs.f.createVertex(this.rctx,Er.l1.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:i,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,i,r,s,n,o){const a=i.vertexAttributes.get(zs.T.POSITION),l=i.indices.get(zs.T.POSITION),c=(0,kr.c)(),u={position:a,indices:l,modelTransform:c,origin:this._computeModelTransformWithLocalOrigin(e,r,c)};return this._addPositionData(t,u,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,t,i,r,s,n=!1){if(null==e.loaded)return;const o=this._createComponentBuffers([r]);if((0,I.Wi)(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,u=t.indices,h=t.position,d=h.data.length/h.size,p=zx.tf.createBuffer(d);for(let e=0;e<d;e++)p.position.set(e,0,h.data[e*h.size+0]),p.position.set(e,1,h.data[e*h.size+1]),p.position.set(e,2,h.data[e*h.size+2]);nS(o.meta,[0,p.componentIndex.count],p.componentIndex);const f=await this.updatingHandles.addPromise(this._extractEdges(a.writerSettings,p,!1,n,u,i));if(null==e.loaded)return;const{regular:m,silhouette:g}=this._createEdgeResources(f),y=(m?m.vao.size:0)+(g?g.vao.size:0),_={regular:m,silhouette:g,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:y,externalMemoryUsage:!1,averageEdgeLength:f.averageEdgeLength},components:o,visible:!0,edgeTransparency:eS(o.meta),objectTransparency:tS(o.meta),distanceToCamera:0,rendererKey:a.key};e.renderables.push(_),a.addRenderable(_),this.gpuMemoryUsage+=y}async _addComponentGeometry(e,t,i,r,s,n,o){if(null==t.loaded)return 0;const a=this._createComponentBuffers(n);if((0,I.Wi)(a))return 0;const l=QT(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),u=zx.tf.createBuffer(i.count);(0,Ew.c)(u.position,i),nS(a.meta,s,u.componentIndex,r);const h=c.writerSettings,d=await this.updatingHandles.addPromise(this._extractEdges(h,u,!0,!1,r));if(null==t.loaded)return 0;const{regular:p,silhouette:f}=this._createEdgeResources(d),m=(p?p.vao.size:0)+(f?f.vao.size:0),g={regular:p,silhouette:f,transform:e,statistics:{gpuMemoryUsage:m,externalMemoryUsage:!0,averageEdgeLength:d.averageEdgeLength},components:a,visible:!0,edgeTransparency:eS(a.meta),objectTransparency:tS(a.meta),distanceToCamera:0,rendererKey:c.key};return t.renderables.push(g),c.addRenderable(g),m}async _addObjectMergedGeometries(e,t,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let t=0;t<e.geometries.length;t++){const i=e.geometries[t],r=e.geometryRecords[t];if(!r.material.supportsEdges)continue;!a&&r.origin&&(a=r);const s=i.vertexAttributes.get(zs.T.POSITION);l+=s.data.length/s.size,o+=i.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,u=o?new c(o):null,h=[];let d=0;for(let t=0;t<e.geometries.length;t++){const i=e.geometries[t];if(!e.geometryRecords[t].material.supportsEdges)continue;const r=i.vertexAttributes.get(zs.T.POSITION),s=i.indices.get(zs.T.POSITION);let o=n.get(r.data);if(null==o){o=h.length/3;for(let e=0;e<r.data.length;e+=r.size)h.push(r.data[e+0]),h.push(r.data[e+1]),h.push(r.data[e+2]);n.set(r.data,o)}if(s)for(let e=0;e<i.edgeIndicesLength;e++)u[d++]=o+s[e]}const p=a||e.geometryRecords[0],f=(0,kr.c)(),m=this._computeModelTransformWithLocalOrigin(e,p,f);for(let t=0;t<e.geometryRecords.length;t++)e.geometryRecords[t].origin=m;const g={position:{data:h,size:3},indices:u,modelTransform:f,origin:m};await this.updatingHandles.addPromise(this._addPositionData(t,g,u.length,i[0],r,s))}_acquireRenderer(e,t,i){const r=zT.getKey(e,t,i);let s=this.renderers.get(r);return(0,I.Wi)(this.strokesTexture)&&(this.strokesTexture=function(e){const t=JT,i=t/2,r=new Uint8Array(4*t*t),s=4*t*i,n=XT,o=2*n,a=4*t,l=Math.log2(t)+1,c=KT.length;let u=(l-1)*c*a;for(const{distance:e,pressure:t}of KT){let i=e,n=t,h=u;for(let e=0;e<l;e++){0!==e&&(i=ZT(i,GT.DISTANCE),n=ZT(n,GT.PRESSURE));for(let e=0;e<JT;e++){const t=.5+(i?i[e%i.length]/o:0),a=n?n[e%n.length]:1;(0,sC.I)(t,r,h),(0,sC.I)(a,r,h+s),h+=4}h-=a*(c+1)}u+=a}const h=new Hs.x(e,{pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:Er.cw.LINEAR,width:t,height:t,wrapMode:Er.e8.REPEAT},r);return new YT(t,o,n,c,h)}(this.rctx)),s||(s=new zT(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:i,spherical:this.viewingMode===Nt.JY.Global}),this.renderers.set(r,s)),s.refCount.increment(),s}_removeRenderable(e){!function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const t of e.components.meta)e.components.buffer.releaseIndex(t.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=(0,me.c)(),s=e=>{const{center:s,radius:n}=e;(0,dr.v)(r,s,t);const o=(0,dr.e)(r,i),a=o<-n?1/0:o<n?0:o-n;e.renderables.forEach((e=>e.distanceToCamera=a))};this.perObjectData.forEach(s),this.perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,i){const r=e.bindRegularEdges(i,t),s=i.transparency;e.forEachRenderable((n=>{if(!n.visible||!n.regular)return;const o=sS(n.regular.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):kr.I;e.renderRegularEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o}),s)}_renderSilhouetteEdges(e,t,i){const r=e.bindSilhouetteEdges(i,t),s=i.transparency;e.forEachRenderable((n=>{if(!n.visible||!n.silhouette)return;const o=sS(n.silhouette.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):kr.I;e.renderSilhouetteEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o}),s)}};(0,t._)([(0,m.Cb)({constructOnly:!0})],aS.prototype,"rctx",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],aS.prototype,"renderSR",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],aS.prototype,"viewingMode",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],aS.prototype,"techniqueRepository",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],aS.prototype,"setNeedsRender",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],aS.prototype,"schedule",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aS.prototype,"updatingHandles",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aS.prototype,"updating",null),aS=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],aS);class lS{constructor(e,t,i){this.center=t,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then((()=>{null!=this.loaded&&(this.loaded=!0)}))}}const cS=(0,Ga.c)();var uS=s(1055),hS=s(31168),dS=s(95620);class pS{constructor(e){this.timer=e,this.start=e.createQuery(),e.createTimestamp(this.start)}stop(e,t=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(e,t)}_checkQueryResult(e,t){if(!this.timer.resultAvailable(this.end))return void setTimeout((()=>this._checkQueryResult(e,t)),t);if(this.timer.disjoint())return void e(null);const i=this.timer.getResult(this.start),r=this.timer.getResult(this.end);e((r-i)/1e6)}}class fS{constructor(e){this.timer=e,this.query=e.createQuery(),mS=!0,this.timer.beginTimeElapsed(this.query)}stop(e,t=50){this.timer.endTimeElapsed(),mS=!1,this._checkQueryResult(e,t)}_checkQueryResult(e,t){const i=this.timer.resultAvailable(this.query),r=this.timer.disjoint();if(!i||r)r?e(null):setTimeout((()=>this._checkQueryResult(e,t)),t);else{const t=this.timer.getResult(this.query);e(t/1e6)}}}let mS=!1;var gS;!function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"}(gS||(gS={}));const yS=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class _S extends hS.Z{constructor(){super("total"),this.total=0,this.frameCount=0}}class vS{constructor(){this._startTime=(0,Ys.HA)(0),this._lastSample=(0,Ys.HA)(0),this._enableGPUTimer=0,this.totalTime=new _S,this.gpuTime=new hS.Z("gpu",9),this.renderPassTimings=yS.map((e=>new hS.Z(e)))}get elapsedTime(){return(0,Ys.HA)(performance.now()-this._startTime)}enableGPUTimer(){return++this._enableGPUTimer,{remove:(0,dS.IH)((()=>--this._enableGPUTimer))}}prerender(e){this._startTime=this._lastSample=(0,Ys.HA)(performance.now()),this._enableGPUTimer&&(this._gpuTimer=function(e){const t=e.capabilities.disjointTimerQuery;return(0,I.Wi)(t)?null:t.timestampBits()>0?new pS(t):mS?null:new fS(t)}(e))}advance(e){const t=(0,Ys.HA)(performance.now());this.renderPassTimings[e].record(t-this._lastSample),this._lastSample=t}postrender(){(0,I.pC)(this._gpuTimer)&&(this._gpuTimer.stop((e=>(0,I.pC)(e)&&this.gpuTime.record(e)),16),this._gpuTimer=null);const e=performance.now()-this._startTime;this.totalTime.record(e),this.totalTime.total+=e,this.totalTime.frameCount++}}let bS=class extends O.Z{constructor(e,t,i,r,s,n,o,a,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=r,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=o,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new vS,this._antialiasing=Bg.C_.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=(0,Ys.HA)(0),this._handles=new Ae.Z,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new CT(this._rctx,i),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new qC(this._rctx,this._compositingHelper),this._sliceHelper=new vT,this._shadowMap=new aT.l(this._rctx,l.viewingMode,2),this._ssaoHelper=new TT.L(i,this._rctx,(()=>this._requestRender())),this._highlight=new BC(i,this._rctx),this._shadowHighlight=new gT(this._rctx,l.viewingMode),this._shadowAccumulator=new uT(this._rctx,i,l,(e=>{const t=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(e.camera,e.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=t}),((e,t,i)=>{e.shadowMap.start(e.camera,t,i),this._renderShadowCascades(Mn.C.MATERIAL_DEPTH_SHADOWMAP_ALL,e.shadowMap),e.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(e.camera,e.contentCamera)}),(()=>this._requestRender())),this._renderContext=new XC.V(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new KC({renderContext:this._renderContext,shaderTechniqueRepository:i,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:a}),this.renderPassManager=new MC(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([(0,he.YP)((()=>this._stage.state.camera),(()=>this._requestRender()),he.tX),(0,he.YP)((()=>kd.Z.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES),(e=>{this._renderHiddenTransparentEdges=e?()=>this._renderEdges(FT.i.TRANSPARENT):()=>{},this._requestRender()}),he.nn)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._edgeView=(0,I.SC)(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=(0,I.O3)(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),LC.j.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===Bg.C_.SMAA&&this._smaaPass.updating||(0,I.pC)(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return(0,I.Wi)(this._edgeView)&&(this._edgeView=new aS({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add((0,he.YP)((()=>(0,I.yw)(this._edgeView,(e=>e.updating))),(()=>this._requestRender()),he.Z_)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return(0,Fr.v)(this._bindParameters.ssr.reprojectionMatrix,kr.I)}set _reprojectionMatrix(e){(0,v.Vx)(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:i,_bindParameters:r}=this;if(void 0!==e.screenSpaceReflectionsEnabled&&r.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(r.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),void 0!==e.shadowMap&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),void 0!==e.shadowMapMaxCascades&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),(0,I.pC)(e.environment)){(0,I.pC)(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible,this._renderContext.bindParameters.weather=e.environment.weather,this._renderContext.bindParameters.weatherVisible=e.weatherVisible),void 0!==e.environment.lighting.ambientOcclusionEnabled&&i.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(i.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),void 0!==e.environment.lighting.waterReflectionEnabled&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const t="sun"===e.environment.lighting.type;r.enableFillLights!==t&&(r.enableFillLights=t,this._requestRender())}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const s=e.antialiasingEnabled?Bg.C_.SMAA:Bg.C_.NONE;void 0!==e.antialiasingEnabled&&this._antialiasing!==s&&(this._antialiasing=s,this._requestRender()),void 0!==e.highQualityTransparency&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),void 0!==e.defaultHighlightOptions&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),void 0!==e.overlays&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),void 0!==e.slicePlane&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=(0,I.Wg)(e.slicePlane),this._requestRender()),void 0!==e.transparentTerrain&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),void 0!==e.hasOverlayWater&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),void 0!==e.shadowCastOptions&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:i,updates:r}=e;if(0===t.length&&0===i.length&&0===r.length)return;i.forAll((({id:e})=>this._content.delete(e))),t.forAll((e=>this._content.set(e.id,e)));const s=(0,JC.q)(e);let n=!1;s.forEach(((e,t)=>{let i=this._materialRenderers.get(t);if(!i){if(!(e.adds.length>0))return;i=new uS.A(this._rctx,this._materialRepository,t),this._materialRenderers.set(t,i)}i.modify(e),i.isEmpty&&(n=!0)})),n&&this._materialRenderers.forEach(((e,t)=>{e.isEmpty&&(this._materialRenderers.delete(t),e.dispose())})),this._hasHighlights=(0,Je.oE)(this._materialRenderers,(e=>e.hasHighlights)),this._bindParameters.hasOccludees=(0,Je.oE)(this._materialRenderers,(e=>e.hasOccludees)),this._hasWater=(0,Je.oE)(this._materialRenderers,(e=>e.hasWater)),this._needsTransparentPass=(0,Je.oE)(this._materialRenderers,(e=>e.requiresSlot(On.r.TRANSPARENT_MATERIAL,Mn.C.MATERIAL))),this._hasHUDElements=(0,Je.oE)(this._materialRenderers,(e=>e.requiresSlot(On.r.LINE_CALLOUTS_HUD_DEPTH,Mn.C.MATERIAL)||e.requiresSlot(On.r.HUD_MATERIAL,Mn.C.MATERIAL)||e.requiresSlot(On.r.LABEL_MATERIAL,Mn.C.MATERIAL))),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach((t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations)),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,i){this._bindParameters.lighting.groundLightingFactor=t,this._bindParameters.lighting.globalFactor=i,this._bindParameters.lighting.set(e)}render(e,t,i,r){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=Bg.Am.NONE;const s=this._offscreenRendering;s.needLastFrameColorTexture=this.hasWaterReflection,s.advanceCurrentRenderTarget();const n=(0,be.c)(this._sliceHelper.plane);r===Bg.Iq.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._ensureCameraBindParameters(t,i),this._renderPlugins.prepareRender(),this.performanceInfo.advance(gS.Prepare);const o=this._computeDepthRange(t);this._renderShadowMap(e,t,this._bindParameters.lighting.lightingMainDirection,o),this.performanceInfo.advance(gS.Shadowmap),s.initializeFrame(t),this._ensureBindParameters(t,i),this._renderLinearDepth(),this.performanceInfo.advance(gS.Lineardepth),this._accumulateShadows(o,t,i),this._renderNormal(),this.performanceInfo.advance(gS.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,s.linearDepthTexture,s.normalTexture),this.performanceInfo.advance(gS.SSAO),this._renderContext.pass=Mn.C.MATERIAL,s.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(gS.Opaque);const a=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(a),this._setMultipassEnabled(a),this._setTerrainCulling(a),this._renderEdges(FT.i.OPAQUE),this.performanceInfo.advance(gS.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(On.r.VOXEL),this._renderHiddenTransparentEdges();const l=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;l&&(this._oitEnabled?this._renderOrderIndependentTransparency((()=>this._renderTransparentGeometry()),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(gS.Transparent),this._renderGeometryLinearDepth(a);const c=this._renderHUDVisibility();a||this._renderInternalSlot(On.r.LINE_CALLOUTS),this.performanceInfo.advance(gS.Hudvisibility),this._renderEdges(FT.i.TRANSPARENT,a),this.performanceInfo.advance(gS.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&c&&(a?this._renderLineCallouts(IC.v.Occluded):s.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(IC.v.Occluded,s.framebuffer),this.performanceInfo.advance(gS.HudOccluded)),this.performanceInfo.advance(gS.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(s.compositeTransparentTerrainOntoMain(this._bindParameters),a&&(this._renderEdges(FT.i.OPAQUE),this.performanceInfo.advance(gS.OpaqueEdges),l&&(this._oitEnabled?this._renderOrderIndependentTransparency((()=>this._renderTransparentGeometry()),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(gS.Transparent),this._renderEdges(FT.i.TRANSPARENT),this.performanceInfo.advance(gS.TransparentEdges))),a&&this._renderLineCallouts(IC.v.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.renderToTargets((()=>{this._renderInternalSlot(On.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(On.r.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(On.r.LASERLINES)}),s.currentColorTarget,s.mainDepth),this.performanceInfo.advance(gS.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain((()=>this._renderSlot(On.r.LASERLINES_CONTRAST_CONTROL)),this._bindParameters,tC.Fv.PremultipliedAlpha),this.performanceInfo.advance(gS.Laserline),this._renderOccluded(),this.performanceInfo.advance(gS.Occluded);const u=r===Bg.Iq.ON&&this._magnifierHelper.enabled,h=u&&(0,I.Wi)(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(h);const d=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,d)&&(0,I.pC)(d)&&this._compositingHelper.composite(this._bindParameters,d,tC.Fv.None),this.performanceInfo.advance(gS.Antialiasing),this._renderHUD(IC.v.NotOccluded,h),this.performanceInfo.advance(gS.HudNotoccluded),this._renderHighlights(h,this._bindParameters),this.performanceInfo.advance(gS.Highlights),u&&this._magnifierHelper.render(this._rctx,this._bindParameters),h!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,tC.Fv.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=(0,Ys.HA)(0)),e===Bg.Xx.BACKGROUND){this._rctx.gl.getError();const e=this.performanceInfo.elapsedTime/.5;this._animationTimestep=(0,Ys.HA)(Math.max(.9*this._animationTimestep+e*(1-.9),TC))}}readDepthPixels(e,t,i){const r=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const t=Er.lk.COLOR_BUFFER_BIT|Er.lk.DEPTH_BUFFER_BIT|Er.lk.STENCIL_BUFFER_BIT;this._rctx.clearSafe(t),this._renderGeometryAndTransparentTerrainPass(Mn.C.MATERIAL_DEPTH)}r.readPixels(t[0],t[1],t[2],t[3],Er.VI.RGBA,Er.Br.UNSIGNED_BYTE,i)}readHUDVisibility(e,t,i,r,s){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,i,r,Er.VI.RGBA,Er.Br.UNSIGNED_BYTE,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const i=this._edgeView;(0,I.pC)(i)&&i.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain((()=>i.render(this._bindParameters,e)),this._bindParameters,tC.Fv.Alpha,t)}_renderShadowMap(e,t,i,r){const s=this._shadowMap;s.enabled&&(s.start(t,i,r),this._shadowHighlight.updateParameters(t,i),this.needsShadowHighlight?(this._renderShadowCascades(Mn.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,(e=>s.takeCascadeSnapshotTo(e,aT.i.Highlight))),s.clear(),this._renderShadowCascades(Mn.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,(e=>{s.takeCascadeSnapshotTo(e,aT.i.Default),this._renderGeometryAndTransparentTerrainPass(Mn.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)}))):this._renderShadowCascades(Mn.C.MATERIAL_DEPTH_SHADOWMAP_ALL),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,i=(e=>{})){for(const r of t.getCascades())r.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets((()=>this._renderGeometryAndTransparentTerrainPass(Mn.C.MATERIAL_DEPTH)),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const e=this._renderContext.pass;this._renderContext.pass=Mn.C.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets((()=>this._renderTransparentTerrain()),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=e}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const e=this._renderContext.pass;this._offscreenRendering.renderToTargets((()=>this._renderGeometryPass(Mn.C.MATERIAL_DEPTH)),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=e}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets((()=>{this._renderGeometryAndTransparentTerrainPass(Mn.C.MATERIAL_NORMAL)}),this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return qw;const t=function(e,t,i){if(t.size<1e4)return mC.compute(e,t);const r=jw();return i.forAll((t=>{t.isVisible&&Ww(r,function(e,t){if(!t.isVisible)return;const i=jw(),r=t.getSpatialQueryAccelerator();return(0,I.pC)(r)?function(e,t,i){const r=t.eye,s=t.viewForward,n=t.frustum,o=e=>e.isVisible,a=i.objectCount;if(a<500)Gw(pC,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,nC.Z.DepthOrder.FRONT_TO_BACK,pC,((i,r)=>{aC(e,t,i),pC.far=e.near,r.setRange(pC)}),n,o),Gw(pC,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,nC.Z.DepthOrder.BACK_TO_FRONT,pC,((i,r)=>{aC(e,t,i),pC.near=e.far,r.setRange(pC)}),n,o);else{const r=Math.max(Math.min(a,500),Math.ceil(.1*a)),l=i.findClosest(s,nC.Z.DepthOrder.FRONT_TO_BACK,n,o,r),c=i.findClosest(s,nC.Z.DepthOrder.BACK_TO_FRONT,n,o,r);l&&c&&(cC(e,t,l.boundingVolumeWorldSpace.bounds),cC(e,t,c.boundingVolumeWorldSpace.bounds))}}(i,e,r):function(e,t,i){fC.clear(),i.forAll((e=>{e.isVisible&&0!==e.geometryRecords.length&&fC.add(e)})),fC.empty||(fC.sort(t),Gw(pC,t.near,Math.min(e.near,t.far)),fC.forEachInDepthRange(pC,nC.Z.DepthOrder.FRONT_TO_BACK,((i,r)=>{r<e.near&&aC(e,t,i)})),Gw(pC,Math.max(e.far,t.near),t.far),fC.forEachInDepthRange(pC,nC.Z.DepthOrder.BACK_TO_FRONT,((t,i,r)=>{e.far=Math.max(e.far,r)})))}(i,e,t.objects),i}(e,t))})),r}(e,this._content,this._stage.layers);return Ww(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(On.r.INTEGRATED_MESH),this._renderSlot(On.r.OPAQUE_TERRAIN),this._renderInternalSlot(On.r.OPAQUE_MATERIAL),this._renderSlot(On.r.OPAQUE_MATERIAL),this._renderSlot(On.r.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(On.r.TRANSPARENT_MATERIAL),this._renderSlot(On.r.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(On.r.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility((()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(On.r.OCCLUSION_PIXELS)}),this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===IC.v.Occluded?this._offscreenRendering.renderToTargets((()=>this._renderInternalSlot(On.r.LINE_CALLOUTS)),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(On.r.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency((()=>this._renderHUDElements(e)),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,tC.Fv.PremultipliedAlpha)):e===IC.v.Occluded?this._offscreenRendering.renderToTargets((()=>this._renderHUDElements(IC.v.Occluded)),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(On.r.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(On.r.HUD_MATERIAL),this._renderInternalSlot(On.r.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const i=this._highlight,r=this._offscreenRendering.renderToTargets((()=>{this._renderGeometryAndTransparentTerrainPass(Mn.C.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(Er.lk.DEPTH_BUFFER_BIT),this._renderHUDElements(IC.v.Both)}),this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(t,e),i.render(this._bindParameters,r,e)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,i){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,i)}_renderOrderIndependentTransparency(e,t){const i=i=>{this._bindParameters.transparencyPassType=i,this._offscreenRendering.renderOITPass((()=>e()),i,t)},r=this._renderContext.pass;this._renderContext.pass=Mn.C.MATERIAL_ALPHA,i(Bg.Am.Alpha),this._renderContext.pass=Mn.C.MATERIAL,i(Bg.Am.Color),i(Bg.Am.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=Bg.Am.NONE,this._renderContext.pass=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach(((t,i)=>{i&&i.isVisible()&&i.renderOccluded===Vb.yD.OccludeAndTransparentStencil&&(e|=i.renderOccluded,CS.push(i))}));const t=this._offscreenRendering,i=(i,r,s,n,o)=>{0!=(e&r)&&(t.renderToTargets(s,t.tmpColor,t.mainDepth,[0,0,0,0],n,o),t.compositeOccludedOntoMain(this._bindParameters,i))};0!==CS.length&&(this._renderInternalSlot(On.r.OCCLUDER_MATERIAL,CS),i(.5,Vb.yD.OccludeAndTransparentStencil,(()=>this._renderInternalSlot(On.r.TRANSPARENT_OCCLUDER_MATERIAL,CS)),!1,!1),CS.length=0),this._materialRenderers.forEach(((t,i)=>{i&&i.isVisible()&&(i.renderOccluded===Vb.yD.OccludeAndTransparent||i.renderOccluded===Vb.yD.Transparent||i.renderOccluded===Vb.yD.Opaque)&&(e|=i.renderOccluded,xS.push(i))}));const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const s=e=>{this._renderContext.renderOccludedMask=e,r>Vb.yD.Occlude&&this._renderSlot(On.r.OCCLUDED_TERRAIN),this._renderInternalSlot(On.r.OPAQUE_MATERIAL,xS),this._renderInternalSlot(On.r.TRANSPARENT_MATERIAL,xS),this._renderInternalSlot(On.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,xS),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=Mn.C.MATERIAL,i(.5,Vb.yD.OccludeAndTransparent,(()=>s(Vb.yD.OccludeAndTransparent)),!0,Bg.hU.OutlineVisualElementMask),i(.5,Vb.yD.Transparent,(()=>s(Vb.yD.Transparent)),!0,Bg.hU.OutlineVisualElementMask),i(1,Vb.yD.Opaque,(()=>s(Vb.yD.Opaque)),!0,Bg.hU.OutlineVisualElementMask),xS.length=0}_renderAntiAliasing(e,t){if(e===Bg.C_.SMAA){if(this._smaaPass.enable((()=>this._requestRender()))&&(0,I.pC)(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){this._ensureCameraBindParameters(e,t);const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=i.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=kr.I:((0,Fr.a)(SS,this._bindParameters.camera.viewMatrix),(0,Fr.a)(TS,this._bindParameters.camera.projectionMatrix),(0,Fr.m)(ES,SS,TS),(0,Fr.m)(ES,this._renderContext.lastFrameCamera.viewMatrix,ES),(0,Fr.m)(ES,this._renderContext.lastFrameCamera.projectionMatrix,ES),this._reprojectionMatrix=ES),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let i=!1;return this._bindParameters.slot=e,(0,I.pC)(t)?t.forEach((e=>{if(!e.shouldRender(this._renderContext))return;const t=this._materialRenderers.get(e);(0,I.pC)(t)&&(i=t.render(this._renderContext.pass,this._bindParameters)||i)})):this._materialRenderers.forEach(((e,t)=>{t.shouldRender(this._renderContext)&&e.render(this._renderContext.pass,this._bindParameters)&&(i=!0)})),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=(0,Lr.hf)(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){return{offscreen:this._offscreenRendering?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{switch(t){case wS.Color:return e._offscreenRendering.colorTexture;case wS.LinearDepth:return e._offscreenRendering.linearDepthTexture;case wS.Normals:return e._offscreenRendering.normalTexture;case wS.ShadowMap:return e._shadowMap.depthTexture;case wS.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case wS.Highlight:return e._offscreenRendering.highlightTexture}}}}};var wS;(0,t._)([(0,m.Cb)()],bS.prototype,"_shadowAccumulator",void 0),(0,t._)([(0,m.Cb)()],bS.prototype,"_smaaPass",void 0),(0,t._)([(0,m.Cb)()],bS.prototype,"_antialiasing",void 0),(0,t._)([(0,m.Cb)()],bS.prototype,"_edgeView",void 0),(0,t._)([(0,m.Cb)()],bS.prototype,"updating",null),(0,t._)([(0,m.Cb)()],bS.prototype,"isCameraFinal",null),bS=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.lib.Renderer")],bS),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(wS||(wS={}));const xS=[],CS=[],TS=(0,kr.c)(),SS=(0,kr.c)(),ES=(0,kr.c)();var AS=s(6174);class MS{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Er.zi.ONE,dstRGB:Er.zi.ZERO,srcAlpha:Er.zi.ONE,dstAlpha:Er.zi.ZERO},this.blendEquation={mode:Er.db.ADD,modeAlpha:Er.db.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Er.LR.BACK,this.frontFace=Er.Wf.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Er.wb.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Er.LR.FRONT_AND_BACK,func:Er.wb.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Er.LR.FRONT_AND_BACK,fail:Er.xS.KEEP,zFail:Er.xS.KEEP,zPass:Er.xS.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class OS{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,(new Error).stack)}remove(e){this._allocations.delete(e)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const e=new Map;this._allocations.forEach((t=>{e.set(t,(e.get(t)??0)+1)})),e.forEach(((e,t)=>{const i=t.split("\n");i.shift(),i.shift(),console.log(`${e}: ${i.shift()}`),i.forEach((e=>console.log("   ",e)))}))}}}class RS{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new OS(false);this._current.length<Er._g.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,t){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(t)}decrement(e,t){--this._current[e],this._allocations.remove(t)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce(((e,t)=>e+t),0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let e=0;e<Er._g.COUNT;++e){const t=this._current[e];t>0&&console.log(`${Er._g[e]}: ${t}`)}}this._allocations.print()}}var PS=s(22445),IS=s(69609);class LS{constructor(e){this._rctx=e,this._store=new PS.r}dispose(){this._store.forEach((e=>e.forEach((e=>e.dispose())))),this._store.clear()}acquire(e,t,i,r){const s=this._store.get(e,t);if((0,I.pC)(s))return s.ref(),s;const n=new IS.$(this._rctx,e,t,i,r);return n.ref(),this._store.set(e,t,n),n}get test(){let e=0;return this._store.forEach((t=>t.forEach((t=>e+=t.hasGLName?2:1)))),{cachedWebGLObjects:e}}}var DS=s(30560),NS=s(41163);function FS(e,t){const i=new vs.X(e,{colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.NONE},{target:Er.No.TEXTURE_2D,wrapMode:Er.e8.CLAMP_TO_EDGE,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,samplingMode:Er.cw.NEAREST,width:1,height:1}),r=Bs.f.createVertex(e,Er.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Gs.U(e,new Map([["position",0]]),{geometry:[new NS.G("position",2,Er.g.UNSIGNED_SHORT,0,4)]},{geometry:r}),n=(0,me.f)(5633261.287538229,2626832.878767164,1434988.0495278358),o=(0,me.f)(5633271.46742708,2626873.6381334523,1434963.231608387),a=function(i,r){const s=`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,n=e.programCache.acquire(s,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]])),o=new Float32Array(6);(0,DS.LF)(i,o,3);const a=new Float32Array(6);return(0,DS.LF)(r,a,3),e.useProgram(n),n.setUniform3f("u_highA",o[0],o[2],o[4]),n.setUniform3f("u_lowA",o[1],o[3],o[5]),n.setUniform3f("u_highB",a[0],a[2],a[4]),n.setUniform3f("u_lowB",a[1],a[3],a[5]),n}(n,o),l=e.getBoundFramebufferObject(),{x:c,y:u,width:h,height:d}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(s),e.drawArrays(Er.MX.TRIANGLE_STRIP,0,4);const p=new Uint8Array(4);i.readPixels(0,0,1,1,Er.VI.RGBA,Er.Br.UNSIGNED_BYTE,p),a.dispose(),s.dispose(!1),r.dispose(),i.dispose(),e.setViewport(c,u,h,d),e.bindFramebuffer(l);const f=(n[2]-o[2])/25,m=(0,sC.v)(p);return Math.abs(f-m)}var kS,US,VS,zS={exports:{}};kS=zS,US=function(){var e={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},t=null,i=null;function r(e){if(null==t)for(var r in t={},i={},e)"number"==typeof e[r]&&(t[e[r]]=r,i[r]=e[r])}function s(){if(null==t)throw"WebGLDebugUtils.init(ctx) not called"}function n(e){s();var i=t[e];return void 0!==i?"gl."+i:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function o(t,r,s,o){var a;if(void 0!==(a=e[t])&&void 0!==(a=a[r])&&a[s]){if("object"==typeof a[s]&&void 0!==a[s].enumBitwiseOr){for(var l=a[s].enumBitwiseOr,c=0,u=[],h=0;h<l.length;++h){var d=i[l[h]];0!=(o&d)&&(c|=d,u.push(n(d)))}return c===o?u.join(" | "):n(o)}return n(o)}return null===o?"null":void 0===o?"undefined":o.toString()}function a(e,t,i){e.__defineGetter__(i,(function(){return t[i]})),e.__defineSetter__(i,(function(e){t[i]=e}))}function l(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);for(var r=0;r<t;++r)e.disableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(r,0);e.deleteBuffer(i);var s=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(r=0;r<s;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}return{init:r,mightBeEnum:function(e){return s(),void 0!==t[e]},glEnumToString:n,glFunctionArgToString:o,glFunctionArgsToString:function(e,t){for(var i="",r=t.length,s=0;s<r;++s)i+=(0==s?"":", ")+o(e,r,s,t[s]);return i},makeDebugContext:function e(t,i,s,l){l=l||t,r(t),i=i||function(e,t,i){for(var r="",s=i.length,a=0;a<s;++a)r+=(0==a?"":", ")+o(t,s,a,i[a]);!function(e){window.console&&window.console.error?window.console.error(e):function(e){window.console&&window.console.log&&window.console.log(e)}(e)}("WebGL error "+n(e)+" in "+t+"("+r+")")};var c={};function u(e,t){return function(){s&&s(t,arguments);var r=e[t].apply(e,arguments),n=l.getError();return 0!=n&&(c[n]=!0,i(n,t,arguments)),r}}var h={};for(var d in t)if("function"==typeof t[d])if("getExtension"!=d)h[d]=u(t,d);else{var p=u(t,d);h[d]=function(){return e(p.apply(t,arguments),i,s,l)}}else a(h,t,d);return h.getError=function(){for(var e in c)if(c.hasOwnProperty(e)&&c[e])return c[e]=!1,e;return t.NO_ERROR},h},makeLostContextSimulatingCanvas:function(e){var t,i,r=[],s=[],n={},o=1,c=!1,u=[],h=0,d=0,p=!1,f=0,m={};function g(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}e.getContext=(i=e.getContext,function(){var r=i.apply(e,arguments);if(r instanceof WebGLRenderingContext){if(r!=t){if(t)throw"got different context";n=x(t=r)}return n}return r});var y=function(e){r.push(g(e))},_=function(e){s.push(g(e))};function v(){++d,c||h==d&&e.loseContext()}function b(e,t){var i=e[t];return function(){if(v(),!c)return i.apply(e,arguments)}}function w(e){return{statusMessage:e,preventDefault:function(){p=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(i,r,s){switch(i){case"webglcontextlost":y(r);break;case"webglcontextrestored":_(r);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!c){for(c=!0,h=0,++o;t.getError(););(function(){for(var e=Object.keys(m),t=0;t<e.length;++t)delete m[e]})(),m[t.CONTEXT_LOST_WEBGL]=!0;var i=w("context lost"),s=r.slice();setTimeout((function(){for(var t=0;t<s.length;++t)s[t](i);f>=0&&setTimeout((function(){e.restoreContext()}),f)}),0)}},e.restoreContext=function(){c&&s.length&&setTimeout((function(){if(!p)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<u.length;++e){var i=u[e];i instanceof WebGLBuffer?t.deleteBuffer(i):i instanceof WebGLFramebuffer?t.deleteFramebuffer(i):i instanceof WebGLProgram?t.deleteProgram(i):i instanceof WebGLRenderbuffer?t.deleteRenderbuffer(i):i instanceof WebGLShader?t.deleteShader(i):i instanceof WebGLTexture&&t.deleteTexture(i)}})(),l(t),c=!1,d=0,p=!1;for(var e=s.slice(),i=w("context restored"),r=0;r<e.length;++r)e[r](i)}),0)},e.loseContextInNCalls=function(e){if(c)throw"You can not ask a lost contet to be lost";h=d+e},e.getNumCalls=function(){return d},e.setRestoreTimeout=function(e){f=e},e;function x(e){for(var i in e)"function"==typeof e[i]?n[i]=b(e,i):a(n,e,i);n.getError=function(){if(v(),!c)for(;e=t.getError();)m[e]=!0;for(var e in m)if(m[e])return delete m[e],e;return n.NO_ERROR};for(var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],s=0;s<r.length;++s){var l=r[s];n[l]=function(t){return function(){if(v(),c)return null;var i=t.apply(e,arguments);return i.__webglDebugContextLostId__=o,u.push(i),i}}(e[l])}var h=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(s=0;s<h.length;++s)n[l=h[s]]=function(t){return function(){return v(),c?null:t.apply(e,arguments)}}(n[l]);var d=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(s=0;s<d.length;++s)n[l=d[s]]=function(t){return function(){return v(),!c&&t.apply(e,arguments)}}(n[l]);return n.checkFramebufferStatus=function(t){return function(){return v(),c?n.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(n.checkFramebufferStatus),n.getAttribLocation=function(t){return function(){return v(),c?-1:t.apply(e,arguments)}}(n.getAttribLocation),n.getVertexAttribOffset=function(t){return function(){return v(),c?0:t.apply(e,arguments)}}(n.getVertexAttribOffset),n.isContextLost=function(){return c},n}},resetToInitialState:l}},void 0!==(VS=US())&&(kS.exports=VS);const BS=p.Z.getLogger("esri.views.WebGLDriverTest");var HS=s(27894);class jS{constructor(e){this.context=e,this._floatBufferBlendWorking=function(e){if(!e.gl)return!1;if(e.type===ZC.zO.WEBGL1)return!(!e.capabilities.textureFloat?.textureFloat||!e.capabilities.colorBufferFloat?.textureFloat);if(!(e.capabilities.textureFloat?.textureFloat&&e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return!1;const t=new vs.X(e,{colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.NONE},{target:Er.No.TEXTURE_2D,wrapMode:Er.e8.CLAMP_TO_EDGE,pixelFormat:Er.VI.RGBA,dataType:Er.Br.FLOAT,internalFormat:Er.lP.RGBA32F,samplingMode:Er.cw.NEAREST,width:1,height:1}),i=Bs.f.createVertex(e,Er.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new Gs.U(e,new Map([["a_pos",0]]),{geometry:[new NS.G("a_pos",2,Er.g.UNSIGNED_SHORT,0,4)]},{geometry:i}),s=e.programCache.acquire("\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));e.useProgram(s);const n=e.getBoundFramebufferObject(),{x:o,y:a,width:l,height:c}=e.getViewport();e.bindFramebuffer(t),e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays(Er.MX.TRIANGLE_STRIP,0,4);const u=(0,Ar.sm)({blending:vx.IB});e.setPipelineState(u),e.drawArrays(Er.MX.TRIANGLE_STRIP,0,4),zS.exports.init(e);const h=e.gl.getError();return e.setViewport(o,a,l,c),e.bindFramebuffer(n),s.dispose(),r.dispose(!1),i.dispose(),t.dispose(),1282!==h||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}(e),async function(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const i=new vs.X(e,{colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.NONE},{target:Er.No.TEXTURE_2D,wrapMode:Er.e8.CLAMP_TO_EDGE,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,samplingMode:Er.cw.NEAREST,width:1,height:1}),r=Bs.f.createVertex(e,Er.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Gs.U(e,new Map([["a_pos",0]]),HS.cD,{geometry:r}),n=e.programCache.acquire("\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));e.useProgram(n);const o=new Hs.x(e,{dataType:Er.Br.UNSIGNED_BYTE,pixelFormat:Er.VI.RGBA,preMultiplyAlpha:!1,wrapMode:Er.e8.CLAMP_TO_EDGE,samplingMode:Er.cw.LINEAR},t);e.bindTexture(o,0),n.setUniform1i("u_texture",0);const a=e.getBoundFramebufferObject(),{x:l,y:c,width:u,height:h}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(Er.lk.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays(Er.MX.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);return i.readPixels(0,0,1,1,Er.VI.RGBA,Er.Br.UNSIGNED_BYTE,d),n.dispose(),s.dispose(!1),r.dispose(),i.dispose(),o.dispose(),e.setViewport(l,c,u,h),e.bindFramebuffer(a),t.src="",255===d[0]}(e).then((e=>this._svgAlwaysPremultipliesAlpha=!e))}get floatBufferBlendWorking(){if((0,I.Wi)(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if((0,I.Wi)(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if((0,I.Wi)(this._doublePrecisionRequiresObfuscation)){const e=FS(this.context,!1),t=FS(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return(0,I.Wi)(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=function(e){const t=new vs.X(e,{colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.NONE},{target:Er.No.TEXTURE_2D,wrapMode:Er.e8.CLAMP_TO_EDGE,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,samplingMode:Er.cw.NEAREST,width:1,height:1}),i=new Uint8Array(4),r=Bs.f.createVertex(e,Er.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Gs.U(e,new Map([["a_position",0]]),{geometry:[new NS.G("a_position",2,Er.g.SHORT,0,4)]},{geometry:r}),n=e.programCache.acquire("\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset = pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value = texture2D(u_texture, vec2(0.0));\n  float bit = getBit(value.x * 255.0, 1);\n\n  v_color = bit * vec4(1.0);\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n","\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",new Map([["a_pos",0]]));e.useProgram(n);const o=new Hs.x(e,{target:Er.No.TEXTURE_2D,wrapMode:Er.e8.CLAMP_TO_EDGE,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,samplingMode:Er.cw.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));n.setUniform1i("u_texture",0),e.bindTexture(o,0);const a=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(n);const{x:l,y:c,width:u,height:h}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(s),e.drawArrays(Er.MX.TRIANGLE_STRIP,0,4),e.setViewport(l,c,u,h),t.readPixels(0,0,1,1,Er.VI.RGBA,Er.Br.UNSIGNED_BYTE,i),n.dispose(),s.dispose(!1),r.dispose(),t.dispose();const d=255!==i[0]||255!==i[1]||255!==i[2]||255!==i[3];return d&&BS.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${i[0]}.${i[1]}.${i[2]}.${i[3]}]`),e.bindFramebuffer(a),d}(this.context)),this._ignoresSamplerPrecision}}var GS=s(79193);class WS{constructor(e,t,i,r,s,n,o,a){this.createQuery=e,this.resultAvailable=t,this.getResult=i,this.disjoint=r,this.beginTimeElapsed=s,this.endTimeElapsed=n,this.createTimestamp=o,this.timestampBits=a}}function ZS(e,t,i,r,s){if(r&&(0,GS.Z)(e))return!0;if(t[i])return!1;for(const t of s)if(e.getExtension(t))return!0;return!1}class qS{constructor(e,t){this.gl=e,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=t.disabledExtensions||{},this._debugWebGLExtensions=t.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=function(e,t){if(t.disjointTimerQuery)return null;if((0,GS.Z)(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=function(e){if((0,GS.Z)(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=function(e,t){if((0,GS.Z)(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=function(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=function(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=function(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=function(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&(0,GS.Z)(e)?new WS((()=>e.createQuery()),(t=>e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)),(t=>e.getQueryParameter(t,e.QUERY_RESULT)),(()=>e.getParameter(i.GPU_DISJOINT_EXT)),(t=>e.beginQuery(i.TIME_ELAPSED_EXT,t)),(()=>e.endQuery(i.TIME_ELAPSED_EXT)),(e=>i.queryCounterEXT(e,i.TIMESTAMP_EXT)),(()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):(i=e.getExtension("EXT_disjoint_timer_query"),i?new WS((()=>i.createQueryEXT()),(e=>i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT)),(e=>i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)),(()=>e.getParameter(i.GPU_DISJOINT_EXT)),(e=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,e)),(()=>i.endQueryEXT(i.TIME_ELAPSED_EXT)),(e=>i.queryCounterEXT(e,i.TIMESTAMP_EXT)),(()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):null)}(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=function(e,t){if((0,GS.Z)(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=function(e,t){if((0,GS.Z)(e)){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=function(e,t){if((0,GS.Z)(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const t=e.getExtension("EXT_blend_minmax");return t?{MIN:t.MIN_EXT,MAX:t.MAX_EXT}:null}}(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return null===this._depthTexture&&(this._depthTexture=ZS(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return null===this._standardDerivatives&&(this._standardDerivatives=ZS(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return null===this._shaderTextureLOD&&(this._shaderTextureLOD=ZS(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return null===this._fragDepth&&(this._fragDepth=ZS(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=function(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=function(e,t){if(!(0,GS.Z)(e))return null;if(t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}(this.gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return null===this._textureFloatLinear&&(this._textureFloatLinear=ZS(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}}class $S{constructor(e,t){this.gl=e,this.instanceCounter=new RS,this.programCache=new LS(this),this._state=new MS,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=(0,GS.Z)(e)?ZC.zO.WEBGL2:ZC.zO.WEBGL1,this._loadExtensions(),this.configure(t)}configure(e){this._capabilities=new qS(this.gl,e),this._parameters=this._loadParameters(e);const t=this.gl.getParameter(this.gl.VIEWPORT);this._state=new MS,this._state.viewport={x:t[0],y:t[1],width:t[2],height:t[3]},this._stateTracker=new Ar.jp({setBlending:e=>{if(e){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(e.opRgb,e.opAlpha),this.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);const t=e.color;this.setBlendColor(t.r,t.g,t.b,t.a)}else this.setBlendingEnabled(!1)},setCulling:e=>{e?(this.setFaceCullingEnabled(!0),this.setCullFace(e.face),this.setFrontFace(e.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:e=>{e?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(e.factor,e.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:e=>{e?(this.setDepthTestEnabled(!0),this.setDepthFunction(e.func)):this.setDepthTestEnabled(!1)},setStencilTest:e=>{if(e){this.setStencilTestEnabled(!0);const t=e.function;this.setStencilFunction(t.func,t.ref,t.mask);const i=e.operation;this.setStencilOp(i.fail,i.zFail,i.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:e=>{e?(this.setDepthWriteEnabled(!0),this.setDepthRange(e.zNear,e.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:e=>{e?this.setColorMask(e.r,e.g,e.b,e.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:e=>{e?this.setStencilWriteMask(e.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new jS(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Er.w0.ARRAY_BUFFER),this.unbindBuffer(Er.w0.ELEMENT_ARRAY_BUFFER),(0,GS.Z)(this.gl)&&(this.unbindBuffer(Er.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Er.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(Er.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Er.w0.COPY_READ_BUFFER),this.unbindBuffer(Er.w0.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,(0,AS.hZ)()&&this.instanceCounter.printResourceCount()}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,t){for(let t=0;t<e.length;++t)this._state.textureUnitMap[e[t]]=null;t>=0&&(this._state.activeTexture=t)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,t,i,r){e===this._state.blendColor.r&&t===this._state.blendColor.g&&i===this._state.blendColor.b&&r===this._state.blendColor.a||(this.gl.blendColor(e,t,i,r),this._state.blendColor.r=e,this._state.blendColor.g=t,this._state.blendColor.b=i,this._state.blendColor.a=r,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._state.blendFunction.srcRGB&&t===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,t),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,i,r){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===t&&this._state.blendFunction.dstAlpha===r||(this.gl.blendFuncSeparate(e,t,i,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,i,r){this._state.colorMask.r===e&&this._state.colorMask.g===t&&this._state.colorMask.b===i&&this._state.colorMask.a===r||(this.gl.colorMask(e,t,i,r),this._state.colorMask.r=e,this._state.colorMask.g=t,this._state.colorMask.b=i,this._state.colorMask.a=r,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,i,r){this._state.clearColor.r===e&&this._state.clearColor.g===t&&this._state.clearColor.b===i&&this._state.clearColor.a===r||(this.gl.clearColor(e,t,i,r),this._state.clearColor.r=e,this._state.clearColor.g=t,this._state.clearColor.b=i,this._state.clearColor.a=r)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===t||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,t,i,r){this._state.scissorRect.x===e&&this._state.scissorRect.y===t&&this._state.scissorRect.width===i&&this._state.scissorRect.height===r||(this.gl.scissor(e,t,i,r),this._state.scissorRect.x=e,this._state.scissorRect.y=t,this._state.scissorRect.width=i,this._state.scissorRect.height=r)}setDepthTestEnabled(e){this._state.depthTest!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===t||(this.gl.depthRange(e,t),this._state.depthRange.zNear=e,this._state.depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,t,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===t&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,t,i),this._state.stencilFunction.face=Er.LR.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,i,r){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFuncSeparate(e,t,i,r),this._state.stencilFunction.face=e,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,i){this._state.stencilOperation.face===Er.LR.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===t&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,t,i),this._state.stencilOperation.face=Er.LR.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,i,r){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOpSeparate(e,t,i,r),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,t=!1){const i=this._state.activeTexture;return e>=0&&(t||e!==this._state.activeTexture)&&(this.gl.activeTexture(Er.Ld+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,t=255){e&&(e&Er.lk.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Er.lk.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Er.lk.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(t),this.gl.clear(e))}drawArrays(e,t,i){if((0,AS.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=XS(e,i)),this.gl.drawArrays(e,t,i),(0,AS.hZ)()){const e=(0,js.HH)(this);e&&console.error("drawArrays:",e)}}drawElements(e,t,i,r){if((0,AS.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=XS(e,t)),this.gl.drawElements(e,t,i,r),(0,AS.hZ)()){const s=(0,js.HH)(this);if(s){const n=this.getBoundVAO(),o=n?.indexBuffer,a=n?.vertexBuffers,l={indexBuffer:o,vertexBuffers:a},c={mode:e,count:t,type:i,offset:r},u=(0,I.yw)(o,(e=>e.size))??0,h=r+t,d=u<h?`. Buffer is too small. Attempted to draw index ${h} of ${u}`:"";console.error(`drawElements: ${s}${d}`,{args:c,vao:l})}}}logInfo(){(0,AS.hZ)()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){(0,AS.hZ)()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,t,i,r){i=Math.max(Math.round(i),1),r=Math.max(Math.round(r),1);const s=this._state.viewport;s.x===e&&s.y===t&&s.width===i&&s.height===r||(s.x=e,s.y=t,s.width=i,s.height=r,this.gl.viewport(e,t,i,r))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,t,i=!1){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const r=this._state.textureUnitMap[t];return(0,I.Wi)(e)||null==e.glName?((0,I.pC)(r)&&(this.setActiveTexture(t,i),this.gl.bindTexture(r.descriptor.target,null)),this._state.textureUnitMap[t]=null,r):i||r!==e?(this.setActiveTexture(t,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[t]=e,r):(e.isDirty&&(this.setActiveTexture(t,i),e.applyChanges()),r)}unbindTexture(e){if(!(0,I.Wi)(e))for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===e&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}bindFramebuffer(e,t=!1){if(t||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if((0,I.Wi)(e))return this.gl.bindFramebuffer(Er.qi.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(Er.qi.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,t,i=!1){const r=t===Er.qi.READ_FRAMEBUFFER,s=r?this._state.readFramebuffer:this._state.drawFramebuffer;(i||s!==e)&&((0,I.Wi)(e)?this.gl.bindFramebuffer(t,null):e.initializeAndBind(t),r?this._state.readFramebuffer=(0,I.Pt)(e,null):this._state.drawFramebuffer=(0,I.Pt)(e,null))}blitFramebuffer(e,t,i=0,r=0,s=e.width,n=e.height,o=0,a=0,l=t.width,c=t.height,u=Er.lk.COLOR_BUFFER_BIT,h=Er.cw.NEAREST){this.bindFramebufferSeparate(e,Er.qi.READ_FRAMEBUFFER),this.bindFramebufferSeparate(t,Er.qi.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,r,s,n,o,a,l,c,u,h)}bindBuffer(e,t){if(e)switch(t??(t=e.bufferType),t){case Er.w0.ARRAY_BUFFER:this._state.vertexBuffer=YS(this.gl,e,t,this._state.vertexBuffer);break;case Er.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=YS(this.gl,e,t,this._state.indexBuffer);break;case Er.w0.UNIFORM_BUFFER:this._state.uniformBuffer=YS(this.gl,e,t,this._state.uniformBuffer);break;case Er.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=YS(this.gl,e,t,this._state.pixelPackBuffer);break;case Er.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=YS(this.gl,e,t,this._state.pixelUnpackBuffer);break;case Er.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=YS(this.gl,e,t,this._state.copyReadBuffer);break;case Er.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=YS(this.gl,e,t,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,t){if(t>=this.parameters.maxUniformBufferBindings||t<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let r=i[t];return(0,I.Wi)(r)&&(r={buffer:null,offset:0,size:0},i[t]=r),r}bindBufferBase(e,t,i){const r=this._getBufferBinding(e,t);(0,I.Wi)(r)||r.buffer===i&&0===r.offset&&0===r.size||(this.gl.bindBufferBase(e,t,i?i.glName:null),r.buffer=i,r.offset=0,r.size=0)}bindBufferRange(e,t,i,r,s){const n=this._getBufferBinding(e,t);(0,I.Wi)(n)||n.buffer===i&&n.offset===r&&n.size===s||(r%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,t,i.glName,r,s),n.buffer=i,n.offset=r,n.size=s):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"))}bindUBO(e,t,i,r){(0,I.Wi)(t)?this.bindBufferBase(Er.w0.UNIFORM_BUFFER,e,null):((0,AS.hZ)()&&(r??t.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),void 0!==i&&void 0!==r?this.bindBufferRange(Er.w0.UNIFORM_BUFFER,e,t.buffer,i,r):this.bindBufferBase(Er.w0.UNIFORM_BUFFER,e,t.buffer))}unbindUBO(e){for(let t=0,i=this._state.uniformBufferBindingPoints.length;t<i;t++){const i=this._state.uniformBufferBindingPoints[t];(0,I.pC)(i)&&i.buffer===e.buffer&&this.bindBufferBase(Er.w0.UNIFORM_BUFFER,t,null)}}unbindBuffer(e){switch(e){case Er.w0.ARRAY_BUFFER:this._state.vertexBuffer=YS(this.gl,null,e,this._state.vertexBuffer);break;case Er.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=YS(this.gl,null,e,this._state.indexBuffer);break;case Er.w0.UNIFORM_BUFFER:this._state.uniformBuffer=YS(this.gl,null,e,this._state.uniformBuffer);break;case Er.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=YS(this.gl,null,e,this._state.pixelPackBuffer);break;case Er.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=YS(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Er.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=YS(this.gl,null,e,this._state.copyReadBuffer);break;case Er.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=YS(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){(0,I.Wi)(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}async clientWaitAsync(e=(0,Ys.HA)(10)){const t=this.gl,i=t.fenceSync(Er.V7.SYNC_GPU_COMMANDS_COMPLETE,0);let r;this.instanceCounter.increment(Er._g.Sync,i),t.flush();do{await(0,f.e4)(e),r=t.clientWaitSync(i,0,0)}while(r===Er.Y5.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Er._g.Sync,i),t.deleteSync(i),r===Er.Y5.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Er.qi.FRAMEBUFFER){return e===Er.qi.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Er.w0.ARRAY_BUFFER),this.unbindBuffer(Er.w0.ELEMENT_ARRAY_BUFFER),(0,GS.Z)(this.gl)&&(this.unbindBuffer(Er.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Er.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(Er.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Er.w0.COPY_READ_BUFFER),this.unbindBuffer(Er.w0.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Er.zi.ONE,Er.zi.ZERO),this.setBlendEquation(Er.db.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Er.LR.BACK),this.setFrontFace(Er.Wf.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Er.wb.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Er.wb.ALWAYS,0,0),this.setStencilOp(Er.xS.KEEP,Er.xS.KEEP,Er.xS.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.gl,t=this.capabilities.vao;t&&t.bindVertexArray(null);for(let t=0;t<this.parameters.maxVertexAttributes;t++)e.disableVertexAttribArray(t);if(this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(Er.w0.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(Er.w0.ELEMENT_ARRAY_BUFFER,null),(0,GS.Z)(e)){this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(Er.w0.UNIFORM_BUFFER,null);for(let t=0;t<this._parameters.maxUniformBufferBindings;t++){const i=this._state.uniformBufferBindingPoints[t];if((0,I.pC)(i)){const{buffer:r,offset:s,size:n}=i;null!==r?0===s&&0===n?e.bindBufferBase(Er.w0.UNIFORM_BUFFER,t,r.glName):e.bindBufferRange(Er.w0.UNIFORM_BUFFER,t,r.glName,s,n):e.bindBufferBase(Er.w0.UNIFORM_BUFFER,t,null)}}this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(Er.w0.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(Er.w0.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(Er.w0.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(Er.w0.COPY_WRITE_BUFFER,null),e.bindFramebuffer(Er.qi.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(Er.qi.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(Er.VY.COLOR_ATTACHMENT0)),e.bindFramebuffer(Er.qi.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,e.bindFramebuffer(Er.qi.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(t&&this._state.vertexArrayObject){const e=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(e)}e.useProgram(this._state.program?.glName??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),!0===this._state.blend?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),!0===this._state.faceCulling?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let t=0;t<this.parameters.maxTextureImageUnits;t++){e.activeTexture(Er.Ld+t),e.bindTexture(Er.No.TEXTURE_2D,null),e.bindTexture(Er.No.TEXTURE_CUBE_MAP,null),(0,GS.Z)(e)&&(e.bindTexture(Er.No.TEXTURE_3D,null),e.bindTexture(Er.No.TEXTURE_2D_ARRAY,null));const i=this._state.textureUnitMap[t];(0,I.pC)(i)&&e.bindTexture(i.descriptor.target,i.glName)}e.activeTexture(Er.Ld+this._state.activeTexture),e.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===ZC.zO.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(e){const t=this.capabilities.textureFilterAnisotropic,i=e.maxAnisotropy??1/0,r=(0,GS.Z)(this.gl),s=this.gl,n={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:t?Math.min(this.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY),i):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:r?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:r?s.getParameter(s.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:r?s.getParameter(s.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:r?s.getParameter(s.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:r?s.getParameter(s.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:r?s.getParameter(s.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:r?s.getParameter(s.MAX_SAMPLES):1};return Hs.x.TEXTURE_UNIT_FOR_UPDATES=n.maxTextureImageUnits-1,n}}function YS(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function XS(e,t){switch(e){case Er.MX.POINTS:return 2*t;case Er.MX.TRIANGLES:return t/3;case Er.MX.TRIANGLE_STRIP:case Er.MX.TRIANGLE_FAN:return t-2;default:return 0}}class JS extends $S{constructor(e,t,i){super(e,t),this.newCache=i,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(e,t,i,r){this.useProgram(e.program);const s=(0,I.pC)(i)?i.slot:null;return e.bindPipelineState(this,s,r),(0,I.pC)(t)&&(0,I.pC)(i)&&e.bindPass(t,i),e.program}get test(){return this.programCache.test}}var KS=s(22635),QS=s(46240);const eE=p.Z.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let tE=class extends O.Z{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new P.Z,this._frameTask=e.resourceController.scheduler.registerTask(nt.T8.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType($p.U.Texture,(e=>e.unload()))}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return(0,I.Wi)(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(KS.K,new QS.V)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),(0,I.Pt)(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach((t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)})),e&&this.events.emit("changed",Bg.Xx.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if((0,I.Wi)(t))return(0,nn.hu)(void 0!==t),null;const i=t.events.on("unloaded",(()=>{i.remove(),this._onTextureUnloaded(e)})),r=new iE(e,(()=>{this._frameTask.schedule((()=>{r.isUnreferenced&&t.unload()}))}));return this._textures.set(e,r),r.ref(),(0,I.pC)(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule((()=>{const i=t.load(this._rctx,(()=>this.textureTechnique)),s=i=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,i),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r);return(0,f.y8)(i)?i.then(s,(e=>(this._loadingCount--,r.loadingPromise=null,(0,f.D_)(e)||eE.error(e),null))):s(i)})),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",Bg.Xx.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};(0,t._)([(0,m.Cb)()],tE.prototype,"_loadingCount",void 0),(0,t._)([(0,m.Cb)()],tE.prototype,"_frameTask",void 0),(0,t._)([(0,m.Cb)()],tE.prototype,"updating",null),tE=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.lib.TextureRepository")],tE);class iE{constructor(e,t){this.id=e,this._release=t,this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(0!==this._refCount?(eE.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}var rE=s(79503);const sE=p.Z.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let nE=class extends O.Z{constructor(){super(...arguments),this._data=new Array,this._state=Bg.Rw.NOT_LOADED}dispose(){this._state=Bg.Rw.NOT_LOADED,this._data.forEach((e=>e.dispose())),this._data.length=0}get updating(){return this._state===Bg.Rw.LOADING}get resourceState(){return this._state}loadTextures(e){const t=[(0,mn.V)("esri/images/materials/water/normals.jpg"),(0,mn.V)("esri/images/materials/water/perturbation.jpg")];this._state=Bg.Rw.LOADING,Promise.all(t.map((e=>(0,Is.t)(e)))).then((t=>{t.forEach((t=>this._data.push(new Hs.x(e,{target:Er.No.TEXTURE_2D,pixelFormat:Er.VI.RGBA,dataType:Er.Br.UNSIGNED_BYTE,wrapMode:Er.e8.REPEAT,samplingMode:Er.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:t.width,height:t.height},t)))),this._state=Bg.Rw.LOADED})).catch((e=>{sE.error("Failed to load textures for water material.",e),this._state=Bg.Rw.NOT_LOADED}))}bind(e){this._state===Bg.Rw.LOADED&&(e.bindTexture("texWaveNormal",this._data[0]),e.bindTexture("texWavePerturbation",this._data[1]))}};(0,t._)([(0,m.Cb)()],nE.prototype,"_state",void 0),(0,t._)([(0,m.Cb)({type:Boolean,readOnly:!0})],nE.prototype,"updating",null),nE=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],nE);new Map;var oE=s(994);class aE extends gw.Xn{constructor(e,t,i,r,s,n){super(),this._rctx=e,this._renderScene=t,this._requestRenderScene=i,this._renderOverlay=r,this._forceCameraHook=s,this._disposeOffscreenBuffers=n,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(e){this._requestRenderScene(Bg.Xx.BACKGROUND);const t=(0,f.hh)();return this._screenshotQueue.push({settings:e,resolver:t}),t.promise}update(e){for(const t of this._screenshotQueue){if(this.isDisposed){t.resolver.reject();continue}const i={...t.settings,pixelRatio:t.settings.pixelRatio*e.viewCamera.pixelRatio},r=this._renderScreenshot(e,i);t.resolver(r)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,t,i){if((0,I.Wi)(this._renderOverlay))return t;e.width=t.width,e.height=t.height;const r=e.getContext("2d"),s=i.pixelRatio;return r.save(),r.translate(0,t.height),r.scale(1,-1),i.region&&r.translate(-i.region.x,-i.region.y),r.scale(s,s),t=this._renderOverlay(e,t),r.restore(),t}_readbackScreenshot(e,t){return e.resample?this._readbackScreenshotResampled(e,t):this._readbackScreenshotImmediate(e,t)}_readbackScreenshotResampled(e,t){const{framebufferWidth:i,framebufferHeight:r,region:s,resample:n}=e,o=this._ensureScreenshotEncodeCanvas();let a=(0,oE.r7)(i,r,o);this._rctx.gl.readPixels(0,0,i,r,Er.VI.RGBA,Er.g.UNSIGNED_BYTE,new Uint8Array(a.data.buffer)),t(),a=this._renderScreenshotOverlay(o,a,{...e,region:null});const l=(0,oE.r7)(s.width,s.height,o);return(0,oE.TT)(a,l,!0,n.region.x,r-(n.region.y+n.region.height),n.region.width,n.region.height)}_readbackScreenshotImmediate(e,t){const{framebufferHeight:i,region:r}=e,s=this._ensureScreenshotEncodeCanvas(),n=(0,oE.r7)(r.width,r.height,s);return this._rctx.gl.readPixels(r.x,i-(r.y+r.height),r.width,r.height,Er.VI.RGBA,Er.g.UNSIGNED_BYTE,new Uint8Array(n.data.buffer)),t(),this._renderScreenshotOverlay(s,n,e)}_renderScreenshot(e,t){let i=null;const r=e.viewCamera,{framebufferWidth:s,framebufferHeight:n}=t;let o=!1;const a=t.disableDecorations&&e.frameHasDecorations,l=s!==r.fullWidth||n!==r.fullHeight,c=t.ignorePadding&&r.pixelRatio!==t.pixelRatio,u=l||a||c;if(u){const e=r.clone();if(t.ignorePadding){const i=(0,pr.d)(e.padding);for(let r=0;r<4;r++)i[r]=Math.round(i[r]/e.pixelRatio*t.pixelRatio);e.padding=i}e.fullWidth=s,e.fullHeight=n,e.pixelRatio=t.pixelRatio;const a=r.fovX-e.fovX,l=r.fovY-e.fovY;a<0&&a<l?e.fovX=r.fovX:l<0&&l<a&&(e.fovY=r.fovY),this._forceCameraHook(e),o=!0,i=new vs.X(this._rctx,{width:e.fullWidth,height:e.fullHeight,colorTarget:Er.Lm.TEXTURE,depthStencilTarget:Er.OU.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(i,e,t.disableDecorations?Bg.Iq.OFF:Bg.Iq.ON),this._disposeOffscreenBuffers()}const h=()=>{this._rctx.bindFramebuffer(null),(0,I.O3)(i)},d=this._readbackScreenshot(t,h);if(h(),u&&!this._rctx.contextAttributes.alpha)for(let e=3;e<d.data.length;e+=4)d.data[e]=255;return o&&this._forceCameraHook(r),d}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const lE=p.Z.getLogger("esri.views.3d.webgl-engine.parts.View");let cE=class extends((0,gw.TF)(O.Z)){constructor(e){super({}),this.events=new P.Z,this.waterTextureRepository=new nE,this._magnifierHelper=new CC,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),(0,he.YP)((()=>this.waterTextureRepository?.updating),(()=>this.requestRender()),he.nn),this._magnifierHelper.events.on("request-render",(()=>this.requestRender())),this._stippleTextureRepository=new rE.h(this._rctx),this._shaderTechniqueRepository=new Qx.M({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new tE(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",(e=>this.requestRender(e))),this._materialRepository=new yC.h(this._textureRepository,this._shaderTechniqueRepository,(()=>this.requestRender()),(()=>this.requestRender())),this._compositingHelper=new rC(this._rctx,this._shaderTechniqueRepository),this._renderer=new bS(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,(e=>this.requestRender(e)),((t,i)=>e.schedule(t,i)),e),this._screenshotManager=new aE(this._rctx,((e,t,i)=>this._renderer.render(e,t,t,i)),(e=>this.requestRender(e)),e.options.screenshot.renderOverlay,(e=>this.events.emit("force-camera-for-screenshot",e)),(()=>this._renderer.disposeOffscreenBuffers())),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=(0,I.hw)(this._frameTask),this._shaderTechniqueRepository=(0,I.O3)(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==e.getUsedTextureMemory?e.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==e.getUsedRenderbufferMemory?e.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==e.getUsedVBOMemory?e.getUsedVBOMemory():void 0}}requestRender(e=Bg.Xx.UPDATE){e===Bg.Xx.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,i){this._renderer.updateLightSources(e,t,i),this.requestRender()}setRenderParameters(e){void 0!==e.idleSuspend&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,i,r,s){this._renderer.readHUDVisibility(e,t,i,r,s)}getMinimalDepthForArea(e,t,i,r,s,n=s){const o=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),a=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(r,o,a);let l=Number.MAX_VALUE;for(let e=0;e<o[2]*o[3];e++){const t=oC(4*e,a,r.nearFar);l>t&&t!==r.nearFar[0]&&t!==r.nearFar[1]&&(l=t)}if((0,I.pC)(e)){const s=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);(0,I.pC)(s)&&l>s&&s!==r.nearFar[0]&&s!==r.nearFar[1]&&(l=s)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return((0,I.Wi)(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){qy(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,i={viewCamera:t.camera,frameHasDecorations:!1};let r=!1,s=Bg.Xx.BACKGROUND,n=!1;const o={preRender:i=>{r=this.updating,s=this._needsUpdate?Bg.Xx.UPDATE:Bg.Xx.BACKGROUND,e.processSyncLayers();const n=(0,Ys.HA)(i.time-this._lastAnimationUpdate);(n>this.animationTimestep||(0,I.pC)(this.forcedAnimationTime)||r||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:n,forcedTime:this.forcedAnimationTime})&&this.requestRender(Bg.Xx.BACKGROUND),this._lastAnimationUpdate=i.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const e=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,Bg.Iq.ON),n=!0,e&&this._renderer.hasWaterReflection&&(this.requestRender(Bg.Xx.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{i.viewCamera=t.camera,i.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(i)},finish:()=>{n&&(this._renderer.finish(s),n=!1)}};this._frameTask=(0,de.A)(o)}_initializeContext(e){const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==t.stencil||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:t.preserveDrawingBuffer??!1},r=(0,ZC.sj)("3d",this._canvas,i);if((0,I.Wi)(r)){const e=(0,b.Z)("esri-force-webgl");lE.error(e)}else this._rctx=this._newRenderingContext(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&lE.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&(0,b.Z)("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const i={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(e,i)=>t.resourceController.memoryController.newCache(e,i);return new JS(e,i,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return(0,I.Wi)(this._componentObjectCollection)&&(this._componentObjectCollection=new qx(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};(0,t._)([(0,m.Cb)({type:Boolean,readOnly:!0})],cE.prototype,"updating",null),(0,t._)([(0,gw.gT)()],cE.prototype,"_rctx",void 0),(0,t._)([(0,gw.gT)()],cE.prototype,"_container",void 0),(0,t._)([(0,gw.gT)()],cE.prototype,"_canvas",void 0),(0,t._)([(0,gw.gT)()],cE.prototype,"_stippleTextureRepository",void 0),(0,t._)([(0,gw.gT)(),(0,m.Cb)()],cE.prototype,"waterTextureRepository",void 0),(0,t._)([(0,gw.gT)(),(0,m.Cb)()],cE.prototype,"_magnifierHelper",void 0),(0,t._)([(0,gw.gT)(),(0,m.Cb)()],cE.prototype,"_textureRepository",void 0),(0,t._)([(0,gw.gT)()],cE.prototype,"_compositingHelper",void 0),(0,t._)([(0,gw.gT)()],cE.prototype,"_renderer",void 0),(0,t._)([(0,gw.gT)()],cE.prototype,"_screenshotManager",void 0),(0,t._)([(0,gw.gT)()],cE.prototype,"componentObjectCollection",null),(0,t._)([(0,gw.gT)()],cE.prototype,"_componentObjectCollection",void 0),(0,t._)([(0,m.Cb)()],cE.prototype,"_needsUpdate",void 0),(0,t._)([(0,m.Cb)()],cE.prototype,"_needsWaterReflectionUpdate",void 0),cE=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.parts.RenderView")],cE);var uE;let hE=uE=class extends((0,gw.TF)(O.Z)){constructor(e){super(e),this._handles=new Ae.Z,this._model=new Tw,this._layers=new Nd.Z,this._changeSet=new yw.as,this._layerSyncSet=new Set}initialize(){this._set("renderView",new cE(this)),this._frameTask=this.resourceController.scheduler.registerTask(nt.T8.STAGE,this),this._handles.add(this._frameTask)}destroy(){_w.k.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),(0,tf.e)(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){(0,I.Wi)(e)||(this.renderView.requestRender(),this._model.remove(e),(0,tf.e)(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){(0,I.pC)(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){(0,I.pC)(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){(0,I.Wi)(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter((e=>(0,I.Wi)(e.glTexture))).map((e=>this.schedule((()=>this._model.has(e)?e.load(this.renderView.renderingContext,(()=>this.renderView.textureRepository.textureTechnique)):null))))))}loadImmediate(e){return e.load(this.renderView.renderingContext,(()=>this.renderView.textureRepository.textureTechnique))}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;uE.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),uE.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map((e=>e.id))),console.log("RGs remove: "+this._changeSet.removes.map((e=>e.id)))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll((t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===Bg.jq.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))}));for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),null!=this._layers.removeUnordered(e)&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,i){const r=this.renderView.renderPlugins.add(e,t,i),s=()=>{sg(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if((0,f.y8)(r))return r.then(s);s()}removeRenderPlugin(e){sg(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter((e=>e.type===t)).length,model:e._model}}};hE.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},(0,t._)([(0,m.Cb)({constructOnly:!0})],hE.prototype,"resourceController",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],hE.prototype,"options",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],hE.prototype,"state",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],hE.prototype,"sceneIntersectionHelper",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],hE.prototype,"viewingMode",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],hE.prototype,"container",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],hE.prototype,"renderSR",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],hE.prototype,"_handles",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],hE.prototype,"updating",null),(0,t._)([(0,m.Cb)({constructOnly:!0})],hE.prototype,"_model",void 0),(0,t._)([(0,gw.gT)(),(0,m.Cb)()],hE.prototype,"renderView",void 0),hE=uE=(0,t._)([(0,y.j)("esri.views.3d.webgl-engine.Stage")],hE);var dE=s(5865);var pE=s(42780),fE=s(35119);const mE="esri-component";let gE=class extends O.Z{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(mE),t&&t.classList.remove(mE),this._set("node",e))}castNode(e){return e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),(0,oe.L7)(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};(0,t._)([(0,m.Cb)({dependsOn:[]})],gE.prototype,"id",null),(0,t._)([(0,m.Cb)()],gE.prototype,"node",null),(0,t._)([(0,L.p)("node")],gE.prototype,"castNode",null),(0,t._)([(0,m.Cb)({readOnly:!0})],gE.prototype,"widget",void 0),gE=(0,t._)([(0,y.j)("esri.views.ui.Component")],gE);const yE=gE;var _E=s(3368),vE=s(54956);const bE={left:0,top:0,bottom:0,right:0},wE={bottom:30,top:15,right:15,left:15},xE="manual",CE="esri-ui",TE="esri-ui-corner",SE="esri-ui-inner-container";function EE(e){const t=e,i="object"==typeof t&&null!==t&&Object.getPrototypeOf(t);return null!==i&&i!==Object.prototype||!("component"in t||"index"in t||"position"in t)?null:e}function AE(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let ME=class extends P.Z.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new Ae.Z,this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&AE(e,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&AE(e,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([(0,he.YP)((()=>[this.view?.padding,this.container]),this._applyViewPadding,he.nn),(0,he.YP)((()=>this.padding),this._applyUIPadding,he.nn)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(CE),(0,_E.V$)(e),this._attachContainers(e)),t&&(t.classList.remove(CE),AE(t,{top:"",bottom:"",left:"",right:""}),(0,oe.cS)(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(0===e)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:{...wE,...e}}get width(){const e=this.get("view.width")||0;if(0===e)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach((e=>this.add(e,t)));const s=EE(e);s&&({index:i,position:t,component:e,key:r}=s),t&&"object"==typeof t&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map((e=>this.remove(e,t)));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map((e=>this.empty(e))).reduce(((e,t)=>e.concat(t))):(e=e||xE)===xE?Array.prototype.slice.call(this._manualContainer.children).filter((e=>!e.classList.contains(TE))).map((e=>this.remove(e))):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach((e=>this.move(e,t))),!e)return;let i;const r=EE(e)||EE(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof yE||(e=new yE({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof yE?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||bE}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(SE),e.classList.add("esri-ui-corner-container");const t=document.createElement("div");t.classList.add(SE),t.classList.add("esri-ui-manual-container");const i=document.createElement("div");i.classList.add("esri-ui-top-left"),i.classList.add(TE),e.appendChild(i);const r=document.createElement("div");r.classList.add("esri-ui-top-right"),r.classList.add(TE),e.appendChild(r);const s=document.createElement("div");s.classList.add("esri-ui-bottom-left"),s.classList.add(TE),e.appendChild(s);const n=document.createElement("div");n.classList.add("esri-ui-bottom-right"),n.classList.add(TE),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=(0,vE.dZ)();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||xE,r=e.index,s=this._positionNameToContainerLookup[i],n=r>-1;if(function(e){return e&&!e._started&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);0!==r?r>=o.length?s.appendChild(t.node):(0,oe.Vt)(t.node,o[r]):s.firstChild?(0,oe.Vt)(t.node,s.firstChild):s.appendChild(t.node)}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return 0===e?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some((r=>(t=r===e,t&&(i=r),t))),i}_findById(e){let t,i=null;return this._components.some((r=>(t=r.id===e,t&&(i=r),t))),i}_findByNode(e){let t,i=null;return this._components.some((r=>(t=r.node===e,t&&(i=r),t))),i}};(0,t._)([(0,m.Cb)()],ME.prototype,"container",null),(0,t._)([(0,m.Cb)()],ME.prototype,"height",null),(0,t._)([(0,m.Cb)({value:wE})],ME.prototype,"padding",null),(0,t._)([(0,L.p)("padding")],ME.prototype,"castPadding",null),(0,t._)([(0,m.Cb)()],ME.prototype,"view",void 0),(0,t._)([(0,m.Cb)()],ME.prototype,"width",null),ME=(0,t._)([(0,y.j)("esri.views.ui.UI")],ME);const OE=ME;var RE=s(47035);function PE(e,t){return e&&"copyright"in e&&(!t||"function"==typeof e.originOf&&"user"===e.originOf("copyright"))}function IE(e,t,i){i&&t&&(e.find((e=>e.layerView===t&&e.text===i))||e.push({text:i,layerView:t}))}const LE=[];let DE=class extends je.r{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new n.Z,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const t=this.get("view.allLayerViews");t&&this.handles.add(t.map((e=>(0,he.YP)((()=>[e.suspended,e.layer?.attributionVisible]),(()=>this._updateAttributionItems())))),"suspension"),e&&e.removed&&e.removed.forEach((e=>{this._pendingAttributions.delete(e),this._fetchedAttributionData.delete(e)})),this._updateAttributionItems()},this.handles.add([(0,he.on)((()=>this.view?.allLayerViews),"change",(e=>this._allLayerViewsChange(e)),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),(0,he.gx)((()=>!0===this.view?.stationary),(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.get("view.allLayerViews");LE.length=0,e?(e.forEach((e=>{if(e.suspended||!e.layer?.attributionVisible)return;const t=e.layer;if(PE(t,"user"))return void IE(LE,e,t.copyright);if(t.hasAttributionData){if(this._fetchedAttributionData.has(e)){const i=this._fetchedAttributionData.get(e);return void(i?IE(LE,e,this._getDynamicAttribution(i,this.view,t)):PE(t)&&IE(LE,e,t.copyright))}return void this._fetchAttributionData(e)}const i=t.get("portalItem.accessInformation");IE(LE,e,i||t.copyright)})),function(e,t){return e.length!==t.length||e.some(((e,i)=>e.text!==t[i].text))}(this.items,LE)&&(this.items.removeAll(),this.items.addMany(LE)),LE.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await(0,wp.q6)(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,function(e){return"bing-maps"===e.type}(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let e=0;e<i.length;e++){const s=i[e],n=s.coverageAreas;if(!n)return;for(const i of n){const n=i.bbox,o=i.zoomMin-(t&&i.zoomMin?1:0),a=i.zoomMax-(t&&i.zoomMax?1:0),l={xmin:n[1],ymin:n[0],xmax:n[3],ymax:n[2],spatialReference:qe.Z.WGS84},c={extent:(0,gu.$)(l),attribution:s.attribution||"",score:null!=i.score?i.score:100,id:e};for(let e=o;e<=a;e++)r[e]=r[e]||[],r[e].push(c)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:s}=t;let n=i.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!r||null==n||n<=-1)return"";const o=e[n],a=(0,gu.iV)(r.center.clone().normalize(),t.spatialReference),l={};return o?o.filter((e=>{const t=!l[e.id]&&a&&(0,Le.aV)(e.extent,a);return t&&(l[e.id]=!0),t})).sort(((e,t)=>t.score-e.score||e.objectId-t.objectId)).map((e=>e.attribution)).join(", "):""}};(0,t._)([(0,m.Cb)({readOnly:!0,type:n.Z})],DE.prototype,"items",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],DE.prototype,"state",null),(0,t._)([(0,m.Cb)()],DE.prototype,"view",void 0),DE=(0,t._)([(0,y.j)("esri.widgets.Attribution.AttributionViewModel")],DE);const NE=DE;var FE=s(92165),kE=s(34236),UE=s(26451);let VE=class extends RE.Z{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver((e=>e.forEach((({target:e})=>this._checkSourceTextOverflow(e))))),this.iconClass="esri-icon-description",this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new NE}initialize(){this.own((0,he.on)((()=>this.viewModel?.items),"change",(()=>this.scheduleRender())))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce(((e,t)=>(e.includes(t.text)||e.push(t.text),e)),[]).join(this.itemDelimiter)}render(){const e={"esri-attribution--open":this._isOpen};return(0,UE.u)("div",{bind:this,class:this.classes("esri-attribution esri-widget",e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return(0,UE.u)("div",{class:"esri-attribution__powered-by"},"Powered by"," ",(0,UE.u)("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?"0":"",{attributionText:r}=this,s={"esri-attribution__sources--open":e,"esri-interactive":t};return(0,UE.u)("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",s),innerHTML:r,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const e=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,e&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};(0,t._)([(0,m.Cb)()],VE.prototype,"_isOpen",void 0),(0,t._)([(0,m.Cb)()],VE.prototype,"_isInteractive",null),(0,t._)([(0,m.Cb)()],VE.prototype,"_attributionTextOverflowed",void 0),(0,t._)([(0,m.Cb)()],VE.prototype,"_prevSourceNodeHeight",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],VE.prototype,"attributionText",null),(0,t._)([(0,m.Cb)()],VE.prototype,"iconClass",void 0),(0,t._)([(0,m.Cb)()],VE.prototype,"itemDelimiter",void 0),(0,t._)([(0,m.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],VE.prototype,"label",void 0),(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/widgets/Attribution/t9n/Attribution")],VE.prototype,"messages",void 0),(0,t._)([(0,We.B)("viewModel.view")],VE.prototype,"view",void 0),(0,t._)([(0,m.Cb)({type:NE})],VE.prototype,"viewModel",void 0),(0,t._)([(0,FE.h)()],VE.prototype,"_toggleState",null),VE=(0,t._)([(0,y.j)("esri.widgets.Attribution")],VE);const zE=VE;var BE=s(68266);let HE=class extends((0,BE._)(O.Z)){constructor(e){super(e),this._handles=new Ae.Z,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add((0,he.YP)((()=>this.view),this._updateRotationWatcher,he.nn))}destroy(){this._handles=(0,I.hw)(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};"2d"===this.view.type?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){null!=e&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add("2d"===e.type?(0,he.YP)((()=>e?.rotation),this._updateForRotation,he.nn):(0,he.YP)((()=>e?.camera),this._updateForCamera,he.nn))}};(0,t._)([(0,m.Cb)({readOnly:!0})],HE.prototype,"canShowNorth",null),(0,t._)([(0,m.Cb)()],HE.prototype,"orientation",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],HE.prototype,"state",null),(0,t._)([(0,m.Cb)()],HE.prototype,"view",void 0),HE=(0,t._)([(0,y.j)("esri.widgets.CompassViewModel")],HE);const jE=HE;let GE=class extends RE.Z{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass="esri-icon-locate-circled",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new jE}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i="disabled"===t,r="compass"==("rotation"===t?"rotation":"compass"),s=i?-1:0,n={"esri-disabled":i,"esri-interactive":!i},o={"esri-icon-compass":r,"esri-icon-dial":!r},{messages:a}=this;return(0,UE.u)("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},(0,UE.u)("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",o),styles:this._toRotationTransform(e)}),(0,UE.u)("span",{class:"esri-icon-font-fallback-text"},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};(0,t._)([(0,We.B)("viewModel.goToOverride")],GE.prototype,"goToOverride",void 0),(0,t._)([(0,m.Cb)()],GE.prototype,"iconClass",void 0),(0,t._)([(0,m.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],GE.prototype,"label",void 0),(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/widgets/Compass/t9n/Compass")],GE.prototype,"messages",void 0),(0,t._)([(0,We.B)("viewModel.view")],GE.prototype,"view",void 0),(0,t._)([(0,m.Cb)({type:jE})],GE.prototype,"viewModel",void 0),(0,t._)([(0,FE.h)()],GE.prototype,"_reset",null),GE=(0,t._)([(0,y.j)("esri.widgets.Compass")],GE);const WE=GE;let ZE=class extends O.Z{constructor(e){super(e),this._handles=new Ae.Z,this.navigationMode="pan",this.view=null}initialize(){this._handles.add((0,he.gx)((()=>this.view?.inputManager),(()=>this._setNavigationMode())))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}};(0,t._)([(0,m.Cb)({readOnly:!0})],ZE.prototype,"state",null),(0,t._)([(0,m.Cb)()],ZE.prototype,"navigationMode",void 0),(0,t._)([(0,m.Cb)()],ZE.prototype,"view",void 0),ZE=(0,t._)([(0,y.j)("esri.widgets.NavigationToggleViewModel")],ZE);const qE=ZE,$E="esri-navigation-toggle__button esri-widget--button",YE="esri-navigation-toggle__button--active";let XE=class extends RE.Z{constructor(e,t){super(e,t),this.iconClass="esri-icon-pan2",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new qE}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e="disabled"===this.get("viewModel.state"),t="pan"===this.get("viewModel.navigationMode"),i={"esri-disabled":e,"esri-navigation-toggle--horizontal":"horizontal"===this.layout},r={[YE]:t},s={[YE]:!t},n=e?-1:0,o=this.messages.toggle;return(0,UE.u)("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},(0,UE.u)("div",{class:this.classes($E,"esri-navigation-toggle__button--pan",r)},(0,UE.u)("span",{class:"esri-icon-pan"})),(0,UE.u)("div",{class:this.classes($E,"esri-navigation-toggle__button--rotate",s)},(0,UE.u)("span",{class:"esri-icon-rotate"})))}_toggle(){this.toggle()}};(0,t._)([(0,m.Cb)()],XE.prototype,"iconClass",void 0),(0,t._)([(0,m.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],XE.prototype,"label",void 0),(0,t._)([(0,m.Cb)({value:"vertical"})],XE.prototype,"layout",null),(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],XE.prototype,"messages",void 0),(0,t._)([(0,We.B)("viewModel.view")],XE.prototype,"view",void 0),(0,t._)([(0,m.Cb)({type:qE})],XE.prototype,"viewModel",void 0),(0,t._)([(0,FE.h)()],XE.prototype,"_toggle",null),XE=(0,t._)([(0,y.j)("esri.widgets.NavigationToggle")],XE);const JE=XE;let KE=class extends RE.Z{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={"esri-disabled":!this.enabled,"esri-interactive":this.enabled},i={[this.iconClass]:!!this.iconClass};return(0,UE.u)("div",{bind:this,class:this.classes("esri-widget--button esri-widget",t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},(0,UE.u)("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",i)}),(0,UE.u)("span",{class:"esri-icon-font-fallback-text"},this.title))}_triggerAction(){this.action.call(this)}};(0,t._)([(0,m.Cb)()],KE.prototype,"action",void 0),(0,t._)([(0,m.Cb)()],KE.prototype,"enabled",void 0),(0,t._)([(0,m.Cb)()],KE.prototype,"iconClass",void 0),(0,t._)([(0,m.Cb)()],KE.prototype,"title",void 0),(0,t._)([(0,FE.h)()],KE.prototype,"_triggerAction",null),KE=(0,t._)([(0,y.j)("esri.widgets.IconButton")],KE);const QE=KE;let eA=class extends O.Z{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return 0===t||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return 0===t||e<t}};(0,t._)([(0,m.Cb)({readOnly:!0})],eA.prototype,"canZoomIn",null),(0,t._)([(0,m.Cb)({readOnly:!0})],eA.prototype,"canZoomOut",null),(0,t._)([(0,m.Cb)()],eA.prototype,"view",void 0),eA=(0,t._)([(0,y.j)("esri.widgets.Zoom.ZoomConditions2D")],eA);const tA=eA;let iA=class extends O.Z{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};(0,t._)([(0,m.Cb)({readOnly:!0})],iA.prototype,"canZoomIn",null),(0,t._)([(0,m.Cb)({readOnly:!0})],iA.prototype,"canZoomOut",null),(0,t._)([(0,m.Cb)()],iA.prototype,"view",void 0),iA=(0,t._)([(0,y.j)("esri.widgets.Zoom.ZoomConditions3D")],iA);const rA=iA;let sA=class extends O.Z{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?"2d"===e.type?this._zoomConditions=new tA({view:e}):"3d"===e.type&&(this._zoomConditions=new rA({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomIn():(0,f.R8)(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomOut():(0,f.R8)(e.goTo({zoomFactor:.5}))}};(0,t._)([(0,m.Cb)()],sA.prototype,"_zoomConditions",void 0),(0,t._)([(0,m.Cb)({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],sA.prototype,"canZoomIn",void 0),(0,t._)([(0,m.Cb)({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],sA.prototype,"canZoomOut",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],sA.prototype,"state",null),(0,t._)([(0,m.Cb)()],sA.prototype,"view",null),sA=(0,t._)([(0,y.j)("esri.widgets.Zoom.ZoomViewModel")],sA);const nA=sA;let oA=class extends RE.Z{constructor(e,t){super(e,t),this.iconClass="esri-icon-zoom-in-magnifying-glass",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new nA}initialize(){this._zoomInButton=new QE({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"}),this._zoomOutButton=new QE({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={"esri-zoom--horizontal":"horizontal"===this.layout};return this._zoomInButton.enabled="ready"===e.state&&e.canZoomIn,this._zoomOutButton.enabled="ready"===e.state&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,(0,UE.u)("div",{class:this.classes("esri-zoom esri-widget",t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};(0,t._)([(0,m.Cb)()],oA.prototype,"iconClass",void 0),(0,t._)([(0,m.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],oA.prototype,"label",void 0),(0,t._)([(0,m.Cb)({value:"vertical"})],oA.prototype,"layout",null),(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/widgets/Zoom/t9n/Zoom")],oA.prototype,"messages",void 0),(0,t._)([(0,We.B)("viewModel.view")],oA.prototype,"view",void 0),(0,t._)([(0,m.Cb)({type:nA})],oA.prototype,"viewModel",void 0),oA=(0,t._)([(0,y.j)("esri.widgets.Zoom")],oA);const aA=oA,lA="esri.views.ui.DefaultUI";p.Z.getLogger(lA);let cA=class extends OE{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([(0,he.YP)((()=>this.components),this._componentsWatcher.bind(this),he.nn),(0,he.YP)((()=>this.view),this._updateViewAwareWidgets.bind(this),he.nn)])}_add(e,t,i,r){if("string"==typeof e&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,r)}_removeComponents(e){e.forEach((e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())}))}_updateViewAwareWidgets(e){this.components.forEach((t=>{const i=this._find(t),r=i&&i.widget;(function(e){return e&&void 0!==e.view})(r)&&(r.view=e)}))}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(e){this.initialized&&e.forEach((e=>this.add(this._createComponent(e),this._defaultPositionLookup[e])))}_createComponent(e){const t=this._createWidget(e);if(t)return new yE({id:e,node:t})}_createWidget(e){return"attribution"===e?this._createAttribution():"compass"===e?this._createCompass():"navigation-toggle"===e?this._createNavigationToggle():"zoom"===e?this._createZoom():void 0}_createAttribution(){return new zE({view:this.view})}_createCompass(){return new WE({view:this.view})}_createNavigationToggle(){return new JE({view:this.view})}_createZoom(){return new aA({view:this.view})}};(0,t._)([(0,m.Cb)()],cA.prototype,"components",void 0),cA=(0,t._)([(0,y.j)(lA)],cA);const uA=cA;let hA=class extends uA{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};(0,t._)([(0,m.Cb)()],hA.prototype,"components",void 0),hA=(0,t._)([(0,y.j)("esri.views.ui.3d.DefaultUI3D")],hA);const dA=hA,pA=p.Z.getLogger("esri.views.SceneView");let fA=class extends(Pe((0,Ie.f)(Be(Gt)))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new $f.L({slicePlane:be.B},this),this._resourceController=function(e){return new Fg.ResourceController({view:e})}(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new vp({view:this}),this.labeler=new sf({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new Se,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new mi,this.environmentManager=new io,this.extent=null,this.floors=new n.Z,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new ii({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Xf,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new dA,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new mg,this.voxelWasm=null,this.voxelWasmPromise=null,(0,fe.j2)(),e&&e.environment||(this._defaults.environment=new hr,this.environment=this._defaults.environment);const t=(e=null)=>{(0,I.pC)(e)&&e.type===ue.y.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach((async e=>{try{await e.when()}catch{}this._updatingChanged()})))};this.handles.add([(0,he.on)((()=>this.map?.allLayers),"after-changes",(e=>t(e)),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",(e=>this._updateUpdatingMonitors(e))),(0,he.YP)((()=>this.map),(e=>{e&&"load"in e&&e.load&&e.load().catch((()=>{}))}))]),this.inputManager=new Dd({view:this}),this.stateManager=new Bm({view:this})}initialize(){this.groundView=new ze({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add((0,he.on)((()=>this.map?.allLayers),"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add((()=>this.qualitySettings.memoryLimit),(e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)}),he.nn),this.updatingHandles.add((()=>this.qualitySettings.additionalCacheMemory),(e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)}),he.nn),this.updatingHandles.add((()=>this.qualitySettings.frameRate),(e=>(0,de.bP)(e>0?1e3/Math.ceil(e):0)),he.nn),this.updatingHandles.add((()=>this.map?.ground),e,he.tX),this.updatingHandles.add((()=>this.map?.ground?.opacity),(()=>this._updateDefaultHitTestOptions()),he.tX),this.handles.add((0,he.YP)((()=>this.spatialReference),(()=>this.notifyChange("clippingArea")),he.Z_))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=(0,I.SC)(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=(0,I.SC)(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=(0,I.SC)(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if("global"===this.viewingMode)return null;let e=this._userClippingArea||this.get("map.clippingArea");return!this._userClippingArea&&!this.get("map.clippingEnabled")||(0,I.Wi)(e)?(this._clippingArea=null,null):e instanceof Ze.Z?this.spatialReference&&(e=gA(e,this.spatialReference),(0,I.Wi)(e))?(pA.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),(0,I.Wi)(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(pA.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&"global"===this.viewingMode&&(0,I.pC)(e)?pA.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Nt.JY.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return(0,I.Wi)(t)||(0,I.Wi)(e)||t.spatialReference.equals(e)?t:gA(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||qe.Z.WGS84,i=gA(this.clippingArea,t);(0,I.pC)(i)&&(e=(0,I.pC)(e)?e.intersection(i):i);const r=this._get("dataExtent");return(0,I.pC)(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||qe.Z.WGS84;let t;const i=i=>{const r=gA(i,e);(0,I.Wi)(r)||((0,I.pC)(t)?t.union(r):t=r.clone())},r=this.basemapTerrain;if(r?.spatialReference){const e=r.groundExtent;i(new Ze.Z({xmin:e[0],ymin:e[1],zmin:0,xmax:e[2],ymax:e[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const e=e=>{!(0,I.pC)(e.fullExtent)||"graphics"===e.type&&e.internal||i(e.fullExtent)};this.map.allLayers.forEach((t=>e(t)))}if((0,I.Wi)(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof hr?e:e instanceof lr?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(e):hr.fromWebsceneEnvironment(e):(0,g.se)(hr,e):new hr}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(0,I.pC)(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&((0,I.Wi)(this.state)||this.state.stationary)}set qualityProfile(e){dg.isValidProfile(e)&&(dg.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||dg.getDefaultProfile()}set slicePlane(e){if((0,I.pC)(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),(0,I.Wi)(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");(0,be.a)(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return null!=this.spatialReference?(0,xe.dp)(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return null!=e?ye.Z.deriveUnitFromSR(e,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach((r=>{if(r.isFulfilled()){if(r.updating){if(t=!0,r.suspended||(0,Ug.wP)(r))return;++i,e+=r.updatingProgress}}else++i}));for(const t of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])if((0,I.pC)(t)&&t.updating){const t=.1;i+=t,e+=.5*t}for(const t of[this.deconflictor,this.labeler,this.basemapTerrain])(0,I.pC)(t)&&t.updating&&(++i,e+=t.updatingProgress);if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||this.inputManager?.hasPendingInputs||this.map?.allLayers?.some((e=>!e.isFulfilled()))),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const i=performance.now();if(e<1){const t=Math.min((i-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-t)+e*t}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?i:0}return t}get viewingMode(){const e=this._predeterminedViewingMode;if((0,I.pC)(e))return(0,Nt.M7)(e);const t=this.spatialReference;return t?(0,I.pC)(this.defaultsFromMap?.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?(0,Nt.M7)(this.defaultsFromMap.viewingMode):(0,Ou.D)(t,Nt.JY.Global)?"global":"local":"global"}set viewingMode(e){this.ready?pA.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):void 0===e&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new zg(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return pA.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=(0,I.pC)(i.graphics)&&((0,I.pC)(i.graphics.include)||(0,I.pC)(i.graphics.exclude)),s=(0,dt.Rw)(e)?(0,dt.s6)(this,e):e,n=(0,pe.md)(s);i.enableDraped=i.include&&!i.include.has(Lc.cy)||i.exclude&&i.exclude.has(Lc.cy);const o=this.sceneIntersectionHelper,a=(0,No.Z8)(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?Ym.eC.ALL:Ym.eC.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const e of a.results.all){const t=(0,dE.bK)(e,this);if((0,I.Wi)(t))return this._intersectResultToMapPoint(e);if("graphic"!==t.type||this._testGraphicUidFilter(i.graphics,t.graphic))return this._intersectResultToMapPoint(e)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return pA.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=(0,I.Pt)(null==e.z&&(0,Mu.KO)(this.elevationProvider,e),0);return(0,_e.KC)(e,_A,this.renderSpatialReference,t),this.state.camera.projectToScreen(_A,vA),(0,pe.vW)(vA[0],vA[1])}pixelSizeAt(e){return this.ready?e?((0,_e.KC)(e,_A,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(_A)):0:(pA.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return pA.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=(0,dt.Rw)(e)?(0,dt.s6)(this,e):e,r=(0,pe.s1)(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=(0,No.Z8)(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=Ym.eC.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=(0,dE.J4)(a,this),c=(0,I.pC)(l)&&"type"in l&&"integrated-mesh"===l.type?l:null,u={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:(0,Xm.nn)(a)?a.distanceInRenderSpace:0,layer:c}};return kd.Z.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=n),Promise.resolve(u)}async popupHitTest(e){const{results:t,ground:i}=await async function(e,t){if("2d"===e.type)return e.hitTest(t);const i=await e.hitTest(t);if(0===i.results.length)return i;const r=i.results[0],s=(0,I.pC)(r.distance)?1.05*r.distance:r.distance,n=i.results.findIndex((e=>e.distance>s));return-1!==n&&(i.results=i.results.slice(0,n)),i}(this,e);let r=null;return!(0===t.length||Math.abs((0,I.Pt)(t[0].distance,0)-i.distance)<1e-5)||i.layer&&"integrated-mesh"===i.layer.type||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if((0,I.Wi)(e.parent))throw new l.Z("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return"line-of-sight"===e.parent.type?(await this.whenLayerView(e.parent)).whenAnalysisView():this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return(0,oE.cv)(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return(0,oE.v8)(i,this._pixelFormat())}_completeSettings(e){const t=(0,oE.uz)(e,this);return t.pixelRatio/=this.state.pixelRatio,(0,oE.$3)(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return(e=>{const t=Yt[e.type];if((0,I.Wi)(t))throw function(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new l.Z(`${i}:view-not-supported`,`${t} is not supported in 3D`)}(e);return t(e)})(e)}hasLayerViewModule(e){return(e=>(0,I.pC)(Yt[e.type]))(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let e=function(e){const t=(0,fE.hc)(e);if(!t.available)return new l.Z("webgl:required","WebGL is required but not supported.");if("3d"===e&&t.majorPerformanceCaveat)return new l.Z("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new l.Z("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new l.Z("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===ZC.zO.WEBGL1){if(!t.supportsElementIndexUint)return new l.Z("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new l.Z("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new l.Z("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}(this.type);if((0,b.Z)("safari")&&(0,b.Z)("safari")<9&&(e=new l.Z("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:(0,b.Z)("safari")})),(0,I.pC)(e))throw pA.warn("#validate()",e.message),e}get _predeterminedViewingMode(){const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return(0,I.pC)(e)?(0,Nt.wg)(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if((0,I.pC)(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,Nt.JY.Local),s=this._validateSpatialReferenceForViewingMode(e,t,Nt.JY.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,Nt.JY.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Nt.JY.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!(!(0,Ou.D)(e,i)||!(0,I.Wi)(t)&&!(0,Ce.Am)(t)&&((0,Ce.iC)(t)&&(0,I.Wi)((0,Ug.E_)(t,e,i))||(0,Ce.Tv)(t)&&i===Nt.JY.Global))}_makeSpatialReferenceConstraints(e,t,i){if((0,I.Wi)(t))return[{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;return(0,Ce.Am)(t)&&(r||s)?s&&i!==Nt.JY.Local&&null!==(0,Ug.er)(t.tileInfo,t.fullExtent,e,Nt.JY.Global)?[{spatialReference:r?qe.Z.WGS84:qe.Z.WebMercator,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:qe.Z.WebMercator,viewingMode:i}]:(0,Ce.iC)(t)||(0,Ce.Tv)(t)||!r&&!s?(0,Ce.iC)(t)&&r&&i!==Nt.JY.Global?[{spatialReference:e,viewingMode:i},{spatialReference:qe.Z.WGS84,viewingMode:Nt.JY.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?qe.Z.WGS84:qe.Z.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=(0,I.pC)(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||((0,I.pC)(i)?pA.warnOnce(`Spatial reference defined on view not supported in ${(0,Nt.M7)(i)} viewing mode.`):e.isGeographic&&pA.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise((e=>{this.ready?e(this):this._resolveWhenReady.push(e)}))}computeMapPointFromVec3d(e,t){let i=this.spatialReference||qe.Z.WGS84;return(0,_e.SH)(e,this.renderSpatialReference,e,i)||(i=qe.Z.WGS84,(0,_e.SH)(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new X.Z(e,i),t}trackGraphicState(e){if(!e.graphic)return pA.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=t=>{!r&&(0,I.pC)(t)&&"processor"in t&&"graphics-3d"===t.processor?.type&&t.processor.graphicsCore&&(i=t.processor.graphicsCore.trackGraphicState(e))};return(0,I.pC)(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then((e=>s(e)),(()=>{})).catch((()=>{})),{remove:()=>{r=!0,(0,I.pC)(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return(0,le.AL)(e.map((e=>this.highlight(e))));if(n.Z.isCollection(e))return(0,le.AL)(e.toArray().map((e=>this.highlight(e))));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):(0,le.kB)()}maskOccludee(e){if(!e)return pA.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=t=>{!r&&(0,I.pC)(t)&&(0,pE._1)(t)&&(i=t.maskOccludee(e))};return(0,I.pC)(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then((e=>s(e)),(()=>{})).catch((()=>{})),{remove:()=>{r=!0,(0,I.pC)(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find((t=>t.layer===e.layer)):null}graphicChanged(e){(0,I.pC)(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await(0,he.N1)((()=>this.graphicsView)),this.graphicsView;if(!e.layer||!this.map)throw new l.Z("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise(((t,i)=>{const r=this.map.allLayers.on("change",(s=>{s.added.includes(e.layer)&&(r.remove(),this.whenLayerView(e.layer).then(t,i))}))})):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,yA.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,yA.EXCLUDE);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(_A)?(t=this.computeMapPointFromVec3d(_A,t),e.intersector===Ym.q7.TERRAIN&&this.basemapTerrain&&(t.z=(0,I.Pt)((0,Mu.KO)(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],o=(0,dE.J4)(n,this);if((0,I.pC)(o)&&(o===this.map.ground||"type"in o&&"integrated-mesh"===o.type))break;const a=(0,dE.bK)(n,this);if((0,I.Wi)(a))continue;if("graphic"===a.type){if((0,I.Wi)(r)&&s!==e.length-1&&(r=new Set),(0,I.pC)(r)){const e=this._getGraphicFilterUid(a.graphic);if(r.has(e))continue;r.add(e)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push({...a,mapPoint:l,distance:c})}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return(0,I.Wi)(e)||((0,I.Wi)(e.include)||e.include.has(i))&&((0,I.Wi)(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:null,graphicUids:null}){if(!e)return i;if(e instanceof te.Z)(function(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)})(i,this._getGraphicFilterUid(e)),t===yA.INCLUDE&&((0,I.pC)(this.graphicsView)&&e.layer===this?mA(i,this.graphicsView.processor.layer.id):e.layer&&mA(i,e.layer.uid));else if((0,ce.TW)(e))for(const r of e)r===this.graphics&&(0,I.pC)(this.graphicsView)?mA(i,this.graphicsView.processor.layer.id):r===this.map.ground?mA(i,Lc.cy):this._externalToInternalRenderItems(r,t,i);else"uid"in e&&mA(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new aw({view:this})),this._set("elevationProvider",new lg({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new xy({view:this})),this._set("featureTiles",new jf({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const e=(0,I.pC)(this.basemapTerrain.extent)?(0,_e.iV)((0,ve.HH)(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;(0,I.pC)(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(e):this.featureTiles.filterExtent=e}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add((()=>kd.Z.FEATURE_TILE_TREE_SHOW_TILES),(e=>{e&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(s.e(770).then(s.bind(s,60770))).then((({FeatureTileTree3DDebugger:e})=>{!this.featureTreeDebugger&&kd.Z.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new e({view:this}))})):e||!this.featureTreeDebugger||kd.Z.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)}),he.tX),this.updatingHandles.add((()=>this.clippingArea),e,he.tX),this.updatingHandles.add((()=>this.basemapTerrain.extent),e,he.tX)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new vg(this.map,e));const t=this.state.isGlobal,i=(0,we.E2)(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Mg.Z.create(this.state.viewingMode,i)),t||this.handles.add((0,he.YP)((()=>this.basemapTerrain?.extent),(e=>{const t=this.renderCoordsHelper.spatialReference;e&&(0!==e[0]||0!==e[1]||0!==e[2]||0!==e[3])&&(0,_e.dH)(e,this.basemapTerrain.spatialReference,bA,t)&&(this.renderCoordsHelper.extent=bA)}),he.Z_),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(No.vh/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){(0,I.pC)(e)&&e.type===ue.y.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach((e=>{e.destroyed||(this.handles.add((0,he.YP)((()=>[e.updating,e.updatingProgress]),(()=>this._updatingChanged()),he.Z_),"updatingMonitors"),e.when((()=>this._updatingChanged()),(()=>this._updatingChanged())))})),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(e,t)=>this._renderScreenshotOverlay(e,t)}},t=new Jm(this.state.viewingMode,(e=>this._stage.layers.forAll(e)),this);this._set("sceneIntersectionHelper",t);const i=(0,oe.L7)(this.surface),{resourceController:r,state:s,renderSpatialReference:n}=this;this._stage=new hE({options:e,container:i,resourceController:r,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=(0,ae.on)(this._stage.renderView.canvas,"webglcontextlost",(()=>this.fatalError=new l.Z("webgl-context-lost"))),this.handles.add([this.updatingHandles.add((()=>this.qualitySettings.antialiasingEnabled),(()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})),he.nn),this.updatingHandles.add((()=>this.qualitySettings.highQualityTransparency),(()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency})),he.nn),(0,he.YP)((()=>this.magnifier),(e=>this._stage.renderView.magnifier=e),he.tX)],"stage");const o=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:mg.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add((()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference]),o),"stage"),o(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(No.vh/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Gg({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new pf})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController)return;if(0===this.graphics.length)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await Promise.all([s.e(3328),s.e(883),s.e(23)]).then(s.bind(s,70023))).default;(0,f.k_)(e),await(0,he.N1)((()=>this.basemapTerrain?.ready),e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),(0,I.pC)(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=(0,Nt.wg)(this.viewingMode);if(e===Nt.JY.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add((0,he.on)((()=>this.graphics),"after-changes",(()=>this._createGraphicsViewIfNeeded())),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const e=this.get("map.initialViewProperties.environment");e&&(this.environment=e)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach((e=>e(this)))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Lc.cy);for(const e of this.map.allLayers.items)"integrated-mesh"===e.type&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Lc.cy);for(const e of this.map.allLayers.items)"integrated-mesh"===e.type&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return(0,I.Wi)(this.voxelWasm)?((0,I.Wi)(this.voxelWasmPromise)&&(this.voxelWasmPromise=s.e(4999).then(s.bind(s,64999)).then((e=>(this.voxelWasm=new e.default(this),this.voxelWasm)))),this.voxelWasmPromise.then((t=>t.addVoxelLayer(e)))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){(0,I.pC)(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function mA(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function gA(e,t){return(0,I.pC)(e)&&(0,_e.Up)(e.spatialReference,t)?(0,_e.iV)(e,t):null}var yA;fA.type="3d",(0,t._)([(0,m.Cb)()],fA.prototype,"_userClippingArea",void 0),(0,t._)([(0,m.Cb)()],fA.prototype,"_resourceController",void 0),(0,t._)([(0,m.Cb)()],fA.prototype,"_stage",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"deconflictor",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"labeler",void 0),(0,t._)([(0,m.Cb)((0,ge.z)(Se,"analyses"))],fA.prototype,"analyses",void 0),(0,t._)([(0,m.Cb)({type:Zt,readOnly:!0,aliasOf:"state.animation"})],fA.prototype,"animation",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"basemapTerrain",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"elevationProvider",void 0),(0,t._)([(0,m.Cb)({type:K,aliasOf:"stateManager.camera"})],fA.prototype,"camera",void 0),(0,t._)([(0,m.Cb)({type:K,aliasOf:"stateManager.contentCamera"})],fA.prototype,"contentCamera",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"canvas",void 0),(0,t._)([(0,m.Cb)({type:X.Z,aliasOf:"stateManager.center"})],fA.prototype,"center",void 0),(0,t._)([(0,m.Cb)({type:Ze.Z})],fA.prototype,"clippingArea",null),(0,t._)([(0,m.Cb)({type:mi})],fA.prototype,"constraints",void 0),(0,t._)([(0,m.Cb)({type:Ze.Z,readOnly:!0})],fA.prototype,"renderDataExtent",null),(0,t._)([(0,m.Cb)({type:Ze.Z,readOnly:!0})],fA.prototype,"dataExtent",null),(0,t._)([(0,m.Cb)({type:Ze.Z,readOnly:!0})],fA.prototype,"groundAndLayersExtent",null),(0,t._)([(0,m.Cb)({value:null,type:hr})],fA.prototype,"environment",null),(0,t._)([(0,L.p)("environment")],fA.prototype,"castEnvironment",null),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"environmentManager",void 0),(0,t._)([(0,m.Cb)({type:Ze.Z,aliasOf:"stateManager.extent"})],fA.prototype,"extent",void 0),(0,t._)([(0,m.Cb)()],fA.prototype,"floors",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,aliasOf:"stateManager.screenCenter"})],fA.prototype,"screenCenter",void 0),(0,t._)([(0,m.Cb)({aliasOf:"stateManager.frustum"})],fA.prototype,"frustum",void 0),(0,t._)([(0,m.Cb)({type:Number,readOnly:!0})],fA.prototype,"fullOpacity",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"graphicsView",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"analysisViewManager",void 0),(0,t._)([(0,m.Cb)()],fA.prototype,"groundView",void 0),(0,t._)([(0,m.Cb)({type:Boolean})],fA.prototype,"initialExtentRequired",null),(0,t._)([(0,m.Cb)()],fA.prototype,"_defaultsFromMapSettings",null),(0,t._)([(0,m.Cb)({type:Boolean,readOnly:!0})],fA.prototype,"interacting",null),(0,t._)([(0,m.Cb)()],fA.prototype,"stationary",null),(0,t._)([(0,m.Cb)({aliasOf:"state.navigating"})],fA.prototype,"navigating",void 0),(0,t._)([(0,m.Cb)()],fA.prototype,"map",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"mapCoordsHelper",void 0),(0,t._)([(0,m.Cb)({aliasOf:"stateManager.padding"})],fA.prototype,"padding",void 0),(0,t._)([(0,m.Cb)({type:xy,readOnly:!0})],fA.prototype,"pointsOfInterest",void 0),(0,t._)([(0,m.Cb)({type:jf,readOnly:!0})],fA.prototype,"featureTiles",void 0),(0,t._)([(0,m.Cb)()],fA.prototype,"featureTreeDebugger",void 0),(0,t._)([(0,m.Cb)({type:Boolean})],fA.prototype,"screenSizePerspectiveEnabled",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],fA.prototype,"deactivatedWebGLExtensions",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],fA.prototype,"debugWebGLExtensions",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],fA.prototype,"renderCanvas",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],fA.prototype,"state",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"inputManager",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"stateManager",void 0),(0,t._)([(0,m.Cb)({type:["low","medium","high"]})],fA.prototype,"qualityProfile",null),(0,t._)([(0,m.Cb)({type:Ag,get(){let e=this._get("qualitySettings");return e||(e=new Ag,dg.apply(this.qualityProfile,e)),e}})],fA.prototype,"qualitySettings",void 0),(0,t._)([(0,m.Cb)()],fA.prototype,"slicePlane",null),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"typeSpecificPreconditionsReady",null),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"renderCoordsHelper",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"sceneIntersectionHelper",void 0),(0,t._)([(0,m.Cb)({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],fA.prototype,"resolution",null),(0,t._)([(0,m.Cb)({type:Number,aliasOf:"stateManager.scale"})],fA.prototype,"scale",void 0),(0,t._)([(0,m.Cb)()],fA.prototype,"heightModelInfo",null),(0,t._)([(0,m.Cb)()],fA.prototype,"spatialReference",void 0),(0,t._)([(0,m.Cb)({type:Boolean,constructOnly:!0})],fA.prototype,"alphaCompositingEnabled",void 0),(0,t._)([(0,m.Cb)({constructOnly:!0})],fA.prototype,"preserveDrawingBufferEnabled",void 0),(0,t._)([(0,m.Cb)({type:Boolean})],fA.prototype,"supersampleScreenshotsEnabled",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],fA.prototype,"type",void 0),(0,t._)([(0,m.Cb)({type:dA})],fA.prototype,"ui",void 0),(0,t._)([(0,m.Cb)({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],fA.prototype,"updating",null),(0,t._)([(0,m.Cb)({type:Number,readOnly:!0,dependsOn:["updating"]})],fA.prototype,"updatingProgress",void 0),(0,t._)([(0,m.Cb)({type:["global","local"]})],fA.prototype,"viewingMode",null),(0,t._)([(0,m.Cb)({type:ne,aliasOf:"stateManager.viewpoint"})],fA.prototype,"viewpoint",void 0),(0,t._)([(0,m.Cb)({type:Number,aliasOf:"stateManager.zoom"})],fA.prototype,"zoom",void 0),(0,t._)([(0,m.Cb)({type:mg})],fA.prototype,"highlightOptions",void 0),fA=(0,t._)([(0,y.j)("esri.views.SceneView")],fA),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(yA||(yA={}));const _A=(0,me.c)(),vA=(0,pe.s1)(),bA=(0,ve.Ue)(),wA=fA;var xA=s(45955),CA=s(74606),TA=s(50172),SA=s(25634),EA=s(83849),AA=s(25545),MA=s(62063),OA=s(22162),RA=s(27948),PA=s(17615),IA=s(62179),LA=s(63295),DA=s(25463),NA=s(80020),FA=s(3363),kA=(s(87090),s(21130)),UA=s(59801),VA=s(8108),zA=s(60720),BA=s(26869),HA=s(86618);let jA=class extends((0,HA.IG)(c.wq)){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};(0,t._)([(0,m.Cb)()],jA.prototype,"autoNavigate",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"filter",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"getResults",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"getSuggestions",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"maxResults",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"maxSuggestions",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"minSuggestCharacters",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"outFields",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"placeholder",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"popupEnabled",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"popupTemplate",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"prefix",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"resultGraphicEnabled",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"resultSymbol",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"suggestionsEnabled",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"suffix",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"withinViewEnabled",void 0),(0,t._)([(0,m.Cb)()],jA.prototype,"zoomScale",void 0),jA=(0,t._)([(0,y.j)("esri.widgets.Search.SearchSource")],jA);const GA=jA,WA=p.Z.getLogger("esri.widgets.Search.support.geometryUtils");function ZA(e,t){if(!t)return WA.error("missing-parameter: view is missing."),Promise.reject(new l.Z("searchgeometryutils:missing-parameter","view is missing."));if(!e)return WA.error("missing-parameter: point is missing."),Promise.reject(new l.Z("searchgeometryutils:missing-parameter","point is missing."));if(e.hasZ||"2d"===t.type)return Promise.resolve(e);const i=t?.map?.ground;return i&&i.layers.length?i.queryElevation(e,{cache:t.basemapTerrain?.elevationQueryCache}).then((e=>e.geometry)):Promise.resolve(e)}function qA(e){if((0,I.Wi)(e))return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":return e.getPoint(0);case"polyline":return e.getPoint(0,0)}return null}function $A(e,t,i){return(0,I.Wi)(e)?null:"extent"===e.type?e:"multipoint"===e.type||"polygon"===e.type||"polyline"===e.type?e.extent:"point"===e.type?XA(e,t,i):void 0}function YA(e,t,i){return(0,I.Wi)(e)||(0,I.Wi)(t)?null:XA(e.center,t,i)}function XA(e,t,i){const r=e.hasZ?e.z:void 0;return t&&t.map?(i?(0,xe.D9)(t,i):t.extent).clone().centerAt(e).set({zmax:r,zmin:r}):new Ze.Z({xmin:e.x-.25,ymin:e.y-.25,xmax:e.x+.25,ymax:e.y+.25,spatialReference:e.spatialReference,zmin:r,zmax:r})}var JA=s(61547),KA=s(72057);const QA=/https?:\/\/services.*\.arcgis\.com/i,eM=/(?:\{([^}]+)\})/g,tM=p.Z.getLogger("esri.widgets.Search.support.layerSearchUtils");function iM(e,t){const{filter:i,withinViewEnabled:r}=e,s=t&&t.extent;return i&&i.geometry||(r&&s?s:void 0)}function rM(e){return e&&e.includes("*")}async function sM(e){e&&await e.load()}function nM(e){return e?.capabilities?.query?.supportsPagination??!1}function oM(e){return e.displayField||e.layer.displayField||function(e){return e?.fieldsIndex?.fields?.find((e=>"string"===e.type))?.name??""}(e.layer)}function aM(e,t){return!(!e||!t)&&t.every((t=>lM(e,t)))}function lM(e,t){return!!e.getField(t)}function cM(e){return e.replace(/\'/g,"''")}function uM(e,t){const i=t&&t.where;return i?`(${e}) AND (${i})`:e}function hM({searchTerm:e,layer:t,searchFields:i,filter:r,exactMatch:s,type:n}){const{definitionExpression:o,url:a}=t;let l="";return e&&i&&i.forEach((i=>{const o=t.getField(i),c="function"==typeof t.getFieldDomain&&t.getFieldDomain(i),u=(c&&"coded-value"===c.type?function(e,t,i){let r=null;const{codedValues:s}=e;return s&&s.some((e=>{const s=e.name,n=i?s:s.toLowerCase();return(i?t:t.toLowerCase())===n&&(r=e.code.toString(),!0)})),r}(c,e,s):null)||e||null;if(null!==u){const e=function({currentTerm:e,field:t,filter:i,exactMatch:r,url:s,type:n}){const o=t.type,a=t.name;if("string"===o||"date"===o||"global-id"===o){const t=QA.test(s),o=t&&function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(e)?"N":"";if(r&&"search"===n)return uM(`${a} = ${o}'${e}'`,i);const l=t?a:`UPPER(${a})`,c=t?e:e.toUpperCase();return uM(`${l} LIKE ${o}${r?`'${c}%'`:`'%${c}%'`}`,i)}if("oid"===o||"small-integer"===o||"integer"===o||"single"===o||"double"===o){const t=Number(e);return isNaN(t)?null:uM(`${a} = ${t}`,i)}return uM(`${a} = ${e}`,i)}({currentTerm:u,field:o,filter:r,exactMatch:s,url:a,type:n});e&&(l+=function(e,t){return e?` OR (${t})`:`(${t})`}(l,e))}})),o?`(${o}) AND (${l})`:l}function dM(e,t,i){const r=e.sourceLayer,{attributes:s}=e,n="function"==typeof r.getFieldDomain&&r.getFieldDomain(i);if(t)return(0,JA.n)(t,s);if(i&&s){const e=r.getField(i),t=function(e,t){return e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}(s,i);return null==t?"":n&&"coded-value"===n.type?function(e,t){let i=null;const{codedValues:r}=e;return r&&r.length&&r.some((e=>e.code===t&&(i=e.name,!0))),i}(n,t):"date"===e?.type?(0,KA.p6)(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}return""}var pM;let fM=pM=class extends GA{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>function(e,t){const{exactMatch:i=!1,location:r,maxResults:s,spatialReference:n,source:o,sourceIndex:a,suggestResult:c,view:h}=e,{layer:d,filter:p,zoomScale:f}=o,m=h&&h.scale,g=iM(o,h),y=t&&t.signal;return sM(d).then((()=>{const e=d.popupTemplate;return e?e.getRequiredFields(d.fieldsIndex):null})).then((e=>{const{objectIdField:t,returnZ:_}=d,v=oM(o);if(!lM(d,v))throw tM.error("invalid-field: displayField is invalid."),new l.Z("getResults():invalid-field","displayField is invalid.");const b=e&&e.length?e:[v],w=o.outFields||b,x=rM(w);if(w.includes(t)||x||w.push(t),d.floorInfo?.floorField&&w.push(d.floorInfo.floorField),!x&&!aM(d,w))throw tM.error("invalid-field: outField is invalid."),new l.Z("getResults():invalid-field","outField is invalid.");const C=d.createQuery(),{orderByFields:T}=o;if(T&&(C.orderByFields=T),n){C.outSpatialReference=n;const e=1/(0,em.c9)(n);e&&(C.maxAllowableOffset=e)}const S="mesh"===d.geometryType||"multipatch"===d.geometryType,E=d.capabilities?.data?.supportsZ&&!S;if(C.returnZ=E&&!1!==_,C.returnGeometry=!0,C.multipatchOption=S?"xyFootprint":null,w&&(C.outFields=w),r)C.geometry=r;else if(c.key)C.objectIds=[c.key];else{const e=o.searchFields||[v];if(!aM(d,e))throw tM.error("invalid-field: search field is invalid."),new l.Z("getResults():invalid-field","search field is invalid.");if(nM(d)&&(C.num=s),g&&(C.geometry=g),!c.text.trim())return[];const{prefix:t="",suffix:r=""}=o,n=hM({searchTerm:cM(`${t}${c.text}${r}`),layer:d,searchFields:e,filter:p,exactMatch:i,type:"search"});if(!n)return[];C.where=n}return d.queryFeatures(C,{signal:y}).then((e=>function(e,t,i,r,s,n,o){return e.features.map((e=>function(e,t,i,r,s,n,o){const a=e.clone(),l=e.sourceLayer,c=l&&l.objectIdField,h=c&&e.attributes[c],d=dM(e,i.searchTemplate,s),p=$A(a.geometry,t,n),f="number"==typeof o?YA((0,u.d9)(p),t,o):p,m=e.clone();return(0,I.pC)(f)&&(m.geometry=Zg.Z.fromExtent(f)),{extent:f,target:m,feature:a,key:h,name:d,sourceIndex:r}}(e,t,i,r,s,n,o)))}(e,h,o,a,v,m,f)))}))}({source:this,...e},t),this.getSuggestions=(e,t)=>function(e,t){const{source:i,spatialReference:r,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a,exactMatch:c}=e,{layer:u,filter:h}=i,d=t&&t.signal,p=iM(i,s);return sM(u).then((()=>{if(!nM(u))return[];const e=oM(i),t=i.searchFields||[e],s=[];i.suggestionTemplate?i.suggestionTemplate.replace(eM,((e,t)=>(s.push(t),e))):s.push(e);const f=rM(s);s.includes(u.objectIdField)||f||s.push(u.objectIdField);const m=lM(u,e),g=f||aM(u,s),y=aM(u,t);if(!m)throw tM.error("invalid-field: displayField is invalid."),new l.Z("getSuggestions():invalid-field","displayField is invalid.");if(!g)throw tM.error("invalid-field: outField is invalid."),new l.Z("getSuggestions():invalid-field","outField is invalid.");if(!y)throw tM.error("invalid-field: search field is invalid."),new l.Z("getSuggestions():invalid-field","search field is invalid.");const _=u.createQuery(),{orderByFields:v}=i;if(v&&(_.orderByFields=v),_.outSpatialReference=r,_.returnGeometry=!1,_.num=o,_.outFields=s,p&&(_.geometry=p),!n.trim())return[];const{prefix:b="",suffix:w=""}=i,x=hM({searchTerm:cM(`${b}${n}${w}`),layer:u,searchFields:t,filter:h,exactMatch:c,type:"suggest"});return x?(_.where=x,u.queryFeatures(_,{signal:d}).then((t=>function(e,t,i,r){return e.features.map((e=>function(e,t,i,r){const s=e.sourceLayer,{attributes:n}=e,{objectIdField:o}=s,a=n[o];return{text:dM(e,t.suggestionTemplate,r),key:a,sourceIndex:i}}(e,t,i,r)))}(t,i,a,e)))):[]}))}({source:this,...e},t)}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}))}get name(){return this._getLayerTitle()||""}set name(e){void 0!==e?this._override("name",e):this._clearOverride("name")}clone(){return new pM({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,u.d9)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?(0,u.d9)(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex.fields.find((e=>"string"===e.type))?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map((t=>{const i=e.getField(t);return i&&i.alias||t})).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};(0,t._)([(0,m.Cb)({json:{read:{source:"field.name"},write:{target:"field.name"}}})],fM.prototype,"displayField",void 0),(0,t._)([(0,m.Cb)({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],fM.prototype,"exactMatch",void 0),(0,t._)([(0,m.Cb)({value:null})],fM.prototype,"layer",null),(0,t._)([(0,m.Cb)()],fM.prototype,"name",null),(0,t._)([(0,m.Cb)({type:[String],json:{write:!0}})],fM.prototype,"orderByFields",void 0),(0,t._)([(0,m.Cb)()],fM.prototype,"searchFields",void 0),(0,t._)([(0,m.Cb)()],fM.prototype,"searchTemplate",void 0),(0,t._)([(0,m.Cb)()],fM.prototype,"suggestionTemplate",void 0),fM=pM=(0,t._)([(0,y.j)("esri.widgets.Search.LayerSearchSource")],fM);const mM=fM;var gM=s(66341),yM=s(84238);let _M=class extends c.wq{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],_M.prototype,"address",void 0),(0,t._)([(0,m.Cb)({type:Object,json:{write:!0}})],_M.prototype,"attributes",void 0),(0,t._)([(0,m.Cb)({type:Ze.Z,json:{write:!0}})],_M.prototype,"extent",void 0),(0,t._)([(0,m.Cb)({type:X.Z,json:{write:!0}})],_M.prototype,"location",void 0),(0,t._)([(0,m.Cb)({type:Number,json:{write:!0}})],_M.prototype,"score",void 0),_M=(0,t._)([(0,y.j)("esri.rest.support.AddressCandidate")],_M);const vM=_M;var bM=s(75855);let wM=class extends c.wq{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};(0,t._)([(0,m.Cb)({type:Object,json:{write:!0}})],wM.prototype,"address",void 0),(0,t._)([(0,m.Cb)(bM.q)],wM.prototype,"apiKey",void 0),(0,t._)([(0,m.Cb)({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],wM.prototype,"categories",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],wM.prototype,"countryCode",void 0),(0,t._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],wM.prototype,"forStorage",void 0),(0,t._)([(0,m.Cb)({type:X.Z,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],wM.prototype,"location",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],wM.prototype,"locationType",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],wM.prototype,"magicKey",void 0),(0,t._)([(0,m.Cb)({type:Number,json:{write:!0}})],wM.prototype,"maxLocations",void 0),(0,t._)([(0,m.Cb)({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],wM.prototype,"outFields",void 0),(0,t._)([(0,m.Cb)({type:qe.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],wM.prototype,"outSpatialReference",void 0),(0,t._)([(0,m.Cb)({type:Ze.Z,json:{write:{writer:(e,t)=>{const i=e?e.shiftCentralMeridian():null;t.searchExtent=i}}}})],wM.prototype,"searchExtent",void 0),wM=(0,t._)([(0,y.j)("esri.rest.support.AddressToLocationsParameters")],wM),wM.from=(0,g.se)(wM);const xM=wM;function CM({data:e}){if(!e)return[];const{candidates:t,spatialReference:i}=e;return t?t.map((e=>{if(!e)return;const{extent:t,location:r}=e,s=!t||function(e){return e&&"number"==typeof e.xmin&&"number"==typeof e.ymin&&"number"==typeof e.xmax&&"number"==typeof e.ymax}(t);return function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y}(r)&&s?(t&&(t.spatialReference=i),r.spatialReference=i,vM.fromJSON(e)):void 0})):[]}let TM=class extends c.wq{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};(0,t._)([(0,m.Cb)(bM.q)],TM.prototype,"apiKey",void 0),(0,t._)([(0,m.Cb)({type:X.Z,json:{write:{writer:(e,t)=>{const i=e?e.clone().normalize():null,r=void 0!==i;t.location=r?i:null}}}})],TM.prototype,"location",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],TM.prototype,"locationType",void 0),(0,t._)([(0,m.Cb)({type:qe.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],TM.prototype,"outSpatialReference",void 0),TM=(0,t._)([(0,y.j)("esri.rest.support.LocationToAddressParameters")],TM),TM.from=(0,g.se)(TM);const SM=TM;function EM({data:e}){if(!e)return;const{address:t,location:i}=e,r=t&&t.Match_addr||"";return vM.fromJSON({address:r,attributes:t||{},location:i,score:100})}let AM=class extends c.wq{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};(0,t._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],AM.prototype,"isCollection",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],AM.prototype,"magicKey",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],AM.prototype,"text",void 0),AM=(0,t._)([(0,y.j)("esri.rest.support.SuggestionCandidate")],AM);const MM=AM;let OM=class extends c.wq{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};(0,t._)([(0,m.Cb)(bM.q)],OM.prototype,"apiKey",void 0),(0,t._)([(0,m.Cb)({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],OM.prototype,"categories",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],OM.prototype,"countryCode",void 0),(0,t._)([(0,m.Cb)({type:X.Z,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],OM.prototype,"location",void 0),(0,t._)([(0,m.Cb)({type:Number,json:{write:!0}})],OM.prototype,"maxSuggestions",void 0),(0,t._)([(0,m.Cb)({type:qe.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],OM.prototype,"outSpatialReference",void 0),(0,t._)([(0,m.Cb)({type:Ze.Z,json:{write:{writer:(e,t)=>{const i=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(i)}}}})],OM.prototype,"searchExtent",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],OM.prototype,"text",void 0),OM=(0,t._)([(0,y.j)("esri.rest.support.SuggestLocationsParameters")],OM),OM.from=(0,g.se)(OM);const RM=OM;function PM(e){const{data:t}=e;if(!t)return[];const{suggestions:i}=t;return i?i.map((e=>new MM(e))):[]}function IM(e,t){if(t.localSearchDisabled)return null;const i=e?.scale;return"number"==typeof i&&i<=3e5?e.get("extent.center"):null}function LM(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function DM(e,t){const{filter:i,withinViewEnabled:r}=e,s=t&&t.scale,n=t&&t.extent;return $A(i&&i.geometry,t,s)||(r&&n?n:void 0)}function NM(e,t){return e.filter(Boolean).map((e=>function(e,t){const{key:i,scale:r,sourceIndex:s,view:n,zoomScale:o,defaultZoomScale:a}=t,{attributes:l,extent:c,location:u,address:h}=e,d=new te.Z({geometry:u,attributes:l}),p=c||u,f=$A(p,n,r),m="number"==typeof o?YA(f,n,o):"number"==typeof a&&"point"===p.type?YA(f,n,a):f,g=u?`${u.x},${u.y}`:"",y=h||g,_=d.clone();return(0,I.pC)(m)&&(_.geometry=Zg.Z.fromExtent(m)),{extent:m,feature:d,target:_,key:i,name:y,sourceIndex:s}}(e,t)))}var FM;let kM=FM=class extends GA{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(e,t)=>function(e,t){return e.location?function(e,t){const{source:i,spatialReference:r,location:s,sourceIndex:n,view:o}=e,{apiKey:a,url:l,zoomScale:c,defaultZoomScale:u}=i,h=o&&o.scale,d=t&&t.signal,p=new SM;return p.location=s,a&&(p.apiKey=a),r&&(p.outSpatialReference=r),async function(e,t,i){t=SM.from(t);const r=(0,yM.en)(e),s={...t.toJSON(),f:"json"},n=(0,yM.cv)({...r.query,...s}),o=(0,yM.lA)(n,i),a=`${r.path}/reverseGeocode`;return(0,gM.default)(a,o).then(EM)}(l,p,{signal:d}).then((e=>NM([e],{sourceIndex:n,scale:h,view:o,zoomScale:c,defaultZoomScale:u}))).catch((()=>[]))}(e,t):function(e,t){const{source:i,suggestResult:r,spatialReference:s,view:n,maxResults:o,sourceIndex:a}=e,l=i&&i.zoomScale,c=i&&i.defaultZoomScale;if(!r.text.trim())return Promise.resolve(null);const u=!r.key&&i.prefix?i.prefix:"",h=!r.key&&i.suffix?i.suffix:"",d=`${u}${r.text}${h}`,p=new xM,{apiKey:f,url:m}=i,g=n&&n.scale,y=DM(i,n),_=t&&t.signal;if(f&&(p.apiKey=f),!m)return Promise.resolve(null);i.categories&&(p.categories=i.categories),i.locationType&&(p.locationType=i.locationType),s&&(p.outSpatialReference=s);const v=IM(n,i);v&&(p.location=v),p.maxLocations=o,y&&(p.searchExtent=(0,I.Wg)(y)),i.countryCode&&(p.countryCode=i.countryCode);const{key:b}=r,w=`${b}`;return b&&(p.magicKey=w),p.address={},p.address[i.singleLineFieldName||"Single Line Input"]=d,i.outFields&&(p.outFields=i.outFields),async function(e,t,i){t=xM.from(t);const r=(0,yM.en)(e),{address:s,...n}=t.toJSON(),o={...s,...n,f:"json"},a=(0,yM.cv)({...r.query,...o}),l=(0,yM.lA)(a,i),c=`${r.path}/findAddressCandidates`;return(0,gM.default)(c,l).then(CM)}(m,p,{signal:_}).then((e=>NM(e,{key:w,scale:g,sourceIndex:a,view:n,zoomScale:l,defaultZoomScale:c})))}(e,t)}({source:this,...e},t),this.getSuggestions=(e,t)=>function(e,t){const{source:i,spatialReference:r,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a}=e,l=new RM,{apiKey:c,url:u}=i,h=DM(i,s),d=t&&t.signal;if(!u)return Promise.resolve(null);c&&(l.apiKey=c),i.categories&&(l.categories=i.categories),r&&(l.outSpatialReference=r);const p=IM(s,i);if(p&&(l.location=p),!n.trim())return Promise.resolve(null);const{prefix:f="",suffix:m=""}=i,g=`${f}${n}${m}`;return l.text=g,h&&(l.searchExtent=(0,I.Wg)(h)),l.maxSuggestions=o,i.countryCode&&(l.countryCode=i.countryCode),async function(e,t,i){const r=(0,yM.en)(e),s={...(t=RM.from(t)).toJSON(),f:"json"},n=(0,yM.cv)({...r.query,...s}),o=(0,yM.lA)(n,i),a=`${r.path}/suggest`;return(0,gM.default)(a,o).then(PM)}(u,l,{signal:d}).then((e=>function(e,t){return e.map((e=>function(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}(e,t)))}(e,a)))}({source:this,...e},t)}clone(){return new FM({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,u.d9)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?(0,u.d9)(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};(0,t._)([(0,m.Cb)()],kM.prototype,"apiKey",void 0),(0,t._)([(0,m.Cb)()],kM.prototype,"categories",void 0),(0,t._)([(0,m.Cb)()],kM.prototype,"countryCode",void 0),(0,t._)([(0,m.Cb)({json:{write:!0}})],kM.prototype,"defaultZoomScale",void 0),(0,t._)([(0,m.Cb)()],kM.prototype,"localSearchDisabled",void 0),(0,t._)([(0,m.Cb)()],kM.prototype,"locationType",void 0),(0,t._)([(0,m.Cb)({json:{write:!0}})],kM.prototype,"name",void 0),(0,t._)([(0,m.Cb)({json:{write:!0}})],kM.prototype,"placeholder",void 0),(0,t._)([(0,m.Cb)()],kM.prototype,"searchTemplate",void 0),(0,t._)([(0,m.Cb)({json:{write:!0}})],kM.prototype,"singleLineFieldName",void 0),(0,t._)([(0,m.Cb)({json:{read:{source:"suggest"},write:{target:"suggest"}}})],kM.prototype,"suggestionsEnabled",void 0),(0,t._)([(0,m.Cb)({json:{write:!0}})],kM.prototype,"url",void 0),(0,t._)([(0,m.Cb)({json:{write:!0}})],kM.prototype,"zoomScale",void 0),kM=FM=(0,t._)([(0,y.j)("esri.widgets.Search.LocatorSearchSource")],kM);const UM=kM;s(74304);var VM=s(90819),zM=s(25709);new zM.X({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"}),new zM.X({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});let BM=class extends c.wq{constructor(e){super(e),this.deviationUnit=null,this.geometries=null,this.maxDeviation=null}};(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],BM.prototype,"deviationUnit",void 0),(0,t._)([(0,m.Cb)({json:{read:{reader:e=>e?e.map((e=>(0,ie.im)(e))):null},write:{writer:(e,t)=>{t.geometries=e.map((e=>e.toJSON()))}}}})],BM.prototype,"geometries",void 0),(0,t._)([(0,m.Cb)({type:Number,json:{write:!0}})],BM.prototype,"maxDeviation",void 0),BM=(0,t._)([(0,y.j)("esri.rest.support.GeneralizeParameters")],BM),BM.from=(0,g.se)(BM),new zM.X({preserveShape:"preserve-shape"});let HM=class extends c.wq{constructor(e){super(e),this.calculationType=null,this.geodesic=null,this.lengthUnit=null,this.polylines=null}};(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],HM.prototype,"calculationType",void 0),(0,t._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],HM.prototype,"geodesic",void 0),(0,t._)([(0,m.Cb)({json:{write:!0}})],HM.prototype,"lengthUnit",void 0),(0,t._)([(0,m.Cb)({type:[VM.Z],json:{read:{reader:e=>e?e.map((e=>(0,ie.im)(e))):null},write:{writer:(e,t)=>{t.polylines=e.map((e=>e.toJSON()))}}}})],HM.prototype,"polylines",void 0),HM=(0,t._)([(0,y.j)("esri.rest.support.LengthsParameters")],HM),HM.from=(0,g.se)(HM),new zM.X({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"}),new zM.X({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});let jM=class extends c.wq{constructor(e){super(e),this.bevelRatio=null,this.geometries=null,this.offsetDistance=null,this.offsetHow=null,this.offsetUnit=null}};(0,t._)([(0,m.Cb)({type:Number,json:{write:!0}})],jM.prototype,"bevelRatio",void 0),(0,t._)([(0,m.Cb)({json:{read:{reader:e=>e?e.map((e=>(0,ie.im)(e))):null},write:{writer:(e,t)=>{t.geometries=e.map((e=>e.toJSON()))}}}})],jM.prototype,"geometries",void 0),(0,t._)([(0,m.Cb)({type:Number,json:{write:!0}})],jM.prototype,"offsetDistance",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],jM.prototype,"offsetHow",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],jM.prototype,"offsetUnit",void 0),jM=(0,t._)([(0,y.j)("esri.rest.support.OffsetParameters")],jM),jM.from=(0,g.se)(jM),new zM.X({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});let GM=class extends c.wq{constructor(e){super(e),this.geometries1=null,this.geometries2=null,this.relation=null,this.relationParameter=null}};(0,t._)([(0,m.Cb)({json:{read:{reader:e=>e?e.map((e=>(0,ie.im)(e))):null},write:{writer:(e,t)=>{t.geometries1=e.map((e=>e.toJSON()))}}}})],GM.prototype,"geometries1",void 0),(0,t._)([(0,m.Cb)({json:{read:{reader:e=>e?e.map((e=>(0,ie.im)(e))):null},write:{writer:(e,t)=>{t.geometries2=e.map((e=>e.toJSON()))}}}})],GM.prototype,"geometries2",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],GM.prototype,"relation",void 0),(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],GM.prototype,"relationParameter",void 0),GM=(0,t._)([(0,y.j)("esri.rest.support.RelationParameters")],GM),GM.from=(0,g.se)(GM),new zM.X({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});let WM=class extends c.wq{constructor(e){super(e),this.extendHow="default-curve-extension",this.polylines=null,this.trimExtendTo=null}};(0,t._)([(0,m.Cb)({type:String,json:{write:!0}})],WM.prototype,"extendHow",void 0),(0,t._)([(0,m.Cb)({type:[VM.Z],json:{read:{reader:e=>e?e.map((e=>(0,ie.im)(e))):null},write:{writer:(e,t)=>{t.polylines=e.map((e=>e.toJSON()))}}}})],WM.prototype,"polylines",void 0),(0,t._)([(0,m.Cb)({json:{read:{reader:e=>e?(0,ie.im)(e):null},write:{writer:(e,t)=>{t.trimExtendTo=e.toJSON()}}}})],WM.prototype,"trimExtendTo",void 0),WM=(0,t._)([(0,y.j)("esri.rest.support.TrimExtendParameters")],WM),WM.from=(0,g.se)(WM);const ZM=p.Z.getLogger("esri.widgets.support.geolocationUtils"),qM={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function $M(){return function(){const e=(0,b.Z)("esri-geolocation");return e||ZM.warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=window.isSecureContext;return e||ZM.warn("insecure-context","Geolocation requires a secure origin."),e}()}var YM=s(86036),XM=s(15498),JM=s(43411),KM=s(27624);function QM(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const eO="esri.widgets.Search.SearchViewModel",tO=p.Z.getLogger(eO),iO="highlight",rO=n.Z.ofType({key:e=>e.layer?"layer":"locator",base:GA,typeMap:{layer:mM,locator:UM}}),sO=qe.Z.WGS84,nO=/<(?:.|\s)*?>/g,oO=-1;let aO=class extends((0,BE._)(P.Z.EventedMixin(O.Z))){constructor(e){super(e),this._handles=new Ae.Z,this._gotoController=null,this._searching=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new rO,this.defaultSymbols={point:new YM.Z({url:(0,mn.V)("esri/images/search/search-symbol-32.png"),size:24,width:24,height:24}),polyline:new XM.Z({color:[130,130,130,1],width:2}),polygon:new JM.Z({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=BA.Z.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new rO,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await(0,zA.ME)("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new NA.Z({title:e.searchResult,content:"{Match_addr}"})};e(),this._handles.add([(0,he.YP)((()=>[this.includeDefaultSources,this.view,this.portal]),(()=>this._update()),he.nn),(0,VA.qe)(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics(),this._handles.destroy(),this._handles=null}get activeSource(){return this.allSources.getItemAt(this.activeSourceIndex)||null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?oO:0}set activeSourceIndex(e){void 0!==e?this._override("activeSourceIndex",e):this._clearOverride("activeSourceIndex")}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(e){e?this._override("allPlaceholder",e):this._clearOverride("allPlaceholder")}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:i}=this,r="function"==typeof i?i.call(null,{sources:e,defaultSources:t}):i?t.concat(e):e,s=this._get("allSources")||new rO;return s.removeAll(),s.addMany(r.filter(Boolean)),s}get defaultSymbol(){return(0,UA.Mr)(tO,"defaultSymbol",{replacement:"defaultSymbols",version:"4.22"}),this._get("defaultSymbol")}set defaultSymbol(e){(0,UA.Mr)(tO,"defaultSymbol",{replacement:"defaultSymbols",version:"4.22"}),this._set("defaultSymbol",e)}get locationEnabled(){return this._get("locationEnabled")||$M()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=$M();if(e&&!t){const e=new l.Z("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});tO.error(e)}this._override("locationEnabled",e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:i}=this;if(t===oO)return i;const r=e.getItemAt(t);return r?r.placeholder:""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup(),this.view&&this.view.graphics.remove(this.resultGraphic),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const i=this._createSuggestionForSearch(e),r=this.when().then((()=>this._getResultsFromSources(i,t).then((e=>{if((0,I.Wg)(t?.signal)?.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:i.text,numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(r,e,i);const s=this._getFirstResult(r.results),n=(i.location&&s?s.name:i.text).replace(nO,"");return this._set("searchTerm",n),(i.key&&"number"==typeof i.sourceIndex||i.location)&&this._set("selectedSuggestion",i),this._set("results",r.results),this._set("resultCount",r.results.reduce(((e,t)=>e+t.results.length),0)),this.emit("search-complete",r),this._selectFirstResult(s).then((()=>r))})))).then((e=>(this._clearSearching(),e)),(e=>{throw this._clearSearching(),e}));return this._searching=r,r}searchNearby(e){if(!this.locationEnabled){const e=new l.Z("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});return tO.error(e),Promise.reject(e)}const t=function(e){return e||(e=qM),new Promise(((t,i)=>{setTimeout((()=>i(new l.Z("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(t,i,e)}))}().then((t=>function(e,t){const{position:i,view:r}=e;return function(e,t,i){if(!t)return Promise.resolve(e);const r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve((0,gu.$)(e)):function(e){if(N.Z.geometryServiceUrl)return Promise.resolve(N.Z.geometryServiceUrl);const t=BA.Z.getDefault();return t.load(e).catch((()=>{})).then((()=>t.get("helperServices.geometry.url")))}(i).then((t=>{if(!t)throw new l.Z("geometry-service:missing-url","Geometry service URL is missing");const s=new _g.Z({geometries:[e],outSpatialReference:r});return(0,yg.i)(t,s,i).then((e=>e[0]))}))}(function(e){const t=e&&e.coords;return t?new X.Z({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}}):null}(function(e){const t=e&&e.coords||{},i={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e?{coords:i,timestamp:e.timestamp}:e}(i)),r,t)}({position:t,view:this.view},e))).then((t=>this.search(t,e)));return this._searching=t,t.catch((()=>{})).then((()=>this._clearSearching())),t}select(e){if(this.clearGraphics(),!e){const t=new l.Z("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});return tO.error(t),Promise.reject(t)}const{view:t}=this,i=QM(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),r=this.allSources.getItemAt(i);if(!r){const e=new l.Z("select:missing-source","Cannot select without a source.",{source:r});return tO.error(e),Promise.reject(e)}const s=r instanceof mM?this._getLayerSourcePopupTemplate(r):r.popupTemplate,n=r.resultSymbol||this._getDefaultSymbol(e),o=QM(r,"resultGraphicEnabled")?r.resultGraphicEnabled:this.resultGraphicEnabled,a=QM(r,"autoNavigate")?r.autoNavigate:this.autoNavigate,c=QM(r,"popupEnabled")?r.popupEnabled:this.popupEnabled,u=c?s||this.popupTemplate||this.defaultPopupTemplate:null,{feature:h}=e;if(!h){const e=new l.Z("select:missing-feature","Cannot select without a feature.",{feature:h});return tO.error(e),Promise.reject(e)}const{attributes:d,geometry:p,layer:m,sourceLayer:g}=h,y=qA(p),_={layerViewQuery:this._getLayerView(h),elevationQuery:t&&(0,I.pC)(y)?ZA(y,t).catch((()=>y)):Promise.resolve(y)};return(0,f.as)(_).then((s=>{const l=s.layerViewQuery.value,f=s.elevationQuery.value;n instanceof KM.Z&&(n.text=e.name);const y=t&&a?e.target||e.extent:null;return((0,I.pC)(y)?this._goToSearchResult(y):Promise.resolve()).then((()=>{const s=l?h:new te.Z({geometry:p,symbol:n,attributes:d,layer:m,sourceLayer:g,popupTemplate:u}),a=c&&this.view?.popup,y=a&&s.getEffectivePopupTemplate(a.defaultPopupTemplateEnabled);return y&&t.popup.open({features:[s],location:f}),l&&(0,pE.tl)(l)&&!y&&this._highlightFeature({graphic:s,layerView:l}),!l&&o&&t&&t.graphics.push(s),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",s),this.emit("select-result",{result:e,source:r,sourceIndex:i}),e}))}))}suggest(e,t,i){const r=e||this.searchTerm;return this.emit("suggest-start",{searchTerm:r}),this._suggestTimer(t,i).then((()=>this._suggestImmediate(r,i).then((e=>(this._set("suggestions",e.results),this._set("suggestionCount",e.results.reduce(((e,t)=>e+t.results.length),0)),this.emit("suggest-complete",e),e)))))}async when(){await(0,he.N1)((()=>!this.updating))}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const i=this._updatingPromise=(0,f.as)([e?.load(),t?.when()]);if(this.destroyed)return;if(await i,i!==this._updatingPromise)return}await(0,he.N1)((()=>this.messages)),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){const e=this.portal?.helperServices?.geocode;return e?e.map((e=>{if(!1===e.placefinding)return;const t=N.Z.apiKey&&LM(e.url)?{url:"https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer"}:null,i=UM.fromJSON({...e,...t}),r=i.url;if(LM(r)||function(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}(r)||function(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}(r)){const e=i.outFields||["Addr_type","Match_addr","StAddr","City"],t=i.placeholder||this.messages.placeholder,r="number"==typeof i.defaultZoomScale?i.defaultZoomScale:2500;i.set({singleLineFieldName:"SingleLine",outFields:e,placeholder:t,defaultZoomScale:r})}return i.singleLineFieldName?i:void 0})).filter(Boolean):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach((e=>e?.destroy())),this._createdFeatureLayers=[]}_getLayerSources(e,t){const i=this.view?.map;return e.map((e=>{const r=i.findLayerById(e.id);if(!r)return;const s=this._getLayerJSON(e),n=mM.fromJSON(s);return n.placeholder=t,this._getLayer(r,s).then((e=>{n.layer=e})),n})).filter(Boolean).toArray()}_getTableSources(e,t){const i=this.view?.map;return e.map((e=>{const r=i.findTableById(e.id);if(!r)return;const s=this._getLayerJSON(e),n=mM.fromJSON(s);return n.placeholder=t,this._getLayer(r,s).then((e=>{n.layer=e})),n})).filter(Boolean).toArray()}_convertApplicationProperties(){const e=this.view?.map,t=e?.applicationProperties?.viewing?.search;if(!t)return[];const{enabled:i,hintText:r,layers:s,tables:n}=t;return i?[...this._getLayerSources(s,r),...this._getTableSources(n,r)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const i=e.allSublayers.find((e=>e.id===t.subLayer));if(!i)throw new Error;const r=await i.createFeatureLayer();return this._createdFeatureLayers.push(r),r}async _getBuildingSubLayer(e,t){await e.load();const i=e.allSublayers.find((e=>e.id===t.subLayer));if("building-component"!==i?.type)throw new Error;if(await i.load(),null==i.associatedLayer)throw new Error;return await i.associatedLayer.load(),i}_getLayer(e,t){return"feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type?Promise.resolve(e):"map-image"===e.type?this._getSubLayer(e,t).catch((()=>{const t=new l.Z("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return tO.error(t),null})):"building-scene"===e.type?this._getBuildingSubLayer(e,t):Promise.resolve(null)}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){const e=this.view?.popup,{resultGraphic:t}=this;if(!e||!t)return;const{selectedFeature:i}=e;i&&i===t&&e.close()}_suggestTimer(e,t){const i=null!=e?e:this.suggestionDelay;return(0,f.e4)(i,null,t&&t.signal)}_createLocationForSearch(e){return e instanceof te.Z?qA(e.geometry):e instanceof X.Z?e:Array.isArray(e)&&2===e.length?new X.Z({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&QM(e,"key")&&QM(e,"text")&&QM(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),i="string"==typeof e?e:this.searchTerm,{selectedSuggestion:r,selectedResult:s}=this,n=!e&&r&&s,o=n&&r.key===s.key&&r.sourceIndex===s.sourceIndex,a=n&&r.location;return o||a?r:{location:(0,I.Wg)(t),text:t?"":i,sourceIndex:null,key:null}}_getFirstResult(e){let t=null;return e&&e.some((e=>{const{results:i}=e,r=i[0],s=!!r;return s&&(t=r),s})),t}_selectFirstResult(e){return this.autoSelect&&e?this.select(e):Promise.resolve(null)}_suggestImmediate(e,t){return this.when().then((()=>this._getSuggestionsFromSources(e,t))).then((i=>{if((0,I.Wg)(t?.signal)?.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:e,numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(r,i),r}))}_formatSourceResponse(e,t,i){const r=t&&t.value||[],s=t&&t.error,n=this.allSources.getItemAt(i);if(s){const t={sourceIndex:i,source:n,error:s};e.errors.push(t),tO.error(s),e.numErrors++}else{const t={sourceIndex:i,source:n,results:r};e.results.push(t),e.numResults+=r.length}}_formatResponse(e,t,i){if(t)if(e.activeSourceIndex===oO){const r=i&&QM(i,"sourceIndex")&&-1!==i.sourceIndex?i.sourceIndex:void 0;t.forEach(((t,i)=>{const s=void 0!==r?r:i;this._formatSourceResponse(e,t,s)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}_getResultsFromSources(e,t){const{allSources:i}=this,r=!e.location&&QM(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,s=[];if(!i.length){const e=new l.Z("search:no-sources-defined","At least one source is required.",{allSources:i});return tO.error(e),Promise.reject(e)}return r===oO?i.forEach(((i,r)=>{s.push(this._getResultsFromSource(e,r,t))})):s.push(this._getResultsFromSource(e,r,t)),(0,f.as)(s)}_getSuggestionsFromSources(e,t){const{allSources:i,activeSourceIndex:r}=this,s=[];if(!i.length){const e=new l.Z("suggest:no-sources-defined","At least one source is required.",{allSources:i});return tO.error(e),Promise.reject(e)}return r===oO?i.forEach(((i,r)=>{s.push(this._getSuggestionsFromSource(e,r,t))})):s.push(this._getSuggestionsFromSource(e,r,t)),(0,f.as)(s)}_getResultsFromSource(e,t,i){const r=this.allSources.getItemAt(t),{location:s=null}=e,n=this.view?.spatialReference||sO,o=QM(r,"maxResults")?r.maxResults:this.maxResults,a=!!(r instanceof mM&&QM(r,"exactMatch"))&&r.exactMatch,{view:l}=this;return r.getResults({view:l,sourceIndex:t,location:s,suggestResult:e,spatialReference:n,exactMatch:a,maxResults:o},i)}_getSuggestionsFromSource(e,t,i){const r=this.allSources.getItemAt(t),s=QM(r,"suggestionsEnabled")?r.suggestionsEnabled:this.suggestionsEnabled,n=e.length,o=QM(r,"minSuggestCharacters")?r.minSuggestCharacters:this.minSuggestCharacters;if(s&&e.trim()&&n>=o){const s=this.view?.spatialReference||sO,n=QM(r,"maxSuggestions")?r.maxSuggestions:this.maxSuggestions,{view:o}=this,a=!!(r instanceof mM&&QM(r,"exactMatch"))&&r.exactMatch;return r.getSuggestions({view:o,sourceIndex:t,suggestTerm:e,spatialReference:s,maxSuggestions:n,exactMatch:a},i)}return Promise.resolve(null)}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return QM(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){const t=this.results;let i=null;return t.some((t=>t.results.some((r=>r===e&&(i=t.sourceIndex,!0))))),i}async _goToSearchResult(e){const t=!!e;this._abortGoTo();const i=new AbortController;this._gotoController=i;const r={target:{target:e},options:{animate:t,signal:i.signal}};await this.callGoTo(r),this._gotoController=null}_getDefaultSymbol(e){const{defaultSymbols:t}=this,i=e.feature?.geometry;if((0,I.Wi)(i))return null;const r=this._get("defaultSymbol");if(r&&("point"===i.type||"multipoint"===i.type))return r;switch(i.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this._handles.remove(iO)}async _getLayerView(e){const{view:t}=this;if(!e||!t||"building-component"===e.layer.type||"subtype-sublayer"===e.layer.type)return null;const{layer:i}=e;return await t.when(),t.whenLayerView(i)}_highlightFeature(e){const{graphic:t,layerView:i}=e,{attributes:r,layer:s}=t,{objectIdField:n}=s,o=r&&r[n],a=i.highlight(o||t);this._handles.add(a,iO)}_setResultFloor(e){const{view:t}=this,i=e.feature?.attributes,r=e.feature?.sourceLayer;if(r&&"floorInfo"in r&&r?.floorInfo?.floorField&&i){const e=i[r.floorInfo.floorField];t.emit("select-result-floor",e)}}};aO.ALL_INDEX=oO,(0,t._)([(0,m.Cb)()],aO.prototype,"_searching",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"_updatingPromise",void 0),(0,t._)([(0,m.Cb)({readOnly:!0,value:null})],aO.prototype,"activeSource",null),(0,t._)([(0,m.Cb)()],aO.prototype,"activeSourceIndex",null),(0,t._)([(0,m.Cb)()],aO.prototype,"allPlaceholder",null),(0,t._)([(0,m.Cb)({readOnly:!0})],aO.prototype,"allSources",null),(0,t._)([(0,m.Cb)()],aO.prototype,"autoNavigate",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"autoSelect",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"defaultPopupTemplate",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aO.prototype,"defaultSources",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"defaultSymbol",null),(0,t._)([(0,m.Cb)()],aO.prototype,"defaultSymbols",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"includeDefaultSources",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"locationEnabled",null),(0,t._)([(0,m.Cb)()],aO.prototype,"maxInputLength",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"maxResults",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"maxSuggestions",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"messages",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"minSuggestCharacters",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aO.prototype,"placeholder",null),(0,t._)([(0,m.Cb)()],aO.prototype,"popupEnabled",void 0),(0,t._)([(0,m.Cb)({type:NA.Z})],aO.prototype,"popupTemplate",void 0),(0,t._)([(0,m.Cb)({type:BA.Z})],aO.prototype,"portal",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"resultCount",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"resultGraphicEnabled",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aO.prototype,"resultGraphic",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aO.prototype,"results",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aO.prototype,"selectedSuggestion",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"searchAllEnabled",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aO.prototype,"selectedResult",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"searchTerm",null),(0,t._)([(0,m.Cb)({type:rO})],aO.prototype,"sources",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aO.prototype,"state",null),(0,t._)([(0,m.Cb)()],aO.prototype,"suggestionDelay",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"suggestionCount",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aO.prototype,"suggestions",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"suggestionsEnabled",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],aO.prototype,"updating",null),(0,t._)([(0,m.Cb)()],aO.prototype,"view",void 0),(0,t._)([(0,m.Cb)()],aO.prototype,"clear",null),aO=(0,t._)([(0,y.j)(eO)],aO);const lO=aO,cO="esri-widget__anchor",uO="esri-search-result-renderer__more-results-item";let hO=class extends RE.Z{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}render(){const e={"esri-search-result-renderer__more-results--show-more-results":this.showMoreResultsOpen};return(0,UE.u)("div",{class:"esri-search-result-renderer esri-widget"},(0,UE.u)("div",{key:"esri-search-renderer__container",class:this.classes("esri-search-result-renderer__more-results",e)},this.renderSearchResultName(),this.renderMoreResults()))}renderMoreResults(){return(0,UE.u)("div",{key:"esri-search-renderer__more-results"},this.renderMoreResultsButton(),this.renderMoreResultsLists())}renderSearchResultName(){const e=this.viewModel?.selectedResult,t=e&&e.name||"";return(0,UE.u)("div",{key:"esri-search-renderer__result-name",class:uO},t)}renderMoreResultsLists(){const e=this.viewModel?.results,{resultCount:t}=this.viewModel;if(t<2)return null;const i=e.map((e=>this.renderMoreResultsList(e)));return(0,UE.u)("div",{key:"esri-search-renderer__more-results-container",class:"esri-search-result-renderer__more-results-list"},i)}renderMoreResultsButton(){const{messages:e}=this,{resultCount:t}=this.viewModel;return t<2?null:(0,UE.u)("div",{key:"esri-search-renderer__more-results-button",class:uO},(0,UE.u)("a",{class:cO,href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults))}renderMoreResultsHeader(e,t){return(0,UE.u)("div",{key:`esri-search-result-renderer__header-${t}`,class:"esri-search-result-renderer__more-results-list-header"},e)}renderMoreResultsList(e){const{results:t}=e,i=t.length,r=!!i,s=this.viewModel?.selectedResult,n=1===i&&t[0]===s,o=this._getSourceName(e.source,e.sourceIndex),a=this.viewModel?.results.length>1&&!n?this.renderMoreResultsHeader(o,e.sourceIndex):null,l=r&&t.map(((e,t)=>this.renderMoreResultsListItem(e,t))),c=r&&!n?(0,UE.u)("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},l):null;return r?(0,UE.u)("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},a,c):null}renderMoreResultsListItem(e,t){return e!==this.get("viewModel.selectedResult")?(0,UE.u)("li",{key:`esri-search-result-renderer__list-item-${t}`},(0,UE.u)("a",{class:cO,href:"#",tabindex:"0",bind:this,"data-result":e,onclick:this._selectResultClick,onkeydown:this._selectResultClick},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=this.get("viewModel.view.popup");t&&t.reposition()}_selectResultClick(e){e.preventDefault();const t=e.currentTarget["data-result"];this.viewModel&&this.viewModel.select(t)}_getSourceName(e,t){return t===lO.ALL_INDEX?this.messages.all:e.name}};(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/widgets/Search/t9n/Search")],hO.prototype,"messages",void 0),(0,t._)([(0,m.Cb)()],hO.prototype,"showMoreResultsOpen",void 0),(0,t._)([(0,m.Cb)()],hO.prototype,"viewModel",void 0),(0,t._)([(0,FE.h)()],hO.prototype,"_showMoreResultsClick",null),(0,t._)([(0,FE.h)()],hO.prototype,"_selectResultClick",null),hO=(0,t._)([(0,y.j)("esri.widgets.Search.SearchResultRenderer")],hO);const dO=hO;var pO=s(31071);const fO="esri-search__suggestions-list",mO="esri-search__no-value-text",gO="esri-widget--button",yO="esri-menu",_O="esri-menu__list",vO="esri-menu__list-item",bO="esri-menu__list-item--focus",wO="esri-icon-notice-triangle",xO=/<[a-z/][\s\S]*>/i;let CO=class extends RE.Z{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._handles=new Ae.Z,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new dO,this._locateFailed=null,this._container=null,this.activeMenu="none",this.activeSource=null,this.activeSourceIndex=null,this.allPlaceholder=null,this.allSources=null,this.autoNavigate=null,this.autoSelect=null,this.defaultSources=null,this.disabled=!1,this.goToOverride=null,this.iconClass="esri-icon-search",this.includeDefaultSources=null,this.label=void 0,this.locationEnabled=null,this.maxResults=null,this.maxSuggestions=null,this.messages=null,this.messagesCommon=null,this.minSuggestCharacters=null,this.popupEnabled=null,this.popupTemplate=null,this.portal=null,this.resultGraphic=null,this.resultGraphicEnabled=null,this.results=null,this.searchAllEnabled=null,this.searchTerm=null,this.selectedResult=null,this.sources=null,this.suggestions=null,this.suggestionsEnabled=null,this.view=null,this.viewModel=new lO,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=e=>{const t=e.relatedTarget;t&&this._container?.contains(t)||this._clearActiveMenu()},this.own([(0,he.YP)((()=>this.searchTerm),(e=>{(e&&"warning"===this.activeMenu||!e&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu()})),(0,he.on)((()=>this.viewModel?.allSources),"change",(()=>this._watchSourceChanges())),(0,he.YP)((()=>this.activeMenu),(()=>this._resetActiveMenuItemIndex()),he.nn),(0,he.YP)((()=>this.viewModel?.defaultPopupTemplate),(e=>{e&&(e.content=this._renderSearchResultsContent.bind(this))}),he.nn)])}destroy(){this._handles.destroy(),this._handles=null,this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}clear(){}focus(){this._inputNode?.focus(),this.emit("search-focus")}blur(){this._inputNode?.blur(),this.emit("search-blur")}search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:i}=t;return this._searchController=t,this.viewModel.search(e,{signal:i}).catch((e=>{if(this._searchController===t)return this._clearActiveMenu(),this._searchController=null,e})).then((e=>{if(this._searchController===t)return this.activeMenu=e.numResults?"none":"warning",this._searchController=null,e}))}suggest(e){this._cancelSuggest();const t=new AbortController,{signal:i}=t;return this._suggestController=t,this.viewModel.suggest(e,null,{signal:i}).then((e=>{if(this._suggestController===t)return this._suggestController=null,e.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),e})).catch((()=>{if(this._suggestController===t)return this._suggestController=null,null}))}render(){const{state:e}=this.viewModel,t={"esri-disabled":"disabled"===e,"esri-widget--disabled":this.disabled};return(0,UE.u)("div",{class:this.classes("esri-search esri-widget",t)},"loading"===e?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:e,disabled:t}=this;return(0,UE.u)("button",{"aria-label":e.searchButtonTitle,bind:this,disabled:t,class:this.classes("esri-search__submit-button",gO),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle,type:"button"},(0,UE.u)("span",{"aria-hidden":"true",class:"esri-icon-search"}))}renderWarningMenu(){return(0,UE.u)("div",{key:"esri-search__error-menu",class:this.classes(yO,"esri-search__warning-menu")},(0,UE.u)("div",{class:"esri-search__warning-body"},this.renderWarning()))}renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:i,sourceMenuButtonId:r,disabled:s}=this,{activeSourceIndex:n,allSources:o}=this.viewModel;return o.length>1?(0,UE.u)("button",{id:r,key:"esri-search__source-menu-button",bind:this,disabled:s,"aria-label":e.searchIn,title:e.searchIn,"aria-haspopup":"true","aria-expanded":("source"===t).toString(),"aria-controls":i,class:this.classes("esri-search__sources-button",gO),onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,afterCreate:vE.Yo,"data-node-ref":"_sourceMenuButtonNode",type:"button"},(0,UE.u)("span",{"aria-hidden":"true",class:"esri-icon-down-arrow esri-search__sources-button--down"}),(0,UE.u)("span",{"aria-hidden":"true",class:"esri-icon-up-arrow esri-search__sources-button--up"}),(0,UE.u)("span",{class:"esri-search__source-name"},this._getSourceName(n))):null}renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:i,activeMenu:r,sourceMenuId:s,sourceMenuButtonId:n}=this,o="source"===r&&i>-1?this._buildId("source-item",i):null;return e.length>1?(0,UE.u)("ul",{"aria-activedescendant":o,"aria-labelledby":n,id:s,role:"menu",bind:this,afterCreate:vE.Yo,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:_O,tabIndex:-1},t?this.renderSource(lO.ALL_INDEX):null,e.map(((e,t)=>this.renderSource(t))).toArray()):null}renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?(0,UE.u)("div",{key:"esri-search__source-menu",class:this.classes(yO,"esri-search__sources-menu")},this.renderSourcesList()):null}renderLoader(){const{messages:e,messagesCommon:t,disabled:i}=this;return(0,UE.u)("div",{class:"esri-widget__loader",key:"base-loader",tabIndex:i?-1:null},(0,UE.u)("span",{"aria-hidden":"true",class:"esri-widget__loader-animation"}),(0,UE.u)("span",{class:"esri-icon-font-fallback-text"},e.searchButtonTitle),(0,UE.u)("span",{class:"esri-widget__loader-text"},t.loading))}renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:i}=this,r={"esri-search--multiple-sources":e.length>1,"esri-search--loading":"loading"===t,"esri-search--searching":"searching"===t,"esri-search--warning":"warning"===i,"esri-search--sources":"source"===i,"esri-search--show-suggestions":"suggestion"===i};return(0,UE.u)("div",{tabIndex:-1,afterCreate:e=>{this._container=e,e.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:e=>{e.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(r,"esri-search__container"),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?(0,UE.u)("button",{bind:this,disabled:this.disabled,class:this.classes("esri-search__clear-button",gO),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},(0,UE.u)("span",{"aria-hidden":"true",class:"esri-icon-close"})):null}renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:i}=this,r=t&&!i,s="suggestion"===this.activeMenu&&0===this._activeMenuItemIndex;return r?(0,UE.u)("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes(_O,fO,"esri-search__suggestions-list--current-location")},(0,UE.u)("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":("suggestion"===this.activeMenu&&0===this._activeMenuItemIndex).toString(),role:"option",class:this.classes(vO,s?bO:null)},(0,UE.u)("span",{"aria-hidden":"true",class:"esri-icon-locate-circled"})," ",e.useCurrentLocation)):null}renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:i,messages:r,suggestionsMenuId:s,inputId:n,_activeMenuItemIndex:o,disabled:a}=this,{maxInputLength:l,placeholder:c,searchTerm:u,suggestionCount:h}=this.viewModel,d=!((!t||i)&&!h),p="suggestion"===e&&o>-1?this._buildId("suggestion-item",o):null;return(0,UE.u)("input",{"aria-activedescendant":p,"aria-autocomplete":"list","aria-expanded":(d&&"suggestion"===e).toString(),"aria-controls":d?s:null,"aria-haspopup":"listbox","aria-label":r.searchButtonTitle,bind:this,disabled:a,placeholder:c,maxlength:l,autocomplete:"off",type:"text",class:this.classes("esri-input","esri-search__input"),value:u,id:n,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:vE.Yo,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:u?"":c})}renderForm(){return(0,UE.u)("form",{key:"esri-search__form",bind:this,disabled:this.disabled,class:"esri-search__form",onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(e){const{sourceIndex:t}=e,i=e.results.length,r=e.results;return i?(0,UE.u)("ul",{role:"group",key:`esri-search__suggestion-list-${t}`,class:this.classes(_O,fO)},r.map((e=>this.renderSuggestion(e,this._menuItemCount++)))):null}renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map((e=>[this.renderSuggestionHeader(e),this.renderSuggestList(e)])):null}renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:i,inputId:r}=this,{suggestionCount:s}=this.viewModel,n=t&&!e||s;return this._menuItemCount=0,n?(0,UE.u)("div",{id:i,key:"esri-search__suggestions-menu",class:this.classes(yO,"esri-search__suggestions-menu"),role:"listbox","aria-labelledby":r,bind:this,afterCreate:vE.Yo,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return(0,UE.u)("div",{key:"esri-search__input-container",class:"esri-search__input-container"},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:i}=this.viewModel,{sourceIndex:r}=e,s=e.results.length,n=t.length>1&&i===lO.ALL_INDEX;return s&&n?(0,UE.u)("div",{key:`esri-search__suggestion-header-${r}`,class:"esri-menu__header"},this._getSourceName(r)):null}renderSuggestion(e,t){const{_activeMenuItemIndex:i,messages:r}=this,{searchTerm:s}=this.viewModel;if(s){const{text:n}=e,o=n||r.untitledResult,a=xO.test(o),l=[];if(a)l.push((0,UE.u)("div",{innerHTML:o}));else{const e=this._splitResult(o,s),t=s.toLowerCase();e.forEach(((e,i)=>{e&&e.length&&(e.toLowerCase()===t?l.push((0,UE.u)("strong",{key:i},e)):l.push(e))}))}const c="suggestion"===this.activeMenu&&i===t;return(0,UE.u)("li",{bind:this,id:this._buildId("suggestion-item",t),"aria-selected":("suggestion"===this.activeMenu&&this._activeMenuItemIndex===t).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${t}`,"data-suggestion":e,role:"option",class:this.classes(vO,c?bO:null)},l)}}renderSource(e){const{activeSourceIndex:t,searchAllEnabled:i}=this.viewModel,r={"esri-menu__list-item--active":e===t,[bO]:"source"===this.activeMenu&&e===(i?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},s=i?e+1:e;return(0,UE.u)("li",{bind:this,key:`esri-search__source-${e}`,id:this._buildId("source-item",s),"aria-checked":(e===t).toString(),onclick:this._handleSourceClick,"data-source-index":e,role:"menuitemradio",class:this.classes("esri-search__source",vO,r)},this._getSourceName(e))}renderNoResultsWarning(e){const{messages:t}=this,i=e?(0,JA.n)(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return(0,UE.u)("div",{key:"esri-search__no_results"},(0,UE.u)("div",{class:"esri-search__warning-header"},t.noResults),(0,UE.u)("div",{class:"esri-search__warning-text"},i))}renderEmptySearchWarning(){const{messages:e}=this;return(0,UE.u)("div",{key:"esri-search__empty-search"},(0,UE.u)("span",{"aria-hidden":"true",class:wO}),(0,UE.u)("span",{class:mO},e.emptyValue))}renderLocateWarning(){const{messages:e}=this;return(0,UE.u)("div",{key:"esri-search__locate-error"},(0,UE.u)("span",{"aria-hidden":"true",class:wO}),(0,UE.u)("span",{class:mO},e.locateError))}renderWarning(){const{displayedSearchTerm:e,_locateFailed:t}=this,{viewModel:i}=this;return t?this.renderLocateWarning():i.selectedSuggestion?.location||e?this.renderNoResultsWarning(e):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${void 0===t?"":`-${t}`}`}_watchSourceChanges(){const{_handles:e,viewModel:{allSources:t}}=this,i="sources";e.remove(i),t.forEach((t=>e.add((0,he.YP)((()=>t.name),(()=>this.scheduleRender())),i)))}_handleSourcesMenuToggleFocus(){"source"!==this.activeMenu&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){const e="source"===this.activeMenu;this.activeMenu=e?"none":"source",this.renderNow(),"source"===this.activeMenu&&this._sourceListNode?.focus()}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=e.currentTarget["data-suggestion"];t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,this.viewModel.searchNearby({signal:t}).then((e=>{this.activeMenu=e.numResults?"none":"warning"})).catch((()=>{this._locateFailed=!0,this.activeMenu="warning"})).then((()=>{this._searchController=null}))}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){if(!e)return;const t=e["data-source-index"];this.viewModel.activeSourceIndex=t,this._clearActiveMenu(),this._sourceMenuButtonNode?.focus()}_cancelSuggest(){this._suggestController&&(this._suggestController.abort(),this._suggestController=null)}_cancelSearch(){this._searchController&&(this._searchController.abort(),this._searchController=null),this._locateFailed=!1}_handleInputKeyup(e){const t=(0,ae.kK)(e);if(e.ctrlKey||e.metaKey||"Copy"===t||"ArrowLeft"===t||"ArrowRight"===t||"Shift"===t)return;if("Tab"===t||"Escape"===t||e.shiftKey&&"Tab"===t)return this._cancelSuggest(),void("Escape"===t&&this._clearActiveMenu());const i="Home"===t||"End"===t||"ArrowUp"===t||"ArrowDown"===t;if("Enter"===t&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const r=this._suggestionListNode?.getElementsByTagName("li");if(r?.length){if("suggestion"!==this.activeMenu&&this._openSuggestionMenu(),i)return e.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(t,r,this._suggestionListNode);const s=r[this._activeMenuItemIndex];if("Enter"===t&&s){const e=s["data-suggestion"];return void(e?(this._focus(),this.search(e)):s["data-current-location-item"]&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(e,t,i){const r=this._activeMenuItemIndex;"Home"===e&&(this._activeMenuItemIndex=0),"End"===e&&(this._activeMenuItemIndex=t.length-1),"ArrowUp"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),"ArrowDown"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),r!==this._activeMenuItemIndex&&(0,vE._q)(t[this._activeMenuItemIndex],i)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const t=(0,ae.kK)(e);if((0,vE.pf)(t)){e.preventDefault();const t=this._sourceListNode.getElementsByTagName("li")[this._activeMenuItemIndex];this._setSourceFromMenuItem(t)}else"ArrowUp"!==t&&"ArrowDown"!==t&&"End"!==t&&"Home"!==t||e.preventDefault()}_handleSourceMenuKeyup(e){const t=(0,ae.kK)(e),i="ArrowUp"===t||"ArrowDown"===t||"End"===t||"Home"===t;if(i&&e.preventDefault(),"Escape"===t)return this._clearActiveMenu(),void this._sourceMenuButtonNode?.focus();const r=this._sourceListNode?.getElementsByTagName("li");return r&&0!==r.length&&i?("source"!==this.activeMenu&&(this.activeMenu="source"),void this._handleItemNavigation(t,r,this._sourceListNode.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),-1===this._activeMenuItemIndex&&this.search()}_getSourceName(e){const{messages:t}=this,i=this.viewModel,{allSources:r}=i,s=r.getItemAt(e);return e===lO.ALL_INDEX?t.all:s&&s.name||t.untitledSource}_splitResult(e,t){const i=(0,kA.Qs)(t);return e.replace(new RegExp(`(^|)(${i})(|$)`,"ig"),"$1|$2|$3").split("|")}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};(0,t._)([(0,m.Cb)()],CO.prototype,"_activeMenuItemIndex",void 0),(0,t._)([(0,m.Cb)()],CO.prototype,"displayedSearchTerm",null),(0,t._)([(0,m.Cb)({readOnly:!0})],CO.prototype,"inputId",null),(0,t._)([(0,m.Cb)({readOnly:!0})],CO.prototype,"suggestionsMenuId",null),(0,t._)([(0,m.Cb)({readOnly:!0})],CO.prototype,"sourceMenuId",null),(0,t._)([(0,m.Cb)({readOnly:!0})],CO.prototype,"sourceMenuButtonId",null),(0,t._)([(0,m.Cb)()],CO.prototype,"activeMenu",void 0),(0,t._)([(0,We.B)("viewModel.activeSource")],CO.prototype,"activeSource",void 0),(0,t._)([(0,We.B)("viewModel.activeSourceIndex")],CO.prototype,"activeSourceIndex",void 0),(0,t._)([(0,We.B)("viewModel.allPlaceholder")],CO.prototype,"allPlaceholder",void 0),(0,t._)([(0,We.B)("viewModel.allSources")],CO.prototype,"allSources",void 0),(0,t._)([(0,We.B)("viewModel.autoNavigate")],CO.prototype,"autoNavigate",void 0),(0,t._)([(0,We.B)("viewModel.autoSelect")],CO.prototype,"autoSelect",void 0),(0,t._)([(0,We.B)("viewModel.defaultSources")],CO.prototype,"defaultSources",void 0),(0,t._)([(0,m.Cb)()],CO.prototype,"disabled",void 0),(0,t._)([(0,We.B)("viewModel.goToOverride")],CO.prototype,"goToOverride",void 0),(0,t._)([(0,m.Cb)()],CO.prototype,"iconClass",void 0),(0,t._)([(0,We.B)("viewModel.includeDefaultSources")],CO.prototype,"includeDefaultSources",void 0),(0,t._)([(0,m.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],CO.prototype,"label",void 0),(0,t._)([(0,We.B)("viewModel.locationEnabled")],CO.prototype,"locationEnabled",void 0),(0,t._)([(0,We.B)("viewModel.maxResults")],CO.prototype,"maxResults",void 0),(0,t._)([(0,We.B)("viewModel.maxSuggestions")],CO.prototype,"maxSuggestions",void 0),(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/widgets/Search/t9n/Search")],CO.prototype,"messages",void 0),(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/t9n/common")],CO.prototype,"messagesCommon",void 0),(0,t._)([(0,We.B)("viewModel.minSuggestCharacters")],CO.prototype,"minSuggestCharacters",void 0),(0,t._)([(0,We.B)("viewModel.popupEnabled")],CO.prototype,"popupEnabled",void 0),(0,t._)([(0,We.B)("viewModel.popupTemplate")],CO.prototype,"popupTemplate",void 0),(0,t._)([(0,We.B)("viewModel.portal")],CO.prototype,"portal",void 0),(0,t._)([(0,We.B)("viewModel.resultGraphic")],CO.prototype,"resultGraphic",void 0),(0,t._)([(0,We.B)("viewModel.resultGraphicEnabled")],CO.prototype,"resultGraphicEnabled",void 0),(0,t._)([(0,We.B)("viewModel.results")],CO.prototype,"results",void 0),(0,t._)([(0,We.B)("viewModel.searchAllEnabled")],CO.prototype,"searchAllEnabled",void 0),(0,t._)([(0,We.B)("viewModel.searchTerm")],CO.prototype,"searchTerm",void 0),(0,t._)([(0,We.B)("viewModel.selectedResult")],CO.prototype,"selectedResult",void 0),(0,t._)([(0,We.B)("viewModel.sources")],CO.prototype,"sources",void 0),(0,t._)([(0,We.B)("viewModel.suggestions")],CO.prototype,"suggestions",void 0),(0,t._)([(0,We.B)("viewModel.suggestionsEnabled")],CO.prototype,"suggestionsEnabled",void 0),(0,t._)([(0,We.B)("viewModel.view")],CO.prototype,"view",void 0),(0,t._)([(0,pO.s)(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),(0,m.Cb)({type:lO})],CO.prototype,"viewModel",void 0),(0,t._)([(0,We.B)("viewModel.clear")],CO.prototype,"clear",null),CO=(0,t._)([(0,y.j)("esri.widgets.Search")],CO);const TO=CO;let SO=class extends((0,BE._)(P.Z.EventedAccessor)){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then((()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))}))}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){if(!this.get("view.ready"))throw new l.Z("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=new AbortController;this._goingHomeController=e;try{await this.view.when(),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch(e){}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};(0,t._)([(0,m.Cb)()],SO.prototype,"_goingHomeController",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],SO.prototype,"state",null),(0,t._)([(0,m.Cb)()],SO.prototype,"view",null),(0,t._)([(0,m.Cb)({type:ne})],SO.prototype,"viewpoint",null),(0,t._)([(0,m.Cb)()],SO.prototype,"go",null),(0,t._)([(0,m.Cb)()],SO.prototype,"cancelGo",null),SO=(0,t._)([(0,y.j)("esri.widgets.Home.HomeViewModel")],SO);const EO=SO;let AO=class extends RE.Z{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass="esri-icon-home",this.label=void 0,this.messages=null,this.messagesCommon=null,this.view=null,this.viewModel=new EO,this.viewpoint=null}get homeTitle(){const e=this.viewModel?.state,{messagesCommon:t,messages:i}=this;return"going-home"===e?t.cancel:i.title}cancelGo(){return null}go(){return null}render(){const e=this.viewModel?.state,{homeTitle:t}=this,i={"esri-disabled":"disabled"===e};return(0,UE.u)("div",{bind:this,class:this.classes("esri-home esri-widget--button esri-widget",i),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":t,title:t},this.renderIcon(),this.renderText())}renderIcon(){const e=this.viewModel?.state,t={"esri-icon-loading-indicator":"going-home"===e,"esri-rotating":"going-home"===e};return(0,UE.u)("span",{"aria-hidden":"true",class:this.classes("esri-icon esri-icon-home",t)})}renderText(){const{messages:e}=this;return(0,UE.u)("span",{class:"esri-icon-font-fallback-text"},e.button)}_go(){const{viewModel:e}=this;"going-home"===e.state?e.cancelGo():e.go()}};(0,t._)([(0,We.B)("viewModel.goToOverride")],AO.prototype,"goToOverride",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],AO.prototype,"homeTitle",null),(0,t._)([(0,m.Cb)()],AO.prototype,"iconClass",void 0),(0,t._)([(0,m.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],AO.prototype,"label",void 0),(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/widgets/Home/t9n/Home")],AO.prototype,"messages",void 0),(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/t9n/common")],AO.prototype,"messagesCommon",void 0),(0,t._)([(0,We.B)("viewModel.view")],AO.prototype,"view",void 0),(0,t._)([(0,m.Cb)({type:EO}),(0,pO.s)("go")],AO.prototype,"viewModel",void 0),(0,t._)([(0,We.B)("viewModel.viewpoint")],AO.prototype,"viewpoint",void 0),(0,t._)([(0,We.B)("viewModel.cancelGo")],AO.prototype,"cancelGo",null),(0,t._)([(0,We.B)("viewModel.go")],AO.prototype,"go",null),(0,t._)([(0,FE.h)()],AO.prototype,"_go",null),AO=(0,t._)([(0,y.j)("esri.widgets.Home")],AO);const MO=AO;var OO,RO=s(83258),PO=s(97837);let IO=OO=class extends RO.Z{constructor(e){super(e),this.displayValueEnabled=!1,this.max=1,this.min=0,this.step=.1,this.type="slider",this.value=null}clone(){return new OO({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,displayValueEnabled:this.displayValueEnabled,max:this.max,min:this.min,step:this.step,value:this.value})}};(0,t._)([(0,m.Cb)()],IO.prototype,"displayValueEnabled",void 0),(0,t._)([(0,m.Cb)()],IO.prototype,"max",void 0),(0,t._)([(0,m.Cb)()],IO.prototype,"min",void 0),(0,t._)([(0,m.Cb)()],IO.prototype,"step",void 0),(0,t._)([(0,m.Cb)()],IO.prototype,"value",void 0),IO=OO=(0,t._)([(0,y.j)("esri.support.Action.ActionSlider")],IO);const LO=IO;var DO=s(15600);function NO(e){if(e)return null!=e.listMode?e.listMode:void 0}function FO(e){if(e)return"type"in e?"hide-children"!==e.listMode&&"wmts"!==e.type?"group"===e.type?"layers":"sublayers":void 0:"sublayers"}function kO(e,t){e&&e.sort(((e,i)=>{const r=t.indexOf(e.uid),s=t.indexOf(i.uid);return r>s?-1:r<s?1:0}))}function UO(e){const t=e?.layer;return t&&"group"===t.type?t.layers:null}function VO(e,t){const i=e.layer?.uid;return i&&t.find((e=>e.layer?.uid===i))}function zO(e){const t=function(e){return!!e?.layer}(e)?e:null,i=e?.parent,r="map-image"===i?.type&&t.source;return r&&i?{layer:i,title:"",sublayerIds:[r.mapLayerId]}:{layer:e,title:""}}var BO=s(13509);const HO="esri-layer-list-panel__content";let jO=class extends((0,HA.IG)(RE.Z)){constructor(e,t){super(e,t),this._legend=null,this._handles=new Ae.Z,this.content=null,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.own([(0,he.YP)((()=>this.content),(e=>this._createLegend(e)),he.nn)])}destroy(){const{_legend:e}=this;e&&e.destroy(),this._legend=null}get className(){const{image:e}=this,t=this._getFirstWidget();return this._get("className")||!e&&t?t.iconClass:""}set className(e){void 0!==e?this._override("className",e):this._clearOverride("className")}get title(){const e=this._getFirstWidget();return this._get("title")||e?e.label:""}set title(e){void 0!==e?this._override("title",e):this._clearOverride("title")}render(){return(0,UE.u)("div",{class:"esri-layer-list-panel"},this._renderContents())}_renderContent(e){const{_legend:t,listItem:i}=this;return e?"legend"===e?i&&i.view&&i.layer&&t?(0,UE.u)("div",{class:this.classes(HO,"esri-layer-list-panel__content--legend"),key:t},t.render()):null:"string"==typeof e?(0,UE.u)("div",{class:this.classes(HO,"esri-layer-list-panel__content--string"),key:e,innerHTML:e}):(0,BO.Qd)(e)?(0,UE.u)("div",{class:this.classes(HO,"esri-layer-list-panel__content--widget"),key:e},e.render()):e instanceof HTMLElement?(0,UE.u)("div",{class:this.classes(HO,"esri-layer-list-panel__content--html-element"),key:e,bind:e,afterCreate:this._attachToNode}):null:null}_renderContents(){const{content:e}=this;return Array.isArray(e)?e.map((e=>this._renderContent(e))):this._renderContent(e)}_getLegendOptions(){const{listItem:e}=this;if(!e)return{};const{layer:t,view:i}=e;return t&&i?{view:i,layerInfos:[zO(t)]}:{}}_createLegend(e){this._hasLegend(e)&&!this._legend&&s.e(3377).then(s.bind(s,23377)).then((({default:e})=>{const{_handles:t,listItem:i}=this,r=new e(this._getLegendOptions());this._legend=r,this.notifyChange("className"),this.notifyChange("title");const s=(0,he.YP)((()=>[i?.view,i?.layer,i?.layer?.source,i?.layer?.parent]),(()=>this._updateLegend(r)),he.nn);t.add(s,"legends"),this.scheduleRender()}))}_hasLegend(e){const t="legend";return e===t||!!Array.isArray(e)&&e.includes(t)}_attachToNode(e){e.appendChild(this)}_updateLegend(e){e.set(this._getLegendOptions()),this.scheduleRender()}_getWidget(e){return"legend"===e?this._legend:(0,BO.Qd)(e)?e:null}_getFirstWidget(){const{content:e}=this;if(Array.isArray(e)){let t=null;return e.some((e=>{const i=this._getWidget(e);return i&&(t=i),!!i})),t}return this._getWidget(e)}};(0,t._)([(0,m.Cb)()],jO.prototype,"className",null),(0,t._)([(0,m.Cb)()],jO.prototype,"content",void 0),(0,t._)([(0,m.Cb)()],jO.prototype,"image",void 0),(0,t._)([(0,m.Cb)()],jO.prototype,"listItem",void 0),(0,t._)([(0,m.Cb)()],jO.prototype,"title",null),(0,t._)([(0,m.Cb)()],jO.prototype,"open",void 0),(0,t._)([(0,m.Cb)()],jO.prototype,"visible",void 0),jO=(0,t._)([(0,y.j)("esri.widgets.LayerList.ListItemPanel")],jO);const GO=jO;var WO;const ZO=n.Z.ofType({key:"type",defaultKeyValue:"button",base:RO.Z,typeMap:{button:PO.Z,toggle:DO.Z,slider:LO}}),qO=n.Z.ofType(ZO),$O="layer",YO="child-list-mode";let XO=WO=class extends((0,HA.IG)((0,je.p)(O.Z))){constructor(e){super(e),this.actionsSections=new qO,this.actionsOpen=!1,this.children=new(n.Z.ofType(WO)),this.childrenSortable=!0,this.error=null,this.hidden=!1,this.layer=null,this.layerView=null,this.listItemCreatedFunction=null,this.open=!1,this.panel=null,this.parent=null,this.sortable=!0,this.view=null,this.visible=null}initialize(){if(this.handles.add([(0,he.YP)((()=>this.layer),(e=>this._watchLayerProperties(e)),he.nn),(0,he.YP)((()=>this.view),(e=>this._updateChildren(e)),he.nn),(0,he.YP)((()=>this.panel),(e=>this._setListItemOnPanel(e)),he.nn),(0,he.YP)((()=>[this.layer,this.view]),(()=>this._getLayerView()),he.nn)]),"function"==typeof this.listItemCreatedFunction){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.view=null}get connectionStatus(){const{layerView:e}=this;if(e&&"connectionStatus"in e)return e.connectionStatus}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e)||e.spatialReferenceSupported)}castPanel(e){return this.get("panel.open")&&!e.hasOwnProperty("open")&&(e.open=!0),e?new GO(e):null}get title(){const e=this.get("layer.layer");return(!e||e&&this.get("layer.layer.loaded"))&&this.get("layer.title")||this.get("layer.attributes.title")||""}set title(e){void 0!==e?this._override("title",e):this._clearOverride("title")}get updating(){const{layerView:e,connectionStatus:t}=this;return!t&&(e?e.updating:this._isLayerUpdating(this.layer))}get visibleAtCurrentScale(){return!function(e,t){if(!e||isNaN(t))return!1;const i=function(e){if(e)return null!=e.minScale?e.minScale:void 0}(e),r=function(e){if(e)return null!=e.maxScale?e.maxScale:void 0}(e),s=!isNaN(i)&&i>0&&t>i,n=!isNaN(r)&&r>0&&t<r;return s||n}(this.layer,this.get("view.scale"))}get visibilityMode(){return function(e){if(!e)return"inherited";const t=e.get("layer.capabilities.exportMap.supportsSublayerVisibility");if("boolean"==typeof t)return t?"independent":"inherited";const i=e.get("capabilities.exportMap.supportsSublayerVisibility");return"boolean"==typeof i?i?"independent":"inherited":null!=e.visibilityMode?e.visibilityMode:"independent"}(this.layer)}clone(){return new WO({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,children:this.children.clone(),layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,open:this.open,panel:this.panel,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildren(e){const t=this.children;t&&t.forEach((t=>t.view=e))}_addChildren(e){if(this.handles.remove(YO),this.children.removeAll(),!e)return;e.forEach((t=>{this.handles.add((0,he.YP)((()=>t.listMode),(()=>this._addChildren(e))),YO)}));const t=e.filter((e=>"hide"!==NO(e)));this.children.addMany(this._makeChildren(t))}_watchSublayerChanges(e){e&&this.handles.add(e.on("change",(()=>{this._addChildren(e)})),$O)}_initializeChildLayers(e){this._addChildren(e),this._watchSublayerChanges(e)}_makeChildren(e){return e.map((e=>function(e){return"hide"!==NO(e)}(e)?new WO({layer:e,listItemCreatedFunction:this.listItemCreatedFunction,parent:this,view:this.view}):null)).reverse()}_watchLayerProperties(e){if(!this.handles)return;if(this.handles.remove($O),this.handles.remove(YO),!e)return;if(this.handles.add((0,he.YP)((()=>e.listMode),(()=>this._watchLayerProperties(e))),$O),"hide-children"===NO(e))return void this.children.removeAll();const t=FO(e);t&&this.handles.add((0,he.YP)((()=>e[t]),(()=>{e.hasOwnProperty(t)&&this._initializeChildLayers(e[t])}),he.nn),$O)}async _getLayerView(){const{layer:e,view:t}=this;if(e&&t)try{const i=await t.whenLayerView(e);if(i.layer!==this.layer)return;this._set("layerView",i)}catch{}}_isLayerUpdating(e){return e&&"loading"===e.loadStatus}};(0,t._)([(0,m.Cb)({type:qO})],XO.prototype,"actionsSections",void 0),(0,t._)([(0,m.Cb)()],XO.prototype,"actionsOpen",void 0),(0,t._)([(0,m.Cb)({type:n.Z})],XO.prototype,"children",void 0),(0,t._)([(0,m.Cb)()],XO.prototype,"childrenSortable",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],XO.prototype,"connectionStatus",null),(0,t._)([(0,We.B)("layer.loadError?")],XO.prototype,"error",void 0),(0,t._)([(0,m.Cb)()],XO.prototype,"hidden",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],XO.prototype,"incompatible",null),(0,t._)([(0,m.Cb)()],XO.prototype,"layer",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],XO.prototype,"layerView",void 0),(0,t._)([(0,m.Cb)()],XO.prototype,"listItemCreatedFunction",void 0),(0,t._)([(0,m.Cb)()],XO.prototype,"open",void 0),(0,t._)([(0,m.Cb)({type:GO})],XO.prototype,"panel",void 0),(0,t._)([(0,L.p)("panel")],XO.prototype,"castPanel",null),(0,t._)([(0,m.Cb)()],XO.prototype,"parent",void 0),(0,t._)([(0,m.Cb)()],XO.prototype,"sortable",void 0),(0,t._)([(0,m.Cb)()],XO.prototype,"title",null),(0,t._)([(0,m.Cb)({readOnly:!0})],XO.prototype,"updating",null),(0,t._)([(0,m.Cb)({value:null})],XO.prototype,"view",void 0),(0,t._)([(0,We.B)("layer.visible")],XO.prototype,"visible",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],XO.prototype,"visibleAtCurrentScale",null),(0,t._)([(0,m.Cb)({readOnly:!0})],XO.prototype,"visibilityMode",null),XO=WO=(0,t._)([(0,y.j)("esri.widgets.LayerList.ListItem")],XO);const JO=XO,KO="view-layers",QO="map-layers",eR="layer-views",tR="layer-list-mode",iR=n.Z.ofType(JO);let rR=class extends P.Z.EventedAccessor{constructor(e){super(e),this._handles=new Ae.Z,this.listItemCreatedFunction=null,this.operationalItems=new iR,this.view=null}initialize(){this._handles.add([(0,he.YP)((()=>[this.view,this.view?.ready]),(()=>this._viewHandles()),he.nn),(0,he.YP)((()=>this.listItemCreatedFunction),(()=>this._listItemCreatedFunctionChanged()))],"view")}destroy(){this._handles.destroy(),this._handles=null,this.view=null,this.operationalItems.removeAll()}get state(){const e=this.get("view");return this.get("view.ready")?"ready":e?"loading":"disabled"}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,r){const s=e?.layer;if(!s)return;const n=this.view?.map?.layers,o=t?UO(t):n,a=i?UO(i):n;if(!o||!a)return;const{operationalItems:l}=this,c=t?.children||l,u=i?.children||l,h=a.length-r;e.parent=i||null,c.includes(e)&&c.remove(e),o.includes(s)&&o.remove(s),u.includes(e)||u.add(e,h),a.includes(s)||a.add(s,h)}_createLayerViewHandles(e){const{_handles:t}=this;t.remove(eR),this._compileList(),e&&t.add(e.on("change",(()=>this._compileList())),eR)}_createMapLayerHandles(e){const{_handles:t}=this;t.remove(QO),this._compileList(),e&&t.add(e.on("change",(()=>this._compileList())),QO)}_createListItem(e){const{view:t,listItemCreatedFunction:i}=this;return new JO({layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){const{_handles:e,operationalItems:t}=this;t.forEach((t=>{e.remove(`children-${t.uid}`)})),t.removeAll()}_getViewableLayers(e){if(e)return e.filter((e=>"hide"!==NO(e)))}_watchLayersListMode(e){const{_handles:t}=this;t.remove(tR),e&&e.forEach((e=>{"listMode"in e&&t.add((0,he.YP)((()=>e.listMode),(()=>this._compileList())),tR)}))}_compileList(){const e=this.get("view.map.layers");this._watchLayersListMode(e);const t=this._getViewableLayers(e);t&&t.length?(this._createNewItems(t),this._removeItems(t),this._sortItems(t)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach((e=>{t.find((t=>t.layer===e))||t.add(this._createListItem(e))}))}_removeItems(e){const{_handles:t,operationalItems:i}=this,r=[];i.forEach((i=>{i&&e&&e.includes(i.layer)||(t.remove(`children-${i.uid}`),r.push(i))})),i.removeMany(r)}_sortItems(e){const{operationalItems:t}=this;t.sort(((t,i)=>{const r=e.indexOf(t.layer),s=e.indexOf(i.layer);return r>s?-1:r<s?1:0}))}_listItemCreatedFunctionChanged(){this._removeAllItems(),this._compileList()}_viewHandles(){const{_handles:e,view:t}=this;e.remove([QO,eR,KO]),this._compileList(),t&&t.ready&&e.add([(0,he.YP)((()=>this.view?.map?.allLayers),(e=>this._createMapLayerHandles(e)),he.nn),(0,he.YP)((()=>this.view?.allLayerViews),(e=>this._createLayerViewHandles(e)),he.nn)],KO)}};(0,t._)([(0,m.Cb)()],rR.prototype,"listItemCreatedFunction",void 0),(0,t._)([(0,m.Cb)({type:iR})],rR.prototype,"operationalItems",void 0),(0,t._)([(0,m.Cb)({readOnly:!0})],rR.prototype,"state",null),(0,t._)([(0,m.Cb)()],rR.prototype,"view",void 0),rR=(0,t._)([(0,y.j)("esri.widgets.LayerList.LayerListViewModel")],rR);const sR=rR;function nR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function oR(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?nR(Object(i),!0).forEach((function(t){lR(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nR(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function aR(e){return aR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},aR(e)}function lR(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function cR(){return cR=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},cR.apply(this,arguments)}function uR(e,t){if(null==e)return{};var i,r,s=function(e,t){if(null==e)return{};var i,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||(s[i]=e[i]);return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}function hR(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var dR=hR(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),pR=hR(/Edge/i),fR=hR(/firefox/i),mR=hR(/safari/i)&&!hR(/chrome/i)&&!hR(/android/i),gR=hR(/iP(ad|od|hone)/i),yR=hR(/chrome/i)&&hR(/android/i),_R={capture:!1,passive:!1};function vR(e,t,i){e.addEventListener(t,i,!dR&&_R)}function bR(e,t,i){e.removeEventListener(t,i,!dR&&_R)}function wR(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function xR(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function CR(e,t,i,r){if(e){i=i||document;do{if(null!=t&&(">"===t[0]?e.parentNode===i&&wR(e,t):wR(e,t))||r&&e===i)return e;if(e===i)break}while(e=xR(e))}return null}var TR,SR=/\s+/g;function ER(e,t,i){if(e&&t)if(e.classList)e.classList[i?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(SR," ").replace(" "+t+" "," ");e.className=(r+(i?" "+t:"")).replace(SR," ")}}function AR(e,t,i){var r=e&&e.style;if(r){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(i=e.currentStyle),void 0===t?i:i[t];t in r||-1!==t.indexOf("webkit")||(t="-webkit-"+t),r[t]=i+("string"==typeof i?"":"px")}}function MR(e,t){var i="";if("string"==typeof e)i=e;else do{var r=AR(e,"transform");r&&"none"!==r&&(i=r+" "+i)}while(!t&&(e=e.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(i)}function OR(e,t,i){if(e){var r=e.getElementsByTagName(t),s=0,n=r.length;if(i)for(;s<n;s++)i(r[s],s);return r}return[]}function RR(){return document.scrollingElement||document.documentElement}function PR(e,t,i,r,s){if(e.getBoundingClientRect||e===window){var n,o,a,l,c,u,h;if(e!==window&&e.parentNode&&e!==RR()?(o=(n=e.getBoundingClientRect()).top,a=n.left,l=n.bottom,c=n.right,u=n.height,h=n.width):(o=0,a=0,l=window.innerHeight,c=window.innerWidth,u=window.innerHeight,h=window.innerWidth),(t||i)&&e!==window&&(s=s||e.parentNode,!dR))do{if(s&&s.getBoundingClientRect&&("none"!==AR(s,"transform")||i&&"static"!==AR(s,"position"))){var d=s.getBoundingClientRect();o-=d.top+parseInt(AR(s,"border-top-width")),a-=d.left+parseInt(AR(s,"border-left-width")),l=o+n.height,c=a+n.width;break}}while(s=s.parentNode);if(r&&e!==window){var p=MR(s||e),f=p&&p.a,m=p&&p.d;p&&(l=(o/=m)+(u/=m),c=(a/=f)+(h/=f))}return{top:o,left:a,bottom:l,right:c,width:h,height:u}}}function IR(e,t,i){for(var r=kR(e,!0),s=PR(e)[t];r;){var n=PR(r)[i];if(!("top"===i||"left"===i?s>=n:s<=n))return r;if(r===RR())break;r=kR(r,!1)}return!1}function LR(e,t,i,r){for(var s=0,n=0,o=e.children;n<o.length;){if("none"!==o[n].style.display&&o[n]!==VP.ghost&&(r||o[n]!==VP.dragged)&&CR(o[n],i.draggable,e,!1)){if(s===t)return o[n];s++}n++}return null}function DR(e,t){for(var i=e.lastElementChild;i&&(i===VP.ghost||"none"===AR(i,"display")||t&&!wR(i,t));)i=i.previousElementSibling;return i||null}function NR(e,t){var i=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===VP.clone||t&&!wR(e,t)||i++;return i}function FR(e){var t=0,i=0,r=RR();if(e)do{var s=MR(e),n=s.a,o=s.d;t+=e.scrollLeft*n,i+=e.scrollTop*o}while(e!==r&&(e=e.parentNode));return[t,i]}function kR(e,t){if(!e||!e.getBoundingClientRect)return RR();var i=e,r=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var s=AR(i);if(i.clientWidth<i.scrollWidth&&("auto"==s.overflowX||"scroll"==s.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==s.overflowY||"scroll"==s.overflowY)){if(!i.getBoundingClientRect||i===document.body)return RR();if(r||t)return i;r=!0}}}while(i=i.parentNode);return RR()}function UR(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function VR(e,t){return function(){if(!TR){var i=arguments,r=this;1===i.length?e.call(r,i[0]):e.apply(r,i),TR=setTimeout((function(){TR=void 0}),t)}}}function zR(e,t,i){e.scrollLeft+=t,e.scrollTop+=i}function BR(e){var t=window.Polymer,i=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):i?i(e).clone(!0)[0]:e.cloneNode(!0)}var HR="Sortable"+(new Date).getTime();var jR=[],GR={initializeByDefault:!0},WR={mount:function(e){for(var t in GR)GR.hasOwnProperty(t)&&!(t in e)&&(e[t]=GR[t]);jR.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),jR.push(e)},pluginEvent:function(e,t,i){var r=this;this.eventCanceled=!1,i.cancel=function(){r.eventCanceled=!0};var s=e+"Global";jR.forEach((function(r){t[r.pluginName]&&(t[r.pluginName][s]&&t[r.pluginName][s](oR({sortable:t},i)),t.options[r.pluginName]&&t[r.pluginName][e]&&t[r.pluginName][e](oR({sortable:t},i)))}))},initializePlugins:function(e,t,i,r){for(var s in jR.forEach((function(r){var s=r.pluginName;if(e.options[s]||r.initializeByDefault){var n=new r(e,t,e.options);n.sortable=e,n.options=e.options,e[s]=n,cR(i,n.defaults)}})),e.options)if(e.options.hasOwnProperty(s)){var n=this.modifyOption(e,s,e.options[s]);void 0!==n&&(e.options[s]=n)}},getEventProperties:function(e,t){var i={};return jR.forEach((function(r){"function"==typeof r.eventProperties&&cR(i,r.eventProperties.call(t[r.pluginName],e))})),i},modifyOption:function(e,t,i){var r;return jR.forEach((function(s){e[s.pluginName]&&s.optionListeners&&"function"==typeof s.optionListeners[t]&&(r=s.optionListeners[t].call(e[s.pluginName],i))})),r}};var ZR=["evt"],qR=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.evt,s=uR(i,ZR);WR.pluginEvent.bind(VP)(e,t,oR({dragEl:YR,parentEl:XR,ghostEl:JR,rootEl:KR,nextEl:QR,lastDownEl:eP,cloneEl:tP,cloneHidden:iP,dragStarted:mP,putSortable:lP,activeSortable:VP.active,originalEvent:r,oldIndex:rP,oldDraggableIndex:nP,newIndex:sP,newDraggableIndex:oP,hideGhostForTarget:NP,unhideGhostForTarget:FP,cloneNowHidden:function(){iP=!0},cloneNowShown:function(){iP=!1},dispatchSortableEvent:function(e){$R({sortable:t,name:e,originalEvent:r})}},s))};function $R(e){!function(e){var t=e.sortable,i=e.rootEl,r=e.name,s=e.targetEl,n=e.cloneEl,o=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,u=e.oldDraggableIndex,h=e.newDraggableIndex,d=e.originalEvent,p=e.putSortable,f=e.extraEventProperties;if(t=t||i&&i[HR]){var m,g=t.options,y="on"+r.charAt(0).toUpperCase()+r.substr(1);!window.CustomEvent||dR||pR?(m=document.createEvent("Event")).initEvent(r,!0,!0):m=new CustomEvent(r,{bubbles:!0,cancelable:!0}),m.to=o||i,m.from=a||i,m.item=s||i,m.clone=n,m.oldIndex=l,m.newIndex=c,m.oldDraggableIndex=u,m.newDraggableIndex=h,m.originalEvent=d,m.pullMode=p?p.lastPutMode:void 0;var _=oR(oR({},f),WR.getEventProperties(r,t));for(var v in _)m[v]=_[v];i&&i.dispatchEvent(m),g[y]&&g[y].call(t,m)}}(oR({putSortable:lP,cloneEl:tP,targetEl:YR,rootEl:KR,oldIndex:rP,oldDraggableIndex:nP,newIndex:sP,newDraggableIndex:oP},e))}var YR,XR,JR,KR,QR,eP,tP,iP,rP,sP,nP,oP,aP,lP,cP,uP,hP,dP,pP,fP,mP,gP,yP,_P,vP,bP=!1,wP=!1,xP=[],CP=!1,TP=!1,SP=[],EP=!1,AP=[],MP="undefined"!=typeof document,OP=gR,RP=pR||dR?"cssFloat":"float",PP=MP&&!yR&&!gR&&"draggable"in document.createElement("div"),IP=function(){if(MP){if(dR)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),LP=function(e,t){var i=AR(e),r=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),s=LR(e,0,t),n=LR(e,1,t),o=s&&AR(s),a=n&&AR(n),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+PR(s).width,c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+PR(n).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&o.float&&"none"!==o.float){var u="left"===o.float?"left":"right";return!n||"both"!==a.clear&&a.clear!==u?"horizontal":"vertical"}return s&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||l>=r&&"none"===i[RP]||n&&"none"===i[RP]&&l+c>r)?"vertical":"horizontal"},DP=function(e){function t(e,i){return function(r,s,n,o){var a=r.options.group.name&&s.options.group.name&&r.options.group.name===s.options.group.name;if(null==e&&(i||a))return!0;if(null==e||!1===e)return!1;if(i&&"clone"===e)return e;if("function"==typeof e)return t(e(r,s,n,o),i)(r,s,n,o);var l=(i?r:s).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var i={},r=e.group;r&&"object"==aR(r)||(r={name:r}),i.name=r.name,i.checkPull=t(r.pull,!0),i.checkPut=t(r.put),i.revertClone=r.revertClone,e.group=i},NP=function(){!IP&&JR&&AR(JR,"display","none")},FP=function(){!IP&&JR&&AR(JR,"display","")};MP&&!yR&&document.addEventListener("click",(function(e){if(wP)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),wP=!1,!1}),!0);var kP=function(e){if(YR){var t=(s=(e=e.touches?e.touches[0]:e).clientX,n=e.clientY,xP.some((function(e){var t=e[HR].options.emptyInsertThreshold;if(t&&!DR(e)){var i=PR(e),r=s>=i.left-t&&s<=i.right+t,a=n>=i.top-t&&n<=i.bottom+t;return r&&a?o=e:void 0}})),o);if(t){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[HR]._onDragOver(i)}}var s,n,o},UP=function(e){YR&&YR.parentNode[HR]._isOutsideThisEl(e.target)};function VP(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=cR({},t),e[HR]=this;var i,r,s={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return LP(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==VP.supportPointer&&"PointerEvent"in window&&!mR,emptyInsertThreshold:5};for(var n in WR.initializePlugins(this,e,s),s)!(n in t)&&(t[n]=s[n]);for(var o in DP(t),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!t.forceFallback&&PP,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?vR(e,"pointerdown",this._onTapStart):(vR(e,"mousedown",this._onTapStart),vR(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(vR(e,"dragover",this),vR(e,"dragenter",this)),xP.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),cR(this,(r=[],{captureAnimationState:function(){r=[],this.options.animation&&[].slice.call(this.el.children).forEach((function(e){if("none"!==AR(e,"display")&&e!==VP.ghost){r.push({target:e,rect:PR(e)});var t=oR({},r[r.length-1].rect);if(e.thisAnimationDuration){var i=MR(e,!0);i&&(t.top-=i.f,t.left-=i.e)}e.fromRect=t}}))},addAnimationState:function(e){r.push(e)},removeAnimationState:function(e){r.splice(function(e,t){for(var i in e)if(e.hasOwnProperty(i))for(var r in t)if(t.hasOwnProperty(r)&&t[r]===e[i][r])return Number(i);return-1}(r,{target:e}),1)},animateAll:function(e){var t=this;if(!this.options.animation)return clearTimeout(i),void("function"==typeof e&&e());var s=!1,n=0;r.forEach((function(e){var i=0,r=e.target,o=r.fromRect,a=PR(r),l=r.prevFromRect,c=r.prevToRect,u=e.rect,h=MR(r,!0);h&&(a.top-=h.f,a.left-=h.e),r.toRect=a,r.thisAnimationDuration&&UR(l,a)&&!UR(o,a)&&(u.top-a.top)/(u.left-a.left)==(o.top-a.top)/(o.left-a.left)&&(i=function(e,t,i,r){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))*r.animation}(u,l,c,t.options)),UR(a,o)||(r.prevFromRect=o,r.prevToRect=a,i||(i=t.options.animation),t.animate(r,u,a,i)),i&&(s=!0,n=Math.max(n,i),clearTimeout(r.animationResetTimer),r.animationResetTimer=setTimeout((function(){r.animationTime=0,r.prevFromRect=null,r.fromRect=null,r.prevToRect=null,r.thisAnimationDuration=null}),i),r.thisAnimationDuration=i)})),clearTimeout(i),s?i=setTimeout((function(){"function"==typeof e&&e()}),n):"function"==typeof e&&e(),r=[]},animate:function(e,t,i,r){if(r){AR(e,"transition",""),AR(e,"transform","");var s=MR(this.el),n=s&&s.a,o=s&&s.d,a=(t.left-i.left)/(n||1),l=(t.top-i.top)/(o||1);e.animatingX=!!a,e.animatingY=!!l,AR(e,"transform","translate3d("+a+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),AR(e,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),AR(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){AR(e,"transition",""),AR(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),r)}}}))}function zP(e,t,i,r,s,n,o,a){var l,c,u=e[HR],h=u.options.onMove;return!window.CustomEvent||dR||pR?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=i,l.draggedRect=r,l.related=s||t,l.relatedRect=n||PR(t),l.willInsertAfter=a,l.originalEvent=o,e.dispatchEvent(l),h&&(c=h.call(u,l,o)),c}function BP(e){e.draggable=!1}function HP(){EP=!1}function jP(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,i=t.length,r=0;i--;)r+=t.charCodeAt(i);return r.toString(36)}function GP(e){return setTimeout(e,0)}function WP(e){return clearTimeout(e)}VP.prototype={constructor:VP,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(gP=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,YR):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,r=this.options,s=r.preventOnFilter,n=e.type,o=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,a=(o||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||a,c=r.filter;if(function(e){AP.length=0;for(var t=e.getElementsByTagName("input"),i=t.length;i--;){var r=t[i];r.checked&&AP.push(r)}}(i),!YR&&!(/mousedown|pointerdown/.test(n)&&0!==e.button||r.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!mR||!a||"SELECT"!==a.tagName.toUpperCase())&&!((a=CR(a,r.draggable,i,!1))&&a.animated||eP===a)){if(rP=NR(a),nP=NR(a,r.draggable),"function"==typeof c){if(c.call(this,e,a,this))return $R({sortable:t,rootEl:l,name:"filter",targetEl:a,toEl:i,fromEl:i}),qR("filter",t,{evt:e}),void(s&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some((function(r){if(r=CR(l,r.trim(),i,!1))return $R({sortable:t,rootEl:r,name:"filter",targetEl:a,fromEl:i,toEl:i}),qR("filter",t,{evt:e}),!0}))))return void(s&&e.cancelable&&e.preventDefault());r.handle&&!CR(l,r.handle,i,!1)||this._prepareDragStart(e,o,a)}}},_prepareDragStart:function(e,t,i){var r,s=this,n=s.el,o=s.options,a=n.ownerDocument;if(i&&!YR&&i.parentNode===n){var l=PR(i);if(KR=n,XR=(YR=i).parentNode,QR=YR.nextSibling,eP=i,aP=o.group,VP.dragged=YR,cP={target:YR,clientX:(t||e).clientX,clientY:(t||e).clientY},pP=cP.clientX-l.left,fP=cP.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,YR.style["will-change"]="all",r=function(){qR("delayEnded",s,{evt:e}),VP.eventCanceled?s._onDrop():(s._disableDelayedDragEvents(),!fR&&s.nativeDraggable&&(YR.draggable=!0),s._triggerDragStart(e,t),$R({sortable:s,name:"choose",originalEvent:e}),ER(YR,o.chosenClass,!0))},o.ignore.split(",").forEach((function(e){OR(YR,e.trim(),BP)})),vR(a,"dragover",kP),vR(a,"mousemove",kP),vR(a,"touchmove",kP),vR(a,"mouseup",s._onDrop),vR(a,"touchend",s._onDrop),vR(a,"touchcancel",s._onDrop),fR&&this.nativeDraggable&&(this.options.touchStartThreshold=4,YR.draggable=!0),qR("delayStart",this,{evt:e}),!o.delay||o.delayOnTouchOnly&&!t||this.nativeDraggable&&(pR||dR))r();else{if(VP.eventCanceled)return void this._onDrop();vR(a,"mouseup",s._disableDelayedDrag),vR(a,"touchend",s._disableDelayedDrag),vR(a,"touchcancel",s._disableDelayedDrag),vR(a,"mousemove",s._delayedDragTouchMoveHandler),vR(a,"touchmove",s._delayedDragTouchMoveHandler),o.supportPointer&&vR(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(r,o.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){YR&&BP(YR),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;bR(e,"mouseup",this._disableDelayedDrag),bR(e,"touchend",this._disableDelayedDrag),bR(e,"touchcancel",this._disableDelayedDrag),bR(e,"mousemove",this._delayedDragTouchMoveHandler),bR(e,"touchmove",this._delayedDragTouchMoveHandler),bR(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?vR(document,"pointermove",this._onTouchMove):vR(document,t?"touchmove":"mousemove",this._onTouchMove):(vR(YR,"dragend",this),vR(KR,"dragstart",this._onDragStart));try{document.selection?GP((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(bP=!1,KR&&YR){qR("dragStarted",this,{evt:t}),this.nativeDraggable&&vR(document,"dragover",UP);var i=this.options;!e&&ER(YR,i.dragClass,!1),ER(YR,i.ghostClass,!0),VP.active=this,e&&this._appendGhost(),$R({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(uP){this._lastX=uP.clientX,this._lastY=uP.clientY,NP();for(var e=document.elementFromPoint(uP.clientX,uP.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(uP.clientX,uP.clientY))!==t;)t=e;if(YR.parentNode[HR]._isOutsideThisEl(e),t)do{if(t[HR]&&t[HR]._onDragOver({clientX:uP.clientX,clientY:uP.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break;e=t}while(t=t.parentNode);FP()}},_onTouchMove:function(e){if(cP){var t=this.options,i=t.fallbackTolerance,r=t.fallbackOffset,s=e.touches?e.touches[0]:e,n=JR&&MR(JR,!0),o=JR&&n&&n.a,a=JR&&n&&n.d,l=OP&&vP&&FR(vP),c=(s.clientX-cP.clientX+r.x)/(o||1)+(l?l[0]-SP[0]:0)/(o||1),u=(s.clientY-cP.clientY+r.y)/(a||1)+(l?l[1]-SP[1]:0)/(a||1);if(!VP.active&&!bP){if(i&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(JR){n?(n.e+=c-(hP||0),n.f+=u-(dP||0)):n={a:1,b:0,c:0,d:1,e:c,f:u};var h="matrix(".concat(n.a,",").concat(n.b,",").concat(n.c,",").concat(n.d,",").concat(n.e,",").concat(n.f,")");AR(JR,"webkitTransform",h),AR(JR,"mozTransform",h),AR(JR,"msTransform",h),AR(JR,"transform",h),hP=c,dP=u,uP=s}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!JR){var e=this.options.fallbackOnBody?document.body:KR,t=PR(YR,!0,OP,!0,e),i=this.options;if(OP){for(vP=e;"static"===AR(vP,"position")&&"none"===AR(vP,"transform")&&vP!==document;)vP=vP.parentNode;vP!==document.body&&vP!==document.documentElement?(vP===document&&(vP=RR()),t.top+=vP.scrollTop,t.left+=vP.scrollLeft):vP=RR(),SP=FR(vP)}ER(JR=YR.cloneNode(!0),i.ghostClass,!1),ER(JR,i.fallbackClass,!0),ER(JR,i.dragClass,!0),AR(JR,"transition",""),AR(JR,"transform",""),AR(JR,"box-sizing","border-box"),AR(JR,"margin",0),AR(JR,"top",t.top),AR(JR,"left",t.left),AR(JR,"width",t.width),AR(JR,"height",t.height),AR(JR,"opacity","0.8"),AR(JR,"position",OP?"absolute":"fixed"),AR(JR,"zIndex","100000"),AR(JR,"pointerEvents","none"),VP.ghost=JR,e.appendChild(JR),AR(JR,"transform-origin",pP/parseInt(JR.style.width)*100+"% "+fP/parseInt(JR.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,r=e.dataTransfer,s=i.options;qR("dragStart",this,{evt:e}),VP.eventCanceled?this._onDrop():(qR("setupClone",this),VP.eventCanceled||((tP=BR(YR)).removeAttribute("id"),tP.draggable=!1,tP.style["will-change"]="",this._hideClone(),ER(tP,this.options.chosenClass,!1),VP.clone=tP),i.cloneId=GP((function(){qR("clone",i),VP.eventCanceled||(i.options.removeCloneOnHide||KR.insertBefore(tP,YR),i._hideClone(),$R({sortable:i,name:"clone"}))})),!t&&ER(YR,s.dragClass,!0),t?(wP=!0,i._loopId=setInterval(i._emulateDragOver,50)):(bR(document,"mouseup",i._onDrop),bR(document,"touchend",i._onDrop),bR(document,"touchcancel",i._onDrop),r&&(r.effectAllowed="move",s.setData&&s.setData.call(i,r,YR)),vR(document,"drop",i),AR(YR,"transform","translateZ(0)")),bP=!0,i._dragStartId=GP(i._dragStarted.bind(i,t,e)),vR(document,"selectstart",i),mP=!0,mR&&AR(document.body,"user-select","none"))},_onDragOver:function(e){var t,i,r,s,n=this.el,o=e.target,a=this.options,l=a.group,c=VP.active,u=aP===l,h=a.sort,d=lP||c,p=this,f=!1;if(!EP){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),o=CR(o,a.draggable,n,!0),O("dragOver"),VP.eventCanceled)return f;if(YR.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||p._ignoreWhileAnimating===o)return P(!1);if(wP=!1,c&&!a.disabled&&(u?h||(r=XR!==KR):lP===this||(this.lastPutMode=aP.checkPull(this,c,YR,e))&&l.checkPut(this,c,YR,e))){if(s="vertical"===this._getDirection(e,o),t=PR(YR),O("dragOverValid"),VP.eventCanceled)return f;if(r)return XR=KR,R(),this._hideClone(),O("revert"),VP.eventCanceled||(QR?KR.insertBefore(YR,QR):KR.appendChild(YR)),P(!0);var m=DR(n,a.draggable);if(!m||function(e,t,i){var r=PR(DR(i.el,i.options.draggable));return t?e.clientX>r.right+10||e.clientX<=r.right&&e.clientY>r.bottom&&e.clientX>=r.left:e.clientX>r.right&&e.clientY>r.top||e.clientX<=r.right&&e.clientY>r.bottom+10}(e,s,this)&&!m.animated){if(m===YR)return P(!1);if(m&&n===e.target&&(o=m),o&&(i=PR(o)),!1!==zP(KR,n,YR,t,o,i,e,!!o))return R(),m&&m.nextSibling?n.insertBefore(YR,m.nextSibling):n.appendChild(YR),XR=n,I(),P(!0)}else if(m&&function(e,t,i){var r=PR(LR(i.el,0,i.options,!0));return t?e.clientX<r.left-10||e.clientY<r.top&&e.clientX<r.right:e.clientY<r.top-10||e.clientY<r.bottom&&e.clientX<r.left}(e,s,this)){var g=LR(n,0,a,!0);if(g===YR)return P(!1);if(i=PR(o=g),!1!==zP(KR,n,YR,t,o,i,e,!1))return R(),n.insertBefore(YR,g),XR=n,I(),P(!0)}else if(o.parentNode===n){i=PR(o);var y,_,v,b=YR.parentNode!==n,w=!function(e,t,i){var r=i?e.left:e.top,s=i?e.right:e.bottom,n=i?e.width:e.height,o=i?t.left:t.top,a=i?t.right:t.bottom,l=i?t.width:t.height;return r===o||s===a||r+n/2===o+l/2}(YR.animated&&YR.toRect||t,o.animated&&o.toRect||i,s),x=s?"top":"left",C=IR(o,"top","top")||IR(YR,"top","top"),T=C?C.scrollTop:void 0;if(gP!==o&&(_=i[x],CP=!1,TP=!w&&a.invertSwap||b),y=function(e,t,i,r,s,n,o,a){var l=r?e.clientY:e.clientX,c=r?i.height:i.width,u=r?i.top:i.left,h=r?i.bottom:i.right,d=!1;if(!o)if(a&&_P<c*s){if(!CP&&(1===yP?l>u+c*n/2:l<h-c*n/2)&&(CP=!0),CP)d=!0;else if(1===yP?l<u+_P:l>h-_P)return-yP}else if(l>u+c*(1-s)/2&&l<h-c*(1-s)/2)return function(e){return NR(YR)<NR(e)?1:-1}(t);return(d=d||o)&&(l<u+c*n/2||l>h-c*n/2)?l>u+c/2?1:-1:0}(e,o,i,s,w?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,TP,gP===o),0!==y){var S=NR(YR);do{S-=y,v=XR.children[S]}while(v&&("none"===AR(v,"display")||v===JR))}if(0===y||v===o)return P(!1);gP=o,yP=y;var E=o.nextElementSibling,A=!1,M=zP(KR,n,YR,t,o,i,e,A=1===y);if(!1!==M)return 1!==M&&-1!==M||(A=1===M),EP=!0,setTimeout(HP,30),R(),A&&!E?n.appendChild(YR):o.parentNode.insertBefore(YR,A?E:o),C&&zR(C,0,T-C.scrollTop),XR=YR.parentNode,void 0===_||TP||(_P=Math.abs(_-PR(o)[x])),I(),P(!0)}if(n.contains(YR))return P(!1)}return!1}function O(a,l){qR(a,p,oR({evt:e,isOwner:u,axis:s?"vertical":"horizontal",revert:r,dragRect:t,targetRect:i,canSort:h,fromSortable:d,target:o,completed:P,onMove:function(i,r){return zP(KR,n,YR,t,i,PR(i),e,r)},changed:I},l))}function R(){O("dragOverAnimationCapture"),p.captureAnimationState(),p!==d&&d.captureAnimationState()}function P(t){return O("dragOverCompleted",{insertion:t}),t&&(u?c._hideClone():c._showClone(p),p!==d&&(ER(YR,lP?lP.options.ghostClass:c.options.ghostClass,!1),ER(YR,a.ghostClass,!0)),lP!==p&&p!==VP.active?lP=p:p===VP.active&&lP&&(lP=null),d===p&&(p._ignoreWhileAnimating=o),p.animateAll((function(){O("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==d&&(d.animateAll(),d._ignoreWhileAnimating=null)),(o===YR&&!YR.animated||o===n&&!o.animated)&&(gP=null),a.dragoverBubble||e.rootEl||o===document||(YR.parentNode[HR]._isOutsideThisEl(e.target),!t&&kP(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),f=!0}function I(){sP=NR(YR),oP=NR(YR,a.draggable),$R({sortable:p,name:"change",toEl:n,newIndex:sP,newDraggableIndex:oP,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){bR(document,"mousemove",this._onTouchMove),bR(document,"touchmove",this._onTouchMove),bR(document,"pointermove",this._onTouchMove),bR(document,"dragover",kP),bR(document,"mousemove",kP),bR(document,"touchmove",kP)},_offUpEvents:function(){var e=this.el.ownerDocument;bR(e,"mouseup",this._onDrop),bR(e,"touchend",this._onDrop),bR(e,"pointerup",this._onDrop),bR(e,"touchcancel",this._onDrop),bR(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;sP=NR(YR),oP=NR(YR,i.draggable),qR("drop",this,{evt:e}),XR=YR&&YR.parentNode,sP=NR(YR),oP=NR(YR,i.draggable),VP.eventCanceled||(bP=!1,TP=!1,CP=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),WP(this.cloneId),WP(this._dragStartId),this.nativeDraggable&&(bR(document,"drop",this),bR(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),mR&&AR(document.body,"user-select",""),AR(YR,"transform",""),e&&(mP&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),JR&&JR.parentNode&&JR.parentNode.removeChild(JR),(KR===XR||lP&&"clone"!==lP.lastPutMode)&&tP&&tP.parentNode&&tP.parentNode.removeChild(tP),YR&&(this.nativeDraggable&&bR(YR,"dragend",this),BP(YR),YR.style["will-change"]="",mP&&!bP&&ER(YR,lP?lP.options.ghostClass:this.options.ghostClass,!1),ER(YR,this.options.chosenClass,!1),$R({sortable:this,name:"unchoose",toEl:XR,newIndex:null,newDraggableIndex:null,originalEvent:e}),KR!==XR?(sP>=0&&($R({rootEl:XR,name:"add",toEl:XR,fromEl:KR,originalEvent:e}),$R({sortable:this,name:"remove",toEl:XR,originalEvent:e}),$R({rootEl:XR,name:"sort",toEl:XR,fromEl:KR,originalEvent:e}),$R({sortable:this,name:"sort",toEl:XR,originalEvent:e})),lP&&lP.save()):sP!==rP&&sP>=0&&($R({sortable:this,name:"update",toEl:XR,originalEvent:e}),$R({sortable:this,name:"sort",toEl:XR,originalEvent:e})),VP.active&&(null!=sP&&-1!==sP||(sP=rP,oP=nP),$R({sortable:this,name:"end",toEl:XR,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){qR("nulling",this),KR=YR=XR=JR=QR=tP=eP=iP=cP=uP=mP=sP=oP=rP=nP=gP=yP=lP=aP=VP.dragged=VP.ghost=VP.clone=VP.active=null,AP.forEach((function(e){e.checked=!0})),AP.length=hP=dP=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":YR&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],i=this.el.children,r=0,s=i.length,n=this.options;r<s;r++)CR(e=i[r],n.draggable,this.el,!1)&&t.push(e.getAttribute(n.dataIdAttr)||jP(e));return t},sort:function(e,t){var i={},r=this.el;this.toArray().forEach((function(e,t){var s=r.children[t];CR(s,this.options.draggable,r,!1)&&(i[e]=s)}),this),t&&this.captureAnimationState(),e.forEach((function(e){i[e]&&(r.removeChild(i[e]),r.appendChild(i[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return CR(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(void 0===t)return i[e];var r=WR.modifyOption(this,e,t);i[e]=void 0!==r?r:t,"group"===e&&DP(i)},destroy:function(){qR("destroy",this);var e=this.el;e[HR]=null,bR(e,"mousedown",this._onTapStart),bR(e,"touchstart",this._onTapStart),bR(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(bR(e,"dragover",this),bR(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),xP.splice(xP.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!iP){if(qR("hideClone",this),VP.eventCanceled)return;AR(tP,"display","none"),this.options.removeCloneOnHide&&tP.parentNode&&tP.parentNode.removeChild(tP),iP=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(iP){if(qR("showClone",this),VP.eventCanceled)return;YR.parentNode!=KR||this.options.group.revertClone?QR?KR.insertBefore(tP,QR):KR.appendChild(tP):KR.insertBefore(tP,YR),this.options.group.revertClone&&this.animate(YR,tP),AR(tP,"display",""),iP=!1}}else this._hideClone()}},MP&&vR(document,"touchmove",(function(e){(VP.active||bP)&&e.cancelable&&e.preventDefault()})),VP.utils={on:vR,off:bR,css:AR,find:OR,is:function(e,t){return!!CR(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},throttle:VR,closest:CR,toggleClass:ER,clone:BR,index:NR,nextTick:GP,cancelNextTick:WP,detectDirection:LP,getChild:LR},VP.get=function(e){return e[HR]},VP.mount=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(VP.utils=oR(oR({},VP.utils),e.utils)),WR.mount(e)}))},VP.create=function(e,t){return new VP(e,t)},VP.version="1.15.0";var ZP,qP,$P,YP,XP,JP,KP=[],QP=!1;function eI(){KP.forEach((function(e){clearInterval(e.pid)})),KP=[]}function tI(){clearInterval(JP)}var iI=VR((function(e,t,i,r){if(t.scroll){var s,n=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,a=t.scrollSensitivity,l=t.scrollSpeed,c=RR(),u=!1;qP!==i&&(qP=i,eI(),ZP=t.scroll,s=t.scrollFn,!0===ZP&&(ZP=kR(i,!0)));var h=0,d=ZP;do{var p=d,f=PR(p),m=f.top,g=f.bottom,y=f.left,_=f.right,v=f.width,b=f.height,w=void 0,x=void 0,C=p.scrollWidth,T=p.scrollHeight,S=AR(p),E=p.scrollLeft,A=p.scrollTop;p===c?(w=v<C&&("auto"===S.overflowX||"scroll"===S.overflowX||"visible"===S.overflowX),x=b<T&&("auto"===S.overflowY||"scroll"===S.overflowY||"visible"===S.overflowY)):(w=v<C&&("auto"===S.overflowX||"scroll"===S.overflowX),x=b<T&&("auto"===S.overflowY||"scroll"===S.overflowY));var M=w&&(Math.abs(_-n)<=a&&E+v<C)-(Math.abs(y-n)<=a&&!!E),O=x&&(Math.abs(g-o)<=a&&A+b<T)-(Math.abs(m-o)<=a&&!!A);if(!KP[h])for(var R=0;R<=h;R++)KP[R]||(KP[R]={});KP[h].vx==M&&KP[h].vy==O&&KP[h].el===p||(KP[h].el=p,KP[h].vx=M,KP[h].vy=O,clearInterval(KP[h].pid),0==M&&0==O||(u=!0,KP[h].pid=setInterval(function(){r&&0===this.layer&&VP.active._onTouchMove(XP);var t=KP[this.layer].vy?KP[this.layer].vy*l:0,i=KP[this.layer].vx?KP[this.layer].vx*l:0;"function"==typeof s&&"continue"!==s.call(VP.dragged.parentNode[HR],i,t,e,XP,KP[this.layer].el)||zR(KP[this.layer].el,i,t)}.bind({layer:h}),24))),h++}while(t.bubbleScroll&&d!==c&&(d=kR(d,!1)));QP=u}}),30),rI=function(e){var t=e.originalEvent,i=e.putSortable,r=e.dragEl,s=e.activeSortable,n=e.dispatchSortableEvent,o=e.hideGhostForTarget,a=e.unhideGhostForTarget;if(t){var l=i||s;o();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,u=document.elementFromPoint(c.clientX,c.clientY);a(),l&&!l.el.contains(u)&&(n("spill"),this.onSpill({dragEl:r,putSortable:i}))}};function sI(){}function nI(){}sI.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var r=LR(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(t,r):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:rI},cR(sI,{pluginName:"revertOnSpill"}),nI.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable||this.sortable;i.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),i.animateAll()},drop:rI},cR(nI,{pluginName:"removeOnSpill"}),VP.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?vR(document,"dragover",this._handleAutoScroll):this.options.supportPointer?vR(document,"pointermove",this._handleFallbackAutoScroll):t.touches?vR(document,"touchmove",this._handleFallbackAutoScroll):vR(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?bR(document,"dragover",this._handleAutoScroll):(bR(document,"pointermove",this._handleFallbackAutoScroll),bR(document,"touchmove",this._handleFallbackAutoScroll),bR(document,"mousemove",this._handleFallbackAutoScroll)),tI(),eI(),clearTimeout(TR),TR=void 0},nulling:function(){XP=qP=ZP=QP=JP=$P=YP=null,KP.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var i=this,r=(e.touches?e.touches[0]:e).clientX,s=(e.touches?e.touches[0]:e).clientY,n=document.elementFromPoint(r,s);if(XP=e,t||this.options.forceAutoScrollFallback||pR||dR||mR){iI(e,this.options,n,t);var o=kR(n,!0);!QP||JP&&r===$P&&s===YP||(JP&&tI(),JP=setInterval((function(){var n=kR(document.elementFromPoint(r,s),!0);n!==o&&(o=n,eI()),iI(e,i.options,n,t)}),10),$P=r,YP=s)}else{if(!this.options.bubbleScroll||kR(n,!0)===RR())return void eI();iI(e,this.options,kR(n,!1),!1)}}},cR(e,{pluginName:"scroll",initializeByDefault:!0})}),VP.mount(nI,sI);const oI=VP;function aI(e,t,i){e.splice(i,0,e.splice(t,1)[0])}const lI=n.Z.ofType(JO),cI="data-sort-filter",uI="data-layer-uid",hI="esri-layer-list__list",dI="esri-layer-list__list--independent",pI="esri-layer-list__item",fI="esri-layer-list__item-actions-menu-item",mI="esri-layer-list__item-actions-menu-item--active",gI="esri-layer-list__item-action-image",yI="esri-layer-list__item-label",_I="esri-layer-list__item-message",vI="esri-layer-list__item-toggle",bI="esri-icon-notice-triangle",wI="esri-icon-default-action",xI={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function CI(e){const{actionsOpen:t,children:i}=e;t&&(e.actionsOpen=!1),i.forEach((e=>CI(e)))}const TI="root",SI={statusIndicators:!0};let EI=class extends RE.Z{constructor(e,t){super(e,t),this._handles=new Ae.Z,this._sortableNodes=new Map,this._sortableMap=new Map,this._focusSortUid=null,this._newUI=(0,b.Z)("esri-layerlist-new-ui"),this._tooltipReferenceMap=new Map,this.visibleItems=null,this.iconClass="esri-icon-layers",this.label=void 0,this.listItemCanGiveFunction=null,this.listItemCanReceiveFunction=null,this.listItemCreatedFunction=null,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.operationalItems=null,this.selectionEnabled=!1,this.selectedItems=new lI,this.view=null,this.viewModel=new sR,this.visibleElements={...SI},this._onSortableSort=({to:e,from:t,item:i,newIndex:r})=>{t&&e&&(t===e?this._sortLayers(this._sortableMap.get(t.dataset.group)):this._moveLayerFromChildList({to:e,from:t,item:i,newIndex:r}))},this._sortableCanSort=(e,t)=>!(!e.el.dataset.group||!t.el.dataset.group),this._sortableCanPull=(e,t,i)=>{const{listItemCanGiveFunction:r}=this,s={selected:i["data-item"],from:t.el["data-item"],to:e.el["data-item"]};return!this._sortableCanSort(e,t)||"function"!=typeof r||r.call(null,s)},this._sortableCanPut=(e,t,i)=>{const{listItemCanReceiveFunction:r}=this,s={selected:i["data-item"],from:t.el["data-item"],to:e.el["data-item"]};return!this._sortableCanSort(e,t)||"function"!=typeof r||r.call(null,s)},this._onSortableEnd=({oldIndex:e,from:t,to:i,item:r})=>{t!==i&&t.insertBefore(r,t.children[e])}}initialize(){const e=this.operationalItems;this._setVisibleItems(e),this.own([(0,he.on)((()=>this.operationalItems),"change",(()=>this._itemsChanged(e))),(0,he.YP)((()=>this.errorsVisible),(()=>this._itemsChanged(e))),(0,he.YP)((()=>this.selectionEnabled),(()=>this._toggleAllSorting()),he.nn)])}loadDependencies(){return Promise.all([s.e(1315).then(s.bind(s,11315))])}destroy(){this._destroySortables(),this._tooltipReferenceMap.clear(),this._handles.destroy(),this._handles=null}castVisibleElements(e){return{...SI,...e}}triggerAction(e,t){this.viewModel.triggerAction(e,t)}render(){const{visibleItems:e,_newUI:t}=this,i=this.viewModel?.state,r={"esri-layer-list--new-ui":t,"esri-hidden":"loading"===i,"esri-disabled":"disabled"===i},s=this.renderItemTooltips(),n=this.renderItems();return(0,UE.u)("div",{class:this.classes("esri-layer-list esri-widget esri-widget--panel",r)},e?.length?[s,n]:this.renderNoItems())}renderItemTooltip(e){const{_tooltipReferenceMap:t,messages:i}=this;return e?(0,UE.u)("calcite-tooltip",{label:i.layerIncompatible,referenceElement:t.get(e.uid)},i.layerIncompatibleTooltip):null}renderItemTooltipNodes(e){const{incompatible:t,children:i}=e;return[t?this.renderItemTooltip(e):null,...t?[]:i?.toArray().map((e=>this.renderItemTooltipNodes(e)))]}renderItemTooltips(){return this.visibleItems.toArray().map((e=>this.renderItemTooltipNodes(e)))}renderNoItems(){return(0,UE.u)("div",{class:"esri-layer-list__no-items"},this.messages.noItemsToDisplay)}renderItems(){const{visibleItems:e,selectionEnabled:t,messages:i}=this;return(0,UE.u)("ul",{"aria-label":i.widgetLabel,role:t?"listbox":void 0,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,"data-group":TI,bind:this,class:this.classes(hI,"esri-layer-list__list--root",dI)},e?.map((e=>this.renderItem(e,null))).toArray())}renderActionsMenuIcon(e,t){const{messagesCommon:i}=this,r={[mI]:e.actionsOpen};return(0,UE.u)("div",{key:"actions-menu-toggle","data-item":e,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(fI,r),tabindex:"0",role:"button","aria-controls":t,"aria-label":i.options,title:i.options},(0,UE.u)("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"}))}renderActionsMenu(e,t,i,r){const{panel:s}=e,n=s&&s.visible?this.renderPanelButton(s):null,o=1===i&&this._getSingleActionButton(t),a=o?this.renderAction({item:e,action:o,singleAction:!0}):null,l=!o&&i?this.renderActionsMenuIcon(e,r):null;return l||n||o?(0,UE.u)("div",{key:"actions-menu",class:"esri-layer-list__item-actions-menu"},n,a,l):null}renderChildList(e,t){const{selectionEnabled:i}=this,{visibilityMode:r,children:s}=e,n=this._hasChildren(e),o=!n&&i&&"group"===e.layer?.type,{exclusive:a,inherited:l}=xI,c={"esri-layer-list__list--exclusive":r===a,"esri-layer-list__list--inherited":r===l,[dI]:r!==l&&r!==a};return n||o?(0,UE.u)("ul",{bind:this,key:"list-items",id:t,"data-group":e.uid,"data-item":e,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,class:this.classes(hI,c),"aria-expanded":e.open?"true":"false",role:i?"listbox":r===a?"radiogroup":"group",hidden:!e.open&&!o||null},s?.map((t=>this.renderItem(t,e))).toArray()):null}renderChildrenToggle(e,t){const{messagesCommon:i}=this,r=this._hasChildren(e),s={"esri-layer-list__child-toggle--open":e.open},n=e.open?i.collapse:i.expand;return r?(0,UE.u)("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":e,key:"toggle-children",class:this.classes("esri-layer-list__child-toggle",s),tabindex:"0",role:"button","aria-controls":t,"aria-label":n,title:n},(0,UE.u)("span",{"aria-hidden":"true",class:this.classes("esri-layer-list__child-toggle-icon--closed","esri-icon-right-triangle-arrow")}),(0,UE.u)("span",{"aria-hidden":"true",class:this.classes("esri-layer-list__child-toggle-icon--opened","esri-icon-down-arrow")}),(0,UE.u)("span",{"aria-hidden":"true",class:this.classes("esri-layer-list__child-toggle-icon--closed-rtl","esri-icon-left-triangle-arrow")})):null}renderItemMessage(e){return e.error?(0,UE.u)("div",{key:"esri-layer-list__error",class:_I,role:"alert"},(0,UE.u)("span",{"aria-hidden":"true",class:bI}),this.messages.layerError):e.incompatible?(0,UE.u)("div",{key:"esri-layer-list__incompatible",class:_I,role:"alert"},(0,UE.u)("span",{bind:this,tabIndex:0,"aria-hidden":"true",class:bI,afterCreate:t=>this._setTooltipReference(t,e)}),this.messages.layerIncompatible):null}renderItemContent(e,t,i){const{id:r}=this,s=`${r}_${e.uid}`,n=`${s}_actions`,o=`${s}__list`,{panel:a}=e,l=this._filterActions(e.actionsSections),c=this._countActions(l);return[(0,UE.u)("div",{key:"list-item-container",class:"esri-layer-list__item-container"},this.renderChildrenToggle(e,o),this.renderLabel(e,t,i),this.renderActionsMenu(e,l,c,n)),this.renderItemMessage(e),c?this.renderActionsSections(e,l,n):null,a&&a.open?a.render():null,this.renderChildList(e,o)]}renderItem(e,t){const{_newUI:i,id:r,selectionEnabled:s,selectedItems:n,visibleElements:o}=this,a=`${r}_${e.uid}__title`,l=this._hasMessage(e),c={"esri-layer-list__item--has-children":this._hasChildren(e),"esri-layer-list__item--has-message":!!l,"esri-layer-list__item--updating":e.updating&&!t&&o.statusIndicators,"esri-layer-list__item--invisible":i&&!e.visible,"esri-layer-list__item--invisible-at-scale":!e.visibleAtCurrentScale,"esri-layer-list__item--selectable":s};if(s){const i={[uI]:e.layer?.uid,[cI]:(!e.sortable).toString()};return(0,UE.u)("li",{key:`item-with-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(pI,c),"aria-labelledby":a,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item":e,"data-group":t?t.uid:TI,tabIndex:0,"aria-selected":VO(e,n)?"true":"false",role:"option",...i},this.renderItemContent(e,t,a))}return(0,UE.u)("li",{key:`item-no-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(pI,c),"aria-labelledby":a},this.renderItemContent(e,t,a))}renderItemConnectionStatus(e){const{connectionStatus:t}=e;return t?(0,UE.u)("span",{class:this.classes({"esri-layer-list__connection-status":!0,"esri-layer-list__connection-status--disconnected":"disconnected"===t,"esri-layer-list__connection-status--connected":"connected"===t}),key:"layer-connection-status"}):null}renderItemTitle(e,t){const{messages:i}=this;if(!e)return null;const r=e.title||i.untitledLayer,s=e.visibleAtCurrentScale?r:`${r} (${i.layerInvisibleAtScale})`;return(0,UE.u)("span",{key:"layer-title-container",id:t,title:s,"aria-label":s,class:"esri-layer-list__item-title"},r)}renderItemToggleIcon(e,t){const{_newUI:i}=this,{exclusive:r}=xI,s=t&&t.visibilityMode,n={"esri-layer-list__item-toggle-icon":i,"esri-layer-list__item-toggle-icon":i&&s!==r,"esri-layer-list__item-radio-icon":i&&s===r,"esri-icon-radio-checked":s===r&&e.visible,"esri-icon-radio-unchecked":s===r&&!e.visible,"esri-icon-visible":s!==r&&e.visible,"esri-icon-non-visible":s!==r&&!e.visible};return(0,UE.u)("span",{key:"item-toggle-icon",class:this.classes(n),"aria-hidden":"true"})}renderItemToggle(e,t,i){const{selectionEnabled:r,messages:s}=this,{exclusive:n}=xI,o=t&&t.visibilityMode,a=o===n?"radio":"switch";return(0,UE.u)("span",r?{key:"item-toggle-selection-enabled",class:vI,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":o,tabIndex:0,title:e.visible?s.hideLayer:s.showLayer,"aria-checked":e.visible?"true":"false",role:a,"aria-labelledby":i}:{key:"item-toggle",class:vI},this.renderItemToggleIcon(e,t))}renderLabel(e,t,i){const{selectionEnabled:r,_newUI:s,messages:n}=this,{inherited:o,exclusive:a}=xI,l=t?.visibilityMode,c=l===a?"radio":"switch",u=[this.renderItemToggle(e,t,i),this.renderItemConnectionStatus(e),this.renderItemTitle(e,i)];s&&u.reverse();const h=(0,UE.u)("div",r?{key:`item-label-no-selection-${e.uid}`,class:yI}:{key:`item-label-with-selection-${e.uid}`,class:yI,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":l,tabIndex:0,"aria-checked":e.visible?"true":"false",title:e.visible?n.hideLayer:n.showLayer,role:c,"aria-labelledby":i},u);return l===o||e.error?(0,UE.u)("div",{key:`item-label-container-${e.uid}`,class:yI},this.renderItemTitle(e,i)):h}renderPanelButton(e){const{className:t,open:i,title:r,image:s}=e,n=s||t?t:wI,o=this._getIconImageStyles(e),a={[mI]:i},l={[gI]:!!o["background-image"]};return n&&(l[n]=!!n),(0,UE.u)("div",{key:`panel-${e.uid}`,bind:this,"data-panel":e,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(fI,a),role:"button",tabindex:"0",title:r,"aria-label":r},(0,UE.u)("span",{class:this.classes(l),styles:o}))}renderActionsSections(e,t,i){const r=t.toArray().map(((t,i)=>(0,UE.u)("ul",{key:`${e}-action-section-${i}`,class:"esri-layer-list__item-actions-list"},this.renderActionSection(e,t))));return(0,UE.u)("div",{role:"group","aria-expanded":e.actionsOpen?"true":"false",key:"actions-section",id:i,class:"esri-layer-list__item-actions",hidden:!e.actionsOpen||null},r)}renderActionSection(e,t){return(t&&t.toArray()).map((t=>this.renderAction({item:e,action:t})))}renderActionIcon(e){const{active:t,className:i}=e,r=this._getIconImageStyles(e),s="button"!==e.type||e.image||i?i:wI,n={[gI]:!t&&!!r["background-image"],"esri-icon-loading-indicator":t,"esri-rotating":t};return s&&!t&&(n[s]=!0),(0,UE.u)("span",{key:"action-icon","aria-hidden":"true",class:this.classes("esri-layer-list__item-action-icon",n),styles:r})}renderActionTitle(e,t){return t?null:(0,UE.u)("span",{key:"action-title",class:"esri-layer-list__item-action-title"},e)}renderAction(e){const{item:t,action:i,singleAction:r}=e,{active:s,disabled:n,title:o}=i,a={[fI]:r&&"button"===i.type,"esri-layer-list__item-action":s||!r&&"toggle"!==i.type,"esri-layer-list__action-toggle":!s&&"toggle"===i.type,"esri-layer-list__action-toggle--on":!s&&"toggle"===i.type&&i.value,"esri-disabled-element":n},l=[this.renderActionIcon(i),this.renderActionTitle(o,r)];return r?(0,UE.u)("div",{bind:this,"data-item":t,"data-action":i,role:"button",key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",title:o,"aria-label":o},l):(0,UE.u)("li",{bind:this,"data-item":t,"data-action":i,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",role:"button",title:o,"aria-label":o},l)}_setTooltipReference(e,t){this._tooltipReferenceMap.set(t.uid,e),this.scheduleRender()}_hasMessage(e){return!!e.error||e.incompatible}_hasChildren(e){return!!e.children.length&&!this._hasMessage(e)}_sortNodeRemoved(e){const{_sortableMap:t}=this,i=e.dataset.group,r=t.get(i);r&&r.destroy(),t.delete(i)}_destroySortables(){const{_sortableMap:e,_sortableNodes:t}=this;e.forEach((e=>e&&e.destroy())),e.clear(),t.clear()}_moveLayerFromChildList({to:e,from:t,item:i,newIndex:r}){const s=i["data-item"],n=e["data-item"],o=t["data-item"];this.viewModel.moveListItem(s,o,n,r)}_sortLayers(e){if(!e)return;const t=e.el["data-item"],i=e.toArray();t?function(e,t){const i=e?.layer;if(!i)return;const r=FO(i);r&&kO(i.get(r),t)}(t,i):kO(this.view?.map?.layers,i)}_toggleSorting(e,t){const{_sortableMap:i,selectionEnabled:r}=this,s=i.get(t),n=e["data-item"],o=(t===TI||n.childrenSortable&&function(e){const t=e&&(e.get("layer.layer")||e.layer);if(!t)return!1;const i=t.get("capabilities.exportMap.supportsDynamicLayers");return"boolean"!=typeof i||i}(n))&&r;if(s)s.option("disabled",!o);else if(o){const r=oI.create(e,{dataIdAttr:uI,group:{name:t,pull:this._sortableCanPull,put:this._sortableCanPut},filter:`[${cI}="true"]`,fallbackTolerance:4,onSort:this._onSortableSort,onEnd:this._onSortableEnd,disabled:!o,chosenClass:"esri-layer-list--chosen"});i.set(t,r)}}_toggleAllSorting(){this._sortableNodes.forEach(((e,t)=>this._toggleSorting(e,t)))}_sortNodeCreated(e){const t=e.dataset.group;t&&(this._sortableNodes.set(t,e),this._toggleSorting(e,t))}_setVisibleItems(e){this.visibleItems=e?.filter((e=>!e.hidden&&(this.errorsVisible||!e.error)))}_getSingleActionButton(e){return e.reduce((e=>e)).filter((e=>e&&"button"===e.type)).getItemAt(0)}_focusListItem(e){const{_focusSortUid:t}=this;e&&t&&e["data-item"].layer?.uid===t&&(e.focus(),this._focusSortUid=null)}_watchActionSectionChanges(e,t){const i="action-section"+t;this._handles.add(e.on("change",this.scheduleRender.bind(this)),i),e.forEach((e=>this._renderOnActionChanges(e,t)))}_renderOnActionChanges(e,t){const i="actions"+t;"toggle"!==e.type?"slider"!==e.type?this._handles.add((0,he.YP)((()=>[e?.className,e?.image,e?.id,e?.title,e?.visible]),(()=>this.scheduleRender()),he.nn),i):this._handles.add((0,he.YP)((()=>[e?.className,e?.id,e?.title,e?.visible,e?.value,e?.displayValueEnabled,e?.max,e?.min,e?.step]),(()=>this.scheduleRender()),he.nn),i):this._handles.add((0,he.YP)((()=>[e?.className,e?.image,e?.id,e?.title,e?.visible,e?.value]),(()=>this.scheduleRender()),he.nn),i)}_renderOnItemChanges(e){const t=e.uid,i="items"+t;this._handles.add([(0,he.YP)((()=>[e?.actionsOpen,e?.visible,e?.open,e?.updating,e?.title,e?.visibleAtCurrentScale,e?.error,e?.visibilityMode,e?.panel,e?.panel?.title,e?.panel?.content,e?.panel?.className,e?.sortable,e?.childrenSortable]),(()=>this.scheduleRender()),he.tX),(0,he.YP)((()=>[e?.hidden,e?.error]),(()=>this._setVisibleItems(this.operationalItems))),e.actionsSections.on("change",(()=>this.scheduleRender())),e.children.on("change",(()=>this.scheduleRender()))],i),e.children.forEach((e=>this._renderOnItemChanges(e))),e.actionsSections.forEach((e=>this._watchActionSectionChanges(e,t)))}_itemsChanged(e){this._handles.removeAll(),e.forEach((e=>this._renderOnItemChanges(e))),this._tooltipReferenceMap.clear(),this._setVisibleItems(e),this.scheduleRender()}_filterActions(e){return e.map((e=>e.filter((e=>e.visible))))}_countActions(e){return e.reduce(((e,t)=>e+t.length),0)}_getIconImageStyles(e){const t="esri.widgets.LayerList.ListItemPanel"===e.declaredClass||"esri.support.Action.ActionButton"===e.declaredClass||"esri.support.Action.ActionToggle"===e.declaredClass?e.image:null;return{"background-image":t?`url("${t}")`:null}}_selectionKeydown(e){const t=(0,ae.kK)(e);if(!["ArrowDown","ArrowUp"].includes(t))return void this._toggleSelection(e);e.stopPropagation();const i=e.currentTarget,r=i["data-item"],{_sortableMap:s,selectedItems:n}=this,o=i.dataset.group,a=s.get(o);if(!a)return;const l=VO(r,n),c=a.toArray(),u=e.target,h=c.indexOf(u.dataset.layerUid);if(-1!==h){if("ArrowDown"===t){const e=h+1;if(e>=c.length)return;l?(aI(c,h,e),a.sort(c),this._sortLayers(a),this._focusSortUid=r.layer?.uid):(this._focusSortUid=r.layer?.uid,this.scheduleRender())}if("ArrowUp"===t){const e=h-1;if(e<=-1)return;l?(aI(c,h,e),a.sort(c),this._sortLayers(a),this._focusSortUid=r.layer?.uid):(this._focusSortUid=r.layer?.uid,this.scheduleRender())}}}_toggleActionsOpen(e){const t=e.currentTarget["data-item"],{actionsOpen:i}=t,r=!i;r&&this.operationalItems.forEach((e=>CI(e))),t.actionsOpen=r,e.stopPropagation()}_triggerPanel(e){const t=e.currentTarget["data-panel"];t&&(t.open=!t.open),e.stopPropagation()}_triggerAction(e){const t=e.currentTarget,i=t["data-action"],r=t["data-item"];"toggle"===i.type&&(i.value=!i.value),this.triggerAction(i,r),e.stopPropagation()}_toggleVisibility(e){const t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),r=t["data-item"];i===xI.exclusive&&r.visible||(r.visible=!r.visible),e.stopPropagation()}_toggleChildrenClick(e){const t=e.currentTarget["data-item"];t.open=!t.open,e.stopPropagation()}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,r=e.currentTarget["data-item"],s=VO(r,i),{length:n}=i;if(!t)return!n||s&&1===n?void(s?i.remove?.(s):i.add(r)):(i.removeAll(),void i.add(r));s?i.remove?.(s):i.add(r)}};(0,t._)([(0,m.Cb)()],EI.prototype,"visibleItems",void 0),(0,t._)([(0,m.Cb)()],EI.prototype,"iconClass",void 0),(0,t._)([(0,m.Cb)()],EI.prototype,"errorsVisible",void 0),(0,t._)([(0,m.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],EI.prototype,"label",void 0),(0,t._)([(0,m.Cb)()],EI.prototype,"listItemCanGiveFunction",void 0),(0,t._)([(0,m.Cb)()],EI.prototype,"listItemCanReceiveFunction",void 0),(0,t._)([(0,We.B)("viewModel.listItemCreatedFunction")],EI.prototype,"listItemCreatedFunction",void 0),(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/widgets/LayerList/t9n/LayerList")],EI.prototype,"messages",void 0),(0,t._)([(0,m.Cb)(),(0,kE.H)("esri/t9n/common")],EI.prototype,"messagesCommon",void 0),(0,t._)([(0,m.Cb)()],EI.prototype,"multipleSelectionEnabled",void 0),(0,t._)([(0,We.B)("viewModel.operationalItems")],EI.prototype,"operationalItems",void 0),(0,t._)([(0,m.Cb)()],EI.prototype,"selectionEnabled",void 0),(0,t._)([(0,m.Cb)()],EI.prototype,"selectedItems",void 0),(0,t._)([(0,We.B)("viewModel.view")],EI.prototype,"view",void 0),(0,t._)([(0,pO.s)("trigger-action"),(0,m.Cb)({type:sR})],EI.prototype,"viewModel",void 0),(0,t._)([(0,m.Cb)()],EI.prototype,"visibleElements",void 0),(0,t._)([(0,L.p)("visibleElements")],EI.prototype,"castVisibleElements",null),(0,t._)([(0,We.B)("viewModel.triggerAction")],EI.prototype,"triggerAction",null),(0,t._)([(0,FE.h)()],EI.prototype,"_toggleActionsOpen",null),(0,t._)([(0,FE.h)()],EI.prototype,"_triggerPanel",null),(0,t._)([(0,FE.h)()],EI.prototype,"_triggerAction",null),(0,t._)([(0,FE.h)()],EI.prototype,"_toggleVisibility",null),(0,t._)([(0,FE.h)()],EI.prototype,"_toggleChildrenClick",null),(0,t._)([(0,FE.h)()],EI.prototype,"_toggleSelection",null),EI=(0,t._)([(0,y.j)("esri.widgets.LayerList")],EI);const AI=EI;function MI(){}const OI=function(){let e=0;return function(){return e++}}();function RI(e){return null==e}function PI(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return"[object"===t.slice(0,7)&&"Array]"===t.slice(-6)}function II(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}const LI=e=>("number"==typeof e||e instanceof Number)&&isFinite(+e);function DI(e,t){return LI(e)?e:t}function NI(e,t){return void 0===e?t:e}const FI=(e,t)=>"string"==typeof e&&e.endsWith("%")?parseFloat(e)/100*t:+e;function kI(e,t,i){if(e&&"function"==typeof e.call)return e.apply(i,t)}function UI(e,t,i,r){let s,n,o;if(PI(e))if(n=e.length,r)for(s=n-1;s>=0;s--)t.call(i,e[s],s);else for(s=0;s<n;s++)t.call(i,e[s],s);else if(II(e))for(o=Object.keys(e),n=o.length,s=0;s<n;s++)t.call(i,e[o[s]],o[s])}function VI(e,t){let i,r,s,n;if(!e||!t||e.length!==t.length)return!1;for(i=0,r=e.length;i<r;++i)if(s=e[i],n=t[i],s.datasetIndex!==n.datasetIndex||s.index!==n.index)return!1;return!0}function zI(e){if(PI(e))return e.map(zI);if(II(e)){const t=Object.create(null),i=Object.keys(e),r=i.length;let s=0;for(;s<r;++s)t[i[s]]=zI(e[i[s]]);return t}return e}function BI(e){return-1===["__proto__","prototype","constructor"].indexOf(e)}function HI(e,t,i,r){if(!BI(e))return;const s=t[e],n=i[e];II(s)&&II(n)?jI(s,n,r):t[e]=zI(n)}function jI(e,t,i){const r=PI(t)?t:[t],s=r.length;if(!II(e))return e;const n=(i=i||{}).merger||HI;for(let o=0;o<s;++o){if(!II(t=r[o]))continue;const s=Object.keys(t);for(let r=0,o=s.length;r<o;++r)n(s[r],e,t,i)}return e}function GI(e,t){return jI(e,t,{merger:WI})}function WI(e,t,i){if(!BI(e))return;const r=t[e],s=i[e];II(r)&&II(s)?GI(r,s):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=zI(s))}const ZI={"":e=>e,x:e=>e.x,y:e=>e.y};function qI(e,t){const i=ZI[t]||(ZI[t]=function(e){const t=function(e){const t=e.split("."),i=[];let r="";for(const e of t)r+=e,r.endsWith("\\")?r=r.slice(0,-1)+".":(i.push(r),r="");return i}(e);return e=>{for(const i of t){if(""===i)break;e=e&&e[i]}return e}}(t));return i(e)}function $I(e){return e.charAt(0).toUpperCase()+e.slice(1)}const YI=e=>void 0!==e,XI=e=>"function"==typeof e,JI=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},KI=Math.PI,QI=2*KI,eL=QI+KI,tL=Number.POSITIVE_INFINITY,iL=KI/180,rL=KI/2,sL=KI/4,nL=2*KI/3,oL=Math.log10,aL=Math.sign;function lL(e){const t=Math.round(e);e=uL(e,t,e/1e3)?t:e;const i=Math.pow(10,Math.floor(oL(e))),r=e/i;return(r<=1?1:r<=2?2:r<=5?5:10)*i}function cL(e){return!isNaN(parseFloat(e))&&isFinite(e)}function uL(e,t,i){return Math.abs(e-t)<i}function hL(e,t,i){let r,s,n;for(r=0,s=e.length;r<s;r++)n=e[r][i],isNaN(n)||(t.min=Math.min(t.min,n),t.max=Math.max(t.max,n))}function dL(e){return e*(KI/180)}function pL(e){return e*(180/KI)}function fL(e){if(!LI(e))return;let t=1,i=0;for(;Math.round(e*t)/t!==e;)t*=10,i++;return i}function mL(e,t){const i=t.x-e.x,r=t.y-e.y,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n<-.5*KI&&(n+=QI),{angle:n,distance:s}}function gL(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function yL(e,t){return(e-t+eL)%QI-KI}function _L(e){return(e%QI+QI)%QI}function vL(e,t,i,r){const s=_L(e),n=_L(t),o=_L(i),a=_L(n-s),l=_L(o-s),c=_L(s-n),u=_L(s-o);return s===n||s===o||r&&n===o||a>l&&c<u}function bL(e,t,i){return Math.max(t,Math.min(i,e))}function wL(e,t,i,r=1e-6){return e>=Math.min(t,i)-r&&e<=Math.max(t,i)+r}function xL(e,t,i){i=i||(i=>e[i]<t);let r,s=e.length-1,n=0;for(;s-n>1;)r=n+s>>1,i(r)?n=r:s=r;return{lo:n,hi:s}}const CL=(e,t,i,r)=>xL(e,i,r?r=>e[r][t]<=i:r=>e[r][t]<i),TL=(e,t,i)=>xL(e,i,(r=>e[r][t]>=i)),SL=["push","pop","shift","splice","unshift"];function EL(e,t){const i=e._chartjs;if(!i)return;const r=i.listeners,s=r.indexOf(t);-1!==s&&r.splice(s,1),r.length>0||(SL.forEach((t=>{delete e[t]})),delete e._chartjs)}function AL(e){const t=new Set;let i,r;for(i=0,r=e.length;i<r;++i)t.add(e[i]);return t.size===r?e:Array.from(t)}const ML="undefined"==typeof window?function(e){return e()}:window.requestAnimationFrame;function OL(e,t,i){const r=i||(e=>Array.prototype.slice.call(e));let s=!1,n=[];return function(...i){n=r(i),s||(s=!0,ML.call(window,(()=>{s=!1,e.apply(t,n)})))}}const RL=e=>"start"===e?"left":"end"===e?"right":"center",PL=(e,t,i)=>"start"===e?t:"end"===e?i:(t+i)/2;function IL(e,t,i){const r=t.length;let s=0,n=r;if(e._sorted){const{iScale:o,_parsed:a}=e,l=o.axis,{min:c,max:u,minDefined:h,maxDefined:d}=o.getUserBounds();h&&(s=bL(Math.min(CL(a,o.axis,c).lo,i?r:CL(t,l,o.getPixelForValue(c)).lo),0,r-1)),n=d?bL(Math.max(CL(a,o.axis,u,!0).hi+1,i?0:CL(t,l,o.getPixelForValue(u),!0).hi+1),s,r)-s:r-s}return{start:s,count:n}}function LL(e){const{xScale:t,yScale:i,_scaleRanges:r}=e,s={xmin:t.min,xmax:t.max,ymin:i.min,ymax:i.max};if(!r)return e._scaleRanges=s,!0;const n=r.xmin!==t.min||r.xmax!==t.max||r.ymin!==i.min||r.ymax!==i.max;return Object.assign(r,s),n}const DL=e=>0===e||1===e,NL=(e,t,i)=>-Math.pow(2,10*(e-=1))*Math.sin((e-t)*QI/i),FL=(e,t,i)=>Math.pow(2,-10*e)*Math.sin((e-t)*QI/i)+1,kL={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*rL),easeOutSine:e=>Math.sin(e*rL),easeInOutSine:e=>-.5*(Math.cos(KI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>DL(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,-10*(2*e-1))),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>DL(e)?e:NL(e,.075,.3),easeOutElastic:e=>DL(e)?e:FL(e,.075,.3),easeInOutElastic(e){const t=.1125;return DL(e)?e:e<.5?.5*NL(2*e,t,.45):.5+.5*FL(2*e-1,t,.45)},easeInBack(e){const t=1.70158;return e*e*((t+1)*e-t)},easeOutBack(e){const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},easeInBounce:e=>1-kL.easeOutBounce(1-e),easeOutBounce(e){const t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375},easeInOutBounce:e=>e<.5?.5*kL.easeInBounce(2*e):.5*kL.easeOutBounce(2*e-1)+.5};function UL(e){return e+.5|0}const VL=(e,t,i)=>Math.max(Math.min(e,i),t);function zL(e){return VL(UL(2.55*e),0,255)}function BL(e){return VL(UL(255*e),0,255)}function HL(e){return VL(UL(e/2.55)/100,0,1)}function jL(e){return VL(UL(100*e),0,100)}const GL={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},WL=[..."0123456789ABCDEF"],ZL=e=>WL[15&e],qL=e=>WL[(240&e)>>4]+WL[15&e],$L=e=>(240&e)>>4==(15&e);const YL=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function XL(e,t,i){const r=t*Math.min(i,1-i),s=(t,s=(t+e/30)%12)=>i-r*Math.max(Math.min(s-3,9-s,1),-1);return[s(0),s(8),s(4)]}function JL(e,t,i){const r=(r,s=(r+e/60)%6)=>i-i*t*Math.max(Math.min(s,4-s,1),0);return[r(5),r(3),r(1)]}function KL(e,t,i){const r=XL(e,1,.5);let s;for(t+i>1&&(s=1/(t+i),t*=s,i*=s),s=0;s<3;s++)r[s]*=1-t-i,r[s]+=t;return r}function QL(e){const t=e.r/255,i=e.g/255,r=e.b/255,s=Math.max(t,i,r),n=Math.min(t,i,r),o=(s+n)/2;let a,l,c;return s!==n&&(c=s-n,l=o>.5?c/(2-s-n):c/(s+n),a=function(e,t,i,r,s){return e===s?(t-i)/r+(t<i?6:0):t===s?(i-e)/r+2:(e-t)/r+4}(t,i,r,c,s),a=60*a+.5),[0|a,l||0,o]}function eD(e,t,i,r){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,i,r)).map(BL)}function tD(e,t,i){return eD(XL,e,t,i)}function iD(e){return(e%360+360)%360}const rD={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},sD={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let nD;const oD=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,aD=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,lD=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function cD(e,t,i){if(e){let r=QL(e);r[t]=Math.max(0,Math.min(r[t]+r[t]*i,0===t?360:1)),r=tD(r),e.r=r[0],e.g=r[1],e.b=r[2]}}function uD(e,t){return e?Object.assign(t||{},e):e}function hD(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=BL(e[3]))):(t=uD(e,{r:0,g:0,b:0,a:1})).a=BL(t.a),t}function dD(e){return"r"===e.charAt(0)?function(e){const t=oD.exec(e);let i,r,s,n=255;if(t){if(t[7]!==i){const e=+t[7];n=t[8]?zL(e):VL(255*e,0,255)}return i=+t[1],r=+t[3],s=+t[5],i=255&(t[2]?zL(i):VL(i,0,255)),r=255&(t[4]?zL(r):VL(r,0,255)),s=255&(t[6]?zL(s):VL(s,0,255)),{r:i,g:r,b:s,a:n}}}(e):function(e){const t=YL.exec(e);let i,r=255;if(!t)return;t[5]!==i&&(r=t[6]?zL(+t[5]):BL(+t[5]));const s=iD(+t[2]),n=+t[3]/100,o=+t[4]/100;return i="hwb"===t[1]?function(e,t,i){return eD(KL,e,t,i)}(s,n,o):"hsv"===t[1]?function(e,t,i){return eD(JL,e,t,i)}(s,n,o):tD(s,n,o),{r:i[0],g:i[1],b:i[2],a:r}}(e)}class pD{constructor(e){if(e instanceof pD)return e;const t=typeof e;let i;var r,s,n;"object"===t?i=hD(e):"string"===t&&(n=(r=e).length,"#"===r[0]&&(4===n||5===n?s={r:255&17*GL[r[1]],g:255&17*GL[r[2]],b:255&17*GL[r[3]],a:5===n?17*GL[r[4]]:255}:7!==n&&9!==n||(s={r:GL[r[1]]<<4|GL[r[2]],g:GL[r[3]]<<4|GL[r[4]],b:GL[r[5]]<<4|GL[r[6]],a:9===n?GL[r[7]]<<4|GL[r[8]]:255})),i=s||function(e){nD||(nD=function(){const e={},t=Object.keys(sD),i=Object.keys(rD);let r,s,n,o,a;for(r=0;r<t.length;r++){for(o=a=t[r],s=0;s<i.length;s++)n=i[s],a=a.replace(n,rD[n]);n=parseInt(sD[o],16),e[a]=[n>>16&255,n>>8&255,255&n]}return e}(),nD.transparent=[0,0,0,0]);const t=nD[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:4===t.length?t[3]:255}}(e)||dD(e)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var e=uD(this._rgb);return e&&(e.a=HL(e.a)),e}set rgb(e){this._rgb=hD(e)}rgbString(){return this._valid?(e=this._rgb)&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${HL(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`):void 0;var e}hexString(){return this._valid?(e=this._rgb,t=(e=>$L(e.r)&&$L(e.g)&&$L(e.b)&&$L(e.a))(e)?ZL:qL,e?"#"+t(e.r)+t(e.g)+t(e.b)+((e,t)=>e<255?t(e):"")(e.a,t):void 0):void 0;var e,t}hslString(){return this._valid?function(e){if(!e)return;const t=QL(e),i=t[0],r=jL(t[1]),s=jL(t[2]);return e.a<255?`hsla(${i}, ${r}%, ${s}%, ${HL(e.a)})`:`hsl(${i}, ${r}%, ${s}%)`}(this._rgb):void 0}mix(e,t){if(e){const i=this.rgb,r=e.rgb;let s;const n=t===s?.5:t,o=2*n-1,a=i.a-r.a,l=((o*a==-1?o:(o+a)/(1+o*a))+1)/2;s=1-l,i.r=255&l*i.r+s*r.r+.5,i.g=255&l*i.g+s*r.g+.5,i.b=255&l*i.b+s*r.b+.5,i.a=n*i.a+(1-n)*r.a,this.rgb=i}return this}interpolate(e,t){return e&&(this._rgb=function(e,t,i){const r=lD(HL(e.r)),s=lD(HL(e.g)),n=lD(HL(e.b));return{r:BL(aD(r+i*(lD(HL(t.r))-r))),g:BL(aD(s+i*(lD(HL(t.g))-s))),b:BL(aD(n+i*(lD(HL(t.b))-n))),a:e.a+i*(t.a-e.a)}}(this._rgb,e._rgb,t)),this}clone(){return new pD(this.rgb)}alpha(e){return this._rgb.a=BL(e),this}clearer(e){return this._rgb.a*=1-e,this}greyscale(){const e=this._rgb,t=UL(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=t,this}opaquer(e){return this._rgb.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return cD(this._rgb,2,e),this}darken(e){return cD(this._rgb,2,-e),this}saturate(e){return cD(this._rgb,1,e),this}desaturate(e){return cD(this._rgb,1,-e),this}rotate(e){return function(e,t){var i=QL(e);i[0]=iD(i[0]+t),i=tD(i),e.r=i[0],e.g=i[1],e.b=i[2]}(this._rgb,e),this}}function fD(e){return new pD(e)}function mD(e){if(e&&"object"==typeof e){const t=e.toString();return"[object CanvasPattern]"===t||"[object CanvasGradient]"===t}return!1}function gD(e){return mD(e)?e:fD(e)}function yD(e){return mD(e)?e:fD(e).saturate(.5).darken(.1).hexString()}const _D=Object.create(null),vD=Object.create(null);function bD(e,t){if(!t)return e;const i=t.split(".");for(let t=0,r=i.length;t<r;++t){const r=i[t];e=e[r]||(e[r]=Object.create(null))}return e}function wD(e,t,i){return"string"==typeof t?jI(bD(e,t),i):jI(bD(e,""),t)}var xD=new class{constructor(e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=e=>e.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(e,t)=>yD(t.backgroundColor),this.hoverBorderColor=(e,t)=>yD(t.borderColor),this.hoverColor=(e,t)=>yD(t.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e)}set(e,t){return wD(this,e,t)}get(e){return bD(this,e)}describe(e,t){return wD(vD,e,t)}override(e,t){return wD(_D,e,t)}route(e,t,i,r){const s=bD(this,e),n=bD(this,i),o="_"+t;Object.defineProperties(s,{[o]:{value:s[t],writable:!0},[t]:{enumerable:!0,get(){const e=this[o],t=n[r];return II(e)?Object.assign({},t,e):NI(e,t)},set(e){this[o]=e}}})}}({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function CD(e,t,i,r,s){let n=t[s];return n||(n=t[s]=e.measureText(s).width,i.push(s)),n>r&&(r=n),r}function TD(e,t,i,r){let s=(r=r||{}).data=r.data||{},n=r.garbageCollect=r.garbageCollect||[];r.font!==t&&(s=r.data={},n=r.garbageCollect=[],r.font=t),e.save(),e.font=t;let o=0;const a=i.length;let l,c,u,h,d;for(l=0;l<a;l++)if(h=i[l],null!=h&&!0!==PI(h))o=CD(e,s,n,o,h);else if(PI(h))for(c=0,u=h.length;c<u;c++)d=h[c],null==d||PI(d)||(o=CD(e,s,n,o,d));e.restore();const p=n.length/2;if(p>i.length){for(l=0;l<p;l++)delete s[n[l]];n.splice(0,p)}return o}function SD(e,t,i){const r=e.currentDevicePixelRatio,s=0!==i?Math.max(i/2,.5):0;return Math.round((t-s)*r)/r+s}function ED(e,t){(t=t||e.getContext("2d")).save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore()}function AD(e,t,i,r){MD(e,t,i,r,null)}function MD(e,t,i,r,s){let n,o,a,l,c,u;const h=t.pointStyle,d=t.rotation,p=t.radius;let f=(d||0)*iL;if(h&&"object"==typeof h&&(n=h.toString(),"[object HTMLImageElement]"===n||"[object HTMLCanvasElement]"===n))return e.save(),e.translate(i,r),e.rotate(f),e.drawImage(h,-h.width/2,-h.height/2,h.width,h.height),void e.restore();if(!(isNaN(p)||p<=0)){switch(e.beginPath(),h){default:s?e.ellipse(i,r,s/2,p,0,0,QI):e.arc(i,r,p,0,QI),e.closePath();break;case"triangle":e.moveTo(i+Math.sin(f)*p,r-Math.cos(f)*p),f+=nL,e.lineTo(i+Math.sin(f)*p,r-Math.cos(f)*p),f+=nL,e.lineTo(i+Math.sin(f)*p,r-Math.cos(f)*p),e.closePath();break;case"rectRounded":c=.516*p,l=p-c,o=Math.cos(f+sL)*l,a=Math.sin(f+sL)*l,e.arc(i-o,r-a,c,f-KI,f-rL),e.arc(i+a,r-o,c,f-rL,f),e.arc(i+o,r+a,c,f,f+rL),e.arc(i-a,r+o,c,f+rL,f+KI),e.closePath();break;case"rect":if(!d){l=Math.SQRT1_2*p,u=s?s/2:l,e.rect(i-u,r-l,2*u,2*l);break}f+=sL;case"rectRot":o=Math.cos(f)*p,a=Math.sin(f)*p,e.moveTo(i-o,r-a),e.lineTo(i+a,r-o),e.lineTo(i+o,r+a),e.lineTo(i-a,r+o),e.closePath();break;case"crossRot":f+=sL;case"cross":o=Math.cos(f)*p,a=Math.sin(f)*p,e.moveTo(i-o,r-a),e.lineTo(i+o,r+a),e.moveTo(i+a,r-o),e.lineTo(i-a,r+o);break;case"star":o=Math.cos(f)*p,a=Math.sin(f)*p,e.moveTo(i-o,r-a),e.lineTo(i+o,r+a),e.moveTo(i+a,r-o),e.lineTo(i-a,r+o),f+=sL,o=Math.cos(f)*p,a=Math.sin(f)*p,e.moveTo(i-o,r-a),e.lineTo(i+o,r+a),e.moveTo(i+a,r-o),e.lineTo(i-a,r+o);break;case"line":o=s?s/2:Math.cos(f)*p,a=Math.sin(f)*p,e.moveTo(i-o,r-a),e.lineTo(i+o,r+a);break;case"dash":e.moveTo(i,r),e.lineTo(i+Math.cos(f)*p,r+Math.sin(f)*p)}e.fill(),t.borderWidth>0&&e.stroke()}}function OD(e,t,i){return i=i||.5,!t||e&&e.x>t.left-i&&e.x<t.right+i&&e.y>t.top-i&&e.y<t.bottom+i}function RD(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function PD(e){e.restore()}function ID(e,t,i,r,s){if(!t)return e.lineTo(i.x,i.y);if("middle"===s){const r=(t.x+i.x)/2;e.lineTo(r,t.y),e.lineTo(r,i.y)}else"after"===s!=!!r?e.lineTo(t.x,i.y):e.lineTo(i.x,t.y);e.lineTo(i.x,i.y)}function LD(e,t,i,r){if(!t)return e.lineTo(i.x,i.y);e.bezierCurveTo(r?t.cp1x:t.cp2x,r?t.cp1y:t.cp2y,r?i.cp2x:i.cp1x,r?i.cp2y:i.cp1y,i.x,i.y)}function DD(e,t,i,r,s,n={}){const o=PI(t)?t:[t],a=n.strokeWidth>0&&""!==n.strokeColor;let l,c;for(e.save(),e.font=s.string,function(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),RI(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}(e,n),l=0;l<o.length;++l)c=o[l],a&&(n.strokeColor&&(e.strokeStyle=n.strokeColor),RI(n.strokeWidth)||(e.lineWidth=n.strokeWidth),e.strokeText(c,i,r,n.maxWidth)),e.fillText(c,i,r,n.maxWidth),ND(e,i,r,c,n),r+=s.lineHeight;e.restore()}function ND(e,t,i,r,s){if(s.strikethrough||s.underline){const n=e.measureText(r),o=t-n.actualBoundingBoxLeft,a=t+n.actualBoundingBoxRight,l=i-n.actualBoundingBoxAscent,c=i+n.actualBoundingBoxDescent,u=s.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=s.decorationWidth||2,e.moveTo(o,u),e.lineTo(a,u),e.stroke()}}function FD(e,t){const{x:i,y:r,w:s,h:n,radius:o}=t;e.arc(i+o.topLeft,r+o.topLeft,o.topLeft,-rL,KI,!0),e.lineTo(i,r+n-o.bottomLeft),e.arc(i+o.bottomLeft,r+n-o.bottomLeft,o.bottomLeft,KI,rL,!0),e.lineTo(i+s-o.bottomRight,r+n),e.arc(i+s-o.bottomRight,r+n-o.bottomRight,o.bottomRight,rL,0,!0),e.lineTo(i+s,r+o.topRight),e.arc(i+s-o.topRight,r+o.topRight,o.topRight,0,-rL,!0),e.lineTo(i+o.topLeft,r)}const kD=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),UD=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function VD(e,t){const i=(""+e).match(kD);if(!i||"normal"===i[1])return 1.2*t;switch(e=+i[2],i[3]){case"px":return e;case"%":e/=100}return t*e}function zD(e,t){const i={},r=II(t),s=r?Object.keys(t):t,n=II(e)?r?i=>NI(e[i],e[t[i]]):t=>e[t]:()=>e;for(const e of s)i[e]=+n(e)||0;return i}function BD(e){return zD(e,{top:"y",right:"x",bottom:"y",left:"x"})}function HD(e){return zD(e,["topLeft","topRight","bottomLeft","bottomRight"])}function jD(e){const t=BD(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function GD(e,t){e=e||{},t=t||xD.font;let i=NI(e.size,t.size);"string"==typeof i&&(i=parseInt(i,10));let r=NI(e.style,t.style);r&&!(""+r).match(UD)&&(console.warn('Invalid font style specified: "'+r+'"'),r="");const s={family:NI(e.family,t.family),lineHeight:VD(NI(e.lineHeight,t.lineHeight),i),size:i,style:r,weight:NI(e.weight,t.weight),string:""};return s.string=function(e){return!e||RI(e.size)||RI(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}(s),s}function WD(e,t,i,r){let s,n,o,a=!0;for(s=0,n=e.length;s<n;++s)if(o=e[s],void 0!==o&&(void 0!==t&&"function"==typeof o&&(o=o(t),a=!1),void 0!==i&&PI(o)&&(o=o[i%o.length],a=!1),void 0!==o))return r&&!a&&(r.cacheable=!1),o}function ZD(e,t){return Object.assign(Object.create(e),t)}function qD(e,t=[""],i=e,r,s=(()=>e[0])){YI(r)||(r=sN("_fallback",e));const n={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:i,_fallback:r,_getTarget:s,override:s=>qD([s,...e],t,i,r)};return new Proxy(n,{deleteProperty:(t,i)=>(delete t[i],delete t._keys,delete e[0][i],!0),get:(i,r)=>KD(i,r,(()=>function(e,t,i,r){let s;for(const n of t)if(s=sN(XD(n,e),i),YI(s))return JD(e,s)?iN(i,r,e,s):s}(r,t,e,i))),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e._scopes[0],t),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(e,t)=>nN(e).includes(t),ownKeys:e=>nN(e),set(e,t,i){const r=e._storage||(e._storage=s());return e[t]=r[t]=i,delete e._keys,!0}})}function $D(e,t,i,r){const s={_cacheable:!1,_proxy:e,_context:t,_subProxy:i,_stack:new Set,_descriptors:YD(e,r),setContext:t=>$D(e,t,i,r),override:s=>$D(e.override(s),t,i,r)};return new Proxy(s,{deleteProperty:(t,i)=>(delete t[i],delete e[i],!0),get:(e,t,i)=>KD(e,t,(()=>function(e,t,i){const{_proxy:r,_context:s,_subProxy:n,_descriptors:o}=e;let a=r[t];return XI(a)&&o.isScriptable(t)&&(a=function(e,t,i,r){const{_proxy:s,_context:n,_subProxy:o,_stack:a}=i;if(a.has(e))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+e);return a.add(e),t=t(n,o||r),a.delete(e),JD(e,t)&&(t=iN(s._scopes,s,e,t)),t}(t,a,e,i)),PI(a)&&a.length&&(a=function(e,t,i,r){const{_proxy:s,_context:n,_subProxy:o,_descriptors:a}=i;if(YI(n.index)&&r(e))t=t[n.index%t.length];else if(II(t[0])){const i=t,r=s._scopes.filter((e=>e!==i));t=[];for(const l of i){const i=iN(r,s,e,l);t.push($D(i,n,o&&o[e],a))}}return t}(t,a,e,o.isIndexable)),JD(t,a)&&(a=$D(a,s,n&&n[t],o)),a}(e,t,i))),getOwnPropertyDescriptor:(t,i)=>t._descriptors.allKeys?Reflect.has(e,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,i),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(t,i)=>Reflect.has(e,i),ownKeys:()=>Reflect.ownKeys(e),set:(t,i,r)=>(e[i]=r,delete t[i],!0)})}function YD(e,t={scriptable:!0,indexable:!0}){const{_scriptable:i=t.scriptable,_indexable:r=t.indexable,_allKeys:s=t.allKeys}=e;return{allKeys:s,scriptable:i,indexable:r,isScriptable:XI(i)?i:()=>i,isIndexable:XI(r)?r:()=>r}}const XD=(e,t)=>e?e+$I(t):t,JD=(e,t)=>II(t)&&"adapters"!==e&&(null===Object.getPrototypeOf(t)||t.constructor===Object);function KD(e,t,i){if(Object.prototype.hasOwnProperty.call(e,t))return e[t];const r=i();return e[t]=r,r}function QD(e,t,i){return XI(e)?e(t,i):e}const eN=(e,t)=>!0===e?t:"string"==typeof e?qI(t,e):void 0;function tN(e,t,i,r,s){for(const n of t){const t=eN(i,n);if(t){e.add(t);const n=QD(t._fallback,i,s);if(YI(n)&&n!==i&&n!==r)return n}else if(!1===t&&YI(r)&&i!==r)return null}return!1}function iN(e,t,i,r){const s=t._rootScopes,n=QD(t._fallback,i,r),o=[...e,...s],a=new Set;a.add(r);let l=rN(a,o,i,n||i,r);return null!==l&&(!YI(n)||n===i||(l=rN(a,o,n,l,r),null!==l))&&qD(Array.from(a),[""],s,n,(()=>function(e,t,i){const r=e._getTarget();t in r||(r[t]={});const s=r[t];return PI(s)&&II(i)?i:s}(t,i,r)))}function rN(e,t,i,r,s){for(;i;)i=tN(e,t,i,r,s);return i}function sN(e,t){for(const i of t){if(!i)continue;const t=i[e];if(YI(t))return t}}function nN(e){let t=e._keys;return t||(t=e._keys=function(e){const t=new Set;for(const i of e)for(const e of Object.keys(i).filter((e=>!e.startsWith("_"))))t.add(e);return Array.from(t)}(e._scopes)),t}function oN(e,t,i,r){const{iScale:s}=e,{key:n="r"}=this._parsing,o=new Array(r);let a,l,c,u;for(a=0,l=r;a<l;++a)c=a+i,u=t[c],o[a]={r:s.parse(qI(u,n),c)};return o}const aN=Number.EPSILON||1e-14,lN=(e,t)=>t<e.length&&!e[t].skip&&e[t],cN=e=>"x"===e?"y":"x";function uN(e,t,i,r){const s=e.skip?t:e,n=t,o=i.skip?t:i,a=gL(n,s),l=gL(o,n);let c=a/(a+l),u=l/(a+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const h=r*c,d=r*u;return{previous:{x:n.x-h*(o.x-s.x),y:n.y-h*(o.y-s.y)},next:{x:n.x+d*(o.x-s.x),y:n.y+d*(o.y-s.y)}}}function hN(e,t,i){return Math.max(Math.min(e,i),t)}function dN(e,t,i,r,s){let n,o,a,l;if(t.spanGaps&&(e=e.filter((e=>!e.skip))),"monotone"===t.cubicInterpolationMode)!function(e,t="x"){const i=cN(t),r=e.length,s=Array(r).fill(0),n=Array(r);let o,a,l,c=lN(e,0);for(o=0;o<r;++o)if(a=l,l=c,c=lN(e,o+1),l){if(c){const e=c[t]-l[t];s[o]=0!==e?(c[i]-l[i])/e:0}n[o]=a?c?aL(s[o-1])!==aL(s[o])?0:(s[o-1]+s[o])/2:s[o-1]:s[o]}!function(e,t,i){const r=e.length;let s,n,o,a,l,c=lN(e,0);for(let u=0;u<r-1;++u)l=c,c=lN(e,u+1),l&&c&&(uL(t[u],0,aN)?i[u]=i[u+1]=0:(s=i[u]/t[u],n=i[u+1]/t[u],a=Math.pow(s,2)+Math.pow(n,2),a<=9||(o=3/Math.sqrt(a),i[u]=s*o*t[u],i[u+1]=n*o*t[u])))}(e,s,n),function(e,t,i="x"){const r=cN(i),s=e.length;let n,o,a,l=lN(e,0);for(let c=0;c<s;++c){if(o=a,a=l,l=lN(e,c+1),!a)continue;const s=a[i],u=a[r];o&&(n=(s-o[i])/3,a[`cp1${i}`]=s-n,a[`cp1${r}`]=u-n*t[c]),l&&(n=(l[i]-s)/3,a[`cp2${i}`]=s+n,a[`cp2${r}`]=u+n*t[c])}}(e,n,t)}(e,s);else{let i=r?e[e.length-1]:e[0];for(n=0,o=e.length;n<o;++n)a=e[n],l=uN(i,a,e[Math.min(n+1,o-(r?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,i=a}t.capBezierPoints&&function(e,t){let i,r,s,n,o,a=OD(e[0],t);for(i=0,r=e.length;i<r;++i)o=n,n=a,a=i<r-1&&OD(e[i+1],t),n&&(s=e[i],o&&(s.cp1x=hN(s.cp1x,t.left,t.right),s.cp1y=hN(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=hN(s.cp2x,t.left,t.right),s.cp2y=hN(s.cp2y,t.top,t.bottom)))}(e,i)}function pN(){return"undefined"!=typeof window&&"undefined"!=typeof document}function fN(e){let t=e.parentNode;return t&&"[object ShadowRoot]"===t.toString()&&(t=t.host),t}function mN(e,t,i){let r;return"string"==typeof e?(r=parseInt(e,10),-1!==e.indexOf("%")&&(r=r/100*t.parentNode[i])):r=e,r}const gN=e=>window.getComputedStyle(e,null),yN=["top","right","bottom","left"];function _N(e,t,i){const r={};i=i?"-"+i:"";for(let s=0;s<4;s++){const n=yN[s];r[n]=parseFloat(e[t+"-"+n+i])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function vN(e,t){if("native"in e)return e;const{canvas:i,currentDevicePixelRatio:r}=t,s=gN(i),n="border-box"===s.boxSizing,o=_N(s,"padding"),a=_N(s,"border","width"),{x:l,y:c,box:u}=function(e,t){const i=e.touches,r=i&&i.length?i[0]:e,{offsetX:s,offsetY:n}=r;let o,a,l=!1;if(((e,t,i)=>(e>0||t>0)&&(!i||!i.shadowRoot))(s,n,e.target))o=s,a=n;else{const e=t.getBoundingClientRect();o=r.clientX-e.left,a=r.clientY-e.top,l=!0}return{x:o,y:a,box:l}}(e,i),h=o.left+(u&&a.left),d=o.top+(u&&a.top);let{width:p,height:f}=t;return n&&(p-=o.width+a.width,f-=o.height+a.height),{x:Math.round((l-h)/p*i.width/r),y:Math.round((c-d)/f*i.height/r)}}const bN=e=>Math.round(10*e)/10;function wN(e,t,i){const r=t||1,s=Math.floor(e.height*r),n=Math.floor(e.width*r);e.height=s/r,e.width=n/r;const o=e.canvas;return o.style&&(i||!o.style.height&&!o.style.width)&&(o.style.height=`${e.height}px`,o.style.width=`${e.width}px`),(e.currentDevicePixelRatio!==r||o.height!==s||o.width!==n)&&(e.currentDevicePixelRatio=r,o.height=s,o.width=n,e.ctx.setTransform(r,0,0,r,0,0),!0)}const xN=function(){let e=!1;try{const t={get passive(){return e=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e}();function CN(e,t){const i=function(e,t){return gN(e).getPropertyValue(t)}(e,t),r=i&&i.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function TN(e,t,i,r){return{x:e.x+i*(t.x-e.x),y:e.y+i*(t.y-e.y)}}function SN(e,t,i,r){return{x:e.x+i*(t.x-e.x),y:"middle"===r?i<.5?e.y:t.y:"after"===r?i<1?e.y:t.y:i>0?t.y:e.y}}function EN(e,t,i,r){const s={x:e.cp2x,y:e.cp2y},n={x:t.cp1x,y:t.cp1y},o=TN(e,s,i),a=TN(s,n,i),l=TN(n,t,i),c=TN(o,a,i),u=TN(a,l,i);return TN(c,u,i)}const AN=new Map;function MN(e,t,i){return function(e,t){t=t||{};const i=e+JSON.stringify(t);let r=AN.get(i);return r||(r=new Intl.NumberFormat(e,t),AN.set(i,r)),r}(t,i).format(e)}function ON(e,t,i){return e?function(e,t){return{x:i=>e+e+t-i,setWidth(e){t=e},textAlign:e=>"center"===e?e:"right"===e?"left":"right",xPlus:(e,t)=>e-t,leftForLtr:(e,t)=>e-t}}(t,i):{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,t)=>e+t,leftForLtr:(e,t)=>e}}function RN(e,t){let i,r;"ltr"!==t&&"rtl"!==t||(i=e.canvas.style,r=[i.getPropertyValue("direction"),i.getPropertyPriority("direction")],i.setProperty("direction",t,"important"),e.prevTextDirection=r)}function PN(e,t){void 0!==t&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function IN(e){return"angle"===e?{between:vL,compare:yL,normalize:_L}:{between:wL,compare:(e,t)=>e-t,normalize:e=>e}}function LN({start:e,end:t,count:i,loop:r,style:s}){return{start:e%i,end:t%i,loop:r&&(t-e+1)%i==0,style:s}}function DN(e,t,i){if(!i)return[e];const{property:r,start:s,end:n}=i,o=t.length,{compare:a,between:l,normalize:c}=IN(r),{start:u,end:h,loop:d,style:p}=function(e,t,i){const{property:r,start:s,end:n}=i,{between:o,normalize:a}=IN(r),l=t.length;let c,u,{start:h,end:d,loop:p}=e;if(p){for(h+=l,d+=l,c=0,u=l;c<u&&o(a(t[h%l][r]),s,n);++c)h--,d--;h%=l,d%=l}return d<h&&(d+=l),{start:h,end:d,loop:p,style:e.style}}(e,t,i),f=[];let m,g,y,_=!1,v=null;for(let e=u,i=u;e<=h;++e)g=t[e%o],g.skip||(m=c(g[r]),m!==y&&(_=l(m,s,n),null===v&&(_||l(s,y,m)&&0!==a(s,y))&&(v=0===a(m,s)?e:i),null!==v&&(!_||0===a(n,m)||l(n,y,m))&&(f.push(LN({start:v,end:e,loop:d,count:o,style:p})),v=null),i=e,y=m));return null!==v&&f.push(LN({start:v,end:h,loop:d,count:o,style:p})),f}function NN(e,t){const i=[],r=e.segments;for(let s=0;s<r.length;s++){const n=DN(r[s],e.points,t);n.length&&i.push(...n)}return i}function FN(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function kN(e,t){return t&&JSON.stringify(e)!==JSON.stringify(t)}var UN=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,i,r){const s=t.listeners[r],n=t.duration;s.forEach((r=>r({chart:e,initial:t.initial,numSteps:n,currentStep:Math.min(i-t.start,n)})))}_refresh(){this._request||(this._running=!0,this._request=ML.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(e=Date.now()){let t=0;this._charts.forEach(((i,r)=>{if(!i.running||!i.items.length)return;const s=i.items;let n,o=s.length-1,a=!1;for(;o>=0;--o)n=s[o],n._active?(n._total>i.duration&&(i.duration=n._total),n.tick(e),a=!0):(s[o]=s[s.length-1],s.pop());a&&(r.draw(),this._notify(r,i,e,"progress")),s.length||(i.running=!1,this._notify(r,i,e,"complete"),i.initial=!1),t+=s.length})),this._lastDate=e,0===t&&(this._running=!1)}_getAnims(e){const t=this._charts;let i=t.get(e);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,i)),i}listen(e,t,i){this._getAnims(e).listeners[t].push(i)}add(e,t){t&&t.length&&this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce(((e,t)=>Math.max(e,t._duration)),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!!(t&&t.running&&t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const i=t.items;let r=i.length-1;for(;r>=0;--r)i[r].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}};const VN="transparent",zN={boolean:(e,t,i)=>i>.5?t:e,color(e,t,i){const r=gD(e||VN),s=r.valid&&gD(t||VN);return s&&s.valid?s.mix(r,i).hexString():t},number:(e,t,i)=>e+(t-e)*i};class BN{constructor(e,t,i,r){const s=t[i];r=WD([e.to,r,s,e.from]);const n=WD([e.from,s,r]);this._active=!0,this._fn=e.fn||zN[e.type||typeof n],this._easing=kL[e.easing]||kL.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=i,this._from=n,this._to=r,this._promises=void 0}active(){return this._active}update(e,t,i){if(this._active){this._notify(!1);const r=this._target[this._prop],s=i-this._start,n=this._duration-s;this._start=i,this._duration=Math.floor(Math.max(n,e.duration)),this._total+=s,this._loop=!!e.loop,this._to=WD([e.to,t,r,e.from]),this._from=WD([e.from,r,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,i=this._duration,r=this._prop,s=this._from,n=this._loop,o=this._to;let a;if(this._active=s!==o&&(n||t<i),!this._active)return this._target[r]=o,void this._notify(!0);t<0?this._target[r]=s:(a=t/i%2,a=n&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[r]=this._fn(s,o,a))}wait(){const e=this._promises||(this._promises=[]);return new Promise(((t,i)=>{e.push({res:t,rej:i})}))}_notify(e){const t=e?"res":"rej",i=this._promises||[];for(let e=0;e<i.length;e++)i[e][t]()}}xD.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const HN=Object.keys(xD.animation);xD.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),xD.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),xD.describe("animations",{_fallback:"animation"}),xD.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}});class jN{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!II(e))return;const t=this._properties;Object.getOwnPropertyNames(e).forEach((i=>{const r=e[i];if(!II(r))return;const s={};for(const e of HN)s[e]=r[e];(PI(r.properties)&&r.properties||[i]).forEach((e=>{e!==i&&t.has(e)||t.set(e,s)}))}))}_animateOptions(e,t){const i=t.options,r=function(e,t){if(!t)return;let i=e.options;if(i)return i.$shared&&(e.options=i=Object.assign({},i,{$shared:!1,$animations:{}})),i;e.options=t}(e,i);if(!r)return[];const s=this._createAnimations(r,i);return i.$shared&&function(e,t){const i=[],r=Object.keys(t);for(let t=0;t<r.length;t++){const s=e[r[t]];s&&s.active()&&i.push(s.wait())}return Promise.all(i)}(e.options.$animations,i).then((()=>{e.options=i}),(()=>{})),s}_createAnimations(e,t){const i=this._properties,r=[],s=e.$animations||(e.$animations={}),n=Object.keys(t),o=Date.now();let a;for(a=n.length-1;a>=0;--a){const l=n[a];if("$"===l.charAt(0))continue;if("options"===l){r.push(...this._animateOptions(e,t));continue}const c=t[l];let u=s[l];const h=i.get(l);if(u){if(h&&u.active()){u.update(h,c,o);continue}u.cancel()}h&&h.duration?(s[l]=u=new BN(h,e,l,c),r.push(u)):e[l]=c}return r}update(e,t){if(0===this._properties.size)return void Object.assign(e,t);const i=this._createAnimations(e,t);return i.length?(UN.add(this._chart,i),!0):void 0}}function GN(e,t){const i=e&&e.options||{},r=i.reverse,s=void 0===i.min?t:0,n=void 0===i.max?t:0;return{start:r?n:s,end:r?s:n}}function WN(e,t){const i=[],r=e._getSortedDatasetMetas(t);let s,n;for(s=0,n=r.length;s<n;++s)i.push(r[s].index);return i}function ZN(e,t,i,r={}){const s=e.keys,n="single"===r.mode;let o,a,l,c;if(null!==t){for(o=0,a=s.length;o<a;++o){if(l=+s[o],l===i){if(r.all)continue;break}c=e.values[l],LI(c)&&(n||0===t||aL(t)===aL(c))&&(t+=c)}return t}}function qN(e,t){const i=e&&e.options.stacked;return i||void 0===i&&void 0!==t.stack}function $N(e,t,i){const r=e[t]||(e[t]={});return r[i]||(r[i]={})}function YN(e,t,i,r){for(const s of t.getMatchingVisibleMetas(r).reverse()){const t=e[s.index];if(i&&t>0||!i&&t<0)return s.index}return null}function XN(e,t){const{chart:i,_cachedMeta:r}=e,s=i._stacks||(i._stacks={}),{iScale:n,vScale:o,index:a}=r,l=n.axis,c=o.axis,u=function(e,t,i){return`${e.id}.${t.id}.${i.stack||i.type}`}(n,o,r),h=t.length;let d;for(let e=0;e<h;++e){const i=t[e],{[l]:n,[c]:h}=i;d=(i._stacks||(i._stacks={}))[c]=$N(s,u,n),d[a]=h,d._top=YN(d,o,!0,r.type),d._bottom=YN(d,o,!1,r.type)}}function JN(e,t){const i=e.scales;return Object.keys(i).filter((e=>i[e].axis===t)).shift()}function KN(e,t){const i=e.controller.index,r=e.vScale&&e.vScale.axis;if(r){t=t||e._parsed;for(const e of t){const t=e._stacks;if(!t||void 0===t[r]||void 0===t[r][i])return;delete t[r][i]}}}const QN=e=>"reset"===e||"none"===e,eF=(e,t)=>t?e:Object.assign({},e);class tF{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=qN(e.vScale,e),this.addElements()}updateIndex(e){this.index!==e&&KN(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,i=this.getDataset(),r=(e,t,i,r)=>"x"===e?t:"r"===e?r:i,s=t.xAxisID=NI(i.xAxisID,JN(e,"x")),n=t.yAxisID=NI(i.yAxisID,JN(e,"y")),o=t.rAxisID=NI(i.rAxisID,JN(e,"r")),a=t.indexAxis,l=t.iAxisID=r(a,s,n,o),c=t.vAxisID=r(a,n,s,o);t.xScale=this.getScaleForId(s),t.yScale=this.getScaleForId(n),t.rScale=this.getScaleForId(o),t.iScale=this.getScaleForId(l),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&EL(this._data,this),e._stacked&&KN(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),i=this._data;if(II(t))this._data=function(e){const t=Object.keys(e),i=new Array(t.length);let r,s,n;for(r=0,s=t.length;r<s;++r)n=t[r],i[r]={x:n,y:e[n]};return i}(t);else if(i!==t){if(i){EL(i,this);const e=this._cachedMeta;KN(e),e._parsed=[]}t&&Object.isExtensible(t)&&(this,(r=t)._chartjs?r._chartjs.listeners.push(this):(Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[this]}}),SL.forEach((e=>{const t="_onData"+$I(e),i=r[e];Object.defineProperty(r,e,{configurable:!0,enumerable:!1,value(...e){const s=i.apply(this,e);return r._chartjs.listeners.forEach((i=>{"function"==typeof i[t]&&i[t](...e)})),s}})})))),this._syncList=[],this._data=t}var r}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,i=this.getDataset();let r=!1;this._dataCheck();const s=t._stacked;t._stacked=qN(t.vScale,t),t.stack!==i.stack&&(r=!0,KN(t),t.stack=i.stack),this._resyncElements(e),(r||s!==t._stacked)&&XN(this,t._parsed)}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),i=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:i,_data:r}=this,{iScale:s,_stacked:n}=i,o=s.axis;let a,l,c,u=0===e&&t===r.length||i._sorted,h=e>0&&i._parsed[e-1];if(!1===this._parsing)i._parsed=r,i._sorted=!0,c=r;else{c=PI(r[e])?this.parseArrayData(i,r,e,t):II(r[e])?this.parseObjectData(i,r,e,t):this.parsePrimitiveData(i,r,e,t);const s=()=>null===l[o]||h&&l[o]<h[o];for(a=0;a<t;++a)i._parsed[a+e]=l=c[a],u&&(s()&&(u=!1),h=l);i._sorted=u}n&&XN(this,c)}parsePrimitiveData(e,t,i,r){const{iScale:s,vScale:n}=e,o=s.axis,a=n.axis,l=s.getLabels(),c=s===n,u=new Array(r);let h,d,p;for(h=0,d=r;h<d;++h)p=h+i,u[h]={[o]:c||s.parse(l[p],p),[a]:n.parse(t[p],p)};return u}parseArrayData(e,t,i,r){const{xScale:s,yScale:n}=e,o=new Array(r);let a,l,c,u;for(a=0,l=r;a<l;++a)c=a+i,u=t[c],o[a]={x:s.parse(u[0],c),y:n.parse(u[1],c)};return o}parseObjectData(e,t,i,r){const{xScale:s,yScale:n}=e,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l=new Array(r);let c,u,h,d;for(c=0,u=r;c<u;++c)h=c+i,d=t[h],l[c]={x:s.parse(qI(d,o),h),y:n.parse(qI(d,a),h)};return l}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,i){const r=this.chart,s=this._cachedMeta,n=t[e.axis];return ZN({keys:WN(r,!0),values:t._stacks[e.axis]},n,s.index,{mode:i})}updateRangeFromParsed(e,t,i,r){const s=i[t.axis];let n=null===s?NaN:s;const o=r&&i._stacks[t.axis];r&&o&&(r.values=o,n=ZN(r,s,this._cachedMeta.index)),e.min=Math.min(e.min,n),e.max=Math.max(e.max,n)}getMinMax(e,t){const i=this._cachedMeta,r=i._parsed,s=i._sorted&&e===i.iScale,n=r.length,o=this._getOtherScale(e),a=((e,t,i)=>e&&!t.hidden&&t._stacked&&{keys:WN(i,!0),values:null})(t,i,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:u}=function(e){const{min:t,max:i,minDefined:r,maxDefined:s}=e.getUserBounds();return{min:r?t:Number.NEGATIVE_INFINITY,max:s?i:Number.POSITIVE_INFINITY}}(o);let h,d;function p(){d=r[h];const t=d[o.axis];return!LI(d[e.axis])||c>t||u<t}for(h=0;h<n&&(p()||(this.updateRangeFromParsed(l,e,d,a),!s));++h);if(s)for(h=n-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(l,e,d,a);break}return l}getAllParsedValues(e){const t=this._cachedMeta._parsed,i=[];let r,s,n;for(r=0,s=t.length;r<s;++r)n=t[r][e.axis],LI(n)&&i.push(n);return i}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,i=t.iScale,r=t.vScale,s=this.getParsed(e);return{label:i?""+i.getLabelForValue(s[i.axis]):"",value:r?""+r.getLabelForValue(s[r.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=function(e){let t,i,r,s;return II(e)?(t=e.top,i=e.right,r=e.bottom,s=e.left):t=i=r=s=e,{top:t,right:i,bottom:r,left:s,disabled:!1===e}}(NI(this.options.clip,function(e,t,i){if(!1===i)return!1;const r=GN(e,i),s=GN(t,i);return{top:s.end,right:r.end,bottom:s.start,left:r.start}}(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,i=this._cachedMeta,r=i.data||[],s=t.chartArea,n=[],o=this._drawStart||0,a=this._drawCount||r.length-o,l=this.options.drawActiveElementsOnTop;let c;for(i.dataset&&i.dataset.draw(e,s,o,a),c=o;c<o+a;++c){const t=r[c];t.hidden||(t.active&&l?n.push(t):t.draw(e,s))}for(c=0;c<n.length;++c)n[c].draw(e,s)}getStyle(e,t){const i=t?"active":"default";return void 0===e&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(e||0,i)}getContext(e,t,i){const r=this.getDataset();let s;if(e>=0&&e<this._cachedMeta.data.length){const t=this._cachedMeta.data[e];s=t.$context||(t.$context=function(e,t,i){return ZD(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:i,index:t,mode:"default",type:"data"})}(this.getContext(),e,t)),s.parsed=this.getParsed(e),s.raw=r.data[e],s.index=s.dataIndex=e}else s=this.$context||(this.$context=function(e,t){return ZD(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),s.dataset=r,s.index=s.datasetIndex=this.index;return s.active=!!t,s.mode=i,s}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",i){const r="active"===t,s=this._cachedDataOpts,n=e+"-"+t,o=s[n],a=this.enableOptionSharing&&YI(i);if(o)return eF(o,a);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,e),u=r?[`${e}Hover`,"hover",e,""]:[e,""],h=l.getOptionScopes(this.getDataset(),c),d=Object.keys(xD.elements[e]),p=l.resolveNamedOptions(h,d,(()=>this.getContext(i,r)),u);return p.$shared&&(p.$shared=a,s[n]=Object.freeze(eF(p,a))),p}_resolveAnimations(e,t,i){const r=this.chart,s=this._cachedDataOpts,n=`animation-${t}`,o=s[n];if(o)return o;let a;if(!1!==r.options.animation){const r=this.chart.config,s=r.datasetAnimationScopeKeys(this._type,t),n=r.getOptionScopes(this.getDataset(),s);a=r.createResolver(n,this.getContext(e,i,t))}const l=new jN(r,a&&a.animations);return a&&a._cacheable&&(s[n]=Object.freeze(l)),l}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||QN(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const i=this.resolveDataElementOptions(e,t),r=this._sharedOptions,s=this.getSharedOptions(i),n=this.includeOptions(t,s)||s!==r;return this.updateSharedOptions(s,t,i),{sharedOptions:s,includeOptions:n}}updateElement(e,t,i,r){QN(r)?Object.assign(e,i):this._resolveAnimations(t,r).update(e,i)}updateSharedOptions(e,t,i){e&&!QN(t)&&this._resolveAnimations(void 0,t).update(e,i)}_setStyle(e,t,i,r){e.active=r;const s=this.getStyle(t,r);this._resolveAnimations(t,i,r).update(e,{options:!r&&this.getSharedOptions(s)||s})}removeHoverStyle(e,t,i){this._setStyle(e,i,"active",!1)}setHoverStyle(e,t,i){this._setStyle(e,i,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,i=this._cachedMeta.data;for(const[e,t,i]of this._syncList)this[e](t,i);this._syncList=[];const r=i.length,s=t.length,n=Math.min(s,r);n&&this.parse(0,n),s>r?this._insertElements(r,s-r,e):s<r&&this._removeElements(s,r-s)}_insertElements(e,t,i=!0){const r=this._cachedMeta,s=r.data,n=e+t;let o;const a=e=>{for(e.length+=t,o=e.length-1;o>=n;o--)e[o]=e[o-t]};for(a(s),o=e;o<n;++o)s[o]=new this.dataElementType;this._parsing&&a(r._parsed),this.parse(e,t),i&&this.updateElements(s,e,t,"reset")}updateElements(e,t,i,r){}_removeElements(e,t){const i=this._cachedMeta;if(this._parsing){const r=i._parsed.splice(e,t);i._stacked&&KN(i,r)}i.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,i,r]=e;this[t](i,r)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const i=arguments.length-2;i&&this._sync(["_insertElements",e,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function iF(e){const t=e.iScale,i=function(e,t){if(!e._cache.$bar){const i=e.getMatchingVisibleMetas(t);let r=[];for(let t=0,s=i.length;t<s;t++)r=r.concat(i[t].controller.getAllParsedValues(e));e._cache.$bar=AL(r.sort(((e,t)=>e-t)))}return e._cache.$bar}(t,e.type);let r,s,n,o,a=t._length;const l=()=>{32767!==n&&-32768!==n&&(YI(o)&&(a=Math.min(a,Math.abs(n-o)||a)),o=n)};for(r=0,s=i.length;r<s;++r)n=t.getPixelForValue(i[r]),l();for(o=void 0,r=0,s=t.ticks.length;r<s;++r)n=t.getPixelForTick(r),l();return a}function rF(e,t,i,r){return PI(e)?function(e,t,i,r){const s=i.parse(e[0],r),n=i.parse(e[1],r),o=Math.min(s,n),a=Math.max(s,n);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[i.axis]=c,t._custom={barStart:l,barEnd:c,start:s,end:n,min:o,max:a}}(e,t,i,r):t[i.axis]=i.parse(e,r),t}function sF(e,t,i,r){const s=e.iScale,n=e.vScale,o=s.getLabels(),a=s===n,l=[];let c,u,h,d;for(c=i,u=i+r;c<u;++c)d=t[c],h={},h[s.axis]=a||s.parse(o[c],c),l.push(rF(d,h,n,c));return l}function nF(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function oF(e,t,i,r){let s=t.borderSkipped;const n={};if(!s)return void(e.borderSkipped=n);if(!0===s)return void(e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:o,end:a,reverse:l,top:c,bottom:u}=function(e){let t,i,r,s,n;return e.horizontal?(t=e.base>e.x,i="left",r="right"):(t=e.base<e.y,i="bottom",r="top"),t?(s="end",n="start"):(s="start",n="end"),{start:i,end:r,reverse:t,top:s,bottom:n}}(e);"middle"===s&&i&&(e.enableBorderRadius=!0,(i._top||0)===r?s=c:(i._bottom||0)===r?s=u:(n[aF(u,o,a,l)]=!0,s=c)),n[aF(s,o,a,l)]=!0,e.borderSkipped=n}function aF(e,t,i,r){var s,n,o;return r?(o=i,e=lF(e=(s=e)===(n=t)?o:s===o?n:s,i,t)):e=lF(e,t,i),e}function lF(e,t,i){return"start"===e?t:"end"===e?i:e}function cF(e,{inflateAmount:t},i){e.inflateAmount="auto"===t?1===i?.33:0:t}tF.defaults={},tF.prototype.datasetElementType=null,tF.prototype.dataElementType=null;class uF extends tF{parsePrimitiveData(e,t,i,r){return sF(e,t,i,r)}parseArrayData(e,t,i,r){return sF(e,t,i,r)}parseObjectData(e,t,i,r){const{iScale:s,vScale:n}=e,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l="x"===s.axis?o:a,c="x"===n.axis?o:a,u=[];let h,d,p,f;for(h=i,d=i+r;h<d;++h)f=t[h],p={},p[s.axis]=s.parse(qI(f,l),h),u.push(rF(qI(f,c),p,n,h));return u}updateRangeFromParsed(e,t,i,r){super.updateRangeFromParsed(e,t,i,r);const s=i._custom;s&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,s.min),e.max=Math.max(e.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:i,vScale:r}=t,s=this.getParsed(e),n=s._custom,o=nF(n)?"["+n.start+", "+n.end+"]":""+r.getLabelForValue(s[r.axis]);return{label:""+i.getLabelForValue(s[i.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,i,r){const s="reset"===r,{index:n,_cachedMeta:{vScale:o}}=this,a=o.getBasePixel(),l=o.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(t,r);for(let d=t;d<t+i;d++){const t=this.getParsed(d),i=s||RI(t[o.axis])?{base:a,head:a}:this._calculateBarValuePixels(d),p=this._calculateBarIndexPixels(d,c),f=(t._stacks||{})[o.axis],m={horizontal:l,base:i.base,enableBorderRadius:!f||nF(t._custom)||n===f._top||n===f._bottom,x:l?i.head:p.center,y:l?p.center:i.head,height:l?p.size:Math.abs(i.size),width:l?Math.abs(i.size):p.size};h&&(m.options=u||this.resolveDataElementOptions(d,e[d].active?"active":r));const g=m.options||e[d].options;oF(m,g,f,n),cF(m,g,c.ratio),this.updateElement(e[d],d,m,r)}}_getStacks(e,t){const{iScale:i}=this._cachedMeta,r=i.getMatchingVisibleMetas(this._type).filter((e=>e.controller.options.grouped)),s=i.options.stacked,n=[],o=e=>{const i=e.controller.getParsed(t),r=i&&i[e.vScale.axis];if(RI(r)||isNaN(r))return!0};for(const i of r)if((void 0===t||!o(i))&&((!1===s||-1===n.indexOf(i.stack)||void 0===s&&void 0===i.stack)&&n.push(i.stack),i.index===e))break;return n.length||n.push(void 0),n}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,i){const r=this._getStacks(e,i),s=void 0!==t?r.indexOf(t):-1;return-1===s?r.length-1:s}_getRuler(){const e=this.options,t=this._cachedMeta,i=t.iScale,r=[];let s,n;for(s=0,n=t.data.length;s<n;++s)r.push(i.getPixelForValue(this.getParsed(s)[i.axis],s));const o=e.barThickness;return{min:o||iF(t),pixels:r,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:e.grouped,ratio:o?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:i},options:{base:r,minBarLength:s}}=this,n=r||0,o=this.getParsed(e),a=o._custom,l=nF(a);let c,u,h=o[t.axis],d=0,p=i?this.applyStack(t,o,i):h;p!==h&&(d=p-h,p=h),l&&(h=a.barStart,p=a.barEnd-a.barStart,0!==h&&aL(h)!==aL(a.barEnd)&&(d=0),d+=h);const f=RI(r)||l?d:r;let m=t.getPixelForValue(f);if(c=this.chart.getDataVisibility(e)?t.getPixelForValue(d+p):m,u=c-m,Math.abs(u)<s){u=function(e,t,i){return 0!==e?aL(e):(t.isHorizontal()?1:-1)*(t.min>=i?1:-1)}(u,t,n)*s,h===n&&(m-=u/2);const e=t.getPixelForDecimal(0),i=t.getPixelForDecimal(1),r=Math.min(e,i),o=Math.max(e,i);m=Math.max(Math.min(m,o),r),c=m+u}if(m===t.getPixelForValue(n)){const e=aL(u)*t.getLineWidthForValue(n)/2;m+=e,u-=e}return{size:u,base:m,head:c,center:c+u/2}}_calculateBarIndexPixels(e,t){const i=t.scale,r=this.options,s=r.skipNull,n=NI(r.maxBarThickness,1/0);let o,a;if(t.grouped){const i=s?this._getStackCount(e):t.stackCount,l="flex"===r.barThickness?function(e,t,i,r){const s=t.pixels,n=s[e];let o=e>0?s[e-1]:null,a=e<s.length-1?s[e+1]:null;const l=i.categoryPercentage;null===o&&(o=n-(null===a?t.end-t.start:a-n)),null===a&&(a=n+n-o);const c=n-(n-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/r,ratio:i.barPercentage,start:c}}(e,t,r,i):function(e,t,i,r){const s=i.barThickness;let n,o;return RI(s)?(n=t.min*i.categoryPercentage,o=i.barPercentage):(n=s*r,o=1),{chunk:n/r,ratio:o,start:t.pixels[e]-n/2}}(e,t,r,i),c=this._getStackIndex(this.index,this._cachedMeta.stack,s?e:void 0);o=l.start+l.chunk*c+l.chunk/2,a=Math.min(n,l.chunk*l.ratio)}else o=i.getPixelForValue(this.getParsed(e)[i.axis],e),a=Math.min(n,t.min*t.ratio);return{base:o-a/2,head:o+a/2,center:o,size:a}}draw(){const e=this._cachedMeta,t=e.vScale,i=e.data,r=i.length;let s=0;for(;s<r;++s)null!==this.getParsed(s)[t.axis]&&i[s].draw(this._ctx)}}uF.id="bar",uF.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},uF.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class hF extends tF{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,i,r){const s=super.parsePrimitiveData(e,t,i,r);for(let e=0;e<s.length;e++)s[e]._custom=this.resolveDataElementOptions(e+i).radius;return s}parseArrayData(e,t,i,r){const s=super.parseArrayData(e,t,i,r);for(let e=0;e<s.length;e++){const r=t[i+e];s[e]._custom=NI(r[2],this.resolveDataElementOptions(e+i).radius)}return s}parseObjectData(e,t,i,r){const s=super.parseObjectData(e,t,i,r);for(let e=0;e<s.length;e++){const r=t[i+e];s[e]._custom=NI(r&&r.r&&+r.r,this.resolveDataElementOptions(e+i).radius)}return s}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let i=e.length-1;i>=0;--i)t=Math.max(t,e[i].size(this.resolveDataElementOptions(i))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,{xScale:i,yScale:r}=t,s=this.getParsed(e),n=i.getLabelForValue(s.x),o=r.getLabelForValue(s.y),a=s._custom;return{label:t.label,value:"("+n+", "+o+(a?", "+a:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,i,r){const s="reset"===r,{iScale:n,vScale:o}=this._cachedMeta,{sharedOptions:a,includeOptions:l}=this._getSharedOptions(t,r),c=n.axis,u=o.axis;for(let h=t;h<t+i;h++){const t=e[h],i=!s&&this.getParsed(h),d={},p=d[c]=s?n.getPixelForDecimal(.5):n.getPixelForValue(i[c]),f=d[u]=s?o.getBasePixel():o.getPixelForValue(i[u]);d.skip=isNaN(p)||isNaN(f),l&&(d.options=a||this.resolveDataElementOptions(h,t.active?"active":r),s&&(d.options.radius=0)),this.updateElement(t,h,d,r)}}resolveDataElementOptions(e,t){const i=this.getParsed(e);let r=super.resolveDataElementOptions(e,t);r.$shared&&(r=Object.assign({},r,{$shared:!1}));const s=r.radius;return"active"!==t&&(r.radius=0),r.radius+=NI(i&&i._custom,s),r}}hF.id="bubble",hF.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},hF.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}};class dF extends tF{constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const i=this.getDataset().data,r=this._cachedMeta;if(!1===this._parsing)r._parsed=i;else{let s,n,o=e=>+i[e];if(II(i[e])){const{key:e="value"}=this._parsing;o=t=>+qI(i[t],e)}for(s=e,n=e+t;s<n;++s)r._parsed[s]=o(s)}}_getRotation(){return dL(this.options.rotation-90)}_getCircumference(){return dL(this.options.circumference)}_getRotationExtents(){let e=QI,t=-QI;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)){const r=this.chart.getDatasetMeta(i).controller,s=r._getRotation(),n=r._getCircumference();e=Math.min(e,s),t=Math.max(t,s+n)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:i}=t,r=this._cachedMeta,s=r.data,n=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,o=Math.max((Math.min(i.width,i.height)-n)/2,0),a=Math.min((c=o,"string"==typeof(l=this.options.cutout)&&l.endsWith("%")?parseFloat(l)/100:l/c),1);var l,c;const u=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:p,ratioY:f,offsetX:m,offsetY:g}=function(e,t,i){let r=1,s=1,n=0,o=0;if(t<QI){const a=e,l=a+t,c=Math.cos(a),u=Math.sin(a),h=Math.cos(l),d=Math.sin(l),p=(e,t,r)=>vL(e,a,l,!0)?1:Math.max(t,t*i,r,r*i),f=(e,t,r)=>vL(e,a,l,!0)?-1:Math.min(t,t*i,r,r*i),m=p(0,c,h),g=p(rL,u,d),y=f(KI,c,h),_=f(KI+rL,u,d);r=(m-y)/2,s=(g-_)/2,n=-(m+y)/2,o=-(g+_)/2}return{ratioX:r,ratioY:s,offsetX:n,offsetY:o}}(d,h,a),y=(i.width-n)/p,_=(i.height-n)/f,v=Math.max(Math.min(y,_)/2,0),b=FI(this.options.radius,v),w=(b-Math.max(b*a,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*b,this.offsetY=g*b,r.total=this.calculateTotal(),this.outerRadius=b-w*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-w*u,0),this.updateElements(s,0,s.length,e)}_circumference(e,t){const i=this.options,r=this._cachedMeta,s=this._getCircumference();return t&&i.animation.animateRotate||!this.chart.getDataVisibility(e)||null===r._parsed[e]||r.data[e].hidden?0:this.calculateCircumference(r._parsed[e]*s/QI)}updateElements(e,t,i,r){const s="reset"===r,n=this.chart,o=n.chartArea,a=n.options.animation,l=(o.left+o.right)/2,c=(o.top+o.bottom)/2,u=s&&a.animateScale,h=u?0:this.innerRadius,d=u?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(t,r);let m,g=this._getRotation();for(m=0;m<t;++m)g+=this._circumference(m,s);for(m=t;m<t+i;++m){const t=this._circumference(m,s),i=e[m],n={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+t,circumference:t,outerRadius:d,innerRadius:h};f&&(n.options=p||this.resolveDataElementOptions(m,i.active?"active":r)),g+=t,this.updateElement(i,m,n,r)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let i,r=0;for(i=0;i<t.length;i++){const s=e._parsed[i];null===s||isNaN(s)||!this.chart.getDataVisibility(i)||t[i].hidden||(r+=Math.abs(s))}return r}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?QI*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart,r=i.data.labels||[],s=MN(t._parsed[e],i.options.locale);return{label:r[e]||"",value:s}}getMaxBorderWidth(e){let t=0;const i=this.chart;let r,s,n,o,a;if(!e)for(r=0,s=i.data.datasets.length;r<s;++r)if(i.isDatasetVisible(r)){n=i.getDatasetMeta(r),e=n.data,o=n.controller;break}if(!e)return 0;for(r=0,s=e.length;r<s;++r)a=o.resolveDataElementOptions(r),"inner"!==a.borderAlign&&(t=Math.max(t,a.borderWidth||0,a.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let i=0,r=e.length;i<r;++i){const e=this.resolveDataElementOptions(i);t=Math.max(t,e.offset||0,e.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let i=0;i<e;++i)this.chart.isDatasetVisible(i)&&(t+=this._getRingWeight(i));return t}_getRingWeight(e){return Math.max(NI(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}dF.id="doughnut",dF.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},dF.descriptors={_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e},dF.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:i}}=e.legend.options;return t.labels.map(((t,r)=>{const s=e.getDatasetMeta(0).controller.getStyle(r);return{text:t,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,lineWidth:s.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(r),index:r}}))}return[]}},onClick(e,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label(e){let t=e.label;const i=": "+e.formattedValue;return PI(t)?(t=t.slice(),t[0]+=i):t+=i,t}}}}};class pF extends tF{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:i,data:r=[],_dataset:s}=t,n=this.chart._animationsDisabled;let{start:o,count:a}=IL(t,r,n);this._drawStart=o,this._drawCount=a,LL(t)&&(o=0,a=r.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!s._decimated,i.points=r;const l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!n,options:l},e),this.updateElements(r,o,a,e)}updateElements(e,t,i,r){const s="reset"===r,{iScale:n,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(t,r),h=n.axis,d=o.axis,{spanGaps:p,segment:f}=this.options,m=cL(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||s||"none"===r;let y=t>0&&this.getParsed(t-1);for(let p=t;p<t+i;++p){const t=e[p],i=this.getParsed(p),_=g?t:{},v=RI(i[d]),b=_[h]=n.getPixelForValue(i[h],p),w=_[d]=s||v?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,i,a):i[d],p);_.skip=isNaN(b)||isNaN(w)||v,_.stop=p>0&&Math.abs(i[h]-y[h])>m,f&&(_.parsed=i,_.raw=l.data[p]),u&&(_.options=c||this.resolveDataElementOptions(p,t.active?"active":r)),g||this.updateElement(t,p,_,r),y=i}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,i=t.options&&t.options.borderWidth||0,r=e.data||[];if(!r.length)return i;const s=r[0].size(this.resolveDataElementOptions(0)),n=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(i,s,n)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}pF.id="line",pF.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},pF.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};class fF extends tF{constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart,r=i.data.labels||[],s=MN(t._parsed[e].r,i.options.locale);return{label:r[e]||"",value:s}}parseObjectData(e,t,i,r){return oN.bind(this)(e,t,i,r)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach(((e,i)=>{const r=this.getParsed(i).r;!isNaN(r)&&this.chart.getDataVisibility(i)&&(r<t.min&&(t.min=r),r>t.max&&(t.max=r))})),t}_updateRadius(){const e=this.chart,t=e.chartArea,i=e.options,r=Math.min(t.right-t.left,t.bottom-t.top),s=Math.max(r/2,0),n=(s-Math.max(i.cutoutPercentage?s/100*i.cutoutPercentage:1,0))/e.getVisibleDatasetCount();this.outerRadius=s-n*this.index,this.innerRadius=this.outerRadius-n}updateElements(e,t,i,r){const s="reset"===r,n=this.chart,o=n.options.animation,a=this._cachedMeta.rScale,l=a.xCenter,c=a.yCenter,u=a.getIndexAngle(0)-.5*KI;let h,d=u;const p=360/this.countVisibleElements();for(h=0;h<t;++h)d+=this._computeAngle(h,r,p);for(h=t;h<t+i;h++){const t=e[h];let i=d,f=d+this._computeAngle(h,r,p),m=n.getDataVisibility(h)?a.getDistanceFromCenterForValue(this.getParsed(h).r):0;d=f,s&&(o.animateScale&&(m=0),o.animateRotate&&(i=f=u));const g={x:l,y:c,innerRadius:0,outerRadius:m,startAngle:i,endAngle:f,options:this.resolveDataElementOptions(h,t.active?"active":r)};this.updateElement(t,h,g,r)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach(((e,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&t++})),t}_computeAngle(e,t,i){return this.chart.getDataVisibility(e)?dL(this.resolveDataElementOptions(e,t).angle||i):0}}fF.id="polarArea",fF.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},fF.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:i}}=e.legend.options;return t.labels.map(((t,r)=>{const s=e.getDatasetMeta(0).controller.getStyle(r);return{text:t,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,lineWidth:s.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(r),index:r}}))}return[]}},onClick(e,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label:e=>e.chart.data.labels[e.dataIndex]+": "+e.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class mF extends dF{}mF.id="pie",mF.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class gF extends tF{getLabelAndValue(e){const t=this._cachedMeta.vScale,i=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(i[t.axis])}}parseObjectData(e,t,i,r){return oN.bind(this)(e,t,i,r)}update(e){const t=this._cachedMeta,i=t.dataset,r=t.data||[],s=t.iScale.getLabels();if(i.points=r,"resize"!==e){const t=this.resolveDatasetElementOptions(e);this.options.showLine||(t.borderWidth=0);const n={_loop:!0,_fullLoop:s.length===r.length,options:t};this.updateElement(i,void 0,n,e)}this.updateElements(r,0,r.length,e)}updateElements(e,t,i,r){const s=this._cachedMeta.rScale,n="reset"===r;for(let o=t;o<t+i;o++){const t=e[o],i=this.resolveDataElementOptions(o,t.active?"active":r),a=s.getPointPositionForValue(o,this.getParsed(o).r),l=n?s.xCenter:a.x,c=n?s.yCenter:a.y,u={x:l,y:c,angle:a.angle,skip:isNaN(l)||isNaN(c),options:i};this.updateElement(t,o,u,r)}}}gF.id="radar",gF.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},gF.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};class yF{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(e){const{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}hasValue(){return cL(this.x)&&cL(this.y)}getProps(e,t){const i=this.$animations;if(!t||!i)return this;const r={};return e.forEach((e=>{r[e]=i[e]&&i[e].active()?i[e]._to:this[e]})),r}}yF.defaults={},yF.defaultRoutes=void 0;const _F={values:e=>PI(e)?e:""+e,numeric(e,t,i){if(0===e)return"0";const r=this.chart.options.locale;let s,n=e;if(i.length>1){const t=Math.max(Math.abs(i[0].value),Math.abs(i[i.length-1].value));(t<1e-4||t>1e15)&&(s="scientific"),n=function(e,t){let i=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(i)>=1&&e!==Math.floor(e)&&(i=e-Math.floor(e)),i}(e,i)}const o=oL(Math.abs(n)),a=Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),MN(e,r,l)},logarithmic(e,t,i){if(0===e)return"0";const r=e/Math.pow(10,Math.floor(oL(e)));return 1===r||2===r||5===r?_F.numeric.call(this,e,t,i):""}};var vF={formatters:_F};function bF(e,t,i,r,s){const n=NI(r,0),o=Math.min(NI(s,e.length),e.length);let a,l,c,u=0;for(i=Math.ceil(i),s&&(a=s-r,i=a/Math.floor(a/i)),c=n;c<0;)u++,c=Math.round(n+u*i);for(l=Math.max(n,0);l<o;l++)l===c&&(t.push(e[l]),u++,c=Math.round(n+u*i))}xD.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:vF.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),xD.route("scale.ticks","color","","color"),xD.route("scale.grid","color","","borderColor"),xD.route("scale.grid","borderColor","","borderColor"),xD.route("scale.title","color","","color"),xD.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e}),xD.describe("scales",{_fallback:"scale"}),xD.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e});const wF=(e,t,i)=>"top"===t||"left"===t?e[t]+i:e[t]-i;function xF(e,t){const i=[],r=e.length/t,s=e.length;let n=0;for(;n<s;n+=r)i.push(e[Math.floor(n)]);return i}function CF(e,t,i){const r=e.ticks.length,s=Math.min(t,r-1),n=e._startPixel,o=e._endPixel,a=1e-6;let l,c=e.getPixelForTick(s);if(!(i&&(l=1===r?Math.max(c-n,o-c):0===t?(e.getPixelForTick(1)-c)/2:(c-e.getPixelForTick(s-1))/2,c+=s<t?l:-l,c<n-a||c>o+a)))return c}function TF(e){return e.drawTicks?e.tickLength:0}function SF(e,t){if(!e.display)return 0;const i=GD(e.font,t),r=jD(e.padding);return(PI(e.text)?e.text.length:1)*i.lineHeight+r.height}function EF(e,t,i){let r=RL(e);return(i&&"right"!==t||!i&&"right"===t)&&(r=(e=>"left"===e?"right":"right"===e?"left":e)(r)),r}class AF extends yF{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:i,_suggestedMax:r}=this;return e=DI(e,Number.POSITIVE_INFINITY),t=DI(t,Number.NEGATIVE_INFINITY),i=DI(i,Number.POSITIVE_INFINITY),r=DI(r,Number.NEGATIVE_INFINITY),{min:DI(e,i),max:DI(t,r),minDefined:LI(e),maxDefined:LI(t)}}getMinMax(e){let t,{min:i,max:r,minDefined:s,maxDefined:n}=this.getUserBounds();if(s&&n)return{min:i,max:r};const o=this.getMatchingVisibleMetas();for(let a=0,l=o.length;a<l;++a)t=o[a].controller.getMinMax(this,e),s||(i=Math.min(i,t.min)),n||(r=Math.max(r,t.max));return i=n&&i>r?r:i,r=s&&i>r?i:r,{min:DI(i,DI(r,i)),max:DI(r,DI(i,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){kI(this.options.beforeUpdate,[this])}update(e,t,i){const{beginAtZero:r,grace:s,ticks:n}=this.options,o=n.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(e,t,i){const{min:r,max:s}=e,n=FI(t,(s-r)/2),o=(e,t)=>i&&0===e?0:e+t;return{min:o(r,-Math.abs(n)),max:o(s,n)}}(this,s,r),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=o<this.ticks.length;this._convertTicksToLabels(a?xF(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),n.display&&(n.autoSkip||"auto"===n.source)&&(this.ticks=function(e,t){const i=e.options.ticks,r=i.maxTicksLimit||function(e){const t=e.options.offset,i=e._tickSize(),r=e._length/i+(t?0:1),s=e._maxLength/i;return Math.floor(Math.min(r,s))}(e),s=i.major.enabled?function(e){const t=[];let i,r;for(i=0,r=e.length;i<r;i++)e[i].major&&t.push(i);return t}(t):[],n=s.length,o=s[0],a=s[n-1],l=[];if(n>r)return function(e,t,i,r){let s,n=0,o=i[0];for(r=Math.ceil(r),s=0;s<e.length;s++)s===o&&(t.push(e[s]),n++,o=i[n*r])}(t,l,s,n/r),l;const c=function(e,t,i){const r=function(e){const t=e.length;let i,r;if(t<2)return!1;for(r=e[0],i=1;i<t;++i)if(e[i]-e[i-1]!==r)return!1;return r}(e),s=t.length/i;if(!r)return Math.max(s,1);const n=function(e){const t=[],i=Math.sqrt(e);let r;for(r=1;r<i;r++)e%r==0&&(t.push(r),t.push(e/r));return i===(0|i)&&t.push(i),t.sort(((e,t)=>e-t)).pop(),t}(r);for(let e=0,t=n.length-1;e<t;e++){const t=n[e];if(t>s)return t}return Math.max(s,1)}(s,t,r);if(n>0){let e,i;const r=n>1?Math.round((a-o)/(n-1)):null;for(bF(t,l,c,RI(r)?0:o-r,o),e=0,i=n-1;e<i;e++)bF(t,l,c,s[e],s[e+1]);return bF(t,l,c,a,RI(r)?t.length:a+r),l}return bF(t,l,c),l}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e,t,i=this.options.reverse;this.isHorizontal()?(e=this.left,t=this.right):(e=this.top,t=this.bottom,i=!i),this._startPixel=e,this._endPixel=t,this._reversePixels=i,this._length=t-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){kI(this.options.afterUpdate,[this])}beforeSetDimensions(){kI(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){kI(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),kI(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){kI(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let i,r,s;for(i=0,r=e.length;i<r;i++)s=e[i],s.label=kI(t.callback,[s.value,i,e],this)}afterTickToLabelConversion(){kI(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){kI(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,i=this.ticks.length,r=t.minRotation||0,s=t.maxRotation;let n,o,a,l=r;if(!this._isVisible()||!t.display||r>=s||i<=1||!this.isHorizontal())return void(this.labelRotation=r);const c=this._getLabelSizes(),u=c.widest.width,h=c.highest.height,d=bL(this.chart.width-u,0,this.maxWidth);n=e.offset?this.maxWidth/i:d/(i-1),u+6>n&&(n=d/(i-(e.offset?.5:1)),o=this.maxHeight-TF(e.grid)-t.padding-SF(e.title,this.chart.options.font),a=Math.sqrt(u*u+h*h),l=pL(Math.min(Math.asin(bL((c.highest.height+6)/n,-1,1)),Math.asin(bL(o/a,-1,1))-Math.asin(bL(h/a,-1,1)))),l=Math.max(r,Math.min(s,l))),this.labelRotation=l}afterCalculateLabelRotation(){kI(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){kI(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:i,title:r,grid:s}}=this,n=this._isVisible(),o=this.isHorizontal();if(n){const n=SF(r,t.options.font);if(o?(e.width=this.maxWidth,e.height=TF(s)+n):(e.height=this.maxHeight,e.width=TF(s)+n),i.display&&this.ticks.length){const{first:t,last:r,widest:s,highest:n}=this._getLabelSizes(),a=2*i.padding,l=dL(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(o){const t=i.mirror?0:u*s.width+c*n.height;e.height=Math.min(this.maxHeight,e.height+t+a)}else{const t=i.mirror?0:c*s.width+u*n.height;e.width=Math.min(this.maxWidth,e.width+t+a)}this._calculatePadding(t,r,u,c)}}this._handleMargins(),o?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,i,r){const{ticks:{align:s,padding:n},position:o}=this.options,a=0!==this.labelRotation,l="top"!==o&&"x"===this.axis;if(this.isHorizontal()){const o=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,h=0;a?l?(u=r*e.width,h=i*t.height):(u=i*e.height,h=r*t.width):"start"===s?h=t.width:"end"===s?u=e.width:"inner"!==s&&(u=e.width/2,h=t.width/2),this.paddingLeft=Math.max((u-o+n)*this.width/(this.width-o),0),this.paddingRight=Math.max((h-c+n)*this.width/(this.width-c),0)}else{let i=t.height/2,r=e.height/2;"start"===s?(i=0,r=e.height):"end"===s&&(i=t.height,r=0),this.paddingTop=i+n,this.paddingBottom=r+n}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){kI(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return"top"===t||"bottom"===t||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let t,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),t=0,i=e.length;t<i;t++)RI(e[t].label)&&(e.splice(t,1),i--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let i=this.ticks;t<i.length&&(i=xF(i,t)),this._labelSizes=e=this._computeLabelSizes(i,i.length)}return e}_computeLabelSizes(e,t){const{ctx:i,_longestTextCache:r}=this,s=[],n=[];let o,a,l,c,u,h,d,p,f,m,g,y=0,_=0;for(o=0;o<t;++o){if(c=e[o].label,u=this._resolveTickFontOptions(o),i.font=h=u.string,d=r[h]=r[h]||{data:{},gc:[]},p=u.lineHeight,f=m=0,RI(c)||PI(c)){if(PI(c))for(a=0,l=c.length;a<l;++a)g=c[a],RI(g)||PI(g)||(f=CD(i,d.data,d.gc,f,g),m+=p)}else f=CD(i,d.data,d.gc,f,c),m=p;s.push(f),n.push(m),y=Math.max(f,y),_=Math.max(m,_)}!function(e,t){UI(e,(e=>{const i=e.gc,r=i.length/2;let s;if(r>t){for(s=0;s<r;++s)delete e.data[i[s]];i.splice(0,r)}}))}(r,t);const v=s.indexOf(y),b=n.indexOf(_),w=e=>({width:s[e]||0,height:n[e]||0});return{first:w(0),last:w(t-1),widest:w(v),highest:w(b),widths:s,heights:n}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return bL(this._alignToPixels?SD(this.chart,t,0):t,-32768,32767)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const i=t[e];return i.$context||(i.$context=function(e,t,i){return ZD(e,{tick:i,index:t,type:"tick"})}(this.getContext(),e,i))}return this.$context||(this.$context=ZD(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const e=this.options.ticks,t=dL(this.labelRotation),i=Math.abs(Math.cos(t)),r=Math.abs(Math.sin(t)),s=this._getLabelSizes(),n=e.autoSkipPadding||0,o=s?s.widest.width+n:0,a=s?s.highest.height+n:0;return this.isHorizontal()?a*i>o*r?o/i:a/r:a*r<o*i?a/i:o/r}_isVisible(){const e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,i=this.chart,r=this.options,{grid:s,position:n}=r,o=s.offset,a=this.isHorizontal(),l=this.ticks.length+(o?1:0),c=TF(s),u=[],h=s.setContext(this.getContext()),d=h.drawBorder?h.borderWidth:0,p=d/2,f=function(e){return SD(i,e,d)};let m,g,y,_,v,b,w,x,C,T,S,E;if("top"===n)m=f(this.bottom),b=this.bottom-c,x=m-p,T=f(e.top)+p,E=e.bottom;else if("bottom"===n)m=f(this.top),T=e.top,E=f(e.bottom)-p,b=m+p,x=this.top+c;else if("left"===n)m=f(this.right),v=this.right-c,w=m-p,C=f(e.left)+p,S=e.right;else if("right"===n)m=f(this.left),C=e.left,S=f(e.right)-p,v=m+p,w=this.left+c;else if("x"===t){if("center"===n)m=f((e.top+e.bottom)/2+.5);else if(II(n)){const e=Object.keys(n)[0],t=n[e];m=f(this.chart.scales[e].getPixelForValue(t))}T=e.top,E=e.bottom,b=m+p,x=b+c}else if("y"===t){if("center"===n)m=f((e.left+e.right)/2);else if(II(n)){const e=Object.keys(n)[0],t=n[e];m=f(this.chart.scales[e].getPixelForValue(t))}v=m-p,w=v-c,C=e.left,S=e.right}const A=NI(r.ticks.maxTicksLimit,l),M=Math.max(1,Math.ceil(l/A));for(g=0;g<l;g+=M){const e=s.setContext(this.getContext(g)),t=e.lineWidth,r=e.color,n=e.borderDash||[],l=e.borderDashOffset,c=e.tickWidth,h=e.tickColor,d=e.tickBorderDash||[],p=e.tickBorderDashOffset;y=CF(this,g,o),void 0!==y&&(_=SD(i,y,t),a?v=w=C=S=_:b=x=T=E=_,u.push({tx1:v,ty1:b,tx2:w,ty2:x,x1:C,y1:T,x2:S,y2:E,width:t,color:r,borderDash:n,borderDashOffset:l,tickWidth:c,tickColor:h,tickBorderDash:d,tickBorderDashOffset:p}))}return this._ticksLength=l,this._borderValue=m,u}_computeLabelItems(e){const t=this.axis,i=this.options,{position:r,ticks:s}=i,n=this.isHorizontal(),o=this.ticks,{align:a,crossAlign:l,padding:c,mirror:u}=s,h=TF(i.grid),d=h+c,p=u?-c:d,f=-dL(this.labelRotation),m=[];let g,y,_,v,b,w,x,C,T,S,E,A,M="middle";if("top"===r)w=this.bottom-p,x=this._getXAxisLabelAlignment();else if("bottom"===r)w=this.top+p,x=this._getXAxisLabelAlignment();else if("left"===r){const e=this._getYAxisLabelAlignment(h);x=e.textAlign,b=e.x}else if("right"===r){const e=this._getYAxisLabelAlignment(h);x=e.textAlign,b=e.x}else if("x"===t){if("center"===r)w=(e.top+e.bottom)/2+d;else if(II(r)){const e=Object.keys(r)[0],t=r[e];w=this.chart.scales[e].getPixelForValue(t)+d}x=this._getXAxisLabelAlignment()}else if("y"===t){if("center"===r)b=(e.left+e.right)/2-d;else if(II(r)){const e=Object.keys(r)[0],t=r[e];b=this.chart.scales[e].getPixelForValue(t)}x=this._getYAxisLabelAlignment(h).textAlign}"y"===t&&("start"===a?M="top":"end"===a&&(M="bottom"));const O=this._getLabelSizes();for(g=0,y=o.length;g<y;++g){_=o[g],v=_.label;const e=s.setContext(this.getContext(g));C=this.getPixelForTick(g)+s.labelOffset,T=this._resolveTickFontOptions(g),S=T.lineHeight,E=PI(v)?v.length:1;const t=E/2,i=e.color,a=e.textStrokeColor,c=e.textStrokeWidth;let h,d=x;if(n?(b=C,"inner"===x&&(d=g===y-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),A="top"===r?"near"===l||0!==f?-E*S+S/2:"center"===l?-O.highest.height/2-t*S+S:-O.highest.height+S/2:"near"===l||0!==f?S/2:"center"===l?O.highest.height/2-t*S:O.highest.height-E*S,u&&(A*=-1)):(w=C,A=(1-E)*S/2),e.showLabelBackdrop){const t=jD(e.backdropPadding),i=O.heights[g],r=O.widths[g];let s=w+A-t.top,n=b-t.left;switch(M){case"middle":s-=i/2;break;case"bottom":s-=i}switch(x){case"center":n-=r/2;break;case"right":n-=r}h={left:n,top:s,width:r+t.width,height:i+t.height,color:e.backdropColor}}m.push({rotation:f,label:v,font:T,color:i,strokeColor:a,strokeWidth:c,textOffset:A,textAlign:d,textBaseline:M,translation:[b,w],backdrop:h})}return m}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-dL(this.labelRotation))return"top"===e?"left":"right";let i="center";return"start"===t.align?i="left":"end"===t.align?i="right":"inner"===t.align&&(i="inner"),i}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:i,mirror:r,padding:s}}=this.options,n=e+s,o=this._getLabelSizes().widest.width;let a,l;return"left"===t?r?(l=this.right+s,"near"===i?a="left":"center"===i?(a="center",l+=o/2):(a="right",l+=o)):(l=this.right-n,"near"===i?a="right":"center"===i?(a="center",l-=o/2):(a="left",l=this.left)):"right"===t?r?(l=this.left+s,"near"===i?a="right":"center"===i?(a="center",l-=o/2):(a="left",l-=o)):(l=this.left+n,"near"===i?a="left":"center"===i?(a="center",l+=o/2):(a="right",l=this.right)):a="right",{textAlign:a,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:i,top:r,width:s,height:n}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(i,r,s,n),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const i=this.ticks.findIndex((t=>t.value===e));return i>=0?t.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){const t=this.options.grid,i=this.ctx,r=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let s,n;const o=(e,t,r)=>{r.width&&r.color&&(i.save(),i.lineWidth=r.width,i.strokeStyle=r.color,i.setLineDash(r.borderDash||[]),i.lineDashOffset=r.borderDashOffset,i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.stroke(),i.restore())};if(t.display)for(s=0,n=r.length;s<n;++s){const e=r[s];t.drawOnChartArea&&o({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},e),t.drawTicks&&o({x:e.tx1,y:e.ty1},{x:e.tx2,y:e.ty2},{color:e.tickColor,width:e.tickWidth,borderDash:e.tickBorderDash,borderDashOffset:e.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{grid:i}}=this,r=i.setContext(this.getContext()),s=i.drawBorder?r.borderWidth:0;if(!s)return;const n=i.setContext(this.getContext(0)).lineWidth,o=this._borderValue;let a,l,c,u;this.isHorizontal()?(a=SD(e,this.left,s)-s/2,l=SD(e,this.right,n)+n/2,c=u=o):(c=SD(e,this.top,s)-s/2,u=SD(e,this.bottom,n)+n/2,a=l=o),t.save(),t.lineWidth=r.borderWidth,t.strokeStyle=r.borderColor,t.beginPath(),t.moveTo(a,c),t.lineTo(l,u),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const t=this.ctx,i=this._computeLabelArea();i&&RD(t,i);const r=this._labelItems||(this._labelItems=this._computeLabelItems(e));let s,n;for(s=0,n=r.length;s<n;++s){const e=r[s],i=e.font,n=e.label;e.backdrop&&(t.fillStyle=e.backdrop.color,t.fillRect(e.backdrop.left,e.backdrop.top,e.backdrop.width,e.backdrop.height)),DD(t,n,0,e.textOffset,i,e)}i&&PD(t)}drawTitle(){const{ctx:e,options:{position:t,title:i,reverse:r}}=this;if(!i.display)return;const s=GD(i.font),n=jD(i.padding),o=i.align;let a=s.lineHeight/2;"bottom"===t||"center"===t||II(t)?(a+=n.bottom,PI(i.text)&&(a+=s.lineHeight*(i.text.length-1))):a+=n.top;const{titleX:l,titleY:c,maxWidth:u,rotation:h}=function(e,t,i,r){const{top:s,left:n,bottom:o,right:a,chart:l}=e,{chartArea:c,scales:u}=l;let h,d,p,f=0;const m=o-s,g=a-n;if(e.isHorizontal()){if(d=PL(r,n,a),II(i)){const e=Object.keys(i)[0],r=i[e];p=u[e].getPixelForValue(r)+m-t}else p="center"===i?(c.bottom+c.top)/2+m-t:wF(e,i,t);h=a-n}else{if(II(i)){const e=Object.keys(i)[0],r=i[e];d=u[e].getPixelForValue(r)-g+t}else d="center"===i?(c.left+c.right)/2-g+t:wF(e,i,t);p=PL(r,o,s),f="left"===i?-rL:rL}return{titleX:d,titleY:p,maxWidth:h,rotation:f}}(this,a,t,o);DD(e,i.text,0,0,s,{color:i.color,maxWidth:u,rotation:h,textAlign:EF(o,t,r),textBaseline:"middle",translation:[l,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,i=NI(e.grid&&e.grid.z,-1);return this._isVisible()&&this.draw===AF.prototype.draw?[{z:i,draw:e=>{this.drawBackground(),this.drawGrid(e),this.drawTitle()}},{z:i+1,draw:()=>{this.drawBorder()}},{z:t,draw:e=>{this.drawLabels(e)}}]:[{z:t,draw:e=>{this.draw(e)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",r=[];let s,n;for(s=0,n=t.length;s<n;++s){const n=t[s];n[i]!==this.id||e&&n.type!==e||r.push(n)}return r}_resolveTickFontOptions(e){return GD(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class MF{constructor(e,t,i){this.type=e,this.scope=t,this.override=i,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let i;(function(e){return"id"in e&&"defaults"in e})(t)&&(i=this.register(t));const r=this.items,s=e.id,n=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+e);return s in r||(r[s]=e,function(e,t,i){const r=jI(Object.create(null),[i?xD.get(i):{},xD.get(t),e.defaults]);xD.set(t,r),e.defaultRoutes&&function(e,t){Object.keys(t).forEach((i=>{const r=i.split("."),s=r.pop(),n=[e].concat(r).join("."),o=t[i].split("."),a=o.pop(),l=o.join(".");xD.route(n,s,l,a)}))}(t,e.defaultRoutes),e.descriptors&&xD.describe(t,e.descriptors)}(e,n,i),this.override&&xD.override(e.id,e.overrides)),n}get(e){return this.items[e]}unregister(e){const t=this.items,i=e.id,r=this.scope;i in t&&delete t[i],r&&i in xD[r]&&(delete xD[r][i],this.override&&delete _D[i])}}var OF=new class{constructor(){this.controllers=new MF(tF,"datasets",!0),this.elements=new MF(yF,"elements"),this.plugins=new MF(Object,"plugins"),this.scales=new MF(AF,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,i){[...t].forEach((t=>{const r=i||this._getRegistryForType(t);i||r.isForType(t)||r===this.plugins&&t.id?this._exec(e,r,t):UI(t,(t=>{const r=i||this._getRegistryForType(t);this._exec(e,r,t)}))}))}_exec(e,t,i){const r=$I(e);kI(i["before"+r],[],i),t[e](i),kI(i["after"+r],[],i)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const i=this._typedRegistries[t];if(i.isForType(e))return i}return this.plugins}_get(e,t,i){const r=t.get(e);if(void 0===r)throw new Error('"'+e+'" is not a registered '+i+".");return r}};class RF extends tF{update(e){const t=this._cachedMeta,{data:i=[]}=t,r=this.chart._animationsDisabled;let{start:s,count:n}=IL(t,i,r);if(this._drawStart=s,this._drawCount=n,LL(t)&&(s=0,n=i.length),this.options.showLine){const{dataset:s,_dataset:n}=t;s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!n._decimated,s.points=i;const o=this.resolveDatasetElementOptions(e);o.segment=this.options.segment,this.updateElement(s,void 0,{animated:!r,options:o},e)}this.updateElements(i,s,n,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=OF.getElement("line")),super.addElements()}updateElements(e,t,i,r){const s="reset"===r,{iScale:n,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(t,r),u=this.getSharedOptions(c),h=this.includeOptions(r,u),d=n.axis,p=o.axis,{spanGaps:f,segment:m}=this.options,g=cL(f)?f:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||s||"none"===r;let _=t>0&&this.getParsed(t-1);for(let c=t;c<t+i;++c){const t=e[c],i=this.getParsed(c),f=y?t:{},v=RI(i[p]),b=f[d]=n.getPixelForValue(i[d],c),w=f[p]=s||v?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,i,a):i[p],c);f.skip=isNaN(b)||isNaN(w)||v,f.stop=c>0&&Math.abs(i[d]-_[d])>g,m&&(f.parsed=i,f.raw=l.data[c]),h&&(f.options=u||this.resolveDataElementOptions(c,t.active?"active":r)),y||this.updateElement(t,c,f,r),_=i}this.updateSharedOptions(u,r,c)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}const i=e.dataset,r=i.options&&i.options.borderWidth||0;if(!t.length)return r;const s=t[0].size(this.resolveDataElementOptions(0)),n=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(r,s,n)/2}}RF.id="scatter",RF.defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1},RF.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:e=>"("+e.label+", "+e.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}};var PF=Object.freeze({__proto__:null,BarController:uF,BubbleController:hF,DoughnutController:dF,LineController:pF,PolarAreaController:fF,PieController:mF,RadarController:gF,ScatterController:RF});function IF(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class LF{constructor(e){this.options=e||{}}init(e){}formats(){return IF()}parse(e,t){return IF()}format(e,t){return IF()}add(e,t,i){return IF()}diff(e,t,i){return IF()}startOf(e,t,i){return IF()}endOf(e,t){return IF()}}LF.override=function(e){Object.assign(LF.prototype,e)};var DF={_date:LF};function NF(e,t,i,r){const{controller:s,data:n,_sorted:o}=e,a=s._cachedMeta.iScale;if(a&&t===a.axis&&"r"!==t&&o&&n.length){const e=a._reversePixels?TL:CL;if(!r)return e(n,t,i);if(s._sharedOptions){const r=n[0],s="function"==typeof r.getRange&&r.getRange(t);if(s){const r=e(n,t,i-s),o=e(n,t,i+s);return{lo:r.lo,hi:o.hi}}}}return{lo:0,hi:n.length-1}}function FF(e,t,i,r,s){const n=e.getSortedVisibleDatasetMetas(),o=i[t];for(let e=0,i=n.length;e<i;++e){const{index:i,data:a}=n[e],{lo:l,hi:c}=NF(n[e],t,o,s);for(let e=l;e<=c;++e){const t=a[e];t.skip||r(t,i,e)}}}function kF(e,t,i,r,s){const n=[];return s||e.isPointInArea(t)?(FF(e,i,t,(function(i,o,a){(s||OD(i,e.chartArea,0))&&i.inRange(t.x,t.y,r)&&n.push({element:i,datasetIndex:o,index:a})}),!0),n):n}function UF(e,t,i,r,s,n){return n||e.isPointInArea(t)?"r"!==i||r?function(e,t,i,r,s,n){let o=[];const a=function(e){const t=-1!==e.indexOf("x"),i=-1!==e.indexOf("y");return function(e,r){const s=t?Math.abs(e.x-r.x):0,n=i?Math.abs(e.y-r.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(n,2))}}(i);let l=Number.POSITIVE_INFINITY;return FF(e,i,t,(function(i,c,u){const h=i.inRange(t.x,t.y,s);if(r&&!h)return;const d=i.getCenterPoint(s);if(!n&&!e.isPointInArea(d)&&!h)return;const p=a(t,d);p<l?(o=[{element:i,datasetIndex:c,index:u}],l=p):p===l&&o.push({element:i,datasetIndex:c,index:u})})),o}(e,t,i,r,s,n):function(e,t,i,r){let s=[];return FF(e,i,t,(function(e,i,n){const{startAngle:o,endAngle:a}=e.getProps(["startAngle","endAngle"],r),{angle:l}=mL(e,{x:t.x,y:t.y});vL(l,o,a)&&s.push({element:e,datasetIndex:i,index:n})})),s}(e,t,i,s):[]}function VF(e,t,i,r,s){const n=[],o="x"===i?"inXRange":"inYRange";let a=!1;return FF(e,i,t,((e,r,l)=>{e[o](t[i],s)&&(n.push({element:e,datasetIndex:r,index:l}),a=a||e.inRange(t.x,t.y,s))})),r&&!a?[]:n}var zF={evaluateInteractionItems:FF,modes:{index(e,t,i,r){const s=vN(t,e),n=i.axis||"x",o=i.includeInvisible||!1,a=i.intersect?kF(e,s,n,r,o):UF(e,s,n,!1,r,o),l=[];return a.length?(e.getSortedVisibleDatasetMetas().forEach((e=>{const t=a[0].index,i=e.data[t];i&&!i.skip&&l.push({element:i,datasetIndex:e.index,index:t})})),l):[]},dataset(e,t,i,r){const s=vN(t,e),n=i.axis||"xy",o=i.includeInvisible||!1;let a=i.intersect?kF(e,s,n,r,o):UF(e,s,n,!1,r,o);if(a.length>0){const t=a[0].datasetIndex,i=e.getDatasetMeta(t).data;a=[];for(let e=0;e<i.length;++e)a.push({element:i[e],datasetIndex:t,index:e})}return a},point:(e,t,i,r)=>kF(e,vN(t,e),i.axis||"xy",r,i.includeInvisible||!1),nearest(e,t,i,r){const s=vN(t,e),n=i.axis||"xy",o=i.includeInvisible||!1;return UF(e,s,n,i.intersect,r,o)},x:(e,t,i,r)=>VF(e,vN(t,e),"x",i.intersect,r),y:(e,t,i,r)=>VF(e,vN(t,e),"y",i.intersect,r)}};const BF=["left","top","right","bottom"];function HF(e,t){return e.filter((e=>e.pos===t))}function jF(e,t){return e.filter((e=>-1===BF.indexOf(e.pos)&&e.box.axis===t))}function GF(e,t){return e.sort(((e,i)=>{const r=t?i:e,s=t?e:i;return r.weight===s.weight?r.index-s.index:r.weight-s.weight}))}function WF(e,t,i,r){return Math.max(e[i],t[i])+Math.max(e[r],t[r])}function ZF(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function qF(e,t,i,r){const{pos:s,box:n}=i,o=e.maxPadding;if(!II(s)){i.size&&(e[s]-=i.size);const t=r[i.stack]||{size:0,count:1};t.size=Math.max(t.size,i.horizontal?n.height:n.width),i.size=t.size/t.count,e[s]+=i.size}n.getPadding&&ZF(o,n.getPadding());const a=Math.max(0,t.outerWidth-WF(o,e,"left","right")),l=Math.max(0,t.outerHeight-WF(o,e,"top","bottom")),c=a!==e.w,u=l!==e.h;return e.w=a,e.h=l,i.horizontal?{same:c,other:u}:{same:u,other:c}}function $F(e,t){const i=t.maxPadding;return function(e){const r={left:0,top:0,right:0,bottom:0};return e.forEach((e=>{r[e]=Math.max(t[e],i[e])})),r}(e?["left","right"]:["top","bottom"])}function YF(e,t,i,r){const s=[];let n,o,a,l,c,u;for(n=0,o=e.length,c=0;n<o;++n){a=e[n],l=a.box,l.update(a.width||t.w,a.height||t.h,$F(a.horizontal,t));const{same:o,other:h}=qF(t,i,a,r);c|=o&&s.length,u=u||h,l.fullSize||s.push(a)}return c&&YF(s,t,i,r)||u}function XF(e,t,i,r,s){e.top=i,e.left=t,e.right=t+r,e.bottom=i+s,e.width=r,e.height=s}function JF(e,t,i,r){const s=i.padding;let{x:n,y:o}=t;for(const a of e){const e=a.box,l=r[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/l.weight||1;if(a.horizontal){const r=t.w*c,n=l.size||e.height;YI(l.start)&&(o=l.start),e.fullSize?XF(e,s.left,o,i.outerWidth-s.right-s.left,n):XF(e,t.left+l.placed,o,r,n),l.start=o,l.placed+=r,o=e.bottom}else{const r=t.h*c,o=l.size||e.width;YI(l.start)&&(n=l.start),e.fullSize?XF(e,n,s.top,o,i.outerHeight-s.bottom-s.top):XF(e,n,t.top+l.placed,o,r),l.start=n,l.placed+=r,n=e.right}}t.x=n,t.y=o}xD.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var KF={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},e.boxes.push(t)},removeBox(e,t){const i=e.boxes?e.boxes.indexOf(t):-1;-1!==i&&e.boxes.splice(i,1)},configure(e,t,i){t.fullSize=i.fullSize,t.position=i.position,t.weight=i.weight},update(e,t,i,r){if(!e)return;const s=jD(e.options.layout.padding),n=Math.max(t-s.width,0),o=Math.max(i-s.height,0),a=function(e){const t=function(e){const t=[];let i,r,s,n,o,a;for(i=0,r=(e||[]).length;i<r;++i)s=e[i],({position:n,options:{stack:o,stackWeight:a=1}}=s),t.push({index:i,box:s,pos:n,horizontal:s.isHorizontal(),weight:s.weight,stack:o&&n+o,stackWeight:a});return t}(e),i=GF(t.filter((e=>e.box.fullSize)),!0),r=GF(HF(t,"left"),!0),s=GF(HF(t,"right")),n=GF(HF(t,"top"),!0),o=GF(HF(t,"bottom")),a=jF(t,"x"),l=jF(t,"y");return{fullSize:i,leftAndTop:r.concat(n),rightAndBottom:s.concat(l).concat(o).concat(a),chartArea:HF(t,"chartArea"),vertical:r.concat(s).concat(l),horizontal:n.concat(o).concat(a)}}(e.boxes),l=a.vertical,c=a.horizontal;UI(e.boxes,(e=>{"function"==typeof e.beforeLayout&&e.beforeLayout()}));const u=l.reduce(((e,t)=>t.box.options&&!1===t.box.options.display?e:e+1),0)||1,h=Object.freeze({outerWidth:t,outerHeight:i,padding:s,availableWidth:n,availableHeight:o,vBoxMaxWidth:n/2/u,hBoxMaxHeight:o/2}),d=Object.assign({},s);ZF(d,jD(r));const p=Object.assign({maxPadding:d,w:n,h:o,x:s.left,y:s.top},s),f=function(e,t){const i=function(e){const t={};for(const i of e){const{stack:e,pos:r,stackWeight:s}=i;if(!e||!BF.includes(r))continue;const n=t[e]||(t[e]={count:0,placed:0,weight:0,size:0});n.count++,n.weight+=s}return t}(e),{vBoxMaxWidth:r,hBoxMaxHeight:s}=t;let n,o,a;for(n=0,o=e.length;n<o;++n){a=e[n];const{fullSize:o}=a.box,l=i[a.stack],c=l&&a.stackWeight/l.weight;a.horizontal?(a.width=c?c*r:o&&t.availableWidth,a.height=s):(a.width=r,a.height=c?c*s:o&&t.availableHeight)}return i}(l.concat(c),h);YF(a.fullSize,p,h,f),YF(l,p,h,f),YF(c,p,h,f)&&YF(l,p,h,f),function(e){const t=e.maxPadding;function i(i){const r=Math.max(t[i]-e[i],0);return e[i]+=r,r}e.y+=i("top"),e.x+=i("left"),i("right"),i("bottom")}(p),JF(a.leftAndTop,p,h,f),p.x+=p.w,p.y+=p.h,JF(a.rightAndBottom,p,h,f),e.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},UI(a.chartArea,(t=>{const i=t.box;Object.assign(i,e.chartArea),i.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})}))}};class QF{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,i){}removeEventListener(e,t,i){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,i,r){return t=Math.max(0,t||e.width),i=i||e.height,{width:t,height:Math.max(0,r?Math.floor(t/r):i)}}isAttached(e){return!0}updateConfig(e){}}class ek extends QF{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const tk={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},ik=e=>null===e||""===e,rk=!!xN&&{passive:!0};function sk(e,t,i){e.canvas.removeEventListener(t,i,rk)}function nk(e,t){for(const i of e)if(i===t||i.contains(t))return!0}function ok(e,t,i){const r=e.canvas,s=new MutationObserver((e=>{let t=!1;for(const i of e)t=t||nk(i.addedNodes,r),t=t&&!nk(i.removedNodes,r);t&&i()}));return s.observe(document,{childList:!0,subtree:!0}),s}function ak(e,t,i){const r=e.canvas,s=new MutationObserver((e=>{let t=!1;for(const i of e)t=t||nk(i.removedNodes,r),t=t&&!nk(i.addedNodes,r);t&&i()}));return s.observe(document,{childList:!0,subtree:!0}),s}const lk=new Map;let ck=0;function uk(){const e=window.devicePixelRatio;e!==ck&&(ck=e,lk.forEach(((t,i)=>{i.currentDevicePixelRatio!==e&&t()})))}function hk(e,t,i){const r=e.canvas,s=r&&fN(r);if(!s)return;const n=OL(((e,t)=>{const r=s.clientWidth;i(e,t),r<s.clientWidth&&i()}),window),o=new ResizeObserver((e=>{const t=e[0],i=t.contentRect.width,r=t.contentRect.height;0===i&&0===r||n(i,r)}));return o.observe(s),function(e,t){lk.size||window.addEventListener("resize",uk),lk.set(e,t)}(e,n),o}function dk(e,t,i){i&&i.disconnect(),"resize"===t&&function(e){lk.delete(e),lk.size||window.removeEventListener("resize",uk)}(e)}function pk(e,t,i){const r=e.canvas,s=OL((t=>{null!==e.ctx&&i(function(e,t){const i=tk[e.type]||e.type,{x:r,y:s}=vN(e,t);return{type:i,chart:t,native:e,x:void 0!==r?r:null,y:void 0!==s?s:null}}(t,e))}),e,(e=>{const t=e[0];return[t,t.offsetX,t.offsetY]}));return function(e,t,i){e.addEventListener(t,i,rk)}(r,t,s),s}class fk extends QF{acquireContext(e,t){const i=e&&e.getContext&&e.getContext("2d");return i&&i.canvas===e?(function(e,t){const i=e.style,r=e.getAttribute("height"),s=e.getAttribute("width");if(e.$chartjs={initial:{height:r,width:s,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",i.boxSizing=i.boxSizing||"border-box",ik(s)){const t=CN(e,"width");void 0!==t&&(e.width=t)}if(ik(r))if(""===e.style.height)e.height=e.width/(t||2);else{const t=CN(e,"height");void 0!==t&&(e.height=t)}}(e,t),i):null}releaseContext(e){const t=e.canvas;if(!t.$chartjs)return!1;const i=t.$chartjs.initial;["height","width"].forEach((e=>{const r=i[e];RI(r)?t.removeAttribute(e):t.setAttribute(e,r)}));const r=i.style||{};return Object.keys(r).forEach((e=>{t.style[e]=r[e]})),t.width=t.width,delete t.$chartjs,!0}addEventListener(e,t,i){this.removeEventListener(e,t);const r=e.$proxies||(e.$proxies={}),s={attach:ok,detach:ak,resize:hk}[t]||pk;r[t]=s(e,t,i)}removeEventListener(e,t){const i=e.$proxies||(e.$proxies={}),r=i[t];r&&(({attach:dk,detach:dk,resize:dk}[t]||sk)(e,t,r),i[t]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,i,r){return function(e,t,i,r){const s=gN(e),n=_N(s,"margin"),o=mN(s.maxWidth,e,"clientWidth")||tL,a=mN(s.maxHeight,e,"clientHeight")||tL,l=function(e,t,i){let r,s;if(void 0===t||void 0===i){const n=fN(e);if(n){const e=n.getBoundingClientRect(),o=gN(n),a=_N(o,"border","width"),l=_N(o,"padding");t=e.width-l.width-a.width,i=e.height-l.height-a.height,r=mN(o.maxWidth,n,"clientWidth"),s=mN(o.maxHeight,n,"clientHeight")}else t=e.clientWidth,i=e.clientHeight}return{width:t,height:i,maxWidth:r||tL,maxHeight:s||tL}}(e,t,i);let{width:c,height:u}=l;if("content-box"===s.boxSizing){const e=_N(s,"border","width"),t=_N(s,"padding");c-=t.width+e.width,u-=t.height+e.height}return c=Math.max(0,c-n.width),u=Math.max(0,r?Math.floor(c/r):u-n.height),c=bN(Math.min(c,o,l.maxWidth)),u=bN(Math.min(u,a,l.maxHeight)),c&&!u&&(u=bN(c/2)),{width:c,height:u}}(e,t,i,r)}isAttached(e){const t=fN(e);return!(!t||!t.isConnected)}}class mk{constructor(){this._init=[]}notify(e,t,i,r){"beforeInit"===t&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const s=r?this._descriptors(e).filter(r):this._descriptors(e),n=this._notify(s,e,t,i);return"afterDestroy"===t&&(this._notify(s,e,"stop"),this._notify(this._init,e,"uninstall")),n}_notify(e,t,i,r){r=r||{};for(const s of e){const e=s.plugin;if(!1===kI(e[i],[t,r,s.options],e)&&r.cancelable)return!1}return!0}invalidate(){RI(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const i=e&&e.config,r=NI(i.options&&i.options.plugins,{}),s=function(e){const t={},i=[],r=Object.keys(OF.plugins.items);for(let e=0;e<r.length;e++)i.push(OF.getPlugin(r[e]));const s=e.plugins||[];for(let e=0;e<s.length;e++){const r=s[e];-1===i.indexOf(r)&&(i.push(r),t[r.id]=!0)}return{plugins:i,localIds:t}}(i);return!1!==r||t?function(e,{plugins:t,localIds:i},r,s){const n=[],o=e.getContext();for(const a of t){const t=a.id,l=gk(r[t],s);null!==l&&n.push({plugin:a,options:yk(e.config,{plugin:a,local:i[t]},l,o)})}return n}(e,s,r,t):[]}_notifyStateChanges(e){const t=this._oldCache||[],i=this._cache,r=(e,t)=>e.filter((e=>!t.some((t=>e.plugin.id===t.plugin.id))));this._notify(r(t,i),e,"stop"),this._notify(r(i,t),e,"start")}}function gk(e,t){return t||!1!==e?!0===e?{}:e:null}function yk(e,{plugin:t,local:i},r,s){const n=e.pluginScopeKeys(t),o=e.getOptionScopes(r,n);return i&&t.defaults&&o.push(t.defaults),e.createResolver(o,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function _k(e,t){const i=xD.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||i.indexAxis||"x"}function vk(e,t){return"x"===e||"y"===e?e:t.axis||("top"===(i=t.position)||"bottom"===i?"x":"left"===i||"right"===i?"y":void 0)||e.charAt(0).toLowerCase();var i}function bk(e){const t=e.options||(e.options={});t.plugins=NI(t.plugins,{}),t.scales=function(e,t){const i=_D[e.type]||{scales:{}},r=t.scales||{},s=_k(e.type,t),n=Object.create(null),o=Object.create(null);return Object.keys(r).forEach((e=>{const t=r[e];if(!II(t))return console.error(`Invalid scale configuration for scale: ${e}`);if(t._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${e}`);const a=vk(e,t),l=function(e,t){return e===t?"_index_":"_value_"}(a,s),c=i.scales||{};n[a]=n[a]||e,o[e]=GI(Object.create(null),[{axis:a},t,c[a],c[l]])})),e.data.datasets.forEach((i=>{const s=i.type||e.type,a=i.indexAxis||_k(s,t),l=(_D[s]||{}).scales||{};Object.keys(l).forEach((e=>{const t=function(e,t){let i=e;return"_index_"===e?i=t:"_value_"===e&&(i="x"===t?"y":"x"),i}(e,a),s=i[t+"AxisID"]||n[t]||t;o[s]=o[s]||Object.create(null),GI(o[s],[{axis:t},r[s],l[e]])}))})),Object.keys(o).forEach((e=>{const t=o[e];GI(t,[xD.scales[t.type],xD.scale])})),o}(e,t)}function wk(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}const xk=new Map,Ck=new Set;function Tk(e,t){let i=xk.get(e);return i||(i=t(),xk.set(e,i),Ck.add(i)),i}const Sk=(e,t,i)=>{const r=qI(t,i);void 0!==r&&e.add(r)};class Ek{constructor(e){this._config=function(e){return(e=e||{}).data=wk(e.data),bk(e),e}(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=wk(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),bk(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Tk(e,(()=>[[`datasets.${e}`,""]]))}datasetAnimationScopeKeys(e,t){return Tk(`${e}.transition.${t}`,(()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]]))}datasetElementScopeKeys(e,t){return Tk(`${e}-${t}`,(()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]]))}pluginScopeKeys(e){const t=e.id;return Tk(`${this.type}-plugin-${t}`,(()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]]))}_cachedScopes(e,t){const i=this._scopeCache;let r=i.get(e);return r&&!t||(r=new Map,i.set(e,r)),r}getOptionScopes(e,t,i){const{options:r,type:s}=this,n=this._cachedScopes(e,i),o=n.get(t);if(o)return o;const a=new Set;t.forEach((t=>{e&&(a.add(e),t.forEach((t=>Sk(a,e,t)))),t.forEach((e=>Sk(a,r,e))),t.forEach((e=>Sk(a,_D[s]||{},e))),t.forEach((e=>Sk(a,xD,e))),t.forEach((e=>Sk(a,vD,e)))}));const l=Array.from(a);return 0===l.length&&l.push(Object.create(null)),Ck.has(t)&&n.set(t,l),l}chartOptionScopes(){const{options:e,type:t}=this;return[e,_D[t]||{},xD.datasets[t]||{},{type:t},xD,vD]}resolveNamedOptions(e,t,i,r=[""]){const s={$shared:!0},{resolver:n,subPrefixes:o}=Ak(this._resolverCache,e,r);let a=n;(function(e,t){const{isScriptable:i,isIndexable:r}=YD(e);for(const s of t){const t=i(s),n=r(s),o=(n||t)&&e[s];if(t&&(XI(o)||Mk(o))||n&&PI(o))return!0}return!1})(n,t)&&(s.$shared=!1,a=$D(n,i=XI(i)?i():i,this.createResolver(e,i,o)));for(const e of t)s[e]=a[e];return s}createResolver(e,t,i=[""],r){const{resolver:s}=Ak(this._resolverCache,e,i);return II(t)?$D(s,t,void 0,r):s}}function Ak(e,t,i){let r=e.get(t);r||(r=new Map,e.set(t,r));const s=i.join();let n=r.get(s);return n||(n={resolver:qD(t,i),subPrefixes:i.filter((e=>!e.toLowerCase().includes("hover")))},r.set(s,n)),n}const Mk=e=>II(e)&&Object.getOwnPropertyNames(e).reduce(((t,i)=>t||XI(e[i])),!1),Ok=["top","bottom","left","right","chartArea"];function Rk(e,t){return"top"===e||"bottom"===e||-1===Ok.indexOf(e)&&"x"===t}function Pk(e,t){return function(i,r){return i[e]===r[e]?i[t]-r[t]:i[e]-r[e]}}function Ik(e){const t=e.chart,i=t.options.animation;t.notifyPlugins("afterRender"),kI(i&&i.onComplete,[e],t)}function Lk(e){const t=e.chart,i=t.options.animation;kI(i&&i.onProgress,[e],t)}function Dk(e){return pN()&&"string"==typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const Nk={},Fk=e=>{const t=Dk(e);return Object.values(Nk).filter((e=>e.canvas===t)).pop()};function kk(e,t,i){const r=Object.keys(e);for(const s of r){const r=+s;if(r>=t){const n=e[s];delete e[s],(i>0||r>t)&&(e[r+i]=n)}}}class Uk{constructor(e,t){const i=this.config=new Ek(t),r=Dk(e),s=Fk(r);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const n=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||function(e){return!pN()||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?ek:fk}(r)),this.platform.updateConfig(i);const o=this.platform.acquireContext(r,n.aspectRatio),a=o&&o.canvas,l=a&&a.height,c=a&&a.width;this.id=OI(),this.ctx=o,this.canvas=a,this.width=c,this.height=l,this._options=n,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new mk,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(e,t){let i;return function(...r){return t?(clearTimeout(i),i=setTimeout(e,t,r)):e.apply(this,r),t}}((e=>this.update(e)),n.resizeDelay||0),this._dataChanges=[],Nk[this.id]=this,o&&a?(UN.listen(this,"complete",Ik),UN.listen(this,"progress",Lk),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:i,height:r,_aspectRatio:s}=this;return RI(e)?t&&s?s:r?i/r:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():wN(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return ED(this.canvas,this.ctx),this}stop(){return UN.stop(this),this}resize(e,t){UN.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const i=this.options,r=this.canvas,s=i.maintainAspectRatio&&this.aspectRatio,n=this.platform.getMaximumSize(r,e,t,s),o=i.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=n.width,this.height=n.height,this._aspectRatio=this.aspectRatio,wN(this,o,!0)&&(this.notifyPlugins("resize",{size:n}),kI(i.onResize,[this,n],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){UI(this.options.scales||{},((e,t)=>{e.id=t}))}buildOrUpdateScales(){const e=this.options,t=e.scales,i=this.scales,r=Object.keys(i).reduce(((e,t)=>(e[t]=!1,e)),{});let s=[];t&&(s=s.concat(Object.keys(t).map((e=>{const i=t[e],r=vk(e,i),s="r"===r,n="x"===r;return{options:i,dposition:s?"chartArea":n?"bottom":"left",dtype:s?"radialLinear":n?"category":"linear"}})))),UI(s,(t=>{const s=t.options,n=s.id,o=vk(n,s),a=NI(s.type,t.dtype);void 0!==s.position&&Rk(s.position,o)===Rk(t.dposition)||(s.position=t.dposition),r[n]=!0;let l=null;n in i&&i[n].type===a?l=i[n]:(l=new(OF.getScale(a))({id:n,type:a,ctx:this.ctx,chart:this}),i[l.id]=l),l.init(s,e)})),UI(r,((e,t)=>{e||delete i[t]})),UI(i,(e=>{KF.configure(this,e,e.options),KF.addBox(this,e)}))}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,i=e.length;if(e.sort(((e,t)=>e.index-t.index)),i>t){for(let e=t;e<i;++e)this._destroyDatasetMeta(e);e.splice(t,i-t)}this._sortedMetasets=e.slice(0).sort(Pk("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach(((e,i)=>{0===t.filter((t=>t===e._dataset)).length&&this._destroyDatasetMeta(i)}))}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let i,r;for(this._removeUnreferencedMetasets(),i=0,r=t.length;i<r;i++){const r=t[i];let s=this.getDatasetMeta(i);const n=r.type||this.config.type;if(s.type&&s.type!==n&&(this._destroyDatasetMeta(i),s=this.getDatasetMeta(i)),s.type=n,s.indexAxis=r.indexAxis||_k(n,this.options),s.order=r.order||0,s.index=i,s.label=""+r.label,s.visible=this.isDatasetVisible(i),s.controller)s.controller.updateIndex(i),s.controller.linkScales();else{const t=OF.getController(n),{datasetElementType:r,dataElementType:o}=xD.datasets[n];Object.assign(t.prototype,{dataElementType:OF.getElement(o),datasetElementType:r&&OF.getElement(r)}),s.controller=new t(this,i),e.push(s.controller)}}return this._updateMetasets(),e}_resetElements(){UI(this.data.datasets,((e,t)=>{this.getDatasetMeta(t).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const i=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),r=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let n=0;for(let e=0,t=this.data.datasets.length;e<t;e++){const{controller:t}=this.getDatasetMeta(e),i=!r&&-1===s.indexOf(t);t.buildOrUpdateElements(i),n=Math.max(+t.getMaxOverflow(),n)}n=this._minPadding=i.layout.autoPadding?n:0,this._updateLayout(n),r||UI(s,(e=>{e.reset()})),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(Pk("z","_idx"));const{_active:o,_lastEvent:a}=this;a?this._eventHandler(a,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){UI(this.scales,(e=>{KF.removeBox(this,e)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),i=new Set(e.events);JI(t,i)&&!!this._responsiveListeners===e.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:i,start:r,count:s}of t)kk(e,r,"_removeElements"===i?-s:s)}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,i=t=>new Set(e.filter((e=>e[0]===t)).map(((e,t)=>t+","+e.splice(1).join(",")))),r=i(0);for(let e=1;e<t;e++)if(!JI(r,i(e)))return;return Array.from(r).map((e=>e.split(","))).map((e=>({method:e[1],start:+e[2],count:+e[3]})))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;KF.update(this,this.width,this.height,e);const t=this.chartArea,i=t.width<=0||t.height<=0;this._layers=[],UI(this.boxes,(e=>{i&&"chartArea"===e.position||(e.configure&&e.configure(),this._layers.push(...e._layers()))}),this),this._layers.forEach(((e,t)=>{e._idx=t})),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let e=0,t=this.data.datasets.length;e<t;++e)this.getDatasetMeta(e).controller.configure();for(let t=0,i=this.data.datasets.length;t<i;++t)this._updateDataset(t,XI(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const i=this.getDatasetMeta(e),r={meta:i,index:e,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",r)&&(i.controller._update(t),r.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",r))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(UN.has(this)?this.attached&&!UN.running(this)&&UN.start(this):(this.draw(),Ik({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:e,height:t}=this._resizeBeforeDraw;this._resize(e,t),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,i=[];let r,s;for(r=0,s=t.length;r<s;++r){const s=t[r];e&&!s.visible||i.push(s)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,i=e._clip,r=!i.disabled,s=this.chartArea,n={meta:e,index:e.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",n)&&(r&&RD(t,{left:!1===i.left?0:s.left-i.left,right:!1===i.right?this.width:s.right+i.right,top:!1===i.top?0:s.top-i.top,bottom:!1===i.bottom?this.height:s.bottom+i.bottom}),e.controller.draw(),r&&PD(t),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(e){return OD(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,i,r){const s=zF.modes[t];return"function"==typeof s?s(this,e,i,r):[]}getDatasetMeta(e){const t=this.data.datasets[e],i=this._metasets;let r=i.filter((e=>e&&e._dataset===t)).pop();return r||(r={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},i.push(r)),r}getContext(){return this.$context||(this.$context=ZD(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const i=this.getDatasetMeta(e);return"boolean"==typeof i.hidden?!i.hidden:!t.hidden}setDatasetVisibility(e,t){this.getDatasetMeta(e).hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,i){const r=i?"show":"hide",s=this.getDatasetMeta(e),n=s.controller._resolveAnimations(void 0,r);YI(t)?(s.data[t].hidden=!i,this.update()):(this.setDatasetVisibility(e,i),n.update(s,{visible:i}),this.update((t=>t.datasetIndex===e?r:void 0)))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),UN.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),ED(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete Nk[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,i=(i,r)=>{t.addEventListener(this,i,r),e[i]=r},r=(e,t,i)=>{e.offsetX=t,e.offsetY=i,this._eventHandler(e)};UI(this.options.events,(e=>i(e,r)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,i=(i,r)=>{t.addEventListener(this,i,r),e[i]=r},r=(i,r)=>{e[i]&&(t.removeEventListener(this,i,r),delete e[i])},s=(e,t)=>{this.canvas&&this.resize(e,t)};let n;const o=()=>{r("attach",o),this.attached=!0,this.resize(),i("resize",s),i("detach",n)};n=()=>{this.attached=!1,r("resize",s),this._stop(),this._resize(0,0),i("attach",o)},t.isAttached(this.canvas)?o():n()}unbindEvents(){UI(this._listeners,((e,t)=>{this.platform.removeEventListener(this,t,e)})),this._listeners={},UI(this._responsiveListeners,((e,t)=>{this.platform.removeEventListener(this,t,e)})),this._responsiveListeners=void 0}updateHoverStyle(e,t,i){const r=i?"set":"remove";let s,n,o,a;for("dataset"===t&&(s=this.getDatasetMeta(e[0].datasetIndex),s.controller["_"+r+"DatasetHoverStyle"]()),o=0,a=e.length;o<a;++o){n=e[o];const t=n&&this.getDatasetMeta(n.datasetIndex).controller;t&&t[r+"HoverStyle"](n.element,n.datasetIndex,n.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],i=e.map((({datasetIndex:e,index:t})=>{const i=this.getDatasetMeta(e);if(!i)throw new Error("No dataset found at index "+e);return{datasetIndex:e,element:i.data[t],index:t}}));!VI(i,t)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,t))}notifyPlugins(e,t,i){return this._plugins.notify(this,e,t,i)}_updateHoverStyles(e,t,i){const r=this.options.hover,s=(e,t)=>e.filter((e=>!t.some((t=>e.datasetIndex===t.datasetIndex&&e.index===t.index)))),n=s(t,e),o=i?e:s(e,t);n.length&&this.updateHoverStyle(n,r.mode,!1),o.length&&r.mode&&this.updateHoverStyle(o,r.mode,!0)}_eventHandler(e,t){const i={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},r=t=>(t.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",i,r))return;const s=this._handleEvent(e,t,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,r),(s||i.changed)&&this.render(),this}_handleEvent(e,t,i){const{_active:r=[],options:s}=this,n=t,o=this._getActiveElements(e,r,i,n),a=function(e){return"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type}(e),l=function(e,t,i,r){return i&&"mouseout"!==e.type?r?t:e:null}(e,this._lastEvent,i,a);i&&(this._lastEvent=null,kI(s.onHover,[e,o,this],this),a&&kI(s.onClick,[e,o,this],this));const c=!VI(o,r);return(c||t)&&(this._active=o,this._updateHoverStyles(o,r,t)),this._lastEvent=l,c}_getActiveElements(e,t,i,r){if("mouseout"===e.type)return[];if(!i)return t;const s=this.options.hover;return this.getElementsAtEventForMode(e,s.mode,s,r)}}const Vk=()=>UI(Uk.instances,(e=>e._plugins.invalidate())),zk=!0;function Bk(e,t,i){const{startAngle:r,pixelMargin:s,x:n,y:o,outerRadius:a,innerRadius:l}=t;let c=s/a;e.beginPath(),e.arc(n,o,a,r-c,i+c),l>s?(c=s/l,e.arc(n,o,l,i+c,r-c,!0)):e.arc(n,o,s,i+rL,r-rL),e.closePath(),e.clip()}function Hk(e,t,i,r){return{x:i+e*Math.cos(t),y:r+e*Math.sin(t)}}function jk(e,t,i,r,s,n){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:u}=t,h=Math.max(t.outerRadius+r+i-c,0),d=u>0?u+r+i+c:0;let p=0;const f=s-l;if(r){const e=((u>0?u-r:0)+(h>0?h-r:0))/2;p=(f-(0!==e?f*e/(e+r):f))/2}const m=(f-Math.max(.001,f*h-i/KI)/h)/2,g=l+m+p,y=s-m-p,{outerStart:_,outerEnd:v,innerStart:b,innerEnd:w}=function(e,t,i,r){const s=zD(e.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]),n=(i-t)/2,o=Math.min(n,r*t/2),a=e=>{const t=(i-Math.min(n,e))*r/2;return bL(e,0,Math.min(n,t))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:bL(s.innerStart,0,o),innerEnd:bL(s.innerEnd,0,o)}}(t,d,h,y-g),x=h-_,C=h-v,T=g+_/x,S=y-v/C,E=d+b,A=d+w,M=g+b/E,O=y-w/A;if(e.beginPath(),n){if(e.arc(o,a,h,T,S),v>0){const t=Hk(C,S,o,a);e.arc(t.x,t.y,v,S,y+rL)}const t=Hk(A,y,o,a);if(e.lineTo(t.x,t.y),w>0){const t=Hk(A,O,o,a);e.arc(t.x,t.y,w,y+rL,O+Math.PI)}if(e.arc(o,a,d,y-w/d,g+b/d,!0),b>0){const t=Hk(E,M,o,a);e.arc(t.x,t.y,b,M+Math.PI,g-rL)}const i=Hk(x,g,o,a);if(e.lineTo(i.x,i.y),_>0){const t=Hk(x,T,o,a);e.arc(t.x,t.y,_,g-rL,T)}}else{e.moveTo(o,a);const t=Math.cos(T)*h+o,i=Math.sin(T)*h+a;e.lineTo(t,i);const r=Math.cos(S)*h+o,s=Math.sin(S)*h+a;e.lineTo(r,s)}e.closePath()}Object.defineProperties(Uk,{defaults:{enumerable:zk,value:xD},instances:{enumerable:zk,value:Nk},overrides:{enumerable:zk,value:_D},registry:{enumerable:zk,value:OF},version:{enumerable:zk,value:"3.9.1"},getChart:{enumerable:zk,value:Fk},register:{enumerable:zk,value:(...e)=>{OF.add(...e),Vk()}},unregister:{enumerable:zk,value:(...e)=>{OF.remove(...e),Vk()}}});class Gk extends yF{constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,i){const r=this.getProps(["x","y"],i),{angle:s,distance:n}=mL(r,{x:e,y:t}),{startAngle:o,endAngle:a,innerRadius:l,outerRadius:c,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),h=this.options.spacing/2,d=NI(u,a-o)>=QI||vL(s,o,a),p=wL(n,l+h,c+h);return d&&p}getCenterPoint(e){const{x:t,y:i,startAngle:r,endAngle:s,innerRadius:n,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],e),{offset:a,spacing:l}=this.options,c=(r+s)/2,u=(n+o+l+a)/2;return{x:t+Math.cos(c)*u,y:i+Math.sin(c)*u}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:i}=this,r=(t.offset||0)/2,s=(t.spacing||0)/2,n=t.circular;if(this.pixelMargin="inner"===t.borderAlign?.33:0,this.fullCircles=i>QI?Math.floor(i/QI):0,0===i||this.innerRadius<0||this.outerRadius<0)return;e.save();let o=0;if(r){o=r/2;const t=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(t)*o,Math.sin(t)*o),this.circumference>=KI&&(o=r)}e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor;const a=function(e,t,i,r,s){const{fullCircles:n,startAngle:o,circumference:a}=t;let l=t.endAngle;if(n){jk(e,t,i,r,o+QI,s);for(let t=0;t<n;++t)e.fill();isNaN(a)||(l=o+a%QI,a%QI==0&&(l+=QI))}return jk(e,t,i,r,l,s),e.fill(),l}(e,this,o,s,n);(function(e,t,i,r,s,n){const{options:o}=t,{borderWidth:a,borderJoinStyle:l}=o,c="inner"===o.borderAlign;a&&(c?(e.lineWidth=2*a,e.lineJoin=l||"round"):(e.lineWidth=a,e.lineJoin=l||"bevel"),t.fullCircles&&function(e,t,i){const{x:r,y:s,startAngle:n,pixelMargin:o,fullCircles:a}=t,l=Math.max(t.outerRadius-o,0),c=t.innerRadius+o;let u;for(i&&Bk(e,t,n+QI),e.beginPath(),e.arc(r,s,c,n+QI,n,!0),u=0;u<a;++u)e.stroke();for(e.beginPath(),e.arc(r,s,l,n,n+QI),u=0;u<a;++u)e.stroke()}(e,t,c),c&&Bk(e,t,s),jk(e,t,i,r,s,n),e.stroke())})(e,this,o,s,a,n),e.restore()}}function Wk(e,t,i=t){e.lineCap=NI(i.borderCapStyle,t.borderCapStyle),e.setLineDash(NI(i.borderDash,t.borderDash)),e.lineDashOffset=NI(i.borderDashOffset,t.borderDashOffset),e.lineJoin=NI(i.borderJoinStyle,t.borderJoinStyle),e.lineWidth=NI(i.borderWidth,t.borderWidth),e.strokeStyle=NI(i.borderColor,t.borderColor)}function Zk(e,t,i){e.lineTo(i.x,i.y)}function qk(e,t,i={}){const r=e.length,{start:s=0,end:n=r-1}=i,{start:o,end:a}=t,l=Math.max(s,o),c=Math.min(n,a),u=s<o&&n<o||s>a&&n>a;return{count:r,start:l,loop:t.loop,ilen:c<l&&!u?r+c-l:c-l}}function $k(e,t,i,r){const{points:s,options:n}=t,{count:o,start:a,loop:l,ilen:c}=qk(s,i,r),u=function(e){return e.stepped?ID:e.tension||"monotone"===e.cubicInterpolationMode?LD:Zk}(n);let h,d,p,{move:f=!0,reverse:m}=r||{};for(h=0;h<=c;++h)d=s[(a+(m?c-h:h))%o],d.skip||(f?(e.moveTo(d.x,d.y),f=!1):u(e,p,d,m,n.stepped),p=d);return l&&(d=s[(a+(m?c:0))%o],u(e,p,d,m,n.stepped)),!!l}function Yk(e,t,i,r){const s=t.points,{count:n,start:o,ilen:a}=qk(s,i,r),{move:l=!0,reverse:c}=r||{};let u,h,d,p,f,m,g=0,y=0;const _=e=>(o+(c?a-e:e))%n,v=()=>{p!==f&&(e.lineTo(g,f),e.lineTo(g,p),e.lineTo(g,m))};for(l&&(h=s[_(0)],e.moveTo(h.x,h.y)),u=0;u<=a;++u){if(h=s[_(u)],h.skip)continue;const t=h.x,i=h.y,r=0|t;r===d?(i<p?p=i:i>f&&(f=i),g=(y*g+t)/++y):(v(),e.lineTo(t,i),d=r,y=0,p=f=i),m=i}v()}function Xk(e){const t=e.options,i=t.borderDash&&t.borderDash.length;return e._decimated||e._loop||t.tension||"monotone"===t.cubicInterpolationMode||t.stepped||i?$k:Yk}Gk.id="arc",Gk.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0},Gk.defaultRoutes={backgroundColor:"backgroundColor"};const Jk="function"==typeof Path2D;class Kk extends yF{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const i=this.options;if((i.tension||"monotone"===i.cubicInterpolationMode)&&!i.stepped&&!this._pointsUpdated){const r=i.spanGaps?this._loop:this._fullLoop;dN(this._points,i,e,r,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(e,t){const i=e.points,r=e.options.spanGaps,s=i.length;if(!s)return[];const n=!!e._loop,{start:o,end:a}=function(e,t,i,r){let s=0,n=t-1;if(i&&!r)for(;s<t&&!e[s].skip;)s++;for(;s<t&&e[s].skip;)s++;for(s%=t,i&&(n+=s);n>s&&e[n%t].skip;)n--;return n%=t,{start:s,end:n}}(i,s,n,r);return function(e,t,i,r){return r&&r.setContext&&i?function(e,t,i,r){const s=e._chart.getContext(),n=FN(e.options),{_datasetIndex:o,options:{spanGaps:a}}=e,l=i.length,c=[];let u=n,h=t[0].start,d=h;function p(e,t,r,s){const n=a?-1:1;if(e!==t){for(e+=l;i[e%l].skip;)e-=n;for(;i[t%l].skip;)t+=n;e%l!=t%l&&(c.push({start:e%l,end:t%l,loop:r,style:s}),u=s,h=t%l)}}for(const e of t){h=a?h:e.start;let t,n=i[h%l];for(d=h+1;d<=e.end;d++){const a=i[d%l];t=FN(r.setContext(ZD(s,{type:"segment",p0:n,p1:a,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:o}))),kN(t,u)&&p(h,d-1,e.loop,u),n=a,u=t}h<d-1&&p(h,d-1,e.loop,u)}return c}(e,t,i,r):t}(e,!0===r?[{start:o,end:a,loop:n}]:function(e,t,i,r){const s=e.length,n=[];let o,a=t,l=e[t];for(o=t+1;o<=i;++o){const i=e[o%s];i.skip||i.stop?l.skip||(r=!1,n.push({start:t%s,end:(o-1)%s,loop:r}),t=a=i.stop?o:null):(a=o,l.skip&&(t=o)),l=i}return null!==a&&n.push({start:t%s,end:a%s,loop:r}),n}(i,o,a<o?a+s:a,!!e._fullLoop&&0===o&&a===s-1),i,t)}(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,i=e.length;return i&&t[e[i-1].end]}interpolate(e,t){const i=this.options,r=e[t],s=this.points,n=NN(this,{property:t,start:r,end:r});if(!n.length)return;const o=[],a=function(e){return e.stepped?SN:e.tension||"monotone"===e.cubicInterpolationMode?EN:TN}(i);let l,c;for(l=0,c=n.length;l<c;++l){const{start:c,end:u}=n[l],h=s[c],d=s[u];if(h===d){o.push(h);continue}const p=a(h,d,Math.abs((r-h[t])/(d[t]-h[t])),i.stepped);p[t]=e[t],o.push(p)}return 1===o.length?o[0]:o}pathSegment(e,t,i){return Xk(this)(e,this,t,i)}path(e,t,i){const r=this.segments,s=Xk(this);let n=this._loop;t=t||0,i=i||this.points.length-t;for(const o of r)n&=s(e,this,o,{start:t,end:t+i-1});return!!n}draw(e,t,i,r){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(e.save(),function(e,t,i,r){Jk&&!t.options.segment?function(e,t,i,r){let s=t._path;s||(s=t._path=new Path2D,t.path(s,i,r)&&s.closePath()),Wk(e,t.options),e.stroke(s)}(e,t,i,r):function(e,t,i,r){const{segments:s,options:n}=t,o=Xk(t);for(const a of s)Wk(e,n,a.style),e.beginPath(),o(e,t,a,{start:i,end:i+r-1})&&e.closePath(),e.stroke()}(e,t,i,r)}(e,this,i,r),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Qk(e,t,i,r){const s=e.options,{[i]:n}=e.getProps([i],r);return Math.abs(t-n)<s.radius+s.hitRadius}Kk.id="line",Kk.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},Kk.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},Kk.descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e};class eU extends yF{constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,i){const r=this.options,{x:s,y:n}=this.getProps(["x","y"],i);return Math.pow(e-s,2)+Math.pow(t-n,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,t){return Qk(this,e,"x",t)}inYRange(e,t){return Qk(this,e,"y",t)}getCenterPoint(e){const{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}size(e){let t=(e=e||this.options||{}).radius||0;return t=Math.max(t,t&&e.hoverRadius||0),2*(t+(t&&e.borderWidth||0))}draw(e,t){const i=this.options;this.skip||i.radius<.1||!OD(this,t,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,AD(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function tU(e,t){const{x:i,y:r,base:s,width:n,height:o}=e.getProps(["x","y","base","width","height"],t);let a,l,c,u,h;return e.horizontal?(h=o/2,a=Math.min(i,s),l=Math.max(i,s),c=r-h,u=r+h):(h=n/2,a=i-h,l=i+h,c=Math.min(r,s),u=Math.max(r,s)),{left:a,top:c,right:l,bottom:u}}function iU(e,t,i,r){return e?0:bL(t,i,r)}function rU(e,t,i,r){const s=null===t,n=null===i,o=e&&!(s&&n)&&tU(e,r);return o&&(s||wL(t,o.left,o.right))&&(n||wL(i,o.top,o.bottom))}function sU(e,t){e.rect(t.x,t.y,t.w,t.h)}function nU(e,t,i={}){const r=e.x!==i.x?-t:0,s=e.y!==i.y?-t:0,n=(e.x+e.w!==i.x+i.w?t:0)-r,o=(e.y+e.h!==i.y+i.h?t:0)-s;return{x:e.x+r,y:e.y+s,w:e.w+n,h:e.h+o,radius:e.radius}}eU.id="point",eU.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},eU.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class oU extends yF{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:i,backgroundColor:r}}=this,{inner:s,outer:n}=function(e){const t=tU(e),i=t.right-t.left,r=t.bottom-t.top,s=function(e,t,i){const r=e.options.borderWidth,s=e.borderSkipped,n=BD(r);return{t:iU(s.top,n.top,0,i),r:iU(s.right,n.right,0,t),b:iU(s.bottom,n.bottom,0,i),l:iU(s.left,n.left,0,t)}}(e,i/2,r/2),n=function(e,t,i){const{enableBorderRadius:r}=e.getProps(["enableBorderRadius"]),s=e.options.borderRadius,n=HD(s),o=Math.min(t,i),a=e.borderSkipped,l=r||II(s);return{topLeft:iU(!l||a.top||a.left,n.topLeft,0,o),topRight:iU(!l||a.top||a.right,n.topRight,0,o),bottomLeft:iU(!l||a.bottom||a.left,n.bottomLeft,0,o),bottomRight:iU(!l||a.bottom||a.right,n.bottomRight,0,o)}}(e,i/2,r/2);return{outer:{x:t.left,y:t.top,w:i,h:r,radius:n},inner:{x:t.left+s.l,y:t.top+s.t,w:i-s.l-s.r,h:r-s.t-s.b,radius:{topLeft:Math.max(0,n.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,n.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,n.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,n.bottomRight-Math.max(s.b,s.r))}}}}(this),o=(a=n.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?FD:sU;var a;e.save(),n.w===s.w&&n.h===s.h||(e.beginPath(),o(e,nU(n,t,s)),e.clip(),o(e,nU(s,-t,n)),e.fillStyle=i,e.fill("evenodd")),e.beginPath(),o(e,nU(s,t)),e.fillStyle=r,e.fill(),e.restore()}inRange(e,t,i){return rU(this,e,t,i)}inXRange(e,t){return rU(this,e,null,t)}inYRange(e,t){return rU(this,null,e,t)}getCenterPoint(e){const{x:t,y:i,base:r,horizontal:s}=this.getProps(["x","y","base","horizontal"],e);return{x:s?(t+r)/2:t,y:s?i:(i+r)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}}oU.id="bar",oU.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},oU.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var aU=Object.freeze({__proto__:null,ArcElement:Gk,LineElement:Kk,PointElement:eU,BarElement:oU});function lU(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{value:t})}}function cU(e){e.data.datasets.forEach((e=>{lU(e)}))}var uU={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,i)=>{if(!i.enabled)return void cU(e);const r=e.width;e.data.datasets.forEach(((t,s)=>{const{_data:n,indexAxis:o}=t,a=e.getDatasetMeta(s),l=n||t.data;if("y"===WD([o,e.options.indexAxis]))return;if(!a.controller.supportsDecimation)return;const c=e.scales[a.xAxisID];if("linear"!==c.type&&"time"!==c.type)return;if(e.options.parsing)return;let u,{start:h,count:d}=function(e,t){const i=t.length;let r,s=0;const{iScale:n}=e,{min:o,max:a,minDefined:l,maxDefined:c}=n.getUserBounds();return l&&(s=bL(CL(t,n.axis,o).lo,0,i-1)),r=c?bL(CL(t,n.axis,a).hi+1,s,i)-s:i-s,{start:s,count:r}}(a,l);if(d<=(i.threshold||4*r))lU(t);else{switch(RI(n)&&(t._data=l,delete t.data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(e){this._data=e}})),i.algorithm){case"lttb":u=function(e,t,i,r,s){const n=s.samples||r;if(n>=i)return e.slice(t,t+i);const o=[],a=(i-2)/(n-2);let l=0;const c=t+i-1;let u,h,d,p,f,m=t;for(o[l++]=e[m],u=0;u<n-2;u++){let r,s=0,n=0;const c=Math.floor((u+1)*a)+1+t,g=Math.min(Math.floor((u+2)*a)+1,i)+t,y=g-c;for(r=c;r<g;r++)s+=e[r].x,n+=e[r].y;s/=y,n/=y;const _=Math.floor(u*a)+1+t,v=Math.min(Math.floor((u+1)*a)+1,i)+t,{x:b,y:w}=e[m];for(d=p=-1,r=_;r<v;r++)p=.5*Math.abs((b-s)*(e[r].y-w)-(b-e[r].x)*(n-w)),p>d&&(d=p,h=e[r],f=r);o[l++]=h,m=f}return o[l++]=e[c],o}(l,h,d,r,i);break;case"min-max":u=function(e,t,i,r){let s,n,o,a,l,c,u,h,d,p,f=0,m=0;const g=[],y=t+i-1,_=e[t].x,v=e[y].x-_;for(s=t;s<t+i;++s){n=e[s],o=(n.x-_)/v*r,a=n.y;const t=0|o;if(t===l)a<d?(d=a,c=s):a>p&&(p=a,u=s),f=(m*f+n.x)/++m;else{const i=s-1;if(!RI(c)&&!RI(u)){const t=Math.min(c,u),r=Math.max(c,u);t!==h&&t!==i&&g.push({...e[t],x:f}),r!==h&&r!==i&&g.push({...e[r],x:f})}s>0&&i!==h&&g.push(e[i]),g.push(n),l=t,m=0,d=p=a,c=u=h=s}}return g}(l,h,d,r);break;default:throw new Error(`Unsupported decimation algorithm '${i.algorithm}'`)}t._decimated=u}}))},destroy(e){cU(e)}};function hU(e,t,i,r){if(r)return;let s=t[e],n=i[e];return"angle"===e&&(s=_L(s),n=_L(n)),{property:e,start:s,end:n}}function dU(e,t,i){for(;t>e;t--){const e=i[t];if(!isNaN(e.x)&&!isNaN(e.y))break}return t}function pU(e,t,i,r){return e&&t?r(e[i],t[i]):e?e[i]:t?t[i]:0}function fU(e,t){let i=[],r=!1;return PI(e)?(r=!0,i=e):i=function(e,t){const{x:i=null,y:r=null}=e||{},s=t.points,n=[];return t.segments.forEach((({start:e,end:t})=>{t=dU(e,t,s);const o=s[e],a=s[t];null!==r?(n.push({x:o.x,y:r}),n.push({x:a.x,y:r})):null!==i&&(n.push({x:i,y:o.y}),n.push({x:i,y:a.y}))})),n}(e,t),i.length?new Kk({points:i,options:{tension:0},_loop:r,_fullLoop:r}):null}function mU(e){return e&&!1!==e.fill}function gU(e,t,i){let r=e[t].fill;const s=[t];let n;if(!i)return r;for(;!1!==r&&-1===s.indexOf(r);){if(!LI(r))return r;if(n=e[r],!n)return!1;if(n.visible)return r;s.push(r),r=n.fill}return!1}function yU(e,t,i){const r=function(e){const t=e.options,i=t.fill;let r=NI(i&&i.target,i);return void 0===r&&(r=!!t.backgroundColor),!1!==r&&null!==r&&(!0===r?"origin":r)}(e);if(II(r))return!isNaN(r.value)&&r;let s=parseFloat(r);return LI(s)&&Math.floor(s)===s?function(e,t,i,r){return"-"!==e&&"+"!==e||(i=t+i),!(i===t||i<0||i>=r)&&i}(r[0],t,s,i):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function _U(e,t,i){const r=[];for(let s=0;s<i.length;s++){const n=i[s],{first:o,last:a,point:l}=vU(n,t,"x");if(!(!l||o&&a))if(o)r.unshift(l);else if(e.push(l),!a)break}e.push(...r)}function vU(e,t,i){const r=e.interpolate(t,i);if(!r)return{};const s=r[i],n=e.segments,o=e.points;let a=!1,l=!1;for(let e=0;e<n.length;e++){const t=n[e],r=o[t.start][i],c=o[t.end][i];if(wL(s,r,c)){a=s===r,l=s===c;break}}return{first:a,last:l,point:r}}class bU{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,i){const{x:r,y:s,radius:n}=this;return t=t||{start:0,end:QI},e.arc(r,s,n,t.end,t.start,!0),!i.bounds}interpolate(e){const{x:t,y:i,radius:r}=this,s=e.angle;return{x:t+Math.cos(s)*r,y:i+Math.sin(s)*r,angle:s}}}function wU(e,t,i){const r=function(e){const{chart:t,fill:i,line:r}=e;if(LI(i))return function(e,t){const i=e.getDatasetMeta(t);return i&&e.isDatasetVisible(t)?i.dataset:null}(t,i);if("stack"===i)return function(e){const{scale:t,index:i,line:r}=e,s=[],n=r.segments,o=r.points,a=function(e,t){const i=[],r=e.getMatchingVisibleMetas("line");for(let e=0;e<r.length;e++){const s=r[e];if(s.index===t)break;s.hidden||i.unshift(s.dataset)}return i}(t,i);a.push(fU({x:null,y:t.bottom},r));for(let e=0;e<n.length;e++){const t=n[e];for(let e=t.start;e<=t.end;e++)_U(s,o[e],a)}return new Kk({points:s,options:{}})}(e);if("shape"===i)return!0;const s=function(e){return(e.scale||{}).getPointPositionForValue?function(e){const{scale:t,fill:i}=e,r=t.options,s=t.getLabels().length,n=r.reverse?t.max:t.min,o=function(e,t,i){let r;return r="start"===e?i:"end"===e?t.options.reverse?t.min:t.max:II(e)?e.value:t.getBaseValue(),r}(i,t,n),a=[];if(r.grid.circular){const e=t.getPointPositionForValue(0,n);return new bU({x:e.x,y:e.y,radius:t.getDistanceFromCenterForValue(o)})}for(let e=0;e<s;++e)a.push(t.getPointPositionForValue(e,o));return a}(e):function(e){const{scale:t={},fill:i}=e,r=function(e,t){let i=null;return"start"===e?i=t.bottom:"end"===e?i=t.top:II(e)?i=t.getPixelForValue(e.value):t.getBasePixel&&(i=t.getBasePixel()),i}(i,t);if(LI(r)){const e=t.isHorizontal();return{x:e?r:null,y:e?null:r}}return null}(e)}(e);return s instanceof bU?s:fU(s,r)}(t),{line:s,scale:n,axis:o}=t,a=s.options,l=a.fill,c=a.backgroundColor,{above:u=c,below:h=c}=l||{};r&&s.points.length&&(RD(e,i),function(e,t){const{line:i,target:r,above:s,below:n,area:o,scale:a}=t,l=i._loop?"angle":t.axis;e.save(),"x"===l&&n!==s&&(xU(e,r,o.top),CU(e,{line:i,target:r,color:s,scale:a,property:l}),e.restore(),e.save(),xU(e,r,o.bottom)),CU(e,{line:i,target:r,color:n,scale:a,property:l}),e.restore()}(e,{line:s,target:r,above:u,below:h,area:i,scale:n,axis:o}),PD(e))}function xU(e,t,i){const{segments:r,points:s}=t;let n=!0,o=!1;e.beginPath();for(const a of r){const{start:r,end:l}=a,c=s[r],u=s[dU(r,l,s)];n?(e.moveTo(c.x,c.y),n=!1):(e.lineTo(c.x,i),e.lineTo(c.x,c.y)),o=!!t.pathSegment(e,a,{move:o}),o?e.closePath():e.lineTo(u.x,i)}e.lineTo(t.first().x,i),e.closePath(),e.clip()}function CU(e,t){const{line:i,target:r,property:s,color:n,scale:o}=t,a=function(e,t,i){const r=e.segments,s=e.points,n=t.points,o=[];for(const e of r){let{start:r,end:a}=e;a=dU(r,a,s);const l=hU(i,s[r],s[a],e.loop);if(!t.segments){o.push({source:e,target:l,start:s[r],end:s[a]});continue}const c=NN(t,l);for(const t of c){const r=hU(i,n[t.start],n[t.end],t.loop),a=DN(e,s,r);for(const e of a)o.push({source:e,target:t,start:{[i]:pU(l,r,"start",Math.max)},end:{[i]:pU(l,r,"end",Math.min)}})}}return o}(i,r,s);for(const{source:t,target:l,start:c,end:u}of a){const{style:{backgroundColor:a=n}={}}=t,h=!0!==r;e.save(),e.fillStyle=a,TU(e,o,h&&hU(s,c,u)),e.beginPath();const d=!!i.pathSegment(e,t);let p;if(h){d?e.closePath():SU(e,r,u,s);const t=!!r.pathSegment(e,l,{move:d,reverse:!0});p=d&&t,p||SU(e,r,c,s)}e.closePath(),e.fill(p?"evenodd":"nonzero"),e.restore()}}function TU(e,t,i){const{top:r,bottom:s}=t.chart.chartArea,{property:n,start:o,end:a}=i||{};"x"===n&&(e.beginPath(),e.rect(o,r,a-o,s-r),e.clip())}function SU(e,t,i,r){const s=t.interpolate(i,r);s&&e.lineTo(s.x,s.y)}var EU={id:"filler",afterDatasetsUpdate(e,t,i){const r=(e.data.datasets||[]).length,s=[];let n,o,a,l;for(o=0;o<r;++o)n=e.getDatasetMeta(o),a=n.dataset,l=null,a&&a.options&&a instanceof Kk&&(l={visible:e.isDatasetVisible(o),index:o,fill:yU(a,o,r),chart:e,axis:n.controller.options.indexAxis,scale:n.vScale,line:a}),n.$filler=l,s.push(l);for(o=0;o<r;++o)l=s[o],l&&!1!==l.fill&&(l.fill=gU(s,o,i.propagate))},beforeDraw(e,t,i){const r="beforeDraw"===i.drawTime,s=e.getSortedVisibleDatasetMetas(),n=e.chartArea;for(let t=s.length-1;t>=0;--t){const i=s[t].$filler;i&&(i.line.updateControlPoints(n,i.axis),r&&i.fill&&wU(e.ctx,i,n))}},beforeDatasetsDraw(e,t,i){if("beforeDatasetsDraw"!==i.drawTime)return;const r=e.getSortedVisibleDatasetMetas();for(let t=r.length-1;t>=0;--t){const i=r[t].$filler;mU(i)&&wU(e.ctx,i,e.chartArea)}},beforeDatasetDraw(e,t,i){const r=t.meta.$filler;mU(r)&&"beforeDatasetDraw"===i.drawTime&&wU(e.ctx,r,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const AU=(e,t)=>{let{boxHeight:i=t,boxWidth:r=t}=e;return e.usePointStyle&&(i=Math.min(i,t),r=e.pointStyleWidth||Math.min(r,t)),{boxWidth:r,boxHeight:i,itemHeight:Math.max(t,i)}};class MU extends yF{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,i){this.maxWidth=e,this.maxHeight=t,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=kI(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter((t=>e.filter(t,this.chart.data)))),e.sort&&(t=t.sort(((t,i)=>e.sort(t,i,this.chart.data)))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display)return void(this.width=this.height=0);const i=e.labels,r=GD(i.font),s=r.size,n=this._computeTitleHeight(),{boxWidth:o,itemHeight:a}=AU(i,s);let l,c;t.font=r.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(n,s,o,a)+10):(c=this.maxHeight,l=this._fitCols(n,s,o,a)+10),this.width=Math.min(l,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,t,i,r){const{ctx:s,maxWidth:n,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.lineWidths=[0],c=r+o;let u=e;s.textAlign="left",s.textBaseline="middle";let h=-1,d=-c;return this.legendItems.forEach(((e,p)=>{const f=i+t/2+s.measureText(e.text).width;(0===p||l[l.length-1]+f+2*o>n)&&(u+=c,l[l.length-(p>0?0:1)]=0,d+=c,h++),a[p]={left:0,top:d,row:h,width:f,height:r},l[l.length-1]+=f+o})),u}_fitCols(e,t,i,r){const{ctx:s,maxHeight:n,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.columnSizes=[],c=n-e;let u=o,h=0,d=0,p=0,f=0;return this.legendItems.forEach(((e,n)=>{const m=i+t/2+s.measureText(e.text).width;n>0&&d+r+2*o>c&&(u+=h+o,l.push({width:h,height:d}),p+=h+o,f++,h=d=0),a[n]={left:p,top:d,col:f,width:m,height:r},h=Math.max(h,m),d+=r+o})),u+=h,l.push({width:h,height:d}),u}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:i,labels:{padding:r},rtl:s}}=this,n=ON(s,this.left,this.width);if(this.isHorizontal()){let s=0,o=PL(i,this.left+r,this.right-this.lineWidths[s]);for(const a of t)s!==a.row&&(s=a.row,o=PL(i,this.left+r,this.right-this.lineWidths[s])),a.top+=this.top+e+r,a.left=n.leftForLtr(n.x(o),a.width),o+=a.width+r}else{let s=0,o=PL(i,this.top+e+r,this.bottom-this.columnSizes[s].height);for(const a of t)a.col!==s&&(s=a.col,o=PL(i,this.top+e+r,this.bottom-this.columnSizes[s].height)),a.top=o,a.left+=this.left+r,a.left=n.leftForLtr(n.x(a.left),a.width),o+=a.height+r}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const e=this.ctx;RD(e,this),this._draw(),PD(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:i,ctx:r}=this,{align:s,labels:n}=e,o=xD.color,a=ON(e.rtl,this.left,this.width),l=GD(n.font),{color:c,padding:u}=n,h=l.size,d=h/2;let p;this.drawTitle(),r.textAlign=a.textAlign("left"),r.textBaseline="middle",r.lineWidth=.5,r.font=l.string;const{boxWidth:f,boxHeight:m,itemHeight:g}=AU(n,h),y=this.isHorizontal(),_=this._computeTitleHeight();p=y?{x:PL(s,this.left+u,this.right-i[0]),y:this.top+u+_,line:0}:{x:this.left+u,y:PL(s,this.top+_+u,this.bottom-t[0].height),line:0},RN(this.ctx,e.textDirection);const v=g+u;this.legendItems.forEach(((b,w)=>{r.strokeStyle=b.fontColor||c,r.fillStyle=b.fontColor||c;const x=r.measureText(b.text).width,C=a.textAlign(b.textAlign||(b.textAlign=n.textAlign)),T=f+d+x;let S=p.x,E=p.y;a.setWidth(this.width),y?w>0&&S+T+u>this.right&&(E=p.y+=v,p.line++,S=p.x=PL(s,this.left+u,this.right-i[p.line])):w>0&&E+v>this.bottom&&(S=p.x=S+t[p.line].width+u,p.line++,E=p.y=PL(s,this.top+_+u,this.bottom-t[p.line].height)),function(e,t,i){if(isNaN(f)||f<=0||isNaN(m)||m<0)return;r.save();const s=NI(i.lineWidth,1);if(r.fillStyle=NI(i.fillStyle,o),r.lineCap=NI(i.lineCap,"butt"),r.lineDashOffset=NI(i.lineDashOffset,0),r.lineJoin=NI(i.lineJoin,"miter"),r.lineWidth=s,r.strokeStyle=NI(i.strokeStyle,o),r.setLineDash(NI(i.lineDash,[])),n.usePointStyle){const o={radius:m*Math.SQRT2/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:s},l=a.xPlus(e,f/2);MD(r,o,l,t+d,n.pointStyleWidth&&f)}else{const n=t+Math.max((h-m)/2,0),o=a.leftForLtr(e,f),l=HD(i.borderRadius);r.beginPath(),Object.values(l).some((e=>0!==e))?FD(r,{x:o,y:n,w:f,h:m,radius:l}):r.rect(o,n,f,m),r.fill(),0!==s&&r.stroke()}r.restore()}(a.x(S),E,b),S=((e,t,i,r)=>e===(r?"left":"right")?i:"center"===e?(t+i)/2:t)(C,S+f+d,y?S+T:this.right,e.rtl),function(e,t,i){DD(r,i.text,e,t+g/2,l,{strikethrough:i.hidden,textAlign:a.textAlign(i.textAlign)})}(a.x(S),E,b),y?p.x+=T+u:p.y+=v})),PN(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,i=GD(t.font),r=jD(t.padding);if(!t.display)return;const s=ON(e.rtl,this.left,this.width),n=this.ctx,o=t.position,a=i.size/2,l=r.top+a;let c,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+l,u=PL(e.align,u,this.right-h);else{const t=this.columnSizes.reduce(((e,t)=>Math.max(e,t.height)),0);c=l+PL(e.align,this.top,this.bottom-t-e.labels.padding-this._computeTitleHeight())}const d=PL(o,u,u+h);n.textAlign=s.textAlign(RL(o)),n.textBaseline="middle",n.strokeStyle=t.color,n.fillStyle=t.color,n.font=i.string,DD(n,t.text,d,c,i)}_computeTitleHeight(){const e=this.options.title,t=GD(e.font),i=jD(e.padding);return e.display?t.lineHeight+i.height:0}_getLegendItemAt(e,t){let i,r,s;if(wL(e,this.left,this.right)&&wL(t,this.top,this.bottom))for(s=this.legendHitBoxes,i=0;i<s.length;++i)if(r=s[i],wL(e,r.left,r.left+r.width)&&wL(t,r.top,r.top+r.height))return this.legendItems[i];return null}handleEvent(e){const t=this.options;if(!function(e,t){return!("mousemove"!==e&&"mouseout"!==e||!t.onHover&&!t.onLeave)||!(!t.onClick||"click"!==e&&"mouseup"!==e)}(e.type,t))return;const i=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type||"mouseout"===e.type){const n=this._hoveredItem,o=(s=i,null!==(r=n)&&null!==s&&r.datasetIndex===s.datasetIndex&&r.index===s.index);n&&!o&&kI(t.onLeave,[e,n,this],this),this._hoveredItem=i,i&&!o&&kI(t.onHover,[e,i,this],this)}else i&&kI(t.onClick,[e,i,this],this);var r,s}}var OU={id:"legend",_element:MU,start(e,t,i){const r=e.legend=new MU({ctx:e.ctx,options:i,chart:e});KF.configure(e,r,i),KF.addBox(e,r)},stop(e){KF.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,i){const r=e.legend;KF.configure(e,r,i),r.options=i},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,i){const r=t.datasetIndex,s=i.chart;s.isDatasetVisible(r)?(s.hide(r),t.hidden=!0):(s.show(r),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:i,pointStyle:r,textAlign:s,color:n}}=e.legend.options;return e._getSortedDatasetMetas().map((e=>{const o=e.controller.getStyle(i?0:void 0),a=jD(o.borderWidth);return{text:t[e.index].label,fillStyle:o.backgroundColor,fontColor:n,hidden:!e.visible,lineCap:o.borderCapStyle,lineDash:o.borderDash,lineDashOffset:o.borderDashOffset,lineJoin:o.borderJoinStyle,lineWidth:(a.width+a.height)/4,strokeStyle:o.borderColor,pointStyle:r||o.pointStyle,rotation:o.rotation,textAlign:s||o.textAlign,borderRadius:0,datasetIndex:e.index}}),this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class RU extends yF{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=e,this.height=this.bottom=t;const r=PI(i.text)?i.text.length:1;this._padding=jD(i.padding);const s=r*GD(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){const{top:t,left:i,bottom:r,right:s,options:n}=this,o=n.align;let a,l,c,u=0;return this.isHorizontal()?(l=PL(o,i,s),c=t+e,a=s-i):("left"===n.position?(l=i+e,c=PL(o,r,t),u=-.5*KI):(l=s-e,c=PL(o,t,r),u=.5*KI),a=r-t),{titleX:l,titleY:c,maxWidth:a,rotation:u}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const i=GD(t.font),r=i.lineHeight/2+this._padding.top,{titleX:s,titleY:n,maxWidth:o,rotation:a}=this._drawArgs(r);DD(e,t.text,0,0,i,{color:t.color,maxWidth:o,rotation:a,textAlign:RL(t.align),textBaseline:"middle",translation:[s,n]})}}var PU={id:"title",_element:RU,start(e,t,i){!function(e,t){const i=new RU({ctx:e.ctx,options:t,chart:e});KF.configure(e,i,t),KF.addBox(e,i),e.titleBlock=i}(e,i)},stop(e){const t=e.titleBlock;KF.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,i){const r=e.titleBlock;KF.configure(e,r,i),r.options=i},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const IU=new WeakMap;var LU={id:"subtitle",start(e,t,i){const r=new RU({ctx:e.ctx,options:i,chart:e});KF.configure(e,r,i),KF.addBox(e,r),IU.set(e,r)},stop(e){KF.removeBox(e,IU.get(e)),IU.delete(e)},beforeUpdate(e,t,i){const r=IU.get(e);KF.configure(e,r,i),r.options=i},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const DU={average(e){if(!e.length)return!1;let t,i,r=0,s=0,n=0;for(t=0,i=e.length;t<i;++t){const i=e[t].element;if(i&&i.hasValue()){const e=i.tooltipPosition();r+=e.x,s+=e.y,++n}}return{x:r/n,y:s/n}},nearest(e,t){if(!e.length)return!1;let i,r,s,n=t.x,o=t.y,a=Number.POSITIVE_INFINITY;for(i=0,r=e.length;i<r;++i){const r=e[i].element;if(r&&r.hasValue()){const e=gL(t,r.getCenterPoint());e<a&&(a=e,s=r)}}if(s){const e=s.tooltipPosition();n=e.x,o=e.y}return{x:n,y:o}}};function NU(e,t){return t&&(PI(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function FU(e){return("string"==typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function kU(e,t){const{element:i,datasetIndex:r,index:s}=t,n=e.getDatasetMeta(r).controller,{label:o,value:a}=n.getLabelAndValue(s);return{chart:e,label:o,parsed:n.getParsed(s),raw:e.data.datasets[r].data[s],formattedValue:a,dataset:n.getDataset(),dataIndex:s,datasetIndex:r,element:i}}function UU(e,t){const i=e.chart.ctx,{body:r,footer:s,title:n}=e,{boxWidth:o,boxHeight:a}=t,l=GD(t.bodyFont),c=GD(t.titleFont),u=GD(t.footerFont),h=n.length,d=s.length,p=r.length,f=jD(t.padding);let m=f.height,g=0,y=r.reduce(((e,t)=>e+t.before.length+t.lines.length+t.after.length),0);y+=e.beforeBody.length+e.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*t.titleSpacing+t.titleMarginBottom),y&&(m+=p*(t.displayColors?Math.max(a,l.lineHeight):l.lineHeight)+(y-p)*l.lineHeight+(y-1)*t.bodySpacing),d&&(m+=t.footerMarginTop+d*u.lineHeight+(d-1)*t.footerSpacing);let _=0;const v=function(e){g=Math.max(g,i.measureText(e).width+_)};return i.save(),i.font=c.string,UI(e.title,v),i.font=l.string,UI(e.beforeBody.concat(e.afterBody),v),_=t.displayColors?o+2+t.boxPadding:0,UI(r,(e=>{UI(e.before,v),UI(e.lines,v),UI(e.after,v)})),_=0,i.font=u.string,UI(e.footer,v),i.restore(),g+=f.width,{width:g,height:m}}function VU(e,t,i,r){const{x:s,width:n}=i,{width:o,chartArea:{left:a,right:l}}=e;let c="center";return"center"===r?c=s<=(a+l)/2?"left":"right":s<=n/2?c="left":s>=o-n/2&&(c="right"),function(e,t,i,r){const{x:s,width:n}=r,o=i.caretSize+i.caretPadding;return"left"===e&&s+n+o>t.width||"right"===e&&s-n-o<0||void 0}(c,e,t,i)&&(c="center"),c}function zU(e,t,i){const r=i.yAlign||t.yAlign||function(e,t){const{y:i,height:r}=t;return i<r/2?"top":i>e.height-r/2?"bottom":"center"}(e,i);return{xAlign:i.xAlign||t.xAlign||VU(e,t,i,r),yAlign:r}}function BU(e,t,i,r){const{caretSize:s,caretPadding:n,cornerRadius:o}=e,{xAlign:a,yAlign:l}=i,c=s+n,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=HD(o);let f=function(e,t){let{x:i,width:r}=e;return"right"===t?i-=r:"center"===t&&(i-=r/2),i}(t,a);const m=function(e,t,i){let{y:r,height:s}=e;return"top"===t?r+=i:r-="bottom"===t?s+i:s/2,r}(t,l,c);return"center"===l?"left"===a?f+=c:"right"===a&&(f-=c):"left"===a?f-=Math.max(u,d)+s:"right"===a&&(f+=Math.max(h,p)+s),{x:bL(f,0,r.width-t.width),y:bL(m,0,r.height-t.height)}}function HU(e,t,i){const r=jD(i.padding);return"center"===t?e.x+e.width/2:"right"===t?e.x+e.width-r.right:e.x+r.left}function jU(e){return NU([],FU(e))}function GU(e,t){const i=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return i?e.override(i):e}class WU extends yF{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart||e._chart,this._chart=this.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,i=this.options.setContext(this.getContext()),r=i.enabled&&t.options.animation&&i.animations,s=new jN(this.chart,r);return r._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=(this,ZD(this.chart.getContext(),{tooltip:this,tooltipItems:this._tooltipItems,type:"tooltip"})))}getTitle(e,t){const{callbacks:i}=t,r=i.beforeTitle.apply(this,[e]),s=i.title.apply(this,[e]),n=i.afterTitle.apply(this,[e]);let o=[];return o=NU(o,FU(r)),o=NU(o,FU(s)),o=NU(o,FU(n)),o}getBeforeBody(e,t){return jU(t.callbacks.beforeBody.apply(this,[e]))}getBody(e,t){const{callbacks:i}=t,r=[];return UI(e,(e=>{const t={before:[],lines:[],after:[]},s=GU(i,e);NU(t.before,FU(s.beforeLabel.call(this,e))),NU(t.lines,s.label.call(this,e)),NU(t.after,FU(s.afterLabel.call(this,e))),r.push(t)})),r}getAfterBody(e,t){return jU(t.callbacks.afterBody.apply(this,[e]))}getFooter(e,t){const{callbacks:i}=t,r=i.beforeFooter.apply(this,[e]),s=i.footer.apply(this,[e]),n=i.afterFooter.apply(this,[e]);let o=[];return o=NU(o,FU(r)),o=NU(o,FU(s)),o=NU(o,FU(n)),o}_createItems(e){const t=this._active,i=this.chart.data,r=[],s=[],n=[];let o,a,l=[];for(o=0,a=t.length;o<a;++o)l.push(kU(this.chart,t[o]));return e.filter&&(l=l.filter(((t,r,s)=>e.filter(t,r,s,i)))),e.itemSort&&(l=l.sort(((t,r)=>e.itemSort(t,r,i)))),UI(l,(t=>{const i=GU(e.callbacks,t);r.push(i.labelColor.call(this,t)),s.push(i.labelPointStyle.call(this,t)),n.push(i.labelTextColor.call(this,t))})),this.labelColors=r,this.labelPointStyles=s,this.labelTextColors=n,this.dataPoints=l,l}update(e,t){const i=this.options.setContext(this.getContext()),r=this._active;let s,n=[];if(r.length){const e=DU[i.position].call(this,r,this._eventPosition);n=this._createItems(i),this.title=this.getTitle(n,i),this.beforeBody=this.getBeforeBody(n,i),this.body=this.getBody(n,i),this.afterBody=this.getAfterBody(n,i),this.footer=this.getFooter(n,i);const t=this._size=UU(this,i),o=Object.assign({},e,t),a=zU(this.chart,i,o),l=BU(i,o,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,s={opacity:1,x:l.x,y:l.y,width:t.width,height:t.height,caretX:e.x,caretY:e.y}}else 0!==this.opacity&&(s={opacity:0});this._tooltipItems=n,this.$context=void 0,s&&this._resolveAnimations().update(this,s),e&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,i,r){const s=this.getCaretPosition(e,i,r);t.lineTo(s.x1,s.y1),t.lineTo(s.x2,s.y2),t.lineTo(s.x3,s.y3)}getCaretPosition(e,t,i){const{xAlign:r,yAlign:s}=this,{caretSize:n,cornerRadius:o}=i,{topLeft:a,topRight:l,bottomLeft:c,bottomRight:u}=HD(o),{x:h,y:d}=e,{width:p,height:f}=t;let m,g,y,_,v,b;return"center"===s?(v=d+f/2,"left"===r?(m=h,g=m-n,_=v+n,b=v-n):(m=h+p,g=m+n,_=v-n,b=v+n),y=m):(g="left"===r?h+Math.max(a,c)+n:"right"===r?h+p-Math.max(l,u)-n:this.caretX,"top"===s?(_=d,v=_-n,m=g-n,y=g+n):(_=d+f,v=_+n,m=g+n,y=g-n),b=_),{x1:m,x2:g,x3:y,y1:_,y2:v,y3:b}}drawTitle(e,t,i){const r=this.title,s=r.length;let n,o,a;if(s){const l=ON(i.rtl,this.x,this.width);for(e.x=HU(this,i.titleAlign,i),t.textAlign=l.textAlign(i.titleAlign),t.textBaseline="middle",n=GD(i.titleFont),o=i.titleSpacing,t.fillStyle=i.titleColor,t.font=n.string,a=0;a<s;++a)t.fillText(r[a],l.x(e.x),e.y+n.lineHeight/2),e.y+=n.lineHeight+o,a+1===s&&(e.y+=i.titleMarginBottom-o)}}_drawColorBox(e,t,i,r,s){const n=this.labelColors[i],o=this.labelPointStyles[i],{boxHeight:a,boxWidth:l,boxPadding:c}=s,u=GD(s.bodyFont),h=HU(this,"left",s),d=r.x(h),p=a<u.lineHeight?(u.lineHeight-a)/2:0,f=t.y+p;if(s.usePointStyle){const t={radius:Math.min(l,a)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},i=r.leftForLtr(d,l)+l/2,c=f+a/2;e.strokeStyle=s.multiKeyBackground,e.fillStyle=s.multiKeyBackground,AD(e,t,i,c),e.strokeStyle=n.borderColor,e.fillStyle=n.backgroundColor,AD(e,t,i,c)}else{e.lineWidth=II(n.borderWidth)?Math.max(...Object.values(n.borderWidth)):n.borderWidth||1,e.strokeStyle=n.borderColor,e.setLineDash(n.borderDash||[]),e.lineDashOffset=n.borderDashOffset||0;const t=r.leftForLtr(d,l-c),i=r.leftForLtr(r.xPlus(d,1),l-c-2),o=HD(n.borderRadius);Object.values(o).some((e=>0!==e))?(e.beginPath(),e.fillStyle=s.multiKeyBackground,FD(e,{x:t,y:f,w:l,h:a,radius:o}),e.fill(),e.stroke(),e.fillStyle=n.backgroundColor,e.beginPath(),FD(e,{x:i,y:f+1,w:l-2,h:a-2,radius:o}),e.fill()):(e.fillStyle=s.multiKeyBackground,e.fillRect(t,f,l,a),e.strokeRect(t,f,l,a),e.fillStyle=n.backgroundColor,e.fillRect(i,f+1,l-2,a-2))}e.fillStyle=this.labelTextColors[i]}drawBody(e,t,i){const{body:r}=this,{bodySpacing:s,bodyAlign:n,displayColors:o,boxHeight:a,boxWidth:l,boxPadding:c}=i,u=GD(i.bodyFont);let h=u.lineHeight,d=0;const p=ON(i.rtl,this.x,this.width),f=function(i){t.fillText(i,p.x(e.x+d),e.y+h/2),e.y+=h+s},m=p.textAlign(n);let g,y,_,v,b,w,x;for(t.textAlign=n,t.textBaseline="middle",t.font=u.string,e.x=HU(this,m,i),t.fillStyle=i.bodyColor,UI(this.beforeBody,f),d=o&&"right"!==m?"center"===n?l/2+c:l+2+c:0,v=0,w=r.length;v<w;++v){for(g=r[v],y=this.labelTextColors[v],t.fillStyle=y,UI(g.before,f),_=g.lines,o&&_.length&&(this._drawColorBox(t,e,v,p,i),h=Math.max(u.lineHeight,a)),b=0,x=_.length;b<x;++b)f(_[b]),h=u.lineHeight;UI(g.after,f)}d=0,h=u.lineHeight,UI(this.afterBody,f),e.y-=s}drawFooter(e,t,i){const r=this.footer,s=r.length;let n,o;if(s){const a=ON(i.rtl,this.x,this.width);for(e.x=HU(this,i.footerAlign,i),e.y+=i.footerMarginTop,t.textAlign=a.textAlign(i.footerAlign),t.textBaseline="middle",n=GD(i.footerFont),t.fillStyle=i.footerColor,t.font=n.string,o=0;o<s;++o)t.fillText(r[o],a.x(e.x),e.y+n.lineHeight/2),e.y+=n.lineHeight+i.footerSpacing}}drawBackground(e,t,i,r){const{xAlign:s,yAlign:n}=this,{x:o,y:a}=e,{width:l,height:c}=i,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=HD(r.cornerRadius);t.fillStyle=r.backgroundColor,t.strokeStyle=r.borderColor,t.lineWidth=r.borderWidth,t.beginPath(),t.moveTo(o+u,a),"top"===n&&this.drawCaret(e,t,i,r),t.lineTo(o+l-h,a),t.quadraticCurveTo(o+l,a,o+l,a+h),"center"===n&&"right"===s&&this.drawCaret(e,t,i,r),t.lineTo(o+l,a+c-p),t.quadraticCurveTo(o+l,a+c,o+l-p,a+c),"bottom"===n&&this.drawCaret(e,t,i,r),t.lineTo(o+d,a+c),t.quadraticCurveTo(o,a+c,o,a+c-d),"center"===n&&"left"===s&&this.drawCaret(e,t,i,r),t.lineTo(o,a+u),t.quadraticCurveTo(o,a,o+u,a),t.closePath(),t.fill(),r.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,i=this.$animations,r=i&&i.x,s=i&&i.y;if(r||s){const i=DU[e.position].call(this,this._active,this._eventPosition);if(!i)return;const n=this._size=UU(this,e),o=Object.assign({},i,this._size),a=zU(t,e,o),l=BU(e,o,a,t);r._to===l.x&&s._to===l.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=n.width,this.height=n.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(t);const r={width:this.width,height:this.height},s={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const n=jD(t.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&o&&(e.save(),e.globalAlpha=i,this.drawBackground(s,e,r,t),RN(e,t.textDirection),s.y+=n.top,this.drawTitle(s,e,t),this.drawBody(s,e,t),this.drawFooter(s,e,t),PN(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const i=this._active,r=e.map((({datasetIndex:e,index:t})=>{const i=this.chart.getDatasetMeta(e);if(!i)throw new Error("Cannot find a dataset at index "+e);return{datasetIndex:e,element:i.data[t],index:t}})),s=!VI(i,r),n=this._positionChanged(r,t);(s||n)&&(this._active=r,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,i=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const r=this.options,s=this._active||[],n=this._getActiveElements(e,s,t,i),o=this._positionChanged(n,e),a=t||!VI(n,s)||o;return a&&(this._active=n,(r.enabled||r.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),a}_getActiveElements(e,t,i,r){const s=this.options;if("mouseout"===e.type)return[];if(!r)return t;const n=this.chart.getElementsAtEventForMode(e,s.mode,s,i);return s.reverse&&n.reverse(),n}_positionChanged(e,t){const{caretX:i,caretY:r,options:s}=this,n=DU[s.position].call(this,e,t);return!1!==n&&(i!==n.x||r!==n.y)}}WU.positioners=DU;var ZU={id:"tooltip",_element:WU,positioners:DU,afterInit(e,t,i){i&&(e.tooltip=new WU({chart:e,options:i}))},beforeUpdate(e,t,i){e.tooltip&&e.tooltip.initialize(i)},reset(e,t,i){e.tooltip&&e.tooltip.initialize(i)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const i={tooltip:t};if(!1===e.notifyPlugins("beforeTooltipDraw",i))return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",i)}},afterEvent(e,t){if(e.tooltip){const i=t.replay;e.tooltip.handleEvent(t.event,i,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:MI,title(e){if(e.length>0){const t=e[0],i=t.chart.data.labels,r=i?i.length:0;if(this&&this.options&&"dataset"===this.options.mode)return t.dataset.label||"";if(t.label)return t.label;if(r>0&&t.dataIndex<r)return i[t.dataIndex]}return""},afterTitle:MI,beforeBody:MI,beforeLabel:MI,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const i=e.formattedValue;return RI(i)||(t+=i),t},labelColor(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:MI,afterBody:MI,beforeFooter:MI,footer:MI,afterFooter:MI}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},qU=Object.freeze({__proto__:null,Decimation:uU,Filler:EU,Legend:OU,SubTitle:LU,Title:PU,Tooltip:ZU});class $U extends AF{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const e=this.getLabels();for(const{index:i,label:r}of t)e[i]===r&&e.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(RI(e))return null;const i=this.getLabels();return((e,t)=>null===e?null:bL(Math.round(e),0,t))(t=isFinite(t)&&i[t]===e?t:function(e,t,i,r){const s=e.indexOf(t);return-1===s?((e,t,i,r)=>("string"==typeof t?(i=e.push(t)-1,r.unshift({index:i,label:t})):isNaN(t)&&(i=null),i))(e,t,i,r):s!==e.lastIndexOf(t)?i:s}(i,e,NI(t,e),this._addedLabels),i.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:i,max:r}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(i=0),t||(r=this.getLabels().length-1)),this.min=i,this.max=r}buildTicks(){const e=this.min,t=this.max,i=this.options.offset,r=[];let s=this.getLabels();s=0===e&&t===s.length-1?s:s.slice(e,t+1),this._valueRange=Math.max(s.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let i=e;i<=t;i++)r.push({value:i});return r}getLabelForValue(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!=typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function YU(e,t,{horizontal:i,minRotation:r}){const s=dL(r),n=(i?Math.sin(s):Math.cos(s))||.001,o=.75*t*(""+e).length;return Math.min(t/n,o)}$U.id="category",$U.defaults={ticks:{callback:$U.prototype.getLabelForValue}};class XU extends AF{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return RI(e)||("number"==typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:i}=this.getUserBounds();let{min:r,max:s}=this;const n=e=>r=t?r:e,o=e=>s=i?s:e;if(e){const e=aL(r),t=aL(s);e<0&&t<0?o(0):e>0&&t>0&&n(0)}if(r===s){let t=1;(s>=Number.MAX_SAFE_INTEGER||r<=Number.MIN_SAFE_INTEGER)&&(t=Math.abs(.05*s)),o(s+t),e||n(r-t)}this.min=r,this.max=s}getTickLimit(){const e=this.options.ticks;let t,{maxTicksLimit:i,stepSize:r}=e;return r?(t=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,t>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${t} ticks. Limiting to 1000.`),t=1e3)):(t=this.computeTickLimit(),i=i||11),i&&(t=Math.min(i,t)),t}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let i=this.getTickLimit();i=Math.max(2,i);const r=function(e,t){const i=[],{bounds:r,step:s,min:n,max:o,precision:a,count:l,maxTicks:c,maxDigits:u,includeBounds:h}=e,d=s||1,p=c-1,{min:f,max:m}=t,g=!RI(n),y=!RI(o),_=!RI(l),v=(m-f)/(u+1);let b,w,x,C,T=lL((m-f)/p/d)*d;if(T<1e-14&&!g&&!y)return[{value:f},{value:m}];C=Math.ceil(m/T)-Math.floor(f/T),C>p&&(T=lL(C*T/p/d)*d),RI(a)||(b=Math.pow(10,a),T=Math.ceil(T*b)/b),"ticks"===r?(w=Math.floor(f/T)*T,x=Math.ceil(m/T)*T):(w=f,x=m),g&&y&&s&&function(e,t){const i=Math.round(e);return i-t<=e&&i+t>=e}((o-n)/s,T/1e3)?(C=Math.round(Math.min((o-n)/T,c)),T=(o-n)/C,w=n,x=o):_?(w=g?n:w,x=y?o:x,C=l-1,T=(x-w)/C):(C=(x-w)/T,C=uL(C,Math.round(C),T/1e3)?Math.round(C):Math.ceil(C));const S=Math.max(fL(T),fL(w));b=Math.pow(10,RI(a)?S:a),w=Math.round(w*b)/b,x=Math.round(x*b)/b;let E=0;for(g&&(h&&w!==n?(i.push({value:n}),w<n&&E++,uL(Math.round((w+E*T)*b)/b,n,YU(n,v,e))&&E++):w<n&&E++);E<C;++E)i.push({value:Math.round((w+E*T)*b)/b});return y&&h&&x!==o?i.length&&uL(i[i.length-1].value,o,YU(o,v,e))?i[i.length-1].value=o:i.push({value:o}):y&&x!==o||i.push({value:x}),i}({maxTicks:i,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===e.bounds&&hL(r,this,"value"),e.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const e=this.ticks;let t=this.min,i=this.max;if(super.configure(),this.options.offset&&e.length){const r=(i-t)/Math.max(e.length-1,1)/2;t-=r,i+=r}this._startValue=t,this._endValue=i,this._valueRange=i-t}getLabelForValue(e){return MN(e,this.chart.options.locale,this.options.ticks.format)}}class JU extends XU{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=LI(e)?e:0,this.max=LI(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,i=dL(this.options.ticks.minRotation),r=(e?Math.sin(i):Math.cos(i))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,s.lineHeight/r))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}function KU(e){return 1==e/Math.pow(10,Math.floor(oL(e)))}JU.id="linear",JU.defaults={ticks:{callback:vF.formatters.numeric}};class QU extends AF{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const i=XU.prototype.parse.apply(this,[e,t]);if(0!==i)return LI(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=LI(e)?Math.max(0,e):null,this.max=LI(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let i=this.min,r=this.max;const s=t=>i=e?i:t,n=e=>r=t?r:e,o=(e,t)=>Math.pow(10,Math.floor(oL(e))+t);i===r&&(i<=0?(s(1),n(10)):(s(o(i,-1)),n(o(r,1)))),i<=0&&s(o(r,-1)),r<=0&&n(o(i,1)),this._zero&&this.min!==this._suggestedMin&&i===o(this.min,0)&&s(o(i,-1)),this.min=i,this.max=r}buildTicks(){const e=this.options,t=function(e,t){const i=Math.floor(oL(t.max)),r=Math.ceil(t.max/Math.pow(10,i)),s=[];let n=DI(e.min,Math.pow(10,Math.floor(oL(t.min)))),o=Math.floor(oL(n)),a=Math.floor(n/Math.pow(10,o)),l=o<0?Math.pow(10,Math.abs(o)):1;do{s.push({value:n,major:KU(n)}),++a,10===a&&(a=1,++o,l=o>=0?1:l),n=Math.round(a*Math.pow(10,o)*l)/l}while(o<i||o===i&&a<r);const c=DI(e.max,n);return s.push({value:c,major:KU(n)}),s}({min:this._userMin,max:this._userMax},this);return"ticks"===e.bounds&&hL(t,this,"value"),e.reverse?(t.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),t}getLabelForValue(e){return void 0===e?"0":MN(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=oL(e),this._valueRange=oL(this.max)-oL(e)}getPixelForValue(e){return void 0!==e&&0!==e||(e=this.min),null===e||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(oL(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function eV(e){const t=e.ticks;if(t.display&&e.display){const e=jD(t.backdropPadding);return NI(t.font&&t.font.size,xD.font.size)+e.height}return 0}function tV(e,t,i,r,s){return e===r||e===s?{start:t-i/2,end:t+i/2}:e<r||e>s?{start:t-i,end:t}:{start:t,end:t+i}}function iV(e,t,i,r,s){const n=Math.abs(Math.sin(i)),o=Math.abs(Math.cos(i));let a=0,l=0;r.start<t.l?(a=(t.l-r.start)/n,e.l=Math.min(e.l,t.l-a)):r.end>t.r&&(a=(r.end-t.r)/n,e.r=Math.max(e.r,t.r+a)),s.start<t.t?(l=(t.t-s.start)/o,e.t=Math.min(e.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/o,e.b=Math.max(e.b,t.b+l))}function rV(e){return 0===e||180===e?"center":e<180?"left":"right"}function sV(e,t,i){return"right"===i?e-=t:"center"===i&&(e-=t/2),e}function nV(e,t,i){return 90===i||270===i?e-=t/2:(i>270||i<90)&&(e-=t),e}function oV(e,t,i,r){const{ctx:s}=e;if(i)s.arc(e.xCenter,e.yCenter,t,0,QI);else{let i=e.getPointPosition(0,t);s.moveTo(i.x,i.y);for(let n=1;n<r;n++)i=e.getPointPosition(n,t),s.lineTo(i.x,i.y)}}QU.id="logarithmic",QU.defaults={ticks:{callback:vF.formatters.logarithmic,major:{enabled:!0}}};class aV extends XU{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=jD(eV(this.options)/2),t=this.width=this.maxWidth-e.width,i=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+i/2+e.top),this.drawingArea=Math.floor(Math.min(t,i)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=LI(e)&&!isNaN(e)?e:0,this.max=LI(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/eV(this.options))}generateTickLabels(e){XU.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map(((e,t)=>{const i=kI(this.options.pointLabels.callback,[e,t],this);return i||0===i?i:""})).filter(((e,t)=>this.chart.getDataVisibility(t)))}fit(){const e=this.options;e.display&&e.pointLabels.display?function(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},i=Object.assign({},t),r=[],s=[],n=e._pointLabels.length,o=e.options.pointLabels,a=o.centerPointLabels?KI/n:0;for(let h=0;h<n;h++){const n=o.setContext(e.getPointLabelContext(h));s[h]=n.padding;const d=e.getPointPosition(h,e.drawingArea+s[h],a),p=GD(n.font),f=(l=e.ctx,c=p,u=PI(u=e._pointLabels[h])?u:[u],{w:TD(l,c.string,u),h:u.length*c.lineHeight});r[h]=f;const m=_L(e.getIndexAngle(h)+a),g=Math.round(pL(m));iV(i,t,m,tV(g,d.x,f.w,0,180),tV(g,d.y,f.h,90,270))}var l,c,u;e.setCenterPoint(t.l-i.l,i.r-t.r,t.t-i.t,i.b-t.b),e._pointLabelItems=function(e,t,i){const r=[],s=e._pointLabels.length,n=e.options,o=eV(n)/2,a=e.drawingArea,l=n.pointLabels.centerPointLabels?KI/s:0;for(let n=0;n<s;n++){const s=e.getPointPosition(n,a+o+i[n],l),c=Math.round(pL(_L(s.angle+rL))),u=t[n],h=nV(s.y,u.h,c),d=rV(c),p=sV(s.x,u.w,d);r.push({x:s.x,y:h,textAlign:d,left:p,top:h,right:p+u.w,bottom:h+u.h})}return r}(e,r,s)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,i,r){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((i-r)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,i,r))}getIndexAngle(e){return _L(e*(QI/(this._pointLabels.length||1))+dL(this.options.startAngle||0))}getDistanceFromCenterForValue(e){if(RI(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(RI(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const i=t[e];return function(e,t,i){return ZD(e,{label:i,index:t,type:"pointLabel"})}(this.getContext(),e,i)}}getPointPosition(e,t,i=0){const r=this.getIndexAngle(e)-rL+i;return{x:Math.cos(r)*t+this.xCenter,y:Math.sin(r)*t+this.yCenter,angle:r}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:i,right:r,bottom:s}=this._pointLabelItems[e];return{left:t,top:i,right:r,bottom:s}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const i=this.ctx;i.save(),i.beginPath(),oV(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),i.closePath(),i.fillStyle=e,i.fill(),i.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:i,grid:r}=t,s=this._pointLabels.length;let n,o,a;if(t.pointLabels.display&&function(e,t){const{ctx:i,options:{pointLabels:r}}=e;for(let s=t-1;s>=0;s--){const t=r.setContext(e.getPointLabelContext(s)),n=GD(t.font),{x:o,y:a,textAlign:l,left:c,top:u,right:h,bottom:d}=e._pointLabelItems[s],{backdropColor:p}=t;if(!RI(p)){const e=HD(t.borderRadius),r=jD(t.backdropPadding);i.fillStyle=p;const s=c-r.left,n=u-r.top,o=h-c+r.width,a=d-u+r.height;Object.values(e).some((e=>0!==e))?(i.beginPath(),FD(i,{x:s,y:n,w:o,h:a,radius:e}),i.fill()):i.fillRect(s,n,o,a)}DD(i,e._pointLabels[s],o,a+n.lineHeight/2,n,{color:t.color,textAlign:l,textBaseline:"middle"})}}(this,s),r.display&&this.ticks.forEach(((e,t)=>{0!==t&&(o=this.getDistanceFromCenterForValue(e.value),function(e,t,i,r){const s=e.ctx,n=t.circular,{color:o,lineWidth:a}=t;!n&&!r||!o||!a||i<0||(s.save(),s.strokeStyle=o,s.lineWidth=a,s.setLineDash(t.borderDash),s.lineDashOffset=t.borderDashOffset,s.beginPath(),oV(e,i,n,r),s.closePath(),s.stroke(),s.restore())}(this,r.setContext(this.getContext(t-1)),o,s))})),i.display){for(e.save(),n=s-1;n>=0;n--){const r=i.setContext(this.getPointLabelContext(n)),{color:s,lineWidth:l}=r;l&&s&&(e.lineWidth=l,e.strokeStyle=s,e.setLineDash(r.borderDash),e.lineDashOffset=r.borderDashOffset,o=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),a=this.getPointPosition(n,o),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(a.x,a.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,i=t.ticks;if(!i.display)return;const r=this.getIndexAngle(0);let s,n;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(r),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach(((r,o)=>{if(0===o&&!t.reverse)return;const a=i.setContext(this.getContext(o)),l=GD(a.font);if(s=this.getDistanceFromCenterForValue(this.ticks[o].value),a.showLabelBackdrop){e.font=l.string,n=e.measureText(r.label).width,e.fillStyle=a.backdropColor;const t=jD(a.backdropPadding);e.fillRect(-n/2-t.left,-s-l.size/2-t.top,n+t.width,l.size+t.height)}DD(e,r.label,0,-s,l,{color:a.color})})),e.restore()}drawTitle(){}}aV.id="radialLinear",aV.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:vF.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:e=>e,padding:5,centerPointLabels:!1}},aV.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},aV.descriptors={angleLines:{_fallback:"grid"}};const lV={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},cV=Object.keys(lV);function uV(e,t){return e-t}function hV(e,t){if(RI(t))return null;const i=e._adapter,{parser:r,round:s,isoWeekday:n}=e._parseOpts;let o=t;return"function"==typeof r&&(o=r(o)),LI(o)||(o="string"==typeof r?i.parse(o,r):i.parse(o)),null===o?null:(s&&(o="week"!==s||!cL(n)&&!0!==n?i.startOf(o,s):i.startOf(o,"isoWeek",n)),+o)}function dV(e,t,i,r){const s=cV.length;for(let n=cV.indexOf(e);n<s-1;++n){const e=lV[cV[n]],s=e.steps?e.steps:Number.MAX_SAFE_INTEGER;if(e.common&&Math.ceil((i-t)/(s*e.size))<=r)return cV[n]}return cV[s-1]}function pV(e,t,i){if(i){if(i.length){const{lo:r,hi:s}=xL(i,t);e[i[r]>=t?i[r]:i[s]]=!0}}else e[t]=!0}function fV(e,t,i){const r=[],s={},n=t.length;let o,a;for(o=0;o<n;++o)a=t[o],s[a]=o,r.push({value:a,major:!1});return 0!==n&&i?function(e,t,i,r){const s=e._adapter,n=+s.startOf(t[0].value,r),o=t[t.length-1].value;let a,l;for(a=n;a<=o;a=+s.add(a,1,r))l=i[a],l>=0&&(t[l].major=!0);return t}(e,r,s,i):r}class mV extends AF{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t){const i=e.time||(e.time={}),r=this._adapter=new DF._date(e.adapters.date);r.init(t),GI(i.displayFormats,r.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return void 0===e?null:hV(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,i=e.time.unit||"day";let{min:r,max:s,minDefined:n,maxDefined:o}=this.getUserBounds();function a(e){n||isNaN(e.min)||(r=Math.min(r,e.min)),o||isNaN(e.max)||(s=Math.max(s,e.max))}n&&o||(a(this._getLabelBounds()),"ticks"===e.bounds&&"labels"===e.ticks.source||a(this.getMinMax(!1))),r=LI(r)&&!isNaN(r)?r:+t.startOf(Date.now(),i),s=LI(s)&&!isNaN(s)?s:+t.endOf(Date.now(),i)+1,this.min=Math.min(r,s-1),this.max=Math.max(r+1,s)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],i=e[e.length-1]),{min:t,max:i}}buildTicks(){const e=this.options,t=e.time,i=e.ticks,r="labels"===i.source?this.getLabelTimestamps():this._generate();"ticks"===e.bounds&&r.length&&(this.min=this._userMin||r[0],this.max=this._userMax||r[r.length-1]);const s=this.min,n=function(e,t,i){let r=0,s=e.length;for(;r<s&&e[r]<t;)r++;for(;s>r&&e[s-1]>i;)s--;return r>0||s<e.length?e.slice(r,s):e}(r,s,this.max);return this._unit=t.unit||(i.autoSkip?dV(t.minUnit,this.min,this.max,this._getLabelCapacity(s)):function(e,t,i,r,s){for(let n=cV.length-1;n>=cV.indexOf(i);n--){const i=cV[n];if(lV[i].common&&e._adapter.diff(s,r,i)>=t-1)return i}return cV[i?cV.indexOf(i):0]}(this,n.length,t.minUnit,this.min,this.max)),this._majorUnit=i.major.enabled&&"year"!==this._unit?function(e){for(let t=cV.indexOf(e)+1,i=cV.length;t<i;++t)if(lV[cV[t]].common)return cV[t]}(this._unit):void 0,this.initOffsets(r),e.reverse&&n.reverse(),fV(this,n,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((e=>+e.value)))}initOffsets(e){let t,i,r=0,s=0;this.options.offset&&e.length&&(t=this.getDecimalForValue(e[0]),r=1===e.length?1-t:(this.getDecimalForValue(e[1])-t)/2,i=this.getDecimalForValue(e[e.length-1]),s=1===e.length?i:(i-this.getDecimalForValue(e[e.length-2]))/2);const n=e.length<3?.5:.25;r=bL(r,0,n),s=bL(s,0,n),this._offsets={start:r,end:s,factor:1/(r+1+s)}}_generate(){const e=this._adapter,t=this.min,i=this.max,r=this.options,s=r.time,n=s.unit||dV(s.minUnit,t,i,this._getLabelCapacity(t)),o=NI(s.stepSize,1),a="week"===n&&s.isoWeekday,l=cL(a)||!0===a,c={};let u,h,d=t;if(l&&(d=+e.startOf(d,"isoWeek",a)),d=+e.startOf(d,l?"day":n),e.diff(i,t,n)>1e5*o)throw new Error(t+" and "+i+" are too far apart with stepSize of "+o+" "+n);const p="data"===r.ticks.source&&this.getDataTimestamps();for(u=d,h=0;u<i;u=+e.add(u,o,n),h++)pV(c,u,p);return u!==i&&"ticks"!==r.bounds&&1!==h||pV(c,u,p),Object.keys(c).sort(((e,t)=>e-t)).map((e=>+e))}getLabelForValue(e){const t=this._adapter,i=this.options.time;return i.tooltipFormat?t.format(e,i.tooltipFormat):t.format(e,i.displayFormats.datetime)}_tickFormatFunction(e,t,i,r){const s=this.options,n=s.time.displayFormats,o=this._unit,a=this._majorUnit,l=o&&n[o],c=a&&n[a],u=i[t],h=a&&c&&u&&u.major,d=this._adapter.format(e,r||(h?c:l)),p=s.ticks.callback;return p?kI(p,[d,t,i],this):d}generateTickLabels(e){let t,i,r;for(t=0,i=e.length;t<i;++t)r=e[t],r.label=this._tickFormatFunction(r.value,t,e)}getDecimalForValue(e){return null===e?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,i=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+i)*t.factor)}getValueForPixel(e){const t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+i*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,i=this.ctx.measureText(e).width,r=dL(this.isHorizontal()?t.maxRotation:t.minRotation),s=Math.cos(r),n=Math.sin(r),o=this._resolveTickFontOptions(0).size;return{w:i*s+o*n,h:i*n+o*s}}_getLabelCapacity(e){const t=this.options.time,i=t.displayFormats,r=i[t.unit]||i.millisecond,s=this._tickFormatFunction(e,0,fV(this,[e],this._majorUnit),r),n=this._getLabelSize(s),o=Math.floor(this.isHorizontal()?this.width/n.w:this.height/n.h)-1;return o>0?o:1}getDataTimestamps(){let e,t,i=this._cache.data||[];if(i.length)return i;const r=this.getMatchingVisibleMetas();if(this._normalized&&r.length)return this._cache.data=r[0].controller.getAllParsedValues(this);for(e=0,t=r.length;e<t;++e)i=i.concat(r[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const e=this._cache.labels||[];let t,i;if(e.length)return e;const r=this.getLabels();for(t=0,i=r.length;t<i;++t)e.push(hV(this,r[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return AL(e.sort(uV))}}function gV(e,t,i){let r,s,n,o,a=0,l=e.length-1;i?(t>=e[a].pos&&t<=e[l].pos&&({lo:a,hi:l}=CL(e,"pos",t)),({pos:r,time:n}=e[a]),({pos:s,time:o}=e[l])):(t>=e[a].time&&t<=e[l].time&&({lo:a,hi:l}=CL(e,"time",t)),({time:r,pos:n}=e[a]),({time:s,pos:o}=e[l]));const c=s-r;return c?n+(o-n)*(t-r)/c:n}mV.id="time",mV.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};class yV extends mV{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=gV(t,this.min),this._tableRange=gV(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:i}=this,r=[],s=[];let n,o,a,l,c;for(n=0,o=e.length;n<o;++n)l=e[n],l>=t&&l<=i&&r.push(l);if(r.length<2)return[{time:t,pos:0},{time:i,pos:1}];for(n=0,o=r.length;n<o;++n)c=r[n+1],a=r[n-1],l=r[n],Math.round((c+a)/2)!==l&&s.push({time:l,pos:n/(o-1)});return s}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),i=this.getLabelTimestamps();return e=t.length&&i.length?this.normalize(t.concat(i)):t.length?t:i,e=this._cache.all=e,e}getDecimalForValue(e){return(gV(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return gV(this._table,i*this._tableRange+this._minPos,!0)}}yV.id="timeseries",yV.defaults=mV.defaults;const _V=[PF,aU,qU,Object.freeze({__proto__:null,CategoryScale:$U,LinearScale:JU,LogarithmicScale:QU,RadialLinearScale:aV,TimeScale:mV,TimeSeriesScale:yV})];var vV="https://services2.arcgis.com/jUpNdisbWqRpMo35/arcgis/rest/services/BerlinRBS_Ortsteile_2017/FeatureServer",bV=new W({basemap:"dark-gray-vector",ground:"world-elevation"}),wV=new wA({container:document.querySelector("#viewDiv"),center:[13.405,52.52],scale:5e4,map:bV,environment:{atmosphereEnabled:!1,starsEnabled:!1}}),xV=new xA.default({title:"Berlin trees",minScale:5e3,url:"https://services2.arcgis.com/jUpNdisbWqRpMo35/ArcGIS/rest/services/Baumkataster_Berlin/FeatureServer/0/",outFields:["*"],elevationInfo:{mode:"on-the-ground"},renderer:new TA.Z({symbol:new RA.Z({name:"Populus",styleName:"EsriRealisticTreesStyle"})})});bV.add(xV);var CV="#8400a8",TV="#e6bc01",SV={value:"F",symbol:new MA.Z({symbolLayers:[new OA.Z({profile:"quad",material:{color:CV},width:10,height:3})]})},EV={value:"M",symbol:new MA.Z({symbolLayers:[new OA.Z({profile:"quad",material:{color:TV},width:10,height:3})]})},AV=new xA.default({title:"Berlin streets",url:"https://services2.arcgis.com/cFEFS0EWrhfDeVw9/arcgis/rest/services/Berlin_Equal_Street_Names/FeatureServer",outFields:["*"],elevationInfo:{mode:"on-the-ground"},renderer:new SA.Z({field:"gender",uniqueValueInfos:[SV,EV]})});bV.add(AV);var MV=new xA.default({title:"Berlin district boundaries",url:vV,outFields:["*"],elevationInfo:{mode:"on-the-ground"},renderer:new TA.Z({symbol:new $g.Z({symbolLayers:[new qg.Z({outline:{color:"white",size:"2px",pattern:new PA.Z({style:"dash"}),patternCap:"round"}})]})})}),OV=new xA.default({title:"Berlin district names",url:vV,outFields:["*"],elevationInfo:{mode:"relative-to-scene"},labelingInfo:[{labelExpression:"[nam]",symbol:new LA.Z({symbolLayers:[new Jg.Z({material:{color:"white"},halo:{size:1,color:[50,50,50]},size:10})]})}],renderer:new TA.Z({symbol:new Yg.Z({symbolLayers:[new DA.Z({width:1,height:1,depth:1,resource:{primitive:"sphere"},material:{color:"white"}})],verticalOffset:{screenLength:100,maxWorldLength:200,minWorldLength:100},callout:new IA.Z({size:1.5,color:[150,150,150],border:{color:[50,50,50]}})})})});bV.add(MV),bV.add(OV);var RV=new EA.Z({symbolLayers:[new qg.Z({material:{color:[40,40,40,.5],colorMixMode:"tint"},edges:new AA.Z({size:.5,color:[255,255,255,.5]})})]}),PV=new CA.default({title:"Berlin 3D buildings",url:"https://tiles.arcgis.com/tiles/P3ePLMYs2RVChkJx/arcgis/rest/services/Buildings_Berlin/SceneServer",outFields:["*"],renderer:new TA.Z({symbol:RV}),legendEnabled:!1});bV.add(PV),AV.popupTemplate=new NA.Z({content:"<p><strong>{name}</strong></p><p>{expression/title}: {expression/description}</p><p><a href='{expression/link}'>Learn more</a></p><p>",expressionInfos:[{name:"title",title:"Name of the person the street is named after.",expression:"fromJSON($feature.details).labels.en.value"},{name:"description",title:"Description of the person the street is named after.",expression:"fromJSON($feature.details).descriptions.en.value"},{name:"link",title:"Link to wikipedia article.",expression:"fromJSON($feature.details).sitelinks.enwiki.url"}].map((function(e){return new FA.Z(e)}))}),new TO({container:"search-widget-container",view:wV});var IV=new MO({view:wV});wV.ui.add(IV,"top-left");var LV=new AI({view:wV,listItemCreatedFunction:function(e){var t=e.item;"group"!=t.layer.type&&(t.panel={content:"legend",open:!0})}});wV.ui.add(LV,"top-right"),Uk.register.apply(Uk,_V);var DV=0,NV=0,FV=document.getElementById("chart-canvas"),kV=new Uk(FV,{type:"doughnut",data:{labels:["Female","Male"],datasets:[{label:"Zurich streets by gender",data:[DV,NV],backgroundColor:[CV,TV],borderColor:[CV,TV],hoverOffset:4}]}});Uk.defaults.color="#fff",wV.whenLayerView(AV).then((function(e){(0,he.gx)((function(){return!e.updating}),(function(){return t=void 0,i=void 0,s=function(){var t,i;return function(e,t){var i,r,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}(this,(function(r){switch(r.label){case 0:return[4,e.queryFeatures({geometry:wV.extent,returnGeometry:!0})];case 1:return t=r.sent(),i=t.features,DV=i.filter((function(e){return"F"===e.attributes.gender})).length,NV=i.filter((function(e){return"M"===e.attributes.gender})).length,kV.data.datasets[0].data=[DV,NV],kV.update(),[2]}}))},new((r=void 0)||(r=Promise))((function(e,n){function o(e){try{l(s.next(e))}catch(e){n(e)}}function a(e){try{l(s.throw(e))}catch(e){n(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(o,a)}l((s=s.apply(t,i||[])).next())}));var t,i,r,s}))}))})()})();